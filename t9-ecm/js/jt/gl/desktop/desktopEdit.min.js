$(function(){var a=new DesktopConfig();a.init();});function DesktopConfig(){}DesktopConfig._CONS_={SAVE_ADD_URL:ctx+"/gl/desktop/desktopConfig/saveAdd.htm",SAVE_EDIT_URL:ctx+"/gl/desktop/desktopConfig/saveEdit.htm",LOAD_DESKTOP_LAYOUT_URL:ctx+"/gl/desktop/desktopLayout/loadData.htm",LOAD_DESKTOP_COLUMN_URL:ctx+"/gl/desktop/desktopColumn/loadData.htm",LIST_PRIVATE_URL:ctx+"/gl/desktop/desktopConfig/list.htm",PREVIEW_URL:ctx+"/gl/desktop/desktopColumn/preview.htm",LOAD_DATA_URL:ctx+"/gl/desktop/desktopColumn/loadDesktopColumnData.htm"};
DesktopConfig.prototype={init:function(){this._setContainerMinHeight();this._loadDesktopLayout();this._loadDesktopColumn();this._bindEventHandler();this._initContainer();
this._ajaxLoadDesktopTab();this._bindFormValidation();$(".demo").find(".desktopTab").each(function(){var a=ctx+$(this).attr("srcVal");$(this).attr("srcVal",a);
});},_setContainerMinHeight:function(){$("body").css("min-height",$(window).height()-90);$(".demo").css("min-height",$(window).height()-160);},_initContainer:function(){var a=this;
$(".demo, .demo .column").sortable({connectWith:".column",opacity:0.35,handle:".drag",start:function(c,b){},stop:function(c,b){}});},_loadDesktopLayout:function(){var a=this;
FormUtils.loadData(DesktopConfig._CONS_.LOAD_DESKTOP_LAYOUT_URL,function(c){if(!c){DialogUtils.error(msgCode.ERROR,"没有数据，请稍候重试");return;}var e=new StringBuffer();
for(var b=0;b<c.length;b++){var d=c[b];e.append("<div class='lyrow ui-draggable'>").append("<a href='#close' class='remove label label-important'><i class='icon-remove icon-white'></i>删除</a>").append("<span class='drag label'><i class='glyphicon glyphglyphicon glyphicon-move'></i>拖动</span>").append("<div class='preview'>").append("<input value='"+d.name+"' type='text'>").append("</div>").append("<div class='view'>").append("<div class='row-fluid clearfix'>").append(d.code).append("</div></div></div>");
}$("#estRows").append(e.toString());$(".sidebar-nav .lyrow").draggable({connectToSortable:".demo",helper:"clone",handle:".drag",start:function(g,f){},drag:function(g,f){f.helper.width(400);
},stop:function(g,f){$(".demo .column").sortable({opacity:0.35,connectWith:".column",start:function(i,h){},stop:function(i,h){}});}});});},_getDestopColumnIbox:function(a){var b=new StringBuffer();
b.append("<div data-id='"+a.id+"' class='box box-element ui-draggable'>").append("<a href='#close' class='remove label label-danger'>").append("<i	class='glyphicon glyphicon-remove'></i>删除").append("</a> ").append("<span class='drag label label-default'>").append("<i class='glyphicon glyphglyphicon glyphicon-move'></i>拖动").append("</span>").append("<div class='preview' title='"+a.title+"'>"+a.title+"</div>").append("<div class='view'>");
if(a.heightType>0){b.append("<div srcVal='"+ctx+a.iframeUrl+"' class='desktopTab' style='height: "+a.heightType+"px;'></div>");}else{b.append("<div srcVal='"+ctx+a.iframeUrl+"' class='desktopTab'></div>");
}b.append("</div>").append("</div>");return b.toString();},_loadDesktopColumn:function(){var a=this;FormUtils.loadData(DesktopConfig._CONS_.LOAD_DESKTOP_COLUMN_URL,function(c){if(!c){DialogUtils.error(msgCode.ERROR,"没有数据，请稍候重试");
return;}var b={};for(var d=0;d<c.length;d++){b[c[d].group]=[];}var f=new StringBuffer();for(var d=0;d<c.length;d++){for(var e in b){if(e==c[d].group){b[e].push(c[d]);
}}}var f=new StringBuffer();for(var e in b){f.append("<ul class='nav nav-list accordion-group'>");f.append("<li class='nav-header'><i class='glyphicon-plus glyphicon'></i>");
f.append(e);f.append("<div class='pull-right popover-info'>");f.append("<i class='glyphicon glyphicon-question-sign'></i>");f.append("<div class='popover fade right'>");
f.append("<div class='arrow'></div>");f.append("<h3 class='popover-title'>帮助</h3>");f.append("<div class='popover-content'>");f.append("拖放组件到布局框内. 拖入后你可以设置组件样式. 查看这里获取更多帮助 ");
f.append("<a target='_blank' href='http://twitter.github.io/bootstrap/components.html'>Components.</a>");f.append("</div>");f.append("</div>");f.append("</div>");
f.append("</li>");f.append("<li class='boxes' style='display: none;'>");for(var d=0;d<b[e].length;d++){f.append(a._getDestopColumnIbox(b[e][d]));}f.append("</li>");
f.append("</ul>");}$("#desktopColumnContainer").append(f.toString());$(".sidebar-nav .box").draggable({connectToSortable:".column",helper:"clone",handle:".drag",start:function(h,g){$.log("start");
},drag:function(h,g){$.log("drag");g.helper.width(400);},stop:function(){$("#desktopConfigContainer").find(".desktopTab").each(function(){if($(this).children().length==0){var g=$(this).attr("srcVal");
a._ajaxLoadDesktopTabForDiv($(this));}});}});});},_ajaxLoadDesktopTabForDiv:function(a){var b=a.attr("srcVal");if(b.indexOf("?")!=-1){b+="&currentPositionId="+$("#changedesktop").val();
}else{b+="?currentPositionId="+$("#changedesktop").val();}if(b.indexOf(ctx)==-1){b=ctx+b;}FormUtils.loadData(b,function(c){a.empty().append(c.msg);},function(){},true);
},_ajaxLoadDesktopTab:function(){var a=this;$("#desktopConfigContainer").find(".desktopTab").each(function(){a._ajaxLoadDesktopTabForDiv($(this));});},_save:function(){if($("#desktopConfigForm").valid()){var c=this;
var b=$(".demo");b.find(".desktopTab").each(function(){var e=$(this).attr("srcVal").substring(ctx.length);$(this).attr("srcVal",e);});var d={editCode:encodeURIComponent(b.html().trim()),name:$("input[name='name']").val(),belongType:$("input[name='belongType']").val(),viewCode:encodeURIComponent(this._downloadLayoutSrc()),isDefault:$("select[name='isDefault']").val(),sort:$("input[name='sort']").val(),id:$("input[name='id']").val()?$("input[name='id']").val():"",createTime:$("input[name='createTime']").val()?$("input[name='createTime']").val():"",createBy:$("input[name='createBy']").val()?$("input[name='createBy']").val():"",desc:$("textarea[name='desc']").val(),position:$("select[name='position']").val(),};
var a=d.id?DesktopConfig._CONS_.SAVE_EDIT_URL:DesktopConfig._CONS_.SAVE_ADD_URL;FormUtils.submit(a,d,function(e){if(e.success){if(e.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);
}else{DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);}c._goBackListView();}else{DialogUtils.error(msgCode.FAIL,msgCode.FAIL_MSG);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}},_clearDemo:function(){$(".demo").empty();},_goBackListView:function(){window.location.href=DesktopConfig._CONS_.LIST_PRIVATE_URL;},_bindFormValidation:function(){var a={rules:{name:{required:true},isDefault:{required:true}}};
FormUtils.bindFormValidation("desktopConfigForm",a);},_bindEventHandler:function(){var a=this;$("body").on("click",".detailBtn",function(){JTTabUtils.addOrRefreshTab(ctx+$(this).attr("urlVal"),$(this).parents(".ibox-title").find("h5").text());
});$("#saveBtn").on("click",function(){a._save();});$("#saveModal").on("hidden.bs.modal",function(){FormUtils.clear("desktopConfigForm");});$(".demo").on(".configuration > a","click",function(c){c.preventDefault();
var b=$(this).parent().next().next().children();$(this).toggleClass("active");b.toggleClass($(this).attr("rel"));});$(".demo").on(".configuration .dropdown-menu a","click",function(d){d.preventDefault();
var b=$(this).parent().parent();var f=b.parent().parent().next().next().children();b.find("li").removeClass("active");$(this).parent().addClass("active");
var c="";b.find("a").each(function(){c+=$(this).attr("rel")+" ";});b.parent().removeClass("open");f.removeClass(c);f.addClass($(this).attr("rel"));});$(".demo").delegate(".remove","click",function(b){b.preventDefault();
$(this).parent().remove();if(!$(".demo .lyrow").length>0){a._clearDemo();}});$(".prevBtn").on("click",function(){a._goBackListView();});$("#edit").click(function(){$("body").removeClass("devpreview sourcepreview");
$("body").addClass("edit");a._removeMenuClasses();$(this).addClass("active");});$("#clear").click(function(b){b.preventDefault();a._clearDemo();});$("#sourcepreview").click(function(){$("body").removeClass("edit");
$("body").addClass("devpreview sourcepreview");a._removeMenuClasses();$(this).addClass("active");});$("#desktopColumnContainer").on("click",".nav-header",function(){$(this).parent().siblings().find(".boxes,.rows").hide();
$(this).next().slideDown();});$(".demo").on(".remove","click",function(b){b.preventDefault();$(this).parent().remove();if(!$(".demo .lyrow").length>0){a._clearDemo();
}});$("select[name=isDefault]").on("click",function(b){if($(this).val()=="y"){$("input[name=sort]").val("0");$("input[name=sort]").attr("disabled",true);
}else{$("input[name=sort]").val("");$("input[name=sort]").attr("disabled",false);}});},_removeMenuClasses:function(){$("#menu-layoutit li button").removeClass("active");
},_cleanHtml:function(a){$(a).parent().append($(a).children().html());},_downloadLayoutSrc:function(){var c="";var a=this;$("#download-layout .container-fluid").removeClass("container-fluid").addClass("container");
$("#download-layout").children().html($(".demo").html());var b=$("#download-layout").children();b.find(".preview, .configuration, .drag, .remove").remove();
b.find(".lyrow").addClass("removeClean");b.find(".lyrow .lyrow .lyrow .lyrow .lyrow .removeClean").each(function(){a._cleanHtml(this);});b.find(".lyrow .lyrow .lyrow .lyrow .removeClean").each(function(){a._cleanHtml(this);
});b.find(".lyrow .lyrow .lyrow .removeClean").each(function(){a._cleanHtml(this);});b.find(".lyrow .lyrow .removeClean").each(function(){a._cleanHtml(this);
});b.find(".lyrow .removeClean").each(function(){a._cleanHtml(this);});b.find(".removeClean").each(function(){a._cleanHtml(this);});b.find(".removeClean").remove();
$("#download-layout .column").removeClass("ui-sortable");$("#download-layout .row-fluid").removeClass("clearfix").children().removeClass("column");if($("#download-layout .container").length>0){$("#download-layout .row-fluid").removeClass("row-fluid").addClass("row");
}b.find(".box.box-element.ui-draggable").each(function(){var d=$(this).find(".view").find(".desktopTab");$(this).parent().append(d.empty());$(this).remove();
});return b.html().trim();}};