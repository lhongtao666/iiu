function LeaderIndex(a){this.communicate="phone";this.ldTime=2*60*1000;this.sumTarget=0;}LeaderIndex._CONS_={LD_RANK_URL:ctx+"/ec/rp/reportProfit/leardSaleRank.htm",LD_RANK_GRID:"#ld-rank-grid",LD_DEAL_URL:ctx+"/ec/salesorder/soEntity/realTimePlaceData.htm",LD_DEAL_GRID:"#ld-deal-grid",DE_IMG:'<img style=\'width:100px; height:100px;\' alt="默认图片"  src="'+ctx+'/img/jt/nophoto.png" />',};
LeaderIndex.prototype={init:function(){var a=this;a.loadData();a.initLdRankGrid();a.initLdCommunicationViewer();a.initLdDealGrid();a.refreshLdDealGrid();
a.initLdIssueViewer();a.resizeViewer();a.bindEventListener();},resizeViewer:function(){var a=this;$(window).on("resize",function(){a.initLdCommunicationViewer();
a.initLdIssueViewer();});},bindEventListener:function(){var a=this;$(document).on("click",".ld-communicate-btn > div",function(b){if(!$(this).is(".ld-active")){$(".ld-active").removeClass("ld-active");
$(this).addClass("ld-active");}if($(this).is(".ld-com-phone")){a.communicate="phone";a.initLdCommunicationViewer();}else{if($(this).is(".ld-com-weixin")){a.communicate="wx";
a.initLdCommunicationViewer();}}});},initLdCommunicationViewer:function(c,d){var b=this;var a=ctx+"/gl/cti/tRKSheetRecord/loadRecordSpread.htm";if(b.communicate=="wx"){a=ctx+"/crm/report/weiXinFriendQtyReport/wxChatSpread.htm";
}FormUtils.loadData(a,function(f){var e=[];if(b.communicate=="wx"){e=["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","24:00"];
}else{e=["00:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","24:00"];}var f=f;option={grid:{x:50,y:25,x2:10,y2:25},tooltip:{trigger:"axis",position:function(g){return[g[0],"0%"];
}},title:{left:"30",textStyle:{color:"#555",fontStyle:"normal",fontWeight:"500",fontFamily:"sans-serif",fontSize:12},text:"数量",},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:false,data:e},yAxis:{type:"value",boundaryGap:[0,"100%"]},series:[{data:f,name:"沟通量",type:"line",smooth:true,itemStyle:{normal:{color:"#1c84c6"}},areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(28, 132, 198, .15)"},{offset:1,color:"rgba(28, 132, 198, .75)"}])}}}]};
echarts.init(document.getElementById("ld-communicate-viewer")).setOption(option);});},initLdIssueViewer:function(){var a=this;FormUtils.loadData(ctx+"/ec/rp/reportProfit/leadSoConfirmProfit.htm",function(c){var b=["00:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","24:00"];
var c=c;option={grid:{x:50,y:30,x2:20,y2:25},tooltip:{trigger:"axis",position:function(d){return[d[0],"0%"];}},title:{left:"30",textStyle:{color:"#555",fontStyle:"normal",fontWeight:"500",fontFamily:"sans-serif",fontSize:12},text:"金额",},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:false,data:b},yAxis:{type:"value",boundaryGap:false},series:[{name:"金额",data:c,type:"line",smooth:true,itemStyle:{normal:{color:"#1c84c6"}},areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(28, 132, 198, .15)"},{offset:1,color:"rgba(28, 132, 198, .75)"}])}}}]};
echarts.init(document.getElementById("ld-issue-viewer")).setOption(option);});},initLdRankGrid:function(b){var a=this;if(b==null||typeof b==undefined){b={};
}$(LeaderIndex._CONS_.LD_RANK_GRID).JTJqgrid({url:LeaderIndex._CONS_.LD_RANK_URL,width:"100%",height:"100%",autowidth:true,postData:b,footerrow:false,userDataOnFooter:true,sortable:false,multiselect:false,rownumWidth:25,rowNum:1000,colNames:["员工","部门","新进客户","总下单金额"],colModel:[{name:"employee",sortable:false,align:"center",width:100,formatter:function(c,d,e){return"<div class='ld-profile-layer'><img class='ld-profile' onerror='onImageError()' src='"+ctx+e.profile+"'></div><div class='ld-basic-layer'>&nbsp;"+e.placerAid+":"+e.placerName+"</div>";
}},{name:"groupName",sortable:false,align:"center",width:100},{name:"countNewCs",sortable:false,align:"center",width:100,formatter:function(c,d,e){return"<font style='color:#333'>"+c+"</font>";
}},{name:"totalMoney",sortable:false,align:"center",width:100,formatter:function(c,d,e){return"<font style='color:blue;font-weight:bold'>"+e.placeCount+"/</font><font style='color:red;font-weight:bold'>"+e.totalAmount+"</font>";
}}],loadComplete:function(){$(LeaderIndex._CONS_.LD_RANK_GRID).find(".ld-profile").off().each(function(c,d){$(this).load(function(){$(this).attr("style",imgStyle($(this)[0].naturalWidth,$(this)[0].naturalHeight,35));
});});},gridComplete:function(){var c=$(LeaderIndex._CONS_.LD_RANK_GRID).closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").height()-5;if(c<275){c=275;}$(LeaderIndex._CONS_.LD_RANK_GRID).find("tr.jqgrow").css({"height":c/5+"px"});
},ondblClickRow:function(c){},});},initLdDealGrid:function(b){var a=this;if(b==null||typeof b==undefined){b={};}$(LeaderIndex._CONS_.LD_DEAL_GRID).JTJqgrid({url:LeaderIndex._CONS_.LD_DEAL_URL,width:"100%",height:"100%",autowidth:true,postData:b,footerrow:false,userDataOnFooter:true,sortable:false,multiselect:false,rownumWidth:25,rowNum:1000,colNames:["员工","部门","订单编号","下单金额","下单产品"],colModel:[{name:"employee",sortable:false,align:"center",width:100,formatter:function(c,d,e){return"<div class='ld-profile-layer'><img class='ld-profile' onerror='onImageError()' src='"+ctx+e.profile+"'></div><div class='ld-basic-layer'>&nbsp;"+e.placerAid+":"+e.placerName+"</div>";
}},{name:"groupName",sortable:false,align:"center",width:100},{name:"soNo",sortable:false,align:"center",width:110,formatter:function(c,d,e){return"<font style='color:#0099FF'>"+c+"</font>";
}},{name:"totalAmount",sortable:false,align:"center",width:80,formatter:function(c,d,e){return"<font style='color:red;font-weight:bold'>"+c+"</font>";}},{name:"prodNames",sortable:false,align:"center",width:150}],loadComplete:function(){$(LeaderIndex._CONS_.LD_DEAL_GRID).find(".ld-profile").off().each(function(c,d){$(this).load(function(){$(this).attr("style",imgStyle($(this)[0].naturalWidth,$(this)[0].naturalHeight,35));
});});},gridComplete:function(){var c=$(LeaderIndex._CONS_.LD_RANK_GRID).closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").height()-5;if(c<275){c=275;}$(LeaderIndex._CONS_.LD_DEAL_GRID).find("tr.jqgrow").css({"height":c/5+"px"});
},ondblClickRow:function(c){},});},reloadLdDealGrid:function(){var a=this;$(LeaderIndex._CONS_.LD_DEAL_GRID).trigger("reloadGrid");},refreshLdDealGrid:function(){var a=this;
a.ldDealTimer=setInterval(function(){a.reloadLdDealGrid();},a.ldTime);},loadData:function(){var a=this;FormUtils.loadData(ctx+"/gl/ou/employeeTarget/mouthTarget.htm",function(b){if(b.length==0){a.sumTarget=0;
}else{$("#ld-target").attr("data-to",b[0].sumTarget).attr("data-speed",b[0].sumTarget);a.sumTarget=b[0].sumTarget;}a.isTarget=true;a.dataUp([$("#ld-target")]);
});FormUtils.loadData(ctx+"/ec/rp/reportProfit/countProfit.htm",function(b){$("#ld-total-current").attr("data-to",b[0].todayProfit).attr("data-speed",b[0].todayProfit);
$("#ld-already").empty().text(b[0].sumComProfit);$("#ld-total-yesterday").attr("data-to",b[0].lastdayProfit).attr("data-speed",b[0].lastdayProfit);if(b[0].todayProfit<b[0].lastdayProfit){$(".ld-arrow").addClass("fa-long-arrow-down").removeClass("fa-long-arrow-up");
}$(".ld-arrow").stop().show("slow");a.sumComProfit=b[0].sumComProfit;a.waitTarget=setInterval(function(){a.loadPercent();},250);a.dataUp([$("#ld-total-current"),$("#ld-total-yesterday")]);
});FormUtils.loadData(ctx+"/crm/cs/csEntity/sumNewCs.htm",function(b){$("#ld-nc-current").attr("data-to",b[0].todayCount).attr("data-speed",b[0].todayCount);
$("#ld-nc-yesterday").attr("data-to",b[0].lastdayCount).attr("data-speed",b[0].lastdayCount);a.dataUp([$("#ld-nc-current"),$("#ld-nc-yesterday")]);});FormUtils.loadData(ctx+"/crm/ou/employee/onlineEmpAndWx.htm",function(b){$("#ld-sys-total").attr("data-to",b[0].onlineEmp).attr("data-speed",b[0].onlineEmp);
$("#ld-wx-total").attr("data-to",b[0].onlineWx).attr("data-speed",b[0].onlineWx);a.dataUp([$("#ld-sys-total"),$("#ld-wx-total")]);});},loadPercent:function(){var a=this;
if(a.isTarget){var b=a.getFinishPercent(a.sumComProfit,a.sumTarget);$("#ld-percent-int").attr("data-to",b[0]).attr("data-speed",b[0]);$("#ld-percent-float").attr("data-to",b[1]).attr("data-speed",b[1]);
a.dataUp([$("#ld-percent-int"),$("#ld-percent-float")]);clearInterval(a.waitTarget);a.waitTarget=null;}},dataUp:function(b){var a=this;if(b){$.each(b,function(d,f){var c={to:$(this).attr("data-to"),speed:100};
$(this).data("countToOptions",c);$(this).each(count);});}},getFinishPercent:function(d,c){var a=this;var b=0;if(c>0){b=(d/c)*100;if(b>999.9){b=999.9;}}else{b=100;
}b=b.toFixed(1);b+="";return b.split(".");}};$.fn.countTo=function(a){a=a||{};return $(this).each(function(){var c=$.extend({},$.fn.countTo.defaults,{from:$(this).data("from"),to:$(this).data("to"),speed:$(this).data("speed"),refreshInterval:$(this).data("refresh-interval"),decimals:$(this).data("decimals")},a);
var h=Math.ceil(c.speed/c.refreshInterval),i=(c.to-c.from)/h;var j=this,f=$(this),e=0,g=c.from,d=f.data("countTo")||{};f.data("countTo",d);if(d.interval){clearInterval(d.interval);
}d.interval=setInterval(k,c.refreshInterval);b(g);function k(){g+=i;e++;b(g);if(typeof(c.onUpdate)=="function"){c.onUpdate.call(j,g);}if(e>=h){f.removeData("countTo");
clearInterval(d.interval);g=c.to;if(typeof(c.onComplete)=="function"){c.onComplete.call(j,g);}}}function b(m){var l=c.formatter.call(j,m,c);f.html(l);}});
};$.fn.countTo.defaults={from:0,to:0,speed:1,refreshInterval:0.5,decimals:0,formatter:formatter,onUpdate:null,onComplete:null};function formatter(b,a){return b.toFixed(a.decimals);
}function count(a){var b=$(this);a=$.extend({},a||{},b.data("countToOptions")||{});b.countTo(a);}function imgStyle(b,c,a){if(b>c){return"height:100% !important;left:-"+(a*(1-(c/b)))/2+"px;width:auto !important;";
}else{if(b==c){return null;}else{if(b<c){return"top:-"+(a*(1-(b/c)))/2+"px;";}}}}