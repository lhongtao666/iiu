function NewHome(a){this.currentMsgItem;this.totalMsgItem;this.myOrderData=null;this.rowItem=12000;this.newOrderData=null;this.asc=10;this.desc=5;this.phoneTop=10;
}NewHome.prototype={init:function(){var b=this;ConfigUtils.findByKey("newIndex.asc.sum",function(c){$("#ascTop").html(c.msg);b.desc=c.msg;});ConfigUtils.findByKey("newIndex.desc.sum",function(c){$("#descTop").html(c.msg);
b.asc=c.msg;});ConfigUtils.findByKey("newIndex.phone.sum",function(c){$("#phoneTop").html(c.msg);b.phoneTop=c.msg;});b.loadNewOrder();if(window.localStorage.getItem("sys_is_ts")=="false"){ConfigUtils.findByKey("index.orderNotice.refleshTime",function(d){var c=d.msg*1000;
b.intervalIdDay=setInterval(function(){b.loadNewOrder();},c);});}b.loadGoal();b.loadMyOrderForToday();b.loadRanking();b.loadMyTalkTimeForToday(currentUserAid);
b.loadNewCsForToday();b.loadNewFollowCsForToday();b.loadMyTask("today");b.loadMyMsg("","today");b.loadMyOperLogForToday();var a=new Date();b.findMyProfitLineChart(a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" 00:00:00",a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" 23:59:59",currentUserId,"hour");
b.resizeNewLi();b.bindEvent();},bindEvent:function(){var b=this;var a=new Date();$(document).on("click",".task-loadmore",function(c){$(this).parent().next().find(".showMore").trigger("click");
});$(document).on("click",".order-id",function(){var m=$(this).attr("csNameVal");var c=$(this).attr("idVal");var e=$(this).attr("value");var l=$(this).attr("soType");
var i=$(this).attr("status");var d=(b.canModifyProfit&&i!="complete"&&i!="close_lost"&&i!="close_reject"&&i!="close")?"can":"cannot";var f=(b.canShowScTrankNo)?b.canShowScTrankNo:"";
if(i=="awaiting_post"&&ResUtils.canShow("soEntitySubmit.url")){SoEntityUtils.submit(c,e,l);}else{if(i=="awaiting_comfirm"&&ResUtils.canShow("soEntityComfirm.url")){var g=[];
g.push(c);SoEntityUtils.confirm(g,e,l);}else{if(i=="shipping"&&ResUtils.canShow("soEntity.url")){var g=[];g.push(c);var h=[];h.push(e);JTTabUtils.addOrRefreshTab(ctx+"/ec/salesorder/soEntity/toFollow.htm"+"?soId="+g[0]+"&soNo="+h[0],"订单["+h[0]+"]跟进");
}else{if("comfirm"==i&&ResUtils.canShow("soEntityStock.url  ")){var k=[];var j={id:c,soNo:e};k.push(j);SoEntityUtils.toDeliver(k);}else{var h=[];var n=[];
h.push(e);n.push(m);JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.DETAIL_PAGE_URL+"?soNo="+e+"&canModifyProfit="+d+"&canShowScTrankNo="+b.canShowScTrankNo,m+"的订单明细");
}}}}});$(document).on("click",".new-cs-data",function(c){JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/list.htm?type=self&belongEmployee="+currentUserId+"&Q__S__EQ__entity.is_sea_=n&Q__D__EQ__create_time_="+DateUtils.format(new Date(),"yyyy-MM-dd")+" 00:00:00","我的客户");
});$(".nol-message").hover(function(){$(this).addClass("nol-msg-hover");},function(){$(this).removeClass("nol-msg-hover");});$(document).on("click","#profitToday",function(){$("div .task-date-active").removeClass("task-date-active");
$(this).addClass("task-date-active");var c=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" 00:00:00";var e=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" 23:59:59";
var d=currentUserId;b.findMyProfitLineChart(c,e,d,"hour");});$(document).on("click","#profitYesterday",function(){$("div .task-date-active").removeClass("task-date-active");
$(this).addClass("task-date-active");var c=DateUtils.getBeforeDate(1)+" 00:00:00";var e=DateUtils.getBeforeDate(1)+" 23:59:59";var d=currentUserId;b.findMyProfitLineChart(c,e,d,"hour");
});$(document).on("click","#profitWeek",function(){$("div .task-date-active").removeClass("task-date-active");$(this).addClass("task-date-active");var c=DateUtils.format(DateUtils.getWeekStartDate(),"yyyy-MM-dd")+" 00:00:00";
var e=DateUtils.format(DateUtils.getWeekEndDate(),"yyyy-MM-dd")+" 23:59:59";var d=currentUserId;b.findMyProfitLineChart(c,e,d,"day");});$(document).on("click","#profitPrevWeek",function(){$("div .task-date-active").removeClass("task-date-active");
$(this).addClass("task-date-active");var h=currentUserId;var e=new Date();var d=e.getDate();var j=e.getDay();var g=e.getMonth();var f=e.getFullYear();begindate=new Date(f,g,d-j-7);
today=new Date(f,g,d+(6-j-7));if(begindate){begindate.setHours(0);begindate.setMinutes(0);begindate.setSeconds(0);begindate.setMilliseconds(0);}if(today){today.setHours(23);
today.setMinutes(59);today.setSeconds(59);today.setMilliseconds(59);}var c=b.dateFormatConversion(begindate);var i=b.dateFormatConversion(today);b.findMyProfitLineChart(c,i,h,"day");
});$(document).on("click",".ranking-desc,.ranking-asc,.ranking-phone",function(c){if($(c.target).is(".ranking-asc")){b.loadRanking();if($(c.target).is(".ranking-active")){}else{$(".ranking-desc").removeClass("ranking-active");
$(".ranking-asc").addClass("ranking-active");$(".ranking-phone").removeClass("ranking-active");}}else{if($(c.target).is(".ranking-desc")){if($(c.target).is(".ranking-active")){}else{$(".ranking-asc").removeClass("ranking-active");
$(".ranking-desc").addClass("ranking-active");$(".ranking-phone").removeClass("ranking-active");$(".sdpb").addClass("ranking-desc-list");}b.loadDescRanking();
}else{if($(c.target).is(".ranking-phone")){if($(c.target).is(".ranking-active")){}else{$(".ranking-asc").removeClass("ranking-active");$(".ranking-desc").removeClass("ranking-active");
$(".ranking-phone").addClass("ranking-active");$(".sdpb").removeClass("ranking-desc-list");}b.loadPhoneRanking();}}}});$(document).on("click",".ranking-screen",function(c){window.parent.initDataScreen();
});$(window).on("resize",function(){b.resizeNewLi();b.findMyProfitLineChart(a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" 00:00:00",a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" 23:59:59",currentUserId,"hour");
});},resizeNewLi:function(){var a=this;},loadMyOperLogForToday:function(){var a=this;FormUtils.loadData(ctx+"/gl/secure/secureOperLog/loadMyOperLogForToday.htm?",function(b){$("#operLogDiv").empty();
var c=b.length;if(c>=1){a.buildOperLogTable(b);$(".task-loadmore").show();}else{var d='<div class="no-data-layer mto-items-empty">你真棒，待办都处理完了哦</div>';$("#operLogDiv").append(d.toString());
}});},buildOperLogTable:function(a){var b=this;var d=new StringBuffer();d.append('<ul class="todo-list m-t ui-sortable">');if(a){for(var c=a.length-1;c>=0;
c--){d.append(b.createOperLogRow(a[c]));}}d.append("</ul>");$("#operLogDiv").empty().append(d.toString());},createOperLogRow:function(b){var a=this;var c=new StringBuffer();
c.append('<li class="operLogEntity">');c.append('<label style="padding-left:2px;font-size:12px;">');c.append("<div title='"+b.createTime+"--"+b.linkNames+"--"+b.linkContents+"' style='overflow:hidden; white-space:nowrap; text-overflow:ellipsis'>【"+b.configName+"】"+b.linkNames+"--"+b.linkContents+"</div>");
c.append("</label>");c.append("</div>");c.append("</li>");return c.toString();},loadMyMsg:function(b,c){var a=this;FormUtils.loadData(ctx+"/gl/msg/msgEntity/listToDayMsgData.htm?type="+b+"&time="+c,function(d){$("#msgDiv").empty();
var e=d.records;a.totalMsgItem=e;if(e>=1){a.currentMsgItem=1;a.msgData=d.rows;a._buildString(a.msgData);}else{var f='<div class="no-data-layer mto-items-empty">暂时没有最新消息</div>';
$("#msgDiv").append(f.toString());}});},_buildString:function(c){var j=this;$("#msgDiv").empty();var f=new StringBuffer();var e=0;if(j.currentMsgItem*j.rowItem>=j.totalMsgItem){e=j.totalMsgItem;
}else{e=j.currentMsgItem*j.rowItem;}for(var d=(j.currentMsgItem-1)*j.rowItem;d<e;d++){var a=c[d].url;var g=c[d].title;var b="";if(g.indexOf("未接来电")!=-1){b=g.replace("未接来电","");
if(b){b=PhoneEncryptUtils.encryptPhone(b);}else{b="";}}if(b){g=b+"未接来电";}if(!a){a="";}if(b){if(!c[d].content||c[d].content.indexOf("未接来电")>-1){c[d].content="[时间未知]";
}c[d].content=b+"&nbsp;&nbsp;约<strong>["+c[d].content+"]</strong>&nbsp;&nbsp;未接来电";}f.append("<div class='timeline-item'>");f.append("<div class='row'>");
f.append("<div class='col-xs-1 date' style='padding-left:0px;padding-right:2px;text-align:center;'>");if("notice"==c[d].type){f.append("<i class='fa fa-bullhorn' title='系统公告'></i>");
}else{if("miss"==c[d].type){f.append("<i class='fa fa-phone' title='未接来电'></i>");}else{if("assign"==c[d].type){f.append("<i class='fa fa-user' title='新进客户'></i>");
}else{if("others"==c[d].type){f.append("<i class='fa fa-briefcase' title='其他消息'></i>");}}}}f.append("</div>");f.append("<div class='col-xs-8 content' style='min-height: 35px;border-right: 1px solid #e7eaec;");
if(d==j.rowItem*j.currentMsgItem-1||d==e-1){f.append("border-bottom: 1px solid #e7eaec;");}f.append("' urlVal='"+a+"'  titleVal='"+g+"'>");var h=j.dealMsgCreateTime(c[d]);
if("others"==c[d].type&&c[d].content.indexOf("【客户跟进】")>-1){f.append("<div class='col-xs-1' style='padding:0px;'><img title='"+h+"' alt='其他' class='img-circle' style='height:18px;width:18px;' src="+ctx+"/img/jt/notice/level"+c[d].level+".png></div><div class='col-xs-11' style='padding:0px;'>"+j._dealCsContent(c[d].content)+"</div>");
}else{if("others"==c[d].type&&c[d].content.indexOf("【订单跟进】")>-1){f.append("<div class='col-xs-1' style='padding:0px;'><img title='"+h+"' alt='其他' class='img-circle' style='height:18px;width:18px;' src="+ctx+"/img/jt/notice/level"+c[d].level+".png></div><div class='col-xs-11' style='padding:0px;'>"+j._dealSoFollowContent(c[d].content)+"</div>");
}else{if("others"==c[d].type&&c[d].content.indexOf("【订单】")>-1){f.append("<div class='col-xs-1' style='padding:0px;'><img title='"+h+"' alt='其他' class='img-circle' style='height:18px;width:18px;' src="+ctx+"/img/jt/notice/level"+c[d].level+".png></div><div class='col-xs-11' style='padding:0px;'>"+j._dealSoContent(c[d].content)+"</div>");
}else{if("assign"==c[d].type){f.append("<div class='col-xs-1' style='padding:0px;'><img title='"+h+"' alt='其他' class='img-circle' style='height:18px;width:18px;' src="+ctx+"/img/jt/notice/level"+c[d].level+".png></div><div class='col-xs-11' style='padding:0px;'>"+j._dealAssignContent(c[d].content)+"</div>");
}else{f.append("<div class='col-xs-1' style='padding:0px;'><img title='"+h+"' class='img-circle' style='height:18px;width:18px;' src='"+ctx+"/img/jt/notice/level"+c[d].level+".png'></div><div class='col-xs-11' style='padding:0px;'>"+c[d].content+"</div>");
}}}}f.append("</div>");f.append("<div class='col-xs-1'><button class='btn btn-danger btn-sm pull-right deleteMsg' idVal='"+c[d].id+"' type='button'><i class='fa fa-remove'></i></button></div>");
f.append("</div>");f.append("</div>");if(d==j.rowItem-1){break;}}$("#msgDiv").append(f.toString());},dealMsgCreateTime:function(a){if(DateUtils.getDateDiff(DateUtils.format(new Date(),"yyyy-MM-dd")+" 00:00:00",a.createTime.substring(0,10)+" 00:00:00","day")<0){return a.createTime.substring(5,16);
}else{return a.createTime.substring(11,16);}},_dealAssignContent:function(b){var a="";a=b.replace(/\d{1,5}/g,function(c){var d=new StringBuffer();d.append("<strong>");
d.append(c);d.append("</strong>");return d.toString();});return a;},_dealCsContent:function(b){var a="";a=b.replace(/\d{3,12}:/g,function(d){var c=d.substring(0,d.length-1);
var e=new StringBuffer();e.append("<strong>");e.append(c);e.append("</strong>");e.append(":");return e.toString();});return a;},_dealSoContent:function(b){var a="";
a=b.replace(/\d{3,12}】/g,function(d){var c=d.substring(0,d.length-1);var e=new StringBuffer();e.append("<strong>");e.append(c);e.append("</strong>");e.append("】");
return e.toString();});return a;},_dealSoFollowContent:function(b){var a="";a=b.replace(/\d{3,12}：/g,function(d){var c=d.substring(0,d.length-1);var e=new StringBuffer();
e.append("<strong>");e.append(c);e.append("</strong>");e.append("：");return e.toString();});return a;},loadMyTask:function(b){var a=this;FormUtils.loadData(ctx+"/gl/task/taskEntity/findUnfinishTask.htm?rows=5&page=1&timeType="+b,function(d){if(d.records<=0){var g='<div class="no-data-layer mto-items-empty">没有待办任务，敬请留意</div>';
$("#taskPanel").empty().append(g);}else{var c=d.rows;var h=new StringBuffer();h.append('<ul class="todo-list m-t ui-sortable">');if(c){for(var e=c.length-1;
e>=0;e--){var f=c[e];h.append(a.createTaskRow(f));}}h.append("</ul>");$("#taskPanel").empty().prepend(h.toString()).append(a._createBtn());}});},createTaskRow:function(d){var b=this;
var e=new StringBuffer();e.append('<li class="taskEntity">');e.append('<div class="checkbox checkbox-success checkbox-inline">');e.append('<input idVal="'+d.id+'" type="checkbox" class="finishTask" >');
e.append('<label taskType="'+d.type+'"  style="padding-left:2px;font-size:12px;" title="'+d.name+'" class="taskNameLabel" >');var a=TaskUtils.dealTaskName(d);
a="<div class='taskEntityEdit' idVal='"+d.id+"' style='width:220px;overflow:hidden; white-space:nowrap; text-overflow:ellipsis'>"+a+"</div>";e.append(a);
e.append("</label>");e.append('<small class="label label-primary pull-right"><i class="fa fa-clock-o"></i> ');if(d.notifyTime){var c=DateUtils.format(new Date(d.notifyTime),DateUtils._CONS_.DEFAULT_MON_DAY_HOU_MIN_PATTERN);
e.append(c);}e.append("</small>");e.append("</div>");e.append("</li>");return e.toString();},_createBtn:function(){var a=new StringBuffer();a.append(' <div class = "row pull-right" style = "padding-right:30px;" >');
a.append('<a class="J_menuItem showMore" nameVal="待办事项" urlVal="/gl/task/taskEntity/list.htm" href="#" data-index="89">');a.append('<strong>查看更多 </strong> <i class="fa fa-angle-right"></i>');
a.append("</a>");a.append("</div>");return a.toString();},dataUp:function(b){var a=this;if(b){$.each(b,function(d,f){var c={to:$(this).attr("data-to"),speed:100};
if($(this).is(".yjing,.yjed,.sdcm")){c.decimals=2;}$(this).data("countToOptions",c);$(this).each(count);});}},loadFlexer:function(c,b){var a=this;if(c==1){$(".yjing").attr("data-to",b.yjing).attr("data-speed",b.yjing).addClass("count-title");
$(".yjed").attr("data-to",b.yjed).attr("data-speed",b.yjed).addClass("count-title");if(b.yjing>b.yjed){$(".yj-lbg-layer").addClass("yj-lbg2-layer");$(".yj-rbg-layer").addClass("yj-rbg2-layer");
}a.dataUp([$(".yjing"),$(".yjed")]);}else{if(c==2){$(".today-cs-data").attr("data-to",b.totayCs).attr("data-speed",b.totayCs).addClass("count-title");a.dataUp([$(".today-cs-data")]);
}else{if(c==3){$(".new-cs-data").attr("data-to",b.newCs).attr("data-speed",b.newCs).addClass("count-title");a.dataUp([$(".new-cs-data")]);}else{if(c==4){$(".sd-cs-num-data").attr("data-to",b.sdNumber).attr("data-speed",b.sdNumber).addClass("count-title");
$(".sdcm").attr("data-to",b.sdTotal).attr("data-speed",b.sdTotal).addClass("count-title");a.dataUp([$(".sd-cs-num-data"),$(".sdcm")]);}else{if(c==5){$(".th-cs-counter-data").attr("data-to",b.num).attr("data-speed",b.num).addClass("count-title");
$(".thct").attr("data-to",b.talkTime).attr("data-speed",b.talkTime).addClass("count-title");a.dataUp([$(".th-cs-counter-data"),$(".thct")]);}}}}}},myOrderLi:function(c,b){var a=this;
var d=new StringBuffer();d.append("<div class='mto-items'>").append("<div class='mto-orderId'>订单号&emsp;<span idVal="+c.id+" status="+c.status+" soType="+c.soType+" csNameVal="+c.csName+" value="+c.soNo+"  style='cursor: pointer;color: #2196F3;' class='order-id'>"+c.soNo+"</span></div>").append("<div class='mto-createTime'>生成时间&emsp;<span>"+c.createTime+"</span></div>").append("<div class='mto-content'>"+a.myGoodsLi(c.list)+"</div>").append("<div class='mto-total'>合计&emsp;<span>￥"+c.total.toFixed(2)+"</span></div>").append("<div class='mto-number'>"+b+"</div>").append("</div>");
return d.toString();},myGoodsLi:function(b){var a=this;var c=new StringBuffer();if(b.length>0){$.each(b,function(d,f){c.append("<p>"+this.name+"&emsp;&times;"+this.number+"</p>");
});}return c.toString();},loadMyOrderForToday:function(){var a=this;FormUtils.loadData(ctx+"/ec/salesorder/soEntity/findTodayOrderForMe.htm?",function(d){a.myOrderData=d;
var b=0,c=0;if(d&&d.length>0){$.each(d,function(f,g){$(".mto-items-layer").eq(f).empty().append(a.myOrderLi(this,f+1)).removeClass("mto-items-empty");if(this.status!="awaiting_post"&&this.status!="awaiting_comfirm"&&this.status!="close"){c=parseInt(c)+parseInt(this.total);
b=parseInt(b)+1;}});$(".mto-items-layer").on("scroll",function(){$(this).find(".mto-number").stop().animate({"bottom":(2-$(this).scrollTop())+"px"},"fast");
});}a.loadFlexer(4,{sdNumber:b,sdTotal:c});});},loadGoal:function(){var a=this;var b=DateUtils.format(new Date(),"yyyy-MM");FormUtils.loadData(ctx+"/gl/ou/employeeTarget/listData.htm?Q__S__EQ__employee_id_="+currentUserId+"&Q__S__EQ__period_="+b,function(c){if(c.rows&&c.rows.length>0){if(window.localStorage.getItem("sys_is_ts")=="true"){a.loadFlexer(1,{yjing:0,yjed:c.rows[0].total});
}else{a.loadFlexer(1,{yjing:c.rows[0].completeTotal,yjed:c.rows[0].total});}}});},loadNewFollowCsForToday:function(){var a=this;FormUtils.loadData(ctx+"/crm/cs/csEntity/countNewFollow.htm",function(b){if(b&&b.success){a.loadFlexer(2,{totayCs:b.msg});
}});},loadNewCsForToday:function(){var a=this;var b=this.$container;FormUtils.loadData(ctx+"/crm/cs/csEntity/countNewCs.htm",function(c){if(c&&c.success){a.loadFlexer(3,{newCs:c.msg});
}});},loadMyTalkTimeForToday:function(b){var a=this;FormUtils.loadData(ctx+"/gl/cti/tRKSheetRecord/loadMyTalkTime.htm?aid="+b,function(g){if(g){var f=g.totalTimeLength;
var e=g.validTimeLength;var d=g.validCount;var c=a._formatSeconds(f);a.loadFlexer(5,{num:d,talkTime:c});}});},_formatSeconds:function(b){var a=0;if(b>60){a=parseInt(b/60);
}return a;},rankingLi:function(e,d,g,c){var a=this;var b=e.ranking;var f=new StringBuffer();f.append("<div class='sd-li"+(d?" sd-li-me":"")+"'>");if(b<=3&&!g){f.append("<div class='sd-num sd-num-"+b+"'>").append("<div class='sdjp'></div>").append("<span class='sdn-data unselect'>"+b+"</span>").append("</div>");
}else{f.append("<div class='sd-num sdn-other'>").append("<div class='sdjp'></div>").append("<span class='sdn-data unselect'>"+b+"</span>").append("</div>");
}f.append("<div class='sd-profile'>").append("<div class='sd-profile-img"+(b<=3?(" sd-pi-"+b):"")+"'>");if(e.profile){f.append("<img class='sdpi' onerror='onImageError()' src='"+ctx+e.profile+"'>");
}if(!e.aid){f.append("<span>?</span>");}f.append("<i class='fa fa-user'></i>").append("</div>");if(b<=3){f.append("<div class='sd-profile-"+b+"'></div>");
}f.append("</div>").append("<div class='sd-content'>").append("<div class='sd-content-layer'>");if(e.aid&&c!=true){f.append("<div class='sdc-msg'>工&emsp;&emsp;号&emsp;<span>&emsp;"+e.aid+"</span></div>").append("<div class='sdc-money'>审单金额&emsp;<span>￥"+e.sdTotal.toFixed(2)+"</span></div>").append("<div class='sdc-total'>审单数量&emsp;<span>&emsp;"+e.sdNumber+"</span></div>");
}if(e.aid&&c==true){f.append("<div class='sdc-msg'>工&emsp;&emsp;号&emsp;<span>&emsp;"+e.aid+"</span></div>").append("<div class='sdc-total'>通话时长&emsp;<span>&emsp;"+e.SumTimeLen+"</span></div>");
}else{f.append("<div class='sdc-zw'>待定</div>");}f.append("</div>").append("</div>").append("</div>");return f.toString();},loadRanking:function(){var a=this;
FormUtils.loadData(ctx+"/ec/salesorder/soEntity/loadRankingForToday.htm",function(d){var b=0;$(".sdpb").empty();if($(".sdpb").is(".ranking-desc-list")){$(".sdpb").removeClass("ranking-desc-list");
}if(d&&d.length>0){$.each(d,function(g,h){var f=false;if(this.aid==currentUserAid){f=true;}$(".sdpb").append(a.rankingLi(this,f,false,false));b++;});$(".sdpi").each(function(f,g){$(this).load(function(){$(this).attr("style",imgStyle($(this)[0].naturalWidth,$(this)[0].naturalHeight,65));
});$(this).next().hide();});}if(b<a.asc){for(var c=b;c<a.asc;c++){$(".sdpb").append(a.rankingLi({ranking:c+1},false,false,false));}}});},loadPhoneRanking:function(){var a=this;
FormUtils.loadData(ctx+"/gl/cti/tRKSheetRecord/loadPhoneForToday.htm",function(d){var b=0;$(".sdpb").empty();if($(".sdpb").is(".ranking-desc-list")){$(".sdpb").removeClass("ranking-desc-list");
}if(d&&d.length>0){$.each(d,function(g,h){var f=false;if(this.aid==currentUserAid){f=true;}$(".sdpb").append(a.rankingLi(this,f,false,true));b++;});$(".sdpi").each(function(f,g){$(this).load(function(){$(this).attr("style",imgStyle($(this)[0].naturalWidth,$(this)[0].naturalHeight,65));
});$(this).next().hide();});}if(b<a.asc){for(var c=b;c<a.asc;c++){$(".sdpb").append(a.rankingLi({ranking:c+1},false,false,true));}}});},loadDescRanking:function(){var a=this;
FormUtils.loadData(ctx+"/ec/salesorder/soEntity/loadRankingDxForToday.htm",function(e){var d=e;$(".sdpb").empty();var b=0;if(e&&e.length>0){$.each(d,function(g,h){var f=false;
if(this.aid==currentUserAid){f=true;}$(".sdpb").append(a.rankingLi(this,f,true,false));b++;});$(".sdpi").each(function(f,g){$(this).load(function(){$(this).attr("style",imgStyle($(this)[0].naturalWidth,$(this)[0].naturalHeight,65));
});$(this).next().hide();});}if(b<a.desc){for(var c=b;c<a.desc;c++){$(".sdpb").append(a.rankingLi({ranking:c+1},false,true,false));}}});},newestOrderLi:function(c){var a=this;
var b='<div class="nol-carousel-items">'+'<div class="nol-order-layer">'+'<span class="nol-detail-title">订单编号&nbsp;</span>'+'<span class="nol-detail-data nol-order-number">'+c.soNo+"</span>"+"</div>"+'<div class="nol-detail-layer">'+'<span class="nol-detail-title">订单金额&nbsp;</span>&nbsp;'+'<span class="nol-detail-data"><span class="gold-icons">￥</span>'+(c.totalAmount).toFixed(2)+"</span>"+"<br/>"+'<span class="nol-detail-title">成单员工&nbsp;</span>'+'<span class="nol-detail-data">'+c.placerAid+"&nbsp;:&nbsp;"+c.placerName+"</span>"+"</div>"+'<div class="nol-detail-profile" data-profile="'+c.placerProfile+'"></div>'+"</div>";
return b;},loadLewestOrder:function(c){var a=this;if(!c){return false;}var b="";$.each(c,function(d,f){b+=a.newestOrderLi(this);});$(".nol-carousel-list").empty().append(b);
},changeLi:function(){var c=this;var d=$(".nol-current-items"),b=$(".nol-carousel-items").length;if(d.length==0){var a=$(".nol-carousel-items").eq(0).addClass("nol-current-items");
$(".nol-profile").children("img").attr("src",ctx+a.find(".nol-detail-profile").attr("data-profile"));a.delay(250).show().stop().animate({"opacity":1},"fast","swing",function(){$(this).css({"transform":"scale(1)"});
});}else{if(d.next().length==0&&b>1){d=d.removeClass("nol-current-items");d.stop().animate({"opacity":0},"fast","swing",function(){$(this).css({"transform":"scale(0)"});
setTimeout(function(){d.removeAttr("style");},500);});var a=$(".nol-carousel-items").eq(0).addClass("nol-current-items");$(".nol-profile").children("img").attr("src",ctx+a.find(".nol-detail-profile").attr("data-profile"));
a.delay(250).show().stop().animate({"opacity":1},"fast","swing",function(){$(this).css({"transform":"scale(1)"});});}else{if(d.next().length>0){var d=d.removeClass("nol-current-items");
var a=d.next().addClass("nol-current-items");$(".nol-profile").children("img").attr("src",ctx+a.find(".nol-detail-profile").attr("data-profile"));d.stop().animate({"opacity":0},"fast","swing",function(){$(this).css({"transform":"scale(0)"});
setTimeout(function(){d.removeAttr("style");},500);});a.delay(250).show().stop().animate({"opacity":1},"fast","swing",function(){$(this).css({"transform":"scale(1)"});
});}}}},setOrderData:function(){var a=this;if(a.orderRun){window.clearInterval(a.orderRun);a.orderRun=null;}a.loadLewestOrder(a.newOrderData);a.changeLi();
a.oncePlay();if(a.newOrderData.length>1){a.orderRun=setInterval(function(){a.changeLi();},4*1000);}if($(".nol-message").is(".nol-message-blank")){$(".nol-message").removeClass("nol-message-blank");
}},loadNewOrder:function(){var a=this;var b=window.sessionStorage.getItem("home.solastTime");if(!b){b=DateUtils.format(new Date(),DateUtils._CONS_.DEFAULT_DATE_PATTERN)+" 00:00:00";
}FormUtils.loadData(ctx+"/ec/salesorder/soEntity/findLastSoList.htm"+"?lastTime="+b,function(c){window.sessionStorage.setItem("home.solastTime",c.time);
if(c.data&&c.data.length>0){a.newOrderData=c.data;window.sessionStorage.setItem("home.newOrderData",JSON.stringify(c.data));a.setOrderData();}else{if(!a.newOrderData){var d=JSON.parse(window.sessionStorage.getItem("home.newOrderData"));
if(d&&d.length>0){a.newOrderData=d;a.setOrderData();}}}},null,true);},dateFormatConversion:function(f){var h=new Date();h.setTime(f);var d=h.getFullYear();
var e=h.getMonth()+1<10?"0"+(h.getMonth()+1):h.getMonth()+1;var c=h.getDate()<10?"0"+h.getDate():h.getDate();var a=h.getHours()<10?"0"+h.getHours():h.getHours();
var g=h.getMinutes()<10?"0"+h.getMinutes():h.getMinutes();var b=h.getSeconds()<10?"0"+h.getSeconds():h.getSeconds();return d+"-"+e+"-"+c+" "+a+":"+g+":"+b;
},getAllDate:function(b,d,f){var n=b.split("-");var i=d.split("-");var m=new Date();m.setUTCFullYear(n[0],n[1]-1,n[2]);var h=new Date();h.setUTCFullYear(i[0],i[1]-1,i[2]);
var a=m.getTime();var l=h.getTime();var g="";var e=0;f[e]=n[2];e=1;for(var c=a+24*60*60*1000;c<l;){f[e]=(new Date(parseInt(c))).format().substring(8);c=c+24*60*60*1000;
e++;}f[e]=i[2];console.log(f);},findMyProfitLineChart:function(a,g,f,d){var b=this;var h={};var e=[];h={startDate:a,endDate:g,employeeId:f,dateType:d};
var c=ctx+"/ec/rp/reportProfit/findMyProfitByHome.htm";if(d=="day"){b.getAllDate(a.substring(0,10),g.substring(0,10),e);}FormUtils.loadData(c+"?params="+JSON.stringify(h),function(s){if(s!=null&&s!=""){var t=s.placeList;
if(t!=null&&t!=""){var m=[];var p=0;for(var q=0;q<t.length;q++){var n=null;n=t[q].dateTime;m[p]=[n,t[q].placeAmount];p++;}}var k=s.confirmList;if(k!=null&&k!=""){var r=[];
var p=0;for(var q=0;q<k.length;q++){r[p]=[k[q].dateTime,k[q].auditAmount];p++;}}var o=s.shipList;if(o!=null&&o!=""){var l=[];var p=0;for(var q=0;q<o.length;
q++){l[p]=[o[q].dateTime,o[q].shipAmount];p++;}}var u=s.completeList;if(u!=null&&u!=""){var v=[];var p=0;for(var q=0;q<u.length;q++){v[p]=[u[q].dateTime,u[q].signAmount];
p++;}}b._initQUxian(m,r,l,v,d,e);}});},_initQUxian:function(h,d,g,a,b,c){var e=[];if(b=="hour"){e=[{type:"value",boundaryGap:false,axisLabel:{formatter:"{value} 小时"}}];
}else{e=[{type:"category",boundaryGap:false,data:c,axisLabel:{formatter:"{value} 日"}}];}var f=echarts.init(document.getElementById("profitLineChart"));
option={tooltip:{trigger:"axis"},grid:{x:80,y:50,y2:30},legend:{data:["下单","审单","发货","签收"],left:"left",textStyle:{fontSize:10},itemGap:10,itemWidth:21},toolbox:{show:true,itemSize:11,feature:{mark:{show:true},dataView:{show:true,readOnly:false},magicType:{show:true,type:["line","bar"]},restore:{show:true},saveAsImage:{show:true}}},calculable:true,xAxis:e,yAxis:[{type:"value",axisLabel:{formatter:"{value} 元"}}],series:[{name:"下单",type:"line",data:h},{name:"审单",type:"line",data:d},{name:"发货",type:"line",data:g},{name:"签收",type:"line",data:a}]};
f.resize();f.setOption(option);},oncePlay:function(){var a=this;$("#jt-prize-video").load();$(".jt-full-print").fadeIn("slow");setTimeout(function(){$(".jt-full-print").fadeOut("slow");
},2.5*1000);}};$.fn.countTo=function(a){a=a||{};return $(this).each(function(){var c=$.extend({},$.fn.countTo.defaults,{from:$(this).data("from"),to:$(this).data("to"),speed:$(this).data("speed"),refreshInterval:$(this).data("refresh-interval"),decimals:$(this).data("decimals")},a);
console.log(c);var h=Math.ceil(c.speed/c.refreshInterval),i=(c.to-c.from)/h;var j=this,f=$(this),e=0,g=c.from,d=f.data("countTo")||{};f.data("countTo",d);
if(d.interval){clearInterval(d.interval);}d.interval=setInterval(k,c.refreshInterval);b(g);function k(){g+=i;e++;b(g);if(typeof(c.onUpdate)=="function"){c.onUpdate.call(j,g);
}if(e>=h){f.removeData("countTo");clearInterval(d.interval);g=c.to;if(typeof(c.onComplete)=="function"){c.onComplete.call(j,g);}}}function b(m){var l=c.formatter.call(j,m,c);
f.html(l);}});};$.fn.countTo.defaults={from:0,to:0,speed:1,refreshInterval:0.5,decimals:0,formatter:formatter,onUpdate:null,onComplete:null};function formatter(b,a){return b.toFixed(a.decimals);
}function count(a){var b=$(this);a=$.extend({},a||{},b.data("countToOptions")||{});console.log(a);b.countTo(a);}function imgStyle(b,c,a){if(b>c){return"height:100% !important;left:-"+(a*(1-(c/b)))/2+"px;width:auto !important;";
}else{if(b==c){return null;}else{if(b<c){return"top:-"+(a*(1-(b/c)))/2+"px;";}}}}Date.prototype.format=function(){var a="";a+=this.getFullYear()+"-";if((this.getMonth()+1)>=10){a+=(this.getMonth()+1)+"-";
}else{a+="0"+(this.getMonth()+1)+"-";}if(this.getDate()>=10){a+=this.getDate();}else{a+="0"+this.getDate();}return(a);};