$(function(){var a=new GlLogger();a.init();});function GlLogger(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.advanceSearch=new AdvanceSearch();
}GlLogger._CONS_={EDIT_URL:ctx+"/gl/logger/glLogger/edit.htm",DETAIL_URL:ctx+"/gl/logger/glLogger/detail.htm",DELETE_URL:ctx+"/gl/logger/glLogger/delete.htm",SAVE_ADD_URL:ctx+"/gl/logger/glLogger/saveAdd.htm",SAVE_EDIT_URL:ctx+"/gl/logger/glLogger/saveEdit.htm",LIST_DATA_URL:ctx+"/gl/logger/glLogger/listData.htm",EDIT_FORM_ID:"glLoggerForm",GRID:"#glLoggerGrid",PAGER:"#glLoggerPager"};
GlLogger.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindFormValidation();this._bindEventHander();this._initTable(a);this._initAdvanceSearch();
}},_initAdvanceSearch:function(){var a=this;this.advanceSearch.setBelongToTable("jt_gl_logger");var b=[{"colName":"name_","name":"名字","dataType":"S","isEav":false}];
this.advanceSearch.setSearchCols(b);this.advanceSearch.setJqgridReloadMethod(function(c){a.reloadJqgrid(c);});this.advanceSearch.init();},clear:function(c){var a=this;
function b(){a._showListWrapper();a.isFormDataChange=false;a.isEdit=false;$(".form_wrapper .saveBtn").show();FormUtils.clear(GlLogger._CONS_.EDIT_FORM_ID);
FormUtils.enableForm(GlLogger._CONS_.EDIT_FORM_ID);if(c){a.reloadJqgrid();}}if(a.isEdit&&a.isFormDataChange){DialogUtils.warning(function(){b();});}else{b();
}},_showListWrapper:function(){$(".list_wrapper").show();$(".form_wrapper").hide();},_showFormWrapper:function(){$(".list_wrapper").hide();$(".form_wrapper").show();
},_add:function(){$("tbody").last().prepend($("tbody").first().html());$($("tbody").last().children().first().attr("id","hiddenTr"));},_edit:function(a){this._showFormWrapper();
this.edit=true;this._loadData(a);},_detail:function(a){this._showFormWrapper();this._loadData(a);$(".form_wrapper .saveBtn").hide();FormUtils.disableForm(GlLogger._CONS_.EDIT_FORM_ID);
},_loadData:function(b){var a=this;FormUtils.loadData(GlLogger._CONS_.EDIT_URL+"?id="+b,function(c){$("input[name=id]").val(c.id);$("input[name=name]").val(c.name);
$("input[name=level]").val(c.level);$("input[name=createTime]").val(c.createTime);$("input[name=updateTime]").val(c.updateTime);});},_save:function(c,f){var b=this;
var e=$("tbody").last();var a="[";var d=0;$(e.children()).each(function(){var g="{";var h=$(this).children().length;var i=0;$($(this).children()).each(function(){if(i==0){g+='"name":"';
g+=$(this).html()+'"';}else{if(i==h-2){$($(this).children()).each(function(){g+=', "level":"'+$(this).val()+'"}';});}}i++;});if(d==e.children().length-1){a+=g;
}else{a+=g+", ";d++;}});a+="]";$.ajax({url:ctx+c,data:{"jsonArrayStr":a,"plan":f},type:"POST",dataType:"json",cache:false,async:true,success:function(){b._initTable();
DialogUtils.success("信息","操作成功");},error:function(){DialogUtils.error("信息","操作失败");}});},_delete:function(b){var a=this;DialogUtils.confirm(function(){b.parent().parent().remove();
a._save("/gl/logger/glLogger/saveAdd.htm");});},_bindEventHander:function(){var a=this;$(document).on("click",".prevBtn",function(){a.clear(false);});$(document).on("click",".saveBtn",function(){a._save("/gl/logger/glLogger/saveAdd.htm");
});$("#"+GlLogger._CONS_.EDIT_FORM_ID).on("change","input",function(){if(a.isEdit){a.isFormDataChange=true;}});$("#"+GlLogger._CONS_.EDIT_FORM_ID).on("change","select",function(){if(a.isEdit){a.isFormDataChange=true;
}});$("#"+GlLogger._CONS_.EDIT_FORM_ID).on("change","textarea",function(){if(a.isEdit){a.isFormDataChange=true;}});$(".list_wrapper").on("click",".glLoggerSearch",function(){var b=$(this).closest("form").serialize();
a.reloadJqgrid(b);});$(".toolbar-panel").on("keypress","form",function(b){if(b.keyCode=="13"){var c=$(this).closest("form").serialize();a.reloadJqgrid(c);
return false;}});$("body").on("click",".glLoggerAdd",function(){if($("#hiddenTr").html()){DialogUtils.error("信息","正在进行新增操作");}else{a._add();}});$("body").on("click",".glLoggerSavePlan",function(){if($("#hiddenTr").html()){DialogUtils.error("信息","正在进行新增操作");
return;}a.layerIndex=layer.open({type:1,title:"请输入方案名称",maxmin:false,move:false,scrollbar:false,shadeClose:false,btn:["确定","关闭"],area:["400px","150px"],content:$("#loggerPlanDiv").html(),success:function(b,c){},yes:function(c,b){var d=$.trim($(".loggerPlanInput").last().val());
if(!d){DialogUtils.error("信息","操作失败，方案名为空");return;}a._save("/gl/logschema/glLogSchema/saveAdd.htm",d);layer.close(a.layerIndex);}});});$("body").on("click",".glLoggerChoosePlan",function(){var b=$(".selectPlan");
$.ajax({url:ctx+"/gl/logschema/glLogSchema/getLoggerSchemaList.htm",data:{},type:"POST",dataType:"json",cache:false,async:false,success:function(e){var c="";
for(var d=0;d<e.length;d++){c+="<option value='"+e[d].id+"'>"+e[d].name+"</option>";}b.html(c);},error:function(){}});a.layerIndex=layer.open({type:1,title:"请选择方案",maxmin:false,move:false,scrollbar:false,shadeClose:false,btn:["确定","关闭"],area:["400px","150px"],content:$("#selectPlanDiv").html(),success:function(c,d){},yes:function(d,c){var f=$(".selectPlan").last();
var e=f.val();$.ajax({url:ctx+"/gl/logschema/glLogSchema/updateLog4jXmlByPlanId.htm",data:{"planId":e},type:"POST",dataType:"json",cache:false,async:false,success:function(g){a._initTable();
layer.close(a.layerIndex);},error:function(){}});}});});$("body").on("click",".glLoggerSave",function(){if($("#hiddenTr").html()){DialogUtils.error("信息","保存失败，正在进行新增操作");
return;}a._save("/gl/logger/glLogger/saveAdd.htm");});$("body").on("click",".glLoggerDel",function(){if($("#hiddenTr").html()){DialogUtils.error("信息","正在进行新增操作");
}else{a._delete($(this));}});$("body").on("click",".glLoggerCancel",function(){$(this).parent().parent().remove();});$("body").on("click",".glLoggerConfirm",function(){var f=$("#hiddenTr");
var e=f.children().first();var b=$.trim(e.find("input").val());if(!b){DialogUtils.error("信息","操作失败，包名不能为空");return;}var d=new RegExp("^[a-zA-Z.]+$");if(!d.test(b)){DialogUtils.error("信息","操作失败，包名格式错误");
return;}e.html(b);var c=e.next();c.find("span").remove();a._save("/gl/logger/glLogger/saveAdd.htm");});$("body").on("click",".glLoggerbatchUpdate",function(){if($("#hiddenTr").html()){DialogUtils.error("信息","批量修改失败，正在进行新增操作");
return;}a.layerIndex=layer.open({type:1,title:"批量修改",maxmin:false,move:false,scrollbar:false,shadeClose:false,btn:["确定","关闭"],area:["400px","150px"],content:$("#batchUpdateDiv").html(),success:function(b,c){},yes:function(c,b){var e=$(".batchUpdate").last().val();
var d=$("tbody");$(d.children()).each(function(){var g=0;var f=$(this).children().length;$($(this).children()).each(function(){if(g==f-2){$($(this).children().first().children()).each(function(){if(e==$(this).attr("value")){$(this).prop("selected",true);
}});}g++;});});layer.close(a.layerIndex);}});});},_bindFormValidation:function(){var a={rules:{},messages:{}};FormUtils.bindFormValidation(GlLogger._CONS_.EDIT_FORM_ID,a);
},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(GlLogger._CONS_.GRID,a);},_getManagerBtns:function(){var a=[];if(ResUtils.canShow("glLogger.button.delete")){a.push({lable:msgCode.DELETE_BTN_TEXT,btnClasses:"glLoggerDel",iconClasses:"fa fa-remove"});
}if(ResUtils.canShow("glLogger.button.edit")){a.push({lable:msgCode.EDIT_BTN_TEXT,btnClasses:"glLoggerEdit",iconClasses:"fa fa-edit"});}if(ResUtils.canShow("glLogger.button.detail")){a.push({lable:msgCode.DETAIL_BTN_TEXT,btnClasses:"glLoggerDetail",iconClasses:"fa fa-list"});
}return a;},_initTable:function(c){var a=this;var b=GlLogger._CONS_.LIST_DATA_URL;if(a.glLoggerTable){a.glLoggerTable.ajax.url(b).load(function(){});}else{a.glLoggerTable=$("#glLoggerTable").DataTable({ajax:{url:b},columns:[{data:"name",width:"50%"},{data:"level",render:function(k,h,g){var d="<select name='level' style='width:150px'>";
var j=new Array("DEBUG","INFO","WARN","ERROR","INFO,stdout");var e=g.level;var i=0;for(var f=0;f<j.length;f++){if(j[f]==e){d+="<option value='"+e+"' selected='selected'>"+e+"</option>";
}else{d+="<option value='"+j[f]+"'>"+j[f]+"</option>";}i++;}d+="</select>";return d;},width:"30%"},{data:"id",render:function(f,e,d){return"<input type='button' value='删除' id='"+d.id+"' class='jt-btn-error glLoggerDel' style='margin: 0px 0px 0px 15px;' />";
},width:"20%"},],rowId:"id",lengthMenu:[[10,-1],[10,10]],paging:false,pagingType:"simple",lengthChange:false,autoWidth:false,ordering:false,order:[[1,"desc"]],fnInitComplete:function(e,d){}});
}}};