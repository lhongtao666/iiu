$(function(){var a=new GlLogRecord();a.init();});function GlLogRecord(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}GlLogRecord._CONS_={EDIT_URL:ctx+"/gl/logger/glLogRecord/edit.htm",DETAIL_URL:ctx+"/gl/logger/glLogRecord/detail.htm",DELETE_URL:ctx+"/gl/logger/glLogRecord/delete.htm",SAVE_ADD_URL:ctx+"/gl/logger/glLogRecord/saveAdd.htm",SAVE_EDIT_URL:ctx+"/gl/logger/glLogRecord/saveEdit.htm",LIST_DATA_URL:ctx+"/gl/logger/glLogRecord/listData.htm",DOWNLOAD_LOGRECORDS_URL:ctx+"/gl/logger/glLogRecord/downLoadPdfLogRecords.htm",EDIT_FORM_ID:"glLogRecordForm",GRID:"#glLogRecordGrid",PAGER:"#glLogRecordPager"};
GlLogRecord.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindFormValidation();this._bindEventHander();this._initDate();this._initJqgrid();
}},_initDate:function(){$("#createStartTime").val(DateUtils.getBeforeDate(6));$("#createEndTime").val(DateUtils.getBeforeDate(-1));},clear:function(c){var a=this;
function b(){a._showListWrapper();a.isFormDataChange=false;a.isEdit=false;$(".form_wrapper .saveBtn").show();FormUtils.clear(GlLogRecord._CONS_.EDIT_FORM_ID);
FormUtils.enableForm(GlLogRecord._CONS_.EDIT_FORM_ID);if(c){a.reloadJqgrid();}}if(a.isEdit&&a.isFormDataChange){DialogUtils.warning(function(){b();});}else{b();
}},_showListWrapper:function(){$(".list_wrapper").show();$(".form_wrapper").hide();},_showFormWrapper:function(){$(".list_wrapper").hide();$(".form_wrapper").show();
},_add:function(){this._showFormWrapper();},_edit:function(a){this._showFormWrapper();this.edit=true;this._loadData(a);},_detail:function(a){this._showFormWrapper();
},_loadData:function(b){var a=this;FormUtils.loadData(GlLogRecord._CONS_.EDIT_URL+"?id="+b,function(c){$("input[name=id]").val(c.id);$("input[name=create_time_]").val(c.createTime);
$("input[name=level]").val(c.level);$("input[name=message]").val(c.message);$("input[name=fullyQualifiedClassName]").val(c.fullyQualifiedClassName);$("input[name=methodName]").val(c.method);
$("input[name=lineNumber]").val(c.lineNumber);$("input[name=threadName]").val(c.thread);$(".tab-pane").each(function(){$(this).removeClass("active");});
$(".tabli").each(function(){$(this).removeClass("active");});$("li[id=glLogRecordTabLi]").addClass("active");$("div[id=tabGlLogRecord]").addClass("active");
});},_save:function(){var b=this;var c=$("#id").val();var a=null;if(c!=null&&c!=""){a=GlLogRecord._CONS_.SAVE_EDIT_URL;}else{a=GlLogRecord._CONS_.SAVE_ADD_URL;
}if($("#glLogRecordForm").valid()){ButtonUtils.disableBtn("saveBtn");FormUtils.submitByFormId(a,GlLogRecord._CONS_.EDIT_FORM_ID,function(d){ButtonUtils.enableBtn("saveBtn");
if(d.success){if(d.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);}else{if(d.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
}}b.isEdit=false;b.clear(true);}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);}},function(){ButtonUtils.enableBtn("saveBtn");DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}},_delete:function(b){var a=this;DialogUtils.confirm(function(){FormUtils.del(GlLogRecord._CONS_.DELETE_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,msgCode.DELETE_MSG);
a.reloadJqgrid();}else{DialogUtils.error(msgCode.ERROR,c.msg);}});});},_bindEventHander:function(){var c=this;$(document).on("click",".prevBtn",function(){c.clear(false);
});$(document).on("click",".saveBtn",function(){c._save();});$("#"+GlLogRecord._CONS_.EDIT_FORM_ID).on("change","input",function(){if(c.isEdit){c.isFormDataChange=true;
}});$("#"+GlLogRecord._CONS_.EDIT_FORM_ID).on("change","select",function(){if(c.isEdit){c.isFormDataChange=true;}});$("#"+GlLogRecord._CONS_.EDIT_FORM_ID).on("change","textarea",function(){if(c.isEdit){c.isFormDataChange=true;
}});$(".list_wrapper").on("click",".glLogRecordSearch",function(){var k=$("#createStartTime").val();var h=$("#createEndTime").val();var g=new Date(Date.parse(k.replace(/-/g,"/")));
var i=new Date(Date.parse(h.replace(/-/g,"/")));if(i.getTime()<g.getTime()){DialogUtils.error("提示","结束时间小于开始时间");return;}var j=$(this).closest("form").serialize();
c.reloadJqgrid(j);});$("#glLogRecordForm").on("keypress",function(g){if(g.keyCode=="13"){$(".glLogRecordSearch").trigger("click");}});$("body").on("click",".glLogRecordAdd",function(){c._add();
});$("body").on("click",".glLogRecordEdit",function(){c.isEdit=true;var g=$(this).attr("idVal");if(!g){g=$(GlLogRecord._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(g==null||g.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);return;}else{if(g&&g.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);
return;}}}c._edit(g);});$("body").on("click",".glLogRecordDel",function(){var g=$(this).attr("idVal");if(!g){g=$(GlLogRecord._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(g==null||g.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_DELETE);return;}}c._delete(g);});var e=null;var f="";var a="";$("body").on("click",".glLogRecordDetail",function(){$("#findTextValue").val("");
var i=$(this).attr("idval");var g=$("#"+i);var h=g.find("td");$(h).each(function(){if("glLogRecordGrid_createTime"==$(this).attr("aria-describedby")){f=$(this).html();
}else{if("glLogRecordGrid_thread"==$(this).attr("aria-describedby")){a=$(this).html();}}});d(null,i);e=null;});$("body").on("click",".searchByTime",function(){var g=$("#timeSearchSelect").val();
d(g);e=null;});$("body").on("click",".findValue",function(){b();});function b(){var h=$("#findTextValue").val();if(e==null){var k=$("#selectLine").css("color","black");
e=$("#logRecordDetatailList").html();}$("#logRecordDetatailList").html(e);var l=$("#logRecordDetatailList").find("pre");var g=null;var i=null;var j=0;$(l).each(function(){i=$(this).html();
g=$(this).html().replaceAll(h,"<span style='color:red'>"+h+"</span>");if(g!=i){j++;}$(this).html(g);});if(j==0){DialogUtils.error("信息","没有记录匹配");}}$("body").on("click",".toLogRecordList",function(){c._showListWrapper();
});$("body").on("click",".glLogRecordReset",function(){$("#packageName").val("");$("#className").val("");$("#createStartTime").val("");$("#createEndTime").val("");
});$("body").on("click",".logRecordExport",function(){var g=$("#timeSearchSelect").val();$.ajax({url:ctx+"/gl/logger/glLogRecord/generatePdfLogRecords.htm",data:{"createTime":f,"threadName":a,"minutes":g},type:"POST",dataType:"json",async:false,cache:false,success:function(i){if(i.success){var h=$("#downLoadLogRecord");
h.attr("action",GlLogRecord._CONS_.DOWNLOAD_LOGRECORDS_URL);h.submit();}},error:function(){DialogUtils.error("信息","导出日志失败");}});});$("#findTextValue").on("keypress",function(g){if(g.keyCode=="13"){b();
return false;}});function d(j,k){var i=$("#logRecordDetatailList");var h="";var g=$("#divDisplayNone");$.ajax({url:ctx+"/gl/logger/glLogRecord/listDataByThread.htm",data:{"createTime":f,"threadName":a,"minutes":j},type:"POST",dataType:"json",async:false,cache:false,success:function(n){if(j){var l=i.find("pre");
if(n.length==l.length){DialogUtils.error("信息","无更多记录显示");return;}else{DialogUtils.success("信息","查询成功");}}for(var m=0;m<n.length;m++){var p=n[m];var o=g.clone().children().first();
$(o.children()).each(function(){if($(this).attr("class")=="btn btn-white btn-xs showLevel"){$(this).html(p.level);}else{if($(this).attr("class")=="btn btn-white btn-xs showTime"){$(this).html(p.createTime);
}else{if($(this).attr("class")=="btn btn-white btn-xs showMethod"){$(this).html(p.clazz.fullyQualifiedClassName);}}}});if(k==p.id){h+=o.html()+"<pre id='selectLine' style='color:red'>"+p.message+"</pre>";
}else{h+=o.html()+"<pre>"+p.message+"</pre>";}}i.html(h);c._detail();},error:function(){}});}},_bindFormValidation:function(){var a={rules:{},messages:{}};
FormUtils.bindFormValidation(GlLogRecord._CONS_.EDIT_FORM_ID,a);},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(GlLogRecord._CONS_.GRID,a);},_getManagerBtns:function(){var a=[];
a.push({lable:"查看详情",btnClasses:"btn-sm btn-outline btn btn-primary glLogRecordDetail",iconClasses:"fa fa-list"});return a;},_initJqgrid:function(b){if(b==null||typeof b==undefined){b={};
}var a=GlLogRecord._CONS_.LIST_DATA_URL;$(GlLogRecord._CONS_.GRID).JTJqgrid({url:a,pager:GlLogRecord._CONS_.PAGER,postData:b,multiselect:false,colNames:["记录保存时间","日志级别","日志信息","类名全名","方法名","行号","线程名","操作"],colModel:[{name:"createTime",index:"createTime",width:80,sortable:false},{name:"level",index:"level",width:60,sortable:false},{name:"message",index:"message",width:200,sortable:false,formatter:function(c,d,e){if(c.length>50){c=c.substring(0,40)+"......";
}return c;}},{name:"clazz.fullyQualifiedClassName",index:"clazz.fullyQualifiedClassName",width:230,sortable:false},{name:"method",index:"method",width:110,sortable:false},{name:"lineNumber",index:"lineNumber",width:30,sortable:false},{name:"thread",index:"thread",width:80,sortable:false},{name:"manage_",width:40,classes:"rowOps",sortable:false,align:"center",formatter:"manage",formatoptions:this._getManagerBtns()}]});
}};