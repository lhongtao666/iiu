function Report(){this.hadInit=false;this.isEdit=false;this.data=null;this.charObject=null;this.grid=null;this.barSeries={type:"bar",barCategoryGap:"20%"};
this.lineSeries={type:"line",smooth:false,symbol:null,barCategoryGap:"20%",barWidth:40};this.pieSeries={type:"pie",center:["70%","55%"],radius:[0,"50%"],clockWise:true};
this.toolbox={show:true,orient:"horizontal",x:"right",y:"top",showTitle:true,feature:{dataZoom:{show:false,title:{dataZoom:"区域缩放",dataZoomReset:"区域缩放-后退"}},magicType:{show:true,title:{line:"动态类型切换-折线图",bar:"动态类型切换-柱形图"},type:["line","bar"]},restore:{show:false,title:"还原",color:"black"},saveAsImage:{show:true,title:"保存为图片",type:"jpeg",lang:["点击本地保存"]}}};
this.legend={show:false,orient:"horizontal",x:"center",y:"top",data:[]};this.tooltip={show:true,position:function(a){return[a[0]+10,a[1]-10];},formatter:"{b}<br>{a} : {c}<br>"};
this.dataZoom={show:false};this.dataZoomShow=true;this.xAxis=null;this.yAxis=null;this.series=null;this.cates=null;this.seriesStyle={normal:{label:{show:false,position:"right",textStyle:{color:"#800080"}}}};
this.textStyle=null;}Report.prototype={setToolboxShow:function(a,b){if(a==false){this.toolbox.show=false;this.dataZoomShow=false;}else{this.toolbox.show=true;
if(b){if(b.dataZoomShow==false){this.toolbox.feature.dataZoom.show=false;this.dataZoomShow=false;}if(b.magicTypeShow==false){this.toolbox.feature.magicType.show=false;
}if(b.restoreShow==false){this.toolbox.feature.restore.show=false;}if(b.saveAsImageShow==false){this.toolbox.feature.saveAsImage.show=false;}}}},setLegend:function(isShow,dataNameArr,colName,position){if(isShow==false){this.legend.show=false;
}else{if(dataNameArr!=null&&dataNameArr!=undefined){this.legend.show=true;this.legend.data=dataNameArr;}else{if(colName!=null&&colName!=undefined){this.legend.show=true;
this.legend.data=[];for(var i=0;i<this.data.length;i++){this.legend.data[i]=eval("this.data[i]."+colName);}}else{this.legend.show=false;}}}if(position=="left"){this.legend.x="left";
this.legend.y="center";this.legend.orient="vertical";}else{if(position=="right"){this.legend.x="right";this.legend.y="center";this.legend.orient="vertical";
}}},setBarSeriesStyle:function(b,a,c){this.seriesStyle.normal.label.show=b;if(b==true){if(a){this.seriesStyle.normal.label.position=a;}if(c){this.seriesStyle.normal.label.formatter=c;
}}},setGridX:function(a){this.grid={x:a};},setGridXY:function(b,a){this.grid={x:b,y:a};},setAxis:function(dataColName,dataArr,type){if(!dataColName&&this.data==null&&!dataArr){return;
}var axisData=[];if(dataColName){for(var i=0;i<this.data.length;i++){if(this.cates!=null){var key=eval("this.data[i]."+dataColName);axisData[i]=this.getDataByCate(key);
}else{axisData[i]=eval("this.data[i]."+dataColName);}}}else{axisData=dataArr;}var axis1=[{type:"value",axisLabel:{show:true}}];var axis2=[{type:"category",axisLabel:{show:true},data:axisData}];
this.xAxis=axis2;this.yAxis=axis1;if(type=="transverse"){this.xAxis=axis1;this.yAxis=axis2;}},setXAxisInfo:function(a,b){this.xAxis[0].name=a;if(b){this.xAxis[0].axisLine=b;
}},setYAxisInfo:function(a,b){this.yAxis[0].name=a;if(b){this.yAxis[0].axisLine=b;}},getDataByCate:function(b){for(var a=0;a<this.cates.length;a++){if(b==this.cates[a].value){return this.cates[a].name;
}}},initSeries:function(seriesSet,axisColName,axisColArr,axisType){var self=this;if(seriesSet==null||seriesSet==undefined){return;}self.series=[];for(var i=0;
i<seriesSet.length;i++){var seriesData=[];if(seriesSet[i].colName){for(var j=0;j<this.data.length;j++){seriesData[j]={value:eval("this.data[j]."+seriesSet[i].colName)};
if(axisColName){if(this.cates!=null){var key=eval("this.data[j]."+axisColName);seriesData[j].name=this.getDataByCate(key);}else{seriesData[j].name=eval("this.data[j]."+axisColName);
}}}}else{for(var j=0;j<seriesSet[i].colNameArr.length;j++){seriesData[j]={value:eval("this.data[i]."+seriesSet[i].colNameArr[j])};if(axisColName){if(this.cates!=null){var key=eval("this.data[j]."+axisColName);
seriesData[j].name=this.getDataByCate(key);}else{seriesData[j].name=eval("this.data[j]."+axisColName);}}}}var blockInt=0;if(seriesSet[i].type=="line"){self.series[i-blockInt]=clone(self.lineSeries);
self.series[i-blockInt].itemStyle=self.seriesStyle;self.series[i-blockInt].name=seriesSet[i].legendName;self.series[i-blockInt].data=seriesData;}else{if(seriesSet[i].type=="bar"){self.series[i-blockInt]=clone(self.barSeries);
self.series[i-blockInt].itemStyle=self.seriesStyle;self.series[i-blockInt].name=seriesSet[i].legendName;self.series[i-blockInt].data=seriesData;}else{if(seriesSet[i].type=="pie"&&i==0){self.series[i-blockInt]=clone(self.pieSeries);
self.series[i-blockInt].name=seriesSet[i].legendName;self.series[i-blockInt].data=seriesData;break;}else{blockInt++;}}}}if(seriesSet[0].type!="pie"){self.setAxis(axisColName,axisColArr,axisType);
}else{self.toolbox.feature.magicType.show=false;}},_initChart:function(o,b,j){var p=this;if(p.xAxis==null&&p.yAxis==null&&this.series==null){return;}var i="left";
var d="top";if(p.series[0].type!="pie"){if(p.xAxis[0].data!=undefined&&p.xAxis[0].data!=null){var m=document.body.clientWidth-80;var n=m/p.xAxis[0].data.length;
var l=40;if(p.legend!=undefined&&p.legend!=null){if(p.legend.show==true){l=p.legend.data.length*40+(p.legend.data.length-1)*40*3/10+48;}}if(n<l&&p.dataZoomShow==true){p.dataZoom.show=true;
p.dataZoom.start=0;var g=Math.floor(m/l);p.dataZoom.end=Math.floor((g)/p.xAxis[0].data.length*100);}if(p.legend.data.length>1&&p.legend.show==true){if(p.dataZoom.show==true){for(var f=0;
f<p.series.length;f++){p.series[f].barCategoryGap="30%";}}else{var c=100-(p.legend.data.length*40+(p.legend.data.length-1)*40*3/10)*100/n;if(c<1){c=1;}var a=""+(c-1);
if(a.indexOf(".")>-1){a=a.substr(0,a.indexOf("."))+"%";}else{a=a+"%";}for(var f=0;f<p.series.length;f++){p.series[f].barCategoryGap=a;}}}}else{if(p.yAxis[0].data!=undefined&&p.yAxis[0].data!=null){for(var f=0;
f<p.series.length;f++){p.series[f].barWidth=20;}}}}else{if(p.legend!=undefined&&p.legend!=null){p.legend.x="left";p.legend.y="top";p.legend.orient="vertical";
}i="center";d="bottom";p.dataZoom=null;}p.charObject=echarts.init(document.getElementById(o),echartTheme);var e=["#2ec7c9","#b6a2de","#5ab1ef","#ED5565","#d87a80","#8d98b3","#408829","#1C84C6","#95706d","#dc69aa","#07a2a4","#9a7fd1","#588dd5","#f5994e","#c05050","#59678c","#c9ab00","#7eb00a","#6f5553","#c14089"];
if(j){e=j;}var h={color:e,backgroundColor:"transparent",title:{text:b,x:i,y:d,padding:10,textStyle:p.textStyle},toolbox:p.toolbox,legend:p.legend,tooltip:p.tooltip,dataZoom:p.dataZoom,xAxis:p.xAxis,yAxis:p.yAxis,series:p.series};
if(p.grid!=null){h.grid=p.grid;}p.charObject.setOption(h);},changeChart:function(){var a=this;var b=null;a.charObject.setSeries(b);},_bindEventHander:function(){var a=this;
$(document).on("check","#searchBtn",function(){a.changeChart();});}};function clone(d){var e;switch(typeof d){case"undefined":break;case"string":e=d+"";
break;case"number":e=d-0;break;case"boolean":e=d;break;case"object":if(d===null){e=null;}else{if(d instanceof Array){e=[];for(var c=0,a=d.length;c<a;c++){e.push(clone(d[c]));
}}else{e={};for(var b in d){e[b]=clone(d[b]);}}}break;default:e=d;break;}return e;}var ReportDateUtil={initDate:function(f,e){e=e||$(document);var a=new Date();
var c=a.getFullYear();var d=new StringBuffer();for(var b=2010;b<=c;b++){d.append("<option value='").append(b).append("' >").append(b).append("年</option>");
}e.find("select[name=yearSearch]").append(d.toString());this._bindEventHander(f,e);},_bindEventHander:function(b,a){a=a||$(document);a.find(b).off("change","#timeTypeSearch");
a.find(b).on("change","#timeTypeSearch",function(){var d=new Date();a.find("select[name=yearSearch]").val(d.getFullYear());if(a.find(this).val()=="day"){a.find(".yearElement").hide();
a.find(".quarterElement").hide();a.find(".monthElement").hide();a.find(".dayElement").show();a.find(".dayElementBtn").show();a.find(".weekElement").hide();
a.find("input[id=endDate]").val(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+" 23:59:59");a.find("input[id=beginDate]").val(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+" 00:00:00");
}else{if(a.find(this).val()=="month"){a.find(".yearElement").show();a.find(".quarterElement").hide();a.find(".monthElement").show();a.find(".dayElement").hide();
a.find(".dayElementBtn").hide();a.find(".weekElement").hide();a.find("select[name=monthSearch]").val(d.getMonth()+1);}else{if(a.find(this).val()=="quarter"){a.find(".yearElement").show();
a.find(".quarterElement").show();a.find(".monthElement").hide();a.find(".dayElement").hide();a.find(".dayElementBtn").hide();a.find(".weekElement").hide();
a.find("select[name=quarterSearch]").val(parseInt((d.getMonth()+1)/3)+((d.getMonth()+1)%3>0?1:0));}else{if(a.find(this).val()=="year"){a.find(".yearElement").show();
a.find(".quarterElement").hide();a.find(".monthElement").hide();a.find(".dayElement").hide();a.find(".dayElementBtn").hide();a.find(".weekElement").hide();
}else{if(a.find(this).val()=="week"){a.find(".yearElement").hide();a.find(".quarterElement").hide();a.find(".monthElement").hide();a.find(".dayElement").show();
a.find(".dayElementBtn").hide();a.find(".weekElement").show();var e=d.getTime();var c=new Date(e-7*24*3600*1000);a.find("input[id=beginDate]").val(c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate());
a.find("input[id=endDate]").val(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate());}}}}}});a.find(b).off("click","#prevBtn");a.find(b).on("click","#prevBtn",function(){var c=new Date(a.find("input[id=beginDate]").val());
var d=new Date(a.find("input[id=endDate]").val());c.setDate(c.getDate()-1);d.setDate(d.getDate()-1);a.find("input[id=beginDate]").val(c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()+" 00:00:00");
a.find("input[id=endDate]").val(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+" 23:59:59");});a.find(b).off("click","#nextBtn");a.find(b).on("click","#nextBtn",function(){var c=new Date(a.find("input[id=beginDate]").val());
var d=new Date(a.find("input[id=endDate]").val());c.setDate(c.getDate()+1);d.setDate(d.getDate()+1);a.find("input[id=beginDate]").val(c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()+" 00:00:00");
a.find("input[id=endDate]").val(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+" 23:59:59");});a.find(b).off("click","#prevWeekBtn");a.find(b).on("click","#prevWeekBtn",function(){var c=new Date(a.find("input[id=beginDate]").val());
var d=new Date(a.find("input[id=endDate]").val());c.setDate(c.getDate()-7);d.setDate(d.getDate()-7);a.find("input[id=beginDate]").val(c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate());
a.find("input[id=endDate]").val(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate());});a.find(b).off("click","#nextWeekBtn");a.find(b).on("click","#nextWeekBtn",function(){var c=new Date(a.find("input[id=beginDate]").val());
var d=new Date(a.find("input[id=endDate]").val());c.setDate(c.getDate()+7);d.setDate(d.getDate()+7);a.find("input[id=beginDate]").val(c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate());
a.find("input[id=endDate]").val(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate());});},getDateTimeRangeStr:function(b){b=b||$(document);var a=new StringBuffer();
if(b.find("#timeTypeSearch").val()=="day"){if(b.find("#beginDate").val()!=""){a.append(b.find("#beginDate").val()).append(",");}else{a.append(",");}if(b.find("#endDate").val()!=""){a.append(b.find("#endDate").val());
}}else{if(b.find("#timeTypeSearch").val()=="week"){if(b.find("#beginDate").val()!=""){a.append(b.find("#beginDate").val()).append(" 00:00:00,");}else{a.append(",");
}if(b.find("#endDate").val()!=""){a.append(b.find("#endDate").val()).append(" 23:59:59");}}else{if(b.find("#timeTypeSearch").val()=="month"){a.append(DateUtils.format(DateUtils.getMonthFirst(b.find("#yearSearch").val(),b.find("#monthSearch").val()),DateUtils._CONS_.DEFAULT_DATE_TIME_PATTERN)).append(",").append(DateUtils.format(DateUtils.getMonthLast(b.find("#yearSearch").val(),b.find("#monthSearch").val()),DateUtils._CONS_.DEFAULT_DATE_TIME_PATTERN));
}else{if(b.find("#timeTypeSearch").val()=="quarter"){a.append(DateUtils.format(DateUtils.getQuarterFirst(b.find("#yearSearch").val(),parseInt(b.find("#quarterSearch").val())),DateUtils._CONS_.DEFAULT_DATE_TIME_PATTERN)).append(",").append(DateUtils.format(DateUtils.getQuarterLast(b.find("#yearSearch").val(),parseInt(b.find("#quarterSearch").val())),DateUtils._CONS_.DEFAULT_DATE_TIME_PATTERN));
}else{if(b.find("#timeTypeSearch").val()=="year"){a.append(DateUtils.format(DateUtils.getYearFirst(b.find("#yearSearch").val()),DateUtils._CONS_.DEFAULT_DATE_TIME_PATTERN)).append(",").append(DateUtils.format(DateUtils.getYearLast(b.find("#yearSearch").val()),DateUtils._CONS_.DEFAULT_DATE_TIME_PATTERN));
}}}}}return a.toString();},getEndDateTimeRangeStr:function(b){b=b||$(document);var a=new StringBuffer();if(b.find("#timeTypeSearch").val()=="day"){if(b.find("#endDate").val()!=""){a.append(b.find("#endDate").val());
}}else{if(b.find("#timeTypeSearch").val()=="month"){a.append(DateUtils.format(DateUtils.getMonthLast(b.find("#yearSearch").val(),b.find("#monthSearch").val()),DateUtils._CONS_.DEFAULT_DATE_PATTERN));
}else{if(b.find("#timeTypeSearch").val()=="quarter"){a.append(DateUtils.format(DateUtils.getQuarterLast(b.find("#yearSearch").val(),parseInt(b.find("#quarterSearch").val())),DateUtils._CONS_.DEFAULT_DATE_PATTERN));
}else{if(b.find("#timeTypeSearch").val()=="year"){a.append(DateUtils.format(DateUtils.getYearLast(b.find("#yearSearch").val()),DateUtils._CONS_.DEFAULT_DATE_PATTERN));
}}}}return a.toString();},getStartDateTimeRangeStr:function(b){b=b||$(document);var a=new StringBuffer();if(b.find("#timeTypeSearch").val()=="day"){if(b.find("#beginDate").val()!=""){a.append(b.find("#beginDate").val());
}}else{if(b.find("#timeTypeSearch").val()=="month"){a.append(DateUtils.format(DateUtils.getMonthFirst(b.find("#yearSearch").val(),b.find("#monthSearch").val()),DateUtils._CONS_.DEFAULT_DATE_PATTERN));
}else{if(b.find("#timeTypeSearch").val()=="quarter"){a.append(DateUtils.format(DateUtils.getQuarterFirst(b.find("#yearSearch").val(),parseInt(b.find("#quarterSearch").val())),DateUtils._CONS_.DEFAULT_DATE_PATTERN));
}else{if(b.find("#timeTypeSearch").val()=="year"){a.append(DateUtils.format(DateUtils.getYearFirst(b.find("#yearSearch").val()),DateUtils._CONS_.DEFAULT_DATE_PATTERN));
}}}}return a.toString();},getDateRangeStr:function(c){c=c||$(document);var b=new StringBuffer();if(c.find("#timeTypeSearch").val()=="day"){if(c.find("#beginDate").val()!=""){var a=c.find("#beginDate").val();
b.append(a.substring(0,4));a=a.substring(5,a.length);if(a.indexOf("-")<2){b.append("0");}b.append(a.replaceAll("-",""));}b.append(",");if(c.find("#endDate").val()!=""){var a=c.find("#endDate").val();
b.append(a.substring(0,4));a=a.substring(5,a.length);if(a.indexOf("-")<2){b.append("0");}b.append(a.replaceAll("-",""));}}else{if(c.find("#timeTypeSearch").val()=="month"){var a=DateUtils.format(DateUtils.getMonthFirst(c.find("#yearSearch").val(),c.find("#monthSearch").val()),"yyyy-MM-dd");
b.append(a.substring(0,4));a=a.substring(5,a.length);if(a.indexOf("-")<2){b.append("0");}b.append(a.replaceAll("-","")).append(",");a=DateUtils.format(DateUtils.getMonthLast(c.find("#yearSearch").val(),c.find("#monthSearch").val()),"yyyy-MM-dd");
b.append(a.substring(0,4));a=a.substring(5,a.length);if(a.indexOf("-")<2){b.append("0");}b.append(a.replaceAll("-",""));}else{if(c.find("#timeTypeSearch").val()=="quarter"){var a=DateUtils.format(DateUtils.getQuarterFirst(c.find("#yearSearch").val(),parseInt(c.find("#quarterSearch").val())),"yyyy-MM-dd");
b.append(a.substring(0,4));a=a.substring(5,a.length);if(a.indexOf("-")<2){b.append("0");}b.append(a.replaceAll("-","")).append(",");a=DateUtils.format(DateUtils.getQuarterLast(c.find("#yearSearch").val(),parseInt(c.find("#quarterSearch").val())),"yyyy-MM-dd");
b.append(a.substring(0,4));a=a.substring(5,a.length);if(a.indexOf("-")<2){b.append("0");}b.append(a.replaceAll("-",""));}else{if(c.find("#timeTypeSearch").val()=="year"){var a=DateUtils.format(DateUtils.getYearFirst(c.find("#yearSearch").val()),"yyyy-MM-dd");
b.append(a.substring(0,4));a=a.substring(5,a.length);if(a.indexOf("-")<2){b.append("0");}b.append(a.replaceAll("-","")).append(",");a=DateUtils.format(DateUtils.getYearLast(c.find("#yearSearch").val()),"yyyy-MM-dd");
b.append(a.substring(0,4));a=a.substring(5,a.length);if(a.indexOf("-")<2){b.append("0");}b.append(a.replaceAll("-",""));}}}}return b.toString();}};var SelectProdService={selectSku:function(o){var n=o&&o.storeId;
var f=o.isMultiple;var k=o.type;var m=o.hasStock;var e=o.canSale;var b=o.hideCanSale;var j=o.isSale;var d=o.limitProdCate;var i=o.priceType;var h=o.userId;
var l=o.showNotOnSale;var g=o.filterSeries;var c=o.agentId;if(!m){m="n";}if(!k){k="product";}if(!n){n="";}if(!b){b="n";}if(!d){d="n";}if(!j){j="n";}if(!i){i="";
}if(!e){e="n";}if(!l){l="n";}if(!c){c="";}var a=ctx+"/ec/product/prodEntity/selectSku.htm?";a+="storeId="+n;a+="&isMultiple="+f;a+="&type="+k;a+="&hasStock="+m;
a+="&hideCanSale="+b;a+="&limitProdCate="+d;a+="&priceType="+i;a+="&canSale="+e;a+="&isSale="+j;a+="&userId="+h;a+="&showNotOnSale="+l;a+="&filterSeries="+g;
a+="&agentId="+c;layer.open({type:2,title:"选择商品",maxmin:true,shadeClose:true,btn:["确定","取消"],area:["95%","95%"],scrollbar:false,maxmin:false,content:a,yes:function(q,p){var s=layer.getChildFrame("body",q);
var r=$("#selectedRowData",s).val();if(r&&r.length){layer.close(q);if(o.fn){o.fn(JSON.parse(r));}}else{DialogUtils.error("警告","请选择商品！或者点击取消",s);}},end:function(){if(o.end){o.end();
}}});},selectProd:function(a){var b=a.isMultiple;layer.open({type:2,title:"选择商品",shadeClose:true,btn:["确定","取消"],area:["80%","80%"],scrollbar:false,content:ctx+"/ec/product/prodEntity/selectProd.htm?isMultiple="+b,yes:function(e,c){var j=layer.getChildFrame("body",e);
var d=$("#prodEntityGrid",j).jqGrid("getGridParam","selarrrow");if(d){var h=[];for(var f=0;f<d.length;f++){var g=$("#prodEntityGrid",j).jqGrid("getRowData",d[f]);
g.prodId=d[f];g.prodName=g.name;h.push(g);}layer.close(e);if(a.fn){a.fn(h);}}}});}};var StoreUtils={loadStores:function(f,a,e,c){var b=this;var d={selectedStore:f,container:a,isSale:e,notShowStore:c};
b.loadData(d);},loadData:function(e){var b=this;var a=ctx+"/ec/stock/stStore/listStores.htm";var d=e.isSale;if(d){a+="?isSale=y";}var c=window.sessionStorage.getItem("loacalstores"+(d?"isSale":""));
if(c&&c!=null&&c!=""){b._apendData(e,JSON.parse(c));}else{FormUtils.loadData(a,function(f){window.sessionStorage.setItem("loacalstores"+(d?"isSale":""),JSON.stringify(f));
b._apendData(e,f);});}},_apendData:function(d,j){var k=d.callBackFunc?d.callBackFunc:null;var f=d.selectedStore?d.selectedStore:null;var a=d.container;
var g=d.notShowStore?d.notShowStore:null;var b=isManyStore?isManyStore:"y";var h=new StringBuffer();if(b=="y"){h.append("<option value=''>请选择仓库</option>");
}for(var e=0;e<j.length;e++){if(g&&j[e].id==g){continue;}if(b=="n"){if(j[e].isDefault=="y"){h.append("<option selected='selected' value='"+j[e].id+"'>"+j[e].name+"</option>");
}}else{if(j[e].id==f){h.append("<option selected='selected' value='"+j[e].id+"'>"+j[e].name+"</option>");}else{h.append("<option value='"+j[e].id+"'>"+j[e].name+"</option>");
}}}var c=$("#"+a);if(!c.length){c=$("."+a);}c.empty().append(h.toString());if(b=="n"){c.trigger("change");}if(k&&typeof(k)=="function"){k(j);}},loadSimpleStores:function(a){return StoreUtils.loadStores("",a.container);
}};var TaskUtils={loadTypeOption:function(a){a.typeKey="com.jt.gl.task.constants.TaskType";return EnumUtils.getEnumOptions(a);},loadStatusOption:function(a){a.typeKey="com.jt.gl.task.constants.TaskStatus";
return EnumUtils.getEnumOptions(a);},dealTaskName:function(b){var a="";if(b.type=="jt_so_entity"){a=TaskUtils._dealSoEntity(b.name);}else{if(b.type=="jt_cs_follow"){a=TaskUtils._dealFollowEntity(b.name);
}else{if(b.type=="jt_so_follow"){a=TaskUtils._dealSoFollowEntity(b.name);}else{if(b.type=="jt_gl_sms"){a=TaskUtils._dealSmsEntity(b.name);}else{a=b.name;
}}}}return a;},_bindEventHandler:function(){var j=this;var a=ctx+"/ec/salesorder/soEntity/detail.htm";var d=ctx+"/crm/cs/csEntity/detail.htm";var h=ctx+"/crm/cs/csEntity/getCsByCode.htm";
var k=ctx+"/ec/salesorder/soEntity/getBySoNo.htm";var b=ctx+"/ec/salesorder/soEntity/place.htm";$(document).on("click",".openCsDetail",function(m){if(!ResUtils.canShow("csEntity.button.editTask")){return;
}var n=$(this).attr("csName");var l=$(this).attr("csCode");if(!l){DialogUtils.error("错误","客户编号为空,无法找到该客户");return;}FormUtils.submit(h,{csCode:l},function(o){if(!$.isEmptyObject(o)){var p=o.id;
JTTabUtils.addOrRefreshTab(d+"?csId="+p+"&type=task","客户["+n+"]明细");}else{DialogUtils.error("错误","没有找到客户,可能已被删除,请通过客户查询查找客户");}});m.preventDefault();m.stopPropagation();
});$(document).on("click",".openCsDetail2",function(m){if(!ResUtils.canShow("csEntity.button.editTask")){return;}var n=$(this).attr("csName");var l=$(this).attr("csCode");
if(!l){DialogUtils.error("错误","客户编号为空,无法找到该客户");return;}FormUtils.submit(h,{csCode:l},function(o){if(!$.isEmptyObject(o)){var p=o.id;JTTabUtils.addOrRefreshTab(d+"?csId="+p+"&type=task","客户["+n+"]明细");
}else{DialogUtils.error("错误","没有找到客户,可能已被删除,请通过客户查询查找客户");}});m.preventDefault();m.stopPropagation();});var f=ctx+"/ec/salesorder/soEntity/detail.htm";
var i=ctx+"/ec/salesorder/soEntity/place.htm";var g=ctx+"/ec/salesorder/soEntity/comfirm/comfirm.htm";var c=ctx+"/ec/salesorder/soEntity/toFollow.htm";
var e=ctx+"/ec/salesorder/soEntity/place.htm";$(document).on("click",".openSoDetail2",function(m){var l=$(this).attr("soNo");var n=l;if(l.length>4){n="*"+l.substring(l.length-3,l.length);
}if(enableTaskSoStatusFilter&&enableTaskSoStatusFilter=="y"){FormUtils.submit(k,{soNo:l},function(o){if(!$.isEmptyObject(o)){var r=o.id;var p=o.status;
var q=o.placerId;var s=o.soType;if("awaiting_post"==p){JTTabUtils.addOrRefreshTab(e+"?soId="+r+"&type=self","订单["+l+"]提交");}else{if("awaiting_comfirm"==p&&ResUtils.canShow("soEntityComfirm.url")){JTTabUtils.addOrRefreshTab(g+"?soId="+r+"&type=self","订单["+l+"审核");
}else{if("shipping"==p&&ResUtils.canShow("soEntity.url")){JTTabUtils.addOrRefreshTab(c+"?soId="+r+"&soNo="+l,"订单["+l+"]跟进");}else{JTTabUtils.addOrRefreshTab(a+"?soNo="+l,"订单["+n+"]明细");
}}}}else{DialogUtils.error("错误","没有找到订单,可能已被删除,请通过订单查询查找订单");}});}else{FormUtils.submit(k,{soNo:l},function(o){if(!$.isEmptyObject(o)){JTTabUtils.addOrRefreshTab(a+"?soNo="+l,"订单["+n+"]明细");
}else{DialogUtils.error("错误","没有找到订单,可能已被删除,请通过订单查询查找订单");}});}m.preventDefault();m.stopPropagation();});$(document).on("click",".openSoDetail",function(m){var l=$(this).attr("soNo");
var n=l;if(l.length>4){n="*"+l.substring(l.length-3,l.length);}FormUtils.submit(k,{soNo:l},function(o){if(!$.isEmptyObject(o)){JTTabUtils.addOrRefreshTab(a+"?soNo="+l,"订单["+n+"]明细");
}else{DialogUtils.error("错误","没有找到订单,可能已被删除,请通过订单查询查找订单");}});m.preventDefault();m.stopPropagation();});},_dealFollowEntity:function(b){var a="";a=b.replace(/\d{3,12}:/g,function(d){var c=d.substring(0,d.length-1);
var f=c;var e=new StringBuffer();e.append('<a href="javascript:void(0);" title="'+f+'" csCode="'+c+'" csName="'+f+'" class="openCsDetail2">');e.append(f);
e.append("</a>");e.append(":");return e.toString();});a="【客户跟进】"+a;return a;},_dealSoFollowEntity:function(b){var a="";a=b.replace(/\d{3,12}：\(/g,function(e){var d=e.substring(0,e.length-2);
var c=d;var f=new StringBuffer();f.append('<a  href="javascript:void(0);" title="'+c+'" soNo="'+d+'" soNoName="'+c+'" class="openSoDetail2">');f.append(c);
f.append("</a>");f.append("：(");return f.toString();});a="【订单跟进】"+a;return a;},_dealSmsEntity:function(b){var a="";a=b.replace(/\d{3,12}:/g,function(d){var c=d.substring(0,d.length-1);
var f=c;var e=new StringBuffer();e.append('<a  href="javascript:void(0);" title="'+f+'" csCode="'+c+'" csName="'+f+'" class="openCsDetail2">');e.append(f);
e.append("</a>");e.append(":");return e.toString();});a="【发送短信】"+a;return a;},_dealSoEntity:function(b){var a="";a=b.replace(/客户【.+】/,function(f){var c=f.substring(3,f.length-1);
var h=c.split("(")[0];var e=c.split("(")[1];var d=e.substring(0,e.length-1);var g=new StringBuffer();g.append(f.substring(0,3));g.append('<a  href="javascript:void(0);" title="'+h+'" csCode="'+d+'" csName="'+h+'" class="openCsDetail">');
g.append(h);g.append("</a>");g.append(f.substring(f.length-1,f.length));return g.toString();});a=a.replace(/订单【.{1,14}】/,function(d){var c=d.substring(3,d.length-1);
var e=new StringBuffer();e.append(d.substring(0,3));e.append('<a  href="javascript:void(0);" onclick="" title="'+c+'" soNo="'+c+'" class="openSoDetail">');
e.append(c);e.append("</a>");e.append(d.substring(d.length-1,d.length));return e.toString();});return a;}};var GroupUtils={loadGroupOptions:function(a){a.url=ctx+"/gl/ou/group/listData.htm";
if(!a.positionType){a.url=a.url+"?type=dept_manager";}a.key="id";a.keyName="name";a.caption="请选择部门";return OptionsBaseUtils.getOptions(a);},selectGroupTreeBox:function(a){var b={selectedIds:jQuery.isArray(a.selectedGroupId)?a.selectedGroupId.toString():a.selectedGroupId,container:a.container,treeId:"menuContentForGroup"+a.container.split(" ")[0],isMultiple:a.isMultiple,otherParam:{selectedGroupId:a.selectedGroupId},url:ctx+"/gl/ou/group/listData.htm",fn:a.fn,isSale:a.isSale,positionType:a.positionType,hideSale:a.hideSale?a.hideSale:false,isSmsConfigHtml:a.isSmsConfigHtml,isReDisabled:a.isReDisabled?a.isReDisabled:false};
if(a.isEqWidth){b.isEqWidth=true;}if(a.isAutoHeight){b.isAutoHeight=true;}if(!b.positionType){b.url=b.url+"?type=dept_manager";}else{b.url=b.url+"?type="+b.positionType;
}if(a.isSale){b.url=b.url+"?type="+b.positionType+"&isSale=y";}if(a.agentId){b.url=b.url+"&agentId="+a.agentId;}b.dataFilter=function(f,c,g){if(g&&g.length){for(var e=0;
e<g.length;e++){var d=g[e];if(d.isSale=="y"&&!b.hideSale){d.name=d.name+"【销】";d.font={"color":"red"};}}}if(a.dataFilter){return a.dataFilter(f,c,g);}else{return g;
}};CateUtils.selectTreeBox(b);},selectGroup:function(c){var e=c.selectedGroupId?c.selectedGroupId:"";var d=c.hasOwnProperty("isMultiple")&&c.isMultiple;
var a=this;var b=ctx+"/gl/ou/group/listData.htm";if(!c.positionType){b+="?type=dept_manager";}if(jQuery.isArray(e)){e=e.toString();}layer.open({type:1,title:"选择部门",shadeClose:false,btn:["确定","关闭"],area:["70%","70%"],scrollbar:false,maxmin:false,content:'<ul id="organizationSelTree" class="ztree" style="width:260px; overflow:auto;"></ul>',success:function(f,i){var g=this;
var j={async:{enable:true,url:b,contentType:"application/json",dataType:"json",type:"get",autoParam:["id"],otherParam:{selectedGroupId:e},dataFilter:function(n,k,o){if(o&&o.length){for(var m=0;
m<o.length;m++){var l=o[m];if(l.isSale=="y"){l.name=l.name+"【销】";l.font={"color":"red"};}}}return o;},},data:{simpleData:{enable:true,idKey:"id",pIdKey:"parentId"}},check:{enable:true,chkStyle:d?"checkbox":"radio",chkboxType:{"Y":"s","N":"s"},radioType:"all"},callback:{onClick:function h(l,o,n){var m=n.getCheckStatus().checked;
var k=$.fn.zTree.getZTreeObj("organizationSelTree");k.checkNode(n,!m,false);},onAsyncSuccess:function(m,o,n,p){var l=$.fn.zTree.getZTreeObj("organizationSelTree");
if(!n){var k=l.getNodes()[0];l.expandNode(k,true,false,true);}}}};$.fn.zTree.init($("#organizationSelTree"),j);},yes:function(j,g){var h=$.fn.zTree.getZTreeObj("organizationSelTree");
var f=h.getCheckedNodes(true);var l=[];for(var k=0;k<f.length;k++){var m={id:f[k].id,name:f[k].name};l.push(m);}if(c.fn){c.fn(l);}layer.close(j);}});}};
var FinanceAccountSelect={initSelect:function(c,b,a){$.ajax({type:"GET",url:ctx+"/ec/finance/financeAcount/listPo.htm",contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(f){if(f!=null&&f!=""){var d=document.getElementById(c);
d.options.length=0;for(var e=0;e<f.length;e++){d.options.add(new Option(f[e].account+"("+f[e].name+")",f[e].account));if(f[e].account==b){d.options[d.options.length-1].selected="selected";
}}}if(a){a();}},error:function(d){alert(d);}});},initSelectActived:function(c,b,a){$.ajax({type:"GET",url:ctx+"/ec/finance/financeAcount/listPo.htm?Q__S__EQ__status_=actived",contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(e){if(e!=null&&e!=""){var f=new StringBuffer();
f.append("<option value=''>请选择</option>");for(var d=0;d<e.length;d++){f.append("<option attr-type='"+e[d].accountType+"' value='"+e[d].account+"'");if(e[d].account==b){f.append("selected=selected");
}f.append(">"+e[d].account+"（"+e[d].name+"）"+"</option>");}$("#"+c).empty().append(f.toString());}if(a){a();}},error:function(d){alert(d);}});},initSelectType:function(c,b){var a=ctx+"/ec/finance/financeAcount/listPo.htm?Q__S__EQ__status_=actived";
if(c.accountType){a+="&Q__S__EQ__account_type_="+c.accountType;}$.ajax({type:"GET",url:a,contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(f){var d=document.getElementById(c.selectId);
d.options.length=0;if(f!=null&&f!=""){for(var e=0;e<f.length;e++){d.options.add(new Option(f[e].account+"("+f[e].name+")",f[e].account));if(f[e].account==c.selectedValue){d.options[d.options.length-1].selected="selected";
}}}if(b){b();}},error:function(d){alert(d);}});},initSelectIsUsed:function(c,b,a){$.ajax({type:"GET",url:ctx+"/ec/finance/financeAcount/listPo.htm",contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(f){if(f!=null&&f!=""){var d=document.getElementById(c);
d.options.length=0;for(var e=0;e<f.length;e++){if(f[e].isUsed=="y"){d.options.add(new Option(f[e].name,f[e].account));if(f[e].account==b){d.options[d.options.length-1].selected="selected";
}}}}if(a){a();}},error:function(d){alert(d);}});}};var ShipInfoUtil={getShipStatusName:function(a){var b=a;if("0"==a){b="在途";}else{if("1"==a){b="揽件";}else{if("2"==a){b="疑难";
}else{if("3"==a){b="签收";}else{if("4"==a){b="退签";}else{if("5"==a){b="派件";}else{if("6"==a){b="退回";}else{if("-1"==a){b="查不到快递公司编码";}}}}}}}}return b;},getLastShipInfo:function(b){var c="";
if(b){var a=b.split("<br>");if(a.length>1){c=a[a.length-2];}else{c=a[0];}}return c;}};$(function(){var a=new SysMain();a.init();});function SysMain(){this.datas=[];
}SysMain._CONS_={LOAD_DATA_URL:ctx+"/gl/desktop/desktopColumn/loadDesktopColumnData.htm"};SysMain.prototype={init:function(){this._loadDesktopConfig();
this._bindEventHandler();},_ajaxLoadDesktopTab:function(){$("#desktopConfigContainer").find(".desktopTab").each(function(){var a=$(this);var b=ctx+$(this).attr("srcVal");
if(b.indexOf("?")!=-1){b+="&currentPositionId="+$("#changePostion").val();}else{b+="?currentPositionId="+$("#changePostion").val();}FormUtils.loadData(b,function(c){a.empty().append(c.msg);
},function(){},true);});},_bindEventHandler:function(){var a=this;$(document).on("click",".showMore",function(){JTTabUtils.addOrRefreshTab(ctx+$(this).attr("urlVal"),$(this).attr("nameVal"));
});$("body").on("change","#changedesktop",function(){var b=$(this).val();for(var c=0;c<a.datas.length;c++){if(a.datas[c].roleId==b){var d=$(a.datas[c].viewCode);
$("#desktopConfigContainer").empty().append(d);a._ajaxLoadDesktopTab();return;}}});$("body").on("change","#changePostion",function(){a._ajaxLoadDesktopTab();
});},_loadDesktopConfig:function(){var a=this;FormUtils.loadData(ctx+"/gl/desktop/desktopConfig/getUserDesktop.htm",function(d){if(d.success){a.datas=JSON.parse(d.msg);
length=a.datas.length;if(length>0){var c="<label "+(length==1?"style='display:none;'":"")+">角色</label><select "+(length==1?"style='display:none;'":"")+"id='changedesktop'>";
for(var b=0;b<a.datas.length;b++){if("y"==a.datas[b].isDefault){c+="<option value='"+a.datas[b].roleId+"' selected>"+a.datas[b].roleName+"</postion>";$("#desktopConfigContainer").empty().append(a.datas[b].viewCode);
}else{c+="<option value='"+a.datas[b].roleId+"'>"+a.datas[b].roleName+"</postion>";}}c+="</select>";}a._ajaxLoadDesktopTab();}});},};function JTCalendar(a){this.$container=".jt-calendar";
}JTCalendar.prototype={init:function(){var a=this;a._loadConainer();a._loadTime();a._loadDay();a.intervalId=setInterval(function(){a._loadTime();},1000);
a.intervalIdDay=setInterval(function(){a._loadDay();},60000*60);},_loadConainer:function(){var a=this;var b=new StringBuffer();b.append("<div class='hourMinuteSecond' style='font-size: 42px;line-height: 45px;font-weight: 600;text-align:center;color:#fff;'>").append("<span class='timeHour'></span>&nbsp;").append("<span class='blink'>:</span>").append("&nbsp;<span class='timeMinute'></span>").append("</div>").append("<div class='week' style='text-align: center;'></div>").append("<div class='lunarYearToDate' style='text-align: center;'></div>");
$(a.$container).empty().append(b.toString());},_loadTime:function(){$(this.$container).find(".timeMinute").text(DateUtils.format(new Date(),"mm"));$(this.$container).find(".timeHour").text(DateUtils.format(new Date(),"HH"));
},_loadDay:function(){var a=this;var b=new Date();$(this.$container).find(".week").text(DateUtils.format(new Date(),"yyyy-MM-dd")+" "+DateUtils.getChineseWeeks());
$(this.$container).find(".lunarYearToDate").text(a._getCNDate());},_getCNDate:function(){var o=this;var l=new Array(100);var y=new Array(12);var e="甲乙丙丁戊己庚辛壬癸";
var i="子丑寅卯辰巳午未申酉戌亥";var f="一二三四五六七八九十";var b="正二三四五六七八九十冬腊";var v="日一二三四五六";var p="鼠牛虎兔龙蛇马羊猴鸡狗猪";var z,d,x,c;l=new Array(2635,333387,1701,1748,267701,694,2391,133423,1175,396438,3402,3749,331177,1453,694,201326,2350,465197,3221,3402,400202,2901,1386,267611,605,2349,137515,2709,464533,1738,2901,330421,1242,2651,199255,1323,529706,3733,1706,398762,2741,1206,267438,2647,1318,204070,3477,461653,1386,2413,330077,1197,2637,268877,3365,531109,2900,2922,398042,2395,1179,267415,2635,661067,1701,1748,398772,2742,2391,330031,1175,1611,200010,3749,527717,1452,2742,332397,2350,3222,268949,3402,3493,133973,1386,464219,605,2349,334123,2709,2890,267946,2773,592565,1210,2651,395863,1323,2707,265877);
y[0]=0;y[1]=31;y[2]=59;y[3]=90;y[4]=120;y[5]=151;y[6]=181;y[7]=212;y[8]=243;y[9]=273;y[10]=304;y[11]=334;var a=new Date();var j=new Date();var r=j.getFullYear();
var w=j.getMonth()+1;var h=j.getDate();var B=j.getDay();var t=parseInt(j.getTime()/1000);if(r<1921||r>2020){return"";}else{w=(parseInt(w)>0)?(w-1):11;c=(arguments.length!=3)?new Date():new Date(arguments[0],arguments[1],arguments[2]);
var C,s,q,u;var g=false;var A=c.getYear();if(A<1900){A+=1900;}C=(A-1921)*365+Math.floor((A-1921)/4)+y[c.getMonth()]+c.getDate()-38;if(c.getYear()%4==0&&c.getMonth()>1){C++;
}for(s=0;;s++){u=(l[s]<4095)?11:12;for(q=u;q>=0;q--){if(C<=29+o._getBit(l[s],q)){g=true;break;}C=C-29-o._getBit(l[s],q);}if(g){break;}}z=1921+s;d=u-q+1;
x=C;if(u==12){if(d==Math.floor(l[s]/65536)+1){d=1-d;}if(d>Math.floor(l[s]/65536)+1){d--;}}var A="";A+=e.charAt((z-4)%10);A+=i.charAt((z-4)%12);A+="(";A+=p.charAt((z-4)%12);
A+=")年 ";if(d<1){A+="(闰)";A+=b.charAt(-d-1);}else{A+=b.charAt(d-1);}A+="月";A+=(x<11)?"初":((x<20)?"十":((x<30)?"廿":"三十"));if(x%10!=0||x==10){A+=f.charAt((x-1)%10);
}return A;}},_getBit:function(a,b){return(a>>b)&1;}};var SoEntityUtils={formatStatus:function(e){var b="";var a=e.status;var d=e.delayConfirmTime;var c=e.delayShipTime;
if(a=="awaiting_pay"){b="待支付";}else{if(a=="awaiting_post"){b="待提交";}else{if(a=="awaiting_comfirm"){if(d!=null){b="待审核"+"<span style='color:red;font-size: 8px;'>[延审]</span>";
}else{b="待审核";}}else{if(a=="comfirm"){if(c!=null){b="待发货"+"<span style='color:red;font-size: 8px;'>[延发]</span>";}else{b="待发货";}}else{if(a=="shipping"){b="已发货";
}else{if(a=="complete"){b="已签收";}else{if(a=="close"){b="已作废";}else{if(a=="close_reject"){b="已拒收";}else{if(a=="close_lost"){b="已丢失";}}}}}}}}}return b;},formatCashType:function(b){var a="";
if(b=="pay"){a="款到发货";}else{if(b=="pay_sub"){a="支付订金";}else{if(b=="green"){a="绿色通道";}else{if(b=="green_by"){a="绿色通道订金";}else{if(b=="cod"){a="货到付款";}else{if(b=="free"){a="免费已付";
}else{if(b=="point"){a="积分付款";}}}}}}}return a;},formatPayType:function(b){var a="";if(b=="alipay"){a="支付宝";}else{if(b=="weixin"){a="微信支付";}else{if(b=="weixinhongbao"){a="微信红包";
}else{if(b=="bank"){a="银行转账";}else{if(b=="cash"){a="现金支付";}else{if(b=="point"){a="积分支付";}}}}}}return a;},getTurnBackStr:function(b,a){var c="";switch(b){case"awaiting_post":if(!(a==null||a==""||a=="awaiting_post")){c="&nbsp;<span style='color:red'>撤</span>";
}break;case"awaiting_comfirm":if(!(a=="awaiting_post"||a=="awaiting_comfirm")){c="&nbsp;<span style='color:red'>撤</span>";}break;case"comfirm":if(!(a=="awaiting_post"||a=="awaiting_comfirm"||a=="awaiting_pay"||a=="comfirm")){c="&nbsp;<span style='color:red'>撤</span>";
}break;}return c;},confirm:function(b,a){window.localStorage.setItem("comfirm_"+currentUserId,b.toString());JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.SO_TO_COMFIRM_URL+"?soId="+b[0],"订单["+a+"审核");
},toDeliver:function(a){window.localStorage.setItem("deliver_"+currentUserId,JSON.stringify(a));ConfigUtils.findByKey("soEntity.isEditSaveSo",function(b){if(b.success&&ResUtils.canShow("soEntity.button.saveSoComfirmBtn")){JTTabUtils.addOrRefreshTab(ctx+"/ec/salesorder/soEntity/waitToDeliver.htm?soId="+a[0].id,"订单["+a[0].soNo+"发货");
}else{JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.SO_TO_DELIVER_URL+"?soId="+a[0].id,"订单["+a[0].soNo+"发货");}});},backDeliver:function(b,a){DialogUtils.confirmWithOptions({title:"确定撤销发货吗？",text:"",confirmButtonText:"确认",yesFunc:function(){var c=SoEntityUtils._CONS_.BACK_DELIVER_URL;
FormUtils.submit(c,{ids:b},function(d){if(d.success){DialogUtils.success(msgCode.INFO,"撤销发货成功");if(a&&typeof(a)=="function"){a();}}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}});},confirmBatch:function(d,c,b){var a=SoEntityUtils._CONS_.COMFIRM_BATCH_URL;FormUtils.submit(a,{ids:d,isRepeatAudit:c,operComment:b,isBatch:"y"},function(e){if(e.success){DialogUtils.success(msgCode.INFO,e.msg);
}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);}$(".sowait_wrapper").find(".soEntitySearch").click();$(".so_delay_wrapper").find(".soEntitySearch").click();
},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},buildEmployeeOption:function(b,c,d){var a=d?d:"dept_manager";$.ajax({type:"GET",url:ctx+"/crm/ou/employee/listEmployees.htm?groupId="+b+"&type="+a,contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(f){if(f&&f.length>0){var g=new StringBuffer();
g.append("<option value=''>请选择</option>");for(var e=0;e<f.length;e++){g.append("<option value='"+f[e].id+"'>"+f[e].aid+":"+f[e].name+"</option>");}if(c){$("#"+c).empty().append(g.toString());
}else{$("#belongEmployeeSearch").empty().append(g.toString());}}}});},trunDownOrderLayer:function(d,c,b){var a=this;layer.open({type:1,title:"订单驳回",maxmin:false,move:false,scrollbar:false,shadeClose:false,btn:["确定","取消"],area:["600px","450px"],content:$(".soEntityTurnDownPane"),success:function(e,f){var h=new StringBuffer();
for(var g=0;g<c.length;g++){if(g!=0){h.append("，");}h.append("<span style='line-height:30px;'>"+c[g]+"</span>");}$("#trunDownSaveReForm").find(".soNoDiv").empty().append(h.toString());
$("#trunDownSaveReForm").find("#soIds").val(d.toString());(function(){var i=this;$("#trunDownSaveReFormComment").bsSuggest("destroy");$("#trunDownSaveReFormComment").bsSuggest({url:ctx+"/gl/cate/cate/getOptions.htm?typeKey=system&pKey=NotApprovedType",effectiveFields:["name"],searchFields:["name"],effectiveFieldsAlias:{name:"驳回备注"},showBtn:false,inputWarnColor:"",showHeader:false,idField:"id",keyField:"name",getDataMethod:"url",processData:function(l){var k,j,m={value:[]};
if(!l||l.records===0){return false;}j=l.length;for(k=0;k<j;k++){m.value.push({id:l[k].id,name:l[k].name});}return m;}});})();},yes:function(g,e){var f=$("#trunDownSaveReForm").find("input[name=trunDownSaveReFormComment]").val();
if(!f){DialogUtils.error("","请选择驳回原因");}else{FormUtils.submit(SoEntityUtils._CONS_.TURN_DOWN_URL,"soIds="+$("#trunDownSaveReForm").find("#soIds").val()+"&comment="+$("input[name=trunDownSaveReFormComment]").val(),function(h){if(h.success){DialogUtils.success(msgCode.INFO,h.msg);
$(".soEntitySearch").click();layer.close(g);if(b&&typeof b==="function"){b();}}else{DialogUtils.error(msgCode.FAIL_MSG,h.msg);layer.close(g);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}},cancel:function(){FormUtils.clear("trunDownSaveReForm");}});},closeOrderLayer:function(d,c,b){var a=this;layer.open({type:1,title:"订单作废确认",maxmin:false,move:false,scrollbar:false,shadeClose:false,btn:["确定","取消"],area:["600px","450px"],content:$(".soEntityClosePane"),success:function(e,g){var j=new StringBuffer();
for(var h=0;h<c.length;h++){if(h!=0){j.append("，");}j.append("<span style='line-height:30px;'>"+c[h]+"</span>");}$("#closeSaveReForm").find(".soNoDiv").empty().append(j.toString());
$("#closeSaveReForm").find("#soIds").val(d.toString());var f={rules:{closeSaveReFormComment:{required:true,maxlength:["512"],}}};FormUtils.bindFormValidation("closeSaveReForm",f);
},yes:function(f,e){if($("#closeSaveReForm").valid()){FormUtils.submit(SoEntityUtils._CONS_.CLOSE_URL,"soIds="+$("#closeSaveReForm").find("#soIds").val()+"&comment="+$("textarea[name=closeSaveReFormComment]").val()+"&isNeddValid=y",function(g){if(g.success){DialogUtils.success(msgCode.INFO,g.msg);
if(b&&typeof b==="function"){b();}$(".soEntitySearch").click();layer.close(f);}else{DialogUtils.error(msgCode.FAIL_MSG,g.msg);layer.close(f);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}},cancel:function(){FormUtils.clear("closeSaveReForm");}});},submit:function(b,a,c){JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.SO_PLACE_URL+"?soId="+b+"&type=self","订单["+a+"]提交");
},deleteSoEntity:function(b){var a=this;DialogUtils.confirm(function(){FormUtils.del(SoEntityUtils._CONS_.DELETE_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,"删除成功");
$(".end_wrapper").find(".soEntitySearch").click();}else{DialogUtils.error(msgCode.ERROR,c.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});},lock:function(c,d,a){var b=this;FormUtils.submit(SoEntityUtils._CONS_.LOCK_URL,"soIds="+c,function(e){if(e.success){$("#soEntityForm").find("[name=isLock]").val("y");
DialogUtils.success(msgCode.INFO,e.msg);if(d){b.reloadJqgrid(d,selectedId);}if(typeof(a)=="function"){a();}}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},unLock:function(c,d,a){var b=this;FormUtils.submit(SoEntityUtils._CONS_.UNLOCK_URL,"soIds="+c,function(e){if(e.success){$("#soEntityForm").find("[name=isLock]").val("n");
DialogUtils.success(msgCode.INFO,e.msg);if(d){b.reloadJqgrid(d,selectedId);}if(typeof(a)=="function"){a();}}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},initDetail:function(a){var b=this;$(".csName").attr("readonly",true);$(".changeAddr").hide();
$(".addAddr").hide();$("#prod-price-type").hide();$("#hasStock").parent().hide();$("#searchProd").parents(".form-group").hide();$(".prodPrice").attr("readonly",true);
$(".soItemCount").attr("readonly",true);$("select[name=storeId]").attr("disabled",true);$(".delSoItem").hide();$("select[id=scCode]").attr("disabled",true);
$("select[name=cashType]").attr("disabled",true);$("select[name=isCloudWarehourse]").attr("disabled",true);$("select[name=payType]").attr("disabled",true);
$("select[name=soType]").attr("disabled",true);$("input[name=shippingAmount]").attr("readonly",true);$("input[name=subAmount]").attr("readonly",true);$("input[name=totalAmount]").attr("readonly",true);
$("input[name=waitPayAmount]").attr("readonly",true);$("#selectEmpBtn").hide();$(".soProfitPercent").attr("readonly",true);$(".delSoProfit").hide();$("select[name=isFast]").attr("disabled",true);
$("select[name=billType]").attr("disabled",true);$("input[name=billAmount]").attr("readonly",true);$("textarea[name=billTitle]").attr("readonly",true);
$("textarea[name=billContent]").attr("readonly",true);$("textarea[name=comment]").attr("readonly",true);$("select[name=account]").attr("disabled",true);
$("input[name=shipFollow]").attr("readonly",true);$(".othersDiv").find("#delayConfirmTime").attr("readonly",true);$(".updateSoFollow").hide();if(a&&a.length>0){$(".uploadImage").hide();
$("#imageContainer").empty().append(ImageUtils.createImageDivStr(a,null,true,true,true));var c=b.buildImages(a);$(".downLoadFile").find("img").ImageEnlarge({isNotShowImage:true,imageGroup:c});
}if($("input[name=status]").val()!="shipping"&&$("input[name=status]").val()!="close_lost"){$(".uploadImage").hide();}if($("select[name=cashType]").val()=="cod"||$("select[name=cashType]").val()=="free"||$("select[name=cashType]").val()=="point"){$(".financeAttachDiv").hide();
}ConfigUtils.findByKey("soEntity.isReceivePhone",function(d){if(d.success){$("#receivePhoneDiv").show();$("input[name=tranPhone]").attr("readonly",true);
$("input[name=recPhone]").attr("readonly",true);}else{$("#receivePhoneDiv").hide();}});$(".cashSettingDiv").hide();if($("input[name=cashCode]").val()){$(".cashSettingInfoDiv").show();
}},buildImages:function(b){var a=[];for(var c=0;c<b.length;c++){var d={href:ctx+b[c].path,title:(c+1)+" / "+b.length};a.push(d);}return a;}};SoEntityUtils._CONS_={LIST_URL:ctx+"/ec/salesorder/soEntity/listData.htm",DETAIL_PAGE_URL:ctx+"/ec/salesorder/soEntity/detail.htm",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detail.htm",SO_TO_COMFIRM_URL:ctx+"/ec/salesorder/soEntity/toComfirm.htm",SO_TO_DELIVER_URL:ctx+"/ec/salesorder/soEntity/toDeliver.htm",BACK_DELIVER_URL:ctx+"/ec/salesorder/soEntity/backDeliver.htm",COMFIRM_BATCH_URL:ctx+"/ec/salesorder/soEntity/comfirm.htm",TURN_DOWN_URL:ctx+"/ec/salesorder/soEntity/turndown.htm",DELETE_URL:ctx+"/ec/salesorder/soEntity/delete.htm",CLOSE_URL:ctx+"/ec/salesorder/soEntity/close.htm",LOCK_URL:ctx+"/ec/salesorder/soEntity/lockSo.htm",UNLOCK_URL:ctx+"/ec/salesorder/soEntity/unLockSo.htm",SO_PLACE_URL:ctx+"/ec/salesorder/soEntity/place.htm",FOLLOW_PAGE:ctx+"/ec/salesorder/soEntity/toFollow.htm",EXCHANGEORBACK_URL:ctx+"/ec/salesorder/soEntity/exchange.htm",BATCHRECEIVED_URL:ctx+"/ec/salesorder/soEntity/batchReceived.htm",BACKRECEIVED_URL:ctx+"/ec/salesorder/soEntity/backReceived.htm",STOCK_MANY_URL:ctx+"/ec/salesorder/soEntity/stockForMany.htm",BACK_COMPLETE_URL:ctx+"/ec/salesorder/soEntity/backComplete.htm",REVISIT_PAGE_URL:ctx+"/ec/salesorder/soEntity/toRevisit.htm",IMPORT_EXCEL_URL:ctx+"/ec/salesorder/soEntity/importSoStatus.htm",FOLLOW:function(a,b){window.localStorage.setItem("follow_so_ids_"+currentUserId,a.toString());
window.localStorage.setItem("follow_so_nos_"+currentUserId,b.toString());JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.FOLLOW_PAGE+"?soId="+a[0]+"&soNo="+b[0],"订单["+b[0]+"]跟进");
}};function NewHome(a){this.currentMsgItem;this.totalMsgItem;this.myOrderData=null;this.rowItem=12000;this.newOrderData=null;this.asc=10;this.desc=5;this.phoneTop=10;
}NewHome.prototype={init:function(){var b=this;ConfigUtils.findByKey("newIndex.asc.sum",function(c){$("#ascTop").html(c.msg);b.desc=c.msg;});ConfigUtils.findByKey("newIndex.desc.sum",function(c){$("#descTop").html(c.msg);
b.asc=c.msg;});ConfigUtils.findByKey("newIndex.phone.sum",function(c){$("#phoneTop").html(c.msg);b.phoneTop=c.msg;});b.loadNewOrder();if(window.localStorage.getItem("sys_is_ts")=="false"){ConfigUtils.findByKey("index.orderNotice.refleshTime",function(d){var c=d.msg*1000;
b.intervalIdDay=setInterval(function(){b.loadNewOrder();},c);});}b.loadGoal();b.loadMyOrderForToday();b.loadRanking();b.loadMyTalkTimeForToday(currentUserAid);
b.loadNewCsForToday();b.loadNewFollowCsForToday();b.loadMyTask("today");b.loadMyMsg("","today");b.loadMyOperLogForToday();var a=new Date();b.findMyProfitLineChart(a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" 00:00:00",a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" 23:59:59",currentUserId,"hour");
b.resizeNewLi();b.bindEvent();},bindEvent:function(){var b=this;var a=new Date();$(document).on("click",".task-loadmore",function(c){$(this).parent().next().find(".showMore").trigger("click");
});$(document).on("click",".order-id",function(){var m=$(this).attr("csNameVal");var c=$(this).attr("idVal");var e=$(this).attr("value");var l=$(this).attr("soType");
var i=$(this).attr("status");var d=(b.canModifyProfit&&i!="complete"&&i!="close_lost"&&i!="close_reject"&&i!="close")?"can":"cannot";var f=(b.canShowScTrankNo)?b.canShowScTrankNo:"";
if(i=="awaiting_post"&&ResUtils.canShow("soEntitySubmit.url")){SoEntityUtils.submit(c,e,l);}else{if(i=="awaiting_comfirm"&&ResUtils.canShow("soEntityComfirm.url")){var g=[];
g.push(c);SoEntityUtils.confirm(g,e,l);}else{if(i=="shipping"&&ResUtils.canShow("soEntity.url")){var g=[];g.push(c);var h=[];h.push(e);JTTabUtils.addOrRefreshTab(ctx+"/ec/salesorder/soEntity/toFollow.htm"+"?soId="+g[0]+"&soNo="+h[0],"订单["+h[0]+"]跟进");
}else{if("comfirm"==i&&ResUtils.canShow("soEntityStock.url  ")){var k=[];var j={id:c,soNo:e};k.push(j);SoEntityUtils.toDeliver(k);}else{var h=[];var n=[];
h.push(e);n.push(m);JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.DETAIL_PAGE_URL+"?soNo="+e+"&canModifyProfit="+d+"&canShowScTrankNo="+b.canShowScTrankNo,m+"的订单明细");
}}}}});$(document).on("click",".new-cs-data",function(c){JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/list.htm?type=self&belongEmployee="+currentUserId+"&Q__S__EQ__entity.is_sea_=n&Q__D__EQ__create_time_="+DateUtils.format(new Date(),"yyyy-MM-dd")+" 00:00:00","我的客户");
});$(".nol-message").hover(function(){$(this).addClass("nol-msg-hover");},function(){$(this).removeClass("nol-msg-hover");});$(document).on("click","#profitToday",function(){$("div .task-date-active").removeClass("task-date-active");
$(this).addClass("task-date-active");var c=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" 00:00:00";var e=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" 23:59:59";
var d=currentUserId;b.findMyProfitLineChart(c,e,d,"hour");});$(document).on("click","#profitYesterday",function(){$("div .task-date-active").removeClass("task-date-active");
$(this).addClass("task-date-active");var c=DateUtils.getBeforeDate(1)+" 00:00:00";var e=DateUtils.getBeforeDate(1)+" 23:59:59";var d=currentUserId;b.findMyProfitLineChart(c,e,d,"hour");
});$(document).on("click","#profitWeek",function(){$("div .task-date-active").removeClass("task-date-active");$(this).addClass("task-date-active");var c=DateUtils.format(DateUtils.getWeekStartDate(),"yyyy-MM-dd")+" 00:00:00";
var e=DateUtils.format(DateUtils.getWeekEndDate(),"yyyy-MM-dd")+" 23:59:59";var d=currentUserId;b.findMyProfitLineChart(c,e,d,"day");});$(document).on("click","#profitPrevWeek",function(){$("div .task-date-active").removeClass("task-date-active");
$(this).addClass("task-date-active");var h=currentUserId;var e=new Date();var d=e.getDate();var j=e.getDay();var g=e.getMonth();var f=e.getFullYear();begindate=new Date(f,g,d-j-7);
today=new Date(f,g,d+(6-j-7));if(begindate){begindate.setHours(0);begindate.setMinutes(0);begindate.setSeconds(0);begindate.setMilliseconds(0);}if(today){today.setHours(23);
today.setMinutes(59);today.setSeconds(59);today.setMilliseconds(59);}var c=b.dateFormatConversion(begindate);var i=b.dateFormatConversion(today);b.findMyProfitLineChart(c,i,h,"day");
});$(document).on("click",".ranking-desc,.ranking-asc,.ranking-phone",function(c){if($(c.target).is(".ranking-asc")){b.loadRanking();if($(c.target).is(".ranking-active")){}else{$(".ranking-desc").removeClass("ranking-active");
$(".ranking-asc").addClass("ranking-active");$(".ranking-phone").removeClass("ranking-active");}}else{if($(c.target).is(".ranking-desc")){if($(c.target).is(".ranking-active")){}else{$(".ranking-asc").removeClass("ranking-active");
$(".ranking-desc").addClass("ranking-active");$(".ranking-phone").removeClass("ranking-active");$(".sdpb").addClass("ranking-desc-list");}b.loadDescRanking();
}else{if($(c.target).is(".ranking-phone")){if($(c.target).is(".ranking-active")){}else{$(".ranking-asc").removeClass("ranking-active");$(".ranking-desc").removeClass("ranking-active");
$(".ranking-phone").addClass("ranking-active");$(".sdpb").removeClass("ranking-desc-list");}b.loadPhoneRanking();}}}});$(document).on("click",".ranking-screen",function(c){window.parent.initDataScreen();
});$(window).on("resize",function(){b.resizeNewLi();b.findMyProfitLineChart(a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" 00:00:00",a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" 23:59:59",currentUserId,"hour");
});},resizeNewLi:function(){var a=this;},loadMyOperLogForToday:function(){var a=this;FormUtils.loadData(ctx+"/gl/secure/secureOperLog/loadMyOperLogForToday.htm?",function(b){$("#operLogDiv").empty();
var c=b.length;if(c>=1){a.buildOperLogTable(b);$(".task-loadmore").show();}else{var d='<div class="no-data-layer mto-items-empty">你真棒，待办都处理完了哦</div>';$("#operLogDiv").append(d.toString());
}});},buildOperLogTable:function(a){var b=this;var d=new StringBuffer();d.append('<ul class="todo-list m-t ui-sortable">');if(a){for(var c=a.length-1;c>=0;
c--){d.append(b.createOperLogRow(a[c]));}}d.append("</ul>");$("#operLogDiv").empty().append(d.toString());},createOperLogRow:function(b){var a=this;var c=new StringBuffer();
c.append('<li class="operLogEntity">');c.append('<label style="padding-left:2px;font-size:12px;">');c.append("<div title='"+b.createTime+"--"+b.linkNames+"--"+b.linkContents+"' style='overflow:hidden; white-space:nowrap; text-overflow:ellipsis'>【"+b.configName+"】"+b.linkNames+"--"+b.linkContents+"</div>");
c.append("</label>");c.append("</div>");c.append("</li>");return c.toString();},loadMyMsg:function(b,c){var a=this;FormUtils.loadData(ctx+"/gl/msg/msgEntity/listToDayMsgData.htm?type="+b+"&time="+c,function(d){$("#msgDiv").empty();
var e=d.records;a.totalMsgItem=e;if(e>=1){a.currentMsgItem=1;a.msgData=d.rows;a._buildString(a.msgData);}else{var f='<div class="no-data-layer mto-items-empty">暂时没有最新消息</div>';
$("#msgDiv").append(f.toString());}});},_buildString:function(c){var j=this;$("#msgDiv").empty();var f=new StringBuffer();var e=0;if(j.currentMsgItem*j.rowItem>=j.totalMsgItem){e=j.totalMsgItem;
}else{e=j.currentMsgItem*j.rowItem;}for(var d=(j.currentMsgItem-1)*j.rowItem;d<e;d++){var a=c[d].url;var g=c[d].title;var b="";if(g.indexOf("未接来电")!=-1){b=g.replace("未接来电","");
if(b){b=PhoneEncryptUtils.encryptPhone(b);}else{b="";}}if(b){g=b+"未接来电";}if(!a){a="";}if(b){if(!c[d].content||c[d].content.indexOf("未接来电")>-1){c[d].content="[时间未知]";
}c[d].content=b+"&nbsp;&nbsp;约<strong>["+c[d].content+"]</strong>&nbsp;&nbsp;未接来电";}f.append("<div class='timeline-item'>");f.append("<div class='row'>");
f.append("<div class='col-xs-1 date' style='padding-left:0px;padding-right:2px;text-align:center;'>");if("notice"==c[d].type){f.append("<i class='fa fa-bullhorn' title='系统公告'></i>");
}else{if("miss"==c[d].type){f.append("<i class='fa fa-phone' title='未接来电'></i>");}else{if("assign"==c[d].type){f.append("<i class='fa fa-user' title='新进客户'></i>");
}else{if("others"==c[d].type){f.append("<i class='fa fa-briefcase' title='其他消息'></i>");}}}}f.append("</div>");f.append("<div class='col-xs-8 content' style='min-height: 35px;border-right: 1px solid #e7eaec;");
if(d==j.rowItem*j.currentMsgItem-1||d==e-1){f.append("border-bottom: 1px solid #e7eaec;");}f.append("' urlVal='"+a+"'  titleVal='"+g+"'>");var h=j.dealMsgCreateTime(c[d]);
if("others"==c[d].type&&c[d].content.indexOf("【客户跟进】")>-1){f.append("<div class='col-xs-1' style='padding:0px;'><img title='"+h+"' alt='其他' class='img-circle' style='height:18px;width:18px;' src="+ctx+"/img/jt/notice/level"+c[d].level+".png></div><div class='col-xs-11' style='padding:0px;'>"+j._dealCsContent(c[d].content)+"</div>");
}else{if("others"==c[d].type&&c[d].content.indexOf("【订单跟进】")>-1){f.append("<div class='col-xs-1' style='padding:0px;'><img title='"+h+"' alt='其他' class='img-circle' style='height:18px;width:18px;' src="+ctx+"/img/jt/notice/level"+c[d].level+".png></div><div class='col-xs-11' style='padding:0px;'>"+j._dealSoFollowContent(c[d].content)+"</div>");
}else{if("others"==c[d].type&&c[d].content.indexOf("【订单】")>-1){f.append("<div class='col-xs-1' style='padding:0px;'><img title='"+h+"' alt='其他' class='img-circle' style='height:18px;width:18px;' src="+ctx+"/img/jt/notice/level"+c[d].level+".png></div><div class='col-xs-11' style='padding:0px;'>"+j._dealSoContent(c[d].content)+"</div>");
}else{if("assign"==c[d].type){f.append("<div class='col-xs-1' style='padding:0px;'><img title='"+h+"' alt='其他' class='img-circle' style='height:18px;width:18px;' src="+ctx+"/img/jt/notice/level"+c[d].level+".png></div><div class='col-xs-11' style='padding:0px;'>"+j._dealAssignContent(c[d].content)+"</div>");
}else{f.append("<div class='col-xs-1' style='padding:0px;'><img title='"+h+"' class='img-circle' style='height:18px;width:18px;' src='"+ctx+"/img/jt/notice/level"+c[d].level+".png'></div><div class='col-xs-11' style='padding:0px;'>"+c[d].content+"</div>");
}}}}f.append("</div>");f.append("<div class='col-xs-1'><button class='btn btn-danger btn-sm pull-right deleteMsg' idVal='"+c[d].id+"' type='button'><i class='fa fa-remove'></i></button></div>");
f.append("</div>");f.append("</div>");if(d==j.rowItem-1){break;}}$("#msgDiv").append(f.toString());},dealMsgCreateTime:function(a){if(DateUtils.getDateDiff(DateUtils.format(new Date(),"yyyy-MM-dd")+" 00:00:00",a.createTime.substring(0,10)+" 00:00:00","day")<0){return a.createTime.substring(5,16);
}else{return a.createTime.substring(11,16);}},_dealAssignContent:function(b){var a="";a=b.replace(/\d{1,5}/g,function(c){var d=new StringBuffer();d.append("<strong>");
d.append(c);d.append("</strong>");return d.toString();});return a;},_dealCsContent:function(b){var a="";a=b.replace(/\d{3,12}:/g,function(d){var c=d.substring(0,d.length-1);
var e=new StringBuffer();e.append("<strong>");e.append(c);e.append("</strong>");e.append(":");return e.toString();});return a;},_dealSoContent:function(b){var a="";
a=b.replace(/\d{3,12}】/g,function(d){var c=d.substring(0,d.length-1);var e=new StringBuffer();e.append("<strong>");e.append(c);e.append("</strong>");e.append("】");
return e.toString();});return a;},_dealSoFollowContent:function(b){var a="";a=b.replace(/\d{3,12}：/g,function(d){var c=d.substring(0,d.length-1);var e=new StringBuffer();
e.append("<strong>");e.append(c);e.append("</strong>");e.append("：");return e.toString();});return a;},loadMyTask:function(b){var a=this;FormUtils.loadData(ctx+"/gl/task/taskEntity/findUnfinishTask.htm?rows=5&page=1&timeType="+b,function(d){if(d.records<=0){var g='<div class="no-data-layer mto-items-empty">没有待办任务，敬请留意</div>';
$("#taskPanel").empty().append(g);}else{var c=d.rows;var h=new StringBuffer();h.append('<ul class="todo-list m-t ui-sortable">');if(c){for(var e=c.length-1;
e>=0;e--){var f=c[e];h.append(a.createTaskRow(f));}}h.append("</ul>");$("#taskPanel").empty().prepend(h.toString()).append(a._createBtn());}});},createTaskRow:function(d){var b=this;
var e=new StringBuffer();e.append('<li class="taskEntity">');e.append('<div class="checkbox checkbox-success checkbox-inline">');e.append('<input idVal="'+d.id+'" type="checkbox" class="finishTask" >');
e.append('<label taskType="'+d.type+'"  style="padding-left:2px;font-size:12px;" title="'+d.name+'" class="taskNameLabel" >');var a=TaskUtils.dealTaskName(d);
a="<div class='taskEntityEdit' idVal='"+d.id+"' style='width:220px;overflow:hidden; white-space:nowrap; text-overflow:ellipsis'>"+a+"</div>";e.append(a);
e.append("</label>");e.append('<small class="label label-primary pull-right"><i class="fa fa-clock-o"></i> ');if(d.notifyTime){var c=DateUtils.format(new Date(d.notifyTime),DateUtils._CONS_.DEFAULT_MON_DAY_HOU_MIN_PATTERN);
e.append(c);}e.append("</small>");e.append("</div>");e.append("</li>");return e.toString();},_createBtn:function(){var a=new StringBuffer();a.append(' <div class = "row pull-right" style = "padding-right:30px;" >');
a.append('<a class="J_menuItem showMore" nameVal="待办事项" urlVal="/gl/task/taskEntity/list.htm" href="#" data-index="89">');a.append('<strong>查看更多 </strong> <i class="fa fa-angle-right"></i>');
a.append("</a>");a.append("</div>");return a.toString();},dataUp:function(b){var a=this;if(b){$.each(b,function(d,f){var c={to:$(this).attr("data-to"),speed:100};
if($(this).is(".yjing,.yjed,.sdcm")){c.decimals=2;}$(this).data("countToOptions",c);$(this).each(count);});}},loadFlexer:function(c,b){var a=this;if(c==1){$(".yjing").attr("data-to",b.yjing).attr("data-speed",b.yjing).addClass("count-title");
$(".yjed").attr("data-to",b.yjed).attr("data-speed",b.yjed).addClass("count-title");if(b.yjing>b.yjed){$(".yj-lbg-layer").addClass("yj-lbg2-layer");$(".yj-rbg-layer").addClass("yj-rbg2-layer");
}a.dataUp([$(".yjing"),$(".yjed")]);}else{if(c==2){$(".today-cs-data").attr("data-to",b.totayCs).attr("data-speed",b.totayCs).addClass("count-title");a.dataUp([$(".today-cs-data")]);
}else{if(c==3){$(".new-cs-data").attr("data-to",b.newCs).attr("data-speed",b.newCs).addClass("count-title");a.dataUp([$(".new-cs-data")]);}else{if(c==4){$(".sd-cs-num-data").attr("data-to",b.sdNumber).attr("data-speed",b.sdNumber).addClass("count-title");
$(".sdcm").attr("data-to",b.sdTotal).attr("data-speed",b.sdTotal).addClass("count-title");a.dataUp([$(".sd-cs-num-data"),$(".sdcm")]);}else{if(c==5){$(".th-cs-counter-data").attr("data-to",b.num).attr("data-speed",b.num).addClass("count-title");
$(".thct").attr("data-to",b.talkTime).attr("data-speed",b.talkTime).addClass("count-title");a.dataUp([$(".th-cs-counter-data"),$(".thct")]);}}}}}},myOrderLi:function(c,b){var a=this;
var d=new StringBuffer();d.append("<div class='mto-items'>").append("<div class='mto-orderId'>订单号&emsp;<span idVal="+c.id+" status="+c.status+" soType="+c.soType+" csNameVal="+c.csName+" value="+c.soNo+"  style='cursor: pointer;color: #2196F3;' class='order-id'>"+c.soNo+"</span></div>").append("<div class='mto-createTime'>生成时间&emsp;<span>"+c.createTime+"</span></div>").append("<div class='mto-content'>"+a.myGoodsLi(c.list)+"</div>").append("<div class='mto-total'>合计&emsp;<span>￥"+c.total.toFixed(2)+"</span></div>").append("<div class='mto-number'>"+b+"</div>").append("</div>");
return d.toString();},myGoodsLi:function(b){var a=this;var c=new StringBuffer();if(b.length>0){$.each(b,function(d,f){c.append("<p>"+this.name+"&emsp;&times;"+this.number+"</p>");
});}return c.toString();},loadMyOrderForToday:function(){var a=this;FormUtils.loadData(ctx+"/ec/salesorder/soEntity/findTodayOrderForMe.htm?",function(d){a.myOrderData=d;
var b=0,c=0;if(d&&d.length>0){$.each(d,function(f,g){$(".mto-items-layer").eq(f).empty().append(a.myOrderLi(this,f+1)).removeClass("mto-items-empty");if(this.status!="awaiting_post"&&this.status!="awaiting_comfirm"&&this.status!="close"){c=parseInt(c)+parseInt(this.total);
b=parseInt(b)+1;}});$(".mto-items-layer").on("scroll",function(){$(this).find(".mto-number").stop().animate({"bottom":(2-$(this).scrollTop())+"px"},"fast");
});}a.loadFlexer(4,{sdNumber:b,sdTotal:c});});},loadGoal:function(){var a=this;var b=DateUtils.format(new Date(),"yyyy-MM");FormUtils.loadData(ctx+"/gl/ou/employeeTarget/listData.htm?Q__S__EQ__employee_id_="+currentUserId+"&Q__S__EQ__period_="+b,function(c){if(c.rows&&c.rows.length>0){if(window.localStorage.getItem("sys_is_ts")=="true"){a.loadFlexer(1,{yjing:0,yjed:c.rows[0].total});
}else{a.loadFlexer(1,{yjing:c.rows[0].completeTotal,yjed:c.rows[0].total});}}});},loadNewFollowCsForToday:function(){var a=this;FormUtils.loadData(ctx+"/crm/cs/csEntity/countNewFollow.htm",function(b){if(b&&b.success){a.loadFlexer(2,{totayCs:b.msg});
}});},loadNewCsForToday:function(){var a=this;var b=this.$container;FormUtils.loadData(ctx+"/crm/cs/csEntity/countNewCs.htm",function(c){if(c&&c.success){a.loadFlexer(3,{newCs:c.msg});
}});},loadMyTalkTimeForToday:function(b){var a=this;FormUtils.loadData(ctx+"/gl/cti/tRKSheetRecord/loadMyTalkTime.htm?aid="+b,function(g){if(g){var f=g.totalTimeLength;
var e=g.validTimeLength;var d=g.validCount;var c=a._formatSeconds(f);a.loadFlexer(5,{num:d,talkTime:c});}});},_formatSeconds:function(b){var a=0;if(b>60){a=parseInt(b/60);
}return a;},rankingLi:function(e,d,g,c){var a=this;var b=e.ranking;var f=new StringBuffer();f.append("<div class='sd-li"+(d?" sd-li-me":"")+"'>");if(b<=3&&!g){f.append("<div class='sd-num sd-num-"+b+"'>").append("<div class='sdjp'></div>").append("<span class='sdn-data unselect'>"+b+"</span>").append("</div>");
}else{f.append("<div class='sd-num sdn-other'>").append("<div class='sdjp'></div>").append("<span class='sdn-data unselect'>"+b+"</span>").append("</div>");
}f.append("<div class='sd-profile'>").append("<div class='sd-profile-img"+(b<=3?(" sd-pi-"+b):"")+"'>");if(e.profile){f.append("<img class='sdpi' onerror='onImageError()' src='"+ctx+e.profile+"'>");
}if(!e.aid){f.append("<span>?</span>");}f.append("<i class='fa fa-user'></i>").append("</div>");if(b<=3){f.append("<div class='sd-profile-"+b+"'></div>");
}f.append("</div>").append("<div class='sd-content'>").append("<div class='sd-content-layer'>");if(e.aid&&c!=true){f.append("<div class='sdc-msg'>工&emsp;&emsp;号&emsp;<span>&emsp;"+e.aid+"</span></div>").append("<div class='sdc-money'>审单金额&emsp;<span>￥"+e.sdTotal.toFixed(2)+"</span></div>").append("<div class='sdc-total'>审单数量&emsp;<span>&emsp;"+e.sdNumber+"</span></div>");
}if(e.aid&&c==true){f.append("<div class='sdc-msg'>工&emsp;&emsp;号&emsp;<span>&emsp;"+e.aid+"</span></div>").append("<div class='sdc-total'>通话时长&emsp;<span>&emsp;"+e.SumTimeLen+"</span></div>");
}else{f.append("<div class='sdc-zw'>待定</div>");}f.append("</div>").append("</div>").append("</div>");return f.toString();},loadRanking:function(){var a=this;
FormUtils.loadData(ctx+"/ec/salesorder/soEntity/loadRankingForToday.htm",function(d){var b=0;$(".sdpb").empty();if($(".sdpb").is(".ranking-desc-list")){$(".sdpb").removeClass("ranking-desc-list");
}if(d&&d.length>0){$.each(d,function(g,h){var f=false;if(this.aid==currentUserAid){f=true;}$(".sdpb").append(a.rankingLi(this,f,false,false));b++;});$(".sdpi").each(function(f,g){$(this).load(function(){$(this).attr("style",imgStyle($(this)[0].naturalWidth,$(this)[0].naturalHeight,65));
});$(this).next().hide();});}if(b<a.asc){for(var c=b;c<a.asc;c++){$(".sdpb").append(a.rankingLi({ranking:c+1},false,false,false));}}});},loadPhoneRanking:function(){var a=this;
FormUtils.loadData(ctx+"/gl/cti/tRKSheetRecord/loadPhoneForToday.htm",function(d){var b=0;$(".sdpb").empty();if($(".sdpb").is(".ranking-desc-list")){$(".sdpb").removeClass("ranking-desc-list");
}if(d&&d.length>0){$.each(d,function(g,h){var f=false;if(this.aid==currentUserAid){f=true;}$(".sdpb").append(a.rankingLi(this,f,false,true));b++;});$(".sdpi").each(function(f,g){$(this).load(function(){$(this).attr("style",imgStyle($(this)[0].naturalWidth,$(this)[0].naturalHeight,65));
});$(this).next().hide();});}if(b<a.asc){for(var c=b;c<a.asc;c++){$(".sdpb").append(a.rankingLi({ranking:c+1},false,false,true));}}});},loadDescRanking:function(){var a=this;
FormUtils.loadData(ctx+"/ec/salesorder/soEntity/loadRankingDxForToday.htm",function(e){var d=e;$(".sdpb").empty();var b=0;if(e&&e.length>0){$.each(d,function(g,h){var f=false;
if(this.aid==currentUserAid){f=true;}$(".sdpb").append(a.rankingLi(this,f,true,false));b++;});$(".sdpi").each(function(f,g){$(this).load(function(){$(this).attr("style",imgStyle($(this)[0].naturalWidth,$(this)[0].naturalHeight,65));
});$(this).next().hide();});}if(b<a.desc){for(var c=b;c<a.desc;c++){$(".sdpb").append(a.rankingLi({ranking:c+1},false,true,false));}}});},newestOrderLi:function(c){var a=this;
var b='<div class="nol-carousel-items">'+'<div class="nol-order-layer">'+'<span class="nol-detail-title">订单编号&nbsp;</span>'+'<span class="nol-detail-data nol-order-number">'+c.soNo+"</span>"+"</div>"+'<div class="nol-detail-layer">'+'<span class="nol-detail-title">订单金额&nbsp;</span>&nbsp;'+'<span class="nol-detail-data"><span class="gold-icons">￥</span>'+(c.totalAmount).toFixed(2)+"</span>"+"<br/>"+'<span class="nol-detail-title">成单员工&nbsp;</span>'+'<span class="nol-detail-data">'+c.placerAid+"&nbsp;:&nbsp;"+c.placerName+"</span>"+"</div>"+'<div class="nol-detail-profile" data-profile="'+c.placerProfile+'"></div>'+"</div>";
return b;},loadLewestOrder:function(c){var a=this;if(!c){return false;}var b="";$.each(c,function(d,f){b+=a.newestOrderLi(this);});$(".nol-carousel-list").empty().append(b);
},changeLi:function(){var c=this;var d=$(".nol-current-items"),b=$(".nol-carousel-items").length;if(d.length==0){var a=$(".nol-carousel-items").eq(0).addClass("nol-current-items");
$(".nol-profile").children("img").attr("src",ctx+a.find(".nol-detail-profile").attr("data-profile"));a.delay(250).show().stop().animate({"opacity":1},"fast","swing",function(){$(this).css({"transform":"scale(1)"});
});}else{if(d.next().length==0&&b>1){d=d.removeClass("nol-current-items");d.stop().animate({"opacity":0},"fast","swing",function(){$(this).css({"transform":"scale(0)"});
setTimeout(function(){d.removeAttr("style");},500);});var a=$(".nol-carousel-items").eq(0).addClass("nol-current-items");$(".nol-profile").children("img").attr("src",ctx+a.find(".nol-detail-profile").attr("data-profile"));
a.delay(250).show().stop().animate({"opacity":1},"fast","swing",function(){$(this).css({"transform":"scale(1)"});});}else{if(d.next().length>0){var d=d.removeClass("nol-current-items");
var a=d.next().addClass("nol-current-items");$(".nol-profile").children("img").attr("src",ctx+a.find(".nol-detail-profile").attr("data-profile"));d.stop().animate({"opacity":0},"fast","swing",function(){$(this).css({"transform":"scale(0)"});
setTimeout(function(){d.removeAttr("style");},500);});a.delay(250).show().stop().animate({"opacity":1},"fast","swing",function(){$(this).css({"transform":"scale(1)"});
});}}}},setOrderData:function(){var a=this;if(a.orderRun){window.clearInterval(a.orderRun);a.orderRun=null;}a.loadLewestOrder(a.newOrderData);a.changeLi();
a.oncePlay();if(a.newOrderData.length>1){a.orderRun=setInterval(function(){a.changeLi();},4*1000);}if($(".nol-message").is(".nol-message-blank")){$(".nol-message").removeClass("nol-message-blank");
}},loadNewOrder:function(){var a=this;var b=window.sessionStorage.getItem("home.solastTime");if(!b){b=DateUtils.format(new Date(),DateUtils._CONS_.DEFAULT_DATE_PATTERN)+" 00:00:00";
}FormUtils.loadData(ctx+"/ec/salesorder/soEntity/findLastSoList.htm"+"?lastTime="+b,function(c){window.sessionStorage.setItem("home.solastTime",c.time);
if(c.data&&c.data.length>0){a.newOrderData=c.data;window.sessionStorage.setItem("home.newOrderData",JSON.stringify(c.data));a.setOrderData();}else{if(!a.newOrderData){var d=JSON.parse(window.sessionStorage.getItem("home.newOrderData"));
if(d&&d.length>0){a.newOrderData=d;a.setOrderData();}}}},null,true);},dateFormatConversion:function(f){var h=new Date();h.setTime(f);var d=h.getFullYear();
var e=h.getMonth()+1<10?"0"+(h.getMonth()+1):h.getMonth()+1;var c=h.getDate()<10?"0"+h.getDate():h.getDate();var a=h.getHours()<10?"0"+h.getHours():h.getHours();
var g=h.getMinutes()<10?"0"+h.getMinutes():h.getMinutes();var b=h.getSeconds()<10?"0"+h.getSeconds():h.getSeconds();return d+"-"+e+"-"+c+" "+a+":"+g+":"+b;
},getAllDate:function(b,d,f){var n=b.split("-");var i=d.split("-");var m=new Date();m.setUTCFullYear(n[0],n[1]-1,n[2]);var h=new Date();h.setUTCFullYear(i[0],i[1]-1,i[2]);
var a=m.getTime();var l=h.getTime();var g="";var e=0;f[e]=n[2];e=1;for(var c=a+24*60*60*1000;c<l;){f[e]=(new Date(parseInt(c))).format().substring(8);c=c+24*60*60*1000;
e++;}f[e]=i[2];console.log(f);},findMyProfitLineChart:function(a,g,f,d){var b=this;var h={};var e=[];h={startDate:a,endDate:g,employeeId:f,dateType:d};
var c=ctx+"/ec/rp/reportProfit/findMyProfitByHome.htm";if(d=="day"){b.getAllDate(a.substring(0,10),g.substring(0,10),e);}FormUtils.loadData(c+"?params="+JSON.stringify(h),function(s){if(s!=null&&s!=""){var t=s.placeList;
if(t!=null&&t!=""){var m=[];var p=0;for(var q=0;q<t.length;q++){var n=null;n=t[q].dateTime;m[p]=[n,t[q].placeAmount];p++;}}var k=s.confirmList;if(k!=null&&k!=""){var r=[];
var p=0;for(var q=0;q<k.length;q++){r[p]=[k[q].dateTime,k[q].auditAmount];p++;}}var o=s.shipList;if(o!=null&&o!=""){var l=[];var p=0;for(var q=0;q<o.length;
q++){l[p]=[o[q].dateTime,o[q].shipAmount];p++;}}var u=s.completeList;if(u!=null&&u!=""){var v=[];var p=0;for(var q=0;q<u.length;q++){v[p]=[u[q].dateTime,u[q].signAmount];
p++;}}b._initQUxian(m,r,l,v,d,e);}});},_initQUxian:function(h,d,g,a,b,c){var e=[];if(b=="hour"){e=[{type:"value",boundaryGap:false,axisLabel:{formatter:"{value} 小时"}}];
}else{e=[{type:"category",boundaryGap:false,data:c,axisLabel:{formatter:"{value} 日"}}];}var f=echarts.init(document.getElementById("profitLineChart"));
option={tooltip:{trigger:"axis"},grid:{x:80,y:50,y2:30},legend:{data:["下单","审单","发货","签收"],left:"left",textStyle:{fontSize:10},itemGap:10,itemWidth:21},toolbox:{show:true,itemSize:11,feature:{mark:{show:true},dataView:{show:true,readOnly:false},magicType:{show:true,type:["line","bar"]},restore:{show:true},saveAsImage:{show:true}}},calculable:true,xAxis:e,yAxis:[{type:"value",axisLabel:{formatter:"{value} 元"}}],series:[{name:"下单",type:"line",data:h},{name:"审单",type:"line",data:d},{name:"发货",type:"line",data:g},{name:"签收",type:"line",data:a}]};
f.resize();f.setOption(option);},oncePlay:function(){var a=this;$("#jt-prize-video").load();$(".jt-full-print").fadeIn("slow");setTimeout(function(){$(".jt-full-print").fadeOut("slow");
},2.5*1000);}};$.fn.countTo=function(a){a=a||{};return $(this).each(function(){var c=$.extend({},$.fn.countTo.defaults,{from:$(this).data("from"),to:$(this).data("to"),speed:$(this).data("speed"),refreshInterval:$(this).data("refresh-interval"),decimals:$(this).data("decimals")},a);
console.log(c);var h=Math.ceil(c.speed/c.refreshInterval),i=(c.to-c.from)/h;var j=this,f=$(this),e=0,g=c.from,d=f.data("countTo")||{};f.data("countTo",d);
if(d.interval){clearInterval(d.interval);}d.interval=setInterval(k,c.refreshInterval);b(g);function k(){g+=i;e++;b(g);if(typeof(c.onUpdate)=="function"){c.onUpdate.call(j,g);
}if(e>=h){f.removeData("countTo");clearInterval(d.interval);g=c.to;if(typeof(c.onComplete)=="function"){c.onComplete.call(j,g);}}}function b(m){var l=c.formatter.call(j,m,c);
f.html(l);}});};$.fn.countTo.defaults={from:0,to:0,speed:1,refreshInterval:0.5,decimals:0,formatter:formatter,onUpdate:null,onComplete:null};function formatter(b,a){return b.toFixed(a.decimals);
}function count(a){var b=$(this);a=$.extend({},a||{},b.data("countToOptions")||{});console.log(a);b.countTo(a);}function imgStyle(b,c,a){if(b>c){return"height:100% !important;left:-"+(a*(1-(c/b)))/2+"px;width:auto !important;";
}else{if(b==c){return null;}else{if(b<c){return"top:-"+(a*(1-(b/c)))/2+"px;";}}}}Date.prototype.format=function(){var a="";a+=this.getFullYear()+"-";if((this.getMonth()+1)>=10){a+=(this.getMonth()+1)+"-";
}else{a+="0"+(this.getMonth()+1)+"-";}if(this.getDate()>=10){a+=this.getDate();}else{a+="0"+this.getDate();}return(a);};$(function(){function b(){this.hadInit=false;
this.currentMsgItem;this.totalMsgItem;this.rowItem=10000;this.noticeTypeBtn="";this.noticeTime="today";this.msgData;this.$container=$("div[srcVal='/gl/msg/msgdesktop/seatNoticeIndex.htm']");
}b._CONS_={GET_TODAY_MSG_URL:ctx+"/gl/msg/msgEntity/listToDayMsgData.htm",};b.prototype={init:function(d){var c=this;if(!c.hadInit){c.hadInit=true;c._bindEventHanlder();
c.$container.find(".today").removeClass("btn-outline");c._getData("","today");}},_bindEventHanlder:function(){var c=this;c.$container.on("click",".sevenDays",function(){c.$container.find(".today").addClass("btn-outline");
$(this).removeClass("btn-outline");c.noticeTime="sevenDays";c._getData(c.noticeTypeBtn,"sevenDays");});c.$container.on("click",".today",function(){c.noticeTime="today";
$(this).removeClass("btn-outline");c.$container.find(".sevenDays").addClass("btn-outline");c._getData(c.noticeTypeBtn,"today");});c.$container.on("click",".allBtn",function(){c._getData("",c.noticeTime);
c.noticeTypeBtn="";c.$container.find(".allBtn").attr("disabled",true);c.$container.find(".noticeBtn").attr("disabled",false);c.$container.find(".missBtn").attr("disabled",false);
c.$container.find(".csCountBtn").attr("disabled",false);c.$container.find(".otherBtn").attr("disabled",false);});c.$container.on("click",".noticeBtn",function(){c._getData("notice",c.noticeTime);
c.noticeTypeBtn="notice";c.$container.find(".allBtn").attr("disabled",false);c.$container.find(".noticeBtn").attr("disabled",true);c.$container.find(".missBtn").attr("disabled",false);
c.$container.find(".csCountBtn").attr("disabled",false);c.$container.find(".otherBtn").attr("disabled",false);});c.$container.on("click",".missBtn",function(){c._getData("miss",c.noticeTime);
c.noticeTypeBtn="miss";c.$container.find(".allBtn").attr("disabled",false);c.$container.find(".noticeBtn").attr("disabled",false);c.$container.find(".missBtn").attr("disabled",true);
c.$container.find(".csCountBtn").attr("disabled",false);c.$container.find(".otherBtn").attr("disabled",false);});c.$container.on("click",".csCountBtn",function(){c._getData("assign",c.noticeTime);
c.noticeTypeBtn="assign";c.$container.find(".allBtn").attr("disabled",false);c.$container.find(".noticeBtn").attr("disabled",false);c.$container.find(".missBtn").attr("disabled",false);
c.$container.find(".csCountBtn").attr("disabled",true);c.$container.find(".otherBtn").attr("disabled",false);});c.$container.on("click",".otherBtn",function(){c._getData("others",c.noticeTime);
c.noticeTypeBtn="others";c.$container.find(".allBtn").attr("disabled",false);c.$container.find(".noticeBtn").attr("disabled",false);c.$container.find(".missBtn").attr("disabled",false);
c.$container.find(".csCountBtn").attr("disabled",false);c.$container.find(".otherBtn").attr("disabled",true);});c.$container.on("click",".deleteMsg",function(){var d=$(this).parents(".timeline-item");
var e=$(this).attr("idVal");DialogUtils.confirm(function(){FormUtils.submit(ctx+"/gl/msg/msgEntity/deleteMsgRead.htm",{msgId:e,recId:currentUserId},function(f){if(f.success){d.remove();
DialogUtils.success(msgCode.SUCCESS,"删除成功");}});});});$("body").on("click",".content",function(){var d=$(this).attr("urlVal");var e=$(this).attr("titleVal");
if(d){if(e==="待办任务"){JTTabUtils.addOrRefreshTab(ctx+"/gl/task/taskEntity/list.htm","待办任务","待办任务");}else{if(e==="我的客户"){JTTabUtils.addOrRefreshTab(ctx+d+"?type=self&turnNew=y",e);
}else{JTTabUtils.addOrRefreshTab(ctx+d,e);}}}});c.$container.on("click",".next-msg",function(){c.currentMsgItem=c.currentMsgItem+1;c._buildString(c.msgData);
});c.$container.on("click",".prev-msg",function(){c.currentMsgItem=c.currentMsgItem-1;c._buildString(c.msgData);});},_judeNextBtn:function(d,e){var c=this;
if((d*c.rowItem)<e){c.$container.find(".next-msg").removeAttr("disabled");}else{c.$container.find(".next-msg").attr("disabled","disabled");}},_judePrevBtn:function(d){var c=this;
if(d>1){c.$container.find(".prev-msg").attr("disabled",false);}else{c.$container.find(".prev-msg").attr("disabled",true);}},_getData:function(d,e){var c=this;
FormUtils.loadData(b._CONS_.GET_TODAY_MSG_URL+"?type="+d+"&time="+e,function(f){$("#msgDiv").empty();var g=f.records;c.totalMsgItem=g;if(g>=1){c.currentMsgItem=1;
c.msgData=f.rows;c._buildString(c.msgData);}else{var h='<div style="color: red;text-align: center;font-weight: bold;">没有符合数据！</div>';$("#msgDiv").append(h.toString());
c.currentMsgItem=0;c._judeNextBtn(c.currentMsgItem,c.totalMsgItem);c._judePrevBtn(c.currentMsgItem);}});},_buildString:function(h){var c=this;$("#msgDiv").empty();
var k=new StringBuffer();var e=0;if(c.currentMsgItem*c.rowItem>=c.totalMsgItem){e=c.totalMsgItem;}else{e=c.currentMsgItem*c.rowItem;}for(var f=(c.currentMsgItem-1)*c.rowItem;
f<e;f++){var d=h[f].url;var j=h[f].title;var g="";if(j.indexOf("未接来电")!=-1){g=j.replace("未接来电","");if(g){g=PhoneEncryptUtils.encryptPhone(g);}else{g="";
}}if(g){j=g+"未接来电";}if(!d){d="";}if(g){if(!h[f].content||h[f].content.indexOf("未接来电")>-1){h[f].content="[时间未知]";}h[f].content=g+"&nbsp;&nbsp;约<strong>["+h[f].content+"]</strong>&nbsp;&nbsp;未接来电";
}k.append("<div class='timeline-item'>");k.append("<div class='row'>");k.append("<div class='col-xs-3 date' style='padding-left:0px;padding-right:2px;text-align:center;'>");
if("notice"==h[f].type){k.append("<i class='fa fa-bullhorn' title='系统公告'></i>");}else{if("miss"==h[f].type){k.append("<i class='fa fa-phone' title='未接来电'></i>");
}else{if("assign"==h[f].type){k.append("<i class='fa fa-user' title='新进客户'></i>");}else{if("others"==h[f].type){k.append("<i class='fa fa-briefcase' title='其他消息'></i>");
}}}}if(DateUtils.getDateDiff(DateUtils.format(new Date(),"yyyy-MM-dd")+" 00:00:00",h[f].createTime.substring(0,10)+" 00:00:00","day")<0){k.append(h[f].createTime.substring(5,16));
}else{k.append(h[f].createTime.substring(11,16));}k.append("</div>");k.append("<div class='col-xs-8 content' style='min-height: 45px;border-right: 1px solid #e7eaec;");
if(f==c.rowItem*c.currentMsgItem-1||f==e-1){k.append("border-bottom: 1px solid #e7eaec;");}k.append("' urlVal='"+d+"'  titleVal='"+j+"'>");if("others"==h[f].type&&h[f].content.indexOf("【客户跟进】")>-1){k.append("<div class='col-xs-1' style='padding:0px;'><img alt='其他' class='img-circle' style='height:18px;width:18px;' src="+ctx+"/img/jt/notice/level"+h[f].level+".png></div><div class='col-xs-11' style='padding:0px;'>"+c._dealCsContent(h[f].content)+"</div>");
}else{if("others"==h[f].type&&h[f].content.indexOf("【订单跟进】")>-1){k.append("<div class='col-xs-1' style='padding:0px;'><img alt='其他' class='img-circle' style='height:18px;width:18px;' src="+ctx+"/img/jt/notice/level"+h[f].level+".png></div><div class='col-xs-11' style='padding:0px;'>"+c._dealSoFollowContent(h[f].content)+"</div>");
}else{if("others"==h[f].type&&h[f].content.indexOf("【订单】")>-1){k.append("<div class='col-xs-1' style='padding:0px;'><img alt='其他' class='img-circle' style='height:18px;width:18px;' src="+ctx+"/img/jt/notice/level"+h[f].level+".png></div><div class='col-xs-11' style='padding:0px;'>"+c._dealSoContent(h[f].content)+"</div>");
}else{if("assign"==h[f].type){k.append("<div class='col-xs-1' style='padding:0px;'><img alt='其他' class='img-circle' style='height:18px;width:18px;' src="+ctx+"/img/jt/notice/level"+h[f].level+".png></div><div class='col-xs-11' style='padding:0px;'>"+c._dealAssignContent(h[f].content)+"</div>");
}else{k.append("<div class='col-xs-1' style='padding:0px;'><img class='img-circle' style='height:18px;width:18px;' src='"+ctx+"/img/jt/notice/level"+h[f].level+".png'></div><div class='col-xs-11' style='padding:0px;'>"+h[f].content+"</div>");
}}}}k.append("</div>");k.append("<div class='col-xs-1'><button class='btn btn-danger btn-sm pull-right deleteMsg' idVal='"+h[f].id+"' type='button'><i class='fa fa-remove'></i></button></div>");
k.append("</div>");k.append("</div>");if(f==c.rowItem-1){break;}}$("#msgDiv").append(k.toString());c._judeNextBtn(c.currentMsgItem,c.totalMsgItem);c._judePrevBtn(c.currentMsgItem);
},_dealAssignContent:function(d){var c="";c=d.replace(/\d{1,5}/g,function(e){var f=new StringBuffer();f.append("<strong>");f.append(e);f.append("</strong>");
return f.toString();});return c;},_dealCsContent:function(d){var c="";c=d.replace(/\d{3,12}:/g,function(f){var e=f.substring(0,f.length-1);var g=new StringBuffer();
g.append("<strong>");g.append(e);g.append("</strong>");g.append(":");return g.toString();});return c;},_dealSoContent:function(d){var c="";c=d.replace(/\d{3,12}】/g,function(f){var e=f.substring(0,f.length-1);
var g=new StringBuffer();g.append("<strong>");g.append(e);g.append("</strong>");g.append("】");return g.toString();});return c;},_dealSoFollowContent:function(d){var c="";
c=d.replace(/\d{3,12}：/g,function(f){var e=f.substring(0,f.length-1);var g=new StringBuffer();g.append("<strong>");g.append(e);g.append("</strong>");g.append("：");
return g.toString();});return c;},};var a=new b();a.init();});function LeaderIndex(a){this.communicate="phone";this.ldTime=2*60*1000;this.sumTarget=0;}LeaderIndex._CONS_={LD_RANK_URL:ctx+"/ec/rp/reportProfit/leardSaleRank.htm",LD_RANK_GRID:"#ld-rank-grid",LD_DEAL_URL:ctx+"/ec/salesorder/soEntity/realTimePlaceData.htm",LD_DEAL_GRID:"#ld-deal-grid",DE_IMG:'<img style=\'width:100px; height:100px;\' alt="默认图片"  src="'+ctx+'/img/jt/nophoto.png" />',};
LeaderIndex.prototype={init:function(){var a=this;a.loadData();a.initLdRankGrid();a.initLdCommunicationViewer();a.initLdDealGrid();a.refreshLdDealGrid();
a.initLdIssueViewer();a.resizeViewer();a.bindEventListener();},resizeViewer:function(){var a=this;$(window).on("resize",function(){a.initLdCommunicationViewer();
a.initLdIssueViewer();});},bindEventListener:function(){var a=this;$(document).on("click",".ld-communicate-btn > div",function(b){if(!$(this).is(".ld-active")){$(".ld-active").removeClass("ld-active");
$(this).addClass("ld-active");}if($(this).is(".ld-com-phone")){a.communicate="phone";a.initLdCommunicationViewer();}else{if($(this).is(".ld-com-weixin")){a.communicate="wx";
a.initLdCommunicationViewer();}}});},initLdCommunicationViewer:function(c,d){var b=this;var a=ctx+"/gl/cti/tRKSheetRecord/loadRecordSpread.htm";if(b.communicate=="wx"){a=ctx+"/crm/report/weiXinFriendQtyReport/wxChatSpread.htm";
}FormUtils.loadData(a,function(f){var e=[];if(b.communicate=="wx"){e=["00:00","01:00","02:00","03:00","04:00","05:00","06:00","07:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00","24:00"];
}else{e=["00:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","24:00"];}var f=f;option={grid:{x:50,y:25,x2:10,y2:25},tooltip:{trigger:"axis",position:function(g){return[g[0],"0%"];
}},title:{left:"30",textStyle:{color:"#555",fontStyle:"normal",fontWeight:"500",fontFamily:"sans-serif",fontSize:12},text:"数量",},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:false,data:e},yAxis:{type:"value",boundaryGap:[0,"100%"]},series:[{data:f,name:"沟通量",type:"line",smooth:true,itemStyle:{normal:{color:"#1c84c6"}},areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(28, 132, 198, .15)"},{offset:1,color:"rgba(28, 132, 198, .75)"}])}}}]};
echarts.init(document.getElementById("ld-communicate-viewer")).setOption(option);});},initLdIssueViewer:function(){var a=this;FormUtils.loadData(ctx+"/ec/rp/reportProfit/leadSoConfirmProfit.htm",function(c){var b=["00:00","08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","24:00"];
var c=c;option={grid:{x:50,y:30,x2:20,y2:25},tooltip:{trigger:"axis",position:function(d){return[d[0],"0%"];}},title:{left:"30",textStyle:{color:"#555",fontStyle:"normal",fontWeight:"500",fontFamily:"sans-serif",fontSize:12},text:"金额",},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},restore:{},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:false,data:b},yAxis:{type:"value",boundaryGap:false},series:[{name:"金额",data:c,type:"line",smooth:true,itemStyle:{normal:{color:"#1c84c6"}},areaStyle:{normal:{color:new echarts.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(28, 132, 198, .15)"},{offset:1,color:"rgba(28, 132, 198, .75)"}])}}}]};
echarts.init(document.getElementById("ld-issue-viewer")).setOption(option);});},initLdRankGrid:function(b){var a=this;if(b==null||typeof b==undefined){b={};
}$(LeaderIndex._CONS_.LD_RANK_GRID).JTJqgrid({url:LeaderIndex._CONS_.LD_RANK_URL,width:"100%",height:"100%",autowidth:true,postData:b,footerrow:false,userDataOnFooter:true,sortable:false,multiselect:false,rownumWidth:25,rowNum:1000,colNames:["员工","部门","新进客户","总下单金额"],colModel:[{name:"employee",sortable:false,align:"center",width:100,formatter:function(c,d,e){return"<div class='ld-profile-layer'><img class='ld-profile' onerror='onImageError()' src='"+ctx+e.profile+"'></div><div class='ld-basic-layer'>&nbsp;"+e.placerAid+":"+e.placerName+"</div>";
}},{name:"groupName",sortable:false,align:"center",width:100},{name:"countNewCs",sortable:false,align:"center",width:100,formatter:function(c,d,e){return"<font style='color:#333'>"+c+"</font>";
}},{name:"totalMoney",sortable:false,align:"center",width:100,formatter:function(c,d,e){return"<font style='color:blue;font-weight:bold'>"+e.placeCount+"/</font><font style='color:red;font-weight:bold'>"+e.totalAmount+"</font>";
}}],loadComplete:function(){$(LeaderIndex._CONS_.LD_RANK_GRID).find(".ld-profile").off().each(function(c,d){$(this).load(function(){$(this).attr("style",imgStyle($(this)[0].naturalWidth,$(this)[0].naturalHeight,35));
});});},gridComplete:function(){var c=$(LeaderIndex._CONS_.LD_RANK_GRID).closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").height()-5;if(c<275){c=275;}$(LeaderIndex._CONS_.LD_RANK_GRID).find("tr.jqgrow").css({"height":c/5+"px"});
},ondblClickRow:function(c){},});},initLdDealGrid:function(b){var a=this;if(b==null||typeof b==undefined){b={};}$(LeaderIndex._CONS_.LD_DEAL_GRID).JTJqgrid({url:LeaderIndex._CONS_.LD_DEAL_URL,width:"100%",height:"100%",autowidth:true,postData:b,footerrow:false,userDataOnFooter:true,sortable:false,multiselect:false,rownumWidth:25,rowNum:1000,colNames:["员工","部门","订单编号","下单金额","下单产品"],colModel:[{name:"employee",sortable:false,align:"center",width:100,formatter:function(c,d,e){return"<div class='ld-profile-layer'><img class='ld-profile' onerror='onImageError()' src='"+ctx+e.profile+"'></div><div class='ld-basic-layer'>&nbsp;"+e.placerAid+":"+e.placerName+"</div>";
}},{name:"groupName",sortable:false,align:"center",width:100},{name:"soNo",sortable:false,align:"center",width:110,formatter:function(c,d,e){return"<font style='color:#0099FF'>"+c+"</font>";
}},{name:"totalAmount",sortable:false,align:"center",width:80,formatter:function(c,d,e){return"<font style='color:red;font-weight:bold'>"+c+"</font>";}},{name:"prodNames",sortable:false,align:"center",width:150}],loadComplete:function(){$(LeaderIndex._CONS_.LD_DEAL_GRID).find(".ld-profile").off().each(function(c,d){$(this).load(function(){$(this).attr("style",imgStyle($(this)[0].naturalWidth,$(this)[0].naturalHeight,35));
});});},gridComplete:function(){var c=$(LeaderIndex._CONS_.LD_RANK_GRID).closest(".ui-jqgrid").find(".ui-jqgrid-bdiv").height()-5;if(c<275){c=275;}$(LeaderIndex._CONS_.LD_DEAL_GRID).find("tr.jqgrow").css({"height":c/5+"px"});
},ondblClickRow:function(c){},});},reloadLdDealGrid:function(){var a=this;$(LeaderIndex._CONS_.LD_DEAL_GRID).trigger("reloadGrid");},refreshLdDealGrid:function(){var a=this;
a.ldDealTimer=setInterval(function(){a.reloadLdDealGrid();},a.ldTime);},loadData:function(){var a=this;FormUtils.loadData(ctx+"/gl/ou/employeeTarget/mouthTarget.htm",function(b){if(b.length==0){a.sumTarget=0;
}else{$("#ld-target").attr("data-to",b[0].sumTarget).attr("data-speed",b[0].sumTarget);a.sumTarget=b[0].sumTarget;}a.isTarget=true;a.dataUp([$("#ld-target")]);
});FormUtils.loadData(ctx+"/ec/rp/reportProfit/countProfit.htm",function(b){$("#ld-total-current").attr("data-to",b[0].todayProfit).attr("data-speed",b[0].todayProfit);
$("#ld-already").empty().text(b[0].sumComProfit);$("#ld-total-yesterday").attr("data-to",b[0].lastdayProfit).attr("data-speed",b[0].lastdayProfit);if(b[0].todayProfit<b[0].lastdayProfit){$(".ld-arrow").addClass("fa-long-arrow-down").removeClass("fa-long-arrow-up");
}$(".ld-arrow").stop().show("slow");a.sumComProfit=b[0].sumComProfit;a.waitTarget=setInterval(function(){a.loadPercent();},250);a.dataUp([$("#ld-total-current"),$("#ld-total-yesterday")]);
});FormUtils.loadData(ctx+"/crm/cs/csEntity/sumNewCs.htm",function(b){$("#ld-nc-current").attr("data-to",b[0].todayCount).attr("data-speed",b[0].todayCount);
$("#ld-nc-yesterday").attr("data-to",b[0].lastdayCount).attr("data-speed",b[0].lastdayCount);a.dataUp([$("#ld-nc-current"),$("#ld-nc-yesterday")]);});FormUtils.loadData(ctx+"/crm/ou/employee/onlineEmpAndWx.htm",function(b){$("#ld-sys-total").attr("data-to",b[0].onlineEmp).attr("data-speed",b[0].onlineEmp);
$("#ld-wx-total").attr("data-to",b[0].onlineWx).attr("data-speed",b[0].onlineWx);a.dataUp([$("#ld-sys-total"),$("#ld-wx-total")]);});},loadPercent:function(){var a=this;
if(a.isTarget){var b=a.getFinishPercent(a.sumComProfit,a.sumTarget);$("#ld-percent-int").attr("data-to",b[0]).attr("data-speed",b[0]);$("#ld-percent-float").attr("data-to",b[1]).attr("data-speed",b[1]);
a.dataUp([$("#ld-percent-int"),$("#ld-percent-float")]);clearInterval(a.waitTarget);a.waitTarget=null;}},dataUp:function(b){var a=this;if(b){$.each(b,function(d,f){var c={to:$(this).attr("data-to"),speed:100};
$(this).data("countToOptions",c);$(this).each(count);});}},getFinishPercent:function(d,c){var a=this;var b=0;if(c>0){b=(d/c)*100;if(b>999.9){b=999.9;}}else{b=100;
}b=b.toFixed(1);b+="";return b.split(".");}};$.fn.countTo=function(a){a=a||{};return $(this).each(function(){var c=$.extend({},$.fn.countTo.defaults,{from:$(this).data("from"),to:$(this).data("to"),speed:$(this).data("speed"),refreshInterval:$(this).data("refresh-interval"),decimals:$(this).data("decimals")},a);
var h=Math.ceil(c.speed/c.refreshInterval),i=(c.to-c.from)/h;var j=this,f=$(this),e=0,g=c.from,d=f.data("countTo")||{};f.data("countTo",d);if(d.interval){clearInterval(d.interval);
}d.interval=setInterval(k,c.refreshInterval);b(g);function k(){g+=i;e++;b(g);if(typeof(c.onUpdate)=="function"){c.onUpdate.call(j,g);}if(e>=h){f.removeData("countTo");
clearInterval(d.interval);g=c.to;if(typeof(c.onComplete)=="function"){c.onComplete.call(j,g);}}}function b(m){var l=c.formatter.call(j,m,c);f.html(l);}});
};$.fn.countTo.defaults={from:0,to:0,speed:1,refreshInterval:0.5,decimals:0,formatter:formatter,onUpdate:null,onComplete:null};function formatter(b,a){return b.toFixed(a.decimals);
}function count(a){var b=$(this);a=$.extend({},a||{},b.data("countToOptions")||{});b.countTo(a);}function imgStyle(b,c,a){if(b>c){return"height:100% !important;left:-"+(a*(1-(c/b)))/2+"px;width:auto !important;";
}else{if(b==c){return null;}else{if(b<c){return"top:-"+(a*(1-(b/c)))/2+"px;";}}}}