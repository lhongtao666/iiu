$(function(){var a=new Cate();a.init();});function Cate(){this.hadInit=false;this.isEdit=false;this.cateTypeStat="";this.cateTypeImg="";this.newCateParentId="";
this.currentCate=null;}Cate._CONS_={LIST_CATE_TREE_URL:ctx+"/gl/cate/cate/listCateTree.htm",LIST_CATE_TYPE_URL:ctx+"/gl/cate/cateType/listData.htm?Q__S__IN__key_=AddressCateType,soEntity",LOAD_CATE_DATA:ctx+"/gl/cate/cate/load.htm",SAVE_ADD_URL:ctx+"/gl/cate/cate/saveAdd.htm",SAVE_EDIT_URL:ctx+"/gl/cate/cate/saveEdit.htm",DELETE_URL:ctx+"/gl/cate/cate/delete.htm",MOVE_URL:ctx+"/gl/cate/cate/moveSort.htm"};
Cate.prototype={init:function(a){this._loadCateType();this._bindEventHanlder();this._bindFormValidation();this._showTab();},_loadCateTree:function(c){var a=this;
var b={treeId:"cateTree",cateTypeKey:c,rootKey:c+"-root",userId:"",contextMenu:{add:{isShow:true,title:"添加分类",clickFn:function(d){},clazz:"addCateBtn"},update:{isShow:false,title:"更新分类",clickFn:function(){},clazz:"updateCateBtn"},del:{isShow:true,title:"删除分类",clickFn:function(d){DialogUtils.confirm(function(){FormUtils.submit(Cate._CONS_.DELETE_URL,"id="+d.id,function(f){if(f.success){var e=$.fn.zTree.getZTreeObj("cateTree");
e.removeNode(d);DialogUtils.success(msgCode.SUCCESS,f.msg);}else{DialogUtils.error(msgCode.ERROR,f.msg);}});});},clazz:"deleteCateBtn"},},saveFn:function(d){a._edit(d.id);
},onClick:function(d){a.currentCate=d;a._edit(d.id);}};ZtreeUtils.init(b,true);},_edit:function(a){FormUtils.disableForm("cateForm1");$("#saveCateBtn").hide();
$("#cancelCateBtn").hide();$("#editCateBtn").hide();this._loadCateData(a);},_showTab:function(a){if(a&&a.hasStat=="y"){$("#hasStatLi").show();this._loadCateTypeStatStr($("#cateTypeSelect").val(),a.key+"Stat");
}else{$("#hasStatDiv").removeClass("active");$("#hasStatLi").hide();}if(a&&a.hasImg=="y"){$("#hasImgLi").show();this._loadCateTypeImgStr($("#cateTypeSelect").val(),a.key+"Img");
}else{$("#hasImgLi").hide();$("#hasImgDiv").removeClass("active");}if(a&&a.hasStat=="y"&&a&&a.hasImg=="y"){$("#hasStatLi").addClass("active");$("#hasStatDiv").addClass("active");
$("#hasImgLi").removeClass("active");$("#hasImgDiv").removeClass("active");}},_loadCateType:function(){var a=this;FormUtils.loadData(Cate._CONS_.LIST_CATE_TYPE_URL,function(b){if(!b||!b.rows||b.rows.length==0){DialogUtils.error("错误","系统无任何目录数据，请前往目录管理，添加数据");
return;}var e=new StringBuffer();for(var c=0;c<b.rows.length;c++){var d=b.rows[c];e.append("<option value='").append(d.key).append("'>").append(d.name).append("</option>");
}$("#cateTypeSelect").empty().append(e.toString());a._loadCateTree(b.rows[0].key);});},_save:function(){var b=this;if($("#cateForm1").valid()){ButtonUtils.disableBtn("saveCateBtn");
var a=$("input[name='id']").val()?Cate._CONS_.SAVE_EDIT_URL:Cate._CONS_.SAVE_ADD_URL;FormUtils.submit(a,$("#cateForm1").serialize()+"&"+$("#statForm").serialize()+"&"+$("#imgForm").serialize(),function(d){ButtonUtils.enableBtn("saveCateBtn");
if(d.success){DialogUtils.success("成功","更新成功");if(d.msgCode==actionCode.UPDATE){var c=$.fn.zTree.getZTreeObj("cateTree");b.currentCate.name=$("input[name='name']").val();
b.currentCate.key=$("input[name='key']").val();c.updateNode(b.currentCate);}$("#statTable").find("tbody").empty();$("#imgTable").find("tbody").empty();
$("#saveCateBtn").hide();$("#cancelCateBtn").hide();$("#editCateBtn").hide();b._loadCateData(b.currentCate.id);ButtonUtils.disableBtn("selectDefaultImageBtn");
FormUtils.disableForm("cateForm1");}else{DialogUtils.error("错误",d.msg);}},function(){ButtonUtils.enableBtn("saveCateBtn");DialogUtils.error("错误","网络错误，请稍候重试");
});}},_bindEventHanlder:function(){var a=this;$("#selectDefaultImageBtn").click(function(){if($("input[name='key']:disabled").size()==1){return;}SelectZtreeIconUtils.selectZtreeIcon(function(b){$("#iconUrl").val(b);
$("#defaultImgDiv").attr("src",ctx+"/js/zTree_v3/css/zTreeStyle/img/jt-diy/"+b+".png");});});$("#cateTypeSelect").on("change",function(){var b=$("#cateTypeSelect").val();
a._loadCateTree(b);FormUtils.clear("cateForm1");$("#iconUrl").attr("src","");$("#saveCateBtn").hide();$("#editCateBtn").hide();$("#cancelCateBtn").hide();
});$("#editCateBtn").on("click",function(){FormUtils.enableForm("cateForm1");$(this).hide();ButtonUtils.enableBtn("selectDefaultImageBtn");$("#saveCateBtn").show();
$("#cancelCateBtn").show();});$("#saveCateBtn").on("click",function(){$("#cateForm1 input[name='sort']").val($("#sortInput").val());a._save();});$("#cancelCateBtn").on("click",function(){$(this).hide();
$(this).prev().hide();$(this).prev().prev().show();FormUtils.disableForm("cateForm1");ButtonUtils.disableBtn("selectDefaultImageBtn");a._loadCateData(a.currentCate.id);
});},_loadCateData:function(b){var a=this;$("#editCateBtn").show();FormUtils.loadData(Cate._CONS_.LOAD_CATE_DATA+"?id="+b,function(c){a._showTab(c);$("input[name='id']").val(c.id);
$("input[name='typeKey']").val(c.typeKey);$("input[name='depth']").val(c.depth);$("input[name='hasChild']").val(c.hasChild);$("input[name='parentId']").val(c.parentId);
$("input[name='userId']").val(c.userId);$("input[name='createTime']").val(c.createTime);$("input[name='path']").val(c.path);$("input[name='name']").val(c.name);
$("input[name='key']").val(c.key);$("input[name='subName']").val(c.subName);$("input[name='iconUrl']").val(c.iconUrl);if(c.iconUrl){$("#defaultImgDiv").attr("src",ctx+"/js/zTree_v3/css/zTreeStyle/img/jt-diy/"+c.iconUrl+".png");
}$("input[name='sort']").val(c.sort);});},_bindFormValidation:function(){var a={rules:{name:{required:true},key:{required:true},sort:{digits:true}}};FormUtils.bindFormValidation("cateForm1",a);
}};