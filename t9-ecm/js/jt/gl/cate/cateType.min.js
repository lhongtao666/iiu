$(function(){var a=new CateType();a.init();});function CateType(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}CateType._CONS_={GRID:"#cateTypeGrid",PAGER:"#cateTypePager",LIST_DATA_URL:ctx+"/gl/cate/cateType/listData.htm",EDIT_URL:ctx+"/gl/cate/cateType/edit.htm",DELETE_URL:ctx+"/gl/cate/cateType/delete.htm",SAVE_ADD_URL:ctx+"/gl/cate/cateType/saveAdd.htm",SAVE_EDIT_URL:ctx+"/gl/cate/cateType/saveEdit.htm"};
CateType.prototype={init:function(){this._bindFormValidation();this._bindEventHandler();this._initJqgrid();this._hideNotGrantBtn();},clear:function(c){var a=this;
function b(){a._showListWrapper();FormUtils.clear("cateTypeForm");$("#resTip").text("").hide();a.isFormDataChange=false;if(c){a.reloadJqgrid();}}if(a.isEdit&&a.isFormDataChange){DialogUtils.warning(function(){b();
});}else{b();}},_bindEventHandler:function(){var a=this;$(".list_wrapper").on("click",".cateTypeAdd",function(){a._add();});$("body").on("click",".cateTypeEdit",function(){a.isEdit=true;
var b=$(this).attr("idVal");if(!b){b=$(CateType._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error("错误","请选择要更新的记录");
return;}if(b.length>1){DialogUtils.error("错误","不能同时编辑多条记录");return;}}a._edit(b);});$("body").on("click",".cateTypeDel",function(){var b=$(this).attr("idVal");
if(!b){b=$(CateType._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error("错误","请选择要删除的记录");return;}}a._delete(b);
});$("body").on("click",".cateTypeDetail",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(CateType._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error("错误","请选择要查看明细的记录");return;}if(b.length>1){DialogUtils.error("错误","不能同时查看多条记录");return;}}a._detail(b);});$(".list_wrapper").on("click",".cateTypeSearch",function(){var b=$(this).closest("form").serialize();
a.reloadJqgrid(b);});$("#cateTypeSearchForm").on("keypress",function(b){if(b.keyCode=="13"){$(".cateTypeSearch").eq(0).trigger("click");}});$(".wrapper").on("click",".prevBtn",function(){a.clear(false);
});$(".wrapper").on("click",".saveBtn",function(){a._save();});$(".form_wrapper").on("change","input",function(){if(a.isEdit){a.isFormDataChange=true;}});
$(".form_wrapper").on("change",".form_wrapper select",function(){if(a.isEdit){a.isFormDataChange=true;}});$(".form_wrapper").on("change",".form_wrapper textarea",function(){if(a.isEdit){a.isFormDataChange=true;
}});},_bindFormValidation:function(){var a={rules:{name:{required:true},key:{required:true},sort:{digits:true}}};},_initJqgrid:function(){var a=this;$(CateType._CONS_.GRID).JTJqgrid({url:CateType._CONS_.LIST_DATA_URL,pager:CateType._CONS_.PAGER,colNames:["名称","编码","排序号","创建时间","操作"],colModel:[{name:"name",index:"name_",width:120},{name:"key",width:120,index:"key_"},{name:"sort",width:120,index:"sort_"},{name:"createTime",width:120,index:"create_time_",},{name:"__manage",width:40,classes:"rowOps",sortable:false,align:"center",formatter:"manage",title:"操作",formatoptions:a._getManagerBtns()},]});
},reloadJqgrid:function(f){var e={};if(f&&jQuery.type(f)=="string"){f=decodeURIComponent(f,true);var b=f.split("&");if(b.length){for(var c=0;c<b.length;
c++){var d=b[c].split("=");if(d.length==2&&d[1]){e[d[0]]=d[1];}else{e[d[0]]=d[1];}}}}else{e=f;}var a=$(CateType._CONS_.GRID).jqGrid("getGridParam","postData");
$.extend(a,e);$(CateType._CONS_.GRID).jqGrid("setGridParam",{search:true}).trigger("reloadGrid",[{page:1}]);},_getManagerBtns:function(){var a=[];if(ResUtils.canShow("cateType.button.delete")){a.push({lable:"删除",btnClasses:"btn btn-danger cateTypeDel",iconClasses:"fa fa-remove"});
}if(ResUtils.canShow("cateType.button.edit")){a.push({lable:"编辑",btnClasses:"btn btn-primary cateTypeEdit",iconClasses:"fa fa-edit"});}if(ResUtils.canShow("cateType.button.detail")){a.push({lable:"明细",btnClasses:"btn btn-primary cateTypeDetail",iconClasses:"fa fa-th-list"});
}return a;},_hideNotGrantBtn:function(){if(!ResUtils.canShow("cateType.button.detail")){$(".cateTypeDetail").hide();}if(!ResUtils.canShow("cateType.button.add")){$(".cateTypeAdd").hide();
}if(!ResUtils.canShow("cateType.button.edit")){$(".cateTypeEdit").hide();}if(!ResUtils.canShow("cateType.button.delete")){$(".cateTypeDel").hide();}},_showListWrapper:function(){$(".list_wrapper").show();
$(".form_wrapper").hide();},_showFormWrapper:function(){$(".list_wrapper").hide();$(".form_wrapper").show();},_add:function(){FormUtils.enableForm("cateTypeForm");
this._showFormWrapper();},_edit:function(a){this._showFormWrapper();$(".saveBtn").show();this._loadData(a);FormUtils.enableForm("cateTypeForm");},_loadData:function(a){FormUtils.loadData(CateType._CONS_.EDIT_URL+"?id="+a,function(b){$("input[name=id]").val(b.id);
$("input[name=name]").val(b.name);$("input[name=key]").val(b.key);$("input[name=sort]").val(b.sort);$("input[name=createTime]").val(b.createTime);});},_save:function(){var b=this;
if($("#cateTypeForm").valid()){var a=$("input[name='id']").val()?CateType._CONS_.SAVE_EDIT_URL:CateType._CONS_.SAVE_ADD_URL;FormUtils.submitByFormId(a,"cateTypeForm",function(c){ButtonUtils.enableBtn("saveBtn");
if(c.success){DialogUtils.success("成功",c.msg);b.isEdit=false;b.clear(true);}else{DialogUtils.error("失败",c.msg);}},function(){ButtonUtils.enableBtn("saveBtn");
DialogUtils.error("失败","连接错误，请稍候重试");});}},_detail:function(a){this._showFormWrapper();this._loadData(a);FormUtils.disableForm("cateTypeForm");$(".saveBtn").hide();
},_delete:function(b){var a=this;DialogUtils.confirm(function(){FormUtils.del(CateType._CONS_.DELETE_URL,b,function(c){if(c.success){DialogUtils.success("成功",c.msg);
a.reloadJqgrid();}else{DialogUtils.error("失败",c.msg);}});});}};