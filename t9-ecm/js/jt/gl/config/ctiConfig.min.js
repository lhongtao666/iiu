$(function(){var a=new CtiConfig();a.init();});function CtiConfig(){this.cateId="";this.cateTree=null;}CtiConfig._CONS_={LIST_DATA_URL:ctx+"/gl/config/ctiConfig/listData.htm",DELETE_URL:ctx+"/gl/config/ctiConfig/delete.htm",SAVE_EDIT_URL:ctx+"/gl/config/ctiConfig/saveEdit.htm",SAVE_ADD_URL:ctx+"/gl/config/ctiConfig/saveAdd.htm"};
CtiConfig.prototype={init:function(){this._bindEventHandler();this._initTab();this._bindFormValidation();},_bindEventHandler:function(){var a=this;$("body").on("click","#left-side li",function(){$(".tabLi").removeClass("active");
$(this).addClass("active");$(".tabContent").removeClass("active");$("#"+$(this).attr("data-value")).addClass("active");});if(ResUtils.canShow("ctiParamConfig.button.edit")){$("body").on("dblclick",".config-val",function(){var b=$(this).text();
var c=$(this).attr("idVal");$(this).empty().append('<input class="config-val-setting" style="color:#1caf9a;" idVal="'+c+'"  value="'+b+'">');});}$("body").on("blur",".config-val-setting",function(){var c=$(this).attr("idVal");
var b=$(this).val();a._editParam(c,b);});$("body").on("change",".task-select",function(){var c=$(this).attr("idVal");var b=$(this).val();a._editParam(c,b);
});if(ResUtils.canShow("ctiParamConfig.button.add")){$("body").on("click",".ctiConfigAdd",function(){var b=$(this).attr("data-value");a._openEditDialog(b);
});}if(ResUtils.canShow("ctiParamConfig.button.delete")){$("body").on("click",".ctiConfigDel",function(){var b=$(this).attr("idval");DialogUtils.confirm(function(){FormUtils.del(CtiConfig._CONS_.DELETE_URL,b,function(c){if(c.success){if(c.msgCode==actionCode.DELETE){a._initTab();
DialogUtils.success(actionCode.INFO,msgCode.DELETE_MSG);}}else{DialogUtils.success(actionCode.FAIL,msgCode.FAIL_MSG);}});});});}},_editParam:function(d,b){var a=this;
var c={};c.id=d;c.value=b;FormUtils.submit(CtiConfig._CONS_.SAVE_EDIT_URL,c,function(e){if(e.success){a._initTab();if(e.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);
}else{if(e.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);}}}else{DialogUtils.error(msgCode.FAIL,e.msg);}},null,true);
},save:function(c){var b=this;if($("#ctiConfigForm").valid()){var d=$("#ctiConfigForm").serialize();var a=$("input[name='id']").val()?CtiConfig._CONS_.SAVE_EDIT_URL:CtiConfig._CONS_.SAVE_ADD_URL;
FormUtils.submit(a,d,function(e){if(e.success){b._initTab();layer.close(c);FormUtils.clear("ctiConfigForm");if(e.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);
}else{if(e.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);}}}else{DialogUtils.error(msgCode.FAIL,e.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}},_bindFormValidation:function(a){if(a==null){a={rules:{name:{required:true,},dataType:{required:true,},key:{required:true}}};}FormUtils.bindFormValidation("ctiConfigForm",a);
},_initTab:function(){FormUtils.loadData(CtiConfig._CONS_.LIST_DATA_URL,function(d){if(d&&d.length){var g="";var h="";var b="";var f="";var c="";var j="";
for(var e=0;e<d.length;e++){var a=d[e];j='<div class="col-sm-4">'+'<div class="task-item task-primary">'+'<div class="col-sm-11 titleContent">'+'<div class="task-text ui-sortable-handle">'+'<span style="font-size:15px;">'+a.name+"</span><br>";
if(a.desc){j+='<span style="color:red;font-size:8px;">描述：'+a.desc+"</span>";}j+="</div>"+"</div>"+'<div class="task-footer">'+'<div class="pull-left"><span class="fa fa-key"></span> <span >'+a.key+"<span></div>"+'<div class="pull-right" ">'+'<span class="fa fa-edit"></span> ';
j+=a.showHtml+"</div>"+"</div>"+"</div>"+"</div>";if("1"==a.typeKey){g+=j;}else{if("2"==a.typeKey){h+=j;}else{if("3"==a.typeKey){b+=j;}else{if("4"==a.typeKey){f+=j;
}else{if("5"==a.typeKey){c+=j;}}}}}}g+='<div class="col-sm-4"><button type="button" class="ctiConfigAdd" data-value="1"></button></div>';h+='<div class="col-sm-4"><button type="button" class="ctiConfigAdd" data-value="2"></button></div>';
b+='<div class="col-sm-4"><button type="button" class="ctiConfigAdd" data-value="3"></button></div>';f+='<div class="col-sm-4"><button type="button" class="ctiConfigAdd" data-value="4"></button></div>';
c+='<div class="col-sm-4"><button type="button" class="ctiConfigAdd" data-value="5"></button></div>';$("#adnLine").empty().append(g);$("#telData").empty().append(h);
$("#spreadConfig").empty().append(b);$("#recordParam").empty().append(f);$("#ctiType").empty().append(c);}});},_openEditDialog:function(b){var a=this;layer.open({type:1,title:["添加cti配置","text-align:center"],shadeClose:false,btn:["保存","关闭"],area:["35%","45%"],content:$(".ctiConfigEditContent"),success:function(c,d){$(".ctiConfigEditContent").find("input[name=typeKey]").val(b);
},yes:function(d,c){a.save(d);},cancel:function(){FormUtils.clear("ctiConfigForm");}});},};