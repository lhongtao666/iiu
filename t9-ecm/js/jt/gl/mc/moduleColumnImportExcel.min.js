$(function(){var a=new ModuleColumnImportExcel();a.init();});function ModuleColumnImportExcel(){this.files=[];this.fileSingleSizeLimit=0;}ModuleColumnImportExcel._CONS_={};
ModuleColumnImportExcel.prototype={init:function(b){var a=this;a._findMaxFileSize();if(isCreateSub=="isCreateSub"&&ResUtils.canShow("csEntity.sub.batchCreate")){$(".csEntityImport").show();
}},_findMaxFileSize:function(){var a=this;ConfigUtils.findByKey("system.fileUploadMaxSize",function(b){a.fileSingleSizeLimit=b.msg*1024*1024;a._bindEventHander();
a._bindExceluploader();});},_bindEventHander:function(){var a=this;$(document).on("click",".importBtn",function(){a._importExcel();});$(document).on("click",".closeBtn",function(){if($(".csEntityImport").is(":visible")){JTTabUtils.closeTab(ctx+"/gl/mc/moduleColumn/importExcel.htm?importUrl="+importUrl+"&isCreateSub=isCreateSub");
}else{JTTabUtils.closeTab(ctx+"/gl/mc/moduleColumn/importExcel.htm?importUrl="+importUrl);}$(".csEntityImport").hide();});},_bindExceluploader:function(){var b=this;
function c(h,g){if(g.flag){var i={path:g.localPath,name:g.fileName,};b.files.push(i);}}function a(g,h){alert("上传"+g.name+"失败，原因是"+h);}function e(){b._importExcel();
}var d={"acceptTypes":".*","mimeTypes":".xls,.xlsx","fileSingleSizeLimit":b.fileSingleSizeLimit,"fileNumLimit":1,"uploadUrl":ctx+"/crm/components/upload/ajax.htm?categoryDir=temp"};
var f=new JTWebUploader({config:d,container:"uploader",caption:"支持上传：.xls格式文件，文件最大为"+b.fileSingleSizeLimit/(1024*1024)+"MB, <p style='color:red;font-size: 10px;'>导入操作是个很耗费资源的操作，数据量大时务必在非高峰期导入</p>",success:c,error:a,finish:e});
f.init();},_importExcel:function(){var b=this;var a=b.files;if(a==null||a.length<=0){DialogUtils.error(msgCode.ERROR,"请选上传文件");}else{var c=$("input[name=isCreateSub]:checked").val();
FormUtils.submit(importUrl,{fileJson:JSON.stringify(a),isCreateSub:c},function(e){if(e.success){b.files=[];b._bindExceluploader();DialogUtils.success("提示","导入结束");
if(importType=="ctiConfigImport"){if(e&&e.msg){var d=e.msg.split("\n");window.location.href=ctx+"/gl/cti/glCti/exportFile.htm?path="+d[0]+"&fileType=1";
setTimeout(function(){window.location.href=ctx+"/gl/cti/glCti/exportFile.htm?path="+d[1]+"&fileType=2";},3000);}}}else{DialogUtils.error(msgCode.ERROR,"导入失败");
b.files=[];}if(e&&e.msg){$("textarea[name='infos']").val(e.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}},};