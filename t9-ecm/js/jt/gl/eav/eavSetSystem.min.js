$(function(){var a=new EavSetSystem();a.init();});function EavSetSystem(){if(!(this instanceof EavSetSystem)){return new EavSetSystem();}else{this.eavSet=new EavSet();
}}EavSetSystem.prototype={init:function(){this._bindEventHandler();this._bindFormValidation();this._hideNotGrantBtn();$("#entityTypeContainer").find("li:eq(0)").trigger("click");
this._locateToGlHelp();},_locateToGlHelp:function(){var a="glHelp.systemconfig.eavAttr";glHelpUtil.init(a);},_bindFormValidation:function(){var a={rules:{name1:{required:true},key1:{required:true}}};
FormUtils.bindFormValidation("eavSetForm1",a);},_hideNotGrantBtn:function(){if(!ResUtils.canShow("eavSetSystem.button.saveAdd")){$("#addEavSetBtn").hide();
}if(!ResUtils.canShow("eavSetSystem.button.saveEdit")){$("#addNewAttrBtn").hide();$("#editNewAttrBtn").hide();$("#deleteNewAttrBtn").hide();$("#addNewGroupBtn").hide();
$("#saveEavSetBtn").hide();$("#selectAllAttrsBtn").parent().remove();}},_bindEventHandler:function(){var a=this;$("#entityTypeContainer").on("click",".eavSetEditBtn",function(){var b=$(this).find("a").attr("idVal");
entityType=$(this).find("a").attr("entityTypeVal");a.eavSet._edit(b,function(){});});$("#addNewAttrBtn").on("click",function(){layer.open({type:2,title:"添加属性",maxmin:false,shadeClose:true,btn:["保存","取消"],area:["80%","40%"],content:ctx+"/gl/eav/eavAttr/add.htm?entityType="+entityType+"&bizType="+bizType,yes:function(c,b){var d=window[b.find("iframe")[0]["name"]];
d.saveEav(function(){a.eavSet.initEavAttrJqgrid(true);layer.close(c);DialogUtils.success(msgCode.SUCCESS,"添加成功");});}});});$("#editNewAttrBtn").on("click",function(){var b=$(EavSet._CONS_.EAV_ATTR_GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_NO_SELECT_EDIT);return;}if(b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);
return;}a.eavSet._editAttr(b);});$("#deleteNewAttrBtn").on("click",function(){var b=$(EavSet._CONS_.EAV_ATTR_GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_NO_SELECT_DELETE);
return;}var c=ctx+"/gl/eav/eavAttr/delete.htm";DialogUtils.confirm(function(){FormUtils.del(c,b,function(d){DialogUtils.success(msgCode.INFO,d.msg);a.eavSet.initEavAttrJqgrid(true);
});});});$("#addEavSetModalContainer").on("hidden.bs.modal",function(){FormUtils.clear("eavSetForm1");}).on("shown.bs.modal",function(){$("#eavSetForm1").find('input[name="name1"]').focus();
});$("#addEavSetBtn").on("click",function(){$("#addEavSetModalContainer").modal("show");});$("#saveEavSetBtn").on("click",function(){a.eavSet._save(function(){$("#entityTypeContainer").find("li.active").trigger("click");
});});$("#saveAddEavSetBtn").on("click",function(){if($("#eavSetForm1").valid()){var b=$("input[name='name1']").val();var c=$("input[name='key1']").val();
var d={name:b,key:c,bizType:"common",status:"actived",entityType:new Date().getTime()};FormUtils.submit(EavSet._CONS_.SAVE_ADD_URL,d,function(f){if(f.success){var e="<button class='btn btn-white eavSetEditBtn' type='button' entityTypeVal='"+entityType+"' idVal='"+f.msg+"'>"+b+"</button>";
$(e).insertBefore($("#addEavSetBtn"));FormUtils.clear("eavSetForm1");$("#addEavSetModalContainer").modal("hide");DialogUtils.success(msgCode.INFO,"添加成功");
}else{DialogUtils.error(msgCode.FAIL,f.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}});this.eavSet._bindEventHandler();}};
