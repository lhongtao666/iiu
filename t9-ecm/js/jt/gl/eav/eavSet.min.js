function EavSet(){this.groupNameSortMap=new Map();this.groupMap=new Map();this.newGroupIndexList=[];this.isEdit=false;this.isFormDataChange=false;this.dataType="";
}EavSet._CONS_={GRID:"#eavSetGrid",PAGER:"#eavSetPager",EDIT_URL:ctx+"/gl/eav/eavSet/edit.htm",DETAIL_URL:ctx+"/gl/eav/eavSet/detail.htm",DELETE_URL:ctx+"/gl/eav/eavSet/delete.htm",SAVE_ADD_URL:ctx+"/gl/eav/eavSet/saveAdd.htm",SAVE_EDIT_URL:ctx+"/gl/eav/eavSet/saveEdit.htm",LIST_DATA_URL:ctx+"/gl/eav/eavSet/listData.htm",EAV_ATTR_GRID:"#eavSetSelectGrid",EAV_ATTR_PAGER:"#eavSetSelectPager",BIZ_TYPE:["common"]};
EavSet.prototype={init:function(){this._initJqgrid();this._bindEventHandler();this._bindFormValidation();this._hideNotGrantBtn();this._locateToGlHelp();
},_locateToGlHelp:function(){var a="glHelp.prodEntity.prodEavAttr.attrs";glHelpUtil.init(a);},clear:function(c){var a=this;function b(){a._showListWrapper();
FormUtils.clear("eavSetForm");a.isFormDataChange=false;$(".saveBtn").show();a.groupMap=new Map();a.newGroupIndexList=[];a.groupNameSortMap=new Map();a._resetTab();
a._showListWrapper();FormUtils.clear("eavSetForm");$("#eavSetForm").find("span.switchery").remove();$("input[name='usedStatusName']").attr("type","hidden");
$("input.js-switch").attr("checked","checked");$("input[name='status']").val("actived");$("input[name='key']").removeAttr("readonly");if($(".js-switch").length){new Switchery($(".js-switch")[0]);
}$("#selectEavAttrTable").empty();if(c){a.reloadJqgrid();}}if(a.isEdit&&a.isFormDataChange){DialogUtils.warning(function(){b();});}else{b();}},_hideNotGrantBtn:function(){if(!ResUtils.canShow("eavSet.button.detail")){$("button.eavSetDetail").hide();
}if(!ResUtils.canShow("eavSet.button.add")){$("button.eavSetAdd").hide();}if(!ResUtils.canShow("eavSet.button.edit")){$("button.eavSetEdit").hide();}if(!ResUtils.canShow("eavSet.button.delete")){$("button.eavSetDel").hide();
}if(!ResUtils.canShow("eavSetAttr.button.add")){$("#eavAttrAdd").hide();}if(!ResUtils.canShow("eavSetAttr.button.edit")){$("#eavAttrEdit").hide();}if(!ResUtils.canShow("eavSetAttr.button.delete")){$("#eavAttrDel").hide();
}},_add:function(){this.clear(false);this._showFormWrapper();this.initEavAttrJqgrid(false);},_showListWrapper:function(){$(".list_wrapper").show();$(".form_wrapper").hide();
},_showFormWrapper:function(){$(".list_wrapper").hide();$(".form_wrapper").show();var a=$(window).height()-$(".form_wrapper .panel-heading").outerHeight()-$(".saveBtn").outerHeight()-$("#tabHeaderUl").outerHeight();
$("#eavSetAttrContainer").height(a);},_edit:function(b,a){this.clear(false);this._showFormWrapper();this.isEdit=true;this._loadData(b,true,a);if($("#eavSetForm").length){FormUtils.enableForm("eavSetForm");
}},_detail:function(a){this.clear(false);this._showFormWrapper();this._loadData(a,false);$(".saveBtn").hide();if($("#eavSetForm").length){FormUtils.disableForm("eavSetForm");
}},_changeEavAttrButtonStatus:function(a){if(a){$("button.deleteGroup").removeAttr("disabled");$("button.deleteAttr").removeAttr("disabled");$("#selectAttrsBtn").removeAttr("disabled");
$("#selectAllAttrsBtn").removeAttr("disabled");$("#addNewGroupBtn").removeAttr("disabled");}else{$("button.deleteGroup").attr("disabled","disabled");$("button.deleteAttr").attr("disabled","disabled");
$("#selectAttrsBtn").attr("disabled","disabled");$("#selectAllAttrsBtn").attr("disabled","disabled");$("#addNewGroupBtn").attr("disabled","disabled");}},_loadData:function(d,c,b){var a=this;
FormUtils.loadData(EavSet._CONS_.EDIT_URL+"?id="+d,function(j){$("input[name='id']").val(j.id);$("input[name='name']").val(j.name);$("input[name='key']").val(j.key);
$("input[name='status']").val(j.status);$("textarea[name='comment']").val(j.comment);$("input[name='sort']").val(j.sort);$("input[name='createBy']").val(j.createBy);
$("input[name='createTime']").val(j.createTime);$("input[name='bizType']").val(j.bizType);var l=j.eavSetAttrPos;if(l&&l.length>0){var k=new Map();var f=new Set();
for(var h=0;h<l.length;h++){f.add(String(l[h].sort).substring(0,2));var e={id:l[h].attrId,name:l[h].attrName,key:l[h].attrKey,dataType:a._dataTypeFormatter(l[h].dataType),inputType:a._inputTypeFormmater(l[h].inputType),sort:String(l[h].sort).substring(2)};
if(k.containsKey(l[h].group)){k.get(l[h].group).push(e);}else{k.put(l[h].group,[]);k.get(l[h].group).push(e);}}var g=k.keys();for(var h=0;h<g.length;h++){a.createGroupTr(g[h],f.get(h),false);
a.createAttrsTr(g[h],k.get(g[h]));}$(".groupTree").trigger("click");a._changeEavAttrButtonStatus(c);}a.initEavAttrJqgrid(true);if(j.status=="used"){$("#eavSetForm").find("span.switchery").remove();
$("input[name='usedStatusName']").attr("type","text").val("已用");}else{if(j.status=="actived"){$("input.js-switch").attr("checked","checked");}else{$("input.js-switch").removeAttr("checked");
}$("#eavSetForm").find("span.switchery").remove();if($(".js-switch").length){new Switchery($(".js-switch")[0]);}}if(b){b();}});},_save:function(f){var e=$("#eavSetForm").valid();
if(!e){$("#normalTab").find("a").trigger("click");return;}var d=this.groupMap.isEmpty();if(d){$("#eavAttrTab").find("a").trigger("click");DialogUtils.error(msgCode.ERROR,"属性集必须有eav分组且关联属性");
return;}var c=this.validateAttrs();if(!c){$("#eavAttrTab").find("a").trigger("click");return;}if(e&&(!d)&&c){var h=$("#id").val();var a=null;if(h!=null&&h!=""){a=EavSet._CONS_.SAVE_EDIT_URL;
}else{a=EavSet._CONS_.SAVE_ADD_URL;}var g=$("#eavSetForm").serialize();g+="&entityType="+entityType;if(!$("input[name=bizType]").val()){g+="&bizType="+bizType;
}g+="&"+this.getSelectAttrs();if($(".saveBtn").length){ButtonUtils.disableBtn("saveBtn");}var b=this;FormUtils.submit(a,g,function(i){if($(".saveBtn").length){ButtonUtils.enableBtn("saveBtn");
}if(i.success){if(f){if(msgCode.actionCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);}else{if(msgCode.actionCode==actionCode.UPDATE_MSG){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
}}f();}else{b.isEdit=false;b.clear(true);if(msgCode.actionCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);}else{if(msgCode.actionCode==actionCode.UPDATE_MSG){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
}}b.reloadJqgrid();}}else{DialogUtils.error(msgCode.FAIL,i.msg);}},function(){ButtonUtils.enableBtn("saveBtn");DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}},_delete:function(a){DialogUtils.confirm(function(){FormUtils.del(EavSet._CONS_.DELETE_URL,a,function(b){if(b.success){$(EavSet._CONS_.GRID).jqGrid("setGridParam",{postData:{}}).trigger("reloadGrid");
DialogUtils.success(msgCode.INFO,msgCode.DELETE_MSG);}else{DialogUtils.error(msgCode.ERROR,b.msg);}});});},_bindFormValidation:function(){var a={rules:{name:{required:true},key:{required:true,chrnum:true},sort:{digits:true},status:{required:true},bizType:{required:true}}};
jQuery.validator.addMethod("chrnum",function(c,b,e){var d=/^[0-9a-z_]+$/;return d.test(c);},jQuery.validator.format("由小写字母，数组，下划线组成"));FormUtils.bindFormValidation("eavSetForm",a);
},_getManagerBtns:function(){var a=[];var b={colName:"status",colVals:["inactive","actived","used"],colLables:[[],[],[]],btnClasses:[[],[],[]],iconClasses:[[],[],[]]};
if(ResUtils.canShow("eavSet.button.edit")){b.colLables[0].push("编辑");b.colLables[1].push("编辑");b.colLables[2].push("编辑");b.btnClasses[0].push("btn btn-primary eavSetEdit");
b.iconClasses[0].push("fa fa-edit");b.btnClasses[1].push("btn btn-primary eavSetEdit");b.iconClasses[1].push("fa fa-edit");b.btnClasses[2].push("btn btn-primary eavSetEdit");
b.iconClasses[2].push("fa fa-edit");}if(ResUtils.canShow("eavSet.button.delete")){b.colLables[0].push("删除");b.colLables[1].push("删除");b.btnClasses[0].push("btn btn-danger eavSetDel");
b.iconClasses[0].push("fa fa-remove");b.btnClasses[1].push("btn btn-danger eavSetDel");b.iconClasses[1].push("fa fa-remove");}if(ResUtils.canShow("eavSet.button.detail")){b.colLables[0].push("明细");
b.colLables[1].push("明细");b.colLables[2].push("明细");b.btnClasses[0].push("btn btn-primary eavSetDetail");b.iconClasses[0].push("fa fa-list");b.btnClasses[1].push("btn btn-primary eavSetDetail");
b.iconClasses[1].push("fa fa-list");b.btnClasses[2].push("btn btn-primary eavSetDetail");b.iconClasses[2].push("fa fa-list");}a.push({switchCol:b});return a;
},reloadJqgrid:function(b){var a={};if(b){if(jQuery.type(b)=="string"){b+="&Q__S__EQ__entity_type_="+entityType;b+="&Q__S__EQ__biz_type_="+bizType;}else{b.Q__S__EQ__entity_type_=entityType;
b.Q__S__EQ__biz_type_=bizType;}}else{b={};b.Q__S__EQ__entity_type_=entityType;b.Q__S__EQ__biz_type_=bizType;}JTJqgridUtils.reloadJqgrid(EavSet._CONS_.GRID,b);
},_initJqgrid:function(a){$(EavSet._CONS_.GRID).JTJqgrid({url:ctx+"/gl/eav/eavSet/listData.htm",postData:{Q__S__EQ__entity_type_:entityType,Q__S__EQ__biz_type_:bizType},colNames:["名称","业务键","状态","创建时间","操作"],colModel:[{name:"name",index:"name_",width:120},{name:"key",index:"key_",width:120},{name:"status",width:40,sortable:false,formatter:function(b){if(b=="inactive"){return"<button class='jt-btn-warn'>草稿</button>";
}else{if(b=="actived"){return"<button class='jt-btn-opt'>可用</button>";}else{if(b=="used"){return"<button class='jt-btn-safe'>已用</button>";}}}}},{name:"createTime",width:120,index:"create_time_",formatter:function(b){return DateUtils.miniTime(b);
}},{name:"__manage",width:50,classes:"rowOps",sortable:false,align:"center",formatter:"manage",title:"操作",formatoptions:a?a():this._getManagerBtns()},],pager:EavSet._CONS_.PAGER,hidegrid:false});
},_resetTab:function(){$("#normalTab").addClass("active");$("#eavSetTabDiv").addClass("active");$("#eavAttrTab").removeClass("active");$("#eavSetAttrTabDiv").removeClass("active");
},_editAttr:function(b){var a=this;layer.open({type:2,title:b?"编辑属性":"添加属性",maxmin:false,shadeClose:true,btn:["保存","取消"],area:["80%","50%"],content:ctx+"/gl/eav/eavAttr/editEav.htm?attrId="+b,yes:function(e,d){var f=window[d.find("iframe")[0]["name"]];
var c={name:$("input[name='name']",f.document).val(),key:$("input[name='key']",f.document).val(),dataType:$("select[name='dataType']",f.document).find("option:selected").text(),inputType:$("select[name='inputType']",f.document).find("option:selected").text()};
f.saveEav(function(){a.initEavAttrJqgrid(true);var g=$("#selectEavAttrTable").find("tr[attrId='"+b+"']");if(g.length){g.find("td:eq(1)").find("a").text(c.name);
g.find("td:eq(2)").text(c.key);g.find("td:eq(3)").text(c.dataType);g.find("td:eq(4)").text(c.inputType);}layer.close(e);DialogUtils.success(msgCode.SUCCESS,"更新成功");
});}});},_deleteAttr:function(c){var b=ctx+"/gl/eav/eavAttr/delete.htm";var a=this;DialogUtils.confirm(function(){FormUtils.del(b,c,function(d){DialogUtils.success(msgCode.INFO,d.msg);
a.initEavAttrJqgrid(true);});});},_bindEventHandler:function(){var a=this;$("body").on("click",".editAttrBtn",function(){var b=$(this).attr("idVal");a._editAttr(b);
});$("#tabHeaderUl").on("click","li",function(b){var c=$(this).attr("id");if(c=="eavAttrTab"){if(!$("#eavSetForm").valid()){b.stopPropagation();}}});$(".js-switch").change(function(){var b=$(this).is(":checked");
if(b){$("input[name='status']").val("actived");}else{$("input[name='status']").val("inactive");}});$(".list_wrapper").on("click",".eavSetSearch",function(){var b=$("#eavSetSearchForm").serialize();
a.reloadJqgrid(b);});$("#eavSetSearchForm").on("keypress",function(b){if(b.keyCode=="13"){$(".eavSetSearch").eq(0).trigger("click");}});$(".prevBtn").on("click",function(){a.clear();
});$(".wrapper").on("click",".saveBtn",function(){a._save();});$("body").on("click",".eavSetAdd",function(){a._add();});$("body").on("click",".eavSetEdit",function(){a.isEdit=true;
var b=$(this).attr("idVal");if(!b){b=$(EavSet._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_NO_SELECT_EDIT);
return;}if(b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);return;}}a._edit(b);});$("body").on("click",".eavSetDetail",function(){a.isEdit=true;
var b=$(this).attr("idVal");if(!b){b=$(EavSet._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_NO_SELECT_RECORD);
return;}if(b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_DETAIL_MUL_RECORD);return;}}a._detail(b);});$("body").on("click",".eavSetDel",function(){var b=$(this).attr("idVal");
if(!b){b=$(EavSet._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_NO_SELECT_DELETE);
return;}}if($.isArray(b)){for(var c=0;c<b.length;c++){var e=b[c];var d=$(EavSet._CONS_.GRID).jqGrid("getRowData",e);if(d.status=="used"){DialogUtils.error(msgCode.ERROR,"已用的属性集无法删除");
return;}}}else{var d=$(EavSet._CONS_.GRID).jqGrid("getRowData",e);if(d.status=="used"){DialogUtils.error(msgCode.ERROR,"已用的属性集无法删除");return;}}a._delete(b);
});$("body").on("click","#eavAttrAdd",function(){a._editAttr("");});$("body").on("click","#eavAttrEdit",function(){a.isEdit=true;var b=$(this).attr("idVal");
if(!b){b=$(EavSet._CONS_.EAV_ATTR_GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_NO_SELECT_EDIT);
return;}if(b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);return;}}a._editAttr(b);});$("body").on("click","#eavAttrDel",function(){var b=$(this).attr("idVal");
if(!b){b=$(EavSet._CONS_.EAV_ATTR_GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_NO_SELECT_DELETE);
return;}}a._deleteAttr(b);});$("#addNewGroupBtn").click(function(){var d=new StringBuffer();var b=a.newGroupIndexList.length?a.newGroupIndexList[a.newGroupIndexList.length-1]:0;
d.append("<tr class='newGroupTr-"+b+"'>");d.append("<td colspan='3'>");var c="newGroupName-"+b;d.append("<input validateType='default' name='"+c+"' type='text' class='form-control' placeholder='输入分组的名称'>");
d.append("</td>");d.append("<td colspan='2'>");d.append("<button type='button' groupIndex='"+b+"' class='btn btn-sm btn-outline btn-primary saveNewGroupBtn'>保存</button>");
d.append("&nbsp;&nbsp;<button type='button' class='btn btn-sm btn-outline btn-danger cancelNewGroupBtn'>取消</button>");d.append("</td>");d.append("</tr>");
$("#selectEavAttrTable").append(d.toString());a.newGroupIndexList.push(a.newGroupIndexList.length);$("input[name='newGroupName-"+b+"']").focus();});$("#selectEavAttrTable").on("click",".cancelNewGroupBtn",function(){$(this).parent().parent().remove();
});$(".form_wrapper").on("change","input",function(){if(a.isEdit){a.isFormDataChange=true;}});$(".form_wrapper").on("change",".form_wrapper select",function(){if(a.isEdit){a.isFormDataChange=true;
}});$(".form_wrapper").on("change",".form_wrapper textarea",function(){if(a.isEdit){a.isFormDataChange=true;}});$("#searchSelectBtn").click(function(){var b=$("#nameSelectSearch").val();
var c=$("#keySelectSearch").val();a.searchEavAttr(b,c);});$("#selectEavAttrTable").on("keypress","input",function(b){if(b.keyCode=="13"){$(this).parent().next().find(".saveNewGroupBtn").trigger("click");
}});$("#selectEavAttrTable").on("click",".saveNewGroupBtn",function(){var c=$("input[name='newGroupName-"+$(this).attr("groupIndex")+"']").val();if(!c){DialogUtils.error(msgCode.ERROR,"分组名称不能为空");
$("input[name='newGroupName-"+$(this).attr("groupIndex")+"']").focus();return;}if(a.groupMap.containsKey(c)){DialogUtils.error(msgCode.ERROR,"分组名称不能重复");
$("input[name='newGroupName-"+$(this).attr("groupIndex")+"']").focus();return;}var b="";if(a.groupMap.isEmpty()){b="10";}else{b=a.groupNameSortMap.get(a.groupMap.keys()[a.groupMap.keys().length-1]);
b=Number(b)+1;}a.createGroupTr(c,b,true);$("tr[class='newGroupTr-"+$(this).attr("groupIndex")+"']").remove();});$("#selectAttrsBtn").on("click",function(){var d=$(EavSet._CONS_.EAV_ATTR_GRID).jqGrid("getGridParam","selarrrow");
if(!d||d.length==0){DialogUtils.error(msgCode.ERROR,"请选择属性");return;}var b=$("#selectEavAttrTable").find("tr.success");if(b.find("td:eq(1) i:eq(0)").hasClass("fa-plus")){b.find("td:eq(1) i:eq(0)").trigger("click");
}var c=a.selectGroup();a.selectAttrs(c,d);});$("#attrSearchFormContainer").on("keyup","input",function(b){if(b.which==13){$("#searchSelectBtn").trigger("click");
}});$("#selectAllAttrsBtn").on("click",function(){var d=$(EavSet._CONS_.EAV_ATTR_GRID).jqGrid("getDataIDs");var b=$("#selectEavAttrTable").find("tr.success");
if(b.find("td:eq(1) i:eq(0)").hasClass("fa-plus")){b.find("td:eq(1) i:eq(0)").trigger("click");}var c=a.selectGroup();a.selectAttrs(c,d);});$("#selectEavAttrTable").on("click",".deleteGroup",function(){var b=$(this).attr("groupName");
a.deleteGroupAttrs(b);});$("#selectEavAttrTable").on("click","input[type='checkbox']",function(){var c=$(this).is(":checked");var b=this;if(c){$("#selectEavAttrTable").find("tr").each(function(){if($(this).attr("groupName")&&$(this).attr("groupName")!=$(b).parent().parent().attr("groupName")&&$(this).attr("attrId")==null){$(this).find("td").eq(0).find("input").eq(0).removeAttr("checked");
$(this).removeClass("success").addClass("info");}});$(this).parent().parent().removeClass("info").addClass("success");}else{$(this).parent().parent().addClass("info").removeClass("success");
}});$("#selectEavAttrTable").on("click",".deleteAttr",function(){var c=$(this).parent().parent();var e=c.attr("groupName");var d=a.groupMap.get(e);if(d.length){for(var b=0;
b<d.length;b++){if(d[b].id==c.attr("attrId")){a.groupMap.get(e).splice(b,1);break;}}c.remove();a.reloadEavAttrJqgrid();}});$("#selectEavAttrTable").on("click",".groupTree",function(){if($(this).hasClass("fa-minus")){$(this).removeClass("fa-minus").addClass("fa-plus");
var b=$(this).parent().parent();var c=b.attr("groupName");$("#selectEavAttrTable").find("tr[groupName='"+c+"']").hide();b.show();}else{$(this).removeClass("fa-plus").addClass("fa-minus");
var b=$(this).parent().parent();var c=b.attr("groupName");$("#selectEavAttrTable").find("tr[groupName='"+c+"']").show();}});$("#selectEavAttrTable").on("click",".fa-arrow-circle-up",function(){var e=$(this).parent().parent();
var d=e.attr("attrId");var h=e.attr("groupName");if(d!=null&&d!=""){var b=e.index("#selectEavAttrTable tr[groupName='"+h+"']");if(b==1){return;}var c=e.prev();
a.exchangeTr(e,c);}else{var g=e.index("#selectEavAttrTable tr");if(g==1){return;}var f=$("#selectEavAttrTable tr[groupName='"+h+"']").first().prev().attr("groupName");
a.exchangeGroup(f,h);}});$("#selectEavAttrTable").on("click",".fa-arrow-circle-down",function(){var b=$(this).parent().parent();var d=b.attr("attrId");
var i=b.attr("groupName");if(d!=null&&d!=""){var f=b.index("#selectEavAttrTable tr[groupName='"+i+"']");if(f==a.groupMap.get(i).length){return;}var g=b.next();
a.exchangeTr(g,b);}else{var c=b.index("#selectEavAttrTable tr");var j=$("#selectEavAttrTable tr").size();var h=j-c-1;if(h==a.groupMap.get(i).length){return;
}var e=$("#selectEavAttrTable tr[groupName='"+i+"']").last().next().attr("groupName");a.exchangeGroup(i,e);}});},_resizeGridEavAttrGridHeight:function(){var a=$(window).height();
if($("#addEavSetBtn").length){a-=$("#addEavSetBtn").parents(".row").outerHeight();a-=$("h3").outerHeight();a-=$("#saveEavSetBtn").outerHeight();}else{a-=$(".form_wrapper .panel-heading").outerHeight();
a-=$("#tabHeaderUl").outerHeight();a-=$("#addNewGroupBtn").outerHeight();}$(EavSet._CONS_.EAV_ATTR_GRID).jqGrid("setGridHeight",a);},initEavAttrJqgrid:function(d){$.jgrid.defaults.styleUI="Bootstrap";
var g="";if(this.hadLoadJqgridFlag&&d){this.reloadEavAttrJqgrid();return;}else{if(d){var k=new StringBuffer();var l=this.groupMap.values();for(var f=0;
f<l.length;f++){for(var e=0;e<l[f].length;e++){k.append(l[f][e].id);}}g=k.toString(",");}}var c=$(window).width();var h=1;var a=1024;if(c){if(c<=a){h=1;
}else{if(c>a&&c<=1280){h=1.2;}else{if(c>1280&&c<=1440){h=1.4;}else{if(c>1440&&c<=1600){h=1.6;}else{h=1.8;}}}}}var b=false;if(ResUtils.canShow("eavSetAttr.button.edit")){b=true;
}if(!this.hadLoadJqgridFlag){this.hadLoadJqgridFlag=true;var m=this;$(EavSet._CONS_.EAV_ATTR_GRID).jqGrid({datatype:"json",url:ctx+"/gl/eav/eavAttr/listData.htm",height:$(window).height()*0.65,mtype:"POST",shrinkToFit:true,rowNum:20,mtype:"POST",postData:{bizType:bizType,selectIds:g,Q__S__EQ__entity_type_:entityType,Q__S__EQ__status_:"actived"},multiselect:true,colNames:["名称","数据类型","控件类型"],colModel:[{name:"name",width:85*h,index:"name_",formatter:function(j,i,n){if(b){return"<a href='javascript:void(0);' idVal='"+n.id+"' class='editAttrBtn'>"+j+"</a>";
}else{return j;}}},{name:"dataType",width:75*h,index:"dataType_",sortable:false,formatter:function(i){return m._dataTypeFormatter(i);}},{name:"inputType",width:80*h,sortable:false,formatter:function(i){return m._inputTypeFormmater(i);
}}],gridComplete:function(){var i=$(EavSet._CONS_.EAV_ATTR_GRID).jqGrid("getGridParam","records");if(i<=0){if($(EavSet._CONS_.EAV_ATTR_GRID).find(".norecords").html()==null){$(EavSet._CONS_.EAV_ATTR_GRID).parent().append('<div class="norecords">没有符合数据！</div>');
$(EavSet._CONS_.EAV_ATTR_GRID).parent().find(".norecords").show();}else{$(EavSet._CONS_.EAV_ATTR_GRID).parent().find(".norecords").show();}}else{$(EavSet._CONS_.EAV_ATTR_GRID).parent().find(".norecords").hide();
}$("#eavSetSelectPager_left").remove();$("#eavSetSelectPager_right").remove();},autowidth:true,pager:EavSet._CONS_.EAV_ATTR_PAGER,hidegrid:false});}},searchEavAttr:function(c,e){var g=new StringBuffer();
var b=this.groupMap.values();for(var d=0;d<b.length;d++){for(var a=0;a<b[d].length;a++){g.append(b[d][a].id);}}selectIds=g.toString(",");var f={Q__S__LK__name_:c,Q__S__LK__key_:e,bizType:bizType,Q__S__EQ__entity_type_:entityType,selectIds:selectIds.toString(),Q__S__EQ__status_:"actived"};
JTJqgridUtils.reloadJqgrid(EavSet._CONS_.EAV_ATTR_GRID,f);},selectGroup:function(){var a="";$("#selectEavAttrTable").find("tr").each(function(){if($(this).hasClass("success")){a=$(this).attr("groupName");
}});if(!a){DialogUtils.error(msgCode.ERROR,"请选择分组");return;}return a;},selectAttrs:function(f,e){if(f==null||f.length==0||e==null||e.length==0){return;
}var c=this;var b=new Array();for(var d=0;d<e.length;d++){var a=$(EavSet._CONS_.EAV_ATTR_GRID).jqGrid("getRowData",e[d]);a.id=e[d];b.push(a);}c.createAttrsTr(f,b);
c.reloadEavAttrJqgrid();},reloadEavAttrJqgrid:function(){var a=this;var d=this.groupMap.keys();var g=new StringBuffer();if(d.length>0){for(var c=0;c<d.length;
c++){var e=this.groupMap.get(d[c]);for(var b=0;b<e.length;b++){g.append(e[b].id);}}}var f={Q__S__EQ__biz_type_:bizType,selectIds:g.toString(","),Q__S__EQ__entity_type_:entityType,Q__S__EQ__status_:"actived"};
JTJqgridUtils.reloadJqgrid(EavSet._CONS_.EAV_ATTR_GRID,f);},createGroupTr:function(b,a,c){if(this.groupMap.containsKey(b)){DialogUtils.error(msgCode.ERROR,"分组名字不能重复");
return;}var d=new StringBuffer();if(c){d.append("<tr groupSort='"+a+"' groupName='"+b+"' class='success'>");d.append("<td><input groupName='"+b+"' type='checkbox' checked='checked'></td>");
}else{d.append("<tr groupSort='"+a+"' groupName='"+b+"' class='info'>");d.append("<td><input groupName='"+b+"' type='checkbox'></td>");}d.append("<td><i class='groupTree fa fa-minus' style='cursor:pointer; font-size: 18px;padding-right:5px;'></i>"+b+"</td>");
d.append("<td>&nbsp;</td>");d.append("<td>&nbsp;</td>");d.append("<td><i style='cursor:pointer; font-size: 20px;' class='fa fa-arrow-circle-up'></i><i style='cursor:pointer; font-size: 20px;' class='fa fa-arrow-circle-down'></i></td>");
d.append("<td><button type='button' groupName='"+b+"' class='deleteGroup btn btn-sm btn-danger'><i class='fa fa-remove'></i></button></td>");d.append("</tr>");
if(c){$("#selectEavAttrTable").find("tr[class='success']").removeClass("success").addClass("info");$("#selectEavAttrTable").find("input[type='checkbox']:checked").prop("checked",false);
}$("#selectEavAttrTable").append(d.toString());this.groupMap.put(b,[]);this.groupNameSortMap.put(b,a);},createAttrsTr:function(g,b){if(g&&g.length>0&&b&&b.length>0){var f=new StringBuffer();
for(var c=0;c<b.length;c++){var d="";if(typeof b[c].sort!="undefined"){d=b[c].sort;}else{var e=this.groupMap.get(g);if(!e.length){d="000";}else{d=e[e.length-1].sort;
d=((Number(d))+1)+"";if(d.length==1){d="00"+d;}else{if(d.length==2){d="0"+d;}}}}f.append("<tr attrSort='"+d+"' attrId='"+b[c].id+"' groupName='"+g+"'>");
f.append("<td>&nbsp;</td>");f.append("<td>&nbsp;&nbsp;&nbsp;&nbsp;<a title='编辑属性' href='javascript:void(0);' idVal='"+b[c].id+"' class='editAttrBtn'>"+b[c].name+"</a></td>");
f.append("<td>"+b[c].dataType+"</td>");f.append("<td>"+b[c].inputType+"</td>");f.append("<td><i style='cursor:pointer; font-size: 20px;' class='fa fa-arrow-circle-up'></i><i style='cursor:pointer; font-size: 20px;' class='fa fa-arrow-circle-down'></i></td>");
f.append("<td><button type='button' class='deleteAttr btn btn-sm btn-danger'><i class='fa fa-remove'></i></button></td>");f.append("</tr>");var a={id:b[c].id,name:b[c].name,key:b[c].key,sort:d};
this.groupMap.get(g).push(a);}$("#selectEavAttrTable").find("tr[groupName='"+g+"']:last").each(function(){$(this).after(f.toString());});}},exchangeGroup:function(b,a){$("#selectEavAttrTable tr[groupName='"+b+"']").insertAfter($("#selectEavAttrTable tr[groupName='"+a+"']").last());
var e=this.groupNameSortMap.get(b);var d=this.groupNameSortMap.get(a);$("#selectEavAttrTable tr[groupName='"+b+"']").attr("groupSort",d);$("#selectEavAttrTable tr[groupName='"+a+"']").attr("groupSort",e);
var c=this.groupNameSortMap.get(b);this.groupNameSortMap.put(b,this.groupNameSortMap.get(a));this.groupNameSortMap.put(a,c);},exchangeTr:function(h,f){var b=h.next();
var a=f.prev();f.insertBefore(b);h.insertAfter(a);var l=f.attr("attrSort");var m=h.attr("attrSort");h.attr("attrSort",l);f.attr("attrSort",m);var o=h.attr("groupName");
var c=this.groupMap.get(o);var d=0,e=0;for(var g=0;g<c.length;g++){if(c[g].sort==l){d=g;}if(c[g].sort==m){e=g;}}c[d].sort=m;c[e].sort=l;},deleteGroupAttrs:function(b){var a=this;
this.groupNameSortMap.remove(b);this.groupMap.remove(b);$("#selectEavAttrTable").find("tr").each(function(){if($(this).attr("groupName")==b){$(this).remove();
}});a.reloadEavAttrJqgrid();},validateAttrs:function(){var b=this.groupMap.keys();for(var a=0;a<b.length;a++){var d=b[a];var c=this.groupMap.get(d);if(!c.length){DialogUtils.error(msgCode.ERROR,"分组："+d+"，还没有关联任何属性");
return false;}}return true;},getSelectAttrs:function(){var c=this.groupMap.keys();var g=[];for(var b=0;b<c.length;b++){var f=c[b];var e=this.groupMap.get(f);
for(var a=0;a<e.length;a++){var d={group:f,sort:this.groupNameSortMap.get(f)+""+e[a].sort,setId:$("input[name='id']").val(),attrId:e[a].id,isMain:"n"};
g.push(d);}}return"eavSetAttrJson="+JSON.stringify(g);},_dataTypeFormatter:function(a){switch(a){case"string":return"字符串";case"integer":return"整数";case"decimal":return"浮点数";
case"date":return"日期";case"text":return"文本";case"options":return"选项";case"tree":return"树";default:return"字符串";}},_inputTypeFormmater:function(a){switch(a){case"single_input":return"单行输入框";
case"single_textarea":return"多行输入框";case"single_readonly":return"只读";case"single_texteditor":return"富文本编辑器";case"single_attach_file":return"文件上传";case"single_attach_img":return"图片上传";
case"option_radio":return"radio单选框";case"option_checkbox":return"checkbox多选框";case"option_selectbox_single":return"下拉单选框";case"option_selectbox_multi":return"下拉多选框";
default:return"未知";}}};