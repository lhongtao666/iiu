function EavAttr(){this.isEdit=false;this.isFormDataChange=false;this.bizType=bizType;this.dataType="";this.optionList=new List();this.newOptionIndex=0;
}EavAttr._CONS_={GRID:"#eavAttrGrid",PAGER:"#eavAttrPager",};EavAttr.prototype={init:function(){this._initJqgrid();this._bindEventHanlder();this._bindFormValidation();
this._hideNotGrantBtn();this._locateToGlHelp();},_locateToGlHelp:function(){var a="glHelp.prodEntity.prodEavAttr.attr";glHelpUtil.init(a);},_bindFormValidation:function(){var a={rules:{name:{required:true},dataType:{required:true},inputType:{required:true},status:{required:true}},messages:{}};
jQuery.validator.addMethod("chrnum",function(c,b,e){var d=/^[0-9a-z_]+$/;return d.test(c);},jQuery.validator.format("由小写字母，数组，下划线组成"));FormUtils.bindFormValidation("eavAttrForm",a);
},_hideNotGrantBtn:function(){if(!ResUtils.canShow("eavAttr.button.detail")){$(".eavAttrDetail").hide();}if(!ResUtils.canShow("eavAttr.button.add")){$(".eavAttrAdd").hide();
}if(!ResUtils.canShow("eavAttr.button.edit")){$(".eavAttrEdit").hide();}if(!ResUtils.canShow("eavAttr.button.delete")){$(".eavAttrDel").hide();}if(!ResUtils.canShow("eavAttr.button.active")){$(".eavAttrActive").hide();
}if(!ResUtils.canShow("eavAttr.button.unactive")){$(".eavAttrUnactive").hide();}},_bindFormChangeEventHandler:function(){var a=this;$(".form_wrapper").on("change","input",function(){if(a.isEdit){a.isFormDataChange=true;
}});$(".form_wrapper").on("change",".form_wrapper select",function(){if(a.isEdit){a.isFormDataChange=true;}});$(".form_wrapper").on("change",".form_wrapper textarea",function(){if(a.isEdit){a.isFormDataChange=true;
}});},_bindSearchEventHandler:function(){var a=this;$(".list_wrapper").on("click",".eavAttrSearch",function(){var b=$("#eavAttrSearchForm").serialize();
a.reloadJqgrid(b);});$("#eavAttrSearchForm").on("keypress",function(b){if(b.keyCode=="13"){$(".eavAttrSearch").eq(0).trigger("click");}});},_bindCRUDEventHandler:function(){var a=this;
$(".prevBtn").on("click",function(){a.clear(false);});$(".wrapper").on("click",".saveBtn",function(){a._save();});$("body").on("click",".eavAttrAdd",function(){a._add();
});$("body").on("click",".eavAttrEdit",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(EavAttr._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_NO_SELECT_EDIT);return;}if(b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);
return;}}a._edit(b);});$("body").on("click",".eavAttrDetail",function(){var b=$(this).attr("idVal");if(!b){b=$(EavAttr._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_NO_SELECT_DETAIL);return;}if(b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_DETAIL_MUL_RECORD);
return;}}a._detail(b);});$("body").on("click",".eavAttrDel",function(){var b=$(this).attr("idVal");if(!b){b=$(EavAttr._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_NO_SELECT_DELETE);return;}}a._delete(b);});$("body").on("click",".addNewAttrBtn",function(){var b=new StringBuffer();
b.append("<li style='width:60%;margin-top:5px;'><input type='text' name='optValue' class='form-control' validatetype='default'></li>");$("#optionValueUlContainer").append(b.toString());
});},_toggleStatus:function(c,a){var b=this;FormUtils.submit(ctx+"/gl/eav/eavAttr/toggleStatus.htm",{ids:c.toString(),status:a},function(d){if(d.success){if(a==="actived"){DialogUtils.success(msgCode.SUCCESS,"激活成功");
}else{if(a==="inactive"){DialogUtils.success(msgCode.SUCCESS,"禁用成功");}}b.reloadJqgrid();}else{DialogUtils.error(msgCode.ERROR,d.msg);}});},_bindEventHanlder:function(){var a=this;
this._bindCRUDEventHandler();this._bindSearchEventHandler();this._bindFormChangeEventHandler();$(document).on("click",".eavAttrUnactive",function(){a.isEdit=true;
var b=$(this).attr("idVal");if(!b){b=$(EavAttr._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.ERROR,"请选择要禁用的属性");
return;}}a._toggleStatus(b,"inactive");});$(document).on("click",".eavAttrActive",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(EavAttr._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.ERROR,"请选择要激活的属性");return;}}a._toggleStatus(b,"actived");});$("select[name='dataType']").change(function(){a.dataType=$(this).val();
a.switchToDataType();if($(this).val()=="options"){var b=new StringBuffer();b.append("<option value=''>请选择</option>");b.append("<option value='required'>必填</option>");
$("select[name='validateKey']").empty().append(b.toString());$("#optionValueContainer").show();}else{$("#optionValueContainer").hide();var b=new StringBuffer();
b.append("<option value=''>请选择</option>");b.append("<optgroup label='非必填'>");b.append("<option value='number'>数字</option>");b.append("<option value='digits'>整数</option>");
b.append("<option value='date'>日期</option>");b.append("<option value='email'>邮件</option>");b.append("<option value='url'>链接</option>");b.append("</optgroup>");
b.append("<optgroup label='必填'>");b.append("<option value='required'>字符串</option>");b.append("<option value='required,number'>数字</option>");b.append("<option value='required,digits'>整数</option>");
b.append("<option value='required,date'>日期</option>");b.append("<option value='required,email'>邮件</option>");b.append("<option value='required,url'>链接</option>");
b.append("</optgroup>");$("select[name='validateKey']").empty().append(b.toString());}});$("select[name='inputType']").on("change",function(){var c=$(this).val();
var b=$("select[name='dataType']").val();if(b=="options"||c=="single_textarea"){var d=new StringBuffer();d.append("<option value=''>请选择</option>");d.append("<option value='required'>必填</option>");
$("select[name='validateKey']").empty().append(d.toString());}else{if(c=="single_attach_file"||c=="single_readonly"||c=="single_texteditor"||c=="single_color_single"||c=="single_attach_img"){$("select[name='validateKey']").val("");
$("select[name='validateKey']").attr("disabled","disabled");}else{$("select[name='validateKey']").removeAttr("disabled");}}});},_initJqgrid:function(){var a={Q__S__EQ__biz_type_:bizType,Q__S__EQ__entity_type_:entityType};
$(EavAttr._CONS_.GRID).JTJqgrid({url:ctx+"/gl/eav/eavAttr/listData.htm",postData:a,colNames:["名称","数据类型","控件类型","验证规则","创建时间","状态","操作"],colModel:[{name:"name",index:"name_",width:120},{name:"dataType",width:80,sortable:false,formatter:function(b){switch(b){case"string":return"字符串";
break;case"integer":return"整数";break;case"decimal":return"浮点数";break;case"date":return"日期";break;case"text":return"文本";break;case"options":return"选项";break;
case"tree":return"树";break;default:return"字符串";break;}}},{name:"inputType",sortable:false,width:120,formatter:function(b){switch(b){case"single_input":return"单行输入框";
case"single_textarea":return"多行输入框";case"single_readonly":return"只读";case"single_texteditor":return"富文本编辑器";case"single_attach_file":return"文件上传";case"single_attach_img":return"图片上传";
case"option_radio":return"radio单选框";case"option_checkbox":return"checkbox多选框";case"option_selectbox_single":return"下拉单选框";case"option_selectbox_multi":return"下拉多选框";
default:return"未知";}}},{name:"validateKey",width:120,sortable:false,formatter:function(b){switch(b){case"number":return"数字";case"digits":return"整数";case"date":return"日期";
case"email":return"邮件";case"url":return"链接";case"required":return"字符串（必填）";case"required,number":return"数字（必填）";case"required,date":return"日期（必填）";case"required,email":return"邮件（必填）";
case"required,url":return"链接（必填）";default:return"字符串（非必填）";}}},{name:"createTime",index:"create_time_",width:120,formatter:function(b){return DateUtils.miniTime(b);
}},{name:"status",width:40,sortable:false,formatter:function(b){if(b=="actived"){return"<label class='label label-primary'>激活</label>";}else{if(b=="inactive"){return"<label class='label label-danger'>未激活</label>";
}}}},{name:"__manage",width:40,classes:"rowOps",sortable:false,align:"center",formatter:"manage",title:"操作",formatoptions:this._getManagerBtns()},],pager:EavAttr._CONS_.PAGER,});
},_getManagerBtns:function(){var a=[];if(ResUtils.canShow("eavAttr.button.delete")){a.push({lable:"删除",btnClasses:"btn btn-danger eavAttrDel",iconClasses:"fa fa-remove"});
}if(ResUtils.canShow("eavAttr.button.edit")){a.push({lable:"编辑",btnClasses:"btn btn-primary eavAttrEdit",iconClasses:"fa fa-edit"});}if(ResUtils.canShow("eavAttr.button.detail")){a.push({lable:"明细",btnClasses:"btn btn-primary eavAttrDetail",iconClasses:"fa fa-th-list"});
}if(ResUtils.canShow("eavAttr.button.active")||ResUtils.canShow("eavAttr.button.unactive")){var b={colName:"status",colVals:[],colLables:[],btnClasses:[],iconClasses:[]};
if(ResUtils.canShow("eavAttr.button.unactive")){b.colVals.push("actived");b.colLables.push("下架");b.btnClasses.push("btn btn-danger eavAttrUnactive");b.iconClasses.push("fa fa-toggle-off");
}if(ResUtils.canShow("eavAttr.button.active")){b.colVals.push("inactive");b.colLables.push("上架");b.btnClasses.push("btn btn-primary eavAttrActive");b.iconClasses.push("fa fa-toggle-on");
}a.push({switchCol:b});}return a;},reloadJqgrid:function(a){if(a){if(jQuery.type(a)=="string"){a+="&Q__S__EQ__biz_type_="+bizType+"&Q__S__EQ__entity_type_="+entityType;
}else{a.Q__S__EQ__biz_type_=bizType;a.Q__S__EQ__entity_type_=entityType;}}else{a={};a.Q__S__EQ__biz_type_=bizType;a.Q__S__EQ__entity_type_=entityType;}JTJqgridUtils.reloadJqgrid(EavAttr._CONS_.GRID,a);
},_switchByBizType:function(){if(bizType=="common"){this.dataType="normal";this.switchToDataType();$("select[name='inputType']").removeAttr("disabled");
$("select[name='dataType']").removeAttr("disabled");$("select[name='dataType']").val("");$("select[name='inputType']").val("");}},_add:function(){this.clear(false);
this._showFormWrapper();this._switchByBizType();var a=new StringBuffer();a.append("<li style='width:60%'><input type='text' name='optValue' class='form-control' validatetype='default'></li>");
$("#optionValueUlContainer").empty().append(a.toString());},_delete:function(c){var b=ctx+"/gl/eav/eavAttr/delete.htm";var a=this;DialogUtils.confirm(function(){FormUtils.del(b,c,function(d){DialogUtils.success(msgCode.INFO,d.msg);
a.reloadJqgrid();});});},_edit:function(a){this._showFormWrapper();this._loadData(a,true);this._switchByBizType();},_detail:function(a){this._showFormWrapper();
this._loadData(a,false);FormUtils.disableForm("eavAttrForm");$(".saveBtn").hide();},_save:function(c){var b=this;var a=$("#id").val()?ctx+"/gl/eav/eavAttr/saveEdit.htm":ctx+"/gl/eav/eavAttr/saveAdd.htm";
if($("#eavAttrForm").valid()){if($(".saveBtn").length){ButtonUtils.disableBtn("saveBtn");}$("select[name='dataType']").removeAttr("disabled");$("select[name='inputType']").removeAttr("disabled");
var d=$("#eavAttrForm").serialize();d+="&bizType="+bizType+"&entityType="+entityType;if(d.indexOf("&status=")==-1){d+="&status=actived";}if($("select[name='dataType']").val()=="options"){if(!$("#optionValueUlContainer").find("li").length){DialogUtils.error(msgCode.ERROR,"请录入选项值");
return;}d+="&"+this.getOptions();}FormUtils.submit(a,d,function(e){if($(".saveBtn").length){ButtonUtils.enableBtn("saveBtn");}if(e.success){if(c){DialogUtils.success(msgCode.INFO,e.msg);
b.isEdit=false;b.clear(true);c();}else{DialogUtils.success(msgCode.INFO,e.msg);b.isEdit=false;b.clear(true);}}else{DialogUtils.error(msgCode.FAIL,e.msg);
}},function(){if($(".saveBtn").length){ButtonUtils.enableBtn("saveBtn");}DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}},getOptions:function(){var a=[];
$("#optionValueUlContainer").find("li").each(function(){if($(this).find("input").val()){var b={sort:$(this).index(),label:$(this).find("input").val(),value:$(this).find("input").val()};
a.push(b);}});return"optionJson="+JSON.stringify(a);},_loadData:function(c,b){var a=this;FormUtils.loadData(ctx+"/gl/eav/eavAttr/edit.htm?id="+c,function(e){$("input[name=id]").val(e.id);
$("input[name=name]").val(e.name);$("input[name=label]").val(e.label);$("input[name=key]").val(e.key);$("input[name=dataType]").val(e.dataType);$("input[name=validateKey]").val(e.validateKey);
$("input[name=status]").val(e.status);$("input[name=sort]").val(e.sort);$("input[name=createBy]").val(e.createBy);$("input[name=createTime]").val(e.createTime);
$("input[name=updateBy]").val(e.updateBy);$("input[name=updateTime]").val(e.updateTime);$("select[name='status']").val(e.status);$("select[name='dataType']").val(e.dataType);
$("select[name='validateKey']").val(e.validateKey);a.dataType=e.dataType;a.switchToDataType();$("select[name='inputType']").val(e.inputType);$("select[name='inputType']").trigger("change");
if(e.dataType=="options"){var f=new StringBuffer();for(var d=0;d<e.eavAttrOptPos.length;d++){f.append("<li nameval='"+e.eavAttrOptPos[d].value+"'>").append("<a href='javascript: void(0);'>").append(e.eavAttrOptPos[d].value).append("&nbsp;&nbsp;&nbsp;&nbsp;<button class='btn btn-danger btn-xs deleteAttrBtn' type='button'><i class='fa fa-remove'></i></button>");
f.append("</a>");f.append("</li>");}$("#optionValueUlContainer").empty().append(f.toString());$("#optionValueContainer").show();}else{$("#optionValueContainer").hide();
}if(b){$(".deleteOptionBtn").removeAttr("disabled");$("#addNewOptionBtn").removeAttr("disabled");}else{$(".deleteOptionBtn").attr("disabled","disabled");
$("#addNewOptionBtn").attr("disabled","disabled");}});},_showListWrapper:function(){$(".list_wrapper").show();$(".form_wrapper").hide();},_showFormWrapper:function(){$(".list_wrapper").hide();
$(".form_wrapper").show();},clear:function(c){var a=this;function b(){a.dataType="";a.optionList=new List();a.isEdit=false;a.isFormDataChange=false;var d=new StringBuffer();
$("select[name='inputType']").removeAttr("disabled");$("select[name='dataType']").removeAttr("disabled");$("select[name='validateKey']").removeAttr("disabled");
$(".saveBtn").show();$("#optionsTable").empty();$("#optionValueContainer").hide();FormUtils.enableForm("eavAttrForm");FormUtils.clear("eavAttrForm");a._showListWrapper();
if(c){a.reloadJqgrid();}}if(a.isEdit&&a.isFormDataChange){DialogUtils.warning(function(){b();});}else{b();}},switchToDataType:function(){if(typeof EavAttr._optionSelectOptions=="undefined"){var d=new StringBuffer();
d.append("<option value=''>请选择</option><option value='option_radio'>radio单选框</option>"+"<option value='option_checkbox'>checkbox多选框</option>"+"<option value='option_selectbox_single'>下拉单选框</option>"+"<option value='option_selectbox_multi'>下拉多选框</option>");
EavAttr._optionSelectOptions=d.toString();}if(typeof EavAttr._treeSelectOptions=="undefined"){var c=new StringBuffer();c.append("<option value=''>请选择</option><option value='tree_single'>树形单选</option>"+"<option value='tree_multi'>树形多选</option>");
EavAttr._treeSelectOptions=c.toString();}var b=this;switch(this.dataType){case"options":$("select[name='inputType']").empty().append(EavAttr._optionSelectOptions);
break;default:var e=new StringBuffer();var a=$("select[name='dataType']").val();if(a=="integer"||a=="decimal"){e.append("<option value=''>请选择</option>").append("<option value='single_input'>单行输入框</option>").append("<option value='single_readonly'>只读</option>");
}else{if(a=="text"){e.append("<option value=''>请选择</option>").append("<option value='single_textarea'>多行输入框</option>").append("<option value='single_texteditor'>富文本编辑器</option>");
}else{e.append("<option value=''>请选择</option>").append("<option value='single_input'>单行输入框</option>").append("<option value='single_textarea'>多行输入框</option>").append("<option value='single_readonly'>只读</option>").append("<option value='single_texteditor'>富文本编辑器</option>").append("<option value='single_attach_file'>文件上传</option>").append("<option value='single_attach_img'>图片上传</option>");
}}$("select[name='inputType']").empty().append(e.toString());break;}}};