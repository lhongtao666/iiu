$(function(){var a=new EmployeeTarget();a.init();});function EmployeeTarget(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.listData={page:1,rows:20,total:0};
this.targetType=(targetIsAudit=="y"?"audit":"complete");}EmployeeTarget._CONS_={EDIT_URL:ctx+"/gl/ou/employeeTarget/edit.htm",DETAIL_URL:ctx+"/gl/ou/employeeTarget/detail.htm",DELETE_URL:ctx+"/gl/ou/employeeTarget/delete.htm",SAVE_ADD_URL:ctx+"/gl/ou/employeeTarget/saveAdd.htm",SAVE_EDIT_URL:ctx+"/gl/ou/employeeTarget/saveEdit.htm",LIST_DATA_URL:ctx+"/gl/ou/employeeTarget/listData.htm",EDIT_FORM_ID:"employeeTargetForm",GRID:"#employeeTargetGrid",PAGER:"#employeeTargetPager"};
EmployeeTarget.prototype={init:function(){if(!this.hadInit){this.hadInit=true;this._dealStyle();this.initDate("#search-period");if(targetIsAudit=="y"){$("[name='type'][value='audit']").attr("checked","checked");
}this._initJqgrid();this._bindEventHander();}},_dealStyle:function(){var a=$(window).height()-60-40;$("#employeeTargetContainer").height(a);},initDate:function(a){var b=new Date();
var d=b.getFullYear();var e=new StringBuffer();e.append("<option value=''>全部</option>");for(var c=2015;c<=d+1;c++){e.append("<option value='").append(c).append("' >").append(c).append("年</option>");
}$(a).append(e.toString());},_bindEventHander:function(){var a=this;$("body").on("click",".employeeTargetSearch",function(){a._initJqgrid();});$("body").on("change","[name='type']",function(){a.targetType=$(this).val();
});$(window).on("resize",function(){a._dealStyle();});$(document).on("click","#employeeTargetPageContainer .next-page",function(){if($(this).hasClass("no")){return;
}$(this).addClass("no");a.listData.page=a.listData.page+1;a._initJqgrid();});$(document).on("click","#employeeTargetPageContainer .pre-page",function(){if($(this).hasClass("no")){return;
}$(this).addClass("no");a.listData.page=a.listData.page-1;a._initJqgrid();});},_initJqgrid:function(){var a=this;var b=EmployeeTarget._CONS_.LIST_DATA_URL+"?page="+this.listData.page+"&rows="+this.listData.rows+"&Q__S__EQ__employee_id_="+currentUserId+"&Q__S__RLK__period_="+$("[name='period']").val();
FormUtils.loadData(b,function(f){a.listData.total=f.total;var k=new StringBuffer();for(var c=0;c<f.rows.length;c++){var h=f.rows[c];var e=a.targetType=="complete"?h.completeTotal:h.auditTotal;
var j=(h.total==0?0:(e*100/h.total).toFixed(0));var d=h.countTarget;if(j>100){j=100;}k.append("<div class='group-target-div'>").append("<div class='group-target-1'>").append("<div>目标时间："+h.period+"</div>").append("</div>").append("<div class='group-target-2' "+(d<=0?"style='width:50%;'":"")+">").append("<div>目标：<span class='target-num'>￥"+h.total+"</span>,完成金额：<span class='target-num'>￥"+e+"</span></div>").append("<div class='div-line'>");
if(j>10){k.append("<div class='div-line1'  style='width:calc("+j+"% - 20px);'></div>").append("<div class='div-line1-after'></div>").append("<div class='div-line2'  style='width:"+(100-j)+"%;'></div>");
}else{k.append("<div class='div-line1'  style='width:"+j+"%'></div>").append("<div class='div-line1-after'></div>").append("<div class='div-line2'  style='width:calc("+(100-j)+"% - 20px);'></div>");
}k.append("</div>").append("<div>完成度：<span class='target-num'>"+j+"%</span></div>").append("</div>");if(d>0){var g=(h.countComplete*100/d).toFixed(0);if(g>100){g=100;
}k.append("<div class='group-target-3'>").append("<div>数量目标：<span class='target-num'>"+h.countTarget+"</span>,完成数量：<span class='target-num'>"+h.countComplete+"</span></div>").append("<div class='div-line'>");
if(g>10){k.append("<div class='div-line1'  style='width:calc("+g+"% - 20px);'></div>").append("<div class='div-line1-after'></div>").append("<div class='div-line2'  style='width:"+(100-g)+"%;'></div>");
}else{k.append("<div class='div-line1'  style='width:"+g+"%'></div>").append("<div class='div-line1-after'></div>").append("<div class='div-line2'  style='width:calc("+(100-g)+"% - 20px);'></div>");
}k.append("</div>").append("<div>完成度：<span class='target-num'>"+g+"%</span></div>").append("</div>");}k.append("</div>");}if(f.records<=0){k.append("<div class='norecords' ><img src='/t9-ecm/img/jt/coffee3.png' ><br>没有数据</div>");
}$("#employeeTargetContainer").empty().append(k.toString());$("#employeeTargetPageContainer").find(".first-row").empty().append(a._min(((a.listData.page-1)*a.listData.rows+1),f.records));
$("#employeeTargetPageContainer").find(".last-row").empty().append(a._min(a.listData.page*a.listData.rows,f.records));$("#employeeTargetPageContainer").find(".total-row").empty().append(f.records);
if(a.listData.total>a.listData.page){$("#employeeTargetPageContainer").find(".next-page").removeClass("no");}else{$("#employeeTargetPageContainer").find(".next-page").addClass("no");
}if(a.listData.page>1){$("#employeeTargetPageContainer").find(".pre-page").removeClass("no");}else{$("#employeeTargetPageContainer").find(".pre-page").addClass("no");
}});},_min:function(d,c){return d>c?c:d;}};