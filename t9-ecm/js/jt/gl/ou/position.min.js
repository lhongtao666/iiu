$(function(){var a=new Position();a.init();});function Position(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}Position._CONS_={EDIT_URL:ctx+"/gl/ou/position/edit.htm",DETAIL_URL:ctx+"/gl/ou/position/detail.htm",DELETE_URL:ctx+"/gl/ou/position/delete.htm",SAVE_ADD_URL:ctx+"/gl/ou/position/saveAdd.htm",SAVE_EDIT_URL:ctx+"/gl/ou/position/saveEdit.htm",LIST_DATA_URL:ctx+"/gl/ou/position/listData.htm",};
Position.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._hideNotGrantBtn();this._initTable();}},_hideNotGrantBtn:function(){},_delete:function(b){var a=this;
DialogUtils.confirm(function(){FormUtils.del(Position._CONS_.DELETE_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,msgCode.DELETE_MSG);
PositionUtils.clearPositionCache();a._initTable();}else{DialogUtils.error(msgCode.ERROR,c.msg);}});});},_bindEventHander:function(){var a=this;$(document).on("click","#groupName",function(){var c=$("#typeSelect").val();
var b={isMultiple:0,selectedGroupId:$("input[name='groupId']").val(),container:"groupName",positionType:"all",fn:function(g,m,k){$("input[name=groupId]").val(g);
$("input[name=groupKey]").val(m);var f={};var i=$("#groupName").closest("tr");var d=i.find(".posiName").text();var e=i.attr("poId");var j=i.attr("createTime");
var l=i.attr("createBy");var h=i.attr("desc");f.name=d;f.id=e;f.createTime=j;f.createBy=l;f.desc=h;f.groupName=k;f.groupId=g;f.groupKey=m;if(i.find(".js-switch").is(":checked")){f.type="specify";
}else{f.type="self";}FormUtils.submit(Position._CONS_.SAVE_EDIT_URL,f,function(n){if(n.success){a._initTable();if(n.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);
}else{if(n.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);}}}else{DialogUtils.error(msgCode.FAIL,n.msg);}},null,true);
}};GroupUtils.selectGroupTreeBox(b);});$(document).on("click","#groupNameAdd",function(){var c=$("#typeSelect").val();var b={isMultiple:0,selectedGroupId:$("input[name='groupId']").val(),container:"groupNameAdd",positionType:"all",fn:function(e,d,f){$("input[name=groupId]").val(e);
$("input[name=groupKey]").val(d);}};GroupUtils.selectGroupTreeBox(b);});$("body").on("click",".positionDel",function(){var b=$(this).parent().parent().attr("poId");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_DELETE);return;}a._delete(b);});$("body").on("blur",".hasGroup",function(){var c={};
var b=$(this).parent();if($(this).is(".associateGroup")){c.name=b.find(".posiName").text();}else{c.name=b.find(".posiName").find("input[name='value']").val();
}c.id=b.attr("poId");c.createTime=b.attr("createTime");c.createBy=b.attr("createBy");c.desc=b.attr("desc");c.groupName=b.attr("groupName");c.groupId=b.attr("groupId");
c.groupKey=b.attr("groupKey");if(b.find(".js-switch").is(":checked")){c.type="specify";}else{c.type="self";}FormUtils.submit(Position._CONS_.SAVE_EDIT_URL,c,function(d){if(d.success){a._initTable();
if(d.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);}else{if(d.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
}}}else{DialogUtils.error(msgCode.FAIL,d.msg);}},null,true);});if(ResUtils.canShow("position.button.edit")){$("body").on("dblclick",".hasGroup1",function(){var d=$(this).attr("idVal");
var b=$(this).text();if(d=="groupType"&&!$(this).prev().find(".js-switch").is(":checked")){return;}else{if($(this).prev().find(".js-switch").is(":checked")){var c='<input name="groupName" id="groupName" placeholder="" type="text" class="form-control" required readOnly="readOnly" validateType="default"/><input type="hidden" name="groupId"> <input type="hidden" name="groupKey">';
$(this).empty().append(c);}else{var c="<input name='value' class='form-control required'  value='"+b+"' >";$(this).empty().append(c);}}});$("body").on("change",".js-switch",function(){var d={};
var b=$(this).parent().parent();d.name=b.find(".posiName").text();d.id=b.attr("poId");d.createTime=b.attr("createTime");d.createBy=b.attr("createBy");d.desc=b.attr("desc");
if($(this).is(":checked")){if(!b.attr("createTime")){$(this).parent().next().empty().append("<input type='text' readonly='readonly' name='groupName' class='form-control' id='groupNameAdd' validatetype='default' value=''><input type='hidden' name='groupId'><input type='hidden' name='groupKey'>");
}else{$(this).parent().next().empty().append("<input type='text' readonly='readonly' name='groupName' class='form-control' id='groupName' validatetype='default' value=''><input type='hidden' name='groupId'><input type='hidden' name='groupKey'>");
}d.type="specify";var c=$(this).next().text();if(c==""){DialogUtils.error("提示","请选择关联部门");}else{FormUtils.submit(Position._CONS_.SAVE_EDIT_URL,d,function(e){if(e.success){a._initTable();
if(e.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);}else{if(e.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
}}}else{DialogUtils.error(msgCode.FAIL,e.msg);}},null,true);}}else{b.find(".associateGroup").empty();d.type="self";FormUtils.submit(Position._CONS_.SAVE_EDIT_URL,d,function(e){if(e.success){a._initTable();
if(e.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);}else{if(e.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
}}}else{DialogUtils.error(msgCode.FAIL,e.msg);}},null,true);}});$("body").on("dblclick",".addRow",function(){var c=$(this).attr("id");if(c=="specifyGroup"){var b='<input name="groupName"  id="groupNameAdd" placeholder="" type="text" class="form-control" required readOnly="readOnly" validateType="default"/><input type="hidden" name="groupId"> <input type="hidden" name="groupKey">';
$(this).empty().append(b);}else{var b="<input name='value' class='form-control required'>";$(this).empty().append(b);}});$("body").on("click",".positionAdd",function(){var b=Position._CONS_.SAVE_ADD_URL;
var c=$(this).parent().parent();var d={};d.name=c.find("#positionName").find("input[name='value']").val();if(c.find(".js-switch").is(":checked")){d.type="specify";
}else{d.type="self";}d.groupName=c.find("input[name=groupName]").val();d.groupId=c.find("input[name=groupId]").val();d.groupKey=c.find("input[name=groupKey]").val();
FormUtils.submit(b,d,function(e){if(e.success){a._initTable();if(e.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);}else{if(e.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
}}}else{DialogUtils.error(msgCode.FAIL,e.msg);}},null,true);});}},_initTable:function(){var a=this;var b=new StringBuffer();FormUtils.loadData(Position._CONS_.LIST_DATA_URL,function(g){b.append("<div class='panel-body'>").append("<table class='table table-stripped table-bordered table-hover'>").append("<thead>").append("<tr>").append("<th width='5%' >序号</th>").append("<th width='30%' >岗位名称</th>").append("<th width='20%' >是否关联部门</th>").append("<th width='30%' >关联部门</th>").append("<th width='15%' >操作</th>").append("</tr>").append("</thead>").append("<tbody>");
var f=g.rows;for(var e=0;e<f.length;e++){var h=f[e];var d=h.type=="specify"?"checked":"";b.append("<tr class='position-tr' groupName='"+h.groupName+"' groupId='"+h.groupId+"' groupKey='"+h.groupKey+"' poId='"+h.id+"' desc='"+h.desc+"' createBy='"+h.createBy+"' createTime='"+h.createTime+"'>").append("<td>").append(e+1).append("</td>").append("<td class='hasGroup hasGroup1 posiName'>").append(h.name).append("</td >").append("<td idVal='isGroup' class='specifyGroup'>").append("<input type='checkbox' "+d+" class='js-switch'>").append("</td>").append("<td class='associateGroup hasGroup1' idVal='groupType' groupId='"+h.groupId+"'>").append(h.groupName).append("</td>").append("<td>");
if(ResUtils.canShow("position.button.delete")){b.append("<button type='button' class='btn btn-sm btn-primary btn-outline btn-danger positionDel'>删除</button>");
}b.append("</td>").append("</tr>");}if(ResUtils.canShow("position.button.add")){b.append("<tr class='position-tr'>").append("<td >").append(f.length+1).append("</td>").append("<td id='positionName' class='addRow'>").append("</td>").append("<td class='addRow' id='isGroup'>").append("<input type='checkbox' class='js-switch'>").append("</td >").append("<td class='addRow' id='specifyGroup'>").append("</td>").append("<td>").append("<button type='button' class='btn btn-sm btn-primary btn-outline positionAdd'>添加</button>").append("</td>").append("</tr>");
}b.append("</tbody>").append("</table>").append("</div>");$(".positionList").empty().append(b.toString());var c=Array.prototype.slice.call(document.querySelectorAll(".js-switch"));
c.forEach(function(i){var j=new Switchery(i,{size:"small"});});});},};