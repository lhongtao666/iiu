$(function(){function a(){this.hadInit=false;this.radarChart=null;this.params=null;}a._CONS_={LIST_GROUP_EMPLOYEE:ctx+"/crm/ou/employee/listData.htm?rows=99999",LIST_MGR_SUB_EMPLOYEE:ctx+"/crm/ou/employee/findSubEmployee.htm",EDIT_URL:ctx+"/gl/ou/employeeInterst/edit.htm",DETAIL_URL:ctx+"/gl/ou/employeeInterst/detail.htm",DELETE_URL:ctx+"/gl/ou/employeeInterst/delete.htm",SAVE_ADD_URL:ctx+"/gl/ou/employeeInterst/saveAdd.htm",SAVE_EDIT_URL:ctx+"/gl/ou/employeeInterst/saveEdit.htm",LIST_DATA_URL:ctx+"/gl/ou/employeeInterst/listData.htm",EDIT_FORM_ID:"employeeInterstForm",LOAD_RADAR_DATA:ctx+"/gl/ou/employeeInterst/loadRadarData.htm",GRID:"#employeeInterstGrid",PAGER:"#employeeInterstPager"};
a.prototype={init:function(d){this._dealPanelTitle(d);if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._initTimeSelect();}this.params=d;
if(d.radarType&&d.radarType=="manager_type"){$("#chooseEmployeeDiv").show();this._initEmployeeSelect();}this._initRadar();},_dealPanelTitle:function(d){if(d&&d.isHidePanelTitle){$("#panelTitle").hide();
$("#panelTitle").remove();}},_initTimeSelect:function(){var d=this;var f=new Date();var e=d._getTimeOptions({type:"year",selectedOption:f.getFullYear()});
$("#yearSelect").empty().append(e.toString()).trigger("change");},_getOpt:function(f,d,e){var g="<option value='"+f+"' "+(e?"selected='selected'":"")+" >"+d+"</option>";
return g;},_getTimeOptions:function(j){var n=j.type;var g=j.selectedOption;var p=this;var o=new StringBuffer();if(n=="year"){var d=new Date();var k=DateUtils.format(d,"yyyy");
if(g){if(g/1<=k/1&&g>k/1-10){for(var h=0;h<10;h++){var m=k/1-h;var l=p._getOpt(m,m+"年",m==g/1);o.append(l);}}else{for(var h=k/1;h>=g/1;h--){var l=p._getOpt(h,h+"年",h==g/1);
o.append(l);}}}else{for(var h=0;h<10;h++){var m=k/1-h;var l=p._getOpt(m,m+"年");o.append(l);}}}else{var f=13;f=(j&&j.limit)?j.limit:13;for(var h=1;h<=f;
h++){var e=(h<10)?("0"+h):h;o.append('<option value="'+e);o.append('"');if(e==g){o.append(' selected="selected" ');}o.append(" >");o.append(h+"月");o.append("</option>");
}}return o.toString();},_bindEventHander:function(){var d=this;$("body").on("blur","#employeeSelect",function(){console.log("select-blur");});$("body").on("click","#generateModel",function(){var e=$("#employeeSelect").val();
if(e&&e.length>0){d._loadRadarData(e.join(","));}else{d._loadRadarData("");}});$("body").on("change","#yearSelect",function(){var e=$(this).val();var f=new Date();
var g=null;if(e==f.getFullYear()){g=d._getTimeOptions({type:"month",limit:f.getMonth()+1});}else{g=d._getTimeOptions({type:"month"});}g='<option value="">请选择月份</option>'+g;
$("#monthSelect").empty().append(g);});},_refreshRadarData:function(e){if(!this.radarChart){console.log("雷达图没有初始化，无法刷新");}var d=this.radarChart.getOption();
d.series[0].data=e;this.radarChart.setOption(d);},_loadRadarData:function(g){var f=this;if(f.params.radarType&&f.params.radarType=="manager_type"){if(!g){DialogUtils.error(msgCode.error,"没有选择员工!");
return;}}else{g=f.params.employeeIds;}var h=g.split(",");var i=$("#yearSelect").val()+""+$("#monthSelect").val();var d="year";var e=$("[name=radarMaxChoose]").val();
if(i.length>4){d="month";}var e=$("[name=radarMaxChoose]").val();FormUtils.loadData(a._CONS_.LOAD_RADAR_DATA+"?radarMaxChoose="+e+"&period="+i+"&periodType="+d+"&employeeIds="+g,function(z){console.log(z);
var q=z.interstMax;var o=z.employeePartyPo;var p=z.employeeValues;var k=[];var y=[];var l=[];for(var m=0;m<h.length;m++){var v=h[m];k.push(o[v].name);}for(var x in q){var n=$("[name=radarMaxChoose]").val();
if(n){y.push({name:x,max:q[x]?q[x]:500,min:0});}else{y.push({name:x,min:0});}}for(var m=0;m<h.length;m++){var v=h[m];var u=p[v];var s={name:o[v].name,value:[],};
for(var x in q){var w=u[x];s.value.push(w.performance);}l.push(s);}var r=echarts.init(document.getElementById("echarts-radar-chart"));console.log("radarChart: ==>"+r);
var j={title:{},tooltip:{},legend:{data:k,orient:"vertical",x:"left",y:"top",},radar:{indicator:y,},series:[{name:"雷达图",type:"radar",data:l,}]};r.setOption(j);
f.radarChart=r;},function(){DialogUtils.error(msgCode.error,"请求出错");});},_initEmployeeSelect:function(){var d=this;FormUtils.loadData(a._CONS_.LIST_MGR_SUB_EMPLOYEE,function(f){console.log(f);
var e=f;var j=new StringBuffer();if(e.length>0){for(var g=0;g<e.length;g++){var h=e[g];j.append("<option value='");j.append(h.id);j.append("'>");j.append(h.name);
j.append("</option>");}}$("#employeeSelect").append(j.toString());$("#employeeSelect").chosen("destroy");$("#employeeSelect").chosen({no_results_text:"没有找到"});
});},_initRadar:function(){var d=this;var e=d.params.employeeIds;this._loadRadarData(e);}};var b=new a();var c={radarType:radarType,employeeIds:employeeIds,isHidePanelTitle:isHidePanelTitle,};
b.init(c);});