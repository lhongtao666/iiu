$(function(){var a=new AdnAid();a.init();});function AdnAid(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}AdnAid._CONS_={EDIT_URL:ctx+"/gl/cti/adnAid/edit.htm",DETAIL_URL:ctx+"/gl/cti/adnAid/detail.htm",DELETE_URL:ctx+"/gl/cti/adnAid/delete.htm",SAVE_ADD_URL:ctx+"/gl/cti/adnAid/saveAdd.htm",SAVE_EDIT_URL:ctx+"/gl/cti/adnAid/saveEdit.htm",LIST_DATA_URL:ctx+"/gl/cti/adnAid/listData.htm",EDIT_FORM_ID:"adnAidForm",GRID:"#adnAidGrid",PAGER:"#adnAidPager"};
AdnAid.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._initButton();this._bindEventHander();this._reloadData();}},_initButton:function(){var a=ctx+"/gl/cti/adnAid/bindAdnAidStatus.htm";
FormUtils.loadData(a,function(b){if(b){var c=b.value=="y"?true:false;$(".js-switch").attr("checked",c);new Switchery(document.querySelector(".js-switch"),{size:"small"});
}},null,false);},_reloadData:function(){var b=this;var a=AdnAid._CONS_.LIST_DATA_URL;FormUtils.loadData(a,function(e){if(e&&e.length){var d=$.templates("#adnAidListTrTmpl");
var c=d.render(e);$("#adnAidListContainer").empty().append(c);}},null,false);},_hideNotGrantBtn:function(){if(!ResUtils.canShow("adnAid.button.detail")){$(".adnAidDetail").hide();
}if(!ResUtils.canShow("adnAid.button.add")){$(".adnAidAdd").hide();}if(!ResUtils.canShow("adnAid.button.edit")){$(".adnAidEdit").hide();}if(!ResUtils.canShow("adnAid.button.delete")){$(".adnAidDel").hide();
}},_add:function(){var c=$.templates("#adnAidListTrTmpl");var d={};var b=[];b.push(d);var a=c.render(b);$("#adnAidListContainer").append(a);},_delete:function(b){var a=this;
FormUtils.del(AdnAid._CONS_.DELETE_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,msgCode.DELETE_MSG);a._reloadData();}else{DialogUtils.error(msgCode.ERROR,c.msg);
}});},_update:function(c){var b=this;var a=AdnAid._CONS_.SAVE_EDIT_URL;var d=c;FormUtils.submit(a,d,function(e){if(e.success){if(e.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);
b._reloadData();}else{if(e.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);b._reloadData();}}b.isEdit=false;b.clear(true);
}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},_bindEventHander:function(){var a=this;
$(document).on("change",".js-switch",function(d){var c=this.checked;var b=ctx+"/gl/cti/adnAid/changeBindAdnAid.htm";var e={open:c?"y":"n"};FormUtils.submit(b,e,function(f){if(f.success){if(f.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);
}else{if(f.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);}}}else{DialogUtils.error(msgCode.FAIL_MSG,f.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});$("body").on("click",".adnAidDel",function(){var b=$(this).attr("adn");if(!b){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_DELETE);return;
}a._delete(b);});$("body").on("click",".adnAidAdd",function(){a._add();});$(document).on("click",".prevBtn",function(){$(this).parents("tr").remove();});
$(document).on("click",".saveBtn",function(){var b=null;b=AdnAid._CONS_.SAVE_ADD_URL;var c=$(this).parents("tr");var f=c.find("[name=adn]").val();var d=c.find("[name=aid]").val();
if(!f||!d){DialogUtils.error(msgCode.ERROR,"分机或工号不能为空!");return;}var e={adn:f,aid:d,};FormUtils.submit(b,e,function(g){if(g.success){if(g.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);
a._reloadData();}else{if(g.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);a._reloadData();}}}else{DialogUtils.error(msgCode.FAIL_MSG,g.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});},};