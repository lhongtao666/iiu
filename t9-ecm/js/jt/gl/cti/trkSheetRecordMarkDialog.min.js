function TrkSheetRecordMarkDialog(){this.hadInit=false;this.params=null;}TrkSheetRecordMarkDialog._CONS_={LIST_DATA:ctx+"/gl/cti/trksheetRecordMark/listData.htm",SAVE_MARK_URL:ctx+"/gl/cti/trksheetRecordMark/saveAdd.htm",DELETE_MARK_URL:ctx+"/gl/cti/trksheetRecordMark/delete.htm",};
TrkSheetRecordMarkDialog.prototype={init:function(b){var a=this;a.params=b;a._initDataList(b);a._bindEventHandler();},_initDataList:function(b){var a=this;
FormUtils.submit(TrkSheetRecordMarkDialog._CONS_.LIST_DATA,b,function(e){var f=new StringBuffer();var d=e.rows;if(d&&d.length>0){for(var c=0;c<d.length;
c++){f.append(a._createTr(d[c],(c+1)));}}$(".data-table tbody").empty().append(f.toString());});},_bindEventHandler:function(){var a=this;$(document).on("click",".addRow",function(){a._addRow();
});$(document).on("click",".saveRow",function(){var d=$(this).parents("tr");var e=d.find("[name=mark]").val();var c=d.find("[name=markDes]").val();console.log("mark:"+e);
console.log("markDes:"+c);var b=$(this).attr("idVal");if(!d.find("#markForm"+b).valid()||!d.find("#markDesForm"+b).valid()){return;}a._saveRow(e,c);});
$(document).on("click",".deleteRow",function(){var b=$(this).attr("idVal");a._deleteRow(b);});$(document).on("change",".markSelect",function(){var d=$(this).parents("tr");
var b=$(this).val();if(!b){d.find(".markDesSelect").empty();}else{var c=d.attr("id");CateUtils.getOptions({typeKey:"system",pKey:b,container:"markDesSelect"+c});
}});},_generateCode:function(){var a=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1);};return(a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a());
},_saveRow:function(e,d){var a=this;var b=a.params.Q__S__EQ__recordId;var c={recordid:b,mark:e,markDes:d,};FormUtils.submit(TrkSheetRecordMarkDialog._CONS_.SAVE_MARK_URL,$.param(c),function(f){if(f.success){DialogUtils.success(msgCode.SUCCESS,f.msg);
a._initDataList(a.params);}else{DialogUtils.error(msgCode.ERROR,f.msg);}});},_deleteRow:function(b){var a=this;FormUtils.del(TrkSheetRecordMarkDialog._CONS_.DELETE_MARK_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,msgCode.DELETE_MSG);
a._initDataList(a.params);}else{DialogUtils.error(msgCode.ERROR,c.msg);}});},_addRow:function(){var c=this;var b=c._generateCode();var g=new StringBuffer();
g.append('<tr id="'+b+'">');var e=parseInt($(".sortIndex:last").text()||"0");g.append('<td class="sortIndex">');g.append(e+1);g.append("</td>");g.append("<td>");
g.append("");g.append("</td>");g.append("<td>");g.append(currentUserAid+"："+currentUserName);g.append("</td>");g.append("<td>");g.append('<form id="markForm'+b+'">');
g.append('<select class="form-control markSelect" id="markSelect'+b+'" name="mark" validatetype="default" aria-required="true" aria-invalid="false" aria-describedby=""></select>');
g.append("</form>");g.append("</td>");g.append('<td width="120">');g.append('<form id="markDesForm'+b+'">');g.append('<select name="markDes" id="markDesSelect'+b+'" validatetype="default" type="text" class="form-control markDesSelect" value=""></select>');
g.append("</form>");g.append("</td>");g.append("<td>");g.append('<button type="button" class="add btn btn-sm btn-primary saveRow" idVal="'+b+'">保存</button>');
g.append("</td>");g.append("</tr>");var a=g.toString();$(".data-table tbody").append(a);CateUtils.getOptions({typeKey:"system",pKey:"trksheetrecordMarkType",container:"markSelect"+b});
var d={rules:{mark:{required:true,},},messages:{}};FormUtils.bindFormValidation("markForm"+b,d);var f={rules:{markDes:{required:true,},},messages:{}};FormUtils.bindFormValidation("markDesForm"+b,f);
},_createTr:function(c,b){var a=this;var d=new StringBuffer();d.append("<tr>");d.append('<td class="sortIndex">');d.append(b);d.append("</td>");d.append("<td>");
d.append(c.createTime);d.append("</td>");d.append("<td>");d.append(c.createByAid+"："+c.createByName);d.append("</td>");d.append("<td>");d.append(c.mark);
d.append("</td>");d.append("<td>");d.append(c.markDes);d.append("</td>");d.append("<td>");d.append('<button idval="'+c.id+'" type="button" class="deleteRow btn btn-sm btn-danger"><i class="fa fa-minus"></i></button>');
d.append("</td>");d.append("</tr>");return d.toString();},};