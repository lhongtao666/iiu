$(function(){var a=new AdnManage();a.init();});function AdnManage(){this.hadInit=false;this.intervalMethod=null;this.intervalId=null;this.isHasMonitor=false;
}AdnManage._CONS_={LIST_DATA_URL:ctx+"/gl/cti/adnManage/listData.htm",UPDATE_ADN_STATUS_URL:ctx+"/crm/ou/employee/updateAdnStatusById.htm",};AdnManage.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;
this._bindEventHander();this._reloadListData();if(!ResUtils.canShow("adnManage.button.forcebusy")){$(".forcebusy").hide();}if(!ResUtils.canShow("adnManage.button.forceidle")){$(".forceidle").hide();
}if(!ResUtils.canShow("adnManage.button.forcehugup")){$(".forcehugup").hide();}if(!ResUtils.canShow("adnManage.button.listen")){$(".listen").hide();}}},_bindEventHander:function(){var a=this;
$(document).on("click",".refreshList",function(){a._reloadListData();});$(document).on("click",".forcebusy",function(){if($("input[name=adnCheckbox]:checked").length<1){DialogUtils.error(msgCode.FAIL_MSG,"请勾选需要示忙分机！");
return;}var b=$("input[name=adnCheckbox]:checked");var d="";for(var c=0;c<b.size();c++){d=d+","+$(b[c]).val();}d=d.substring(1);FormUtils.submit(AdnManage._CONS_.UPDATE_ADN_STATUS_URL+"?status=busy&adns="+d,null,function(e){if(e.success){a._reloadListData();
DialogUtils.success(msgCode.SUCCESS,e.msg);}else{DialogUtils.error(msgCode.ERROR,e.msg);}});});$(document).on("click",".forceidle",function(){if($("input[name=adnCheckbox]:checked").length<1){DialogUtils.error(msgCode.FAIL_MSG,"请勾选需要示闲分机！");
return;}var b=$("input[name=adnCheckbox]:checked");var d="";for(var c=0;c<b.size();c++){d=d+","+$(b[c]).val();}d=d.substring(1);FormUtils.submit(AdnManage._CONS_.UPDATE_ADN_STATUS_URL+"?status=idle&adns="+d,null,function(e){if(e.success){a._reloadListData();
DialogUtils.success(msgCode.SUCCESS,e.msg);}else{DialogUtils.error(msgCode.ERROR,e.msg);}});});$(document).on("click",".forcehugup",function(){var b=$("input[name=adnCheckbox]:checked");
var d="";for(var c=0;c<b.size();c++){d=d+","+$(b[c]).val();}d=d.substring(1);FormUtils.submit(AdnManage._CONS_.UPDATE_ADN_STATUS_URL+"?status=forceHugup&adns="+d,null,function(e){if(e.success){a._reloadListData();
DialogUtils.success(msgCode.SUCCESS,e.msg);}else{DialogUtils.error(msgCode.ERROR,e.msg);}});});$(document).on("click",".listen",function(){if($("input[name=adnCheckbox]:checked").length<1){DialogUtils.error(msgCode.FAIL_MSG,"请勾选需要监听的分机！");
return;}if($("input[name=adnCheckbox]:checked").length>1){DialogUtils.error(msgCode.FAIL_MSG,"每次只能监听的一个分机！");return;}var c=$("input[name=adnCheckbox]:checked");
var e="";for(var d=0;d<c.size();d++){e=e+","+$(c[d]).val();}e=e.substring(1);if(window.top&&window.top.jtCtiService){var b=window.top.currentUserAdn;FormUtils.submit(AdnManage._CONS_.UPDATE_ADN_STATUS_URL+"?useAdn="+b+"&status=listen&adns="+e,null,function(f){if(f.success){DialogUtils.success(msgCode.SUCCESS,f.msg);
}else{DialogUtils.error(msgCode.ERROR,f.msg);}});}else{DialogUtils.error(msgCode.FAIL_MSG,"需要登录分机才能进行监听！");return;}});$(document).on("change","#checkAll",function(){if($("#checkAll").is(":checked")){$("input[name=adnCheckbox]").prop("checked",true);
}else{$("input[name=adnCheckbox]").prop("checked",false);}});},_reloadListData:function(a){FormUtils.submit(AdnManage._CONS_.LIST_DATA_URL,a,function(e){console.log(e);
if(e&&e.length){var g=$.templates("#panelTmp");var d=g.render({});var c=$.templates("#cardBoxTmp");var f=c.render(e);var b=$(d).find("#defaultAdnPanelBody").empty().append(f);
$("#bs-collapse").empty().append(b);}});}};