$(function(){var a=new TelMonitorList();a.init();});function TelMonitorList(){this.hadInit=false;this.intervalMethod=null;this.intervalId=null;this.isHasMonitor=false;
}TelMonitorList._CONS_={LIST_DATA_URL:ctx+"/crm/ou/employee/initTelMonitorList.htm",UPDATE_ADN_STATUS_URL:ctx+"/crm/ou/employee/updateAdnStatusById.htm",};
TelMonitorList.prototype={init:function(b){if(!this.hadInit){this.hadInit=true;this._bindEventHander();if(ResUtils.canShow("telMonitor.fenjiMonitor.button")){this.isHasMonitor=true;
}this._initTelMonitorList(b,this);if(this.intervalId!=null||this.intervalId!=""){clearInterval(this.intervalId);this.intervalId=null;}var a=this;this.intervalId=setInterval(function(){a._initTelMonitorList(null,a);
},parseInt(refreshTime)*1000);}},_bindEventHander:function(){$(document).on("click",".fenjiMonitor",function(){var b=$(this).attr("idValue");var a=true;
if(b==null||b.length==0){DialogUtils.error("错误","数据错误，员工工号为空");return;}window.top.jtCtiService._monitor(b,a);});$(document).on("click",".forcebusy",function(){var a=$(this).attr("idValue");
if(a==null||a.length==0){DialogUtils.error("错误","数据错误，员工工号为空");return;}window.top.jtCtiService.forcebusy(a);FormUtils.submit(TelMonitorList._CONS_.UPDATE_ADN_STATUS_URL+"?status=3&aid="+a,null,function(b){});
});$(document).on("click",".fenjiInterrupt",function(){var b=$(this).attr("idValue");var a=true;if(b==null||b.length==0){DialogUtils.error("错误","数据错误，员工工号为空");
return;}window.top.jtCtiService._interrupt(b,a);});$(document).on("click",".forceidle",function(){var a=$(this).attr("idValue");if(a==null||a.length==0){DialogUtils.error("错误","数据错误，员工工号为空");
return;}window.top.jtCtiService.forceidle(a);FormUtils.submit(TelMonitorList._CONS_.UPDATE_ADN_STATUS_URL+"?status=0&aid="+a,null,function(b){});});$(document).on("click",".acditemlist",function(){var a=currentUserAcd;
if(a.indexOf(":")>0){a=currentUserAcd.split(":")[1];}window.top.jtCtiService.acditemlist(a,function(c,b){var d=b.acditemlist;if(b.errno==0){self.layerIndex=layer.open({type:1,title:["队列排队列表","background-color:#2ac1ac;color:white;font-size:1em;"],shade:false,btn:["关闭"],area:["25%","60%"],content:$(".acditemDiv"),scrollbar:false,skin:"my-skin",success:function(e,f){if(d.length>0){var h="<div style='    font-size: 18px; font-weight: bold;'>排队总数："+d.length+"</div><br>";
for(var g=0;g<d.length;g++){h+="<div>手机号码："+d[g].teleno+", 呼入时间："+d[g].dtime+"</div>";}$(".showAcdItemList").empty().append(h);}else{$(".showAcdItemList").empty().append("没有排队数据");
}},yes:function(f,e){layer.close(self.layerIndex);},on:function(f,e){layer.close(self.layerIndex);},cancel:function(){layer.close(self.layerIndex);}});
}});});},_initTelMonitorList:function(c,b){var a=b;FormUtils.submit(TelMonitorList._CONS_.LIST_DATA_URL,c,function(d){if(d){if(d.idle&&d.idle.length>0){$("#idleStatusDiv").show();
a._appendContentList("idleStatusList",d.idle,0,a.isHasMonitor);}else{$("#idleStatusDiv").hide();}if(d.calling&&d.calling.length>0){$("#callingDiv").show();
a._appendContentList("callingList",d.calling,1,a.isHasMonitor);}else{$("#callingDiv").hide();}if(d.handup&&d.handup.length>0){$("#handUpDiv").show();a._appendContentList("handUpList",d.handup,2,false);
}else{$("#handUpDiv").hide();}if(d.disturb&&d.disturb.length>0){$("#disturbDiv").show();a._appendContentList("disturbList",d.disturb,3,a.isHasMonitor);
}else{$("#disturbDiv").hide();}if(d.callEndDeal&&d.callEndDeal.length>0){$("#callEndDealDiv").show();a._appendContentList("callEndDealList",d.callEndDeal,5,a.isHasMonitor);
}else{$("#callEndDealDiv").hide();}if(d.ringing&&d.ringing.length>0){$("#ringingDiv").show();a._appendContentList("ringingList",d.ringing,4,a.isHasMonitor);
}else{$("#ringingDiv").hide();}}});},_appendContentList:function(b,f,a,c){var e="";for(var d=0;d<f.length;d++){e+='<div class="cardBox col-sm-2">'+'<div class="headerBox cardBoxBaseColor">'+"<span >"+f[d].aid+":"+f[d].name+"</span>"+"</div>"+'<div class="bodyBox">'+'<div class="col-sm-4">';
if(f[d].profile!=null&&f[d].profile!=""){e+='<div class="img-container"><img class="img-responsive" src="'+ctx+f[d].profile+'"></div>';}else{e+='<div class="img-container"><img class="img-responsive" src="/t9-ecm/img/jt/defaulTouXiang.png?dm=_mm"></div>';
}e+="</div>"+'<div class="col-sm-8 cotentBody">'+'<div class="col-sm-12">'+'<div class="col-sm-6" ><span  class="spanFloatRight">分机：</span></div>'+'<div class="col-sm-6" ><span  class="spanFloatLeft">'+f[d].loginedAdn+"</span></div>";
if(c){if(0==a){e+='<div class="col-sm-6"><a type="button" class="jt-btn-safe forcebusy" idValue="'+f[d].aid+'"> <i class="fa">强制示忙</i></a></div>';}if(1==a){e+='<div class="col-sm-6"><a type="button" class="jt-btn-safe fenjiMonitor"  idValue="'+f[d].aid+'"> <i class="fa">监听</i></a></div>'+'<div class="col-sm-6"><a type="button" class="jt-btn-safe fenjiInterrupt" idValue="'+f[d].aid+'"> <i class="fa">强插</i></a></div>';
}if(3==a||5==a){e+='<div class="col-sm-6"><a type="button" class="jt-btn-safe forceidle" idValue="'+f[d].aid+'"> <i class="fa">强制示闲</i></a></div>';}}e+="</div>"+"</div>"+"</div>"+"</div>";
}$("#"+b).empty().append(e);},};