function AdnRecordManager(){}AdnRecordManager.prototype={init:function(){var a=this;a.tabAllInit=true;a.tabAll=new AdnRecord({tabName:"all"});a.tabAll.init();
a.subTabArr=[];if(feeTypeMap){for(var b in feeTypeMap){this.subTabArr[b]=false;}}this._bindEventHandler();},_bindEventHandler:function(){var a=this;$("#adnRecordContainer").on("click",".tabli",function(){var b=$(this).attr("feeType");
if(!a.subTabArr[b]&&b!="all"){a.subTabArr[b]=true;var c=new AdnRecord({tabName:b,gidType:b});c.init();}});},};function AdnRecord(a){this.tabName=a.tabName;
this.gidType=a.gidType;}AdnRecord._CONS_={EXPORT_DATA_URL:ctx+"/gl/cti/tRKSheetRecord/exportAdn.htm",};AdnRecord.prototype={init:function(){var b=this;
this._bindEventHandler();this._hideNotGrantBtn();this._locateToGlHelp();var a="#adnRecordGrid-"+this.tabName;var c="#adnRecordPager-"+this.tabName;this._initJqgrid(a,c,b.gidType);
},_locateToGlHelp:function(){var a="glHelp.dataAudit.tRKSheetRecordAdn";glHelpUtil.init(a);},_hideNotGrantBtn:function(){if(!ResUtils.canShow("trkSheetRecord.button.exportAdn")){$(".exportAdn").hide();
}},_bindEventHandler:function(){var a=this;$(document).on("click","#tabAdn-"+a.tabName+" #orgName",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$("#tabAdn-"+a.tabName+" #orgId").val(),container:"tabAdn-"+a.tabName+" #orgName",fn:function(b){$("#tabAdn-"+a.tabName+" #orgId").val(b);
}});});$(document).on("click","#tabAdn-"+a.tabName+" .exportAdn",function(){var b={startTime:$("#tabAdn-"+a.tabName+" input[name='startTime']").val(),endTime:$("#tabAdn-"+a.tabName+" input[name='endTime']").val(),orgId:$("#tabAdn-"+a.tabName+" #orgId").val(),agentId:$("#tabAdn-"+a.tabName+" #agentId").val(),type:$("#tabAdn-"+a.tabName+" #type").val()};
FormUtils.submit(AdnRecord._CONS_.EXPORT_DATA_URL,b,function(c){if(c.success){DialogUtils.success("成功",c.msg);}else{DialogUtils.error("失败",c.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");
});});$(document).on("click","#tabAdn-"+a.tabName+" .chooseDateBtn",function(){$("#tabAdn-"+a.tabName+" .chooseDateBtn").each(function(){if($(this).hasClass("btn-danger")){$(this).removeClass("btn-danger").addClass("btn-primary");
return false;}});$(this).removeClass("btn-primary").addClass("btn-danger");var i=$(this).attr("actionVal");var h="";var c="";switch(i){case"day":var p=new Date();
var g=p.getFullYear();var r=p.getMonth()+1;if(r<10){r="0"+r;}var l=p.getDate();if(l<10){l="0"+l;}h=g+"-"+r+"-"+l+" 00:00:00";c=g+"-"+r+"-"+l+" 23:59:59";
break;case"yesterday":var d=DateUtils.getBeforeDate(1);h=d+" 00:00:00";c=d+" 23:59:59";break;case"lastWeek":var p=new Date();var g=p.getFullYear();var r=p.getMonth()+1;
if(r<10){r="0"+r;}var l=p.getDate();if(l<10){l="0"+l;}var q=DateUtils.getBeforeDate(7);h=q+" 00:00:00";c=g+"-"+r+"-"+l+" 23:59:59";break;case"month":var b=DateUtils.getCurrentMonthFirst();
var j=b.getFullYear();var n=b.getMonth()+1;var b=b.getDate();if(n<10){n="0"+n;}if(b<10){b="0"+b;}h=j+"-"+n+"-"+b+" 00:00:00";c=new Date().current();break;
case"lastMonth":var r=new Date().getMonth();var k=DateUtils.getCurrentMonthFirst();var s=new Date(k-1000*60*60*24);var e=s.getFullYear();var f=s.getMonth()+1;
var m=s.getDate();if(f<10){f="0"+f;}if(m<10){m="0"+m;}h=e+"-"+f+"-"+"01"+" 00:00:00";c=e+"-"+f+"-"+m+" 23:59:59";break;}var o={startTime:h,endTime:c,orgId:$("#tabAdn-"+a.tabName+" #orgId").val(),agentId:$("#tabAdn-"+a.tabName+" #agentId").val(),type:$("#tabAdn-"+a.tabName+" #type").val(),adnDurationShowType:$("#tabAdn-"+a.tabName+" #adnDurationShowType").val()};
$("#tabAdn-"+a.tabName+' input[name="startTime"]').val(h);$("#tabAdn-"+a.tabName+' input[name="endTime"]').val(c);a._reloadJqgird(o);});$(document).on("click","#tabAdn-"+a.tabName+" .adnRecordSearch",function(){var c=$("input[name='startTime']").val();
var b=$("input[name='endTime']").val();if(c||b){$("#tabAdn-"+a.tabName+" .chooseDateBtn").each(function(){if($(this).hasClass("btn-danger")){$(this).removeClass("btn-danger").addClass("btn-primary");
return false;}});var d={startTime:$("#tabAdn-"+a.tabName+" input[name='startTime']").val(),endTime:$("#tabAdn-"+a.tabName+" input[name='endTime']").val(),orgId:$("#tabAdn-"+a.tabName+" #orgId").val(),agentId:$("#tabAdn-"+a.tabName+" #agentId").val(),type:$("#tabAdn-"+a.tabName+" #type").val(),adnDurationShowType:$("#tabAdn-"+a.tabName+" #adnDurationShowType").val()};
a._reloadJqgird(d);}else{$("#tabAdn-"+a.tabName+" .chooseDateBtn").each(function(){if($(this).hasClass("btn-danger")){$(this).trigger("click");return false;
}});return;}});$("body").on("click","#tabAdn-"+a.tabName+" .viewCsEntityBtn",function(){JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/toListByPhone.htm?phoneNums="+$(this).attr("csPhonesVal"),"我的客户");
});$("body").on("click","#tabAdn-"+a.tabName+" .openAgentDetail",function(){var k=$(this);var e=k.attr("queryType");var n=null;if(e=="agentId"){n="工号";
}else{if(e=="adn"){n="分机";}else{if(e=="adnNumber"){n="号码";}}}var d=k.attr("agentId");var l=k.attr("direction");var m=k.attr("recFile");var f=k.attr("gidTypeKey");
var c=$('input[name="startTime"]').val();var i=$('input[name="endTime"]').val();var j=$(this).attr("limitValidRecord");var g=n+"["+d+"]"+$(this).attr("title")+"记录";
var b={queryType:e,agentId:d,Direction:l,RecFile:m,gidTypeKey:encodeURIComponent(f),startTime:c,endTime:i,adn:d,adnNumber:d,limitValidRecord:j,};var h=$.param(b);
JTTabUtils.addOrRefreshTab(ctx+"/gl/cti/tRKSheetRecord/listRecord.htm?reqType=adnStaticReq&adnStaticReqParamStr="+encodeURIComponent(h),g);});},_reloadJqgird:function(b){var a="#adnRecordGrid-"+this.tabName;
JTJqgridUtils.reloadJqgrid(a,b);},_createColNames:function(c,e,g){var b=this;var h=["呼出已接数/时长","呼出未接数","呼出接通率|有效数","呼入已接数/时长","呼入未接数","呼入漏接率|有效数","通话总数/接通总时长|有效数",];
if(!c){return h;}var a=[];var f=[];for(var d=0;d<h.length;d++){f[d]=g+h[d];}a=a.concat(f);return a;},_createColModels:function(tabContainer,key,value,gidTypeName){var self=this;
var result=[];var typeNames=[];if(tabContainer){typeNames.push("staticMap."+key+".");}else{typeNames.push("totalAdnStaticVo.");}for(var i=0;i<typeNames.length;
i++){var name=typeNames[i];var colModel=[{modelName:name,name:name+"callOutOkCount",width:"120",align:"center",formatter:function(val,opt,row){var callOutOkCountKey="row."+opt.colModel.modelName+"callOutOkCount";
var callOutOkTimeLengthKey="row."+opt.colModel.modelName+"callOutOkTimeLengthShow";var callOutOkCount=eval(callOutOkCountKey);var callOutOkTimeLength=eval(callOutOkTimeLengthKey);
var gidType="";var modelName=opt.colModel.modelName;if(!(modelName.indexOf("totalAdnStaticVo")>-1)){var gidTypeKey=modelName.split(".")[1];gidType=gidTypeKey;
}gidType=gidTypeName?gidTypeName:"";var recFile="1";var queryType=$("#tabAdn-"+self.tabName+" #type").val();var direction="0";var resultStrVal="<span style='color:red;'>"+callOutOkCount+"</span>"+"/<span style='color:blue;'>"+callOutOkTimeLength+"</span>";
return'<a href="javascript:void(0);" title="呼出已接" recFile="'+recFile+'" gidTypeKey="'+gidType+'" direction="'+direction+'"  queryType="'+queryType+'" class="openAgentDetail" agentId="'+row.aid+'">'+resultStrVal+"</a>";
}},{modelName:name,name:name+"callOutNotOkCount",width:"60",align:"center",formatter:function(val,opt,row){var callOutNotOkCountKey="row."+opt.colModel.modelName+"callOutNotOkCount";
var callOutNotOkCount=eval(callOutNotOkCountKey);var gidType="";var modelName=opt.colModel.modelName;if(!(modelName.indexOf("totalAdnStaticVo")>-1)){var gidTypeKey=modelName.split(".")[1];
gidType=gidTypeKey;}gidType=gidTypeName?gidTypeName:"";var recFile="0";var queryType=$("#tabAdn-"+self.tabName+" #type").val();var direction="0";var resultStrVal="<p class='text-danger'>"+callOutNotOkCount+"</p>";
return'<a href="javascript:void(0);" title="呼出未接" recFile="'+recFile+'" gidTypeKey="'+gidType+'" direction="'+direction+'"  queryType="'+queryType+'" class="openAgentDetail" agentId="'+row.aid+'">'+resultStrVal+"</a>";
}},{modelName:name,name:name+"callOutOkPercent",align:"center",width:"120",formatter:function(val,opt,row){var callOutOkPercentKey="row."+opt.colModel.modelName+"callOutOkPercent";
var callOutOkPercent=eval(callOutOkPercentKey);var callOutValidCountKey="row."+opt.colModel.modelName+"callOutValidCount";var callOutValidCount=eval(callOutValidCountKey);
var gidType="";var modelName=opt.colModel.modelName;if(!(modelName.indexOf("totalAdnStaticVo")>-1)){var gidTypeKey=modelName.split(".")[1];gidType=gidTypeKey;
}gidType=gidTypeName?gidTypeName:"";var recFile="";var queryType=$("#tabAdn-"+self.tabName+" #type").val();var direction="0";var resultStrVal=callOutOkPercent;
return resultStrVal+'<a href="javascript:void(0);"  limitValidRecord="y" title="呼出有效通话" recFile="'+recFile+'" gidTypeKey="'+gidType+'" direction="'+direction+'"  queryType="'+queryType+'" class="openAgentDetail" agentId="'+row.aid+'">'+"|<span style='color:blue;'>"+callOutValidCount+"</span>"+"</a>";
}},{modelName:name,name:name+"callInOkCount",width:"120",align:"center",formatter:function(val,opt,row){var callInOkCountKey="row."+opt.colModel.modelName+"callInOkCount";
var callInOkTimeLengthKey="row."+opt.colModel.modelName+"callInOkTimeLengthShow";var callInOkCount=eval(callInOkCountKey);var callInOkTimeLength=eval(callInOkTimeLengthKey);
var gidType="";var modelName=opt.colModel.modelName;if(!(modelName.indexOf("totalAdnStaticVo")>-1)){var gidTypeKey=modelName.split(".")[1];gidType=gidTypeKey;
}gidType=gidTypeName?gidTypeName:"";var recFile="1";var queryType=$("#tabAdn-"+self.tabName+" #type").val();var direction="1";var resultStrVal="<span style='color:red;'>"+callInOkCount+"</span>"+"/<span style='color:blue;'>"+callInOkTimeLength+"</span>";
return'<a href="javascript:void(0);" title="呼入已接" recFile="'+recFile+'" gidTypeKey="'+gidType+'" direction="'+direction+'"  queryType="'+queryType+'" class="openAgentDetail" agentId="'+row.aid+'">'+resultStrVal+"</a>";
}},{modelName:name,name:name+"callInNotOkCount",align:"center",width:"80",formatter:function(val,opt,row){var callInNotOkCountKey="row."+opt.colModel.modelName+"callInNotOkCount";
var callInNotOkCount=eval(callInNotOkCountKey);var gidType="";var modelName=opt.colModel.modelName;if(!(modelName.indexOf("totalAdnStaticVo")>-1)){var gidTypeKey=modelName.split(".")[1];
gidType=gidTypeKey;}gidType=gidTypeName?gidTypeName:"";var recFile="0";var queryType=$("#tabAdn-"+self.tabName+" #type").val();var direction="1";var resultStrVal="<p class='text-danger'>"+callInNotOkCount+"</p>";
return'<a href="javascript:void(0);" title="呼入未接" recFile="'+recFile+'" gidTypeKey="'+gidType+'" direction="'+direction+'"  queryType="'+queryType+'" class="openAgentDetail" agentId="'+row.aid+'">'+resultStrVal+"</a>";
}},{modelName:name,name:name+"callInNotOkPercent",align:"center",width:"120",formatter:function(val,opt,row){var callInNotOkPercentKey="row."+opt.colModel.modelName+"callInNotOkPercent";
var callInNotOkPercent=eval(callInNotOkPercentKey);var callInValidCountKey="row."+opt.colModel.modelName+"callInValidCount";var callInValidCount=eval(callInValidCountKey);
var gidType="";var modelName=opt.colModel.modelName;if(!(modelName.indexOf("totalAdnStaticVo")>-1)){var gidTypeKey=modelName.split(".")[1];gidType=gidTypeKey;
}gidType=gidTypeName?gidTypeName:"";var recFile="";var queryType=$("#tabAdn-"+self.tabName+" #type").val();var direction="1";var resultStrVal=callInNotOkPercent;
return resultStrVal+'<a href="javascript:void(0);"  limitValidRecord="y" title="呼入有效通话" recFile="'+recFile+'" gidTypeKey="'+gidType+'" direction="'+direction+'"  queryType="'+queryType+'" class="openAgentDetail" agentId="'+row.aid+'">'+"|<span style='color:blue;'>"+callInValidCount+"</span>"+"</a>";
}},{modelName:name,name:name+"totalTimeLength",align:"center",width:"180",formatter:function(val,opt,row){var totalTimeLengthKey="row."+opt.colModel.modelName+"totalTimeLengthShow";
var totalTimeLength=eval(totalTimeLengthKey);var gidType="";var modelName=opt.colModel.modelName;if(!(modelName.indexOf("totalAdnStaticVo")>-1)){var gidTypeKey=modelName.split(".")[1];
gidType=gidTypeKey;}gidType=gidTypeName?gidTypeName:"";var recFile="1";var queryType=$("#tabAdn-"+self.tabName+" #type").val();var direction="";var totalCallCountKey="row."+opt.colModel.modelName+"totalCallCount";
var totalCallCount=eval(totalCallCountKey);var totalValidCountKey="row."+opt.colModel.modelName+"totalValidCount";var totalValidCount=eval(totalValidCountKey);
var resultStrVal="<span style='color:red;'>"+totalCallCount+"</span>"+"/<span style='color:blue;'>"+totalTimeLength+"</span>";return resultStrVal+'<a href="javascript:void(0);" limitValidRecord="y" title="有效通话总数" recFile="'+recFile+'" gidTypeKey="'+gidType+'" direction="'+direction+'"  queryType="'+queryType+'" class="openAgentDetail" agentId="'+row.aid+'">'+"|<span style='color:blue;'>"+totalValidCount+"</span>"+"</a>";
}},];result=result.concat(colModel);}return result;},_initJqgrid:function(g,b,e,i,j){var k=this;var c=new Date().currentDate()+" 00:00:00";var d=new Date().currentDate()+" 23:59:59";
$("#tabAdn-"+k.tabName+' button[actionVal="day"]').removeClass("btn-primary").addClass("btn-danger");$("#tabAdn-"+k.tabName+' input[name="startTime"]').val(c);
$("#tabAdn-"+k.tabName+' input[name="endTime"]').val(d);var f=$("#tabAdn-"+k.tabName+" [name=type]").val();var l=["工号","总客户数"];var h=[{modelName:"aid",name:"aid",index:"aid",align:"center",width:"120",sortable:true,formatter:function(n,q,u){var m=null;
if($("#tabAdn-"+k.tabName+" #type").val()=="adn"){m=n;}else{if($("#tabAdn-"+k.tabName+" #type").val()=="agentId"){if(u.employeeName){m=n+":"+u.employeeName;
}else{m=n;}}else{if($("#tabAdn-"+k.tabName+" #type").val()=="adnNumber"){m=n;}}}var p=e?e:"";var s="";var o=$("#tabAdn-"+k.tabName+" #type").val();var r="";
var t=m;return'<a href="javascript:void(0);" title="总数" recFile="'+s+'" gidTypeKey="'+p+'" direction="'+r+'"  queryType="'+o+'" class="openAgentDetail" agentId="'+u.aid+'">'+t+"</a>";
}},{modelName:"countCsEntity",name:"countCsEntity",index:"countCsEntity",width:"80",align:"center",formatter:function(m,n,o){return m;}},];l=l.concat(k._createColNames(null,i,j));
h=h.concat(k._createColModels(null,i,j,e));if(ResUtils.canShow("trkSheetRecord.button.showPrice")){l.push("话费");h.push({modelName:"showPrice",name:"showPrice",align:"left",width:190,formatter:function(q,o,p){var m=null;
var n="话费:"+p.totalAdnStaticVo.price.toFixed(2);m=n;return m;}});}var a=e?e:"";$(g).JTJqgrid({url:ctx+"/gl/cti/tRKSheetRecord/listDataForAdn.htm?gidType="+a,rowNum:10000,viewrecords:false,shrinkToFit:true,autoScroll:true,rowList:[],footerrow:true,postData:{startTime:c,endTime:d,type:f,adnDurationShowType:"hour_minute_second"},colNames:l,colModel:h,beforeProcessing:function(r){var m={};
for(var q=0;q<h.length;q++){var o=h[q];var n=o.name;var p={colModel:{name:n,modelName:o.modelName},};m[n]=o.formatter(null,p,r.footData);}k.footerData=m;
},gridComplete:function(){if(k.footerData){var m=$(g).jqGrid("getGridParam","records");k.footerData.aid="总计：<span style='color:red;'>"+m+"</span>个";$(g).footerData("set",k.footerData,false);
}if($("#tabAdn-"+k.tabName+" #type").val()=="adn"){$(g).setLabel("aid","分机");$(g).hideCol("countCsEntity");}else{if($("#tabAdn-"+k.tabName+" #type").val()=="agentId"){$(g).setLabel("aid","工号");
$(g).showCol("countCsEntity");}else{if($("#tabAdn-"+k.tabName+" #type").val()=="adnNumber"){$(g).setLabel("aid","号码");$(g).hideCol("countCsEntity");}}}}});
}};