$(function(){var a=new T9QaEntity();a.init();});function T9QaEntity(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.kmEntity=new T9KmEntity();
this.kmEntity.init();this.hadInitList=false;this.prevRecord=null;this.currentNode=null;this.rows=10;this.page=1;this.sord="asc";this.qaCache=null;this.treeCache=null;
this.isSingle=false;this.model=true;this.res={};this.textFormat=125;this.isEdit=false;this.rootId=null;}function randomString(b){b=b||32;var c="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678";
var a=c.length;var d="";for(i=0;i<b;i++){d+=c.charAt(Math.floor(Math.random()*a));}return d;}T9QaEntity._CONS_={EDIT_URL:ctx+"/gl/qa/qaEntity/edit.htm",DETAIL_URL:ctx+"/gl/qa/qaEntity/detail.htm",DELETE_URL:ctx+"/gl/qa/qaEntity/delete.htm",SAVE_ADD_URL:ctx+"/gl/qa/qaEntity/saveAdd.htm",SAVE_EDIT_URL:ctx+"/gl/qa/qaEntity/saveEdit.htm",LIST_DATA_URL:ctx+"/gl/qa/T9QaEntity/listData.htm",DELETECATE_URL:ctx+"/gl/qa/qaEntity/deleteCate.htm",EXPORT_TEMPLATE_URL:ctx+"/gl/qa/T9QaEntity/exportQaTemplate.htm",EXPORT_URL:ctx+"/gl/qa/T9QaEntity/exportQa.htm",IMPORT_URL:ctx+"/gl/mc/moduleColumn/importExcel.htm",QA_CATE_TREE_URL:ctx+"/gl/cate/cate/loadCateTreeData.htm",INIT_SQL_QA_URL:ctx+"/gl/qa/qaEntity/initSqlQa.htm",EDIT_FORM_ID:"T9QaEntityForm"};
T9QaEntity.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._getManagerBtns();this._bindFormValidation();this._bindEventHander();this._loadqaCateTree();
CateUtils.addOption=function(c){if(c.error==null){c.error=function(){DialogUtils.error("错误","网络连接错误，请稍候重试");};}var b={typeKey:c.typeKey,key:c.key,pKey:c.pKey,name:c.name,iconUrl:c.iconUrl?c.iconUrl:"",userId:c.userId?c.userId:"",supportColor:c.supportColor?c.supportColor:"",};
FormUtils.submit(ctx+"/gl/qa/qaEntity/addOption.htm",b,function(d){if(d.success){c.success(d);}},c.error);};CateUtils.updateOption=function(d){if(d.error==null){d.error=function(){DialogUtils.error("错误","网络连接错误，请稍候重试");
};}var c={typeKey:d.typeKey,key:d.key,name:d.name,id:d.id,parentId:d.parentId,iconUrl:d.iconUrl?d.iconUrl:"",userId:d.userId?d.userId:""};var b=d.error?d.error:function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
};FormUtils.submit(ctx+"/gl/qa/qaEntity/updateOption.htm",c,function(e){if(d.success){d.success(e);}},b);};}},clear:function(b){var a=this;$("#id").val("");
$("#T9QaEntityForm").find("input[name=questionArea]").val("");$("#T9QaEntityForm").find("input[name=question]").val("");$("#T9QaEntityForm").find("input[name=createTime]").val("");
$("#T9QaEntityForm").find("input[name=createBy]").val("");$("#T9QaEntityForm").find("input[name=answer]").val("");$("#T9QaEntityForm").find("input[name=videoUrl]").val("");
$("#T9QaEntityForm").find("input[name=videoName]").val("");$("#T9QaEntityForm").find("input[name=url]").val("");$("#answerArea").val("").css("height","auto");
if(b){if(a.queryParam){a.queryParam=null;}a.reloadQaList();}},fillQaForm:function(b){var a=this;if(!$(".addQaBtn").is(".disabledBtn")){$(".addQaBtn").trigger("click");
}$("#T9QaEntityForm").find("input[name=id]").val(b.id);$("#T9QaEntityForm").find("input[name=qaCateFirstId]").val(b.qaCateFirstId);$("#T9QaEntityForm").find("input[name=cateId]").val(b.cateId);
$("#T9QaEntityForm").find("input[name=question]").val(b.question);$("#T9QaEntityForm").find("input[name=questionArea]").val(b.question);$("#T9QaEntityForm").find("input[name=answer]").val("");
$("#T9QaEntityForm").find("textarea[name=answerArea]").val(b.answer);$("#T9QaEntityForm").find("#qa-cate-select").val(b.cateName);$("#T9QaEntityForm").find("input[name=createBy]").val(b.createBy);
$("#T9QaEntityForm").find("input[name=createTime]").val(b.createTime);$("#T9QaEntityForm").find("input[name=videoUrl]").val(b.videoUrl);$("#T9QaEntityForm").find("input[name=videoName]").val(b.videoName);
$("#T9QaEntityForm").find("input[name=url]").val(b.url);},getQaById:function(b){var a=this;FormUtils.loadData(T9QaEntity._CONS_.EDIT_URL+"?id="+b,function(c){a.fillQaForm(c);
});},vueHidden:function(){var b=this;var a=$("#questionArea").val().replace(/&/gi,"&amp;").replace(/</gi,"&lt;").replace(/>/gi,"&gt;");$("#T9QaEntityForm").find("input[name=question]").val(a);
var c=$("#answerArea").val().replace(/&/gi,"&amp;").replace(/</gi,"&lt;").replace(/>/gi,"&gt;");$("#T9QaEntityForm").find("input[name=answer]").val(c);
},saveQa:function(c){var a=this;var b,d;$("#T9QaEntityForm").find("input[name=belong]").val("t9");if(c){b=T9QaEntity._CONS_.SAVE_EDIT_URL;d=c;FormUtils.submit(b,d,function(e){if(e.success){if(e.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);
}else{if(e.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);}}}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}else{if($("#T9QaEntityForm").valid()){a.vueHidden();b=T9QaEntity._CONS_.SAVE_ADD_URL;if($("#id").val()){b=T9QaEntity._CONS_.SAVE_EDIT_URL;}d=$("#"+T9QaEntity._CONS_.EDIT_FORM_ID).serialize();
d.belong="t9";}FormUtils.submit(b,d,function(e){if(e.success){if(e.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);}else{if(e.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
}}a.clear(true);}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}},_delete:function(b){var a=this;
DialogUtils.confirm(function(){FormUtils.del(T9QaEntity._CONS_.DELETE_URL,b,function(e){if(e.success){DialogUtils.success(msgCode.INFO,msgCode.DELETE_MSG);
a.deleteLi(b);if(!a.modal){var d=$(".qa-unanswer-num").attr("data-no");if(d){var c=--d;if(d>99){temRecords=99;}$(".qa-unanswer-num").empty().text(c).css("opacity",1).attr("data-no",d);
}}}else{DialogUtils.error(msgCode.ERROR,e.msg);}});});},deleteLi:function(b){var a=this;var c=b.split(",");$.each(c,function(d,f){$("#qaList").find("li[data-id="+this+"]").remove();
});},_loadqaCateTree:function(){var a=this;var b={treeId:"T9qaEntityCateTree",cateTypeKey:"system",rootKey:"t9QaEntity",url:T9QaEntity._CONS_.QA_CATE_TREE_URL,contextMenu:{add:{isShow:true,title:"添加分类",clickFn:function(c){},clazz:"addCate"},update:{isShow:true,title:"修改分类",clickFn:function(c){},clazz:"updateCate"},del:{isShow:true,title:"删除分类",clickFn:function(c){msgCode.DELETE_TITLE="您确定要删除这个节点吗";
DialogUtils.confirm(function(){FormUtils.submit(T9QaEntity._CONS_.DELETECATE_URL,"cateId="+c.id,function(e){if(e.success){var d=$.fn.zTree.getZTreeObj("T9qaEntityCateTree");
d.removeNode(c);DialogUtils.success(msgCode.SUCCESS,e.msg);}else{DialogUtils.error(msgCode.ERROR,e.msg);}});});},clazz:"removeCate"}},onClick:function(c){a.cateId=c.id;
a.currentNode=c;if(!a.hadInitList){a.hadInitList=true;a.qaList();a.rootId=c.id;}else{if(a.queryParam){a.queryParam=null;}a.reloadQaList();}$('input[name="qaCateFirstId"]').val(a.getCateFirstId(c));
$("#cateId").val(c.id);$("#qa-cate-select").val(c.name);}};ZtreeUtils.init(b);},loadFormTree:function(){var a=this;var b={isMultiple:0,typeKey:"system",pKey:"t9QaEntity",treeId:"qa-tree-id",url:T9QaEntity._CONS_.QA_CATE_TREE_URL,container:"qa-cate-select",fn:function(f,d,g){if(f){$('input[name="cateId"]').val(f);
var e=a.getById(f);$('input[name="qaCateFirstId"]').val(a.getCateFirstId(e));}else{}},dataFilter:function c(f,d,e){return e;if(e){}}};CateUtils.selectCateTreeBox(b);
},getById:function(d){var a=this;var b=$.fn.zTree.getZTreeObj("T9qaEntityCateTree");var c=b.getNodeByParam("id",d);return c;},selectById:function(d){var a=this;
var b=$.fn.zTree.getZTreeObj("T9qaEntityCateTree");var c=a.getById(d);b.cancelSelectedNode();b.selectNode(c,true);b.expandNode(c,true,false);b.setting.callback.onClick(null,b.setting.treeId,c);
},searchNode:function(d){var a=$.fn.zTree.getZTreeObj("T9qaEntityCateTree");a.setting.view.fontCss=function(f,e){return(!!e.highlight)?{color:"#A60000","font-weight":"bold"}:{color:"#333","font-weight":"normal"};
};var c=$.trim($("#T9qaEntityCateTreeSearch").val());var b="name";if(this.lastValue&&this.lastValue===c){return;}this.lastValue=c;this.updateNodes(false,this.nodeList);
if(c!=""){this.nodeList=a.getNodesByParamFuzzy(b,c);this.updateNodes(true,this.nodeList);}else{this.nodeList=[];}},updateNodes:function(b,d){var c=$.fn.zTree.getZTreeObj("T9qaEntityCateTree");
if(d){for(var e=0,a=d.length;e<a;e++){d[e].highlight=b;if(b){c.expandNode(d[e].getParentNode(),true,false,false);}c.updateNode(d[e]);}}},isSelectAll:function(a){var b=this;
if(a=="all"){$(".checkAllBtn").addClass("disabledBtn");return true;}else{if(a=="notAll"){if($(".checkAllBtn").is(".disabledBtn")){$(".checkAllBtn").removeClass("disabledBtn");
}return false;}}if($("#qaList").find("li.qa-list-select").length==$("#qaList").find("li:not(.load-more,.no-data-li)").length){$(".checkAllBtn").addClass("disabledBtn");
}else{if($(".checkAllBtn").is(".disabledBtn")){$(".checkAllBtn").removeClass("disabledBtn");}}},isSelects:function(){var a=this;if($("#qaList").find("li.qa-list-select").length<2&&$(".qa-da-layer").is(":visible")){$(".qa-da-layer").stop().slideUp("fast");
}},extendText:function(c){var a=this;if(c.find(".qa-li-expand").length>0){var b=c.find(".qa-li-expand").parent().attr("data-alltext");c.find(".qa-li-expand").parent().empty().append(b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br/>")+"&emsp;<span class='qa-li-pickup'>[收起 <i class='fa fa-long-arrow-up'></i> ]</span>");
}},pickupText:function(c){var a=this;if(c.find(".qa-li-pickup").length>0){var b=c.find(".qa-li-pickup").parent().attr("data-alltext");c.find(".qa-li-pickup").parent().empty().append(a.textFormatter(b));
}},_bindEventHander:function(){var a=this;$("#qa-cate-select").on("click",function(){a.loadFormTree();});$("#T9qaEntityCateTreeSearch").on("keyup",function(b){if(b.keyCode==13){a.searchNode(b);
}});$(document).on("click",".checkAllBtn",function(b){if($(this).is(".disabledBtn")){return false;}$("#qaList").find("li").each(function(c,d){if(!$(this).is(".qa-list-select,.load-more,.no-data-li")){$(this).addClass("qa-list-select");
}});a.isSelectAll("all");});$(document).on("click",".checkReverseBtn",function(c){var b=true;$("#qaList").find("li").each(function(d,f){if(!$(this).is(".load-more,.no-data-li")){if($(this).is(".qa-list-select")){$(this).removeClass("qa-list-select");
if(b){b=false;}}else{$(this).addClass("qa-list-select");}}});if(b){a.isSelectAll("all");}else{a.isSelectAll("notAll");}});$(document).on("click",".refrshBtn",function(b){a.reloadQaList();
a.isSelectAll("notAll");});$(document).on("click",".note-list li",function(b){if($(b.target).is(".load-more,.no-data-li,.qa-li-expand,.qa-li-pickup,.single-libtn-layer,.single-libtn-layer *,.qa-noanswer-layer,.qa-noanswer-textarea")){}else{if(a.isSingle){if($(this).is(".qa-list-select")){$(this).removeClass("qa-list-select");
}else{$(".note-list").find(".qa-list-select").removeClass("qa-list-select");$(this).addClass("qa-list-select");}}else{if($(this).is(".qa-list-select")){$(this).removeClass("qa-list-select");
if($(".checkAllBtn").is("[disabled]")){$(".checkAllBtn").removeAttr("disabled");}}else{$(this).addClass("qa-list-select");}a.isSelectAll();}}});$(document).on("click",".saveQa",function(b){a.saveQa();
});$(document).on("click",".resetQa",function(b){a.clear();});$(document).on("click",".qa-delete-btn",function(b){a._delete($(this).closest("li").attr("data-id"));
});$(document).off("click",".deleteAll").on("click",".deleteAll",function(d){var c=[],b=$(".qa-list-select");if(b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_DELETE);
return false;}$.each(b,function(f,g){c.push($(this).attr("data-id"));});a._delete(c.join(","));});$(document).on("click",".qa-edit-btn",function(c){var b=$(this).closest("li").attr("data-id");
if("content"==$(this).closest("li").attr("type")){a.kmEntity._edit(b);return;}else{a.getQaById(b);}});$(document).on("click",".qa-detail-btn,.qa-li-expand",function(c){var b=$(this).closest("li").attr("data-id");
if("content"==$(this).closest("li").attr("type")){a.kmEntity._detail(b);return;}a.extendText($(this).closest("li"));});$(document).on("click",".qa-li-pickup",function(b){a.pickupText($(this).closest("li"));
});$(document).on("click",".load-more",function(b){event.stopPropagation();if(a.total&&a.total>a.page){a.loadMoreList();}});$(document).on("click",".qa-search",function(c){var b=$("#questionArea").val();
if(b){a.reloadQaList(b,true);}else{a.clear(true);}});$("#questionArea").on("keyup",function(b){if(b.keyCode==13){if(!$("addQaBtn").is(".disabledBtn")){$(".qa-search").trigger("click");
}}});$(document).on("click",".addQaBtn",function(b){if($(this).is(".disabledBtn")){return false;}$(".qa-model-btn").stop().hide("fast");$(".qa-add-model").stop().show("fast");
$(".to-chg-qa").stop().slideDown("fast");$(".qa-list-layer").stop().animate({"height":"-=150px","top":"+=150px"},"fast","swing");$(".qa-form-layer").stop().animate({"height":"+=150px"},"fast");
$(".qa-form-extrabtn").stop().show("fast");$(".qa-form-slide").stop().slideDown("fast");$(".addQaBtn").addClass("disabledBtn");$(".T9kmEntityAdd").addClass("disabledBtn");
});$(document).on("click",".qa-form-slide",function(b){$(".qa-add-model").stop().hide("fast");$(".qa-model-btn").stop().show("fast");$(".to-chg-qa").stop().slideUp("fast");
$(".qa-form-layer").stop().animate({"height":"-=150px"},"fast");$(".qa-list-layer").stop().animate({"height":"+=150px","top":"-=150px"},"fast","swing");
$(".qa-form-extrabtn").stop().hide("fast");$(".qa-form-slide").stop().slideUp("fast");$(".addQaBtn").removeClass("disabledBtn");$(".T9kmEntityAdd").removeClass("disabledBtn");
a.clear();});a.resizeUl();$(window).on("resize",function(){a.resizeUl();});$(document).on("keydown",function(b){if(b.ctrlKey&&b.keyCode==13){if(a.modal){a.saveQa();
}}});$(document).on("click",".qa-init-sqlAdd",function(b){FormUtils.submit(T9QaEntity._CONS_.INIT_SQL_QA_URL,null,function(c){if(c.success){DialogUtils.success("成功",c.msg);
}else{DialogUtils.error("失败",c.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});});$(document).on("click",".qa-import",function(){var b={"importUrl":ctx+"/gl/qa/T9QaEntity/importExcel.htm","tabTitle":"导入问答excel数据"};
JTTabUtils.addOrRefreshTab(T9QaEntity._CONS_.IMPORT_URL+"?importUrl="+b.importUrl,b.tabTitle);});$(document).on("click",".qa-export-template",function(){window.location.href=T9QaEntity._CONS_.EXPORT_TEMPLATE_URL;
});$(document).on("change","#answerTypeSelect",function(){var b=$("#answerTypeSelect").val();$("#T9QaEntityForm").find("input[name=answerType]").val(b);
});$(document).on("click",".qa-export",function(){FormUtils.submit(T9QaEntity._CONS_.EXPORT_URL,null,function(b){if(b.success){DialogUtils.success("成功",b.msg);
}else{DialogUtils.error("失败",b.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});});},resizeUl:function(){$(".qa-list-layer").height($(".qa-content-layer").height()-$(".qa-form-layer").outerHeight()-5);
},getCateFirstId:function(a){var c=null;function b(e){if(e.getParentNode()!=null){var d=e.getParentNode();c=e.id;return b(d);}else{return c;}}c=b(a);if(!c){c=a.id;
}return c;},_bindFormValidation:function(){var a=this;var b={rules:{qaCateFirstId:{required:true},cateId:{required:true},questionArea:{},answerArea:{required:a.model}},messages:{}};
if(a.model){b.rules.answerArea.maxlength=1024;}FormUtils.bindFormValidation(T9QaEntity._CONS_.EDIT_FORM_ID,b);},_getManagerBtns:function(){var a=this;$("body").addClass("res-detail");
$("body").addClass("res-delete");$("body").addClass("res-edit");},qaList:function(b){var a=this;if(!b){b={};b.Q__S__EQ__cate_id_=a.cateId;b.rows=a.rows;
b.page=a.page;b.sord=a.sord;}FormUtils.submit(T9QaEntity._CONS_.LIST_DATA_URL,b,function(c){a.total=c.total;a.page=c.page;$("#qaList").append(a.qaListStr(c.rows));
a.isSelectAll();a.isSelects();});},reloadQaList:function(c,a){var b=this;if(!c){c=$("#questionArea").val();}var d={rows:b.rows,page:1,sord:b.sord};d.Q__S__EQ__cate_id_=this.cateId;
$("#qaList").empty();d.likeContent=c;this.qaList(d);},loadMoreList:function(b){var a=this;var c={rows:a.rows,page:a.page+1,sord:a.sord};if(a.queryParam){$.extend(true,c,a.queryParam,{"Q__S__EQ__cate_id_":a.rootId});
}else{c.Q__S__EQ__cate_id_=this.cateId;}FormUtils.submit(T9QaEntity._CONS_.LIST_DATA_URL,c,function(d){a.total=d.total;a.page=d.page;$("#qaList").find(".load-more").before(a.qaListStr(d.rows));
if(a.total==a.page){$(".load-more").remove();}else{$(".load-more").find("font").html("当前第&nbsp;"+a.page+"&nbsp;页 共&nbsp;"+a.total+"&nbsp;页");}a.isSelectAll();
a.isSelects();});},textFormatter:function(d){var b=this;var a=d.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");if(a.length>b.textFormat){var c=(a.substring(0,b.textFormat)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br/>")+"...<span class='qa-li-expand'>[展开全文]</span>";
}else{c=d;}return c;},qaAnswerHtml:function(b,c){var a=this;var d=new StringBuffer();if(c){d.append("<p style='width:auto;overflow:hidden;width:80%;' data-alltext='"+c+"'>").append((a.textFormatter(c)).replace(/\n|\r\n/g,"<br/>")).append("</p>");
}else{d.append("<p class='qa-noanswer-layer'></p>");}return d.toString();},qaListStr:function(d){var b=this,a="",e=new StringBuffer();if(d&&d.length){for(var c=0;
c<d.length;c++){e.append("<li  data-cate-id='"+d[c].cateId+"' data-catefirst-id='"+d[c].qaCateFirstId+"' data-id='"+d[c].id+"' data-create-by='"+d[c].createBy+"' data-create-time='"+d[c].createTime+"' type='"+d[c].type+"'>");
if("content"==d[c].type){e.append("<div class='divContentTag top-left-common'>知识</div>");}else{e.append("<div class='divQaTag top-left-common'>问答</div>");
}e.append("<div class='title'><a class='qaId'>"+d[c].question+"</a>").append("<div class='content'>"+b.qaAnswerHtml(d[c].answerType,d[c].answer)+"</div>").append("<div class='meta'>").append("<a class='cateFirst-type'>"+d[c].cateFirstName+"</a>");
if(d[c].cateName&&(d[c].qaCateFirstId!=d[c].cateId)){e.append("<a class='cate-type'>"+d[c].cateName+"</a>");}e.append("<a class='createBy'>创建者："+d[c].createName+"</a>");
if(d[c].updateBy){e.append("&emsp;<a class='createBy'>最后一次编辑："+d[c].updateBy+"</a>");}e.append("</div></div>").append("<div class='single-libtn-layer'>");
if("content"==d[c].type){e.append("<span class='qa-detail-btn'><i class='fa fa-search-plus'></i>&nbsp;明细</span>&emsp;");}e.append("<span class='qa-edit-btn'><i class='fa fa-pencil'></i>&nbsp;编辑</span>&emsp;");
e.append("<span class='qa-delete-btn'><i class='fa fa-trash-o'></i>&nbsp;删除</span>");e.append("</div>").append("</li>");}}else{e.append("<li class='no-data-li'>").append("<h2>该分类下没有找到符合的数据...</h2>").append("</li>");
}if($(".load-more").length==0&&b&&b.total>b.page){e.append("<li class='load-more'>点击加载更多<br/><font color='#d0d0d0'>当前第&nbsp;").append(b.page).append("&nbsp;页&emsp;共&nbsp;").append(b.total).append("&nbsp;页</font></li>");
}return e.toString();}};