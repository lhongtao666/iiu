$(function(){var a=new QaEntity();a.init();});function QaEntity(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.kmEntity=new KmEntity();
this.hadInitList=false;this.prevRecord=null;this.currentNode=null;this.rows=10;this.page=1;this.sord="asc";this.qaCache=null;this.treeCache=null;this.isSingle=false;
this.model=true;this.res={};this.treeres={};this.textFormat=125;this.isEdit=false;this.rootId=null;this.modal=true;}function randomString(b){b=b||32;var c="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678";
var a=c.length;var d="";for(i=0;i<b;i++){d+=c.charAt(Math.floor(Math.random()*a));}return d;}QaEntity._CONS_={EDIT_URL:ctx+"/gl/qa/qaEntity/edit.htm",DETAIL_URL:ctx+"/gl/qa/qaEntity/detail.htm",DELETE_URL:ctx+"/gl/qa/qaEntity/delete.htm",SAVE_ADD_URL:ctx+"/gl/qa/qaEntity/saveAdd.htm",SAVE_EDIT_URL:ctx+"/gl/qa/qaEntity/saveEdit.htm",LIST_DATA_URL:ctx+"/gl/qa/qaEntity/listData.htm",DELETECATE_URL:ctx+"/gl/qa/qaEntity/deleteCate.htm",QA_CATE_TREE_URL:ctx+"/gl/cate/cate/loadCateTreeData.htm",LIST_NOANSWER_URL:ctx+"/gl/qa/qaEntity/noAnwserQa.htm",EDIT_FORM_ID:"qaEntityForm",GRID:"#qaEntityGrid",PAGER:"#qaEntityPager"};
QaEntity.prototype={init:function(c){if(!this.hadInit){this.hadInit=true;this._getManagerBtns();this._bindFormValidation();this.kmEntity.init();var a=document.querySelector(".js-switch");
var b=new Switchery(a,{className:"switchery switchery-small"});this._bindEventHander();this._loadqaCateTree();this._locateToGlHelp();this._initGroupSelect();
this.loadNoAnswer();CateUtils.addOption=function(e){if(e.error==null){e.error=function(){DialogUtils.error("错误","网络连接错误，请稍候重试");};}var d={typeKey:e.typeKey,key:e.key,pKey:e.pKey,name:e.name,iconUrl:e.iconUrl?e.iconUrl:"",userId:e.userId?e.userId:"",supportColor:e.supportColor?e.supportColor:"",};
FormUtils.submit(ctx+"/gl/qa/qaEntity/addOption.htm",d,function(f){if(f.success){e.success(f);}},e.error);};CateUtils.updateOption=function(f){if(f.error==null){f.error=function(){DialogUtils.error("错误","网络连接错误，请稍候重试");
};}var e={typeKey:f.typeKey,key:f.key,name:f.name,id:f.id,parentId:f.parentId,iconUrl:f.iconUrl?f.iconUrl:"",userId:f.userId?f.userId:""};var d=f.error?f.error:function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
};FormUtils.submit(ctx+"/gl/qa/qaEntity/updateOption.htm",e,function(g){if(f.success){f.success(g);}},d);};}},_locateToGlHelp:function(){glHelpUtil.init("glHelp.operations.qaEntity");
},clear:function(b){var a=this;$("#id").val("");$("#questionArea").val("");$("#question").val("");$("#answerArea").val("").css("height","auto");$("#answer").val("");
$("#createBy").val("");$("#createTime").val("");if(b){if(a.queryParam){a.queryParam=null;}if(a.modal){a.reloadQaList();}else{a.noQaList();}}},_loadData:function(id){var self=this;
FormUtils.loadData(QaEntity._CONS_.EDIT_URL+"?id="+id,function(data){self.prevRecord=data;$("input[name=id]").val(data.id);$("input[name=qaCateFirstId]").val(data.qaCateFirstId);
$("input[name=cateId]").val(data.cateId);$("input[name=question]").val(data.question);$("input[name=answer]").val(data.answer);$("input[name=answerType]").val(data.answerType);
$("input[name=createBy]").val(data.createBy);$("input[name=createTime]").val(data.createTime);$("#answerType_").val(data.answerType);if(data.answerType=="string"){$("textarea[name=answerArea]").val(data.answer);
}else{if(data.answerType=="img"){$(".at-string,.at-img,.at-file").addClass("qaHide");$("#qaImgDiv").append(ImageUtils.createImageDivStr(eval("("+data.answer+")"),null,true)).parent().removeClass("qaHide").find(".button-box").clone(true).removeClass("qaHide").appendTo("#qaImgDiv");
$(".at-img").removeClass("qaHide");if(self.isDetail){$("#qaImgDiv").find(".button-box").remove().end().find(".deleteImage").remove();}}else{if(data.answerType=="voice"||data.answerType=="video"){$(".at-string,.at-img,.at-file").addClass("qaHide");
$("#qaFileDiv").append(FileUtils.createFileDivStr(eval("("+data.answer+")"))).parent().removeClass("qaHide").find(".button-box").clone(true).removeClass("qaHide").appendTo("#qaFileDiv");
$(".at-file").removeClass("qaHide");if(self.isDetail){$("#qaFileDiv").find(".button-box").remove().end().find(".deleteFile").remove();}}}}});},fillQaForm:function(b){var a=this;
if(!$(".addQaBtn").is(".disabledBtn")){$(".addQaBtn").trigger("click");}$("#qaEntityForm").find("input[name=groupIds]").val(b.groupIds);$("#qaEntityForm").find(".groupNames").val(b.groupNames);
$("input[name=id]").val(b.id);$("input[name=qaCateFirstId]").val(b.qaCateFirstId);$("input[name=cateId]").val(b.cateId);$("input[name=question]").val(b.question);
$("input[name=questionArea]").val(b.question);$("input[name=answer]").val("");$("textarea[name=answerArea]").val(b.answer);$("#qa-cate-select").val(b.cateName);
$("input[name=createBy]").val(b.createBy);$("input[name=createTime]").val(b.createTime);a._initGroupSelect();},getQaById:function(b){var a=this;FormUtils.loadData(QaEntity._CONS_.EDIT_URL+"?id="+b,function(c){a.fillQaForm(c);
});},vueHidden:function(){var b=this;var a=$("#questionArea").val().replace(/&/gi,"&amp;").replace(/</gi,"&lt;").replace(/>/gi,"&gt;");$("#qaEntityForm").find("input[name=question]").val(a);
var c=$("#answerArea").val().replace(/&/gi,"&amp;").replace(/</gi,"&lt;").replace(/>/gi,"&gt;");$("#qaEntityForm").find("input[name=answer]").val(c);},saveQa:function(c){var a=this;
var b,d;if(c){b=QaEntity._CONS_.SAVE_EDIT_URL;d=c;FormUtils.submit(b,d,function(e){if(e.success){if(e.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);
}else{if(e.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);}}}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}else{if(a.modal){if($("#qaEntityForm").valid()){a.vueHidden();b=QaEntity._CONS_.SAVE_ADD_URL;if($("#id").val()){b=QaEntity._CONS_.SAVE_EDIT_URL;}d=$("#"+QaEntity._CONS_.EDIT_FORM_ID).serialize();
}}else{a.vueHidden();b=QaEntity._CONS_.SAVE_ADD_URL;d=$("#"+QaEntity._CONS_.EDIT_FORM_ID).serialize();}FormUtils.submit(b,d,function(e){if(e.success){if(e.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);
}else{if(e.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);}}a.clear(true);}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}},_delete:function(b){var a=this;DialogUtils.confirm(function(){FormUtils.del(QaEntity._CONS_.DELETE_URL,b,function(e){if(e.success){DialogUtils.success(msgCode.INFO,msgCode.DELETE_MSG);
a.deleteLi(b);if(!a.modal){var d=$(".qa-unanswer-num").attr("data-no");if(d){var c=--d;if(d>99){temRecords=99;}$(".qa-unanswer-num").empty().text(c).css("opacity",1).attr("data-no",d);
}}}else{DialogUtils.error(msgCode.ERROR,e.msg);}});});},deleteLi:function(b){var a=this;var c=b.split(",");$.each(c,function(d,f){$("#qaList").find("li[data-id="+this+"]").remove();
});},_loadqaCateTree:function(){var a=this;var b={treeId:"qaEntityCateTree",cateTypeKey:"system",rootKey:"qa",url:QaEntity._CONS_.QA_CATE_TREE_URL,contextMenu:{add:{isShow:a.treeres.add,title:"添加分类",clickFn:function(c){},clazz:"addCate"},update:{isShow:a.treeres.edit,title:"修改分类",clickFn:function(c){},clazz:"updateCate"},del:{isShow:a.treeres.del,title:"删除分类",clickFn:function(c){msgCode.DELETE_TITLE="您确定要删除这个节点吗";
DialogUtils.confirm(function(){FormUtils.submit(QaEntity._CONS_.DELETECATE_URL,"cateId="+c.id,function(e){if(e.success){var d=$.fn.zTree.getZTreeObj("qaEntityCateTree");
d.removeNode(c);DialogUtils.success(msgCode.SUCCESS,e.msg);}else{DialogUtils.error(msgCode.ERROR,e.msg);}});});},clazz:"removeCate"}},onClick:function(c){a.cateId=c.id;
a.currentNode=c;if(!a.hadInitList){a.hadInitList=true;if(a.modal){a.qaList();}else{a.noQaList();}a.rootId=c.id;}else{if(a.queryParam){a.queryParam=null;
}if(a.modal){a.reloadQaList();}else{a.noQaList(c.id);}}$('input[name="qaCateFirstId"]').val(a.getCateFirstId(c));$("#cateId").val(c.id);$("#qa-cate-select").val(c.name);
}};ZtreeUtils.init(b);},loadFormTree:function(){var a=this;var b={isMultiple:0,typeKey:"system",pKey:"qa",treeId:"qa-tree-id",url:QaEntity._CONS_.QA_CATE_TREE_URL,container:"qa-cate-select",fn:function(f,d,g){if(f){$('input[name="cateId"]').val(f);
var e=a.getById(f);$('input[name="qaCateFirstId"]').val(a.getCateFirstId(e));}else{}},dataFilter:function c(f,d,e){return e;if(e){}}};CateUtils.selectCateTreeBox(b);
},getById:function(d){var a=this;var b=$.fn.zTree.getZTreeObj("qaEntityCateTree");var c=b.getNodeByParam("id",d);return c;},selectById:function(d){var a=this;
var b=$.fn.zTree.getZTreeObj("qaEntityCateTree");var c=a.getById(d);b.cancelSelectedNode();b.selectNode(c,true);b.expandNode(c,true,false);b.setting.callback.onClick(null,b.setting.treeId,c);
},searchNode:function(d){var a=$.fn.zTree.getZTreeObj("qaEntityCateTree");a.setting.view.fontCss=function(f,e){return(!!e.highlight)?{color:"#A60000","font-weight":"bold"}:{color:"#333","font-weight":"normal"};
};var c=$.trim($("#qaEntityCateTreeSearch").val());var b="name";if(this.lastValue&&this.lastValue===c){return;}this.lastValue=c;this.updateNodes(false,this.nodeList);
if(c!=""){this.nodeList=a.getNodesByParamFuzzy(b,c);this.updateNodes(true,this.nodeList);}else{this.nodeList=[];}},updateNodes:function(b,d){var c=$.fn.zTree.getZTreeObj("qaEntityCateTree");
if(d){for(var e=0,a=d.length;e<a;e++){d[e].highlight=b;if(b){c.expandNode(d[e].getParentNode(),true,false,false);}c.updateNode(d[e]);}}},isSelectAll:function(a){var b=this;
if(a=="all"){$(".checkAllBtn").addClass("disabledBtn");return true;}else{if(a=="notAll"){if($(".checkAllBtn").is(".disabledBtn")){$(".checkAllBtn").removeClass("disabledBtn");
}return false;}}if($("#qaList").find("li.qa-list-select").length==$("#qaList").find("li:not(.load-more,.no-data-li)").length){$(".checkAllBtn").addClass("disabledBtn");
}else{if($(".checkAllBtn").is(".disabledBtn")){$(".checkAllBtn").removeClass("disabledBtn");}}},isSelects:function(){var a=this;if($("#qaList").find("li.qa-list-select").length<2&&$(".qa-da-layer").is(":visible")){$(".qa-da-layer").stop().slideUp("fast");
}},extendText:function(c){var a=this;if(c.find(".qa-li-expand").length>0){var b=c.find(".qa-li-expand").parent().attr("data-alltext");c.find(".qa-li-expand").parent().empty().append(b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"&emsp;<span class='qa-li-pickup'>[收起 <i class='fa fa-long-arrow-up'></i> ]</span>");
}},pickupText:function(c){var a=this;if(c.find(".qa-li-pickup").length>0){var b=c.find(".qa-li-pickup").parent().attr("data-alltext");c.find(".qa-li-pickup").parent().empty().append(a.textFormatter(b));
}},loadNoAnswer:function(b){var a=this;if(!b){b={};b.Q__S__EQ__cate_id_=this.cateId;b.rows=this.rows;b.page=this.page;b.sord=this.sord;}b.qoa=true;b.type="qa";
FormUtils.submit(QaEntity._CONS_.LIST_NOANSWER_URL,b,function(d){if(d.records&&d.records>0){var c=d.records;if(c>99){c=99;}$(".qa-unanswer-num").empty().text(c).css("opacity",1).attr("data-no",d.records);
}});},noQaList:function(c){var a=this;var b={};b.rows=this.rows;b.page=1;b.sord=this.sord;b.qoa=true;if(b){b.Q__S__EQ__cate_id_=c;}b.type="qa";FormUtils.submit(QaEntity._CONS_.LIST_NOANSWER_URL,b,function(e){a.total=e.total;
a.page=e.page;$("#qaList").empty().append(a.qaListStr(e.rows));a.isSelectAll();a.isSelects();if(!c){if(e.records&&e.records>0){var d=e.records;if(d>99){d=99;
}$(".qa-unanswer-num").empty().text(d).css("opacity",1).attr("data-no",e.records);}}});},chgModel:function(b){var a=this;if(b){$("body").removeClass("qa-answer-model");
$(".qa-add-model").stop().hide();$(".qa-form-extrabtn").hide().children().show().last().hide();$(".qa-model-btn").show();$(".addQaBtn").show();$(".kmEntityAdd").show();
$(".checkAllBtn").show();$(".checkReverseBtn").show();$(".qa-status-title").removeClass("qa-status-active");$(".qa-normal-status").addClass("qa-status-active");
}else{if($(".addQaBtn").is(".disabledBtn")){$(".qa-form-slide").trigger("click");}setTimeout(function(){$(".qa-model-btn").stop().hide();$(".qa-add-model").show();
$(".qa-form-extrabtn").children().hide().last().show();$(".qa-form-extrabtn").stop().show();},250);$(".addQaBtn").hide();$(".kmEntityAdd").hide();$(".checkAllBtn").hide();
$(".checkReverseBtn").hide();$("body").addClass("qa-answer-model");$(".qa-normal-status").removeClass("qa-status-active");$(".qa-status-title").addClass("qa-status-active");
}a.clear();a.modal=b;if(a.tabLock){a.tabLock=false;}},_bindEventHander:function(){var a=this;$("#qa-cate-select").on("click",function(){a.loadFormTree();
});$("#qaEntityCateTreeSearch").on("keyup",function(b){if(b.keyCode==13){a.searchNode(b);}});$(document).on("click",".checkAllBtn",function(b){if($(this).is(".disabledBtn")){return false;
}$("#qaList").find("li").each(function(c,d){if(!$(this).is(".qa-list-select,.load-more,.no-data-li")){$(this).addClass("qa-list-select");}});a.isSelectAll("all");
});$(document).on("click",".checkReverseBtn",function(c){var b=true;$("#qaList").find("li").each(function(d,f){if(!$(this).is(".load-more,.no-data-li")){if($(this).is(".qa-list-select")){$(this).removeClass("qa-list-select");
if(b){b=false;}}else{$(this).addClass("qa-list-select");}}});if(b){a.isSelectAll("all");}else{a.isSelectAll("notAll");}});$(document).on("click",".refrshBtn",function(b){if(a.modal){a.reloadQaList();
}else{a.noQaList();}a.isSelectAll("notAll");});$(document).on("click",".note-list li",function(b){if($(b.target).is(".load-more,.no-data-li,.qa-li-expand,.qa-li-pickup,.single-libtn-layer,.single-libtn-layer *,.qa-noanswer-layer,.qa-noanswer-textarea")){}else{if(a.isSingle){if($(this).is(".qa-list-select")){$(this).removeClass("qa-list-select");
}else{$(".note-list").find(".qa-list-select").removeClass("qa-list-select");$(this).addClass("qa-list-select");}}else{if($(this).is(".qa-list-select")){$(this).removeClass("qa-list-select");
if($(".checkAllBtn").is("[disabled]")){$(".checkAllBtn").removeAttr("disabled");}}else{$(this).addClass("qa-list-select");}a.isSelectAll();}}});$(document).on("click",".qa-status-title",function(b){if(a.tabLock){return false;
}a.tabLock=true;a.chgModel(false);a.noQaList();});$(document).on("click",".qa-normal-status",function(b){if(a.tabLock){return false;}a.tabLock=true;a.chgModel(true);
a.reloadQaList();});$(document).on("click",".saveQa",function(b){a.saveQa();});$(document).on("click",".resetQa",function(b){a.clear();});$(document).on("click",".qa-delete-btn",function(b){if(!a.res.del){return false;
}a._delete($(this).closest("li").attr("data-id"));});$(document).off("click",".deleteAll").on("click",".deleteAll",function(d){if(!a.res.del){return false;
}var c=[],b=$(".qa-list-select");if(b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_DELETE);return false;}$.each(b,function(f,g){c.push($(this).attr("data-id"));
});a._delete(c.join(","));});$(document).on("click",".qa-edit-btn",function(c){var b=$(this).closest("li").attr("data-id");if("content"==$(this).closest("li").attr("type")){a.kmEntity._edit(b);
return;}if(a.modal){a.getQaById(b);}else{$(this).closest("li").find(".qa-noanswer-layer").trigger("dblclick");}});$(document).on("click",".qa-detail-btn,.qa-li-expand",function(c){var b=$(this).closest("li").attr("data-id");
if("content"==$(this).closest("li").attr("type")){a.kmEntity._detail(b);return;}a.extendText($(this).closest("li"));});$(document).on("click",".qa-li-pickup",function(b){a.pickupText($(this).closest("li"));
});$(document).on("click",".load-more",function(b){event.stopPropagation();if(a.modal){if(a.total&&a.total>a.page){a.loadMoreList();}}else{if(a.total&&a.total>a.page){a.loadMoreNoQaList();
}}});$(document).on("click",".qa-search",function(c){var b=$("#questionArea").val();if(b){a.reloadQaList(b,true);}else{a.clear(true);}});$("#questionArea").on("keyup",function(b){if(b.keyCode==13){if(!$("addQaBtn").is(".disabledBtn")){$(".qa-search").trigger("click");
}}});$(document).on("click",".addQaBtn",function(b){if($(this).is(".disabledBtn")){return false;}$(".qa-model-btn").stop().hide("fast");$(".qa-add-model").stop().show("fast");
$(".to-chg-qa").stop().slideDown("fast");$(".qa-list-layer").stop().animate({"height":"-=90px","top":"+=90px"},"fast","swing");$(".qa-form-layer").stop().animate({"height":"+=90px"},"fast");
$(".qa-form-extrabtn").stop().show("fast");$(".qa-form-slide").stop().slideDown("fast");$(".addQaBtn").addClass("disabledBtn");$(".kmEntityAdd").addClass("disabledBtn");
});$(document).on("click",".qa-form-slide",function(b){$(".qa-add-model").stop().hide("fast");$(".qa-model-btn").stop().show("fast");$(".to-chg-qa").stop().slideUp("fast");
$(".qa-form-layer").stop().animate({"height":"-=90px"},"fast");$(".qa-list-layer").stop().animate({"height":"+=90px","top":"-=90px"},"fast","swing");$(".qa-form-extrabtn").stop().hide("fast");
$(".qa-form-slide").stop().slideUp("fast");$(".addQaBtn").removeClass("disabledBtn");$(".kmEntityAdd").removeClass("disabledBtn");a.clear();});$(document).on("dblclick",".qa-noanswer-layer",function(b){if(a.modal){return false;
}if(!a.res.edit){return false;}if($(this).parent().find(".qa-noanswer-textarea").length==0){$(this).after("<textarea class='qa-noanswer-textarea'></textarea>");
}$(this).hide();$(this).closest("li").addClass("qa-list-select");var c=$(this).next();if($(this).text()){c.val($(this).html().replace(/<br>/ig,"\n"));}if(c.is(":hidden")){c.height($(this).height()).show().focus();
}else{c.focus();}});$(document).on("blur",".qa-noanswer-textarea",function(b){if(a.modal){return false;}if(!a.res.edit){return false;}if($.trim($(this).val())){$(this).hide().prev().empty().append($(this).val().replace(/\n|\r\n/g,"<br/>")).show();
if($(this).val()){$(this).prev().addClass("qa-hasanswer");}else{$(this).prev().removeClass("qa-hasanswer");}var c=$(this).closest("li");a.saveQa({id:c.attr("data-id"),cateId:c.attr("data-cate-id"),qaCateFirstId:c.attr("data-catefirst-id"),answer:$(this).val(),question:c.find(".qaId").text().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),answerType:"string",createBy:c.attr("data-create-by"),createTime:c.attr("data-create-time"),});
}else{$(this).hide().val("").prev().show();}});$(document).on("click",".saveNoAnswer",function(b){a.saveQa();});a.resizeUl();$(window).on("resize",function(){a.resizeUl();
});$(document).on("keydown",function(b){if(b.ctrlKey&&b.keyCode==13){if(a.modal){a.saveQa();}}});$(document).off("click",".qaListFavorite").on("click",".qaListFavorite",function(){var b=$(this).closest("li").attr("data-id");
var c=$(this);FormUtils.submit(KmEntity._CONS_.FAVORITE_URL,{id:b},function(d){if(d.success){DialogUtils.success("提示","收藏成功！");c.before("<span class='qaListFavoriteCancel'><i class='fa fa-star-o'></i>&nbsp;取消收藏</span>&emsp;");
c.remove();}else{DialogUtils.error(msgCode.ERROR,d.msg);}});});$(document).off("click",".qaListFavoriteCancel").on("click",".qaListFavoriteCancel",function(){var b=$(this).closest("li").attr("data-id");
var c=$(this);FormUtils.submit(KmEntity._CONS_.FAVORITE_CANCEL_URL,{id:b},function(d){if(d.success){DialogUtils.success("提示","取消收藏成功！");c.before("<span class='qaListFavorite'><i class='fa fa-star'></i>&nbsp;收藏</span>&emsp;");
c.remove();}else{DialogUtils.error(msgCode.ERROR,d.msg);}});});},_initGroupSelect:function(){$("body").on("click","#qaEntityForm .groupNames",function(){var a={isMultiple:1,isReDisabled:true,isSmsConfigHtml:true,selectedGroupId:$("#qaEntityForm").find("[name='groupIds']").val(),container:"qaEntityForm .groupNames",nolimit:true,fn:function(c,d,b){$("#qaEntityForm").find(".groupNames").val(b);
$("#qaEntityForm").find("input[name=groupIds]").val(c);}};GroupUtils.selectGroupTreeBox(a);});},editNoAnswer:function(b){var a=this;},resizeUl:function(){$(".qa-list-layer").height($(".qa-content-layer").height()-$(".qa-form-layer").outerHeight()-5);
},getCateFirstId:function(a){var c=null;function b(e){if(e.getParentNode()!=null){var d=e.getParentNode();c=e.id;return b(d);}else{return c;}}c=b(a);if(!c){c=a.id;
}return c;},_bindFormValidation:function(){var a=this;var b={rules:{qaCateFirstId:{required:true},cateId:{required:true},questionArea:{},answerArea:{required:a.model}},messages:{}};
if(a.model){b.rules.answerArea.maxlength=1024;}FormUtils.bindFormValidation(QaEntity._CONS_.EDIT_FORM_ID,b);},_getManagerBtns:function(){var a=this;if(!ResUtils.canShow("qaEntity.buttion.addSubKmEntity")){$("#subKmEntityAdd").css("display","none");
}if(!ResUtils.canShow("qaEntity.buttion.addKmEntity")){$("#commonkmEntityAdd").css("display","none");}if(!ResUtils.canShow("qaEntity.button.add")){$(".addQaBtn").css("display","none");
}if((!qaType&&ResUtils.canShow("qaEntity.button.delete"))||(qaType&&ResUtils.canShow("qaEntity.button.subDelete"))){a.res.del=true;$("body").addClass("res-delete");
}if((!qaType&&ResUtils.canShow("qaEntity.button.edit"))||(qaType&&ResUtils.canShow("qaEntity.button.subEdit"))){a.res.edit=true;$("body").addClass("res-edit");
}if((!qaType&&ResUtils.canShow("qaEntity.button.detail"))||(qaType&&ResUtils.canShow("qaEntity.button.subDetail"))){a.res.detail=true;$("body").addClass("res-detail");
}if(qaType){a.treeres={add:false,edit:false,del:false};return false;}if(ResUtils.canShow("qaEntity.button.addCate")){a.treeres.add=true;}if(ResUtils.canShow("qaEntity.button.editCate")){a.treeres.edit=true;
}if(ResUtils.canShow("qaEntity.button.deleteCate")){a.treeres.del=true;}},qaList:function(b){var a=this;if(!b){b={};b.Q__S__EQ__cate_id_=a.cateId;b.rows=a.rows;
b.page=a.page;b.sord=a.sord;}if(qaType){b.belongEmployee=currentUserId;}FormUtils.submit(QaEntity._CONS_.LIST_DATA_URL,b,function(c){a.total=c.total;a.page=c.page;
$("#qaList").append(a.qaListStr(c.rows));a.isSelectAll();a.isSelects();});},reloadQaList:function(c,a){var b=this;if(!c){c=$("#questionArea").val();}var d={rows:b.rows,page:1,sord:b.sord};
if(qaType){d.belongEmployee=currentUserId;}if($(".favoriteCheckbox").is(":checked")){d.favorite=true;}d.Q__S__EQ__cate_id_=this.cateId;d.likeContent=c;
$("#qaList").empty();this.qaList(d);},loadMoreList:function(b){var a=this;var c={rows:a.rows,page:a.page+1,sord:a.sord};if(a.queryParam){$.extend(true,c,a.queryParam,{"Q__S__EQ__cate_id_":a.rootId});
}else{c.Q__S__EQ__cate_id_=this.cateId;}FormUtils.submit(QaEntity._CONS_.LIST_DATA_URL,c,function(d){a.total=d.total;a.page=d.page;$("#qaList").find(".load-more").before(a.qaListStr(d.rows));
if(a.total==a.page){$(".load-more").remove();}else{$(".load-more").find("font").html("当前第&nbsp;"+a.page+"&nbsp;页 共&nbsp;"+a.total+"&nbsp;页");}a.isSelectAll();
a.isSelects();});},loadMoreNoQaList:function(){var a=this;var b={rows:a.rows,page:a.page+1,sord:a.sord,qoa:true};b.type="qa";FormUtils.submit(QaEntity._CONS_.LIST_NOANSWER_URL,b,function(c){a.total=c.total;
a.page=c.page;$("#qaList").find(".load-more").before(a.qaListStr(c.rows));if(a.total==a.page){$(".load-more").remove();}else{$(".load-more").find("font").html("当前第&nbsp;"+a.page+"&nbsp;页 共&nbsp;"+a.total+"&nbsp;页");
}a.isSelectAll();a.isSelects();});},textFormatter:function(d){var b=this;var a=d.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&");if(a.length>b.textFormat){var c=(a.substring(0,b.textFormat)).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"...<span class='qa-li-expand'>[展开全文]</span>";
}else{c=d;}return c;},qaAnswerHtml:function(b,c){var a=this;var d=new StringBuffer();if(c){d.append("<p style='width:auto;overflow:hidden;width:80%;' data-alltext='"+c+"'>").append((a.textFormatter(c)).replace(/\n|\r\n/g,"<br/>")).append("</p>");
}else{d.append("<p class='qa-noanswer-layer'></p>");}return d.toString();},qaListStr:function(d){var b=this,a="",e=new StringBuffer();if(d&&d.length){for(var c=0;
c<d.length;c++){e.append("<li  data-cate-id='"+d[c].cateId+"' data-catefirst-id='"+d[c].qaCateFirstId+"' data-id='"+d[c].id+"' data-create-by='"+d[c].createBy+"' data-create-time='"+d[c].createTime+"' type='"+d[c].type+"'>");
if("content"==d[c].type){e.append("<div class='divContentTag top-left-common'>知识</div>");}else{e.append("<div class='divQaTag top-left-common'>问答</div>");
}e.append("<div class='title'><a class='qaId'>"+d[c].question+"</a>").append("<div class='content'>"+b.qaAnswerHtml(d[c].answerType,d[c].answer)+"</div>").append("<div class='meta'>").append("<a class='cateFirst-type'>"+d[c].cateFirstName+"</a>");
if(d[c].cateName&&(d[c].qaCateFirstId!=d[c].cateId)){e.append("<a class='cate-type'>"+d[c].cateName+"</a>");}e.append("<a class='createBy'>创建者："+d[c].createName+"</a>");
if(d[c].updateBy){e.append("&emsp;<a class='createBy'>最后一次编辑："+d[c].updateBy+"</a>");}e.append("</div></div>").append("<div class='single-libtn-layer'>");
if("y"==d[c].isFavorite){e.append("<span class='qaListFavoriteCancel'><i class='fa fa-star-o'></i>&nbsp;取消收藏</span>&emsp;");}else{e.append("<span class='qaListFavorite'><i class='fa fa-star'></i>&nbsp;收藏</span>&emsp;");
}e.append("<span class='qa-detail-btn'><i class='fa fa-search-plus'></i>&nbsp;明细</span>&emsp;");if(!qaType||"content"==d[c].type&&d[c].belongEmployee){e.append("<span class='qa-edit-btn'><i class='fa fa-pencil'></i>&nbsp;编辑</span>&emsp;");
e.append("<span class='qa-delete-btn'><i class='fa fa-trash-o'></i>&nbsp;删除</span>");}e.append("</div>").append("</li>");}}else{e.append("<li class='no-data-li'>").append("<h2>该分类下没有找到符合的数据...</h2>").append("</li>");
}if($(".load-more").length==0&&b&&b.total>b.page){e.append("<li class='load-more'>点击加载更多<br/><font color='#d0d0d0'>当前第&nbsp;").append(b.page).append("&nbsp;页&emsp;共&nbsp;").append(b.total).append("&nbsp;页</font></li>");
}return e.toString();}};