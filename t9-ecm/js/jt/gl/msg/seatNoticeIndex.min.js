$(function(){function b(){this.hadInit=false;this.currentMsgItem;this.totalMsgItem;this.rowItem=10000;this.noticeTypeBtn="";this.noticeTime="today";this.msgData;
this.$container=$("div[srcVal='/gl/msg/msgdesktop/seatNoticeIndex.htm']");}b._CONS_={GET_TODAY_MSG_URL:ctx+"/gl/msg/msgEntity/listToDayMsgData.htm",};b.prototype={init:function(d){var c=this;
if(!c.hadInit){c.hadInit=true;c._bindEventHanlder();c.$container.find(".today").removeClass("btn-outline");c._getData("","today");}},_bindEventHanlder:function(){var c=this;
c.$container.on("click",".sevenDays",function(){c.$container.find(".today").addClass("btn-outline");$(this).removeClass("btn-outline");c.noticeTime="sevenDays";
c._getData(c.noticeTypeBtn,"sevenDays");});c.$container.on("click",".today",function(){c.noticeTime="today";$(this).removeClass("btn-outline");c.$container.find(".sevenDays").addClass("btn-outline");
c._getData(c.noticeTypeBtn,"today");});c.$container.on("click",".allBtn",function(){c._getData("",c.noticeTime);c.noticeTypeBtn="";c.$container.find(".allBtn").attr("disabled",true);
c.$container.find(".noticeBtn").attr("disabled",false);c.$container.find(".missBtn").attr("disabled",false);c.$container.find(".csCountBtn").attr("disabled",false);
c.$container.find(".otherBtn").attr("disabled",false);});c.$container.on("click",".noticeBtn",function(){c._getData("notice",c.noticeTime);c.noticeTypeBtn="notice";
c.$container.find(".allBtn").attr("disabled",false);c.$container.find(".noticeBtn").attr("disabled",true);c.$container.find(".missBtn").attr("disabled",false);
c.$container.find(".csCountBtn").attr("disabled",false);c.$container.find(".otherBtn").attr("disabled",false);});c.$container.on("click",".missBtn",function(){c._getData("miss",c.noticeTime);
c.noticeTypeBtn="miss";c.$container.find(".allBtn").attr("disabled",false);c.$container.find(".noticeBtn").attr("disabled",false);c.$container.find(".missBtn").attr("disabled",true);
c.$container.find(".csCountBtn").attr("disabled",false);c.$container.find(".otherBtn").attr("disabled",false);});c.$container.on("click",".csCountBtn",function(){c._getData("assign",c.noticeTime);
c.noticeTypeBtn="assign";c.$container.find(".allBtn").attr("disabled",false);c.$container.find(".noticeBtn").attr("disabled",false);c.$container.find(".missBtn").attr("disabled",false);
c.$container.find(".csCountBtn").attr("disabled",true);c.$container.find(".otherBtn").attr("disabled",false);});c.$container.on("click",".otherBtn",function(){c._getData("others",c.noticeTime);
c.noticeTypeBtn="others";c.$container.find(".allBtn").attr("disabled",false);c.$container.find(".noticeBtn").attr("disabled",false);c.$container.find(".missBtn").attr("disabled",false);
c.$container.find(".csCountBtn").attr("disabled",false);c.$container.find(".otherBtn").attr("disabled",true);});c.$container.on("click",".deleteMsg",function(){var d=$(this).parents(".timeline-item");
var e=$(this).attr("idVal");DialogUtils.confirm(function(){FormUtils.submit(ctx+"/gl/msg/msgEntity/deleteMsgRead.htm",{msgId:e,recId:currentUserId},function(f){if(f.success){d.remove();
DialogUtils.success(msgCode.SUCCESS,"删除成功");}});});});$("body").on("click",".content",function(){var d=$(this).attr("urlVal");var e=$(this).attr("titleVal");
if(d){if(e==="待办任务"){JTTabUtils.addOrRefreshTab(ctx+"/gl/task/taskEntity/list.htm","待办任务","待办任务");}else{if(e==="我的客户"){JTTabUtils.addOrRefreshTab(ctx+d+"?type=self&turnNew=y",e);
}else{JTTabUtils.addOrRefreshTab(ctx+d,e);}}}});c.$container.on("click",".next-msg",function(){c.currentMsgItem=c.currentMsgItem+1;c._buildString(c.msgData);
});c.$container.on("click",".prev-msg",function(){c.currentMsgItem=c.currentMsgItem-1;c._buildString(c.msgData);});},_judeNextBtn:function(d,e){var c=this;
if((d*c.rowItem)<e){c.$container.find(".next-msg").removeAttr("disabled");}else{c.$container.find(".next-msg").attr("disabled","disabled");}},_judePrevBtn:function(d){var c=this;
if(d>1){c.$container.find(".prev-msg").attr("disabled",false);}else{c.$container.find(".prev-msg").attr("disabled",true);}},_getData:function(d,e){var c=this;
FormUtils.loadData(b._CONS_.GET_TODAY_MSG_URL+"?type="+d+"&time="+e,function(f){$("#msgDiv").empty();var g=f.records;c.totalMsgItem=g;if(g>=1){c.currentMsgItem=1;
c.msgData=f.rows;c._buildString(c.msgData);}else{var h='<div style="color: red;text-align: center;font-weight: bold;">没有符合数据！</div>';$("#msgDiv").append(h.toString());
c.currentMsgItem=0;c._judeNextBtn(c.currentMsgItem,c.totalMsgItem);c._judePrevBtn(c.currentMsgItem);}});},_buildString:function(h){var c=this;$("#msgDiv").empty();
var k=new StringBuffer();var e=0;if(c.currentMsgItem*c.rowItem>=c.totalMsgItem){e=c.totalMsgItem;}else{e=c.currentMsgItem*c.rowItem;}for(var f=(c.currentMsgItem-1)*c.rowItem;
f<e;f++){var d=h[f].url;var j=h[f].title;var g="";if(j.indexOf("未接来电")!=-1){g=j.replace("未接来电","");if(g){g=PhoneEncryptUtils.encryptPhone(g);}else{g="";
}}if(g){j=g+"未接来电";}if(!d){d="";}if(g){if(!h[f].content||h[f].content.indexOf("未接来电")>-1){h[f].content="[时间未知]";}h[f].content=g+"&nbsp;&nbsp;约<strong>["+h[f].content+"]</strong>&nbsp;&nbsp;未接来电";
}k.append("<div class='timeline-item'>");k.append("<div class='row'>");k.append("<div class='col-xs-3 date' style='padding-left:0px;padding-right:2px;text-align:center;'>");
if("notice"==h[f].type){k.append("<i class='fa fa-bullhorn' title='系统公告'></i>");}else{if("miss"==h[f].type){k.append("<i class='fa fa-phone' title='未接来电'></i>");
}else{if("assign"==h[f].type){k.append("<i class='fa fa-user' title='新进客户'></i>");}else{if("others"==h[f].type){k.append("<i class='fa fa-briefcase' title='其他消息'></i>");
}}}}if(DateUtils.getDateDiff(DateUtils.format(new Date(),"yyyy-MM-dd")+" 00:00:00",h[f].createTime.substring(0,10)+" 00:00:00","day")<0){k.append(h[f].createTime.substring(5,16));
}else{k.append(h[f].createTime.substring(11,16));}k.append("</div>");k.append("<div class='col-xs-8 content' style='min-height: 45px;border-right: 1px solid #e7eaec;");
if(f==c.rowItem*c.currentMsgItem-1||f==e-1){k.append("border-bottom: 1px solid #e7eaec;");}k.append("' urlVal='"+d+"'  titleVal='"+j+"'>");if("others"==h[f].type&&h[f].content.indexOf("【客户跟进】")>-1){k.append("<div class='col-xs-1' style='padding:0px;'><img alt='其他' class='img-circle' style='height:18px;width:18px;' src="+ctx+"/img/jt/notice/level"+h[f].level+".png></div><div class='col-xs-11' style='padding:0px;'>"+c._dealCsContent(h[f].content)+"</div>");
}else{if("others"==h[f].type&&h[f].content.indexOf("【订单跟进】")>-1){k.append("<div class='col-xs-1' style='padding:0px;'><img alt='其他' class='img-circle' style='height:18px;width:18px;' src="+ctx+"/img/jt/notice/level"+h[f].level+".png></div><div class='col-xs-11' style='padding:0px;'>"+c._dealSoFollowContent(h[f].content)+"</div>");
}else{if("others"==h[f].type&&h[f].content.indexOf("【订单】")>-1){k.append("<div class='col-xs-1' style='padding:0px;'><img alt='其他' class='img-circle' style='height:18px;width:18px;' src="+ctx+"/img/jt/notice/level"+h[f].level+".png></div><div class='col-xs-11' style='padding:0px;'>"+c._dealSoContent(h[f].content)+"</div>");
}else{if("assign"==h[f].type){k.append("<div class='col-xs-1' style='padding:0px;'><img alt='其他' class='img-circle' style='height:18px;width:18px;' src="+ctx+"/img/jt/notice/level"+h[f].level+".png></div><div class='col-xs-11' style='padding:0px;'>"+c._dealAssignContent(h[f].content)+"</div>");
}else{k.append("<div class='col-xs-1' style='padding:0px;'><img class='img-circle' style='height:18px;width:18px;' src='"+ctx+"/img/jt/notice/level"+h[f].level+".png'></div><div class='col-xs-11' style='padding:0px;'>"+h[f].content+"</div>");
}}}}k.append("</div>");k.append("<div class='col-xs-1'><button class='btn btn-danger btn-sm pull-right deleteMsg' idVal='"+h[f].id+"' type='button'><i class='fa fa-remove'></i></button></div>");
k.append("</div>");k.append("</div>");if(f==c.rowItem-1){break;}}$("#msgDiv").append(k.toString());c._judeNextBtn(c.currentMsgItem,c.totalMsgItem);c._judePrevBtn(c.currentMsgItem);
},_dealAssignContent:function(d){var c="";c=d.replace(/\d{1,5}/g,function(e){var f=new StringBuffer();f.append("<strong>");f.append(e);f.append("</strong>");
return f.toString();});return c;},_dealCsContent:function(d){var c="";c=d.replace(/\d{3,12}:/g,function(f){var e=f.substring(0,f.length-1);var g=new StringBuffer();
g.append("<strong>");g.append(e);g.append("</strong>");g.append(":");return g.toString();});return c;},_dealSoContent:function(d){var c="";c=d.replace(/\d{3,12}】/g,function(f){var e=f.substring(0,f.length-1);
var g=new StringBuffer();g.append("<strong>");g.append(e);g.append("</strong>");g.append("】");return g.toString();});return c;},_dealSoFollowContent:function(d){var c="";
c=d.replace(/\d{3,12}：/g,function(f){var e=f.substring(0,f.length-1);var g=new StringBuffer();g.append("<strong>");g.append(e);g.append("</strong>");g.append("：");
return g.toString();});return c;},};var a=new b();a.init();});