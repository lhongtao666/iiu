$(function(){var a=new ClearHistory();a.init();});function ClearHistory(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}ClearHistory._CONS_={EDIT_URL:ctx+"/gl/clear/clearHistory/edit.htm",DETAIL_URL:ctx+"/gl/clear/clearHistory/detail.htm",DELETE_URL:ctx+"/gl/clear/clearHistory/delete.htm",SAVE_ADD_URL:ctx+"/gl/clear/clearHistory/saveAdd.htm",SAVE_EDIT_URL:ctx+"/gl/clear/clearHistory/saveEdit.htm",LIST_DATA_URL:ctx+"/gl/clear/clearHistory/listData.htm",EDIT_FORM_ID:"clearHistoryForm",GRID:"#clearHistoryGrid",PAGER:"#clearHistoryPager"};
ClearHistory.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._initSelect();this._bindEventHander();this._csMap=new Map();this._reloadData();
}},_reloadData:function(){var a=ctx+"/gl/clear/clearHistory/listData.htm";FormUtils.loadData(a,function(c){if(c&&c.length){var d=$.templates("#clearHistoryDivTmpl");
var b=d.render(c);$("#clearHistoryContainer").empty().append(b);}},null,false);},_delete:function(c){var a=this;var b={};b.ids=c;DialogUtils.confirmWithOptions({title:"删除历史记录吗?",text:"删除后将再也无法恢复记录,请谨慎操作!",confirmButtonText:"确定",yesFunc:function(){FormUtils.submit(ctx+"/gl/clear/clearHistory/delete.htm",b,function(d){if(d.success){DialogUtils.success("成功","操作成功");
a._reloadData();}else{DialogUtils.error("失败",d.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});}});},_revertData:function(c){var a=this;var b={};
b.ids=c;DialogUtils.confirmWithOptions({title:"恢复此次记录删除的数据吗?",text:"只能恢复一次!",confirmButtonText:"确定",yesFunc:function(){FormUtils.submit(ctx+"/gl/clear/clearHistory/revertHistory.htm",b,function(d){if(d.success){DialogUtils.success("成功","操作成功");
a._reloadData();}else{DialogUtils.error("失败",d.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});}});},_initSelect:function(){var a=this;this._initClearSoByAidEmployeeSelect();
this._initClearCsEmployeeSelect();$("#clearCsOrgName").on("click",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$("#clearCsOrgId").val(),container:"clearCsOrgName",fn:function(b){a._initClearCsEmployeeSelect(b);
$("#clearCsOrgId").val(b);}});});$("#clearSoByAidOrgName").on("click",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$("#clearSoByAidOrgId").val(),container:"clearSoByAidOrgName",fn:function(b){a._initClearSoByAidEmployeeSelect(b);
$("#clearSoByAidOrgId").val(b);}});});},_initClearSoByAidEmployeeSelect:function(b){var a=this;FormUtils.loadData(ctx+"/crm/ou/employee/listEmployees.htm?groupId="+b+"&type=dept_manager",function(d){$("#clearSoByAidEmployeeSelector").empty();
var e=new StringBuffer();e.append("<option value=''>请选择</option>");if(d&&d.length){for(var c=0;c<d.length;c++){e.append("<option value='"+d[c].aid+"'>"+d[c].aid+":"+d[c].name+"</option>");
}}$("#clearSoByAidEmployeeSelector").append(e.toString()).select2();},null,true);},_initClearCsEmployeeSelect:function(b){var a=this;FormUtils.loadData(ctx+"/crm/ou/employee/listEmployees.htm?groupId="+b+"&type=dept_manager",function(d){$("#clearCsEmployeeSelector").empty();
var e=new StringBuffer();e.append("<option value=''>请选择</option>");if(d&&d.length){for(var c=0;c<d.length;c++){e.append("<option value='"+d[c].aid+"'>"+d[c].aid+":"+d[c].name+"</option>");
}}$("#clearCsEmployeeSelector").append(e.toString()).select2();},null,true);},_bindEventHander:function(){var a=this;$("body").on("click",".deleteHistory",function(){var b=$(this).attr("idVal");
a._delete(b);});$("body").on("click",".reverHistory",function(){var b=$(this).attr("idVal");a._revertData(b);});$("body").on("click",".clearCsBtn",function(){var b=$("#clearCsForm #clearCsEmployeeSelector").val();
if(!b){DialogUtils.error(msgCode.error,"请选择员工");return;}var d=$("#clearCsForm [name=startTime]").val();var c=$("#clearCsForm [name=endTime]").val();if(!d||!c){DialogUtils.error(msgCode.error,"请选择开始时间和结束时间");
return;}var e={};e.type=$("#clearCsForm").find("[name=type]").val();e.startTime=d;e.endTime=c;e.aids=b;DialogUtils.confirmWithOptions({title:"确定要删除数据吗?",text:"请谨慎操作,并且不要在在线人数较多的情况操作!",confirmButtonText:"确定",yesFunc:function(){FormUtils.submit(ctx+"/gl/clear/clearHistory/clearData.htm",e,function(f){if(f.success){DialogUtils.success("成功","操作成功");
a._reloadData();}else{DialogUtils.error("失败",f.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});}});});$("body").on("click",".clearSoByAidBtn",function(){var b=$("#clearSoByAidForm #clearSoByAidEmployeeSelector").val();
if(!b){DialogUtils.error(msgCode.error,"请选择员工");return;}var d=$("#clearSoByAidForm [name=startTime]").val();var c=$("#clearSoByAidForm [name=endTime]").val();
if(!d||!c){DialogUtils.error(msgCode.error,"请选择开始时间和结束时间");return;}var e={};e.type=$("#clearSoByAidForm").find("[name=type]").val();e.startTime=d;e.endTime=c;
e.aids=b;DialogUtils.confirmWithOptions({title:"确定要删除数据吗?",text:"请谨慎操作,并且不要在在线人数较多的情况操作!",confirmButtonText:"确定",yesFunc:function(){FormUtils.submit(ctx+"/gl/clear/clearHistory/clearData.htm",e,function(f){if(f.success){DialogUtils.success("成功","操作成功");
a._reloadData();}else{DialogUtils.error("失败",f.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});}});});$("body").on("click",".clearSoByCsBtn",function(){var d=[];
var h=a._csMap.values();for(var c=0;c<h.length;c++){var f=h[c];d.push(f.id);}var g=d.join(",");if(!g||!d.length){DialogUtils.error(msgCode.error,"请选择客户");
return;}var e=$("#clearSoByCsForm [name=startTime]").val();var b=$("#clearSoByCsForm [name=endTime]").val();if(!e||!b){DialogUtils.error(msgCode.error,"请选择开始时间和结束时间");
return;}var j={};j.type=$("#clearSoByCsForm").find("[name=type]").val();j.startTime=e;j.endTime=b;j.csIds=g;DialogUtils.confirmWithOptions({title:"确定要删除数据吗?",text:"请谨慎操作,并且不要在在线人数较多的情况操作!",confirmButtonText:"确定",yesFunc:function(){FormUtils.submit(ctx+"/gl/clear/clearHistory/clearData.htm",j,function(i){if(i.success){DialogUtils.success("成功","操作成功");
a._csMap.clear();$("#clearSoByCsForm #csContainer").empty();a._reloadData();}else{DialogUtils.error("失败",i.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");
});}});});$("body").on("click",".selectSelfCsEntity",function(){var c={type:"self",baseUrl:ctx+"/crm/cs/csEntity/list.htm?isSelectCsEntity=true",callBack:function(k,h){for(var f=0;
f<k.length;f++){var j=k[f];var g={id:j.id,code:j.pureCode,name:j.name};a._csMap.put(g.id,g);}var e=a._csMap.values();var d=a._buildCsDiv(e);$("#clearSoByCsForm #csContainer").empty().append(d);
}};var b=new SelectCsEntityService();b.init(c);});$("body").on("click",".selectMySubCsEntity",function(){var c={type:"mysub",baseUrl:ctx+"/crm/cs/csEntity/subList.htm?isSelectCsEntity=true",callBack:function(k,h){for(var f=0;
f<k.length;f++){var j=k[f];var g={id:j.id,code:j.pureCode,name:j.name};a._csMap.put(g.id,g);}var e=a._csMap.values();var d=a._buildCsDiv(e);$("#clearSoByCsForm #csContainer").empty().append(d);
}};var b=new SelectCsEntityService();b.init(c);});$("body").on("click",".removeCsDiv",function(){var b=$(this).attr("idVal");a._csMap.remove(b);$(this).parents(".csDiv-"+b).remove();
});},_buildCsDiv:function(c){var b=$.templates("#csDivTmpl");var a=b.render(c);return a;},_bindFormValidation:function(){var a={rules:{},messages:{}};FormUtils.bindFormValidation(ClearHistory._CONS_.EDIT_FORM_ID,a);
},};