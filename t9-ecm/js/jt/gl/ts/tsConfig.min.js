$(function(){var a=new TsConfig();a.init();});function TsConfig(){this.hadInit=false;}TsConfig._CONS_={TS_URL:ctx+"/gl/ts/tsConfig/ts.htm",RECOVER_URL:ctx+"/gl/ts/tsConfig/recover.htm",RESUME_URL:ctx+"/gl/ts/tsConfig/resume.htm",REDUCE_URL:ctx+"/gl/ts/tsConfig/reduce.htm",SAVE_EDIT_URL:ctx+"/gl/ts/tsConfig/saveEdit.htm",LIST_DATA_URL:ctx+"/gl/ts/tsConfig/listData.htm",SYNCHRONIZECS_URL:ctx+"/gl/ts/tsConfig/synchronizeCs.htm",EDIT_FORM_ID:"tsConfigForm",GRID:"#tsConfigGrid",PAGER:"#tsConfigPager"};
TsConfig.prototype={init:function(a){if(!this.hadInit){if(window.localStorage.getItem("sys_is_ts")=="true"){$("#tsBtn").attr("disabled","disabled");$("#recoverBtn").removeAttr("disabled");
$(".confirmBtn").attr("disabled","disabled");$(".saveEdit").attr("disabled","disabled");}else{$("#recoverBtn").attr("disabled","disabled");$("#tsBtn").removeAttr("disabled");
}if(window.localStorage.getItem("ts_money_reduce")=="true"){$("#reduceTenth").attr("disabled","disabled");$("#resumeBtn").removeAttr("disabled");}else{$("#resumeBtn").attr("disabled","disabled");
$("#reduceTenth").removeAttr("disabled");}this.hadInit=true;this._initConfig();this._bindEventHander();}},_initConfig:function(){var a=this;FormUtils.loadData(TsConfig._CONS_.LIST_DATA_URL,function(b){$("input[name=id]").val(b.rows[0].id);
$("input[name=weekSo]").val(b.rows[0].weekSo);a._initFollows(b.rows[0].follows);});},_initFollows:function(d){var b=this;var e=new StringBuffer();var a=d.split(",");
if(a!=null){for(var c=0;c<a.length;c++){e.append("<div class='form-group'><div class='col-sm-9'>");e.append("<label class='col-sm-3 control-label'>跟进内容</label>");
e.append("<div class='col-sm-4'><textarea rows='4' placeholder='跟进内容' class='form-control' name='follow' validatetype='default' maxlength='1024'>"+a[c]+"</textarea>");
e.append("</div>");e.append("<div class='col-sm-1'>");e.append("<span style='line-height:30px;'><i class='fa fa-remove removeFollow' title='删除' style='color: red; cursor: pointer;'></i> | ");
e.append("<button type='button' class='btn btn-xs btn-primary addFollow'><i class='fa fa-plus'></i></button>");e.append("</div>");e.append("</div>");e.append("</div>");
}}$(".followsDiv").append(e.toString());b._addFollow();},_save:function(){var c=this;var a=TsConfig._CONS_.SAVE_EDIT_URL;var b=$("#"+TsConfig._CONS_.EDIT_FORM_ID).serialize()+"&follows="+c._getFollows();
ButtonUtils.disableBtn("saveEdit");FormUtils.submit(a,b,function(d){ButtonUtils.enableBtn("saveEdit");if(d.success){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);}},function(){ButtonUtils.enableBtn("saveEdit");DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},_getFollows:function(){var a=new StringBuffer();
$(".followsDiv").find(".form-group").each(function(){var c=$(this).find("textarea[name=follow]").val();if(c){a.append(c+",");}});var b=""+a;if(b.length>1){b=b.substring(0,b.length-1);
}return b;},_confirm:function(){var a=$("input[name=csCount]").val();if(!a){DialogUtils.error(msgCode.FAIL_MSG,"请填写客户数");}ButtonUtils.disableBtn("confirmBtn");
FormUtils.loadData(TsConfig._CONS_.SYNCHRONIZECS_URL+"?csCount="+a,function(b){ButtonUtils.enableBtn("confirmBtn");if(b.success){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){ButtonUtils.enableBtn("confirmBtn");DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});
},_addFollow:function(){var a=new StringBuffer();a.append("<div class='form-group'><div class='col-sm-9'>");a.append("<label class='col-sm-3 control-label'>跟进内容</label>");
a.append("<div class='col-sm-4'><textarea rows='4' placeholder='跟进内容' class='form-control' name='follow' validatetype='default' maxlength='1024'></textarea>");
a.append("</div>");a.append("<div class='col-sm-1'>");a.append("<span style='line-height:30px;'><i class='fa fa-remove removeFollow' title='删除' style='color: red; cursor: pointer;'></i> | ");
a.append("<button type='button' class='btn btn-xs btn-primary addFollow'><i class='fa fa-plus'></i></button>");a.append("</div>");a.append("</div>");a.append("</div>");
$(".followsDiv").append(a.toString());},_bindEventHander:function(){var a=this;$("body").on("click",".saveEdit",function(){a._save();});$("body").on("click",".confirmBtn",function(){a._confirm();
});$("body").on("click",".addFollow",function(){a._addFollow();});$("body").on("click",".removeFollow",function(){var b=new StringBuffer();$(this).parents(".form-group").remove();
});$("body").on("click","#tsBtn",function(){FormUtils.submit(TsConfig._CONS_.TS_URL,{},function(b){if(b.success){DialogUtils.success(msgCode.SUCCESS,b.msg);
window.localStorage.setItem("sys_is_ts","true");$("#tsBtn").attr("disabled","disabled");$("#recoverBtn").removeAttr("disabled");}else{DialogUtils.error(msgCode.ERROR,b.msg);
}});});$("body").on("click","#recoverBtn",function(){FormUtils.submit(TsConfig._CONS_.RECOVER_URL,{},function(b){if(b.success){DialogUtils.success(msgCode.SUCCESS,b.msg);
window.localStorage.setItem("sys_is_ts","false");$("#recoverBtn").attr("disabled","disabled");$("#tsBtn").removeAttr("disabled");}else{DialogUtils.error(msgCode.ERROR,b.msg);
}});});$("body").on("click","#resumeBtn",function(){FormUtils.submit(TsConfig._CONS_.RESUME_URL,{},function(b){if(b.success){DialogUtils.success(msgCode.SUCCESS,b.msg);
window.localStorage.setItem("ts_money_reduce","false");$("#resumeBtn").attr("disabled","disabled");$("#reduceTenth").removeAttr("disabled");}});});$("body").on("click","#reduceTenth",function(){FormUtils.submit(TsConfig._CONS_.REDUCE_URL,{},function(b){if(b.success){DialogUtils.success(msgCode.SUCCESS,b.msg);
window.localStorage.setItem("ts_money_reduce","true");$("#reduceTenth").attr("disabled","disabled");$("#resumeBtn").removeAttr("disabled");}});});},};