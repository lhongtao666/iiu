$(function(){var a=new NewGlHelp();a.init();});function NewGlHelp(){this.hadInit=false;this.isEdit=false;}NewGlHelp._CONS_={LIST_DATA_URL:ctx+"/gl/km/glHelp/findTopQa.htm",LIST_DATA_VIDEO_URL:ctx+"/gl/km/glHelp/findTopVideo.htm",SOLR_LIST_URL:ctx+"/gl/km/glHelp/getSolrData.htm",FIND_KM_URL:ctx+"/gl/qa/qaEntity/findT9GlHelp.htm",EDIT_URL:ctx+"/gl/qa/qaEntity/edit.htm",};
NewGlHelp.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._hideNotGrantBtn();this._initQaData();this._initVideoData();
}},_hideNotGrantBtn:function(){},_bindEventHander:function(){var a=this;$(document).on("click",".comQueA",function(){var b=$(this).attr("data-id");if(b){a._detailQa(b);
}});$(document).on("click",".searchQueA",function(){var b=$(this).attr("data-id");if(b){a._detailSearchQa(b);}});$(document).on("click",".keySearch",function(){var b=$(this).text();
$(".init-content").hide();$(".search-content").show();$("#center-search").val(b);a._solrSeach(b);a._dbSeach(b);});$(document).on("click",".glHelpSearch",function(){var b=$("#center-search").val();
if(!b){DialogUtils.error(msgCode.ERROR,"请输入搜索内容");return;}$(".search-show-content").each(function(){$(this).css("display","");});$(".search-detail-content").hide();
$(".init-content").hide();$(".search-content").show();a._solrSeach(b);a._dbSeach(b);});$(document).on("click",".init-content .prevBtn",function(){$(".detail-content").hide();
$("#commonQuestion").show();});$(document).on("click",".search-content .prevBtn",function(){$(".search-show-content").each(function(){$(this).css("display","");
});$(".search-detail-content").hide();});$(document).on("keydown",function(c){if(c.keyCode==13){var b=$("#center-search").val();if(!b){DialogUtils.error(msgCode.ERROR,"请输入搜索内容");
return;}$(".glHelpSearch").trigger("click");}});$(document).on("click",".moreQuestion",function(){var c=$(this).attr("data-value");if(c){var b=parseInt(c)+10;
var d={"pageSize":b};a._initQaData(d,true);}});$(document).on("click",".moreVideo",function(){var c=$(this).attr("data-value");if(c){var b=parseInt(c)+6;
var d={"pageSize":b};a._initVideoData(d,true);}});},_detailSearchQa:function(b){var a=this;FormUtils.loadData(NewGlHelp._CONS_.EDIT_URL+"?id="+b,function(c){if(c){$(".search-show-content").hide();
$(".search-detail-content").show();$(".titleDetail").text(c.question);$(".timeDetail").text(c.createTime);if("qa"==c.type){c.answer=c.answer.replace(/\n/g,"<br/>");
$(".contentDetail").empty().append(c.answer);}else{var d=new StringBuffer();d.append(c.content);$(".contentDetail").empty().append(d.toString());}}});},_detailQa:function(b){var a=this;
FormUtils.loadData(NewGlHelp._CONS_.EDIT_URL+"?id="+b,function(c){if(c){$(".detail-content").show();$("#commonQuestion").hide();$(".titleDetail").text(c.question);
$(".timeDetail").text(c.createTime);if("qa"==c.type){c.answer=c.answer.replace(/\n/g,"<br/>");$(".contentDetail").empty().append(c.answer);}else{var d=new StringBuffer();
d.append(c.content);$(".contentDetail").empty().append(d.toString());}}});},_dbSeach:function(b){var a=this;FormUtils.loadData(NewGlHelp._CONS_.FIND_KM_URL+"?likeContent="+b,function(c){if(c&&c.length){a._builderDBSearchHtml(c);
}else{$("#kmUl").empty();}},function(){DialogUtils.error(msgCode.ERROR,"请稍后重试");return;});},_solrSeach:function(b){var a=this;FormUtils.loadData(NewGlHelp._CONS_.SOLR_LIST_URL+"?solrKey="+b,function(c){if(c.statusCode&&c.statusCode==200){a._builderSearchHtml(c.data);
}else{if(c.statusCode&&c.statusCode==500){DialogUtils.error(msgCode.ERROR,"请稍后重试");return;}}},function(){DialogUtils.error(msgCode.ERROR,"请稍后重试");return;
});},_initQaData:function(b,a){if(!b){b={"pageSize":10};}FormUtils.submit(NewGlHelp._CONS_.LIST_DATA_URL,b,function(d){if(d){var e=new StringBuffer();for(var c=0;
c<d.length;c++){e.append('<li><a type="button" class="comQueA" ').append(' data-id="').append(d[c].id).append('">').append(d[c].question).append("</a></li>");
}$("#commonQuestion").empty().append(e.toString());if(d.length==b.pageSize){$(".moreQuestion").attr("data-value",b.pageSize);}else{$(".moreQuestion").hide();
}}});},_initVideoData:function(b,a){if(!b){b={"pageSize":6};}FormUtils.submit(NewGlHelp._CONS_.LIST_DATA_VIDEO_URL,b,function(d){if(d){var e=new StringBuffer();
for(var c=0;c<d.length;c++){e.append('<video controls="" preload="metadata"> <source type="video/mp4" src="').append(helpVideoIP).append("/video/").append(d[c].videoUrl).append('"> ').append("</video>").append('<div style="text-align: center;">').append(d[c].videoName).append("</div>");
}$(".videoItem").empty().append(e.toString());if(d.length==b.pageSize){$(".moreVideo").attr("data-value",b.pageSize);}else{$(".moreVideo").hide();}}});
},_builderDBSearchHtml:function(c){var b=new StringBuffer();for(var a=0;a<c.length;a++){b.append('<li class="search-item clearfix">');b.append('<div class="item-left cate-blog">');
b.append('<img src="').append(ctx).append('/img/jt/glhelp/qa.png">');b.append("</div>");b.append('<div class="item-right">');b.append('<a class="title searchQueA" href="javascript:void(0);" data-id="').append(c[a].id).append('">').append(c[a].question).append("</a>");
b.append("</div>");b.append("</li>");}$("#kmUl").empty().append(b.toString());},_builderSearchHtml:function(g){var b=g.result;var c=new StringBuffer();
var f=new StringBuffer();var a=new StringBuffer();var h=new StringBuffer();if(!b||b.length<1){$("#allUl").empty().append("<h3>暂无数据</h3>");$("#videoUl").empty().append("<h3>暂无数据</h3>");
$("#wordUl").empty().append("<h3>暂无数据</h3>");$("#qaUl").empty().append("<h3>暂无数据</h3>");return;}for(var e=0;e<b.length;e++){var d=new StringBuffer();d.append('<li class="search-item clearfix">');
d.append('<div class="item-left cate-blog">');if("video"==b[e].answerType){d.append('<img src="').append(ctx).append('/img/jt/glhelp/qavideo.png">');}else{if("word"==b[e].answerType){d.append('<img src="').append(ctx).append('/img/jt/glhelp/qaword.png">');
}else{d.append('<img src="').append(ctx).append('/img/jt/glhelp/qa.png">');}}d.append("</div>");d.append('<div class="item-right">');if("video"==b[e].answerType){d.append('<a class="title ">').append(b[e].question).append("</a>");
b[e].answer=b[e].answer.replace(/<\/?.+?\/?>/g,"");d.append('<div class="content">').append('<a class="answerUrl" href="').append(helpVideoIP).append("/video/").append(b[e].answer).append('" target="_blanck">点击跳转播放视频>></a>').append("</div>");
}else{if("word"==b[e].answerType){d.append('<a class="title ">').append(b[e].question).append("</a>");d.append('<div class="content">').append('<a class="answerUrl"  href="').append(b[e].answer).append('" target="_blanck">点击跳转查看帮助文档>></a>').append("</div>");
}else{d.append('<a class="title searchQueA" href="javascript:void(0);" data-id="').append(b[e].id).append('">').append(b[e].question).append("</a>");d.append('<div class="content">').append(b[e].answer).append("</div>");
}}d.append("</div>");d.append("</li>");c.append(d.toString());if("video"==b[e].answerType){f.append(d.toString());}else{if("word"==b[e].answerType){a.append(d.toString());
}else{h.append(d.toString());}}}$("#allUl").empty().append(c.toString());$("#videoUl").empty().append(f.toString());$("#wordUl").empty().append(a.toString());
$("#qaUl").empty().append(h.toString());}};