var systemTagUtil={init:function(a){this._loadData(a);this._bindEventHandler(a);this._hideNotGrantedBtn(a);},_loadData:function(b){var a=this;FormUtils.loadData(ctx+"/gl/tag/tag/showTags.htm?entityId="+b.entityId,function(c){a._buildCsTag(c,b,"y");
},function(){},true);},_bindEventHandler:function(b){var a=this;$(document).find("#saveTagBtn").text("保存");$(document).on("click","#saveTagBtn",function(){if(a.obj&&"y"==a.obj.supportColor){var d=$(".tagColorOpt [name=optId]").val();
}else{var d=$("#"+b.container).val();}var c={"type":b.type,"entityId":b.entityId,"optId":d,};FormUtils.submit(ctx+"/gl/tag/tag/saveTags.htm",c,function(e){DialogUtils.success("提示","保存成功！");
});});$(document).on("click",".deleteColorOptSpan",function(){var f=$(this);var g=f.parents(".colorOptSpanDiv");g.remove();var c=[];var d=$(".colorOptSpanDiv");
d.each(function(){var h=$(this).attr("value");c.push(h);});$(".tagColorOpt [name=optId]").val(c.join(","));var e={"type":b.type,"entityId":b.entityId,"optId":$(".tagColorOpt [name=optId]").val(),};
FormUtils.submit(ctx+"/gl/tag/tag/saveTags.htm",e,function(h){});});$(document).on("click",".chooseColorLi",function(){var d=$(this);var c=d.find(".checkIcon");
c.toggleClass("fa").toggleClass("fa-check");});$(document).on("click",".plusBtn",function(){var f=a.obj;var o=$(this);var h=o.parents(".colorOptSpanDiv");
var m=$(".tagColorOpt [name=optId]").val();var e=m.split(",");var n=[];for(var g=0;g<f.allOpts.length;g++){var d=f.allOpts[g];var c=f.allOpts[g].value;
if(e.indexOf(c)>-1){d.isChecked="y";}else{d.isChecked="";}n.push(d);}f.opts=n;var p=new StringBuffer();p.append('<div class="list-worker-group colorAlertDialogDiv" style="float: left;overflow: auto;display: block;width: 100%;" >');
p.append('<ul style="float: left;margin: 0; padding: 0;width: 100%;list-style: none;">');p.append("{{for opts}}");p.append('<li idVal="{{:value}}" class="chooseColorLi" style="width: 100%;float: left; margin: 0;padding: 5px !important;border-bottom: 1px solid #eee;cursor: pointer;display: list-item;text-align: -webkit-match-parent;" >');
p.append('<div style="display: inline-block;margin-bottom: 0;font-weight: 400;text-align: center;touch-action: manipulation;cursor: pointer;border: 1px solid transparent;white-space: nowrap;padding: 6px 12px;font-size: 14px;line-height: 1.42857; border-radius: 4px;-moz-user-select: none;user-select: none; box-shadow: none!important; margin-right: 10px!important;padding: 0;width: 34px;height: 34px;line-height: 32px !important; outline: 0!important;text-transform: capitalize;text-align: center;color: #fff;background-color: {{:color}};border-color: #F7CA18;">');
p.append("{{if isChecked}}");p.append('<i style="visibility:visiable;text-rendering: auto;font-size: 12px!important;display: inline-block;line-height: 14px; -webkit-font-smoothing: antialiased; width: 1.25em;text-align: center;" class="checkIcon fa fa-check"></i>');
p.append("{{else}}");p.append('<i class="checkIcon" style="visibility:hide;text-rendering: auto;font-size: 12px!important;display: inline-block;line-height: 14px; -webkit-font-smoothing: antialiased; width: 1.25em;text-align: center;"></i>');
p.append("{{/if}}");p.append("</div>");p.append("{{:name}}");p.append("</li>");p.append("{{/for}}");p.append("</ul>");p.append("</div>");var j=p.toString();
var l=$.templates(j).render(f);var k=l;layer.open({area:["360px","300px"],title:"<span style='font-weight:600;'>客户标签</span>",type:1,btnAlign:"c",btn:["确定"],skin:"layui-layer-demo",closeBtn:1,anim:2,shadeClose:true,yes:function(t,v){var x=$(".chooseColorLi").filter(function(z){var y=$(this).find(".checkIcon");
return y.hasClass("fa-check");});var s=[];x.each(function(y,z){s.push($(this).attr("idVal"));});var i=a.obj;i.csChooseTagArr=s;var r=a._buildFilterOptArr(i.csChooseTagArr,i.allOpts);
i.opts=r;var w=a._rebuildOpt(i);$(".tagColorOpt").empty().append(w);var u=$(".tagColorOpt [name=optId]").val();if(!a._isSameArr(e,u.split(","))){var q={"type":b.type,"entityId":b.entityId,"optId":u,};
FormUtils.submit(ctx+"/gl/tag/tag/saveTags.htm",q,function(y){});}layer.close(t);},content:k});});},_isSameArr:function(c,b){if(!c||!c.length){if(!b||!b.length){return true;
}}else{if(!b||!b.length){return false;}else{if(c.length!=b.length){return false;}else{var a=true;for(var d=b.length-1;d>=0;d--){if(c.indexOf(b[d])<0){a=false;
break;}}return a;}}}},_rebuildOpt:function(b){var a=this;var e=new StringBuffer();e.append("<div>");e.append('<input type="hidden" name="optId" value="'+b.csChooseTagArr.join(",")+'" />');
e.append("{{for opts}}");e.append('<div value="{{:value}}" class="colorOptSpanDiv" style="float:left;margin-right:4px;">');e.append('<span value="{{:value}}" class="colorOptSpan" style="color:white;background: {{:color}};border-radius: 4px;text-align:center; float:left;padding: 4px;" colorval="{{:color}}">');
e.append("{{:name}}");e.append("</span>");e.append('<span class="deleteColorOptSpan" style=" width:20px;color:white;float:left;background: {{:color}};border-radius: 4px;text-align:center;padding: 4px;cursor: pointer;" colorval="{{:color}}">');
e.append("x");e.append("</span>");e.append("</div>");e.append("{{/for}}");e.append("</div>");e.append('<div class="tagOptAddBtn" style="float:left;">');
e.append('<span class="btn jt-form-select plusBtn" type="button">');e.append('<i class="fa fa-plus"></i>');e.append("</span>");e.append("</div>");var c=e.toString();
var d=$.templates(c).render(b);return d;},_buildFilterOptArr:function(f,d){var a=[];for(var c=0;c<d.length;c++){var b=d[c];var e=b.value;if(f.indexOf(e)>-1){a.push(b);
}}return a;},_buildCsTag:function(e,d,c){var a=this;var b={url:ctx+"/gl/tag/tag/loadAllTag.htm?type="+d.type,fn:function(g){var k={opts:g.cateOptList,type:d.type,entityId:d.entityId,};
if("y"===g.catePo.supportColor&&"y"===c){var f=a._buildFilterOptArr(e,k.opts);var h={type:k.type,entityId:k.entityId,allOpts:k.opts,opts:f,csChooseTagArr:e,};
a.obj=h;a.obj.supportColor="y";var l=new StringBuffer();l.append('<div class="tagColorOpt">');l.append(a._rebuildOpt(h));l.append("</div>");var i=l.toString();
$("#"+d.container).parent().parent().find("#saveTagBtn").hide();$("#"+d.container).replaceWith(i);}else{var l=new StringBuffer();l.append("{{for opts}}");
l.append("<option value='{{:value}}' class='list-group-item'>");l.append("{{:name}}");l.append("</option>");l.append("{{/for}}");var i=l.toString();var j=$.templates(i).render(k);
$("#"+d.container).append(j);$("#"+d.container).attr(d.selectType,"");if(e&&e.length>0){$("#"+d.container).val(e);}$("#"+d.container).chosen({max_selected_options:10});
}a._hideNotGrantedBtn(d);},};OptionsBaseUtils.getOptions(b);},_hideNotGrantedBtn:function(a){if(!ResUtils.canShow("csEntity.button.edit")){$("#saveTagBtn").hide();
$(".tagOptAddBtn").hide();$(".tagOptAddBtn").hide();$(".deleteColorOptSpan").hide();}},};systemTagUtil._CONS_={CS_TYPE:"cs",CS_MODULE:"csEntity",};