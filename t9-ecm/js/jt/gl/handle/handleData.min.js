$(function(){var a=new HandleData();a.init();});function HandleData(){this.hadInit=false;this.isEdit=false;}HandleData._CONS_={BACKUP_DATA_URL:ctx+"/gl/data/handleData/backUpData.htm",DELETE_DATA_URL:ctx+"/gl/data/handleData/deleteData.htm",AUTO_BACKUP_DELETE_URL:ctx+"/gl/data/handleData/autoBackUpDelete.htm",IMPORTEXCEL_DATA_URL:ctx+"/gl/data/handleData/importExcelData.htm",SELECT_JOB_URL:ctx+"/gl/data/handleData/selectJob.htm",};
HandleData.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();a.initJob();a._hideNotGrantedBtn();}},initJob:function(){FormUtils.loadData(HandleData._CONS_.SELECT_JOB_URL,function(a){if(a.runningPlan>0){$("input[name=isActived]").val("y");
$("input[name=isActived]").attr("checked","checked");}else{$("input[name=isActived]").val("n");}new Switchery(document.querySelector(".js_switch_"),{color:"#1AB394",className:"switchery switchery-small"});
});},_hideNotGrantedBtn:function(){if(ResUtils.canShow("cleanData.button")){$("#cleanTabLi").show();$("#tabClean").show();}if(ResUtils.canShow("copyData.button")){$("#handleTabLi").show();
if($("#cleanTabLi").css("display")=="none"){$("#handleTabLi").addClass("active");$("#tabHandle").addClass("active");}}},_bindEventHander:function(){var a=this;
$(document).on("click","#backUpData",function(){var b="";var c=false;if(!$("input[name=downloadFlag]").is(":checked")){c=true;b="downloadFlag=y";}FormUtils.submit(HandleData._CONS_.BACKUP_DATA_URL,b,function(d){if(d.success){$("#deleteDataBtn").show();
DialogUtils.success(msgCode.SUCCESS,d.msg);if(c){window.location.href=ctx+"/crm/components/upload/download.htm?dname="+name+"&durl="+downloadUrl;}}else{DialogUtils.error(msgCode.ERROR,d.msg);
}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});});$(document).on("click","#deleteDataBtn",function(){DialogUtils.confirm(function(){FormUtils.submit(HandleData._CONS_.DELETE_DATA_URL,function(b){if(b.success){DialogUtils.success(msgCode.INFO,msgCode.DELETE_MSG);
}else{DialogUtils.error(msgCode.ERROR,b.msg);}});});});$(document).on("change","input[name=isActived]",function(){if($(this).val()=="y"){$(this).val("n");
}else{$(this).val("y");}FormUtils.submit(HandleData._CONS_.AUTO_BACKUP_DELETE_URL,{isActived:$(this).val()},function(b){if(b.success){DialogUtils.success(msgCode.SUCCESS,b.msg);
}else{DialogUtils.error(msgCode.ERROR,b.msg);}});});$(document).on("click","#selectFile",function(){var b=[];FileUtils.selectFile(1,function(e){if(e&&e.length>0){$("#selectFile").hide();
for(var c=0;c<e.length;c++){var d=e[c].url;if(!d){d=e[c].path;}b.push(d);}FormUtils.submit(HandleData._CONS_.IMPORTEXCEL_DATA_URL,{filePaths:b},function(f){$("#selectFile").show();
if(f.success){DialogUtils.success(msgCode.SUCCESS,f.msg);}else{DialogUtils.error(msgCode.ERROR,f.msg);}});}});});}};