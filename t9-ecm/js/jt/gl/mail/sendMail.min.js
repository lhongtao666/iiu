$(function(){var a=new SendMail();a.init();});function SendMail(){this.hadInit=false;}SendMail._CONS_={SEND_MAIL_URL:ctx+"/gl/mail/mailQueue/sendEmail.htm",GET_CS_ADDR_URL:ctx+"/gl/mail/mailQueue/getAddr.htm",EDIT_FORM_ID:"mailQueueForm",};
SendMail.prototype={init:function(b){if(!this.hadInit){this.hadInit=true;this._bindFormValidation();this._bindEventHander();this._bindSummernote();var a={trueEmail:trueEmail,name:name,email:email,id:customerId};
this._getCustomerEmail(a);}},_bindSummernote:function(){SummernoteUtils.init({},"summernote");},_send:function(){var b=$("input[name=status]").val();if(b=="success"||b=="sending"){return false;
}var c=this;var a=SendMail._CONS_.SEND_MAIL_URL;var d=c._setValues();if(!d){return;}if($("#mailQueueForm").valid()){ButtonUtils.disableBtn("sendBtn");FormUtils.submitByFormId(a,SendMail._CONS_.EDIT_FORM_ID,function(e){ButtonUtils.enableBtn("sendBtn");
if(e.success){DialogUtils.success(msgCode.INFO,"发送成功！");$(".sendBtn").attr("disabled",true);}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);}},function(){ButtonUtils.enableBtn("sendBtn");
DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}},_setValues:function(){var f=$(".chosen-choices").find("li");var c=[];var a=[];for(var b=0;b<f.length;
b++){var e={};e.name=$(f[b]).attr("nameVal");e.email=$(f[b]).attr("emailVal");c.push(e);a.push($(f[b]).attr("id"));}if(c.length<=0){DialogUtils.error(msgCode.ERROR,"收件人不能为空!");
return false;}$("#tos").val(JSON.stringify(c));var g=$("input[name=id]").val();if(g==null||g==""){$("#csId").val(a);}var d=decodeURIComponent(SummernoteUtils.getCode("summernote"));
$("#mailContent").val(d);if(d==null||d==""){DialogUtils.error(msgCode.ERROR,"邮件内容不能为空！");return false;}return true;},_bindEventHander:function(){var a=this;
$(document).on("click",".prevBtn",function(){JTTabUtils.closeTab($(window.top.document).find(".page-tabs-content").find(".active").attr("data-id"));});
$(document).on("click",".sendBtn",function(){a._send();});},_getCustomerEmail:function(a){if(a!=null){var b="<li  id='"+a.id+"'nameVal='"+a.name+"' emailVal='"+a.email+"'class='search-choice'><span>";
b+=a.name+"<"+a.trueEmail+"></span></li>";$(".chosen-choices").append(b);}},_bindFormValidation:function(){var a={rules:{title:{required:true},emailAddress:{required:true}},messages:{}};
FormUtils.bindFormValidation(SendMail._CONS_.EDIT_FORM_ID,a);}};