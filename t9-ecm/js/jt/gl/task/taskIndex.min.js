$(function(){function b(){this.hadInit=false;this.currentPage=1;this.totalPage=1;this.rowWidth="300px";this.$container=$("div[srcVal='/gl/task/taskEntity/toTaskIndex.htm']");
}b._CONS_={ROWS_SIZE:20,UPDATE_TASK_STATUS:ctx+"/gl/task/taskEntity/updateTaskStatus.htm",LOAD_UNFINISH_TASK_DATA:ctx+"/gl/task/taskEntity/findUnfinishTask.htm?rows=5&page="};
b.prototype={init:function(){if(!this.hadInit){this.hadInit=true;this._resizeWidth();this._initTaskData("today");this.$container.find(".today").removeClass("btn-outline");
this._bindEventHandler();}},_resizeWidth:function(){var c=this;var d=document.body.clientWidth;if(d>=1800){c.rowWidth="600px";}else{if(d>=1500){c.rowWidth="500px";
}else{if(d>=1300){c.rowWidth="400px";}else{if(d>=1100){c.rowWidth="300px";}else{c.rowWidth="200px";}}}}},_bindEventHandler:function(){var c=this;$(window).resize(function(e){var d=c.rowWidth;
c._resizeWidth();if(d!=c.rowWidth){$(".taskEntityEdit").css("width",c.rowWidth);}});$(document).on("click",".finishTask",function(){var f=$(this).parents(".taskEntity").find("label.taskNameLabel");
var d=f.attr("title");var e=f.attr("taskType");d=TaskUtils.dealTaskName({name:d,type:e});d="<div class='taskEntityEdit' style='width:"+c.rowWidth+";overflow:hidden; white-space:nowrap; text-overflow:ellipsis'>"+d+"</div>";
var g=$(this).prop("checked");var i=new StringBuffer();var h={};h.ids=$(this).attr("idVal");if(g){i.append("<del>");i.append(d);i.append("</del>");h.status="done";
c._setTaskStatus(h);}else{i.append(d);h.status="awaiting";c._setTaskStatus(h);}f.empty().append(i.toString());});$("body").on("click",".taskEntityEdit",function(f){if(f.target!=this){return;
}else{var d=$(this).attr("idVal");if(!d){d=c._getSingleSelectedId($(this));}if(d){OperateTask.editTaskDialog({id:d,updateSuccessFn:function(){c.reloadUnfinishJqgrid();
},});}}});c.$container.on("click",".sevenDays",function(){c.$container.find(".today").addClass("btn-outline");$(this).removeClass("btn-outline");c._initTaskData("sevenDays");
});c.$container.on("click",".today",function(){$(this).removeClass("btn-outline");c.$container.find(".sevenDays").addClass("btn-outline");c._initTaskData("today");
});TaskUtils._bindEventHandler();},_setTaskStatus:function(d){var c={};c.status=d.status;c.ids=d.ids;FormUtils.submit(b._CONS_.UPDATE_TASK_STATUS,c,function(e){if(!e.success){DialogUtils.error("错误",e.msg);
}},function(){DialogUtils.error("错误","后台异常，请稍候重试");},true);},_createBtn:function(){var c=new StringBuffer();c.append(' <div class = "row pull-right" style = "padding-right:30px;" >');
c.append('<a class="J_menuItem showMore" nameVal="待办事项" urlVal="/gl/task/taskEntity/list.htm" href="#" data-index="89">');c.append('<strong>查看更多 </strong> <i class="fa fa-angle-right"></i>');
c.append("</a>");c.append("</div>");return c.toString();},_initTaskData:function(d){var c=this;c._loadTaskPage(d);},createRow:function(f){var d=this;var g=new StringBuffer();
g.append('<li class="taskEntity">');g.append('<div class="checkbox checkbox-success checkbox-inline">');g.append('<input idVal="'+f.id+'" type="checkbox" class="finishTask" >');
g.append('<label taskType="'+f.type+'"  style="padding-left:2px;font-size:12px;" title="'+f.name+'" class="taskNameLabel" >');var c=TaskUtils.dealTaskName(f);
c="<div class='taskEntityEdit' idVal='"+f.id+"' style='width:"+d.rowWidth+";overflow:hidden; white-space:nowrap; text-overflow:ellipsis'>"+c+"</div>";g.append(c);
g.append("</label>");g.append('<small class="label label-primary pull-right"><i class="fa fa-clock-o"></i> ');if(f.notifyTime){var e=DateUtils.format(new Date(f.notifyTime),DateUtils._CONS_.DEFAULT_MON_DAY_HOU_MIN_PATTERN);
g.append(e);}g.append("</small>");g.append("</div>");g.append("</li>");return g.toString();},_loadTaskPage:function(d){var c=this;FormUtils.loadData(b._CONS_.LOAD_UNFINISH_TASK_DATA+""+c.currentPage+"&timeType="+d,function(f){if(f.records<=0){var j='<div style="color: red;text-align: center;font-weight: bold;">没有符合数据！</div>';
$("#taskPanel").empty().append(j);}else{var e=f.rows;var k=new StringBuffer();k.append('<ul class="todo-list m-t ui-sortable">');if(e){for(var g=e.length-1;
g>=0;g--){var h=e[g];k.append(c.createRow(h));}}k.append("</ul>");$("#taskPanel").empty().prepend(k.toString()).append(c._createBtn());c._dealPageBtn(f);
}});},_dealPageBtn:function(d){var c=this;this.totalPage=d.total;if(d.page==d.total){$(".next-page").attr("disabled","disabled");}if(c.currentPage<=1){$(".prev-page").attr("disabled","disabled");
}},};var a=new b();a.init();});