$(function(){var a=new StickerEntity();a.init();});function StickerEntity(){this.count=3;this.hadInit=false;this.enter1=false;this.enter2=false;this.isEdit=false;
this.currentIdVal="fasfasdfasdf";this.isOut=false;this.beforeChange=null;this.isTrashChange=false;this.titleMaxLength=24;this.contentMaxLength=128;}StickerEntity._CONS_={EDIT_URL:ctx+"/gl/task/stickerEntity/edit.htm",DETAIL_URL:ctx+"/gl/task/stickerEntity/detail.htm",DELETE_URL:ctx+"/gl/task/stickerEntity/delete.htm",DELETE_TO_TRASH_URL:ctx+"/gl/task/stickerEntity/updateStickerStatus.htm",SAVE_ADD_URL:ctx+"/gl/task/stickerEntity/saveAdd.htm",SAVE_EDIT_URL:ctx+"/gl/task/stickerEntity/saveEdit.htm",LIST_DATA_URL:ctx+"/gl/task/stickerEntity/listData.htm",UPDATE_SORT_URL:ctx+"/gl/task/stickerEntity/updateStickerSort.htm",EDIT_FORM_ID:"stickerEntityForm",GRID:"#stickerEntityGrid",PAGER:"#stickerEntityPager"};
StickerEntity.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._loadDataList();this._locateToGlHelp();}},_locateToGlHelp:function(){var a="glHelp.tools.tickerEntity";
glHelpUtil.init(a);},getLimitLengthByByte:function(f,e){var g=0;if(f.length<=e/2||this.getByteLength(f)<=e){return f;}var d=0;var b=0;for(var c=0;c<f.length;
c++){b=c;if(f[c].search(/[^\u0000-\u007f]/g)!==-1){d=d+2;g++;}else{d++;}if(d>=e){break;}}var a="";if(d===e){a=f.substr(0,b+1);}else{a=f.substr(0,b);}return a;
},getByteLength:function(a){return a.replace(/[^\u0000-\u007f]/g,"\u0061\u0061").length;},_initSortable:function(){$(".mynotes").sortable({connectWith:".mynotes",placeholder:"hight-light"}).disableSelection();
},_disableSortable:function(){$(".mynotes").sortable("disable").enableSelection();},_enableSortable:function(){$(".mynotes").sortable("enable").disableSelection();
},_editableLiNode:function(d,b){this._disableSortable();var a=d.find("textarea");var c=d.find("input");c.removeAttr("disabled");a.removeAttr("disabled");
if(b=="update"){a.click();a.focus();}else{c.click();c.focus();}if(d==undefined||d==null){d=$("body");}d.find(".sticker-add-task").hide();d.find(".sticker-edit").hide();
d.find(".sticker-save").show();d.find(".sticker-save").removeClass("hidden");this.isEdit=true;d.find("input").addClass("input-title-edit");d.find("textarea").addClass("textarea-content-edit ");
},_disEditableLiNode:function(a){this._enableSortable();$(".newCreate").removeClass("newCreate");if(!a){a=$("body");}if(a==undefined||a==null){a=$("body");
}a.find(".sticker-save").hide();a.find(".sticker-edit").show();a.find(".sticker-add-task").show();this.isEdit=false;a.find("input").removeClass("input-title-edit");
a.find("textarea").removeClass("textarea-content-edit ");},_formatTime:function(c){var b=c;if(c===null||c===undefined){b=new Date();}else{if(!(c instanceof Date)){b=new Date(Date.parse(c));
}}var a=DateUtils.format(b,"MM月dd日(E)HH:mm");a=a.replace("E",DateUtils.getChineseWeeks(b));return a;},_add:function(){var a=this;var c=a._createSticker();
$(".mynotes").prepend(c);var b=$(".newCreate");a._editableLiNode(b,"create");},_edit:function(c,b){var a=this;a._editableLiNode(b,"update");},_createSticker:function(h,b){var o=this;
var c=true;if(h){c=false;}var n=DateUtils.format();var m="";var a="";var j="";var e="";var g="";var k="";var i="newCreate";if(!c){n=h.createTime;m=h.title;
j=h.content;a=h.id;e='disabled="disabled"';g=h.sort;k=h.employeeId;i="";}var d=0;if(g){d=g%4;switch(d){case 0:d=-6;break;case 1:d=2;break;case 2:d=-2;break;
case 3:d=6;break;}}var f="rotate"+d;var l=new StringBuffer();l.append('<li class=" sticker-item '+f+" "+i+'"  employeeId="'+k+'" sort="'+g+'" createTime="'+n+'"  idVal="'+a+'">');
l.append("<div >");l.append("<small>");l.append(o._formatTime(n));l.append("</small>");l.append('<input placeholder="输入标题"  name="title" '+e+' value="'+m+'" type="text" class="input-title"/>');
l.append('<textarea placeholder="输入内容" name="content" '+e+' class="textarea-content" >');l.append(j);l.append("</textarea>");l.append(o._dealOperation(a));
l.append("</div>");l.append("</li>");return l.toString();},_dealOperation:function(c){if(c===undefined||c===null){c="";}var a=(c==="");var b=new StringBuffer();
b.append('<span class="operation-span" >');b.append('<i class="fa fa-check-circle sticker-save operation hidden"></i>');b.append('<i class="fa fa-edit sticker-edit operation" ></i>');
b.append('<i class="fa fa-plus-square sticker-add-task operation hidden" ></i>');b.append('<i class="fa fa-trash sticker-delete operation" ></i>');b.append("</span>");
return b.toString();},_deleteOrRevertTrash:function(d,a){var c=new StringBuffer();c.append("ids=");c.append(d);c.append("&status=");if(!a){c.append("y");
}else{c.append(a);}var b=c.toString();FormUtils.submit(StickerEntity._CONS_.DELETE_TO_TRASH_URL,b,null,null,true);},_loadDataList:function(){var a=this;
FormUtils.loadData(StickerEntity._CONS_.LIST_DATA_URL+"?Q__S__EQ__is_deleted_=n",function(b){var e=b.rows;var f=new StringBuffer();for(var d=0;d<e.length;
d++){var c=e[d];f.append(a._createSticker(c));}$(".mynotes").empty().append(f.toString());a._initSortable();});$(".sticker-item").find(".sticker-save").hide();
},_save:function(d,e,c){var b=this;var a=null;if(e&&e!=null&&e!=""){a=StickerEntity._CONS_.SAVE_EDIT_URL;}else{a=StickerEntity._CONS_.SAVE_ADD_URL;}FormUtils.submit(a,d,function(f){if(f.success){if(f.msgCode==actionCode.CREATE){}else{if(f.msgCode==actionCode.UPDATE){}}c.replaceWith(b._createSticker(JSON.parse(f.msg)));
}else{DialogUtils.error(msgCode.FAIL_MSG,f.msg);}b._disEditableLiNode();},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);b._disEditableLiNode();
},true);},_updateSort:function(b,a){FormUtils.submit(StickerEntity._CONS_.UPDATE_SORT_URL,"id="+b+"&sort="+a,function(c){if(c.success){}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);},true);},_beforeSave:function(c){var j=this;var a=c.attr("idVal");var h=c.find("input").val();
var i=c.attr("createTime");var d=c.find("textarea").val();if(j.getByteLength(h)>j.titleMaxLength){DialogUtils.error(msgCode.ERROR,"标签标题不能超过12个中文或24个英文字符");
$(this).val(j.getLimitLengthByByte(text,j.titleMaxLength));}if(d&&d.length>j.contentMaxLength){DialogUtils.error(msgCode.ERROR,"标签内容超过最大字符数"+j.contentMaxLength+"个(不区分中英)");
return;}var f="n";var b=c.attr("sort");var e=c.attr("employeeId");var g=new StringBuffer();g.append("isDeleted="+f);if(a&&a!=null&&a!=""){g.append("&id="+a);
}g.append("&title="+h);g.append("&createTime="+i);g.append("&content="+d);g.append("&sort="+b);g.append("&employeeId="+e);j._save(g.toString(),a,c);},_createTask:function(h,f){var e="simple";
var c="";var d="";var a="日常任务";var b=h;var g=f;OperateTask.openAddTaskDialogWithTaskName(e,c,a,d,b,g,null);},_loadDeletedList:function(){var a=this;FormUtils.loadData(StickerEntity._CONS_.LIST_DATA_URL+"?Q__S__EQ__is_deleted_=y",function(b){var e=b.rows;
var f=new StringBuffer();for(var d=0;d<e.length;d++){var c=e[d];f.append(a._createDeletedStr(c));}$(".deletedNotes").empty().append(f.toString());});},_createDeletedStr:function(b){var a=this;
var c=new StringBuffer();c.append('<li idVal="'+b.id+'">');c.append("<div >");c.append("<small>");c.append(a._formatTime(b.createTime));c.append("</small>");
c.append("<h4>");c.append('<p class="ellipsis-class" style="font-weight: bold;font-size:16px; ">');c.append(b.title);c.append("</p></h4>");c.append("<p>");
c.append(b.content);c.append("</p>");c.append('<a class="deleted-note-revert" href="javascript:void(0)" style="margin-right:15px;" ><i class="fa fa-undo "></i></a>');
c.append('<a class="deleted-note" href="javascript:void(0)"><i class="fa fa-trash"></i></a>');c.append("</div>");c.append("</li>");return c.toString();
},_clearDeleted:function(){$(".deletedNotes").empty();if(this.isTrashChange){this._loadDataList();this.isTrashChange=false;}},_bindEventHander:function(){var a=this;
$("body").on("click",".stickerEntityAdd",function(){a._add();});$("body").on("keypress","input",function(b){if(b.keyCode==13){return false;}});$("body").on("click",".sticker-delete",function(){var b=$(this).parents(".sticker-item");
var c=b.attr("idVal");$(this).parents(".sticker-item").remove();if(c!==undefined&&c!=null&&c!=""){a._deleteOrRevertTrash(c);}});$("body").on("click",".sticker-edit",function(){var b=$(this).parents(".sticker-item");
a._edit(b.attr("idVal"),b);});$("body").on("dblclick",".sticker-item",function(c){var b=$(this);if(!a.isEdit){a._edit($(this).attr("idVal"),b);}else{}});
$("body").on("click",".sticker-save",function(c){var b=$(this).parents(".sticker-item");a._beforeSave(b);c.stopPropagation();});$("body").on("click",".sticker-add-task",function(){var d=$(this).parents(".sticker-item");
var b=d.attr("idVal");var d=$(".sticker-item[idVal='"+b+"']");var e=d.find("[name=title]").val();var c=d.find("[name=content]").val();a._createTask(e,c);
});$("body").on("mouseenter",".sticker-item",function(){a.currentIdVal=$(this).attr("idVal");a.isOut=false;});$("body").on("mouseleave",".sticker-item",function(){a.isOut=true;
});$("body").on("blur",".sticker-item",function(){if(a.isOut||$(this).attr("idVal")!=a.currentIdVal){a._beforeSave($(this));$(".sticker-save").hide();}});
$("body").on("sortstart",".mynotes",function(b,c){a.beforeChange=$(".sticker-item");});$("body").on("sortupdate",".mynotes",function(g,h){var c=$(".sticker-item");
var f=h.item;var b=a.beforeChange.index(f);var e=c.index(f);var d=null;if(b>e){d=$($(".sticker-item").get(e+1)).attr("sort")+1;}else{d=$($(".sticker-item").get(e-1)).attr("sort")-1;
}f.attr("sort",d);a._updateSort(f.attr("idVal"),f.attr("sort"));});$("body").on("click",".stickerEntityDeletedList",function(){a._showDeletedList();a._loadDeletedList();
});$("body").on("click",".prevBtn",function(){a._showNotes();a._clearDeleted();});$("body").on("click",".deleted-note-revert",function(){var b=$(this).parents("li");
var c=b.attr("idVal");b.remove();if(c!==undefined&&c!=null&&c!=""){a._deleteOrRevertTrash(c,"n");a.isTrashChange=true;}});$("body").on("click",".deleted-note",function(){var b=$(this).parents("li");
var c=b.attr("idVal");if(c!==undefined&&c!=null&&c!=""){a.isTrashChange=true;DialogUtils.confirmWithOptions({title:"您确定要删除该便签吗?",text:"",confirmButtonText:"删除",yesFunc:function(){FormUtils.submit(StickerEntity._CONS_.DELETE_URL,"ids="+c,function(d){if(d.success){b.remove();
}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);},true);}});}});$("body").on("blur",".input-title",function(b){var c=$(this).val();
if(a.getByteLength(c)>a.titleMaxLength){DialogUtils.error(msgCode.ERROR,"标签标题不能超过12个中文或24个英文字符");$(this).val(a.getLimitLengthByByte(c,a.titleMaxLength));
b.preventDefault();b.stopPropagation();$(this).focus();$(this).select();}});$("body").on("input",".textarea-content",function(b){var c=$(this).val();if(c.length>a.contentMaxLength){DialogUtils.error(msgCode.ERROR,"标签内容不能超过最大字符数"+a.contentMaxLength);
$(this).val(c.substr(0,a.contentMaxLength));}});},_showDeletedList:function(){$(".mynotes").addClass("hidden");$(".stickerEntityAdd").addClass("hidden");
$(".stickerEntityDeletedList").addClass("hidden");$(".deletedNotes").removeClass("hidden");$(".prevBtn").show();},_showNotes:function(){$(".deletedNotes").addClass("hidden");
$(".mynotes").removeClass("hidden");$(".stickerEntityDeletedList").removeClass("hidden");$(".stickerEntityAdd").removeClass("hidden");$(".prevBtn").hide();
},};