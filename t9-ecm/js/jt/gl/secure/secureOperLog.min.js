$(function(){var a=new SecureOperLog();a.init();});function SecureOperLog(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}SecureOperLog._CONS_={LIST_DATA_URL:ctx+"/gl/secure/secureOperLog/listData.htm",LIST_USERDATA_URL:ctx+"/gl/securelog/userLog/listData.htm",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",LIST_CONFIG_DATA_URL:ctx+"/gl/secure/secureOperConfig/listData.htm",EDIT_FORM_ID:"secureOperLogForm",GRID:"#secureOperLogGrid",PAGER:"#secureOperLogPager",GRID1:"#userLogGrid",PAGER1:"#userLogPager"};
SecureOperLog.prototype={init:function(e){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._initDate();this._initSelect("operate_type");
this._locateToGlHelp();var b=$(".simple-time-select").parent("div").find(".layer-date");var d=DateUtils.format(DateUtils.getCurrentMonthFirst(),"yyyy-MM-dd");
var c=DateUtils.format(DateUtils.getCurrentMonthLast(),"yyyy-MM-dd");$(b[0]).val(d+" 00:00:00");$(b[1]).val(c+" 23:59:59");var a={lowCreateTime:$("[name=lowCreateTime]").val(),highCreateTime:$("[name=highCreateTime]").val(),Q__S__EQ__user_id_:userId,};
this._initLogJqgrid(a);this._initOperJqgrid();}},_initDate:function(){$("#lowCreateTime").val(DateUtils.getBeforeDate(6)+" 00:00:00");$("#highCreateTime").val(DateUtils.getBeforeDate(0)+" 23:59:59");
$("#currentLogUserId").val(userId);},_locateToGlHelp:function(){var a="glHelp.runtime.operateLog";glHelpUtil.init(a);},_initSelect:function(a){this._buildEmployeeOption("");
this._buildConfigNameOption(a);},_buildEmployeeOption:function(c){var a=this;var b=SecureOperLog._CONS_.EMPLOYEE_LIST_URL+"?groupId="+c+"&type=dept_manager";
var d=a.getQueryVariable("Q__S__EQ__operator_id_");FormUtils.loadData(b,function(f){$("#belongEmployeeSearch").empty();if(f&&f.length>0){var g=new StringBuffer();
g.append("<option value=''>请选择</option>");for(var e=0;e<f.length;e++){if(f[e].id==d){g.append("<option selected value='"+f[e].id+"'>"+f[e].aid+":"+f[e].name+"</option>");
}else{g.append("<option value='"+f[e].id+"'>"+f[e].aid+":"+f[e].name+"</option>");}}$("#belongEmployeeSearch").append(g.toString()).select2();}},null,true);
},_buildConfigNameOption:function(b){var a=SecureOperLog._CONS_.LIST_CONFIG_DATA_URL+"?Q__S__EQ__type_="+b;FormUtils.loadData(a,function(e){var d=e.rows;
$("#configNameSelect").empty();if(d&&d.length>0){var f=new StringBuffer();f.append("<option value=''>请选择</option>");for(var c=0;c<d.length;c++){f.append("<option value='"+d[c].name+"'>"+d[c].name+"</option>");
}$("#configNameSelect").append(f.toString()).select2();}},null,true);},clear:function(c){var a=this;function b(){a._showListWrapper();a.isFormDataChange=false;
a.isEdit=false;$(".form_wrapper .saveBtn").show();FormUtils.clear(SecureOperLog._CONS_.EDIT_FORM_ID);FormUtils.enableForm(SecureOperLog._CONS_.EDIT_FORM_ID);
if(c){a.reloadJqgrid();}}if(a.isEdit&&a.isFormDataChange){DialogUtils.warning(function(){b();});}else{b();}},_bindEventHander:function(){var a=this;$(".secureOperLogSearch").on("click",function(){var b=$("#secureOperLogSearchForm").serialize();
a.reloadOperLogJqgrid(b);});$(".userLogSearch").on("click",function(){var b=$("#userLogForm").serialize();a.reloadUserLogJqgrid(b);});$("#secureOperLogSearchForm").on("keypress",function(b){if(b.keyCode=="13"){$(".secureOperLogSearch").trigger("click");
return false;}});$(".userLogger").on("click",function(){$(this).addClass("active");$(".operLogger").removeClass("active");$("#userLogForm").show();$("#secureOperLogSearchForm").hide();
$("#userLoggerTable").show();$("#operLoggerTable").hide();});$(".operLogger").on("click",function(){$(this).addClass("active");$(".userLogger").removeClass("active");
$("#secureOperLogSearchForm").show();$("#userLogForm").hide();$("#operLoggerTable").show();$("#userLoggerTable").hide();});},reloadOperLogJqgrid:function(a){JTJqgridUtils.reloadJqgrid(SecureOperLog._CONS_.GRID,a);
},reloadUserLogJqgrid:function(a){JTJqgridUtils.reloadJqgrid(SecureOperLog._CONS_.GRID1,a);},_initOperJqgrid:function(b){var a=this;if(b==null||typeof b==undefined){b=$("#secureOperLogSearchForm").serialize();
b+="&Q__S__EQ__operator_id_="+a.getQueryVariable("Q__S__EQ__operator_id_");}$(SecureOperLog._CONS_.GRID).JTJqgrid({url:SecureOperLog._CONS_.LIST_DATA_URL,pager:SecureOperLog._CONS_.PAGER,postData:b,colNames:["操作名称","url(hide)","操作人","部门","时间","关联","关联id(hidden)","关联名称","关联备注"],colModel:[{name:"configName",index:"config_name_",width:100},{name:"url",index:"url_",hidden:true,width:120},{name:"operatorAid",index:"operator_aid_",width:100,formatter:function(e,d,c){return c.operatorAid+" : "+c.operatorName;
}},{name:"groupName",index:"group_id_",width:100},{name:"createTime",index:"create_time_",width:120},{name:"linkShowUnique",index:"link_show_unique_",width:100,},{name:"linkIds",hidden:true,index:"link_ids_",width:120,hidden:true},{name:"linkNames",index:"link_names_",width:120},{name:"linkContents",index:"link_contents_",width:200},]});
},_initLogJqgrid:function(b){var a=this;if(b==null||typeof b==undefined){b={};}$(SecureOperLog._CONS_.GRID1).JTJqgrid({url:SecureOperLog._CONS_.LIST_USERDATA_URL,pager:SecureOperLog._CONS_.PAGER1,postData:b,colNames:["操作者","类型","IP地址","时间","登录分机",],colModel:[{name:"userId",index:"user_id_",width:120,sortable:false,formatter:function(c,d,e){return e.createByAid+":"+e.createByEmpName;
}},{name:"type",index:"type_",width:120,formatter:function(c){if(c=="login"){return"登录";}else{if(c=="logout"){return"退出系统";}}}},{name:"ip",index:"ip_",width:120,},{name:"createTime",index:"create_time_",width:120},{name:"adn",index:"adn_",width:120},]});
},getQueryVariable:function(a){var c=window.location.search.substring(1);var d=c.split("&");for(var b=0;b<d.length;b++){var e=d[b].split("=");if(e[0]==a){return e[1];
}}return"";}};