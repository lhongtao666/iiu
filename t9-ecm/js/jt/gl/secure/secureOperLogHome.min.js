$(function(){var a=new SecureOperLogHome();a.init();});function SecureOperLogHome(){this.hadInit=false;this.soLogIsInit=false;this.empLogIsInit=false;this.secureLogIsInit=false;
this.userLogIsInit=false;this.weixinLogIsInit=false;this.$container=$(".secureHomeContent");this.secureOperLog=new SecureOperLogStat();this.soEntityRefreshTool=new SoEntityRefreshTool();
}SecureOperLogHome._CONS_={LOAD_SOINFO_URL:ctx+"/ec/salesorder/soEntity/seatLoadSoInfo.htm",LIST_CS_DATA_URL:ctx+"/gl/secure/secureOperLog/findCsSecureLog.htm?topNum=10",LIST_SO_DATA_URL:ctx+"/gl/secure/secureOperLog/findSoSecureLog.htm?topNum=10",LIST_EMP_DATA_URL:ctx+"/gl/secure/secureOperLog/findEmpSecureLog.htm?topNum=10",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detailByCode.htm",SO_DETAIL_PAGE_URL:ctx+"/ec/salesorder/soEntity/detail.htm",LIST_WEIXIN_URL:ctx+"/weixin/log/weixinLoginLog/listData.htm",LIST_USERS_URL:ctx+"/crm/ou/employee/listAllData.htm",LIST_WEIXIN_ALL_URL:ctx+"/gl/ou/employeeWeiXin/findAll.htm",};
SecureOperLogHome.prototype={init:function(){var a=this;if(!a.hadInit){a.hadInit=true;a.initHomeData();a._bindEventHanlder();this._locateToGlHelp();this.soEntityRefreshTool.init({callBackFunc:function(){a._reloadTabs();
}});}},initHomeData:function(){this._initListCsData();this._initListWeixinData("secureHomeContent",true);this._initListUserData("secureHomeContent",true);
},_reloadTabs:function(){this.initHomeData();this.secureOperLog.init();this._initListWeixinData("secureHomeContent",true);this._initListUserData("secureHomeContent",true);
},_locateToGlHelp:function(){var a="glHelp.runtime.operateLog";glHelpUtil.init(a);},_bindEventHanlder:function(){var a=this;a.$container.on("click",".secureOperCsLogSearch",function(){var b="csCode="+a.$container.find("input[name=csCode]").val();
a._initListCsData(b);});a.$container.on("click",".secureOperEmpLogSearch",function(){var b="aid="+a.$container.find("input[name=aid]").val();a._initListEmpData(b);
});a.$container.on("click",".secureOperSoLogSearch",function(){var b="soNo="+a.$container.find("input[name=soNo]").val();a._initListSoData(b);});$(document).on("click",".refreshWeixinLog",function(){a._initListWeixinData("weixinLogContent");
});$(document).on("mouseenter",".userLoginCountBtn,.weixinLoginCountBtn",function(){if($(this).attr("countVal")){$(this).text($(this).attr("countVal"));
$(this).attr("isLoginAll","y");}});$(document).on("mouseleave",".userLoginCountBtn,.weixinLoginCountBtn",function(){if($(this).attr("isLoginAll")){$(this).empty().append("<i class='fa fa-check' style='font-size:30px;'></i>");
$(this).removeAttr("isLoginAll");}});a.$container.on("click",".tabli",function(){var b=$(this).attr("id");switch(b){case"csTabLi":a.$container.find(".csSearch").show();
a.$container.find(".soSearch").hide();a.$container.find(".empSearch").hide();break;case"soTabLi":a.$container.find(".csSearch").hide();a.$container.find(".soSearch").show();
a.$container.find(".empSearch").hide();if(!a.soLogIsInit){a._initListSoData();}break;case"empTabLi":a.$container.find(".csSearch").hide();a.$container.find(".soSearch").hide();
a.$container.find(".empSearch").show();if(!a.empLogIsInit){a._initListEmpData();}break;}});$(document).on("click",".homeTabli",function(){var b=$(this).attr("id");
switch(b){case"secureTabLi":if(!a.secureLogIsInit){a.secureOperLog.init();}break;case"weixinTabLi":if(!a.weixinLogIsInit){a._initListWeixinData("weixinLogContent",false);
a.weixinLogIsInit=true;}break;case"userTabLi":if(!a.userLogIsInit){a._initListUserData("userLogContent",false);}break;}});a.$container.on("click",".today",function(){$(this).removeClass("btn-outline");
a.$container.find(".threeDays").addClass("btn-outline");a.$container.find(".sevenDays").addClass("btn-outline");var b="timeDays=today";a._initListCsData(b);
a._initListSoData(b);a._initListEmpData(b);});a.$container.on("click",".threeDays",function(){$(this).removeClass("btn-outline");a.$container.find(".today").addClass("btn-outline");
a.$container.find(".sevenDays").addClass("btn-outline");var b="timeDays=threeDays";a._initListCsData(b);a._initListSoData(b);a._initListEmpData(b);});a.$container.on("click",".sevenDays",function(){$(this).removeClass("btn-outline");
a.$container.find(".threeDays").addClass("btn-outline");a.$container.find(".today").addClass("btn-outline");var b="startTime=sevenDays";a._initListCsData(b);
a._initListSoData(b);a._initListEmpData(b);});a.$container.on("click",".secureOperLogDetail",function(){var b=$(this).attr("logType");var c=$(this).attr("searchValue");
JTTabUtils.addOrRefreshTab(ctx+"/gl/log/secureLog/searchlist.htm?logType="+b+"&searchValue="+c,"安全日志明细");});a.$container.on("click",".csDetail",function(){var c=$(this).attr("name");
var b=$(this).attr("code");if(c.length>4){c="*"+c.substring(c.length-3,c.length);}JTTabUtils.addOrRefreshTab(SecureOperLogHome._CONS_.DETAIL_CS_PAGE_URL+"?csCode="+b,"客户["+c+"]明细");
});a.$container.on("click",".soDetail",function(){var c=$(this).attr("soNo");var d=$(this).attr("name");var b=ResUtils.canShow("mySoEntity.button.showScTrackNo")?"can":"cannot";
JTTabUtils.addOrRefreshTab(SecureOperLogHome._CONS_.SO_DETAIL_PAGE_URL+"?soNo="+c+"&canShowScTrankNo="+b,d?d+"的订单明细":c+"的订单明细");});},_initListWeixinData:function(b,c){var a=this;
if(!c){a.weixinLogIsInit=true;}FormUtils.loadData(SecureOperLogHome._CONS_.LIST_WEIXIN_URL+"?rows=100&page=1",function(d){var f=d.rows;var g=new StringBuffer();
g.append("<table class='table table-striped table-bordered'>");g.append("<tbody>");for(var e=0;e<f.length;e++){if(e>4&&c){break;}g.append("<tr>");g.append("<td>");
g.append("<a href='#'>"+f[e].aid+":"+f[e].employeeName+"</a>   微信号昵称   ");g.append("<span style='color:red;'>"+f[e].nickName+"</span>   于"+f[e].createTime+f[e].type);
g.append("</td>");g.append("</tr>");}g.append("</tbody></table>");$("."+b).find(".weixinLogContentDiv").empty().append(g.toString());});FormUtils.loadData(SecureOperLogHome._CONS_.LIST_WEIXIN_ALL_URL,function(e){var f=0;
for(var d=0;d<e.length;d++){if(e[d].status!=0){f++;}}if(f==e.length){$(".weixinLoginCountBtn").append("<i class='fa fa-check' style='font-size:30px;'></i>");
$(".weixinLoginCountBtn").attr("countVal",f+"/"+e.length);}else{$(".weixinLoginCountBtn").text(f+"/"+e.length);}});},_initListUserData:function(b,c){var a=this;
if(!c){a.userLogIsInit=true;}FormUtils.loadData(SecureOperLogHome._CONS_.LIST_USERS_URL,function(e){var j=new StringBuffer();j.append("<table class='table table-striped table-bordered'>");
j.append("<thead>");j.append("<tr><th>部门</th><th>员工</th></tr>");j.append("</thead>");j.append("<tbody>");var h=new StringBuffer();h.append("<table class='table table-striped table-bordered'>");
h.append("<thead>");h.append("<tr><th>部门</th><th>员工</th></tr>");h.append("</thead>");h.append("<tbody>");var g=0;var f=0;for(var d=0;d<e.length;d++){if(e[d].isOnline=="y"){if(g>4&&c){}else{h.append("<tr>");
h.append("<td>");h.append(e[d].orgName);h.append("</td>");h.append("<td>");h.append("<a href='#'>"+e[d].aid+":"+e[d].name+"</a>");h.append("</td>");h.append("</tr>");
}g++;}else{if(f>4&&c){}else{j.append("<tr>");j.append("<td>");j.append(e[d].orgName);j.append("</td>");j.append("<td>");j.append("<a href='#'>"+e[d].aid+":"+e[d].name+"</a>");
j.append("</td>");j.append("</tr>");}f++;}if(g>4&&f>4&&c){break;}}if(g==e.length){$(".userLoginCountBtn").append("<i class='fa fa-check' style='font-size:30px;'></i>");
$(".userLoginCountBtn").attr("countVal",g+"/"+e.length);}else{$(".userLoginCountBtn").text(g+"/"+e.length);}j.append("</tbody></table>");h.append("</tbody></table>");
$("."+b).find(".userNotLoginLog").empty().append(j.toString());$("."+b).find(".userLoginedLog").empty().append(h.toString());});},_initListCsData:function(b){var a=this;
FormUtils.loadData(SecureOperLogHome._CONS_.LIST_CS_DATA_URL+"&"+b,function(f){var g=new StringBuffer();g.append("<table class='table table-striped table-bordered'>");
g.append("<tbody>");for(var e=0;e<f.length;e++){if(e>10){break;}g.append("<tr>");g.append("<td class='col-sm-10'>");g.append("<a href='#' class='csDetail' code='"+f[e].csCode+"' name='"+f[e].csName+"'>"+f[e].csCode+"："+f[e].csName+"</a>");
g.append("  被操作<span style='color:red;'>"+f[e].count+"</span>次");if(f[e].operEmps&&f[e].operEmps.length>0){g.append("，操作员工");for(var d=0;d<f[e].operEmps.length;
d++){if(d>2){g.append("<strong>......</strong>");break;}if(d==f[e].operEmps.length-1){g.append("<strong>"+f[e].operEmps[d].aid+"："+f[e].operEmps[d].name+"</strong>");
}else{g.append("<strong>"+f[e].operEmps[d].aid+"："+f[e].operEmps[d].name+"、</strong>");}}}for(var c=0;c<f[e].soNos.length;c++){if(f[e].soNos[c]){if(c==0){g.append("，关联订单");
}if(c>2){g.append("<a href='#'>......</a>");break;}if(c==f[e].soNos.length-1){g.append("<a href='#' class='soDetail' soNo='"+f[e].soNos[c]+"' name='"+f[e].csName+"'>"+f[e].soNos[c]+"</a>");
}else{g.append("<a href='#' class='soDetail' soNo='"+f[e].soNos[c]+"' name='"+f[e].csName+"'>"+f[e].soNos[c]+"、</a>");}}}g.append("</td>");g.append("<td class='col-sm-2'><button type='button' class='btn btn-sm btn-outline btn-primary secureOperLogDetail' logType='cs' searchValue='"+f[e].csCode+"'>明细</button></td>");
g.append("</td></tr>");}g.append("</tbody></table>");a.$container.find(".csLogContent").empty().append(g.toString());});},_initListSoData:function(b){var a=this;
a.soLogIsInit=true;FormUtils.loadData(SecureOperLogHome._CONS_.LIST_SO_DATA_URL+"&"+b,function(e){var f=new StringBuffer();f.append("<table class='table table-striped table-bordered'>");
f.append("<tbody>");for(var d=0;d<e.length;d++){if(d>10){break;}f.append("<tr>");f.append("<td class='col-sm-10'>");f.append("<a href='#' class='soDetail' soNo='"+e[d].soNo+"' name='"+e[d].csName+"'>"+e[d].soNo+"</a>");
f.append("  被操作<span style='color:red;'>"+e[d].count+"</span>次");if(e[d].csCode){f.append("，关联客户");f.append("<a href='#' class='csDetail' code='"+e[d].csCode+"' name='"+e[d].csName+"'>"+e[d].csCode+"："+e[d].csName+"</a>");
}if(e[d].operEmps&&e[d].operEmps.length>0){f.append("，操作员工");for(var c=0;c<e[d].operEmps.length;c++){if(c>2){f.append("<strong>......</strong>");break;
}if(c==e[d].operEmps.length-1){f.append("<strong>"+e[d].operEmps[c].aid+"："+e[d].operEmps[c].name+"</strong>");}else{f.append("<strong>"+e[d].operEmps[c].aid+"："+e[d].operEmps[c].name+"、</strong>");
}}}f.append("</td>");f.append("<td class='col-sm-2'><button type='button' class='btn btn-sm btn-outline btn-primary secureOperLogDetail' logType='so' searchValue='"+e[d].soNo+"'>明细</button></td>");
f.append("</td></tr>");}f.append("</tbody></table>");a.$container.find(".soLogContent").empty().append(f.toString());});},_initListEmpData:function(b){var a=this;
a.empLogIsInit=true;FormUtils.loadData(SecureOperLogHome._CONS_.LIST_EMP_DATA_URL+"&"+b,function(f){var g=new StringBuffer();g.append("<table class='table table-striped table-bordered'>");
g.append("<tbody>");for(var e=0;e<f.length;e++){if(e>10){break;}g.append("<tr>");g.append("<td class='col-sm-10'>");g.append("<a href='#'>"+f[e].employeeAid+"</a>");
g.append("  进行操作<span style='color:red;'>"+f[e].count+"</span>次");if(f[e].csEntityPos&&f[e].csEntityPos.length>0){g.append("，操作客户");for(var d=0;d<f[e].csEntityPos.length;
d++){if(d>2){g.append("<a href='#'>......</a>");break;}if(d==f[e].csEntityPos.length-1){g.append("<a href='#' class='csDetail' code='"+f[e].csEntityPos[d].code+"' name='"+f[e].csEntityPos[d].name+"'>"+f[e].csEntityPos[d].code+"："+f[e].csEntityPos[d].name+"</a>");
}else{g.append("<a href='#' class='csDetail' code='"+f[e].csEntityPos[d].code+"' name='"+f[e].csEntityPos[d].name+"'>"+f[e].csEntityPos[d].code+"："+f[e].csEntityPos[d].name+"、</a>");
}}}if(f[e].soNos&&f[e].soNos.length>0){g.append("，关联订单");for(var c=0;c<f[e].soNos.length;c++){if(f[e].soNos[c]){if(c>2){g.append("<a href='#'>......</a>");
break;}if(c==f[e].soNos.length-1){g.append("<a href='#' class='soDetail' soNo='"+f[e].soNos[c]+"'>"+f[e].soNos[c]+"</a>");}else{g.append("<a href='#' class='soDetail' soNo='"+f[e].soNos[c]+"'>"+f[e].soNos[c]+"、</a>");
}}}}g.append("</td>");g.append("<td class='col-sm-2'><button type='button' class='btn btn-sm btn-outline btn-primary secureOperLogDetail' logType='emp' searchValue='"+f[e].employeeAid+"'>明细</button></td>");
g.append("</td></tr>");}g.append("</tbody></table>");a.$container.find(".empLogContent").empty().append(g.toString());});}};