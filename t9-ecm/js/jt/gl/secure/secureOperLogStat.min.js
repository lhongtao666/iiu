$(function(){var a=new SecureOperLogStat();a.init();});function SecureOperLogStat(){this.pageType="cs";this.hadInit=false;this.isEdit=false;this.csLogIsInit=false;
this.soLogIsInit=false;this.empLogIsInit=false;this.logType="secure_type";this.$container=$(".secureLogContent");}SecureOperLogStat._CONS_={DETAIL_URL:ctx+"/gl/secure/secureOperLog/detail.htm",LIST_DATA_URL:ctx+"/gl/log/secureLog/findSecureLogList.htm",LIST_CS_DATA_URL:ctx+"/gl/secure/secureOperLog/findCsSecureLog.htm",LIST_SO_DATA_URL:ctx+"/gl/secure/secureOperLog/findSoSecureLog.htm",LIST_EMP_DATA_URL:ctx+"/gl/secure/secureOperLog/findEmpSecureLog.htm",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",LIST_CONFIG_DATA_URL:ctx+"/gl/secure/secureOperConfig/listData.htm",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detailByCode.htm",SO_DETAIL_PAGE_URL:ctx+"/ec/salesorder/soEntity/detail.htm",TAB_EMP_ID:"#tabEmpLog",TAB_SO_ID:"#tabSoLog",TAB_CS_ID:"#tabCsLog",PAGER:"#secureLogPager",GRID:"#secureLogGrid",};
SecureOperLogStat.prototype={init:function(){if(!this.hadInit){this.hadInit=true;this._initJqgrid();this._bindCommonEventHander();this._initSelect();this._locateToGlHelp();
}},_locateToGlHelp:function(){var a="glHelp.runtime.secureLog";glHelpUtil.init(a);},_initSelect:function(b){var a=this;a._buildEmployeeOption(b);a._buildConfigNameOption(a.logType,b);
},_buildEmployeeOption:function(d,c){var a=this;var b=SecureOperLogStat._CONS_.EMPLOYEE_LIST_URL+"?groupId="+c+"&type=dept_manager";FormUtils.loadData(b,function(f){$("#secureOperLogSearchForm").find("#belongEmployeeSearch").empty();
if(f&&f.length>0){var g=new StringBuffer();g.append("<option value=''>请选择</option>");for(var e=0;e<f.length;e++){g.append("<option value='"+f[e].id+"'>"+f[e].aid+":"+f[e].name+"</option>");
}$("#secureOperLogSearchForm").find("#belongEmployeeSearch").append(g.toString()).select2();}},null,true);},_buildConfigNameOption:function(c,d){var a=this;
var b=SecureOperLogStat._CONS_.LIST_CONFIG_DATA_URL+"?Q__S__EQ__type_="+c;FormUtils.loadData(b,function(g){var f=g.rows;$("#secureOperLogSearchForm").find("#configNameSelect").empty();
if(f&&f.length>0){var h=new StringBuffer();h.append("<option value=''>请选择</option>");for(var e=0;e<f.length;e++){h.append("<option value='"+f[e].name+"'>"+f[e].name+"</option>");
}$("#secureOperLogSearchForm").find("#configNameSelect").append(h.toString()).select2();}},null,true);},_bindCommonEventHander:function(b){var a=this;$("#secureOperLogSearchForm").on("keypress","#secureOperLogSearchForm",function(c){if(c.keyCode=="13"){$(".secureOperLogSearch").trigger("click");
return false;}});$("#secureOperLogSearchForm").on("click",".secureOperLogSearch",function(){var c=$(this).closest("form").serialize();a.reloadJqgrid(c);
});a.$container.on("click",".secureOperLogDetail",function(){var f=$(this).attr("logType");var d=$(this).attr("searchValue");var c=$('#secureOperLogSearchForm input[name="beginDate"]').val();
var e=$('#secureOperLogSearchForm input[name="endDate"]').val();JTTabUtils.addOrRefreshTab(ctx+"/gl/log/secureLog/searchList.htm?logType="+f+"&searchValue="+d+"&beginDate="+c+"&endDate="+e,"安全日志明细");
});a.$container.on("click",".csDetail",function(){var d=$(this).attr("name");var c=$(this).attr("code");if(d.length>4){d="*"+d.substring(d.length-3,d.length);
}JTTabUtils.addOrRefreshTab(SecureOperLogStat._CONS_.DETAIL_CS_PAGE_URL+"?csCode="+c,"客户["+d+"]明细");});a.$container.on("click",".soDetail",function(){var d=$(this).attr("soNo");
var e=$(this).attr("name");var c=ResUtils.canShow("mySoEntity.button.showScTrackNo")?"can":"cannot";JTTabUtils.addOrRefreshTab(SecureOperLogStat._CONS_.SO_DETAIL_PAGE_URL+"?soNo="+d+"&canShowScTrankNo="+c,e?e+"的订单明细":d+"的订单明细");
});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(SecureOperLogStat._CONS_.GRID,a);},_initJqgrid:function(d){var b=this;if(d==null||typeof d==undefined){d={};
}var a=new Date();var c=a.currentDate()+" 00:00:00";$('#secureOperLogSearchForm input[name="beginDate"]').val(c);d={"beginDate":c};$(SecureOperLogStat._CONS_.GRID).JTJqgrid({url:SecureOperLogStat._CONS_.LIST_DATA_URL,pager:SecureOperLogStat._CONS_.PAGER,postData:d,colNames:["操作名称","客户","订单","员工","备注","创建时间"],colModel:[{name:"name",index:"name_",width:100},{name:"csCode",index:"cs_code_",width:80,formatter:function(e,f,g){return"<div><a class='secureOperLogDetail' logType='cs' searchValue='"+g.csCode+"'>"+g.csCode+":"+g.csName+"</a></div>";
}},{name:"soNo",index:"so_no_",width:80,formatter:function(e,f,g){return"<div><a class='secureOperLogDetail' logType='so' searchValue='"+e+"'>"+e+"</a></div>";
}},{name:"employeeId",index:"employee_id_",width:80,formatter:function(e,f,g){if(g.aid){return"<div><a class='secureOperLogDetail' logType='emp' searchValue='"+g.aid+"'>"+g.aid+":"+g.empName+"</a></div>";
}else{return"";}}},{name:"desc",index:"desc_",width:180},{name:"createTime",index:"create_time_",width:80}]});}};