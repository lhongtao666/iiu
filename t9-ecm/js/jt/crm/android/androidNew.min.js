$(function(){var a=new WeiXinChat();a.init();});function WeiXinChat(){this.hadInit=false;this.searchParam="";this.fansInTime="";this.csInfo={};this.weiXinRelated={page:1,total:0,rows:30,status:true,sord:"asc",sidx:"wx.remark_py_",notRead:0,isLoad:false,employeeWeiXin:""};
this.weiXinNotRelated={page:1,total:0,rows:30,status:true,sord:"asc",sidx:"wx.remark_py_",notRead:0,isLoad:false,employeeWeiXin:""};this.weiXinChatForm=new WeiXinChatForm();
this.csFollow=new CsFollow();this.dblTimer=null;this.csPhone=new CsPhone();this.isBind=true;this.employeeWeiXin="";this.lastEmployeeWeiXin="";this.selectAllOnline=1;
this.inputWxlayer="";this.employeeNotRead={};this.draftMsgs={};this.hiddenAlias=false;this.androidCsFollow=new AndroidCsFollow();this.androidCsInfo=new AndroidCsInfo();
this.layer=[];this.minLeft=360;this.androidKmEntity=new AndroidKmEntity();}WeiXinChat._CONS_={LIST_GET_BY_USERNAME:ctx+"/crm/android/getContact.htm",LIST_DATA_URL:ctx+"/crm/android/listData.htm",LIST_RECENT_DATA_URL:ctx+"/crm/android/listRecentData.htm",STATUS_NOTIFY_URL:ctx+"/crm/android/statusNotify.htm",CLEAR_UNREAD_URL:ctx+"/crm/android/clearUnread.htm",TOP_URL:ctx+"/crm/android/toTop.htm",DISTURB_URL:ctx+"/crm/android/disturb.htm",BIND_CS_URL:ctx+"/crm/android/bindCs.htm",RE_BIND_CS_URL:ctx+"/crm/android/rebindCs.htm",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/toEdit.htm",ORDER_PLACE_URL:ctx+"/ec/salesorder/soEntity/place.htm",UPDATE_INFO_URL:ctx+"/crm/android/updateInfo.htm",LIST_BATCH_ADD_URL:ctx+"/crm/cs/csEntity/batchAddAndroidWxCs.htm",FIND_EMPLOYEE_WEIXIN:ctx+"/gl/ou/employeeWeiXin/findByEmployee.htm",GET_EMPLOYEE_WEIXIN:ctx+"/gl/ou/employeeWeiXin/getByAlias.htm",ADD_WEIXIN_URL:ctx+"/gl/cs/weiXinFriends/addWeiXin.htm",ADD_REPEAT_URL:ctx+"/gl/cs/weiXinFriends/addRepeatFuns.htm",CHANGE_REMARK_URL:ctx+"/crm/android/changeRemark.htm",COUNT_FRIEND_URL:ctx+"/gl/cs/weiXinFriends/countWxFriends.htm",BATCH_SEND_URL:ctx+"/crm/cs/weiXinRecord/batchSend.htm",RELOAD_HEADPIC_URL:ctx+"/gl/cs/weiXinFriends/reloadHeadPic.htm",ADD_PHONE_URL:ctx+"/crm/cs/csEntity/addPhone.htm",APPLY_CONTACT_URL:ctx+"/crm/android/passApply.htm",REFRESH_CONTACTS:ctx+"/crm/android/refreshContacts.htm",};
WeiXinChat.prototype={init:function(a){if(!this.hadInit){this._hideNotGrantedBtn();this.hadInit=true;this._initEmployeeWeiXin();this.weiXinChatForm.goToTop=true;
this.weiXinChatForm.init();this._bindEventHander();CsEntityUtils.init();this._initAddr();this._dealStyle();this.androidCsFollow.init();this.androidCsInfo.init();
this.initChatLayer();this.bindLayerEvent();this.androidKmEntity.init();}},_hideNotGrantedBtn:function(){if(!ResUtils.canShow("android.button.viewWx")){this.hiddenAlias=true;
}},initChatLayer:function(){var b=this;if($("body").width()<1330){var e="750px";var a=$("body").width();var d=a;if($("body").height()<750){e=$("body").height()*0.95+"px";
}b.minLeft=260;b.minCenter=400;b.minRight=260;if((d-560)>420&&(d-560)<620){d=d-560-20;}else{if((d-560)>=620){d=600;}else{d=400;}}if((a-600-520-20)>0){a=(a-600-520-20)/2;
}else{a=0;}b.rightLayer=this.chatLayer({top:"2.5%",left:(272+2+d+a)+"px",zIndex:1,width:(260+a)+"px",height:e,skin:"layer-right-list",move:".layer-move-div",content:$(".chat-extra-layer")});
b.centerLayer=this.chatLayer({top:"2.5%",left:(272+a)+"px",zIndex:2,width:d+"px",height:e,skin:"layer-center-list",move:".layer-move-div",content:$(".chat-main-layer")});
b.leftLayer=this.chatLayer({top:"2.5%",left:"10px",zIndex:3,width:(260+a)+"px",height:e,skin:"layer-left-list",move:".layer-move-div",content:$(".chat-list-layer")});
}else{var e="750px";if($("body").height()<750){e=$("body").height()*0.95+"px";}b.minLeft=360;b.minCenter=600;b.minRight=370;var c=($("body").width()-1330)/2;
b.rightLayer=this.chatLayer({top:"2.5%",left:(c+360+600+4)+"px",zIndex:1,width:"370px",height:e,skin:"layer-right-list",move:".layer-move-div",content:$(".chat-extra-layer")});
b.centerLayer=this.chatLayer({top:"2.5%",left:(c+360+2)+"px",zIndex:2,width:"600px",height:e,skin:"layer-center-list",move:".layer-move-div",content:$(".chat-main-layer")});
b.leftLayer=this.chatLayer({top:"2.5%",left:c+"px",zIndex:3,width:"360px",height:e,skin:"layer-left-list",move:".layer-move-div",content:$(".chat-list-layer")});
}},chatLayer:function(b){var a=this;if(b.content){$(b.content).append("<div class='layer-move-div'></div>");}var c=layer.open({type:1,skin:b.skin?b.skin:"",id:b.id?b.id:"",closeBtn:false,title:"",shade:0,fixed:true,anim:1,resize:true,resizing:function(d){a.getMaxIndex();
if($(d).is(".layer-left-list")){$(".layer-left-list").css({"z-index":++maxIndex});}else{if($(d).is(".layer-center-list")){$(".layer-center-list").css({"z-index":++maxIndex});
}else{if($(d).is(".layer-right-list")){$(".layer-right-list").css({"z-index":++maxIndex});}}}if($(d).is(".layer-left-list")){$(d).find(".m-list").height($(d).height()-155);
if($(d).width()<360){$(".sidebar").addClass("sidebar-min");}else{if($(d).width()>=360&&$(".sidebar").is(".sidebar-min")){$(".sidebar").removeClass("sidebar-min");
}}if($(d).width()<a.minLeft){layer.style(a.leftLayer,{width:a.minLeft+"px"});}$(".jt-employee-wx-img").each(function(f,j){var g=$(".sidebar-left").width();
var h=50*(g/60);$(this).parent().css({"transform":"scale("+(g/60)+")","margin-left":((g-h)/2)+"px","left":"-"+(25*(1-(g/60)))+"px"});});}if($(d).is(".layer-right-list")){$("#csinfo-field-binded").height($(".layer-right-list").height()-$("#csinfo-button-field").outerHeight()-$(".detail-info-tab").outerHeight()-40);
}},offset:[(b.top?b.top:"auto"),(b.left?b.left:"auto")],scrollbar:false,zIndex:(b.index||b.index==0)?b.index:1,area:[(b.width?b.width:"500px"),(b.height?b.height:"500px")],move:b.move?b.move:"",moveOut:false,moveEnd:function(d){a.getMaxIndex();
if($(d).is(".layer-left-list")){$(".layer-left-list").css({"z-index":++maxIndex});}else{if($(d).is(".layer-center-list")){$(".layer-center-list").css({"z-index":++maxIndex});
}else{if($(d).is(".layer-right-list")){$(".layer-right-list").css({"z-index":++maxIndex});}}}},content:b.content?b.content:"<h3>面板初始化失败...</h3>",success:function(d,e){a.getMaxIndex();
if($(d).is(".layer-left-list")){if($(d).width()<360){$(d).find(".sidebar").addClass("sidebar-min");}$(d).find(".m-list").height($(d).height()-155);}}});
return c;},getMaxIndex:function(){var b=this;var a=[$(".layer-left-list"),$(".layer-center-list"),$(".layer-right-list")];$.each(a,function(d,f){if($(this).length>0){var c=$(this).css("z-index");
if(c>maxIndex){maxIndex=c;}}});console.log(maxIndex);},bindLayerEvent:function(){var a=this;$(document).on("mousedown",".layui-layer-page",function(b){if($(this).is(".layer-left-list")){$(".layer-left-list").css({"z-index":++maxIndex});
}else{if($(this).is(".layer-center-list")){$(".layer-center-list").css({"z-index":++maxIndex});}else{if($(this).is(".layer-right-list")){$(".layer-right-list").css({"z-index":++maxIndex});
}}}});$(window).on("resize",function(){var b=$("body").height();var e=$("body").width();var c=e;if($("body").width()<=1330){a.minLeft=260;a.minCenter=400;
a.minRight=260;if(b*0.95>=750){b=750;}else{b=b*0.95;}if((e-560)>420&&(e-560)<620){e=e-560-20;}else{if((e-560)>=620){e=600;}else{e=400;}}if((c-600-520-20)>0){c=(c-600-520-20)/2;
}else{c=0;}layer.style(a.leftLayer,{width:(a.minLeft+c)+"px",height:b+"px",left:"10px"});$(".sidebar").addClass("sidebar-min");$(".layer-left-list").find(".m-list").height(b-155);
layer.style(a.centerLayer,{width:e+"px",height:b+"px",left:10+$(".layer-left-list").width()+2+"px"});layer.style(a.rightLayer,{width:(a.minRight+c)+"px",height:b+"px",left:10+$(".layer-left-list").width()+$(".layer-center-list").width()+4+"px"});
$("#csinfo-field-binded").height($(".layer-right-list").height()-$("#csinfo-button-field").outerHeight()-$(".detail-info-tab").outerHeight()-40);}else{a.minLeft=360;
a.minCenter=600;a.minRight=370;if(b*0.95>=750){b=750;}else{b=b*0.95;}var d=($("body").width()-1330)/2;if($(".sidebar").is(".sidebar-min")){$(".sidebar").removeClass("sidebar-min");
}$(".layer-left-list").find(".m-list").height(b-155);layer.style(a.leftLayer,{width:a.minLeft+"px",height:b+"px",left:d+"px"});$(".sidebar").addClass("sidebar-min");
layer.style(a.centerLayer,{width:a.minCenter+"px",height:b+"px",left:d+$(".layer-left-list").width()+2+"px"});layer.style(a.rightLayer,{width:a.minRight+"px",height:b+"px",left:d+$(".layer-left-list").width()+$(".layer-center-list").width()+4+"px"});
$("#csinfo-field-binded").height($(".layer-right-list").height()-$("#csinfo-button-field").outerHeight()-$(".detail-info-tab").outerHeight()-40);}$(".jt-employee-wx-img").each(function(f,j){var g=$(".sidebar-left").width();
var h=50*(g/60);$(this).parent().css({"transform":"scale("+(g/60)+")","margin-left":((g-h)/2)+"px","left":"-"+(25*(1-(g/60)))+"px"});});});},_initEmployeeWeiXin:function(b){var a=this;
a.employeeWeiXin="";FormUtils.loadData(WeiXinChat._CONS_.FIND_EMPLOYEE_WEIXIN+"?employeeId="+currentUserId+"&status=2",function(f){var g=new StringBuffer();
var c=false;for(var e=0;e<f.length;e++){var d=(f[e].headImg==null||f.headImg=="")?("/img/jt/wx/images/head_default.jpg"):f[e].headImg;if(d.indexOf("http://")==-1&&d.indexOf("https://")==-1){d=ctx+d;
}g.append("<div id="+f[e].userName+" class='"+(e==0?"current-opt-employee":"")+"'><div>");g.append("<img onerror='onImageError();' class='jt-employee-wx-img "+(e==0?"on":"")+"' weixin ='"+f[e].userName+"' title='"+f[e].nickName+"' alt='"+f[e].nickName+"' src='"+d+"'>");
g.append("</div></div>");if(e==0){a.employeeWeiXin=f[e].userName;a.lastEmployeeWeiXin=f[e].userName;c=true;}}g.append("<div onerror='onImageError();' id='jt-all-employee-wx'><div><img class='jt-employee-wx-img "+(c?"":"on")+"' weixin ='' title='已关联'  src='"+(currentUserProfile?(ctx+currentUserProfile):(ctx+"/img/jt/logos/t9-green.png"))+"'><div></div>");
if(c){$(".jt-selected-employee-wx-img").attr("src",ImageUtils.getTrueUrl(f[0].headImg)).attr("weixin",f[0].userName).attr("title",f[0].nickName);$(".employee-nickname").empty().append(f[0].nickName);
}else{$(".jt-selected-employee-wx-img").attr("src",(currentUserProfile?(ctx+currentUserProfile):(ctx+"/img/jt/logos/t9-green.png"))).attr("weixin","").attr("title","已关联");
$(".employee-nickname").empty().append("已关联");}a._loadRecentData(true);a.weiXinRelated.page=1;a._loadRelatedData(true);a.weiXinNotRelated.page=1;a._loadNotRelatedData(true);
a._loadNewData(true);$(".my-wexin-list").empty().append(g.toString());$(".my-wexin-list").empty().append(g.toString());$("img.jt-employee-wx-img").load(function(){var h=$(this)[0].naturalWidth/$(this)[0].naturalHeight;
$(this).attr("style",a.imgStyle($(this)[0].naturalWidth,$(this)[0].naturalHeight,50));});g=new StringBuffer();for(var e=0;e<f.length;e++){g.append("<option value='"+f[e].userName+"'>"+f[e].nickName+"</option>");
}g.append("<option value=''>已关联</option>");$("#employeeWeiXins").empty().append(g.toString());g=new StringBuffer();for(var e=0;e<f.length;e++){g.append("<option value='"+f[e].userName+"'>"+f[e].nickName+"</option>");
}$("#batch-send-employeeWeiXins").empty().append(g.toString());a._dealStyle();});},imgStyle:function(b,c,a){if(b>c){return"height:100% !important;left:-"+(a*(1-(c/b)))/2+"px;width:auto !important;";
}else{if(b==c){return null;}else{if(b<c){return"top:-"+(a*(1-(b/c)))/2+"px;";}}}},_getEmployeeWx:function(b){var a=this;FormUtils.loadData(WeiXinChat._CONS_.GET_EMPLOYEE_WEIXIN+"?alias="+b,function(c){if(c){$("#jt-employee-wx").empty().append(c.alias);
$("#jt-employee-wx-nickname").empty().append(c.nickName);}},function(){},true);},_initAddr:function(c,a,b){this.addressService=new AddressService("addressContainer");
this.addressService.init({rowFit:"y",country:c,province:a?a:"",city:b?b:"",area:"",isNotRequired:true});},_initPhone:function(){if(csPhone){$("#csEntityFormForAdd").find('input[name="phoneNum"]').val(csPhone);
$("#csEntityFormForAdd").find("#maskPhoneNum").val(CsEntityUtils.maskPhoneNum(csPhone)).attr("readonly",true);this._getChannel(function(a){CsEntityUtils._initChannelSelect(a.channel);
CsEntityUtils._initInterestsSelect(a.interest);});$(".makePhoneDiv").show();}},_getChannel:function(b){var a=this;FormUtils.loadData(ctx+"/ec/media/mediaChannel/findByPhone.htm?outPhone="+outNum+"&inPhone="+inNum,function(c){var d={};
if(c&&c.length>0&&c[0].id){d.channel=c[0].id;d.interest=c[0].interst;}if(b&&typeof b==="function"){b(d);}});},_fillFollowRecordTab:function(a){var b={csId:this.csInfo.csId,employeeId:currentUserId,entityId:"",csCode:this.csInfo.csCode,needTable:false,followType:"cs",csType:"self",permissionType:"self",isWeixin:true};
this.csFollow.init(b,a,true);this.csFollow._initEmployeeSuggest();},_hideChat:function(){$(".chat-history").hide("fast");setTimeout(function(){$(".main-hide").hide("fast");
if(!$("#infoTabLi").is(".active")){$("#infoTabLi a").trigger("click");}},200);setTimeout(function(){$(".main-show").show();},500);},_loadRelatedData:function(f){var b=this;
var a=window.localStorage.getItem("isWxLoadComplete");var e={};if(a&&a!=""){e=JSON.parse(a);}var d=$("#tabRelated").find(".m-list").find("ul");if(b.employeeWeiXin&&b.employeeWeiXin!=""){if(e&&e[b.employeeWeiXin]=="n"){d.empty().append("<li style='text-align:center'>加载中...</li>");
return;}}var c=WeiXinChat._CONS_.LIST_DATA_URL+"?Q__N__EQ__wx.new_type_=0&isRelated=y&page="+this.weiXinRelated.page+"&rows="+this.weiXinRelated.rows+"&employeeWeixin="+b.employeeWeiXin+"&searchParam="+this.searchParam+"&fansInTime="+this.fansInTime+"&hiddenAlias="+this.hiddenAlias;
if(f){d.empty();}b.weiXinRelated.status=false;FormUtils.loadData(c,function(h){var j=h.rows;b.weiXinRelated.total=h.total;$("#related-total").empty().append(h.records);
$("#related-current").empty().append((b.weiXinRelated.page-1)*(b.weiXinRelated.rows)+j.length);$("#related-total-page").empty().append(h.total);$("#related-current-page").empty().append(b.weiXinRelated.page);
if(j&&j.length){var k=new StringBuffer();for(var g=0;g<j.length;g++){if($("#"+j[g].userName.substring(1,j[g].userName.length)).length>0){continue;}k.append(b._getRelatedLi(j[g]));
}d.append(k.toString());}b.weiXinRelated.status=true;b._addNotReadToTab();},function(){},true);},_loadNotRelatedData:function(f){var b=this;var a=window.localStorage.getItem("isWxLoadComplete");
var e={};if(a&&a!=""){e=JSON.parse(a);}$("#tabNotRelate").find(".m-list").height($("#tabRelated").find(".m-list").height());var d=$("#tabNotRelate").find(".m-list").find("ul");
if(b.employeeWeiXin&&b.employeeWeiXin!=""){if(e&&e[b.employeeWeiXin]=="n"){d.empty().append("<li style='text-align:center'>加载中...</li>");return;}}var c=WeiXinChat._CONS_.LIST_DATA_URL+"?Q__S__EQ__wx.new_type_=friend&isRelated=n&sord=asc&sidx="+this.weiXinNotRelated.sidx+"&page="+this.weiXinNotRelated.page+"&rows="+this.weiXinNotRelated.rows+"&employeeWeixin="+b.employeeWeiXin+"&searchParam="+this.searchParam+"&fansInTime="+this.fansInTime+"&hiddenAlias="+this.hiddenAlias;
if(f){d.empty();}b.weiXinNotRelated.status=false;FormUtils.loadData(c,function(h){var j=h.rows;b.weiXinNotRelated.total=h.total;$("#not-related-total").empty().append(h.records);
$("#not-related-current").empty().append((b.weiXinNotRelated.page-1)*(b.weiXinNotRelated.rows)+j.length);$("#not-related-total-page").empty().append(h.total);
$("#not-related-current-page").empty().append(b.weiXinNotRelated.page);if(j&&j.length){var k=new StringBuffer();for(var g=0;g<j.length;g++){k.append(b._getNotRelateLi(j[g]));
}d.append(k.toString());}b.weiXinNotRelated.status=true;b._addNotReadToTab();b.initCsChat();},function(){},true);},_loadNewData:function(f){var b=this;
var a=window.localStorage.getItem("isWxLoadComplete");var e={};if(a&&a!=""){e=JSON.parse(a);}var d=$("#notFriend").find(".m-list").find("ul");if(b.employeeWeiXin&&b.employeeWeiXin!=""){if(e&&e[b.employeeWeiXin]=="n"){d.empty().append("<li style='text-align:center'>加载中...</li>");
return;}}var c=WeiXinChat._CONS_.LIST_DATA_URL+"?Q__S__EQ__wx.new_type_=apply&page=1&rows=100&employeeWeixin="+b.employeeWeiXin+"&searchParam="+this.searchParam+"&fansInTime="+this.fansInTime+"&hiddenAlias="+this.hiddenAlias;
if(f){d.empty();}FormUtils.loadData(c,function(h){var j=h.rows;$("#not-friend-total").empty().append(h.records);$("#newFriend-not-read").empty();if(h.records>0){$("#newFriend-not-read").append(h.records);
$("#newFriend-not-read").show();}else{$("#newFriend-not-read").hide();}if(j&&j.length){var k=new StringBuffer();for(var g=0;g<j.length;g++){k.append(b._getNewFriendLi(j[g]));
}d.append(k.toString());}},function(){},true);},_loadRecentData:function(d){var a=this;var c=WeiXinChat._CONS_.LIST_RECENT_DATA_URL+"?Q__S__EQ__wx.new_type_=friend&page=1&rows=50&sord=desc&sidx=ext.top_ desc,ext.last_reply_time_&employeeWeixin="+a.employeeWeiXin+"&searchParam="+this.searchParam+"&fansInTime="+this.fansInTime+"&hiddenAlias="+this.hiddenAlias;
var b=$("#tabRecent").find(".m-list").find("ul");if(d){b.empty();a.weiXinRelated.notRead=0;a.employeeNotRead[a.employeeWeiXin]=0;if(a.employeeWeiXin==""){a.employeeNotRead["jt-all-employee-wx"]=0;
}}FormUtils.loadData(c,function(f){$("#recent-total").empty().append(f.length);if(f&&f.length){var g=new StringBuffer();for(var e=0;e<f.length;e++){g.append(a._getRecentLi(f[e]));
}b.append(g.toString());}a._addNotReadToTab();a._addEmpWxUnreadMsg();},function(){},true);},_getNotReadData:function(b){var a=b.unreadCount;if(a>0){if(!this.employeeWeiXin||this.employeeWeiXin==""){if(this.employeeNotRead["jt-all-employee-wx"]){this.employeeNotRead["jt-all-employee-wx"]=this.employeeNotRead["jt-all-employee-wx"]+a;
}else{this.employeeNotRead["jt-all-employee-wx"]=a;}}else{if(this.employeeNotRead[b.employeeAlias]){this.employeeNotRead[b.employeeAlias]=this.employeeNotRead[b.employeeAlias]+a;
}else{this.employeeNotRead[b.employeeAlias]=a;}}this._addNotReadCount(true,a);var c=a;if(c>99){c=99;}return"<span class='badge badge-danger pull-right msg-not-read' data-notread='"+a+"'>"+c+"</span>";
}else{return"";}},_addNotReadToTab:function(){if(this.weiXinRelated.notRead>0){var a=this.weiXinRelated.notRead;if(a>99){a=99;}$("#recent-not-read").empty().append(a).show();
}else{$("#recent-not-read").hide();}},_addNotReadCount:function(b,a){if(b){this.weiXinRelated.notRead+=a;}else{this.weiXinNotRelated.notRead+=a;}},_addWxNotRead:function(a,b){if(this.employeeNotRead[a]){this.employeeNotRead[a]=this.employeeNotRead[a]+b;
}else{this.employeeNotRead[a]=b;}$("#"+a).find(".msg-not-read").remove();if(this.employeeNotRead[a]>0){var c=this.employeeNotRead[a];if(c>99){c=99;}$("#"+a).append("<span class='badge badge-danger pull-right msg-not-read'>"+c+"</span>");
}},_addEmpWxUnreadMsg:function(){var a=$(".my-wexin-list").find("div");for(var b=0;b<a.length;b++){var c=$(a[b]).attr("id");if(this.employeeWeiXin==c){this._addWxNotRead(c,0);
}if(this.employeeWeiXin==""){this._addWxNotRead("jt-all-employee-wx",0);}}},_removeNotRead:function(c,b,a){this._addNotReadCount(c,-b);this._addNotReadToTab();
this._addWxNotRead(a,-b);if(!this.employeeWeiXin||this.employeeWeiXin==""){this._addWxNotRead("jt-all-employee-wx",-b);}FormUtils.submit(WeiXinChat._CONS_.CLEAR_UNREAD_URL,{userName:this.csInfo.userName,employeeAlias:this.csInfo.employeeAlias},function(d){},function(){},true);
},_top:function(c,b,d){var a=this;FormUtils.submit(WeiXinChat._CONS_.TOP_URL,{userName:c,employeeAlias:b,top:d+""},function(f){if(f.success){var e=$("#"+c+"-recent");
e.attr("data-top",d);if(d==1){e.addClass("top");e.remove();$("#tabRecent .m-list ul").prepend(e);}else{e.removeClass("top");if($("#tabRecent .m-list ul").find(".top:last").length>0){e.remove();
$("#tabRecent .m-list ul").find(".top:last").after(e);}}}},function(){},true);},_disturb:function(c,a,b){FormUtils.submit(WeiXinChat._CONS_.DISTURB_URL,{userName:c,employeeAlias:a,disturb:b+""},function(e){if(e.success){var d=$("#"+c+"-recent");
d.attr("data-disturb",b);if(b==1){d.find(".name-span").before("<i class='fa fa-bell-slash-o disturb'></i>");}else{d.find(".disturb").remove();}}},function(){},true);
},_dealStyle:function(){var b=$(".chat-list-layer").height()-160;var c=$("#chat").width();var a=60+300+$(".main-hide").width();if(c<=1380){}else{if(c>1380){}}$(".jt-employee-wx-img").each(function(d,h){var f=$(".sidebar-left").width();
var g=50*(f/60);$(this).parent().css({"transform":"scale("+(f/60)+")","margin-left":((f-g)/2)+"px","left":"-"+(25*(1-(f/60)))+"px"});});},_showChat:function(b){$(".main-show").hide();
$(".main-hide").show("fast");setTimeout(function(){$(".chat-history").css({"left":($(".left-blank").width()+60+300+$(".main-hide").width())+"px"});},250);
setTimeout(function(){$(".chat-history").show("fast");},500);this.weiXinChatForm.record.page=1;this.weiXinChatForm.record.status=false;this.weiXinChatForm.csInfo=this.csInfo;
this.weiXinChatForm.goToTop=true;this.weiXinChatForm.lastChatTime="";this.weiXinChatForm.initChat(b);var a=$(".chat-history").height()-$("#csinfo-button-field").outerHeight()-$(".detail-info-tab").outerHeight();
$("#csinfo-field-binded").height(a-40);},_getDraftMsg:function(){var a=this.csInfo.userName;var b=this.draftMsgs[a];if(b&&b!=""){$("#chat-textarea").html(b.msg);
}var c=this._getId(a)+"-recent";$("#"+c).find(".last-content").show();$("#"+c).find(".draft-content").hide();},_setDraftMsg:function(){var c={};var d=$("#chat-textarea").html();
var b=this.csInfo.userName;if(d&&d!=""){c.typeMsg=this._getDraftTypeMsg(d);c.msg=d;this.draftMsgs[b]=c;var e=this._getId(b)+"-recent";$("#"+e).find(".last-content").hide();
$("#"+e).find(".draft-content").css({"display":"block"});var a=c.typeMsg.length>7?(c.typeMsg.substring(0,6)+"..."):c.typeMsg;$("#"+e).find(".draft-content").empty().append('<span style="color:red;">[草稿]</span>'+a);
}else{c.typeMsg="";c.msg="";this.draftMsgs[b]=c;}},_getDraftTypeMsg:function(a){if(a&&a.trim!=""){if(a.indexOf('type-value="7"')!=-1){return"[文件]";}else{if(a.indexOf('type-value="1"')!=-1){return"[图片]";
}else{return a.replaceAll("&nbsp;"," ");}}}else{return"";}},_bindEventHander:function(){var a=this;$(document).on("click","#show-more-button",function(c){if($("#more-button-div").is(":hidden")){var b=$("body").width()-$(this).offset().left;
var d=$(this).offset().top;$("#more-button-div").css({"top":d,"right":b});$("#more-button-div").show("fast");}else{$("#more-button-div").hide("fast");}});
$(document).on("click","#jt-refresh-contacts",function(){var c=a.employeeWeiXin;var b=WeiXinChat._CONS_.REFRESH_CONTACTS;if(c==""||c==null){DialogUtils.error(msgCode.ERROR,"已关联不可刷新");
return;}FormUtils.submit(b,{employeeAlias:c},function(d){if(d.success){DialogUtils.success(msgCode.SUCCESS,d.msg);}else{DialogUtils.error(msgCode.ERROR,d.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});$("#jt-weixin-newFriend").on("click",function(){var b=$("#jt-reciver-msg").val();
var d=JSON.parse(b);if(d&&d.messageType=="newFriends"){var f=a._getId(d.userName);var e=$("#"+f);if(e&&e.length>0){e.remove();$("#notFriend .m-list ul").prepend(e);
}else{a._loadNewByUserName(d.userName,d.employeeAlias,function(){var g=$("#newFriend-not-read").text();if(!g||g==""||g==null){g=0;}else{g=parseInt(g);}$("#newFriend-not-read").empty().append(g+1);
$("#newFriend-not-read").show();},true);}}else{if(d&&d.messageType=="applyFriends"){var c=$("#newFriend-not-read").text();if(!c||c==""||c==null){c=0;}else{c=parseInt(c);
}c=c-1;$("#newFriend-not-read").empty().append(c);if(c>0){$("#newFriend-not-read").show();}else{$("#newFriend-not-read").hide();}$("#notFriendTabLi").trigger("click");
}}});$(document).on("click",".label-add-friend",function(){var e=$(this).attr("data-applyCode");var b=$(this).attr("data-extra");var c=$(this).attr("data-employeeAlias");
var d=$(this).attr("data-userName");a._applyFriends(d,c,e,b);});$("#chat").on("resize",function(){a._dealStyle();});$(document).on("click",".weiXin-nav-tabs .tabli",function(){if($(this).is("#recentTabLi")){if(a.lastEmployeeWeiXin!=a.employeeWeiXin){a.lastEmployeeWeiXin=a.employeeWeiXin;
a._loadRecentData(true);}}else{if($(this).is("#relatedTabLi")){if(a.weiXinRelated.employeeWeiXin!=a.employeeWeiXin||!a.weiXinRelated.isLoad){a.weiXinRelated.isLoad=true;
a.weiXinRelated.employeeWeiXin=a.employeeWeiXin;a.weiXinRelated.page=1;a._loadRelatedData(true);}}else{if($(this).is("#notRelateTabLi")){if(a.weiXinNotRelated.employeeWeiXin!=a.employeeWeiXin||!a.weiXinNotRelated.isLoad){a.weiXinNotRelated.isLoad=true;
a.weiXinNotRelated.employeeWeiXin=a.employeeWeiXin;a.weiXinNotRelated.page=1;a._loadNotRelatedData(true);}}else{if($(this).is("#notFriendTabLi")){a._loadNewData(true);
}}}}a._hideChat();});$(document).on("click",".m-list li",function(d){var c=this;if($(c).hasClass("new-friend")){return;}var f=$(d.target);if(f.attr("name")=="select"){return;
}if($(c).parents(".contacts-list").length>0){var h=$(c).attr("user-name");var g=$(c).attr("employee-alias");var b=a._getId(h)+"-recent";var j=$("#"+b);
var k=j.length<=0;j.remove();$(".weiXin-nav-tabs").find(".tabli").removeClass("active");$(".weiXin-nav-tabs").find(".tab-pane").removeClass("active");$("#recentTabLi").addClass("active");
$("#tabRecent").addClass("active");a._loadByUserName(h,g,null,function(){$("#"+b).trigger("click");$("#tabRecent").find(".m-list").scrollTop(0);},k);return;
}a._setDraftMsg();var f=$(d.target);if(f.attr("name")=="select"){return;}var g=$(c).attr("employee-alias");var h=$(c).attr("user-name");a.csInfo.employeeAlias=g;
a.csInfo.userName=h;$(".m-list li").removeClass("active");$(c).addClass("active");a._loadData(h,g,function(){a._getDraftMsg();});var i=$(c).find(".msg-not-read");
if(i.length>0){a._removeNotRead(true,parseInt(i.attr("data-notread")),g);i.remove();}$(".jt-close-history").trigger("click");$(".jt-chat-div-for-change").attr("id","jt-chat-"+a._getId(h));
a._updateWeiXinInfo(h,g);if(h&&h.indexOf("@chatroom")!=-1){$("#jt-wx-change-remark").hide();}else{$("#jt-wx-change-remark").show();}});$(document).on("contextmenu","li.recent",function(h){var f=$(this).attr("user-name");
var c=$(this).attr("employee-alias");var g=$(this).attr("data-top");var d=$(this).attr("data-disturb");var b=h.pageX;var i=h.pageY;$("#li-contextmenu").attr("user-name",f);
$("#li-contextmenu").attr("employee-alias",c);$("#li-contextmenu").attr("data-top",g);$("#li-contextmenu").attr("data-disturb",d);$("#li-contextmenu").css({"top":i,"left":b});
if(g==1){$("#jt-weixin-top").empty().append("取消置顶");}else{$("#jt-weixin-top").empty().append("置顶");}if(d==1){$("#jt-weixin-disturb").empty().append("开启提醒");
}else{$("#jt-weixin-disturb").empty().append("免打扰");}$("#li-contextmenu").show();return false;});$("#jt-weixin-top").on("click",function(){var c=$(this).parents("#li-contextmenu").attr("user-name");
var b=$(this).parents("#li-contextmenu").attr("employee-alias");var d=$(this).parents("#li-contextmenu").attr("data-top");a._top(c,b,d==0?1:0);$("#li-contextmenu").hide();
});$("#jt-weixin-disturb").on("click",function(){var d=$(this).parents("#li-contextmenu").attr("user-name");var b=$(this).parents("#li-contextmenu").attr("employee-alias");
var c=$(this).parents("#li-contextmenu").attr("data-disturb");a._disturb(d,b,c==0?1:0);$("#li-contextmenu").hide();});$(document).on("dblclick",".m-list li",function(d){var c=$(this).hasClass("related");
if(!c){return;}var b=$(this).attr("cs-id");JTTabUtils.addOrRefreshTab(WeiXinChat._CONS_.DETAIL_CS_PAGE_URL+"?csId="+b,"客户");});$("#selectAll").on("click",function(){var c=$(this)[0].checked;
var b=$("[name=select]");for(var d=0;d<b.length;d++){b[d].checked=c;}});$(document).on("click","#jt-chat-cs",function(){var b=$(this).attr("cs-id");JTTabUtils.addOrRefreshTab(WeiXinChat._CONS_.DETAIL_CS_PAGE_URL+"?type=self&csId="+b,"客户");
});$(document).on("click","#jt-weixin-reciverBtn2",function(){var c=$("#jt-reciver-msg").val();var d=JSON.parse(c);var f=a._getId(d.userName);if($(".jt-employee-wx-img.on").attr("weixin")!=d.employeeAlias){if(d.type=="in"&&d.relateFlag==1){a._addWxNotRead("jt-all-employee-wx",1);
}if(d.relateFlag==1&&$(".jt-employee-wx-img.on").attr("weixin")==""){}else{if(d.type=="in"){a._addWxNotRead(d.employeeAlias,1);}return;}}var b=f+"-recent";
var i=$("#"+b);if(i&&i.length>0){i.remove();if($("#tabRecent .m-list ul").find(".top").length>0){if(i.hasClass("top")){$("#tabRecent .m-list ul").prepend(i);
}else{$("#tabRecent .m-list ul").find(".top:last").after(i);}}else{$("#tabRecent .m-list ul").prepend(i);}d.lastReplyType=d.contentType;d.lastReplyContent=d.content;
$("#"+b).find(".last-content").empty().append(a._getContent(d));$("#"+f).find(".last-content").empty().append(a._getContent(d));if(d.status==2){$("#"+b).find(".name-span").addClass("jt-is-abnormal");
$("#"+f).find(".name-span").addClass("jt-is-abnormal");}else{$("#"+b).find(".name-span").removeClass("jt-is-abnormal");$("#"+f).find(".name-span").removeClass("jt-is-abnormal");
}if(!i.hasClass("active")&&d.type=="in"){var j=$("#"+b).find(".msg-not-read");if(j.length>0){var h=parseInt(j.attr("data-notread"));var g=h+1;if(g>99){g=99;
}j.empty().append(g).attr("data-notread",h+1);}else{$("#"+b).find(".avatar").after("<span class='badge badge-danger pull-right msg-not-read' data-notread='1'>1</span>");
}a._addNotReadCount(true,1);a._addNotReadToTab();a._addWxNotRead(d.employeeAlias,1);}else{if(d.type=="in"){a._addNotReadCount(true,1);a._addWxNotRead(d.employeeAlias,1);
a._removeNotRead(true,1,d.employeeAlias);}}}else{a._loadByUserName(d.userName,d.employeeAlias,d.type,function(){if(d.type=="in"){a._addNotReadToTab();a._addWxNotRead(d.employeeAlias,0);
}},true);}if(d.contentType=="6"||d.contentType==6){var e=parseInt($("#not-related-total").text())+1;$("#not-related-total").empty().append(e);}});$(document).on("click","#jt-weixin-reloadBtn",function(){var b=$("#jt-weixin-reloadWx").val();
if(b&&b!=null&&b!=""){if(b==a.employeeWeiXin){a._loadRecentData(true);a.weiXinRelated.page=1;a._loadRelatedData(true);a.weiXinNotRelated.page=1;a._loadNotRelatedData(true);
a._loadNewData(true);}}else{a._initEmployeeWeiXin(true);}});$(document).on("click",".sidebar .tabli",function(){$(".m-list li").removeClass("active");});
$(document).on("keyup",".jt-search",function(b){if((b.keyCode==13)){a._search();}});$(document).on("change",".jt-search",function(){var b=$(".jt-search").val();
a.searchParam=b;});$(document).on("click","#jt-weixin-search",function(){a._search();});$("#tabRelated .m-list").scroll(function(){var b=$(this)[0].scrollHeight-$(this).height()-$(this).scrollTop();
if(b<10&&a.weiXinRelated.status&&a.weiXinRelated.page<a.weiXinRelated.total){a.weiXinRelated.status=false;a.weiXinRelated.page=a.weiXinRelated.page+1;a._loadRelatedData();
}});$("#tabNotRelate .m-list").scroll(function(){var b=$(this)[0].scrollHeight-$(this).height()-$(this).scrollTop();if(b<10&&a.weiXinNotRelated.status&&a.weiXinNotRelated.page<a.weiXinNotRelated.total){a.weiXinNotRelated.status=false;
a.weiXinNotRelated.page=a.weiXinNotRelated.page+1;a._loadNotRelatedData();}});$(document).on("click","#jt-bind-cs",function(){a.isBind=true;a._showBindLayer();
});$(document).on("click","#jt-rebind-cs",function(){a.isBind=false;a._showBindLayer();});$(document).on("click","#jt-add-cs",function(){FormUtils.clear("csEntityFormForAdd");
a._showAddLayer(false);});$(document).on("click","#jt-add-cs-place",function(){FormUtils.clear("csEntityFormForAdd");a._showAddLayer(true);});$("#jt-add-cs-batch").on("click",function(){var b=$("input[name='select']:checked");
var g=[];for(var e=0;e<b.length;e++){var f=$(b[e]).attr("user-name");var d=$(b[e]).attr("employee-alias");var c={userName:f,employeeAlias:d};g.push(c);
}if(g.length<=0){DialogUtils.error(msgCode.ERROR,"请选择要添加客户的微信");return;}DialogUtils.confirmWithOptions({title:"您确认要新增"+g.length+"个客户吗？",text:"",confirmButtonText:"确定",yesFunc:function(){a._batchAdd(g);
}});});$(document).on("click","#jt-select-cs",function(){var c={selectedMulti:false,callBack:function(d){if(d!=null){$("#bindCsForm input[name='friendCode']").val(d[0].code);
}},type:"search"};var b=new CustomerSelect();b.init(c);});$(document).on("click","#jt-cs-placeOrder",function(){ConfigUtils.findByKey("soEntityPlace.forbidPlaceOrderTime",function(g){if(g.msg==null){JTTabUtils.addOrRefreshTab(WeiXinChat._CONS_.ORDER_PLACE_URL+"?isAdd=true&isPoint=false&csId="+a.csInfo.csId+"&type=self","["+a.csInfo.csName+"]下订单");
}else{var f=g.msg;var d=f.split("-");if(d.length!=2){DialogUtils.error("提示","禁止下单时段参数格式有误！");return;}var b=d[0].trim();var c=d[1].trim();if(b.length!=5||c.length!=5){DialogUtils.error("提示","禁止下单时段参数格式有误！");
return;}var e=DateUtils.timeRangeJudge(b,c);if(!e){JTTabUtils.addOrRefreshTab(WeiXinChat._CONS_.ORDER_PLACE_URL+"?isAdd=true&isPoint=false&csId="+a.csInfo.csId+"&type=self","["+a.csInfo.csName+"]下订单");
}else{DialogUtils.error("提示","该时段("+g.msg+")禁止下单！");return;}}});});$(document).on("click","#jt-cs-detail",function(){JTTabUtils.addOrRefreshTab(WeiXinChat._CONS_.DETAIL_CS_PAGE_URL+"?csId="+a.csInfo.csId,"客户");
});$(document).on("click",".jt-cs-addFollow",function(){a._fillFollowRecordTab({partyId:currentUserId,partyAid:currentUserAid,partyName:currentUserName});
$("#addFollowBtn").trigger("click");});$(document).on("blur","#maskPhoneNum",function(){var b=$(this).val();var c=$("select[name=phoneType]").val();$("[name=phoneNum]").val(b);
$("#phoneTip").hide();if(b){if(a.csPhone._checkIsPhone(b,c)){a.csPhone.findCsByPhone(b,function(e){if(e&&e.success){var f=JSON.parse(e.msg);var d="号码重复，客户["+f.code+"："+f.name+"]已拥有该号码！";
$("#phoneTip").css("color","red").text(d).show();}else{a.csPhone._getPhoneArea(b,function(g){a._initAddr("ChinaCityCateType-root",g.provinceCateKey,g.cityCateKey);
});}});}else{$("#phoneTip").css("color","red").text("非手机类型请选座机").show();}}});$(document).on("change","[name=phoneType]",function(){$("#maskPhoneNum").trigger("blur");
});$(document).on("change","select[name=province_],select[name=city_],select[name=area_],select[name=town_]",function(){var b="-"+$("select[name=province_] option:selected").text();
if($("select[name=city_]").val()){b+="-"+$("select[name=city_] option:selected").text();}if($("select[name=area_]").val()){b+="-"+$("select[name=area_] option:selected").text();
}if($("select[name=town_]").val()){b+="-"+$("select[name=town_] option:selected").text();}$(".addrDetaileDescribe").text(b);});$("body").on("click",".remove-search-param",function(){$(".jt-search").val("");
a.searchParam="";a._reloadData();});$("#employeeWeiXins").on("change",function(){var b=$(this).val();a.lastEmployeeWeiXin=a.employeeWeiXin;a.weiXinRelated.employeeWeiXin=a.employeeWeiXin;
a.weiXinNotRelated.employeeWeiXin=a.employeeWeiXin;a.employeeWeiXin=b;a._reloadData();$(".jt-employee-wx-img").removeClass("on");if(b==""||b==null){$("#jt-all-employee-wx").find(".jt-employee-wx-img").addClass("on");
}$("#"+b).find(".jt-employee-wx-img").addClass("on");});$("#fans-in-time").on("change",function(){var b=$(this).val();if(b&&b=="today"){a.fansInTime=DateUtils.format(new Date(),"yyyy-MM-dd")+" 00:00:00";
}else{a.fansInTime="";}a._reloadData();});$("body").on("click",".when-has-not-wx",function(){$("input[name='inputWeiXin']").val("[好友无微信号]");});$("body").on("click",".orderByPinyin",function(){$("input[name='orderByPinyin']").trigger("click");
});$("body").on("click",".selectOnLine",function(){$("input[name='selectOnLine']").trigger("click");});$("input[name='selectOnLine']").on("change",function(){var b=$(this)[0].checked;
if(b){a.selectAllOnline=1;}else{a.selectAllOnline="";}a.weiXinRelated.page=1;a.weiXinNotRelated.page=1;a._loadRelatedData(true);a._loadNotRelatedData(true);
});$("input[name='orderByPinyin']").on("change",function(){var b=$(this)[0].checked;if(b){a.weiXinRelated.sord="asc";a.weiXinRelated.sidx="wx.remark_py_";
a.weiXinNotRelated.sord="asc";a.weiXinNotRelated.sidx="wx.remark_py_";}else{a.weiXinRelated.sord="desc";a.weiXinRelated.sidx="ext.last_reply_time_";a.weiXinNotRelated.sord="";
a.weiXinNotRelated.sidx="";}a.weiXinRelated.page=1;a.weiXinNotRelated.page=1;a._loadRelatedData(true);a._loadNotRelatedData(true);});$(document).on("click","#jt-entry-wxcode-batch",function(){var b=$("#employeeWeiXins").val();
JTTabUtils.addOrRefreshTab(ctx+"/gl/cs/weiXinFriends/batchEntryWxCode.htm?type=self&wxCode="+b,"管理微信号");});$(document).on("click","#jt-add-wxCode",function(){var b=a.csInfo.userName;
var c=a._getId(b);a._showInputWxLayer(c);});$("#jt-wx-change-remark").on("click",function(){a._showChangeRemarkLayer();});$(document).on("click",".jt-employee-wx-img",function(){$(".jt-employee-wx-img").removeClass("on");
$(".current-opt-employee").removeClass("current-opt-employee");$(this).addClass("on").parent().parent().addClass("current-opt-employee");var b=$(this).attr("weixin");
$("#employeeWeiXins").val(b);a.lastEmployeeWeiXin=a.employeeWeiXin;a.weiXinRelated.employeeWeiXin=a.employeeWeiXin;a.weiXinNotRelated.employeeWeiXin=a.employeeWeiXin;
a.employeeWeiXin=b;a._reloadData();a._hideChat();$(".jt-selected-employee-wx-img").attr("src",$(this).attr("src")).attr("title",$(this).attr("title")).attr("weixin",$(this).attr("weixin"));
$(".employee-nickname").empty().append($(this).attr("title"));});$("#show-more-button").on("click",function(){if($(".jt-more-button").is(":hidden")){$(".jt-more-button").show();
a._dealStyle();}else{$(".jt-more-button").hide();a._dealStyle();}});$(".jt-goto-send-msg").on("click",function(){var d=a._getId(a.csInfo.userName)+"-recent";
var c=$("#"+d);var b=c.length<=0;c.remove();$(".weiXin-nav-tabs").find(".tabli").removeClass("active");$(".weiXin-nav-tabs").find(".tab-pane").removeClass("active");
$("#recentTabLi").addClass("active");$("#tabRecent").addClass("active");a._loadByUserName(a.userName,a.employeeAlias,null,function(){$("#"+d).trigger("click");
},b);});$("#jt-weixin-barch-send").on("click",function(){JTTabUtils.addOrRefreshTab(ctx+"/crm/android/batchSendAndroidMsg.htm","安卓群发消息");});$(document).on("keydown","#batch-chat-textarea",function(b){var c=$(this).val();
if(b.keyCode==13){if(b.ctrlKey){$(this).val(c+"\r\n");}else{if((c.length<2||c.length>1024)||c.trim().length<1){DialogUtils.error(msgCode.ERROR,"消息长度必须在2-1024范围");
}else{a.sendBatch();}b.cancelBubble=true;b.preventDefault();b.stopPropagation();return false;}}});$(document).on("click",".jt-weixin-batch-sendMsgBtn",function(){var b=$("#batch-chat-textarea").val();
if((b.length<2||b.length>1024)||b.trim().length<1){DialogUtils.error(msgCode.ERROR,"消息长度必须在2-1024范围");return false;}a.sendBatch();});$(document).on("click",".batch-send-label",function(){if($(this).hasClass("batch-send-label-selected")){$(this).removeClass("batch-send-label-selected");
}else{$(this).addClass("batch-send-label-selected");}a._findWxFriendNum();});$("#batch-send-employeeWeiXins").on("change",function(){a._findWxFriendNum();
});$(document).on("contextmenu",".wx-phone",function(){if($(this).parents("small").hasClass("last-content")){return;}var c=$(this).attr("mask-phone");var b=$(this).text();
a._addPhone(c,b);return false;});$(document).on("click",".detail-info-tab li",function(){if($(this).is("#infoTabLi")){var b=$(".chat-history").height()-$("#csinfo-button-field").outerHeight()-$(".detail-info-tab").outerHeight();
$("#csinfo-field-binded").height(b-40);}else{if($(this).is("#csFollowTabLi")){var b=$(".chat-history").height()-$("#follow-button-field").outerHeight()-$(".detail-info-tab").outerHeight();
$("#follow-field").height(b);}else{if($(this).is("#recordTabLi")){var b=$(".chat-history").height()-$(".history-search-button-div").outerHeight()-$(".history-search-param-div").outerHeight()-20;
$(".history-message-box").height(b);}else{}}}});$(document).on("mouseenter",".jt-is-repeat",function(c){$("#jt-weixin-repeat-div").empty().append($(this).attr("data-title"));
var b=$(this).offset().left;var d=$(this).offset().top+5-$("body").height()*0.025;if(d+300>$(document).height()){d=$(document).height()-300;}$("#jt-weixin-repeat-div").css({"top":d,"left":b});
$("#jt-weixin-repeat-div").stop().show("fast");});$(document).on("mouseleave",".jt-is-repeat",function(c){var b=$(this).offset().left;var d=$(this).offset().top+5-$("body").height()*0.025;
if(d+300>$(document).height()){d=$(document).height()-300;}$("#jt-weixin-repeat-div").css({"top":d,"left":b});$("#jt-weixin-repeat-div").stop().hide("fast");
});$("#jt-weixin-repeat-div").hover(function(b){$("#jt-weixin-repeat-div").stop(true,true).show();},function(b){$("#jt-weixin-repeat-div").stop().hide("fast");
});},_addPhone:function(c,a){var b=this;if(b.csInfo.csId==""||b.csInfo.csId==null){DialogUtils.error(msgCode.ERROR,"请先新增或者绑定客户");return;}layer.open({type:1,title:"新增号码",maxmin:false,move:false,scrollbar:false,shadeClose:false,btn:["确定","取消"],area:["650px","450px"],content:$(".jt-wx-add-phone"),success:function(d,e){$("#addPhoneForm input[name='friendCode']").val(b.csInfo.csCode);
$("#addPhoneForm input[name='csName']").val(b.csInfo.csName);$("#addPhoneForm input[name='phone']").val(a);},yes:function(f,d){var e=WeiXinChat._CONS_.ADD_PHONE_URL;
FormUtils.submit(e,{maskPhone:c,phoneType:$("#addPhoneForm select[name=phoneType]").val(),csId:b.csInfo.csId},function(g){if(g.success){DialogUtils.success(msgCode.SUCCESS,"添加号码成功");
layer.close(f);}else{DialogUtils.error(msgCode.ERROR,g.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);},true);},cancel:function(){}});
},_reloadData:function(){var a=this;if($("#recentTabLi").hasClass("active")){a._loadRecentData(true);}else{if($("#relatedTabLi").hasClass("active")){a.weiXinRelated.page=1;
a._loadRelatedData(true);}else{if($("#notRelateTabLi").hasClass("active")){a.weiXinNotRelated.page=1;a._loadNotRelatedData(true);}}}a._loadNewData(true);
},_findWxFriendNum:function(){var a=WeiXinChat._CONS_.COUNT_FRIEND_URL;var c=this._getLabels();var b={employeeWeixin:$("#batch-send-employeeWeiXins").val(),labels:c};
FormUtils.submit(a,b,function(d){if(d.success){$(".batch-send-person-num").empty().append("已选中【"+d.msg+"】位好友");$("#selected-firends").val(d.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
},true);},sendBatch:function(){var a=this;var b={content:encodeURIComponent($("#batch-chat-textarea").val()),contentType:0,labels:a._getLabels(),employeeWeixin:$("#batch-send-employeeWeiXins").val()};
FormUtils.submit(WeiXinChat._CONS_.BATCH_SEND_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.SUCCESS,"消息发送中...");}else{DialogUtils.error(msgCode.ERROR,c.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);},true);},_getLabels:function(){var b=$(".batch-send-label-selected");var c="";for(var a=0;
a<b.length;a++){if(a==0){c=$(b[a]).text();}else{c+=","+$(b[a]).text();}}return c;},_updateWeiXinInfo:function(c,b){var a=this;FormUtils.submit(WeiXinChat._CONS_.UPDATE_INFO_URL,{userName:c,employeeAlias:b},function(d){},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
},true);},_search:function(){var a=this;var b=$(".jt-search").val();a.searchParam=b;if($("#tabRelated").hasClass("active")){a.weiXinRelated.page=1;a._loadRelatedData(true);
}else{if($("#tabNotRelate").hasClass("active")){a.weiXinNotRelated.page=1;a._loadNotRelatedData(true);}else{if($("#notFriend").hasClass("active")){a._loadNewData(true);
}else{a._loadRecentData(true);}}}},_loadData:function(e,d,a){var b=this;var c=WeiXinChat._CONS_.LIST_GET_BY_USERNAME;FormUtils.loadData(c+"?userName="+e+"&employeeAlias="+d+"&hiddenAlias="+this.hiddenAlias,function(f){if(f){$("#jt-wx-bindtime").empty().append(f.bindTime);
$("#jt-wx-passtime").empty().append(f.passTime);}b.csInfo={csCode:f.friendCode,employeeAlias:f.employeeAlias,csId:f.csId,userName:f.userName,headImgUrl:f.userAvaterBig,nickName:f.conRemark,alias:f.alias,wxLabel:f.label,remark:f.conRemark,csName:f.csName,canPlaceSo:f.canPlaceSo,relateFlag:f.relateFlag};
$("#myMenu").show();$("#myMenu").find(".all").show();if(f.relateFlag!=0){$("#chat-person").empty().append("<a id='jt-chat-cs' cs-id='"+f.csId+"'>"+f.friendCode+":"+b._getRegularNickName(f.conRemark)+"</a>");
$("#myMenu").find(".unrelate").hide();if(f.canPlaceSo=="n"){$("#myMenu").find("#jt-cs-placeOrder").hide();}}else{$("#chat-person").empty().append(b._getRegularNickName(f.conRemark));
$("#myMenu").find(".related").hide();}if(e.indexOf("@")!=-1){$("#myMenu").find(".all").hide();}b._showChat();if(a&&typeof a=="function"){a();}b.androidCsInfo.loadCsInfo(f);
b.androidCsFollow.loadCsFollow(f);},function(){},true);},_loadByUserName:function(f,c,e,d,g){var a=this;var b=WeiXinChat._CONS_.LIST_GET_BY_USERNAME;FormUtils.loadData(b+"?userName="+f+"&employeeAlias="+c+"&hiddenAlias="+this.hiddenAlias,function(i){if(i){if($("#tabRecent .m-list ul").find(".top").length<=0||i.top==1){$("#tabRecent .m-list ul").prepend(a._getRecentLi(i));
}else{$("#tabRecent .m-list ul").find(".top:last").after(a._getRecentLi(i));}}if(d&&typeof d=="function"){d();}if(g){var h=parseInt($("#recent-total").text())+1;
$("#recent-total").empty().append(h);}},function(){},true);},_loadNewByUserName:function(e,c,d,f){var a=this;var b=WeiXinChat._CONS_.LIST_GET_BY_USERNAME;
FormUtils.loadData(b+"?userName="+e+"&employeeAlias="+c+"&hiddenAlias="+this.hiddenAlias,function(h){if(h){$("#notFriend .m-list ul").prepend(a._getNewFriendLi(h));
}if(d&&typeof d=="function"){d();}if(f){var g=parseInt($("#not-friend-total").text())+1;$("#not-friend-total").empty().append(g);}},function(){},true);
},_showBindLayer:function(){var a=this;layer.open({type:1,title:a.csInfo.remark+"--绑定客户"+(a.isBind?"":"<span style='color:red;'>注意：不选客户则解绑</span>"),maxmin:false,move:false,scrollbar:false,shadeClose:false,btn:["确定","取消"],area:["650px","450px"],content:$(".jt-wx-bind-cs"),success:function(b,c){if(a.isBind){$(".bind-with-weixin").show();
}else{$(".bind-with-weixin").hide();}$("#bindCsForm input[name='nickName']").val(a.isBind?a.csInfo.remark:a.csInfo.name);$("#bindCsForm input[name='userName']").val(a.csInfo.userName);
$("#bindCsForm input[name='weixin']").val(a.csInfo.alias);$("#bindCsForm input[name='friendCode']").val("");},yes:function(d,b){var e=$("#bindCsForm input[name='userName']").val();
var f=$("#bindCsForm input[name='friendCode']").val();var c=$("#bindCsForm input[name='weixin']").val();a._bindCs(e,f,a.csInfo.employeeAlias,d);},cancel:function(){}});
},_showAddLayer:function(b){var c=this;var a="确定";if(b){a="确定并下单";}layer.open({type:1,title:c.csInfo.remark+'--新增客户<span style="display:none; " id="phoneTip"></span>',maxmin:false,move:false,scrollbar:false,shadeClose:false,btn:[a,"取消"],area:["650px","480px"],content:$(".jt-wx-add-cs"),success:function(d,f){var e=WeiXinChat._CONS_.LIST_GET_BY_USERNAME;
$("#interests").chosen("destroy").chosen();FormUtils.loadData(e+"?userName="+c.csInfo.userName+"&employeeAlias="+c.csInfo.employeeAlias+"&hiddenAlias="+c.hiddenAlias,function(g){if(g){$("#csEntityFormForAdd input[name='name']").val(g.conRemark);
$("#csEntityFormForAdd input[name='friendCode']").val(g.csCode);$("#csEntityFormForAdd input[name='userName']").val(g.userName);$("#csEntityFormForAdd input[name='employeeId']").val(currentUserId);
$("#csEntityFormForAdd input[name='weixin']").val(g.alias);$("#csEntityFormForAdd input[name='employeeAlias']").val(g.employeeAlias);$("#csEntityFormForAdd input[name='type']").val(1);
if(g.sex==1){$("#genderMan").attr("checked",true);$("#genderWomen").attr("checked",false);}else{if(g.sex==2){$("#genderMan").attr("checked",false);$("#genderWomen").attr("checked",true);
}else{$("#genderMan").attr("checked",false);$("#genderWomen").attr("checked",false);}}if(g.srcs){$("#srcs").val(g.srcs);}}});},yes:function(e,d){if(isBizType=="y"){var f=$("#bizType").val();
if(!(f&&f!="")){DialogUtils.error(msgCode.ERROR,"请填写客户分类");return;}}if(isChannel=="y"){var g=$("#srcs").val();if(!(g&&g!="")){DialogUtils.error(msgCode.ERROR,"请填写渠道来源");
return;}}c._saveAdd(e,b);},cancel:function(e,d){}});},_showInputWxLayer:function(b){var a=this;if(a.inputWxlayer!=""){layer.close(a.inputWxlayer);a.inputWxlayer="";
}layer.open({type:1,title:a.csInfo.remark+"--输入微信号",maxmin:false,move:false,scrollbar:false,shadeClose:false,btn:["确定","取消"],area:["400px","300px"],content:$(".jt-wx-input-pane"),success:function(c,d){a.inputWxlayer=d;
$("input[name='inputWeiXin']").val(a.csInfo.wxCode);},yes:function(d,c){a._addWeiXin(b);},cancel:function(){a.inputWxlayer="";}});},_applyFriends:function(e,c,d,b){var a=WeiXinChat._CONS_.APPLY_CONTACT_URL;
FormUtils.submit(a,{userName:e,employeeAlias:c,applyCode:d,extra:b},function(f){DialogUtils.success("提示","已提交通过好友");},function(){DialogUtils.error("错误","后台异常，请稍后重试");
});},_showChangeRemarkLayer:function(){var a=this;if(a.inputWxlayer!=""){layer.close(a.inputWxlayer);a.inputWxlayer="";}layer.open({type:1,title:a.csInfo.remark+"--修改备注",maxmin:false,move:false,scrollbar:false,shadeClose:false,btn:["确定","取消"],area:["400px","300px"],content:$(".jt-wx-remark-pane"),success:function(b,c){$("input[name='inputRemark']").val(a.csInfo.remark);
},yes:function(c,b){a._changeRemark(c);},cancel:function(){}});},_showBatchSendLayer:function(){var a=this;layer.open({type:1,title:"群发",maxmin:false,move:false,scrollbar:false,shadeClose:false,area:["650px","450px"],content:$(".jt-wx-batch-send"),success:function(b,c){$("#batch-chat-textarea").focus();
a._findWxFriendNum();},yes:function(c,b){},cancel:function(){}});},_changeRemark:function(c){var b=this;var a=WeiXinChat._CONS_.CHANGE_REMARK_URL;var d=$("input[name='inputRemark']").val();
if(!d||d==""||d==null){DialogUtils.error("提示","请输入备注");return;}FormUtils.submit(a,{employeeAlias:b.csInfo.employeeAlias,remark:encodeURIComponent(d),userName:b.csInfo.userName},function(e){if(e.success){DialogUtils.success("提示","修改备注成功");
layer.close(c);var f=b._getId(b.csInfo.userName);$("#"+f).find(".name-span").empty().append(b.csInfo.relateFlag==1?b._getRegularName(e.msg):b._getRegularNickName(e.msg));
$("#"+f+"-recent").find(".name-span").empty().append(b._getRegularNickName(e.msg));if(b.csInfo.relateFlag==1){$("#chat-person").empty().append("<a id='jt-chat-cs' cs-id='"+b.csInfo.csId+"'>"+b.csInfo.csCode+":"+b._getRegularNickName(e.msg)+"</a>");
}else{$("#chat-person").empty().append(b._getRegularNickName(e.msg));}b.csInfo.remark=d;}else{DialogUtils.error("失败",e.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");
});},_addWeiXin:function(d){var b=this;var a=WeiXinChat._CONS_.ADD_WEIXIN_URL;var c=$("input[name='inputWeiXin']").val();if(!c||c==""||c==null){DialogUtils.error("提示","请输入微信号");
return;}FormUtils.submit(a,{userName:b.csInfo.userName,weiXin:c},function(f){layer.close(b.inputWxlayer);b.inputWxlayer="";if(f.success){DialogUtils.success("提示","输入成功");
var e={wxCode:c};if($("#"+d).find(".has-in-weixin").length<=0){$("#"+d).find(".name-span").after('<span class="has-in-weixin" title="'+b._getWeiXinForTitle(e)+'">[微]</span>');
}if($("#"+d+"-recent").find(".has-in-weixin").length<=0){$("#"+d+"-recent").find(".name-span").after('<span class="has-in-weixin" title="'+b._getWeiXinForTitle(e)+'">[微]</span>');
}if($("#"+d).find(".jt-is-repeat").length>0){$("#"+d).find(".jt-is-repeat").remove();}if($("#"+d+"-recent").find(".jt-is-repeat").length>0){$("#"+d+"-recent").find(".jt-is-repeat").remove();
}$("#"+d).attr("wx-code",c);$("#"+d+"-recent").attr("wx-code",c);b.csInfo.hasInline=true;b.csInfo.wxCode=c;}else{DialogUtils.confirmWithOptions({title:f.msg+"。确定保存吗？",text:"",confirmButtonText:"确定",yesFunc:function(){b._addRepeatFuns(d,c,f.msg);
}});}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});},_addRepeatFuns:function(e,d,c){var b=this;var a=WeiXinChat._CONS_.ADD_REPEAT_URL;FormUtils.submit(a,{userName:b.csInfo.userName,weiXin:d,repeatComment:encodeURIComponent(c)},function(g){if(g.success){var f={wxCode:d};
DialogUtils.success("提示",g.msg);if($("#"+e).find(".has-in-weixin").length<=0){$("#"+e).find(".name-span").after('<span class="has-in-weixin" title="'+b._getWeiXinForTitle(f)+'">[微]</span>');
}if($("#"+e+"-recent").find(".has-in-weixin").length<=0){$("#"+e+"-recent").find(".name-span").after('<span class="has-in-weixin" title="'+b._getWeiXinForTitle(f)+'">[微]</span>');
}if($("#"+e).find(".jt-is-repeat").length<=0){$("#"+e).find(".has-in-weixin").after("<span class='jt-is-repeat' title='"+c+"' >[重]</span>");}if($("#"+e+"-recent").find(".jt-is-repeat").length<=0){$("#"+e+"-recent").find(".has-in-weixin").after("<span class='jt-is-repeat' title='"+c+"' >[重]</span>");
}$("#"+e).attr("wx-code",d);$("#"+e+"-recent").attr("wx-code",d);b.csInfo.hasInline=true;b.csInfo.wxCode=d;}else{DialogUtils.error("错误",g.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");
});},_saveAdd:function(d,b){var c=this;var a=ctx+"/crm/cs/csEntity/saveAdd.htm";var e=$("#csEntityFormForAdd").serialize();FormUtils.submit(a,e,function(f){if(f.success){DialogUtils.success("提示","新增成功");
layer.close(d);c.searchParam="";c.weiXinNotRelated.page=1;c._loadNotRelatedData(true);c.weiXinRelated.page=1;c._loadRelatedData(true);c._loadRecentData(true);
if(b){ConfigUtils.findByKey("soEntityPlace.forbidPlaceOrderTime",function(n){if(n.msg==null){var k=f.msg;if(k){var j=$("#chat-person").text();JTTabUtils.addOrRefreshTab(WeiXinChat._CONS_.ORDER_PLACE_URL+"?isAdd=true&isPoint=false&csId="+k+"&type=self","["+j+"]下订单");
}return;}else{if(n.msg!=null&&n.msg.trim()==""){var k=f.msg;if(k){var j=$("#chat-person").text();JTTabUtils.addOrRefreshTab(WeiXinChat._CONS_.ORDER_PLACE_URL+"?isAdd=true&isPoint=false&csId="+k+"&type=self","["+j+"]下订单");
}return;}var m=n.msg;var i=m.split("-");if(i.length!=2){DialogUtils.error("提示","禁止下单时段参数格式有误！");return;}var g=i[0].trim();var h=i[1].trim();if(g.length!=5||h.length!=5){DialogUtils.error("提示","禁止下单时段参数格式有误！");
return;}var l=DateUtils.timeRangeJudge(g,h);if(!l){var k=f.msg;if(k){var j=$("#chat-person").text();JTTabUtils.addOrRefreshTab(WeiXinChat._CONS_.ORDER_PLACE_URL+"?isAdd=true&isPoint=false&csId="+k+"&type=self","["+j+"]下订单");
}return;}else{DialogUtils.error("提示","该时段("+n.msg+")禁止下单！");return;}}});}}else{DialogUtils.error("失败",f.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");
});},_bindCs:function(e,f,d,c){var a=this;var b=a.isBind?WeiXinChat._CONS_.BIND_CS_URL:WeiXinChat._CONS_.RE_BIND_CS_URL;FormUtils.submit(b,{userName:e,friendCode:f,employeeAlias:d},function(g){if(g.success){DialogUtils.success(msgCode.SUCCESS,g.msg);
layer.close(c);a.searchParam="";a.weiXinNotRelated.page=1;a._loadNotRelatedData(true);a.weiXinRelated.page=1;a._loadRelatedData(true);a._loadRecentData(true);
a._hideChat();}else{DialogUtils.error(msgCode.ERROR,g.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},_batchAdd:function(b){var a=this;
FormUtils.submit(WeiXinChat._CONS_.LIST_BATCH_ADD_URL,{userNames:JSON.stringify(b)},function(c){if(c.success){DialogUtils.success(msgCode.SUCCESS,c.msg);
a.searchParam="";a.weiXinNotRelated.page=1;a._loadNotRelatedData(true);a.weiXinRelated.page=1;a._loadRelatedData(true);}else{DialogUtils.error(msgCode.ERROR,c.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},_getRelatedLi:function(a,d){if(a.userName==""||a.userName==null){return"";}var c=this._getId(a.userName);
if($("#"+c).length>0&&$("#"+c).hasClass("related")){return"";}var b=new StringBuffer();b.append("<li class='related' id='"+c+"'").append(" user-name='"+a.userName+"'").append(" employee-alias='"+a.employeeAlias+"'>").append("<div class='jt-head-pic-div'>").append("<img onerror='onImageError();' class='avatar  "+(a.status=="0"?"gray":"")+"' src-val='"+this._getHeadImgUrl(a.userAvatarSmall)+"' src='"+this._getHeadImgUrl(a.userAvatarSmall)+"'>");
b.append("</div>");b.append("<p class='name'><span class='name-span'>"+this._getRegularName(a.conRemark)+"</span>"+this._getRepeat(a)+this._getSex(a)+"<br><small  class='last-content'>"+this._getContent(a)+"</small></p>");
b.append("</li>");return b.toString();},_getRecentLi:function(a,d){if(a.userName==""||a.userName==null){return"";}var c=this._getId(a.userName)+"-recent";
if($("#"+c).length>0){return"";}var b=new StringBuffer();b.append("<li class='recent "+(a.top==1?"top":"")+"' id='"+c+"' ").append(" user-name='"+a.userName+"'").append(" data-top='"+a.top+"'").append(" data-disturb='"+a.disturb+"'").append(" user-name='"+a.userName+"'").append(" employee-alias='"+a.employeeAlias+"'>").append("<div class='jt-head-pic-div'>").append("<img onerror='onImageError();' class='avatar "+(a.status=="0"?"gray":"")+"' src-val='"+this._getHeadImgUrl(a.userAvatarSmall)+"' src='"+this._getHeadImgUrl(a.userAvatarSmall)+"'>");
if(d){b.append("<span class='badge badge-danger pull-right msg-not-read' data-notread='1'>1</span>");}else{b.append(this._getNotReadData(a));}b.append("</div>");
b.append("<p class='name'> <span class='name-span' >"+this._getRegularNickName(a.conRemark)+"</span>"+this._getRepeat(a)+this._getSex(a)+this._getDisturb(a)+"<br><small class='last-content'>"+this._getContent(a)+"</small><small class='draft-content'></small><small>"+this._getIsRelated(a)+"</small></p>");
b.append("</li>");return b.toString();},_getHeadImgUrl:function(a){if(a&&a.indexOf("http://")==-1&&a.indexOf(ctx)==-1){a=ctx+a;}return a;},_getDisturb:function(a){if(a.disturb){return"<i class='fa fa-bell-slash-o disturb'></i>";
}return"";},_getNotRelateLi:function(a,d){if(a.userName==""||a.userName==null){return"";}var c=this._getId(a.userName);if($("#"+c).length>0&&$("#"+c).hasClass("not-related")){return"";
}var b=new StringBuffer();b.append("<li class='not-related' id='"+c+"' ").append(" user-name='"+a.userName+"'").append(" employee-alias='"+a.employeeAlias+"'>");
b.append("<div class='jt-head-pic-div'>").append("<img class='avatar' onerror='onImageError();' src-val='"+this._getHeadImgUrl(a.userAvatarSmall)+"' src='"+this._getHeadImgUrl(a.userAvatarSmall)+"'>");
b.append("</div>");b.append("<p class='name'> <span class='name-span'>"+this._getRegularNickName(a.conRemark)+"</span>"+""+this._getRepeat(a)+this._getSex(a)+"<br><small class='last-content'>"+this._getContent(a)+"</small><small>"+this._getQun(a)+"</small></p>");
b.append("</li>");return b.toString();},_getNewFriendLi:function(a){var b=new StringBuffer();b.append("<li class='new-friend' id='"+a.id+"' ").append(" user-name='"+a.userName+"'").append(" employee-alias='"+a.employeeAlias+"'>");
b.append("<div class='jt-head-pic-div'>").append("<img class='avatar' onerror='onImageError();' src-val='"+this._getHeadImgUrl(a.userAvatarSmall)+"' src='"+this._getHeadImgUrl(a.userAvatarSmall)+"'>");
b.append("</div>");if(a.newType=="add"){b.append("<p class='name'> <span class='name-span'>发出申请："+a.alias+"</span>");}else{if(a.newType=="apply"){b.append("<p class='name'> <span class='name-span'>"+a.conRemark+"</span><br><small class='last-content'>"+this._getContent(a)+"</small><small>"+this._getAddButtun(a)+"</small");
}}b.append("</li>");return b.toString();},_getSex:function(a){if(a.userName.indexOf("@@")!=-1){return"";}if(!a.sex){return"";}if(a.sex==1){return"<i class='web_wechat_men' title='男'></i>";
}else{if(a.sex==2){return"<i class='web_wechat_women' title='女'></i>";}else{return"";}}},_getRepeat:function(b){var a=this;if(b.isRepeat==1){return"<span class='jt-is-repeat'  data-title='"+a._bulidRepeatComment(b.repeatComment)+"' >[重]</span>";
}else{return"";}},_bulidRepeatComment:function(d){title='" +data.repeatComment+ "';var a=this;var b=d.split(";");var d="";for(var c=0;c<b.length;c++){d+=b[c].replaceAll("'","&#39;").replaceAll('"',"&quot;")+" \n";
}return d;},_getContent:function(a){return WeiXinUtil.changeTypeToCN(a);},_getQun:function(a){if(a.userName.indexOf("@@")!=-1){return"<label class='label-qun'>群</label>";
}else{return"";}},_getIsRelated:function(a){if(a.userName.indexOf("@")!=-1){return"<label class='label-qun'>群</label>";}else{if(a.relateFlag==0){return"<label class='label-not-related'>新朋友</label>";
}else{return"";}}},_getAddButtun:function(a){return"<label data-userName='"+a.userName+"' data-employeeAlias='"+a.employeeAlias+"' data-applyCode='"+JSON.stringify(a.lastReplyContent)+"' data-extra='' class='label-add-friend'>接受</label>";
},_getIsAbnormal:function(a){if(a==1){return"jt-is-abnormal";}else{return"";}},_getPassOrBindTime:function(a){var b="";if(a.relateFlag==0){b=a.passTime;
}else{b=a.bindTime;}if(b==null||b==""){return"";}else{return DateUtils.format(new Date(b),"MM-dd").replaceAll("-","");}},_getRegularName:function(a){return a;
},_getRegularNickName:function(a){return a;},_getRemart:function(a){if(a.alias&&a.alias!=null&&a.alias!=""&&ResUtils.canShow("android.button.viewWx")){return"<span class='has-in-weixin' title='"+this._getWeiXinForTitle(a)+"' >[微]</span>";
}else{return"";}},_getStatus:function(a){if(a.status&&a.status=="1"){return" ";}else{return"<span class='has-not-inline-weixin' >[离]</span>";}},_getWeiXinForTitle:function(a){if(true){return a.alias?("微信号："+a.alias):"";
}else{return"";}},_getId:function(a){if(a.indexOf("@")!=-1){a=a.replaceAll("@","-qun-");}return a;},initCsChat:function(){if(isGZHChat&&isGZHChat=="y"){$("#"+openCsChat).trigger("click");
}},};(function(n,p,u){var w=n([]),s=n.resize=n.extend(n.resize,{}),o,l="setTimeout",m="resize",t=m+"-special-event",v="delay",r="throttleWindow";s[v]=250;
s[r]=true;n.event.special[m]={setup:function(){if(!s[r]&&this[l]){return false;}var a=n(this);w=w.add(a);n.data(this,t,{w:a.width(),h:a.height()});if(w.length===1){q();
}},teardown:function(){if(!s[r]&&this[l]){return false;}var a=n(this);w=w.not(a);a.removeData(t);if(!w.length){clearTimeout(o);}},add:function(b){if(!s[r]&&this[l]){return false;
}var c;function a(d,h,g){var f=n(this),e=n.data(this,t);e.w=h!==u?h:f.width();e.h=g!==u?g:f.height();c.apply(this,arguments);}if(n.isFunction(b)){c=b;return a;
}else{c=b.handler;b.handler=a;}}};function q(){o=p[l](function(){w.each(function(){var d=n(this),a=d.width(),b=d.height(),c=n.data(this,t);if(a!==c.w||b!==c.h){d.trigger(m,[c.w=a,c.h=b]);
}});q();},s[v]);}})(jQuery,this);