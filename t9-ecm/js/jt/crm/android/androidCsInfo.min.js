function AndroidCsInfo(){this.hadInit=false;this.addrs=[];this.addrIndex=0;this.orders=[];this.orderIndex=0;}AndroidCsInfo._CONS_={GET_EMPLOYEE_WEIXIN:ctx+"/gl/ou/employeeWeiXin/getByAlias.htm",LOAD_CS_DETAIL_URL:ctx+"/crm/cs/csEntity/edit.htm",LOAD_CS_PHONE_URL:ctx+"/crm/cs/csEntity/findPhonesByCsId.htm",LOAD_CS_ADDR_URL:ctx+"/crm/cs/csEntity/addr/partyAddrListData.htm",LOAD_CS_ORDER_URL:ctx+"/ec/salesorder/soEntity/findByCsId.htm",SO_DETAIL_PAGE_URL:ctx+"/ec/salesorder/soEntity/detail.htm",GET_ORDER_INFO:ctx+"/ec/salesorder/soEntity/getSoEntityInfo.htm",};
AndroidCsInfo.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._hideNotGrantedBtn();this._bindEventHander();}},_hideNotGrantedBtn:function(){},_bindEventHander:function(){var a=this;
$(document).on("click",".jt-addr-right.has",function(){a.addrIndex=a.addrIndex+1;if(a.addrIndex+1>=a.addrs.length){$(".jt-addr-right").removeClass("has");
}$(".jt-addr-left").addClass("has");a._getAddr(a.addrs,a.addrIndex);});$(document).on("click",".jt-addr-left.has",function(){a.addrIndex=a.addrIndex-1;
if(a.addrIndex<=0){$(".jt-addr-left").removeClass("has");}$(".jt-addr-right").addClass("has");a._getAddr(a.addrs,a.addrIndex);});$(document).on("click",".jt-so-right.has",function(){if($(".weixin-csinfo-big-clone").length==0){$(".weixin-csinfo-big").clone(true).addClass("weixin-csinfo-big-clone").css({"left":$(".jt-so-left").width()-$(".weixin-csinfo-big").width()}).insertBefore(".weixin-csinfo-big");
}$(".weixin-csinfo-big").eq(1).stop(true,true).animate({"margin-left":$(".jt-so-left").width()+$(".weixin-csinfo-big").width()},"fast",function(){$(this).remove();
});$(".weixin-csinfo-big-clone").stop(true,true).animate({"left":$(".jt-so-left").width()},"fast",function(){$(this).removeClass("weixin-csinfo-big-clone").removeAttr("style");
});a.orderIndex=a.orderIndex+1;if(a.orderIndex+1>=a.orders.length){$(".jt-so-right").removeClass("has");}$(".jt-so-left").addClass("has");a._getOrder(a.orders,a.orderIndex);
if($(".weixin-order-btn").is(".weixin-order-btn-active")){$(".weixin-order-btn").stop().animate({"bottom":"-45px"},"fast").removeClass("weixin-order-btn-active");
$("#jt-cs-so-div").css({"padding-bottom":"10px"});}});$(document).on("click",".jt-so-left.has",function(){if($(".weixin-csinfo-big-clone").length==0){$(".weixin-csinfo-big").clone(true).addClass("weixin-csinfo-big-clone").css({"left":$(".jt-so-left").width()+$(".weixin-csinfo-big").width()}).insertBefore(".weixin-csinfo-big");
}$(".weixin-csinfo-big").eq(1).stop(true,true).animate({"margin-left":$(".jt-so-left").width()-$(".weixin-csinfo-big").width()},"fast",function(){$(this).remove();
});$(".weixin-csinfo-big-clone").stop(true,true).animate({"left":$(".jt-so-left").width()},"fast",function(){$(this).removeClass("weixin-csinfo-big-clone").removeAttr("style");
});a.orderIndex=a.orderIndex-1;if(a.orderIndex<=0){$(".jt-so-left").removeClass("has");}$(".jt-so-right").addClass("has");a._getOrder(a.orders,a.orderIndex);
if($(".weixin-order-btn").is(".weixin-order-btn-active")){$(".weixin-order-btn").stop().animate({"bottom":"-45px"},"fast").removeClass("weixin-order-btn-active");
$("#jt-cs-so-div").css({"padding-bottom":"10px"});}});$(document).on("dblclick",".jt-so-left.has",function(){});$(document).on("dblclick",".jt-so-right.has",function(){});
$(document).on("click",".weixin-csinfo-big,.weixin-csinfo-big *",function(b){if($(b.target).is(".jt-order-number")){return false;}if(!$(".weixin-order-btn").is(".weixin-order-btn-active")){$(".weixin-order-btn").stop().animate({"bottom":"0"},"fast").addClass("weixin-order-btn-active");
$("#jt-cs-so-div").css({"padding-bottom":"45px"});}});$(document).on("click",".weixin-order-btn",function(b){if($(".weixin-order-btn").is(".weixin-order-btn-active")&&!$(b.target).is("button,button *")){$(".weixin-order-btn").stop().animate({"bottom":"-45px"},"fast").removeClass("weixin-order-btn-active");
$("#jt-cs-so-div").css({"padding-bottom":"10px"});}});$(document).on("click",".orderBasicInfo",function(b){a.getOrderInfo("baseInfo",$(this).closest(".weixin-order-box").find(".jt-cs-so-sono").attr("data-sono"));
});$(document).on("click",".orderAddr",function(b){a.getOrderInfo("addr",$(this).closest(".weixin-order-box").find(".jt-cs-so-sono").attr("data-sono"));
});$(document).on("click",".orderShip",function(b){a.getOrderInfo("ship",$(this).closest(".weixin-order-box").find(".jt-cs-so-sono").attr("data-sono"));
});$(document).on("click",".jt-ziliao-img",function(c){var b=$(this).offset().left-320;var d=$(this).offset().top;$("#more-cs-info-div").css({"top":d,"left":b});
$("#more-cs-info-div").toggle();});$(document).on("click",".jt-cs-so-sono",function(){var b=$(this).attr("data-sono");var c=$(this).attr("data-csName");
JTTabUtils.addOrRefreshTab(AndroidCsInfo._CONS_.SO_DETAIL_PAGE_URL+"?soNo="+b+"&canShowScTrankNo=cannot",c+"的订单明细");});},getOrderInfo:function(c,a){var b=this;
FormUtils.loadData(AndroidCsInfo._CONS_.GET_ORDER_INFO+"?type="+c+"&soNo="+a,function(e){if(e){var d="";if(c=="baseInfo"){d+="订&nbsp;单&nbsp;号&nbsp;：&nbsp;<span class='obi'>"+e.baseInfo.soNo+"</span>"+"<br/>"+"订单状态：&nbsp;<span class='obi'>"+b.statusToCN(e.baseInfo)+"</span>"+"<br/>"+"快递公司：&nbsp;<span class='obi'>"+e.baseInfo.shipName+"</span>"+"<br/>"+"快递单号：&nbsp;<span class='obi'>"+((e.baseInfo.scTrackingNo!=""&&e.baseInfo.scTrackingNo!="null"&&e.baseInfo.scTrackingNo!=null)?e.baseInfo.scTrackingNo:"该订单还没有物流信息")+"</span>"+"<br/>"+"总金额（含运费）：&nbsp;<span class='obi'>￥"+(e.baseInfo.totalAmount).toFixed(2)+"</span>";
}else{if(c=="addr"){if(e.addr&&e.addr!=null&&e.addr!="null"){d+="收货地址：&nbsp;<span class='obi'>"+e.addr+"</span>";}}else{if(c=="ship"){if(e.logistics&&e.logistics!=null&&e.logistics!="null"){d+="当前物流信息：&nbsp;<span class='obi'>"+e.logistics+"</span>";
}else{d+="当前物流信息：&nbsp;<span class='obi'>该订单还没有物流信息</span>";}}}}var f=$("#chat-textarea");if(f.contents().length>0){if(f.text()==""){f.empty();}d="<br/>"+d;
}$("#chat-textarea").append(d);}});},loadCsInfo:function(a){$("#more-cs-info-div").hide();if(a.relateFlag!=0){this._loadBindCsInfo(a);if($(".weixin-csinfo").length>0&&$(".weixin-csinfo").is(".flipped")){$(".weixin-csinfo").removeClass("flipped");
}}else{this._loadUnbindInfo(a);}this._getEmployeeWx(a);},_loadBindCsInfo:function(b){var a=this;$("#csinfo-field-unbind").hide();$("#csinfo-field-binded").show();
a._loadDetailData(b);a._loadCsPhone(b);a._loadCsAddr(b);a._loadCsOrder(b);},_loadUnbindInfo:function(a){$("#csinfo-field-unbind").show();$("#csinfo-field-binded").hide();
},_getEmployeeWx:function(b){var a=this;FormUtils.loadData(AndroidCsInfo._CONS_.GET_EMPLOYEE_WEIXIN+"?alias="+b.employeeAlias,function(c){if(c){$(".jt-wx-from-weixin").empty().append(c.alias);
$(".jt-wx-from-nickname").empty().append(c.nickName);$(".jt-wx-passtime").empty().append(b.passTime?b.passTime:"--");$(".jt-wx-bindtime").empty().append(b.bindTime?b.bindTime:"--");
}},function(){},true);},_getRegName:function(a){if(a!=""&&a!=null&&a.length>5){return a.substring(0,5)+"...";}return a;},_loadDetailData:function(b){var a=this;
FormUtils.loadData(AndroidCsInfo._CONS_.LOAD_CS_DETAIL_URL+"?id="+b.csId+"&type=self",function(f){if(f){if(f.gender=="男"){$(".jt-sex-img").attr(ctx+"/img/jt/wx/images/boy.png");
$(".jt-sex-img").show();}else{if(f.gender=="女"){$(".jt-sex-img").attr(ctx+"/img/jt/wx/images/girl.png");$(".jt-sex-img").show();}else{$(".jt-sex-img").hide();
}}$(".jt-cs-name").empty().append("<span title='"+f.name+"'>"+a._getRegName(f.name)+"</span>");$(".jt-cs-nickname").empty().append("昵称&nbsp;&nbsp;(<span title='"+b.conRemark+"'>"+a._getRegName(b.conRemark)+"</span>)");
$(".jt-cs-weixin").empty().append(f.maskWeixin);var e="";if(f.birthday){var c=f.birthday.split("-");if(c[0]){e=c[0]+"年";}if(c[1]&&c[1]!=""){e+=c[1]+"月";
}if(c[2]&&c[2]!=""){e+=c[2]+"日";}if(c[0]){var d=(new Date()).getFullYear()-c[0];e+="("+d+"岁)";}}$(".jt-cs-birth").empty().append(e);function g(h,i){if(i){$(h).empty().append(i).closest(".jt-cs-baseinfo").show("nromal");
}}g(".jt-cs-bizType",f.bizType);g(".jt-cs-srcnames",f.srcNames);g(".jt-cs-productname",f.productName);g(".jt-cs-interests",f.interests);$(".jt-cs-total-so-amount").empty().append("<em>￥"+f.soTotal+"</em>");
$(".jt-cs-total-so-count").empty().append("<em>"+f.soComplete+"</em>&nbsp;单/<em>￥"+(f.soComplete!=0?f.soTotal/f.soComplete:0).toFixed(2)+"</em>");}},function(){},true);
},_loadCsPhone:function(a){$(".jt-cs-phone").empty();FormUtils.loadData(AndroidCsInfo._CONS_.LOAD_CS_PHONE_URL+"?csId="+a.csId,function(b){if(b.length>0){$(".jt-cs-phone").append(b[0].maskPhone);
}},function(){},true);},_loadCsAddr:function(b){var a=this;FormUtils.loadData(AndroidCsInfo._CONS_.LOAD_CS_ADDR_URL+"?party_id_="+b.csId,function(c){a._getAddr(c);
},function(){},true);},_loadCsOrder:function(b){var a=this;$(".jt-so-right").removeClass("has");$(".jt-so-left").removeClass("has");FormUtils.loadData(AndroidCsInfo._CONS_.LOAD_CS_ORDER_URL+"?canShowScTrankNo=cannot&csId="+b.csId,function(c){a.orders=c.data;
if(a.orders.length<=0){$(".has-order").hide();}else{$(".has-order").show();}if(c.data.length>1){$(".jt-so-right").addClass("has");}a.orderIndex=0;a._getOrder(a.orders,0);
},function(){},true);},_getAddr:function(b){if(b.length==0){$(".jt-addr-addr").empty().append("无");$(".info-div-content-more").empty().append("无");return false;
}var c=new StringBuffer();$(".jt-addr-addr").empty();if(b[0].coName&&b[0].coName!="中国"){c.append(b[0].coName);}c.append(b[0].prName).append(b[0].ciName).append(b[0].arName).append(b[0].addr);
$(".jt-addr-addr").append(c.toString());if(b.length>1){c=new StringBuffer();$(".info-div-content-more").empty();for(var a=1;a<b.length;a++){c.append("<div class='info-div-content'>");
if(b[a].coName&&b[a].coName!="中国"){c.append(b[a].coName);}c.append(b[a].prName).append(b[a].ciName).append(b[a].arName).append(b[a].addr).append("</div>");
}$(".info-div-content-more").append(c.toString());}else{$(".info-div-content-more").empty().append("无");}},_getOrder:function(e,b){if(e.length>=b+1){$(".jt-cs-so-count").empty().append(b+1+"/"+e.length);
var h=b+1;var a="第"+h+"单，共"+e.length+"单";$(".jt-so-count-box").attr("title",a);var g=new StringBuffer();g.append('<div class="jt-order-number"><div class="jt-cs-so-label">订单号&nbsp;：&nbsp;</div><div class="jt-cs-so-sono" data-csName="'+e[b].csName+'" data-sono="'+e[b].soNo+'">'+e[b].soNo+"</div></div>").append('<div class="jt-order-number"><div class="jt-cs-so-label">生成时间&nbsp;：&nbsp;</div><div class="jt-cs-so-time">'+e[b].createTime+"</div></div>").append('<div class="jt-cs-so-items"><div style="border-top:1px dashed #ccc;height:7px;"></div>');
var d=e[b].prodNames.split(",");for(var c=0;c<d.length;c++){var f=d[c].split("(<span style='color:red;'>");g.append('<div class="jt-cs-so-item">').append('<div class="jt-cs-so-item-name">').append(f[0]).append("</div>").append('<div class="jt-cs-so-item-count">x&nbsp;'+f[1].split("</span>)")[0]+"</div>").append("</div>");
}g.append('<div style="border-top:1px dashed #ccc;height:7px;margin:7px 0;"></div><div class="jt-cs-so-sum">').append('共&nbsp;<span class="jt-cs-so-sum-count">'+e[b].prodQty+"</span>&nbsp;件商品").append('<span class="span"></span>').append('<div style="float:right;">合计&nbsp;:&nbsp;<span class="jt-cs-so-sum-amount">￥'+e[b].prodAmount+"</span></div>").append("</div></div>");
$("#jt-cs-so-div").empty().append(g.toString()).find(".jt-cs-so-item-name").width(Math.floor($("#jt-cs-so-div").width()*0.85));}else{$(".jt-cs-so-count").empty().append(0);
$("#jt-cs-so-div").empty().append("<div class='jt-so-no-data'>无数据</div>");}},statusToCN:function(b){var a=this;if(b.backStatus=="awaiting"&&b.status=="close_reject"){return a.formatStatus(b.status)+"(需退回)";
}else{if(b.backStatus=="none"&&b.status=="close_reject"){return a.formatStatus(b.status)+"(无需退回)";}else{if(b.isReceived=="y"){return a.formatStatus(b.status)+"(已回款)";
}else{if(b.isInbound=="y"){return a.formatStatus(b.status)+"(已退库)";}else{if(b.auditCount==1){return a.formatStatus(b)+"(初审)";}else{return a.formatStatus(b);
}}}}}},formatStatus:function(e){var b="";var a=e.status;var d=e.delayConfirmTime;var c=e.delayShipTime;if(a=="awaiting_pay"){b="待支付";}else{if(a=="awaiting_post"){b="待提交";
}else{if(a=="awaiting_comfirm"){if(d!=null){b="待审核"+"<span style='color:red;font-size: 8px;'>[延审]</span>";}else{b="待审核";}}else{if(a=="comfirm"){if(c!=null){b="待发货"+"<span style='color:red;font-size: 8px;'>[延发]</span>";
}else{b="待发货";}}else{if(a=="shipping"){b="已发货";}else{if(a=="complete"){b="已签收";}else{if(a=="close"){b="已作废";}else{if(a=="close_reject"){b="已拒收";}else{if(a=="close_lost"){b="已丢失";
}}}}}}}}}return b;}};