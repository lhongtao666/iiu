$(function(){var a=new AndroidMoment();a.init();});function AndroidMoment(){this.hadInit=false;}AndroidMoment._CONS_={SEND_MOMENT_URL:ctx+"/crm/android/sendMoment.htm",FIND_EMPLOYEE_WEIXIN:ctx+"/gl/ou/employeeWeiXin/findByEmployee.htm",};
AndroidMoment.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._hideNotGrantedBtn();this._bindEventHander();CateUtils.getOptions([{typeKey:"system",pKey:"weixinLabel",container:"labelNames"}]);
this._initEmployeeWeiXin();}},_initEmployeeWeiXin:function(){var a=this;FormUtils.loadData(AndroidMoment._CONS_.FIND_EMPLOYEE_WEIXIN+"?employeeId="+currentUserId+"&status=2",function(c){var d=new StringBuffer();
d.append("<option value=''>请选择</option>");for(var b=0;b<c.length;b++){d.append("<option value='"+c[b].userName+"'>"+c[b].nickName+"("+c[b].alias+")</option>");
}$("#employeeAlias").empty().append(d.toString());});},_hideNotGrantedBtn:function(){},_bindEventHander:function(){var a=this;$("#sendMoment").on("click",function(){a._sendMoment();
});$("#momentType").on("change",function(){var b=$(this).val();if(b==1){$(".video").hide();$(".img").hide();$(".link").hide();}else{if(b==2){$(".link").hide();
$(".video").hide();$(".img").show();}else{if(b==3){$(".link").hide();$(".img").hide();$(".video").show();}else{if(b==4){$(".img").hide();$(".video").hide();
$(".link").show();}}}}});$("input[name='publicMode']").on("change",function(){var b=$("input[name='publicMode']:checked").val();if(b==2){$(".wx-label").show();
$("#labelNames").chosen("destroy").chosen();}else{if(b==3){$(".wx-label").show();$("#labelNames").chosen("destroy").chosen();}else{$(".wx-label").hide();
}}});},_sendMoment:function(){var j=this;var g=$("#employeeAlias").val();var i=$("#momentTitle").val();var h=$("#momentType").val();var k=$("input[name='publicMode']:checked").val();
var f=$("#imgPath").val();var a=$("#videoPath").val();var e=$("#KsnsuploadLink").val();var b=$("#KsnsuploadTitle").val();var c=$("#labelNames").val();var d={employeeAlias:g,publicMode:k,labelNames:c,momentTitle:i,momentType:h,imgPath:f,videoPath:a,KsnsuploadLink:e,KsnsuploadTitle:b};
if(g==null||g==""){DialogUtils.error(msgCode.ERROR,"请选择微信");return;}FormUtils.submit(AndroidMoment._CONS_.SEND_MOMENT_URL,d,function(l){if(l.success){DialogUtils.success(msgCode.SUCESS,l.msg);
}else{DialogUtils.error(msgCode.ERROR,l.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}};