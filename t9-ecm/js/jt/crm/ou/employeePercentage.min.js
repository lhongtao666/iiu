function EmployeePercentage(){this.hadInit=false;this.params=null;}EmployeePercentage._CONS_={LIST_EMPLOYEE_PERCENTAGE_DATA:ctx+"/gl/ou/employeePercentage/listData.htm",GET_EMPLOYEE_PERCENTAGE_DATA:ctx+"/gl/ou/employeePercentage/getEmployeePercentageData.htm",DELETE_EMPLOYEE_PERCENTAGE:ctx+"/gl/ou/employeePercentage/delete.htm",ADD_EMPLOYEE_PERCENTAGE:ctx+"/gl/ou/employeePercentage/saveAdd.htm",SAVE_EDIT_EMPLOYEE_PERCENTAGE:ctx+"/gl/ou/employeePercentage/saveEdit.htm",DETAIL_EMPLOYEE_PERCENTAGE:ctx+"/gl/ou/employeePercentage/detail.htm",EDIT_EMPLOYEE_PERCENTAGE:ctx+"/gl/ou/employeePercentage/edit.htm",SAVE_EMPLOYEE_PERCENTAGE:ctx+"/gl/ou/employeePercentage/addOrUpdateEmployeePercentage.htm",};
EmployeePercentage.prototype={init:function(b){var a=this;a.params=b;console.log(b);if(!a.hadInit){a.hadInit=true;a._hideNotGrantBtn();a._bindEventHander();
a._bindFormValidation();}a._initToolbarTimer();a._initDataList(b);},_initDataList:function(b){var a=this;FormUtils.submit(EmployeePercentage._CONS_.LIST_EMPLOYEE_PERCENTAGE_DATA,b,function(e){var f=new StringBuffer();
var d=e.rows;if(d&&d.length>0){for(var c=0;c<d.length;c++){f.append(a._createTr(d[c]));}}$(".data-table tbody").empty().append(f.toString());});},_initToolbarTimer:function(){var a=this;
var d=new Date();var c=DateUtils.format(d,"MM");var b=a._getTimeOptions("year");$("#yearSelect").empty().append(b.toString());$("#monthSelect").val(c).trigger("change");
},_getOpt:function(c,a,b){var d="<option value='"+c+"' "+(b?"selected='selected'":"")+" >"+a+"</option>";return d;},_generateCode:function(){var a=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1);
};return(a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a());},_getTimeOptions:function(g,c){var k=this;var j=new StringBuffer();if(g=="year"){var a=new Date();
var e=DateUtils.format(a,"yyyy");if(c){if(c/1<=e/1&&c>e/1-10){for(var d=0;d<10;d++){var h=e/1-d;var f=k._getOpt(h,h+"年",h==c/1);j.append(f);}}else{for(var d=e/1;
d>=c/1;d--){var f=k._getOpt(d,d+"年",d==c/1);j.append(f);}}}else{for(var d=0;d<10;d++){var h=e/1-d;var f=k._getOpt(h,h+"年");j.append(f);}}}else{for(var d=1;
d<13;d++){var b=(d<10)?("0"+d):d;j.append('<option value="'+b);j.append('"');if(b==c){j.append(' selected="selected" ');}j.append(" >");j.append(d+"月");
j.append("</option>");}}return j.toString();},_createTr:function(f){var c=this;var g=f.period;var a=f.period.substring(0,4);var e=f.period.substring(4,6);
var d=c._generateCode();var h=new StringBuffer();h.append("<tr>");h.append('<td width="120">');h.append('<select class="form-control periodYear" required digits  name="periodYear-'+d+'" validatetype="default" >');
h.append(c._getTimeOptions("year",a));h.append("</select>");h.append("</td>");h.append('<td width="120">');h.append('<select class="form-control periodMonth" required digits min="1" max="12" name="periodMonth-'+d+'" validatetype="default" >');
h.append(c._getTimeOptions("month",e));h.append("</select>");h.append("</td>");h.append('<td width="120">');var b=new StringBuffer();b.append('<div class="input-group">');
b.append('<input name="percentage-'+d+'"  required number="true"  placeholder="请输入提成金额" validateType="default" type="text" class="form-control percentage" value="'+f.percentage+'" >');
b.append('<span class="input-group-addon">元</span>');b.append("</div>");h.append(b.toString());h.append("</td>");h.append('<td width="40">');h.append("<button idVal='"+f.id+"'  class='btn btn-danger btn-sm deleteEmployeePercentageBtn' type='button'>删除</button>");
h.append("</td>");h.append("</tr>");return h.toString();},_hideNotGrantBtn:function(){if(!ResUtils.canShow("employee.button.employeePercentage")){$(".addEmployeeRateMoneyBtn").hide();
}},_clear:function(c){var a=this;function b(){ButtonUtils.enableBtn("addEmployeePercentageBtn");}b();},_bindEventHander:function(){var a=this;$("body").on("change","tr",function(){console.log("change");
var b=$(this).find(".periodYear").val();var c=$(this).find(".periodMonth").val();var d=b+""+c;$(this).attr("period",d);});$("body").on("click",".addPercentageRow",function(){var d=new Date();
var f=d.getMonth();var c=f;if(f<10){c="0"+f;}var h=d.getFullYear()+""+c;var b=0;var e={period:h,percentage:b,};var g=a._createTr(e);$(".data-table tbody").append(g);
});$("body").on("click",".generate-record",function(){var f=""+$("#yearSelect").val()+$("#monthSelect").val();var b=$(".performanceAndMoney").attr("percentage");
var d={period:f,percentage:b,};var e=a._createTr(d);var c=$("tr[period='"+f+"']");if(c.length){c.replaceWith(e);}else{$(".data-table tbody").append(e);
}});$("body").on("change","#monthSelect,#yearSelect",function(){var c=a.params.Q__S__EQ__employee_id_;var d=""+$("#yearSelect").val()+$("#monthSelect").val();
var b=EmployeePercentage._CONS_.GET_EMPLOYEE_PERCENTAGE_DATA+"?employeeId="+c+"&period="+d;FormUtils.loadData(b,function(e){var f="【"+$("#yearSelect").val()+"年"+$("#monthSelect").val()+"月】";
$("#yearMonthStr").empty().append(f);$(".performanceAndMoney").empty().append(e.profit+"/"+e.percentage);$(".performanceAndMoney").attr("percentage",e.percentage);
});});$("body").on("change","#periodPicker",function(){var c=$(this).val();if(c){var b=c.substring(3,c.length)+c.substring(0,2);$("[name=period]").val(b);
}else{$("[name=period]").val("");}});$("body").on("click",".deleteEmployeePercentageBtn",function(){console.log("删除关联");$(this).parents("tr").remove();
});$("body").on("click",".addEmployeePercentageBtn",function(){var b=new StringBuffer();if(!$("[name=percentage]").val()||!$("[name=period]").val()){DialogUtils.error(msgCode.ERROR,"数据不全");
return;}b.append("percentage="+$("[name=percentage]").val());b.append("&period="+$("[name=period]").val());b.append("&employeeId="+a.params.Q__S__EQ__employee_id_);
b.append("&periodType="+a.params.Q__S__EQ__period_type_);ButtonUtils.disableBtn("addEmployeePercentageBtn");FormUtils.submit(EmployeePercentage._CONS_.SAVE_EMPLOYEE_PERCENTAGE,b.toString(),function(c){a._clear();
if(c.success){a._initDataList(a.params);DialogUtils.success(msgCode.SUCCESS,c.msg);}else{DialogUtils.error(msgCode.ERROR,c.msg);}},function(){ButtonUtils.enableBtn("addEmployeePercentageBtn");
DialogUtils.error(msgCode.ERROR,"服务器错误");});});},_bindFormValidation:function(){FormUtils.bindFormValidation("employeePercentageForm",null,null);},_getManagerBtns:function(){var a=[];
if(canShow("employee.button.delete")){a.push({lable:"删除",btnClasses:"btn btn-danger employeeDel",iconClasses:"fa fa-remove"});}return a;},};