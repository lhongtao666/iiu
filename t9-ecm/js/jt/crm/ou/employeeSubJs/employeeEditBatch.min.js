function EmployeeEditBatch(a){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.currentPosition=null;this.employee=a;}EmployeeEditBatch._CONS_={SAVE_EDIT_BATCH:ctx+"/crm/ou/employee/saveEditBatch.htm",LIST_ID_DATA:ctx+"/crm/ou/employee/listIdData.htm",GRID:"#employeeGrid",};
EmployeeEditBatch.prototype={init:function(b){var a=this;if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._hideNotGrantBtn();}},_hideNotGrantBtn:function(){if(!ResUtils.canShow("employee.button.editBatch")){$(".employeeEditBtch").hide();
}if("myGroup"==type){$(".employeeEditBtch").hide();}},_bindEventHander:function(){var a=this;$(document).on("click",".employeeEditBtch",function(){var b=$(EmployeeRate._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(!b||b.length<=0){var c=$("#employeeSearchForm").serialize();c=c+"&treeNodeId="+a.employee.employeeGroup.currentClickTreeNode.id;FormUtils.loadData(EmployeeEditBatch._CONS_.LIST_ID_DATA+"?"+c,function(d){a._setEmployeeEditBatch(d);
});}else{a._setEmployeeEditBatch(b);}});},_setEmployeeEditBatch:function(c){var a=this;var b="demo-class";layer.open({type:2,title:'您正在对<font style="color:red;">【'+c.length+'个】</font>员工进行批量修改操作。<font style="color:red;">提示：只有勾选才有效</font>',maxmin:false,shadeClose:true,btn:["保存","取消"],area:["600px","520px"],zIndex:"9999",content:ctx+"/crm/ou/employee/toEditBatch.htm",skin:b,yes:function(e,d){DialogUtils.confirmWithOptions({title:"确定批量修改当前结果？",text:"",confirmButtonText:"确定",yesFunc:function(){a._saveEmployeeEditBatch(c,e,d);
}});}});},_saveEmployeeEditBatch:function(f,d,b){var c=this;var a=layer.getChildFrame("body",d);var g=this._getParams(f,a);if(!g){return false;}var e=g.msg;
FormUtils.submit(EmployeeEditBatch._CONS_.SAVE_EDIT_BATCH,"jsondata="+JSON.stringify(g),function(i){if(i.success){DialogUtils.success(msgCode.SUCCESS,"批量修改"+f.length+"个员工资料。修改了"+e);
layer.close(d);var h=$("#employeeSearchForm").serialize();h=h;c.employee._reloadJqgrid(h);}else{DialogUtils.error(msgCode.ERROR,i.msg);}},function(){DialogUtils.error(msgCode.ERROR,"服务器错误");
});},_getParams:function(a,g){var j=$("#editBatchForm table tr",g);var c={ids:a,positions:"",roleIds:"",status:"",groupId:"",msg:""};var f=false;var e=false;
var m=new StringBuffer();for(var d=0,h=j.length;d<h;d++){if(!$(j[d]).find("input[type=checkbox]")[0].checked){continue;}if(d==0){var k=$(j[d]).find("input[name=positionBatch]").val();
c.positions=k;if(c.positions){m.append("[岗位]、");}e=true;}else{if(d==1){f=true;var b=$(j[d]).find("select[name=roleIds]").val();c.roleIds=(b&&b.length>0)?b.join(","):"";
if(c.roleIds){m.append("[角色]、");}}else{if(d==2){f=true;c.status=$(j[d]).find("input[name=status]:checked").val();if(c.status){m.append("[状态]、");}}else{if(d==3){f=true;
c.groupId=$(j[d]).find("input[name=groupId]").val();if(c.groupId){m.append("[部门],将部门移动到了["+$(j[d]).find("input[name=orgName]").val()+"]、");}}}}}}if(e&&!c.positions){c.positions=true;
}if(!(f||e)){DialogUtils.error("警告","勾选需要修改的项！或者点击取消",g);return false;}if(!((f&&(c.roleIds||c.status||c.groupId))||e)){DialogUtils.error("警告","请填写需要修改的内容！或者点击取消",g);
return false;}var l=m.toString();c.msg=l.substring(0,l.length-1)+"。";return c;}};