function EmployeeRate(a){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.employee=a;}EmployeeRate._CONS_={SAVE_BATCH_RATE:ctx+"/gl/ou/employeeRate/saveBatch.htm",GRID:"#employeeGrid",};
EmployeeRate.prototype={init:function(b){var a=this;if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._hideNotGrantBtn();}},_hideNotGrantBtn:function(){if(!ResUtils.canShow("employee.button.rate")){$(".addEmployeeRateBtn").hide();
$(".addEmployeeRateBtn").hide();}if("myGroup"==type){$(".addEmployeeRateBtn").hide();$(".addEmployeeRateBtn").hide();}},_bindEventHander:function(){var a=this;
$(document).on("click",".orgRateBtn",function(){var b=a.employee.employeeGroup.currentRightClickTreeNode.id;a._setOrgRate(b,a.employee.employeeGroup.currentRightClickTreeNode.name);
});$(document).on("click",".addEmployeeRateBtn",function(){var b=$(this).attr("idVal");if(!b){b=$(EmployeeRate._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error("错误","请选择要操作的记录");return;}if(b.length>1){DialogUtils.error("错误","不能同时操作多个");return;}}var c=$(EmployeeRate._CONS_.GRID).jqGrid("getRowData",b);
if(c.isBelongSaleOrg!="y"){DialogUtils.error("错误","所选员工不属于销售部门,不能设置提成比率");return;}a._setEmployeeRate(b,c.name);});},_setEmployeeRate:function(b,c){var a=this;
layer.open({type:2,title:'设置<font style="color:red;">【'+c+"】</font>员工提成比率",maxmin:false,shadeClose:true,btn:["保存","取消"],area:["70%","65%"],content:ctx+"/crm/ou/employee/toRate.htm?partyId="+b+"&partyType=employee",yes:function(e,d){var f={partyType:"employee",partyId:b,};
a._setPartyRate(f,e,d);}});},_setPartyRate:function(h,e,b){var a=layer.getChildFrame("body",e);var d=$(".groupRatePanel tbody tr",a);var g=[];if(!$("#orgRateForm",a).valid()){return;
}if(d.length){d.each(function(i,l){var m=$(l);var k=m.find(".rate").val().trim();var j=m.find(".money").val().trim();var n=new StringBuffer();n.append("money=");
n.append(j);n.append("#");n.append("rate=");n.append(k);g.push(n.toString());});}var c=g.join(",");var f=new StringBuffer();f.append("values=").append(c);
f.append("&").append("partyType=").append(h.partyType);f.append("&").append("partyId=").append(h.partyId);FormUtils.submit(EmployeeRate._CONS_.SAVE_BATCH_RATE,f.toString(),function(i){if(i.success){DialogUtils.success(msgCode.SUCCESS,i.msg);
layer.close(e);}else{DialogUtils.error(msgCode.ERROR,i.msg);}},function(){DialogUtils.error(msgCode.ERROR,"服务器错误");});},_setOrgRate:function(c,b){var a=this;
layer.open({type:2,title:'设置<font style="color:red;">【'+b+"】</font>提成比率",maxmin:false,shadeClose:true,btn:["保存","取消"],area:["50%","65%"],content:ctx+"/crm/ou/employee/toRate.htm?partyId="+c+"&partyType=organization",yes:function(e,d){var f={partyType:"organization",partyId:c,};
a._setPartyRate(f,e,d);}});}};