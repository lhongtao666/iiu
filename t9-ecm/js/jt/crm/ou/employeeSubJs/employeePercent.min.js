function EmployeePercent(a){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.employee=a;}EmployeePercent._CONS_={SAVE_PERCENTAGES:ctx+"/gl/ou/employeePercentage/saveBatch.htm",GRID:"#employeeGrid",};
EmployeePercent.prototype={init:function(b){var a=this;if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._hideNotGrantBtn();}},_hideNotGrantBtn:function(){if(!ResUtils.canShow("employee.button.percentage")){$(".addEmployeeRateMoneyBtn").hide();
}if("myGroup"==type){$(".addEmployeeRateMoneyBtn").hide();}},_bindEventHander:function(){var a=this;$(document).on("click",".addEmployeeRateMoneyBtn",function(){var b=$(this).attr("idVal");
if(!b){b=$(EmployeePercent._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error("错误","请选择要操作的记录");return;}if(b.length>1){DialogUtils.error("错误","不能同时操作多个");
return;}}var c=$(EmployeePercent._CONS_.GRID).jqGrid("getRowData",b);if(c.isBelongSaleOrg!="y"){DialogUtils.error("错误","所选员工不属于销售部门,不能录入提成");return;}a._addEmployeePercentage(b,c.name);
});},_addEmployeePercentage:function(b,c){var a=this;layer.open({type:2,title:'录入<font style="color:red;">【'+c+"】</font>员工提成",maxmin:false,btn:["保存","取消"],shadeClose:true,area:["75%","75%"],content:ctx+"/gl/ou/employeePercentage/toEmployeePercentage.htm?employeeId="+b+"&periodType=month",yes:function(h,e){var d=layer.getChildFrame("body",h);
if(!$("#employeePercentageForm",d).valid()){return;}var j=[];var g=$(".data-table tbody tr",d);if(g.length){g.each(function(l,m){var n=$(m);var p=""+n.find(".periodYear").val()+n.find(".periodMonth").val();
var k=n.find(".percentage").val();var o=new StringBuffer();o.append("percentage=");o.append(k);o.append("#");o.append("period=");o.append(p);j.push(o.toString());
});}var f=j.join(",");var i=new StringBuffer();i.append("values=").append(f);i.append("&").append("periodType=").append("month");i.append("&").append("employeeId=").append(b);
FormUtils.submit(EmployeePercent._CONS_.SAVE_PERCENTAGES,i.toString(),function(k){if(k.success){DialogUtils.success(msgCode.SUCCESS,k.msg);layer.close(h);
}else{DialogUtils.error(msgCode.ERROR,k.msg);}},function(){DialogUtils.error(msgCode.ERROR,"服务器错误");});}});}};