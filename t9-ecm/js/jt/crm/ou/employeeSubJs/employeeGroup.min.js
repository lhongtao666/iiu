function EmployeeGroup(a){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.employee=a;this.prodRootCate=null;this.treeMenu={};}EmployeeGroup._CONS_={GRID:"#employeeGrid",PAGER:"#employeePager",LISTORG_DATA_URL:ctx+"/gl/ou/group/listData.htm?type=all",LIST_MY_GROUP_URL:ctx+"/gl/ou/group/findVisiableGroupTree.htm",LIST_ALL_EMPLOYEE_TREE:ctx+"/gl/ou/group/findAllEmployeeTree.htm",LIST_VISIABLE_EMPLOYEE_TREE:ctx+"/gl/ou/group/findVisiableEmployeeTree.htm",DELETEORG_URL:ctx+"/gl/ou/group/delete.htm",GET_ROOT_PROD_CATE_URL:ctx+"/ec/product/prodEntity/getRootCate.htm",GET_STORE_LIST_URL:ctx+"/gl/cs/csSeaConfig/getStoreList.htm"};
EmployeeGroup.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._bindFormValidation();this.initOrganizationTree(a);
this._initSelect();this._hideNotGrantBtn();this._initProdRootCatePo();this._initStore();this._initStoreList();this._loadStore();$("#salePercentA").popover({html:true,container:"body"});
$("#autoPercentA").popover({html:true,container:"body"});}},_loadStore:function(){var a=this;var b=EmployeeGroup._CONS_.GET_STORE_LIST_URL;var c=a._getContainer("storeIds");
if(!c){return false;}FormUtils.loadData(b,function(e){if(e&&e.length>0){var f=new StringBuffer();for(var d=0;d<e.length;d++){f.append("<option value='"+e[d].id+"'>"+e[d].name+"</option>");
}c.empty().append(f.toString());}if(c&&c.is(".selectpicker")){c.selectpicker("refresh");}});},_getContainer:function(b){var a=this;var c=false;if(b){c=$("#"+b);
if(c.length==0){c=$("select."+b);if(c.length==0){c=$("select[name='"+b+"']");if(c.length==0){return false;}}}}return c;},_initProdRootCatePo:function(){var a=this;
FormUtils.loadData(EmployeeGroup._CONS_.GET_ROOT_PROD_CATE_URL,function(b){a.prodRootCate=b;});},visibleTreeMenu:function(){var a=this;},_hideNotGrantBtn:function(){var a=this;
if("myGroup"==type){$(".addPhoneBtn").remove();$("#orgDelBtn").remove();$(".orgDelBtn").remove();a.treeMenu.idl=false;$(".orgRateBtn").remove();if(!ResUtils.canShow("group.button.showAdd")){$("#orgAddBtn").remove();
$(".orgAddBtn").remove();a.treeMenu.ia=false;}if(!ResUtils.canShow("group.button.showEdit")){$("#orgUpdateBtn").remove();$(".orgUpdateBtn").remove();a.treeMenu.ie=false;
}if(!ResUtils.canShow("group.button.profitPK")){$(".profitPK").hide();}if(!ResUtils.canShow("group.button.saveAddBtn")&&!ResUtils.canShow("group.button.saveEditBtn")){$(".saveBtn").hide();
}}else{if(!ResUtils.canShow("group.button.add")){$("#orgAddBtn").remove();$(".orgAddBtn").remove();a.treeMenu.ia=false;}if(!ResUtils.canShow("group.button.edit")){$("#orgUpdateBtn").remove();
$(".orgUpdateBtn").remove();a.treeMenu.ie=false;}if(!ResUtils.canShow("employee.button.profitPK")){$(".profitPK").hide();}if(!ResUtils.canShow("employee.button.saveAddBtn")&&!ResUtils.canShow("employee.button.saveEditBtn")){$(".saveBtn").hide();
}}},_initSelect:function(){CateUtils.getOptions([{typeKey:"system",pKey:"CsSecondTypes",container:"secTypeSelect"}]);},initOrganizationTree:function(c){var a=this;
var b={edit:{enable:true,showRemoveBtn:false,showRenameBtn:false,drag:{autoExpandTrigger:true,isCopy:false,isMove:ResUtils.canShow("group.button.drag")?true:false,prev:true,next:true,inner:true,borderMax:10,borderMin:-5,minMoveSize:5,autoOpenTime:500}},async:{enable:true,url:type=="myGroup"?EmployeeGroup._CONS_.LIST_VISIABLE_EMPLOYEE_TREE:EmployeeGroup._CONS_.LIST_ALL_EMPLOYEE_TREE,contentType:"application/json",dataType:"json",type:"get",autoParam:["id"],dataFilter:function(g,d,h){console.log(h);
if(h&&h.length){for(var f=0;f<h.length;f++){var e=h[f];if(e.isSale=="y"){e.name=e.name+"【销】";e.font={"color":"red"};}if(e.name=="代理商"){e.nocheck=true;}}}return h;
},},data:{simpleData:{enable:true,idKey:"id",pIdKey:"parentId",isAgent:"isAgent"}},callback:{beforeDrag:function(e,d){if(type=="myGroup"){return false;
}if(!d[0].parentId){return false;}else{return true;}},beforeDrop:function(g,f,h,e){var d=f[0];if(!h.parentId&&(e=="prev"||e=="next")){return false;}if(e==="prev"||e==="next"){if((d.parentId.isEmpty()&&h.parentId.isEmpty())||(d.parentId==h.parentId)){a._moveHandler(d.id,h.id,null,e);
}else{if(d.parentId!=null&&h.parentId!=null&&d.parentId!=h.parentId){a._moveHandler(d.id,h.id,h.parentId,e);}else{if(d.parentId!=null&&h.parentId==null){a._moveHandler(d.id,h.id,h.id,h.id,e);
}}}return true;}else{if(e==="inner"){if(d==null||h==null){return false;}else{a._moveHandler(d.id,null,h.id,null);return true;}}}return false;},onClick:function(d,f,e){$(".list_wrapper").show();
$(".form_wrapper").stop().animate({"left":$(".form_wrapper").outerWidth()+15+"px"},"fast");a.currentClickTreeNode=e;a._selectOrg(e);if(c){c.initCrumbs(e,"organizationTree");
}if($("#orgMenuContainer").is(":visible")){$("#orgMenuContainer").stop().slideUp("fast");}a.setTreeBarsLimit(e);},onRightClick:function(d,f,e){a.currentRightClickTreeNode=e;
if(e.type=="employee"){return false;}if(e.isAgent){return false;}if(e.isSale=="y"){$(".orgRateBtn").show();$(".addPhoneBtn").show();a.treeMenu.ie=false;
}else{$(".orgRateBtn").hide();$(".addPhoneBtn").hide();}if(e.isParent){$("#orgDelBtn").hide();a.treeMenu.idl=false;}else{$("#orgDelBtn").show();a.treeMenu.idl=true;
}$("#orgMenuContainer").css({top:(d.pageY-25)+"px",left:(d.pageX-10)+"px",display:"block"});},onAsyncSuccess:function(e,k,m,g){var h=$.fn.zTree.getZTreeObj("organizationTree");
if(m){var n=m.children;for(var j=0;j<n.length;j++){if(n[j].isParent==true){n[j].icon=ctx+"/js/zTree_v3/css/zTreeStyle/img/jt-diy/jt-16.png";}else{n[j].icon=ctx+"/js/zTree_v3/css/zTreeStyle/img/jt-diy/jt-30.png";
}if(childNodes[j].isSale=="y"){childNodes[j].font={"color":"red"};}h.updateNode(n[j]);}}else{var d=h.getNodes();for(var j=0;j<d.length;j++){d[j].icon=ctx+"/js/plugins/zTree_v3/css/zTreeStyle/img/jt-diy/jt-orgRoot.png";
if(d[j].isSale=="y"){d[j].font={"color":"red"};}h.updateNode(d[j]);}}if(m==null){var h=$.fn.zTree.getZTreeObj("organizationTree");var l=h.getNodes();if(l&&l.length){var f=l[0];
h.expandNode(f,true,false,true);h.selectNode(f);a.setTreeBarsLimit(f);a.currentClickTreeNode=f;a._selectOrg(f);if(c){c.initCrumbs(f,"organizationTree");
}}}}},view:{selectedMulti:false,fontCss:function(e,d){return(!!d.highlight)?{color:"#A60000","font-weight":"bold"}:{color:"#333","font-weight":"normal"};
}}};$.fn.zTree.init($("#organizationTree"),b);},treeNodeBtn:function(b){var a=this;},_moveHandler:function(d,c,a,b){var e={};if(d&&c&&a==null){e.type="changeSort";
}else{if(d&&c&&a!=null){e.type="changeSortAndParentId";}else{if(d&&a!=null){e.type="changeParentId";}}}e.srcId=d;e.destId=c;e.destParentId=a;e.moveType=b;
FormUtils.submit(ctx+"/gl/ou/group/move.htm",e,function(f){if(f.success){DialogUtils.success("成功","移动成功");}},function(){DialogUtils.error("错误","网络错误，请稍候重试");
});},clear:function(c){var a=this;function b(){}if(a.isEdit&&a.isFormDataChange){DialogUtils.warning(function(){b();});}else{b();}},_loadSeaConfig:function(b){var a=this;
FormUtils.loadData(ctx+"/gl/cs/csSeaConfig/getByGroupId.htm?groupId="+b,function(c){a._setSeaConfigExpData("lastCompleteTime",c.lastCompleteTime);a._setSeaConfigExpData("csCreateTime",c.csCreateTime);
a._setSeaConfigExpData("soTotal",c.soTotal);a._setSeaConfigExpData("soCount",c.soCount);a._setSeaShopData("shopName",c.shopName);a._setSeaConfigExpData("skuCode",c.skuCode);
a._setSeaConfigExpData("shippingTime",c.shippingTime);a._setSeaConfigExpData("soSub",c.soSub);});},_loadCompetencyConfig:function(a){FormUtils.loadData(ctx+"/gl/ou/group/getCompetencyConfig.htm?groupId="+a,function(b){$("#competencyConfigForm input[name='allowCompetency']").removeAttr("checked");
$("#competencyConfigForm input[name='allowCallSc']").removeAttr("checked");$("#competencyConfigForm input[name='allowCallLong']").removeAttr("checked");
$("#competencyConfigForm input[name='allowWxToCs']").removeAttr("checked");$("#competencyConfigForm input[name='allowWxCsTo']").removeAttr("checked");$("#competencyConfigForm input[name='allowCsFollows']").removeAttr("checked");
if(b.allowCompetency){$("#competencyConfigForm input[name='allowCompetency'][value='"+b.allowCompetency+"']").prop("checked","checked");$("#competencyConfigForm input[name='allowCallSc'][value='"+b.allowCallSc+"']").prop("checked","checked");
$("#competencyConfigForm input[name='callScPercent']").val(b.callScPercent);$("#competencyConfigForm input[name='callScMid']").val(b.callScMid);$("#competencyConfigForm input[name='allowCallLong'][value='"+b.allowCallLong+"']").prop("checked","checked");
$("#competencyConfigForm input[name='callLongPercent']").val(b.callLongPercent);$("#competencyConfigForm input[name='callLongMid']").val(b.callLongMid);
$("#competencyConfigForm input[name='allowWxToCs'][value='"+b.allowWxToCs+"']").prop("checked","checked");$("#competencyConfigForm input[name='wxToCsPercent']").val(b.wxToCsPercent);
$("#competencyConfigForm input[name='wxToCsMid']").val(b.wxToCsMid);$("#competencyConfigForm input[name='allowWxCsTo'][value='"+b.allowWxCsTo+"']").prop("checked","checked");
$("#competencyConfigForm input[name='wxCsToPercent']").val(b.wxCsToPercent);$("#competencyConfigForm input[name='wxCsToMid']").val(b.wxCsToMid);$("#competencyConfigForm input[name='allowCsFollows'][value='"+b.allowCsFollows+"']").prop("checked","checked");
$("#competencyConfigForm input[name='csFollowsPercent']").val(b.csFollowsPercent);$("#competencyConfigForm input[name='csFollowsMid']").val(b.csFollowsMid);
}else{$("#competencyConfigForm input[name='allowCompetency'][value='n']").prop("checked","checked");$("#competencyConfigForm input[name='allowCallSc'][value='n']").prop("checked","checked");
$("#competencyConfigForm input[name='callScPercent']").val("");$("#competencyConfigForm input[name='callScMid']").val("");$("#competencyConfigForm input[name='allowCallLong'][value='n']").prop("checked","checked");
$("#competencyConfigForm input[name='callLongPercent']").val("");$("#competencyConfigForm input[name='callLongMid']").val("");$("#competencyConfigForm input[name='allowWxToCs'][value='n']").prop("checked","checked");
$("#competencyConfigForm input[name='wxToCsPercent']").val("");$("#competencyConfigForm input[name='wxToCsMid']").val("");$("#competencyConfigForm input[name='allowWxCsTo'][value='n']").prop("checked","checked");
$("#competencyConfigForm input[name='wxCsToPercent']").val("");$("#competencyConfigForm input[name='wxCsToMid']").val("");$("#competencyConfigForm input[name='allowCsFollows'][value='n']").prop("checked","checked");
$("#competencyConfigForm input[name='csFollowsPercent']").val("");$("#competencyConfigForm input[name='csFollowsMid']").val("");}});},_saveCompetencyConfig:function(c){$("#competencyConfigForm input[name='groupId']").val(c);
var a=this;var b=ctx+"/gl/ou/group/saveCompetencyConfig.htm";var d=$("#competencyConfigForm").serialize();FormUtils.submit(b,d,function(e){if(e.success){$("#competencyConfigContainer").modal("hide");
DialogUtils.success("","修改成功");}});},_initStoreList:function(){FormUtils.loadData(EmployeeGroup._CONS_.GET_STORE_LIST_URL,function(b){if(b&&b.length>0){var c=new StringBuffer();
c.append('<option value="">请先选择仓库</option>');for(var a=0;a<b.length;a++){c.append("<option value='"+b[a].id+"'>"+b[a].name+"</option>");}$("#storeId").empty().append(c.toString()).select2();
}});},_initStore:function(){CateUtils.getOptions([{typeKey:"system",pKey:"soEntityStoreName",container:"shopName",fn:function(a){var e=new StringBuffer();
for(var c=0;c<a.length;c++){var d=a[c].value;var b=a[c].name;e.append("<option value='"+d+"'>"+b+"</option>");}$("#shopName").empty().append(e.toString()).attr("multiple",true).chosen("destroy").chosen();
}}]);},_saveSeaConfig:function(c){var a=this;var b=ctx+"/gl/cs/csSeaConfig/saveAdd.htm";var d={lastCompleteTime:a._getSeaConfigExpData("lastCompleteTime"),csCreateTime:a._getSeaConfigExpData("csCreateTime"),soTotal:a._getSeaConfigExpData("soTotal"),soCount:a._getSeaConfigExpData("soCount"),shopName:a._getSeaShopData("shopName"),skuCode:a._getSeaConfigExpData("skuCode"),shippingTime:a._getSeaConfigExpData("shippingTime"),soSub:a._getSeaConfigExpData("soSub"),groupId:c};
FormUtils.submit(b,d,function(e){if(e.success){$("#csSeaConfigContainer").modal("hide");DialogUtils.success("","修改成功");}});},_setSeaShopData:function(d,e){var c=this;
var f="";if(!d){return;}if(!e){$("#csSeaConfigForm select[name='"+d+"_c']").val("");return;}var a=e.split("_c_");if(a.length<2){return;}$("#csSeaConfigForm select[name='"+d+"_c']").val(a[0]);
var b=a[1].split(",");for(i=0;i<b.length;i++){f=b[i];$("#csSeaConfigForm select[name='"+d+"']"+" option[value='"+f+"']").attr("selected","selected");}$("#shopName").trigger("chosen:updated");
},_setSeaConfigExpData:function(b,c){if(!b){return;}if(!c){$("#csSeaConfigForm select[name='"+b+"_c']").val("");$("#csSeaConfigForm input[name='"+b+"']").val("");
return;}var a=c.split("_c_");if(a.length<2){return;}$("#csSeaConfigForm select[name='"+b+"_c']").val(a[0]);$("#csSeaConfigForm input[name='"+b+"']").val(a[1]);
},_getSeaConfigExpData:function(e){if(!e){return"";}var d=$("#csSeaConfigForm select[name='"+e+"_c']").val();var c=$("#csSeaConfigForm input[name='"+e+"']").val();
if(!d||!c){return"";}return d+"_c_"+c;},_getSeaShopData:function(e){if(!e){return"";}var d=$("#csSeaConfigForm select[name='"+e+"_c']").val();var c=$("#csSeaConfigForm select[name='"+e+"']").val();
if(!d||!c){return"";}return d+"_c_"+c;},_bindEventHander:function(){var a=this;$("#competencyConfigBtn").on("click",function(){$("#competencyConfigContainer").modal("show");
a._loadCompetencyConfig(a.currentRightClickTreeNode.id);});$("#saveCompetencyConfigBtn").on("click",function(){a._saveCompetencyConfig(a.currentRightClickTreeNode.id);
});$("#orgSeaConfigBtn").on("click",function(){$("#csSeaConfigContainer").modal("show");a._loadSeaConfig(a.currentRightClickTreeNode.id);});$("#saveSeaConfigBtn").on("click",function(){DialogUtils.confirmWithOptions({title:"确定修改公海规则吗？",text:"",confirmButtonText:"确定",yesFunc:function(){a._saveSeaConfig(a.currentRightClickTreeNode.id);
}});});$('input[name="isSale"]').on("click",function(){var b=$(this).val();if(b=="y"){$("#prodCatesDiv").show();$("#createToDiv").show();$("#transToDiv").show();
$("#secTypeDiv").show();$("#saleRangeDiv").show();$("#saleLineDiv").show();$("#salePercentDiv").show();$(".needFinanceConfirmDiv").show();$("[name=saleLine]").val(["one"]);
$("[name=needFinanceConfirm]").val(["y"]);$("[name=saleRange]").val("all");$("[name=saleRange]").attr("required",true);$("[name=saleLine]").attr("required",true);
$("[name=needFinanceConfirm]").attr("required",true);$("[name=prodCateNames]").attr("required",true);}else{if(b=="n"){$("#prodCatesDiv").hide();$("#createToDiv").hide();
$("#transToDiv").hide();$("#secTypeDiv").hide();$("#saleRangeDiv").hide();$("#saleLineDiv").hide();$("#salePercentDiv").hide();$(".needFinanceConfirmDiv").hide();
$("[name=createTo]").val("");$("[name=createToName]").val("");$("[name=transTo]").val("");$("[name=secType]").val("");$("[name=saleRange]").val("");$("[name=saleLine]").val([""]);
$("[name=needFinanceConfirm]").val(["y"]);$("[name=prodCates]").val("");$("[name=saleRange]").removeAttr("required");$("[name=saleLine]").removeAttr("required");
$("[name=needFinanceConfirm]").removeAttr("required");$("[name=prodCateNames]").attr("required",false);}}});$(document).on("mouseleave","#orgMenuContainer",function(){$(this).hide();
$("#orgContainer").show();$("#officerContainer").hide();});$(document).on("click",".chooseCreateTo",function(){var b=new EmployeesSelect();var c={grantType:"/role/",isMultiple:0,isSale:0,mode:0,callBack:function(d){$("[name=createToName]").val(d[0].aid+":"+d[0].name);
$("[name='createTo']").val(d[0].id);}};b.init(c);});$(document).on("click","#clearTransTo",function(){$("[name=transToName]").val("");$("[name='transTo']").val("");
});$(document).on("click","#clearCreateTo",function(){$("[name=createToName]").val("");$("[name='createTo']").val("");});$(document).on("click",".chooseTransTo",function(){var b=new EmployeesSelect();
var c={grantType:"/role/",isMultiple:0,isSale:0,mode:0,callBack:function(d){$("[name=transToName]").val(d[0].aid+":"+d[0].name);$("[name='transTo']").val(d[0].id);
}};b.init(c);});$(document).on("click",".chooseGroupMgr",function(){var b=new EmployeesSelect();var c={grantType:"/role/",isMultiple:0,isSale:0,mode:0,callBack:function(d){$("[name=groupMgrName]").val(d[0].aid+":"+d[0].name);
$("[name='groupMgr']").val(d[0].id);}};b.init(c);});$(document).on("click","#clearGroupMgr",function(){$("[name=groupMgrName]").val("");$("[name='groupMgr']").val("");
});$(document).on("click","[name=prodCateNames]",function(){ProdCateService.selectProdCateTreeBox({selectedCateId:$('[name="prodCates"]').val(),container:"prodCateNames",isMultiple:1,fn:function(b){$('[name="prodCates"]').val(b);
}});});$(document).on("click",".orgAddBtn",function(c){var b=a.getSelectDpm();if(b.length==0){DialogUtils.warning("无法执行","请先选择一个部门");return false;}a.currentRightClickTreeNode=b[0];
$("#orgAddBtn").trigger("click");});$(document).on("click",".orgUpdateBtn",function(c){var b=a.getSelectDpm();if(b.length==0){DialogUtils.warning("无法执行","请先选择一个部门");
return false;}a.currentRightClickTreeNode=b[0];$("#orgUpdateBtn").trigger("click");});$(document).on("click",".orgDelBtn",function(c){var b=a.getSelectDpm();
if(b.length==0){DialogUtils.warning("无法执行","请先选择一个部门");return false;}a.currentRightClickTreeNode=b[0];$("#orgDelBtn").trigger("click");});$(document).on("click",".orgRateBtn",function(b){});
$(document).on("click",".orgSeaConfigBtn",function(c){var b=a.getSelectDpm();if(b.length==0){DialogUtils.warning("无法执行","请先选择一个部门");return false;}a.currentRightClickTreeNode=b[0];
$("#orgSeaConfigBtn").trigger("click");});$(document).on("click",".orgSearchDpm",function(b){$(".jt-more-drop").hide("fast","swing",function(){$(".tree-div").css({"height":"calc(100% - 70px)"});
$(".jt-tree-search").stop().slideDown("fast");setTimeout(function(){$(".jt-more-drop").removeAttr("style");},250);});});$(document).on("click",".jt-tree-search-close",function(b){$(".jt-tree-search").stop().slideUp("fast");
$(".tree-div").removeAttr("style");});$("#orgAddBtn").on("click",function(){$("#orgModalLabel").text("添加部门");$("input[name='parentId']").val(a.currentRightClickTreeNode.id);
$("input[name='partyTypeKey']").val("organization");$("input[name='hasUser']").val("n");$("input[name='srcType']").val("admin");$("#orgModalContainer").modal("show");
$("#isSaleDiv").show();$("[name=saleRange]").val(["all"]);$("[name=saleLine]").val(["one"]);$("[name=needFinanceConfirm]").val(["y"]);$("[name=prodCates]").val(a.prodRootCate?a.prodRootCate.id:"");
$("[name=prodCateNames]").val(a.prodRootCate?a.prodRootCate.name:"");$("[name=isUpdateSubGroup]").val(["n"]);if(a.currentRightClickTreeNode.isSale=="y"){$("[name=isSale]").val(["y"]);
$("#isNotSale").attr("disabled","disabled");$("#prodCatesDiv").show();$("#createToDiv").show();$("#transToDiv").show();$("#groupMgrDiv").show();$("#secTypeDiv").show();
$("#saleRangeDiv").show();$("#saleLineDiv").show();$("#salePercentDiv").show();$(".needFinanceConfirmDiv").show();$("[name=saleLine]").attr("required",true);
$("[name=needFinanceConfirm]").attr("required",true);$("[name=saleRange]").attr("required",true);$("[name=prodCateNames]").attr("required",true);}else{$("#isNotSale").removeAttr("disabled");
$("[name=isSale]").val(["n"]);$("#prodCatesDiv").hide();$("#createToDiv").hide();$("#transToDiv").hide();$("#groupMgrDiv").hide();$("#secTypeDiv").hide();
$("#saleRangeDiv").hide();$("#saleLineDiv").hide();$("#salePercentDiv").hide();$(".needFinanceConfirmDiv").hide();$("[name=saleLine]").removeAttr("required").val([""]);
$("[name=needFinanceConfirm]").removeAttr("required").val(["y"]);$("[name=saleRange]").removeAttr("required").val([""]);$("[name=prodCateNames]").removeAttr("required").val("");
$("[name=prodCates]").val("");}ConfigUtils.findByKey("employee.isShowdeductRates",function(b){if(b.success){a.addDeductRates(false);}});});$("#orgUpdateBtn").on("click",function(){$("#orgModalLabel").text("更新部门");
$("#orgModalContainer").modal("show");$("input[name='partyTypeKey']").val("organization");$("input[name='hasUser']").val("n");$("input[name='srcType']").val("admin");
$("#isSaleDiv").show();$("[name=isUpdateSubGroup]").val(["n"]);FormUtils.loadData(ctx+"/gl/ou/group/edit.htm?id="+a.currentRightClickTreeNode.id,function(c){$("#orgForm").find("input[name='id']").val(c.id);
$("#orgForm").find("input[name='depth']").val(c.depth);$("#orgForm").find("input[name='path']").val(c.path);$("#orgForm").find("input[name='sort']").val(c.sort);
$("#orgForm").find("input[name='createBy']").val(c.createBy);$("#orgForm").find("input[name='createTime']").val(c.createTIme);$("input[name='parentId']").val(c.parentId);
$("#orgForm").find("input[name='name']").val(c.name);$("[name=secType]").val([c.secType]);$("[name=saleRange]").val([c.saleRange]);$("[name=saleLine]").val([c.saleLine]);
$("[name=needFinanceConfirm]").val([c.needFinanceConfirm]);$("[name=createTo]").val([c.createTo]);$("[name=createToName]").val([c.createToName]);$("[name=transTo]").val([c.transTo]);
$("[name=transToName]").val([c.transToName]);$("[name=groupMgrName]").val(c.groupMgrName);$("[name=groupMgr]").val(c.groupMgr);$("[name=workDays]").val([c.workDays]);
$("[name=workHours]").val([c.workHours]);$("[name=upperLimit]").val([c.upperLimit]);$("[name=smsLimit]").val([c.smsLimit]);$("[name=seaLimit]").val([c.seaLimit]);
$("[name=noOrderTime]").val([c.noOrderTime]);if(c.percentLimit){$("[name=percentLimit]").val([c.percentLimit]);}else{$("[name=percentLimit]").val("");}if(c.autoPercent){$("[name=autoPercent]").val([c.autoPercent]);
}else{$("[name=autoPercent]").val("");}$('select[name="prodCates"]').val((c.prodCates&&c.prodCates)?c.prodCates.split(","):"");$("[name=prodCates]").val(c.prodCates);
$("[name=prodCateNames]").val(c.prodCateNames);if(c.isParentIsSale){$("#isNotSale").attr("disabled","disabled");}else{$("#isNotSale").removeAttr("disabled");
}$("[name=isSale]").val([c.isSale]);if(c.isSale==="y"){$("#prodCatesDiv").show();$("#createToDiv").show();$("#transToDiv").show();$("#groupMgrDiv").show();
$("#secTypeDiv").show();$("#saleRangeDiv").show();$("#saleLineDiv").show();$("#salePercentDiv").show();$(".needFinanceConfirmDiv").show();$("[name=saleLine]").attr("required",true);
$("[name=needFinanceConfirm]").attr("required",true);$("[name=saleRange]").attr("required",true);$("[name=prodCateNames]").attr("required",true);}else{$("#prodCatesDiv").hide();
$("#createToDiv").hide();$("#transToDiv").hide();$("#groupMgrDiv").hide();$("#secTypeDiv").hide();$("#saleRangeDiv").hide();$("#saleLineDiv").hide();$("#salePercentDiv").hide();
$(".needFinanceConfirmDiv").hide();$("[name=saleRange]").removeAttr("required");$("[name=saleLine]").removeAttr("required");$("[name=needFinanceConfirm]").removeAttr("required");
$("[name=prodCateNames]").attr("required",false);}var d=a._getContainer("storeIds");var b=c.storeIds.split(",");if(d){d.selectpicker("val",b);d.selectpicker("refresh");
}ConfigUtils.findByKey("employee.isShowdeductRates",function(e){if(e.success){a.buildDeductRates(c.deductRates);}});});});$("#orgDelBtn").on("click",function(){DialogUtils.confirm(function(){FormUtils.submit(EmployeeGroup._CONS_.DELETEORG_URL,{ids:a.currentRightClickTreeNode.id},function(d){if(d.success){var b=$.fn.zTree.getZTreeObj("organizationTree");
var c=b.getNodeByTId(a.currentRightClickTreeNode.tId);b.removeChildNodes(c);b.removeNode(c);DialogUtils.success(msgCode.SUCCESS,"删除成功");}else{DialogUtils.error(msgCode.ERROR,d.msg);
}});});});$("#orgModalContainer").on("hidden.bs.modal",function(){FormUtils.clear("orgForm");$("#orgContainer").show();$("#officerContainer").hide();}).on("shown.bs.modal",function(){$("select[name='prodCates']").chosen("destroy");
$("select[name='prodCates']").chosen();});$("#saveOrgBtn").on("click",function(){if($("#orgForm").valid()){var f=$("#id").val();var b=$("#orgForm").find("input[name='id']").val()?ctx+"/gl/ou/group/saveEdit.htm":ctx+"/gl/ou/group/saveAdd.htm";
ButtonUtils.disableBtn("saveOrgBtn");var e=$("[name=isSale]:checked").val();if(e!="y"){$("[name=prodCates]").val("");$("[name=secType]").val("");$("[name=createTo]").val("");
$("[name=transTo]").val("");$("[name=createToName]").val("");$("[name=transToName]").val("");$("[name=saleRange]").val([""]);$("[name=saleLine]").val([""]);
$("[name=percentLimit]").val([""]);$("[name=needFinanceConfirm]").val(["y"]);}var c=$("#storeIds option:selected").length;if(c!=0){a._buildstoreIdlSearch(c);
}var d=$("#orgForm").serialize();d+="&deductRates="+a.getDeductRate();FormUtils.submit(b,d,function(m){ButtonUtils.enableBtn("saveOrgBtn");if(m.success){FormUtils.clear("orgForm");
$("#orgModalContainer").modal("hide");var h=$.fn.zTree.getZTreeObj("organizationTree");if(m.msgCode==actionCode.CREATE){DialogUtils.success("提示","添加成功");
var g=h.getNodeByTId(a.currentRightClickTreeNode.tId);g.isParent="true";h.updateNode(g);var j=JSON.parse(m.msg);h.addNodes(g,-1,j);}else{DialogUtils.success("提示","修改成功");
var k=h.getNodeByTId(a.currentRightClickTreeNode.tId);var l=JSON.parse(m.msg);k.name=l.name;k.isSale=l.isSale;h.updateNode(k);}}else{DialogUtils.error("失败",m.msg);
}},function(){ButtonUtils.enableBtn("saveOrgBtn");DialogUtils.error("错误","后台异常，请稍后重试");});}});$(document).on("click",".placeOrder",function(){if($(this).hasClass("btn-primary")){var c=$(CsEntityEdit._CONS_.FORM_ID).find("[name=id]").val();
var d=$("input[name='name']").val();var b=CsEntityEdit._CONS_.ORDER_PLACE_URL+"?isAdd=true&csId="+$(CsEntityEdit._CONS_.FORM_ID).find("[name=id]").val()+"&isPoint=false"+"&type="+type;
if(outNum){b=b+"&outNum="+outNum;}JTTabUtils.addOrRefreshTab(b,"客户["+d+"]下订单");}});$("#selectSkuBtn").on("click",function(){if($("select[name=storeId]").val()==""||$("select[name=storeId]").val()==null){DialogUtils.error(msgCode.WARING,"请先选择仓库");
return false;}var d=$("#csSeaConfigForm input[name='skuCode']").val();var e="";var c="product";var b="y";a.hadClose=false;SelectProdService.selectSku({storeId:$("select[name=storeId]").val(),isMultiple:1,type:c,canSale:"y",isSale:"y",userId:currentUserId,priceType:$("#prod-price-type").val(),hasStock:$("#hasStock").is(":checked")?"y":"n",limitProdCate:b,fn:function(f){for(var g=0;
g<f.length;g++){e+=f[g].prodName+",";}if(e!=null&&e.length>0){if(d!=""){e+=d;}e=(e.substring(e.length-1)==",")?e.substring(0,e.length-1):e;$("#csSeaConfigForm input[name='skuCode']").val(e);
}}});});$("#csSeaConfigContainer").on("hidden.bs.modal",function(){$("#csSeaConfigForm select[name='shopName']").val("");$("#shopName").trigger("chosen:updated");
a._initStore();});$(document).on("click",".deductRatesAdd",function(){a.addDeductRates(true);});$(document).on("click",".deductRatesRemove",function(){$(this).parents(".form-group").remove();
});},getSelectDpm:function(){return $.fn.zTree.getZTreeObj("organizationTree").getSelectedNodes();},setTreeBarsClick:function(a,c){var b=this;if($(a).length==0||$(c).length==0){return false;
}$(document).on("click",a,function(f){var d=b.getSelectDpm();if(d.length==0){DialogUtils.warning("无法执行","请先选择一个部门");return false;}b.currentRightClickTreeNode=d[0];
$(c).trigger("click");});},setTreeBarsLimit:function(b){var a=this;if(b.type=="employee"||b.isAgent){$(".jt-tree-bars").stop().hide();if($(".jt-tree-search").is(":visible")){$(".tree-div").css({"height":"calc(100% - 40px)"});
}else{$(".jt-tree-search").stop().show();}$(".jt-tree-search-close").hide();$(".search-div").css({"width":"100%"}).parent().css({"margin-top":"8px"});}else{if($(".jt-tree-bars").is(":hidden")){$(".jt-tree-bars").stop().show();
$(".tree-div").css({"height":"calc(100% - 80px)"});$(".search-div").removeAttr("style").parent().css({"margin-top":0});$(".jt-tree-search-close").show();
}}if(b.isSale=="y"){$(".orgRateBtn").show();}else{$(".orgRateBtn").hide();}if(b.isParent){$(".orgDelBtn").stop().hide();}else{$(".orgDelBtn").stop().show();
}if($(".jt-tree-bars").children("button:visible").eq(0).is(".orgTreeMoreBars")){$(".orgTreeMoreBars").children(".jt-more-drop").addClass("only");}else{$(".orgTreeMoreBars").children(".jt-more-drop").removeClass("only");
}},_buildstoreIdlSearch:function(b){var a=this;var c=new StringBuffer();$("#storeIds option:selected").each(function(d){if($(this).val()){c.append($(this).val());
}if(d==b-1){return false;}else{c.append(",");}});$("input[name=storeIds]").val(c.toString());},getDeductRate:function(){var b=new StringBuffer();$("#deductRatesDiv .form-group").each(function(c){if($(this).find("input[name=deductRatesStart]").val()&&$(this).find("input[name=deductRatesEnd]").val()&&$(this).find("input[name=deductRatesPercent]").val()){b.append($(this).find("input[name=deductRatesStart]").val()+","+$(this).find("input[name=deductRatesEnd]").val()+","+$(this).find("input[name=deductRatesPercent]").val()+"|");
}});var a=b.toString();if(a.length>1){a=a.substring(0,a.length-1);}return a;},buildDeductRates:function(e){var b=this;if(e){var f=new StringBuffer();var d=e.split("|");
for(var c=0;c<d.length;c++){var a=d[c].split(",");f.append("<div class='form-group'>");f.append("<label class='col-sm-2 control-label'>梯度等级设置</label>");
f.append("<div class='col-sm-2'>");f.append("<input name='deductRatesStart' placeholder='' value='"+a[0]+"' class='form-control' validateType='default'>");
f.append("</div>");f.append("<div class='col-sm-1'>");f.append("<span style='margin-left:7px;margin-top:3px;'>&lt; = X &lt; </span>");f.append("</div>");
f.append("<div class='col-sm-2'>");f.append("<input name='deductRatesEnd' placeholder='' value='"+a[1]+"' class='form-control' validateType='default'>");
f.append("</div>");f.append("<label class='col-sm-2 control-label'>提成百分比</label>");f.append("<div class='col-sm-1'>");f.append("<input name='deductRatesPercent' placeholder='' value='"+a[2]+"' class='form-control' validateType='default'>");
f.append("</div>");f.append("<div class='col-sm-1'>");f.append("<span>%</span>");f.append("</div>");f.append("<div class='col-sm-1'>");f.append("<button type='button' class='btn btn-sm btn-primary deductRatesAdd'><i class='fa fa-plus'></i></button>&nbsp;");
f.append("<button type='button' class='btn btn-sm btn-danger deductRatesRemove'><i class='fa fa-times'></i></button>");f.append("</div>");f.append("</div>");
}$("#deductRatesDiv").empty().append(f.toString());}else{b.addDeductRates(false);}},addDeductRates:function(a){var b=new StringBuffer();b.append("<div class='form-group'>");
b.append("<label class='col-sm-2 control-label'>梯度等级设置</label>");b.append("<div class='col-sm-2'>");b.append("<input name='deductRatesStart' placeholder='' class='form-control' validateType='default'>");
b.append("</div>");b.append("<div class='col-sm-1'>");b.append("<span style='margin-left:7px;margin-top:3px;'>&lt; = X &lt; </span>");b.append("</div>");
b.append("<div class='col-sm-2'>");b.append("<input name='deductRatesEnd' placeholder='' class='form-control' validateType='default'>");b.append("</div>");
b.append("<label class='col-sm-2 control-label'>提成百分比</label>");b.append("<div class='col-sm-1'>");b.append("<input name='deductRatesPercent' placeholder='' class='form-control' validateType='default'>");
b.append("</div>");b.append("<div class='col-sm-1'>");b.append("<span>%</span>");b.append("</div>");b.append("<div class='col-sm-1'>");b.append("<button type='button' class='btn btn-sm btn-primary deductRatesAdd'><i class='fa fa-plus'></i></button>&nbsp;");
b.append("<button type='button' class='btn btn-sm btn-danger deductRatesRemove'><i class='fa fa-times'></i></button>");b.append("</div>");b.append("</div>");
if(a){$("#deductRatesDiv").append(b.toString());}else{$("#deductRatesDiv").empty().append(b.toString());}},_selectOrg:function(d){var b=this;var g=[];var a=d;
while(a){g.push(a);a=a.getParentNode();}var f=new StringBuffer();for(var c=g.length-1;c>=0;c--){if(c==0){f.append('<li class="active">'+g[c].name+"</li>");
}else{f.append("<li>"+g[c].name+"</li>");}}$(".breadcrumb").empty().append(f.toString());var e={treeNodeId:d.id,treeNodeType:d.type};if(b.employee._hadInitJqgrid){b.employee._reloadJqgrid(e);
}else{b.employee._hadInitJqgrid=true;b.employee._initJqgrid(e);}},_bindFormValidation:function(){jQuery.validator.addMethod("isNumber",function(c,b){return this.optional(b)||/^[-\+]?\d+$/.test(c)||/^[-\+]?\d+(\.\d{1}|\.\d{2})?$/.test(c);
},"只能输入两位小数");var a={rules:{name:{required:true},isSale:{required:true},workHours:{isNumber:true,min:0.01},workDays:{isNumber:true,min:0.01},smsLimit:{required:false,digits:true,min:0,},percentLimit:{digits:true,number:true,min:10,max:100},autoPercent:{digits:true,number:true,min:0,max:100}}};
FormUtils.bindFormValidation("orgForm",a);}};