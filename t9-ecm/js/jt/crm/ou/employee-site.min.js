var GroupUtils={loadGroupOptions:function(a){a.url=ctx+"/gl/ou/group/listData.htm";if(!a.positionType){a.url=a.url+"?type=dept_manager";}a.key="id";a.keyName="name";
a.caption="请选择部门";return OptionsBaseUtils.getOptions(a);},selectGroupTreeBox:function(a){var b={selectedIds:jQuery.isArray(a.selectedGroupId)?a.selectedGroupId.toString():a.selectedGroupId,container:a.container,treeId:"menuContentForGroup"+a.container.split(" ")[0],isMultiple:a.isMultiple,otherParam:{selectedGroupId:a.selectedGroupId},url:ctx+"/gl/ou/group/listData.htm",fn:a.fn,isSale:a.isSale,positionType:a.positionType,hideSale:a.hideSale?a.hideSale:false,isSmsConfigHtml:a.isSmsConfigHtml,isReDisabled:a.isReDisabled?a.isReDisabled:false};
if(a.isEqWidth){b.isEqWidth=true;}if(a.isAutoHeight){b.isAutoHeight=true;}if(!b.positionType){b.url=b.url+"?type=dept_manager";}else{b.url=b.url+"?type="+b.positionType;
}if(a.isSale){b.url=b.url+"?type="+b.positionType+"&isSale=y";}if(a.agentId){b.url=b.url+"&agentId="+a.agentId;}b.dataFilter=function(f,c,g){if(g&&g.length){for(var e=0;
e<g.length;e++){var d=g[e];if(d.isSale=="y"&&!b.hideSale){d.name=d.name+"【销】";d.font={"color":"red"};}}}if(a.dataFilter){return a.dataFilter(f,c,g);}else{return g;
}};CateUtils.selectTreeBox(b);},selectGroup:function(c){var e=c.selectedGroupId?c.selectedGroupId:"";var d=c.hasOwnProperty("isMultiple")&&c.isMultiple;
var a=this;var b=ctx+"/gl/ou/group/listData.htm";if(!c.positionType){b+="?type=dept_manager";}if(jQuery.isArray(e)){e=e.toString();}layer.open({type:1,title:"选择部门",shadeClose:false,btn:["确定","关闭"],area:["70%","70%"],scrollbar:false,maxmin:false,content:'<ul id="organizationSelTree" class="ztree" style="width:260px; overflow:auto;"></ul>',success:function(f,j){var g=this;
var k={async:{enable:true,url:b,contentType:"application/json",dataType:"json",type:"get",autoParam:["id"],otherParam:{selectedGroupId:e},dataFilter:function(o,l,p){if(p&&p.length){for(var n=0;
n<p.length;n++){var m=p[n];if(m.isSale=="y"){m.name=m.name+"【销】";m.font={"color":"red"};}}}return p;},},data:{simpleData:{enable:true,idKey:"id",pIdKey:"parentId"}},check:{enable:true,chkStyle:d?"checkbox":"radio",chkboxType:{"Y":"s","N":"s"},radioType:"all"},callback:{onClick:function h(m,p,o){var n=o.getCheckStatus().checked;
var l=$.fn.zTree.getZTreeObj("organizationSelTree");l.checkNode(o,!n,false);},onAsyncSuccess:function(n,p,o,q){var m=$.fn.zTree.getZTreeObj("organizationSelTree");
if(!o){var l=m.getNodes()[0];m.expandNode(l,true,false,true);}}}};$.fn.zTree.init($("#organizationSelTree"),k);},yes:function(j,g){var h=$.fn.zTree.getZTreeObj("organizationSelTree");
var f=h.getCheckedNodes(true);var l=[];for(var k=0;k<f.length;k++){var m={id:f[k].id,name:f[k].name};l.push(m);}if(c.fn){c.fn(l);}layer.close(j);}});}};
var SecureLogService={openEmployeeSecureLog:function(a){if(!ResUtils.canShow("employee.button.showSecureOperLog")){throw new Error("没有权限访问");}if(!a||!a.operatorId){throw new Error("请提供要查询的员工");
}layer.open({type:2,title:"员工日志查询",maxmin:false,shadeClose:true,skin:"cs-opt-layer",btn:["关闭","关闭"],area:["95%","95%"],content:ctx+"/gl/secure/secureOperLog/list.htm"+"?enterType=employee&Q__S__EQ__operator_id_="+a.operatorId,yes:function(c,b){layer.close(c);
},cancel:function(c,b){layer.close(c);}});},openModuleSecureLog:function(c){if(!c||!c.configKeys||!c.linkId){throw new Error("参数错误");}var a=c.openType?a:"dialog";
if("dialog"==a){layer.open({type:2,title:"操作记录",maxmin:false,shadeClose:true,area:["95%","95%"],content:ctx+"/gl/secure/secureOperLog/list.htm"+"?enterType=moduleDetail&configKeys="+c.configKeys+"&linkIds="+c.linkId,});
}else{var d=null;if(c.container){if($.type(c.container)=="string"){d=$(c.container);if(d.length==0){d=$("#"+c.container);if(d.length==0){d=$("."+c.container);
if(d.length==0){throw new Error(c.container+"下拉列表容器不能为空");}}}}else{d=c.container;}}else{throw Error("参数错误:必须传入container");}var b=this;var e=new StringBuffer();
e.append("<div id='secureOperLogDiv'>");e.append("<table class='table table-striped table-bordered' id='secureOperLogTable'>");e.append("<thead><tr>");
e.append("<th>操作名称</th>");e.append("<th>操作人</th>");e.append("<th>部门</th>");e.append("<th>时间</th>");e.append("<th>关联</th>");e.append("<th>关联名称</th>");e.append("<th>类型</th>");
e.append("</tr></thead>");e.append("</table>");e.append("</div>");d.empty().append(e.toString());$("#secureOperLogTable").DataTable({ajax:{url:ctx+"/gl/secure/secureOperLog/listTableData.htm?rows=100000&configKeys="+c.configKeys+"&linkIds="+c.linkId,},columns:[{data:"id",width:"15%",render:function(h,g,f){return f.configName;
}},{data:"operatorAid",width:"15%",render:function(h,g,f){return f.operatorAid+" : "+f.operatorName;}},{data:"groupName",width:"15%"},{data:"createTime",width:"15%"},{data:"linkShowUnique",width:"15%"},{data:"linkNames",width:"15%"},{data:"logType",render:function(j,h,g){var f=null;
if("opertate_type"==j){f="操作日志";}else{f="安全日志";}return f;},width:"15%"},],rowId:"id",lengthMenu:[[20]],paging:true,pagingType:"simple",lengthChange:false,autoWidth:true,ordering:false,searching:false,});
}},};function Employee(){this.hadInit=false;this.isEdit=false;this.isAdd=false;this.isFormDataChange=false;this._hadInitJqgrid=false;this.userPw=new UserPw();
this.addrService=null;this.addressService=new AddressService("addrContainer");this.commonEav=null;this.employeeGroup=new EmployeeGroup(this);this.employeeEditBatch=new EmployeeEditBatch(this);
this.employeeRate=new EmployeeRate(this);this.employeePercent=new EmployeePercent(this);this.isBatchCreateSwitchery=null;this.seniorSearch=new SeniorSearch();
if(type.length==0){this.teamPk=new TeamPk();}else{$(".teamManage").hide();}}Employee._CONS_={PAGER:"#employeePager",LIST_DATA_URL:ctx+"/crm/ou/employee/listData.htm?searchInterest=no&searchPerformance=no",SAVE_ADD_URL:ctx+"/crm/ou/employee/saveAdd.htm",SAVE_EDIT_URL:ctx+"/crm/ou/employee/saveEdit.htm",DELETE_URL:ctx+"/crm/ou/employee/delete.htm",CANCEL_URL:ctx+"/crm/ou/employee/cancel.htm",FORCE_LOGOUT_URL:ctx+"/crm/ou/employee/forceLogout.htm",REFRESHCREDIT_URL:ctx+"/crm/ou/employee/refreshCredit.htm",ACTIVE_URL:ctx+"/crm/ou/employee/active.htm",EXPORT_URL:ctx+"/crm/ou/employee/export.htm",SHOW_RES_TREE_URL:ctx+"/crm/ou/user/showUserResTree.htm",DE_IMG:'<img style=\'width:100px; height:100px;\' alt="默认图片"  src="'+ctx+'/img/jt/nophoto.png" />',LIST_ROLE_DATA_URL:ctx+"/crm/ou/role/listRoleByAgent.htm",RESET_PASS_URL:ctx+"/crm/ou/user/resetPass.htm",ADD_EMP_URL:ctx+"/crm/ou/employee/addEmployee.htm",GRID:"#employeeGrid",PARTY_FORM_ID:"#partyForm",DETAIL_FOMR_ID:"#detailForm",COMMON_EAV_PARAM:{eavSetKey:"employee",containerId:"eavCommonContainer"},EMP_EDIT_URL:ctx+"/crm/ou/employee/editEmp.htm",EDIT_URL:ctx+"/crm/ou/employee/edit.htm",DETAIL_URL:ctx+"/crm/ou/employee/detail.htm",PERSON_DEATAIL_URL:ctx+"/crm/ou/employee/personDetail.htm",LIST_ID_DATA:ctx+"/crm/ou/employee/listIdData.htm",IMPORT_EXCEL_URL:ctx+"/crm/ou/employee/importExcel.htm",EMP_PK_URL:ctx+"/crm/ou/employee/findEmpPk.htm",CLEAR_PK_URL:ctx+"/gl/ou/employeePk/deleteByEmpId.htm",GROUPNAMES:""};
Employee.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._isGroupMgr();a.userPw.init();a.employeeGroup.init(a.seniorSearch);a.employeeRate.init();
a.employeePercent.init();a.addressService.init({rowFit:"y",isNotRequired:true});a.employeeEditBatch.init();a._hideNotGrantBtn();a._bindFormValidation();
a._bindEventHander();a.seniorSearch.init();a.commonEav=new Eav(Employee._CONS_.COMMON_EAV_PARAM);a._resetRoleChosen();a._initCustomerGroup();$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",});
RoleUtils.loadEcmRoleOpt({fn:function(e){if(e){var d=new StringBuffer();d.append('<option value="">请选择</option>');for(var c=0;c<e.length;c++){d.append("<option value='"+e[c].id+"'>"+e[c].name+"</option>");
}$("#roleSearchSelect").empty().append(d.toString()).select2();}}});ReportDateUtil.initDate(".report-content");a._loadUserLoginState();this._locateToGlHelp();
}},_initCustomerGroup:function(){var a=this;var b=ctx+"/gl/ou/customerGroup/findAll.htm";FormUtils.loadData(b,function(c){if(c.length>0){var e=new StringBuffer();
for(var d=0;d<c.length;d++){e.append("<option value='"+c[d].id+"'>"+c[d].name+"</option>");}$("#customerGroupSelect").empty().append(e.toString());$("#customerGroupSelect").chosen("destroy");
$("#customerGroupSelect").chosen();}});},_isGroupMgr:function(){if("myGroup"==type){$(".myGroup").show();$(".employeeBtnGroup").hide();FormUtils.loadData(ctx+"/crm/ou/employee/isGroupMgr.htm",function(a){if(a.success==false){$("#cancelEmp").hide();
$("#addEmp").hide();$("#editEmp").hide();}else{$("#cancelEmp").show();$("#editEmp").show();Employee._CONS_.GROUPNAMES=a.msg;}});}},_locateToGlHelp:function(){if(type=="myGroup"){var a="glHelp.group_employee.myGroup";
}else{var a="glHelp.group_employee.employee";}glHelpUtil.init(a);},_loadUserLoginState:function(){var a=this;FormUtils.loadData(ctx+"/crm/ou/user/userOnlineState.htm",function(b){if(b){$("#userState").show();
if("myGroup"==type){$("#userState").empty();}else{$("#userState").empty().append(a._createUserStateStr(b,deploySys));}}});},_createUserStateStr:function(b,a){var c=new StringBuffer();
c.append('<span style="font-weight:bold;">授权在线(<span style="font-size:'+this._getSize(b.activedUserCount,b.maxActiveUserCount)+";color:"+this._getColor(b.loginUserCount,b.maxLoginUserCount)+'">'+b.loginUserCount+"/"+b.maxLoginUserCount+"</span>)</span>");
if(b.loginUserCount>b.maxLoginUserCount*0.9){c.append('<span><i title="授权将达上限，请联系购买" class="fa fa-exclamation-triangle"></i></span>');}c.append('<span style="font-weight:bold;">激活(<span style="font-size:'+this._getSize(b.activedUserCount,b.maxActiveUserCount)+";color:"+this._getColor(b.activedUserCount,b.maxActiveUserCount)+'">'+b.activedUserCount+"/"+b.maxActiveUserCount+")</span></span>");
if(a&&a.indexOf("scm")>-1){c.append("|").append('<span style="font-weight:bold;">SCM授权在线(<span style="font-size:'+this._getSize(b.scmloginUserCount,b.scmmaxLoginUserCountt)+";color:"+this._getColor(b.scmloginUserCount,b.scmmaxLoginUserCount)+'">'+b.scmloginUserCount+"/"+b.scmmaxLoginUserCount+"</span>)</span>").append('<span style="font-weight:bold;">激活(<span style="font-size:'+this._getSize(b.scmloginUserCount,b.scmmaxLoginUserCount)+";color:"+this._getColor(b.scmactivedUserCount,b.scmmaxActiveUserCount)+'">'+b.scmactivedUserCount+"/"+b.scmmaxActiveUserCount+"</span>)</span>");
}return c.toString();},_getSize:function(a,c){var b=a/c;if(b>=0.95){return"18px";}},_getColor:function(a,c){var b=a/c;if(b>=0.95){return"red";}else{if(b>=0.8){return"#ea7f09";
}else{return"green";}}},_clear:function(c){var a=this;function b(){$(Employee._CONS_.PARTY_FORM_ID).validate().resetForm();a._resetTab();$(".deletedHide").show();
$(".addPhoneRow").show();$(".operateCol").show();$(".list_wrapper").show();$(".form_wrapper").stop().animate({"left":$(".form_wrapper").outerWidth()+15+"px"},"fast");
$("#custRelTabLi").show();$("#resTip").text("").hide();$(".saveBtn").show();$("#eavCommonContainer").empty();FormUtils.clear("partyForm");$("input[name=aid]").removeAttr("readonly");
$("#partyForm [name=status]").val(["actived"]).trigger("change");$("[name=name]").attr("required","true");$(".addGroup").hide();$("#batch-create-info").hide();
$(".not-batch-create").show();$("#batch-create-label").empty().hide();$(".dataGroup").show();$("#partyForm").find("input[name=title]").val(["男士"]);$("[name=createTime]").text("");
$("[name=updateTime]").text("");$("[name='lastLoginSys']").text("");$("[name='lastLoginCti']").text("");$("[name=adn]").text("");$("#csCount").text("").attr("disabled",true);
$("#selectOrganization").attr("disabled",false);$("#selectDefaultImageBtn").attr("disabled",false);$("#imageConatiner").empty();$(".addPhonePanel tbody").empty();
$(".addPhonePanel tbody").find("input").attr("disabled",false);$(".deleteRow").show();$(".showWhenNoPhone").hide();if(a.isAdd){$(".employeeAdd").trigger("click");
return false;}a.isEdit=false;a.isFormDataChange=false;if(c){$(".employeeSearch").trigger("click");}}if(a.isFormDataChange){DialogUtils.warning(function(){b();
});}else{b();}},_getParams:function(){var h=this;var c=($("[name=roleIds]").val()&&$("[name=roleIds]").val().length>0)?$("[name=roleIds]").val().join(","):"";
var b="&"+$(Employee._CONS_.PARTY_FORM_ID).serialize();var f=($("#imageConatiner").find("div.file").length)?("&profile="+$("#imageConatiner").find("div.file").attr("urlVal")):"";
if(f.indexOf("?")>-1){f=f.split("?")[0];}var a="&"+$(Employee._CONS_.DETAIL_FOMR_ID).serialize()+f;var g="&"+this.commonEav.getEavParams();var e=h._getAddrsJson();
var j="&userPo.id="+$("[name=id]").val()+"&userPo.account="+$("[name=aid]").val()+"&userPo.roleIds="+c;var d=b+"&"+e+"&"+j+"&"+g+"&"+a;return d;},_commitUpdateFunc:function(b,a){var c=this;
var d=c._getParams();FormUtils.submit(b,d,function(e){$(".saveBtn").attr("disabled",false);if(e.success){DialogUtils.success("提示",e.msg);c.isFormDataChange=false;
c.isEdit=false;if(a){a();}else{c._clear(true);}}else{DialogUtils.error("失败",e.msg);}},function(){$(".saveBtn").attr("disabled",false);DialogUtils.error("错误","后台异常，请稍后重试");
});},_batchCreate:function(){var b=this;var d=$(Employee._CONS_.PARTY_FORM_ID).valid()&&this.commonEav.isValid()&&$(Employee._CONS_.PARTY_FORM_ID).valid();
if(d){}else{return false;}var c=b._getParams();var a=ctx+"/crm/ou/employee/batchCreate.htm";FormUtils.submit(a,c,function(e){$(".saveBtn").attr("disabled",false);
if(e.success){DialogUtils.success(msgCode.SUCCESS,e.msg);b.isFormDataChange=false;b.isEdit=false;b._clear(true);}else{DialogUtils.error("失败",e.msg);}},function(){$(".saveBtn").attr("disabled",false);
DialogUtils.error("错误","后台异常，请稍后重试");});},_saveEmployee:function(a){var b=this;var c=$(Employee._CONS_.PARTY_FORM_ID).valid()&&this.commonEav.isValid()&&$(Employee._CONS_.PARTY_FORM_ID).valid();
if(c){}else{return false;}$(".saveBtn").attr("disabled",true);b._commitUpdateFunc(a);},_add:function(d){var a=this;$("#saveAddBtn").show();$("[name=sys]").val(d);
$("input[name='groupId']").val(a.employeeGroup.currentClickTreeNode.id);$("#groupName").val(a.employeeGroup.currentClickTreeNode.name);$("#saveEmpTip").show();
$(".dataGroup").hide();$(".addGroup").show();$(".outSideDiv").hide();$(".is-batch-create-status").empty().append('<input type="checkbox" value="y" name="isBatchCreate" class="js-switch" />');
a.isBatchCreateSwitchery=new Switchery(document.querySelector(".is-batch-create-status .js-switch"),{size:"small"});a.isBatchCreateSwitchery.handleOnchange=function(g){if(g){$("#batch-create-info").show();
$(".not-batch-create").hide();var h=new StringBuffer();h.append('<div class="col-sm-6 batch-create" style="float:left;">');h.append('<div class="input-group">');
h.append('<input required="true" digits="true" min="1" max="1000" name="batchCreateCount" placeholder="" validatetype="default" type="text" class="form-control">');
h.append('<span class="input-group-addon">个</span>');h.append("</div>");h.append("</div>");$("#batch-create-info").empty().append(h.toString());var f=new StringBuffer();
f.append('<div class="control-label batch-create" style="text-align:left;">');f.append("<strong>(工号顺序递增)</strong>");f.append("</div>");$("#batch-create-label").empty().show().append(f.toString());
}else{$("#batch-create-info").empty();$(".not-batch-create").show();$("#batch-create-info").hide();$("#batch-create-label").empty().hide();}};$(".list_wrapper").hide();
$(".form_wrapper").stop().animate({"left":"15px"},"fast");$("#roleSelect").empty();$("#partyForm [name=status]").val(["actived"]);$("#partyForm [name=title]").val(["男士"]);
var c="/img/jt/defaulTouXiang.png";var e=[{url:c,name:"",id:""}];var b=ImageUtils.createImageDivStr(e);$("#imageConatiner").empty().append(b);$(".deleteImage ").hide();
this._loadRoleData("roleSelect",null,d);this.commonEav.renderEavForm();},_addEmp:function(b){var a=this;$.ajax({url:Employee._CONS_.ADD_EMP_URL,type:"POST",dataType:"JSON",success:function(e){$(".dataGroup").hide();
$(".addGroup").show();$(".is-batch-create-status").empty().append('<input type="checkbox" value="y" name="isBatchCreate" class="js-switch" />');a.isBatchCreateSwitchery=new Switchery(document.querySelector(".is-batch-create-status .js-switch"),{size:"small"});
a.isBatchCreateSwitchery.handleOnchange=function(h){if(h){$("#batch-create-info").show();$(".not-batch-create").hide();var j=new StringBuffer();j.append('<div class="col-sm-6 batch-create" style="float:left;">');
j.append('<div class="input-group">');j.append('<input required="true" digits="true" min="1" max="1000" name="batchCreateCount" placeholder="" validatetype="default" type="text" class="form-control">');
j.append('<span class="input-group-addon">个</span>');j.append("</div>");j.append("</div>");$("#batch-create-info").empty().append(j.toString());var g=new StringBuffer();
g.append('<div class="control-label batch-create" style="text-align:left;">');g.append("<strong>(工号顺序递增)</strong>");g.append("</div>");$("#batch-create-label").empty().show().append(g.toString());
}else{$("#batch-create-info").empty();$(".not-batch-create").show();$("#batch-create-info").hide();$("#batch-create-label").empty().hide();}};$(".list_wrapper").hide();
$(".form_wrapper").stop().animate({"left":"15px"},"fast");$("#roleSelect").empty();$("#partyForm [name=status]").val(["actived"]);$("#partyForm [name=title]").val(["男士"]);
GroupUtils.selectGroupTreeBox({selectedGroupId:$('input[name="groupId"]').val(),container:"groupName",isReDisabled:true,positionType:type=="search"?"all":"dept_manager,cs_search",fn:function(g){$('input[name="groupId"]').val(g);
},dataFilter:function(k,g,l){if(l&&l.length){for(var j=0;j<l.length;j++){var h=l[j];if(h.isAgent=="y"){h.chkDisabled=true;}}}return l;}});$("[name=sys]").val(b);
var d=e[0];if(d&&d.length>0){var f=new StringBuffer();for(var c=0;c<d.length;c++){f.append("<option value='"+d[c].id+"'>"+d[c].name+"</option>");}$("#roleSelect").append(f.toString());
$("#roleSelect").chosen("destroy");$("#roleSelect").chosen();}a.commonEav.renderEavForm();}});},_edit:function(a){$(".saveBtn").html("保存");this._loadEmpPkData(a);
$(".dataGroup").show();$(".addGroup").hide();$(".list_wrapper").hide();$(".form_wrapper").stop().animate({"left":"15px"},"fast");$(".addAddr").show();$("#selectOrganization").show();
$("#selectDefaultImageBtn").show();$(".edit-addr").show();$(".operation").show();$("#saveEmpTip").hide();$("input[name='adn']").attr("readonly","readonly");
$(".employeePkDiv").show();this._loadData(a);this.commonEav.setEntityId(a);this.commonEav.renderEavForm();FormUtils.enableForm("partyForm");},_detail:function(b,a){$(".dataGroup").show();
$(".deleteImage").hide();$(".addGroup").hide();$(".list_wrapper").hide();$(".form_wrapper").stop().animate({"left":"15px"},"fast");$(".addPhoneRow").hide();
$(".operateCol").hide();$(".addAddr").show();$("#selectOrganization").show();$("#selectDefaultImageBtn").show();$(".edit-addr").show();$(".operation").show();
$("#saveEmpTip").hide();$("input[name='adn']").attr("readonly","readonly");this._loadData(b,true,a);$(".addAddr").hide();$("#selectOrganization").attr("disabled",true);
$("#selectDefaultImageBtn").hide();$("img.deleteImage").hide();$(".edit-addr").hide();$(".operation").hide();$(".saveBtn").hide();FormUtils.disableForm("partyForm");
this.commonEav.setEntityId(b);this.commonEav.renderEavForm(function(){$("#eavCommonContainer form").find("input,select,textarea").attr("disabled","disabled");
});},_loadData:function(e,b,d){var a=this;var c="";if(b){if(d){c=Employee._CONS_.PERSON_DEATAIL_URL;}else{c=Employee._CONS_.DETAIL_URL;}}else{c=Employee._CONS_.EDIT_URL;
}FormUtils.loadData(c+"?id="+e,function(k){if(e=="admin"){$("[name=aid]").attr("readonly",true);}$("[name=sys]").val(k.sys);if(k.sex!=""){$("input[name='sex'][value="+k.sex+"]").attr("checked",true);
}$("[id=id]").val(k.id);$("[id=name]").val(k.name);$("[name=agentId]").val(k.agentId);$("[name=aid]").val(k.aid);$("#partyForm").find("[name=status]").val([k.status]);
$("[id=desc]").val(k.desc);$("#csCount").text(k.csCount).attr("disabled",true);$("#roleSelect").empty();$("[name=groupId]").val(k.groupId);$("[name=groupName]").val(k.orgName);
$("[name=position]").val(k.position);$("[name=positionNames]").val(k.positionNames);$("[name=wxCsToAid]").val(k.wxCsToAid);$("[name='lastLoginSys']").text(k.lastLoginSys?k.lastLoginSys:"无");
$("[name='lastLoginCti']").text(k.lastLoginCti?k.lastLoginCti:"无");$("[name='createTime']").text(k.createTime?k.createTime:"无");$("[name=adn]").text(k.adn?k.adn:"无");
$("#employeePk").val(k.employeePk).trigger("change");$(".removeEmpPk").attr({"id":e});$("input[name=activeTime]").val(k.activeTime);var n="";if(k.profile==""){var l="/img/jt/defaulTouXiang.png";
n=[{url:l,name:"",id:""}];}else{n=[{url:k.profile,name:"",id:""}];}var j=ImageUtils.createImageDivStr(n);$("#imageConatiner").empty().append(j);$("[name='userPo.mobile']").val(k.userPo.mobile);
$("[name='userPo.email']").val(k.userPo.email);$("[name='userPo.ipAddr']").val(k.userPo.ipAddr);if(k.userPo.visitScope=="both"){$(".outSideDiv").show();
}else{$(".outSideDiv").hide();}$("[name='userPo.visitScope']").val(k.userPo.visitScope);$("[name='userPo.beginHm']").val(k.userPo.beginHm);$("[name='userPo.endHm']").val(k.userPo.endHm);
$("[name='userPo.outIpAddr']").val(k.userPo.outIpAddr);a._loadRoleData("roleSelect",k.userPo.id,$("[name=sys]").val());$("[name='customerGroup']").val(k.customerGroup);
$("#customerGroupSelect").chosen("destroy");$("#customerGroupSelect").chosen();var h=b?true:false;$("[name=addr]").val(k.address);a.addressService.init({country:"ChinaCityCateType-root",province:k.province,city:k.city,area:k.area,town:k.town,rowFit:"y",isNotRequired:true,disabled:h,isHideCountry:true});
if(b){$("img.deleteImage").hide();}var m=new StringBuffer();var f=k.userPo.userRoleList;for(var g=0;g<f.length;g++){m.append(f[g].exportColumns);if(g!=f.length-1){m.append(",");
}}personalGrantExportColumns=m.toString();});},_loadRoleData:function(d,c,b){var a=this;FormUtils.loadData(Employee._CONS_.LIST_ROLE_DATA_URL+"?id="+c+"&sys="+b,function(f){if(f.success){var e=JSON.parse(f.msg);
a._resetRoleChosen(e,[]);}else{DialogUtils.error("错误",f.msg);}});},_resetRoleChosen:function(d,a){var e=new StringBuffer();if(d&&d.length>0){for(var c=0;
c<d.length;c++){if(d[c].selected==true){e.append("<option value='").append(d[c].value).append("' selected='selected'>").append(d[c].name).append("</option>");
}else{e.append("<option value='").append(d[c].value).append("' ");for(var b=0;b<a.length;b++){if(d[c].value==a[b]){e.append("selected='selected' ");break;
}}e.append(">").append(d[c].name).append("</option>");}}}$("#roleSelect").empty().append(e.toString());$("#roleSelect").chosen("destroy");$("#roleSelect").chosen({width:"100%"});
},_bindEventHander:function(){var a=this;$(document).on("click","#groupInfo",function(){$(".groupType").show();$(".teamType").hide();$(this).addClass("activeBtn");
$("#teamInfo").removeClass("activeBtn");});$(document).on("click","#teamInfo",function(){$(".teamType").show();$(".groupType").hide();$(this).addClass("activeBtn");
$("#groupInfo").removeClass("activeBtn");a.teamPk.init();});$(document).on("click",".chooseWxCsToAid",function(){var c=new EmployeesSelect();var d={grantType:"/role/",isMultiple:0,isSale:0,mode:0,callBack:function(e){$("[name=wxCsToAid]").val(e[0].aid);
}};c.init(d);});$(document).on("click",".removeWxCsToAid",function(){$("[name=wxCsToAid]").val("");});$(window).on("resize",function(){$("#roleSelect").chosen("destroy");
$("#roleSelect").chosen({width:"100%"});var c=$("#imageConatiner").width();$(".file").width(c);});function b(d){if($.isArray(d)){for(var e=d.length-1;e>=0;
e--){var c=d[e];var f=$(Employee._CONS_.GRID).jqGrid("getRowData",c);if("deleted"==f.status){DialogUtils.error(msgCode.ERROR,"已删除员工不能操作");return false;
}}return true;}else{var f=$(Employee._CONS_.GRID).jqGrid("getRowData",d);if("deleted"==f.status){DialogUtils.error(msgCode.ERROR,"已删除员工不能操作");return false;
}else{return true;}}}$(document).on("click",".exportEmployee",function(){var d=$("#employeeSearchForm").serialize();d=d;var c=Employee._CONS_.EXPORT_URL+"?"+d;
FormUtils.loadData(c,function(e){if(e.success){DialogUtils.success("成功",e.msg);}else{DialogUtils.error("错误",e.msg);}});});$(document).on("click",".resetPass",function(){var c=a._getMultiSelectedId($(this));
if(c){if(b(c)){a._resetPass(c);}}});$(document).on("click",".profitPK",function(){var f=[];var c=$(Employee._CONS_.GRID).jqGrid("getGridParam","selarrrow");
for(var d=0;d<c.length;d++){var e=$(Employee._CONS_.GRID).jqGrid("getRowData",c[d]);var g={id:c[d],aid:e.aid,name:e.name};f.push(g);}a._profitPK(f);});
$(document).on("click",".followCsCount",function(){var c=$(Employee._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(c.length==0){DialogUtils.error("提示","请选择要操作的记录");
return false;}var f=[];for(var d=0;d<c.length;d++){var e=$(Employee._CONS_.GRID).jqGrid("getRowData",c[d]);var g={id:c[d],aid:e.aid,name:e.name,csCount:e.csCount,dayFollowCsSum:e.dayFollowCsSum};
f.push(g);}$("#followCsContainer").modal("show");a._bulidFollowCs(f);});$(document).on("click","#bacthAddCsFollow",function(){var c=$(".csFollowCountInput").val();
if(!(/^\d+$/.test(c))){DialogUtils.error("提示","输入必须为整数");return false;}$(".dayFollowCsSum").val(c);});$(document).on("click",".saveFollowCs",function(){var c=[];
$("#followCsTableForm").find("table tr").each(function(){var d={};$(this).find("td").each(function(){if($(this).hasClass("empId")){d.id=$(this).text();
}else{if($(this).children().length>0){d.dayFollowCsSum=($(this).find("input").val());}}});c.push(d);});a._saveFollowCs(c);});$("body").on("click",".employeeModuleExport",function(){var e={};
var d=d=["aid","name","group","position","role"];e.module="csEntity";e.moduleColumnPos=[{name:"工号",showCode:"00139"},{name:"姓名",showCode:"00140"},{name:"部门",showCode:"00141"},{name:"岗位",showCode:"00142"},{name:"角色",showCode:"00143"}];
LocalStorageUtils.set("CS_EXPORT_COLUMNS_TMPL"+currentUserId,d.toString());var c={columnJson:JSON.stringify(e),moduleText:"员工模块"};window.location.href=ctx+"/gl/mc/moduleColumn/genExcel.htm?"+$.param(c);
});$("body").on("click",".employeeImport",function(){var c={"importUrl":Employee._CONS_.IMPORT_EXCEL_URL,"tabTitle":"导入员工excel数据"};excelUtil.importExcel(c);
});$("#groupName").on("click",function(){var c=$("#groupType").val();if(c=="add"){GroupUtils.selectGroupTreeBox({selectedGroupId:$('input[name="groupId"]').val(),container:"groupName",hideSale:true,isReDisabled:true,positionType:"all",fn:function(d){$('input[name="groupId"]').val(d);
},dataFilter:function(g,d,h){if(h&&h.length){for(var f=0;f<h.length;f++){var e=h[f];if(e.isAgent=="y"&&e.agentId==""){e.chkDisabled=true;}}}return h;}});
}else{GroupUtils.selectGroupTreeBox({selectedGroupId:$('input[name="groupId"]').val(),container:"groupName",hideSale:true,isReDisabled:true,positionType:type=="search"?"all":"dept_manager,cs_search",fn:function(d){$('input[name="groupId"]').val(d);
},dataFilter:function(g,d,h){if(h&&h.length){for(var f=0;f<h.length;f++){var e=h[f];if(e.isAgent=="y"&&e.agentId==""){e.chkDisabled=true;}}}return h;}});
}});$("#positionNames").on("click",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$('input[name="position"]').val(),container:"positionNames",isMultiple:1,hideSale:true,isReDisabled:true,positionType:"all",fn:function(c){$('input[name="position"]').val(c);
},dataFilter:function(f,c,g){if(g&&g.length){for(var e=0;e<g.length;e++){var d=g[e];if(d.isAgent=="y"&&d.agentId==""){d.chkDisabled=true;}}}return g;}});
});$("#positionSearchSelect").on("click",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$('input[name="Q__S__LK__employee.position_"]').val(),container:"positionSearchSelect",isMultiple:0,hideSale:true,positionType:"all",fn:function(c){$('input[name="Q__S__LK__employee.position_"]').val(c);
}});});$(document).on("click",".prevBtn",function(){a.isAdd=false;a._clear(false);});$(document).on("click",".saveBtn",function(){if(a.isBatchCreateSwitchery&&a.isBatchCreateSwitchery.isChecked()){a._batchCreate();
}else{var c=$("[name=id]").val()?Employee._CONS_.SAVE_EDIT_URL:Employee._CONS_.SAVE_ADD_URL;if($(this).attr("id")=="saveAddBtn"){a.isAdd=true;}a._saveEmployee(c);
}});$("body").on("click",".employeeAdd",function(){a.isEdit=false;var c="ecm";$("#groupType").val("add");$(".employeePkDiv").hide();a._add(c);});$("body").on("click",".employeeAddScm",function(){a.isEdit=false;
var c="scm";$("#groupType").val("add");a._add(c);});$("body").on("click",".employeeEdit",function(){$("#saveAddBtn").hide();var c=a._getSingleSelectedId($(this));
if(c){if(b(c)){a.isEdit=true;a._edit(c);}}});$("body").on("click",".employeeDel",function(){var c=a._getMultiSelectedId($(this));if(($.isArray(c)&&!c.length)||(!$.isArray(c)&&!c)){return;
}if(b(c)){DialogUtils.confirmWithOptions({title:"删除会释放工号,删除的员工无法恢复,确定吗?",text:"",confirmButtonText:"确定",yesFunc:function(){a._delete(c);}});}});$("body").on("click",".employeeCancel",function(){var d=a._getMultiSelectedId($(this));
var f="";var c=new Array();if(($.isArray(d)&&!d.length)||(!$.isArray(d)&&!d)){return;}if(!$.isArray(d)){var h=[];h.push(d);d=h;}for(var e=0;e<d.length;
e++){var g=$(Employee._CONS_.GRID).jqGrid("getRowData",d[e]);if(g.csCount>0){f+=g.aid+",";}else{c+=d[e]+",";}}if(b(d)){DialogUtils.confirmWithOptions({title:"确定注销吗？",text:"",confirmButtonText:"确定",yesFunc:function(){if(f.length>0){DialogUtils.error("错误","无法注销工号"+f+"有客户的员工");
}if(c.length!=0){a._cancel(c);}}});}});$("body").on("click",".employeeForceLogout",function(){var c=a._getMultiSelectedId($(this));if(($.isArray(c)&&!c.length)||(!$.isArray(c)&&!c)){return;
}if(b(c)){DialogUtils.confirmWithOptions({title:"确定强制员工下线吗？",text:"",confirmButtonText:"确定",yesFunc:function(){a._forceLogout(c);}});}});$("body").on("click",".refreshCredit",function(){DialogUtils.confirmWithOptions({title:"确定刷新授权吗？",text:"",confirmButtonText:"确定",yesFunc:function(){a._refreshCredit();
}});});$("body").on("click",".employeeActive",function(){var c=a._getMultiSelectedId($(this));if(($.isArray(c)&&!c.length)||(!$.isArray(c)&&!c)){return;
}if(b(c)){a._active(c);}});$("body").on("click",".employeeDetail",function(){a.isEdit=false;var c=a._getSingleSelectedId($(this));if(c){var d=$(Employee._CONS_.GRID).jqGrid("getRowData",c);
if("deleted"==d.status){$(".deletedHide").hide();}a._detail(c);}});$("body").on("click",".resTreeDetail",function(){var c=a._getSingleSelectedId($(this));
if(c){if(b(c)){a._openUserResIframe(c);}}});$("body").on("click",".showSecureOperLog",function(){var c=a._getSingleSelectedId($(this));if(c){var d={operatorId:c};
SecureLogService.openEmployeeSecureLog(d);}});$("#selectDefaultImageBtn").click(function(){ImageUtils.selectImage(0,function(c){var d=ImageUtils.createImageDivStr(c);
$("#imageConatiner").empty().append(d);});});$(document).on("click",".employeeSearch",function(){$("#nameSearch").val($("#nameSearch").val().trim());var c=$(this).closest("form").serialize();
c=c;a._reloadJqgrid(c);});$("#employeeSearchForm").on("keypress",function(c){if(c.keyCode=="13"){$(".employeeSearch").trigger("click");}});$(".form_wrapper").on("change","input",function(){if(a.isEdit){a.isFormDataChange=true;
}});$(".form_wrapper").on("change",".form_wrapper select",function(){if(a.isEdit){a.isFormDataChange=true;}});$(".form_wrapper").on("change",".form_wrapper textarea",function(){if(a.isEdit){a.isFormDataChange=true;
}});$("body").on("change",".visitScope",function(){if($(this).val()=="both"){$(".outSideDiv").show();}else{$(".outSideDiv").hide();}});$("#organizationTreeSearch").on("keyup",function(c){if(c.keyCode==13){a._searchNode(c);
a._callNumber();}});$("#clickUp").on("click",function(){a._clickUp();});$("#clickDown").on("click",function(){a._clickDown();});$("#moveGroupForm").on("click","#departmentName",function(){var c={isMultiple:0,selectedGroupId:$("input[name='departmentId']").val(),container:"departmentName",nolimit:true,positionType:"statistics,dept_manager",fn:function(d,e,f){$("#moveGroupForm").find("input[name=departmentHideName]").val(f);
$("#moveGroupForm").find("input[name=departmentId]").val(d);}};GroupUtils.selectGroupTreeBox(c);});$("body").on("click",".moveGroupBatch",function(){var c=$(EmployeeRate._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(!c||c.length<=0){var d=$("#employeeSearchForm").serialize();d=d+"&treeNodeId="+a.employeeGroup.currentClickTreeNode.id;FormUtils.loadData(EmployeeEditBatch._CONS_.LIST_ID_DATA+"?"+d,function(e){a._batchMoveGroupForEmp(e);
});}else{a._batchMoveGroupForEmp(c);}});$("body").on("click","#addEmp",function(){a.isEdit=false;var c="ecm";$("#groupType").val("addEmp");a._addEmp(c);
});$("body").on("click","#editEmp",function(){var c=a._getSingleSelectedId($(this));var g="";var e=Employee._CONS_.GROUPNAMES.split(",");if(c){if(b(c)){var f=$(Employee._CONS_.GRID).jqGrid("getRowData",c);
if(c){for(var d=0;d<e.length;d++){if(f.orgName!=e[d]){g=f.aid;break;}else{break;}}}if(g!=""&&g!=null){DialogUtils.error("错误","无法编辑工号"+g+"非本部门的员工");return;
}else{a.isEdit=true;a._editEmp(c);}}}});$("body").on("click","#cancelEmp",function(){var e=a._getMultiSelectedId($(this));var m="";var k="";var l=Employee._CONS_.GROUPNAMES.split(",");
var h=new Array();if(($.isArray(e)&&!e.length)||(!$.isArray(e)&&!e)){return;}for(var g=0;g<e.length;g++){var c=true;var d=$(Employee._CONS_.GRID).jqGrid("getRowData",e[g]);
for(var f=0;f<l.length;f++){if(d.orgName==l[f]){c=false;break;}}if(c==true){k+=d.aid+",";}if(c==false){if(d.csCount=="0"){h+=e[g]+",";}else{m+=d.aid+",";
}}}if(b(e)){DialogUtils.confirmWithOptions({title:"确定注销吗？",text:"",confirmButtonText:"确定",yesFunc:function(){if(m.length>0){DialogUtils.error("错误","无法注销工号"+m+"有客户的员工");
}if(k.length>0){DialogUtils.error("错误","无法注销工号"+k+"非本部门的员工");}if(h.length!=0){a._cancel(h);}}});}});$("body").on("click",".removeEmpPk",function(){var c=new Array();
c=$(this).attr("id");if(c!=""&&c.length>0){DialogUtils.confirmWithOptions({title:"确定清空Pk对象吗",text:"",confirmButtonText:"确定",yesFunc:function(){FormUtils.del(Employee._CONS_.CLEAR_PK_URL,c,function(e){if(e.success){var d=c;
a._loadEmpPkData(d);DialogUtils.success(msgCode.SUCCESS,e.msg);}else{DialogUtils.error(msgCode.error,e.msg);}});}});}});},_saveFollowCs:function(c){var b=this;
var a=ctx+"/crm/ou/employee/saveFollowCs.htm";FormUtils.submit(a,"jsondata="+JSON.stringify(c),function(d){if(d.success){DialogUtils.success("提示","保存成功");
$(".employeeSearch").trigger("click");$("#followCsContainer").modal("hide");}});},_bulidFollowCs:function(c){var a=this;var d=new StringBuffer();for(var b=0;
b<c.length;b++){d.append("<tr>");d.append('<td style="display:none" class="empId">');d.append(c[b].id);d.append("</td>");d.append('<td style="width: 25%">');
d.append(c[b].aid);d.append("</td>");d.append('<td style="width: 25%">');d.append(c[b].name);d.append("</td>");d.append('<td style="width: 25%">');d.append(c[b].csCount);
d.append("</td>");d.append('<td style="width: 25%">');if(c[b].dayFollowCsSum!="0"){d.append("<input type='text' class='form-control dayFollowCsSum' name='dayFollowCsSum' value='"+c[b].dayFollowCsSum+"'>");
}else{d.append("<input type='text' class='form-control dayFollowCsSum' name='dayFollowCsSum'>");}d.append("</td>");d.append("</tr>");}$("#followCsTableContainer").empty().append(d.toString());
},_profitPK:function(a){var b=new EmployeeProfitPk();b.init(a);},_batchMoveGroupForEmp:function(b){var a=this;layer.open({type:1,title:'您正在对<font style="color:red;">【'+b.length+"个】</font>员工进行批量更改部门",maxmin:false,shadeClose:false,btn:["保存","取消"],area:["50%","50%"],content:$(".moveGroupBatchLayer"),yes:function(d,c){a._saveEmployeeEditBatch(b,d,c);
}});},_editEmp:function(b){var a=this;$(".dataGroup").show();$(".addGroup").hide();$(".list_wrapper").hide();$(".form_wrapper").stop().animate({"left":"15px"},"fast");
$(".addAddr").show();$("#selectOrganization").show();$("#selectDefaultImageBtn").show();$(".edit-addr").show();$(".operation").show();$("input[name='adn']").attr("readonly","readonly");
a.loadEditEmp(b);this.commonEav.setEntityId(b);this.commonEav.renderEavForm();FormUtils.enableForm("partyForm");},loadEditEmp:function(d){var b=this;var c="";
var a=false;FormUtils.loadData(Employee._CONS_.EMP_EDIT_URL+"?id="+d,function(j){var m=j[0];var j=j[1];c=j.userPo.roleIds;if(d=="admin"){$("[name=aid]").attr("readonly",true);
}$("[name=sys]").val(j.sys);if(j.sex!=""){$("input[name='sex'][value="+j.sex+"]").attr("checked",true);}$("[id=id]").val(j.id);$("[id=name]").val(j.name);
$("[name=aid]").val(j.aid);$("#partyForm").find("[name=status]").val([j.status]);$("[id=desc]").val(j.desc);$("#csCount").text(j.csCount).attr("disabled",true);
$("#roleSelect").empty();$("[name=groupId]").val(j.groupId);$("[name=groupName]").val(j.orgName);$("[name='lastLoginSys']").text(j.lastLoginSys?j.lastLoginSys:"无");
$("[name='lastLoginCti']").text(j.lastLoginCti?j.lastLoginCti:"无");$("[name='createTime']").text(j.createTime?j.createTime:"无");$("[name=adn]").text(j.adn?j.adn:"无");
$("[name=positionNames]").val(j.positionNames);$("[name=position]").val(j.position);var k="";if(j.profile==""){var n="/img/jt/defaulTouXiang.png";k=[{url:n,name:"",id:""}];
}else{k=[{url:j.profile,name:"",id:""}];}var l=ImageUtils.createImageDivStr(k);$("#imageConatiner").empty().append(l);$("[name='userPo.mobile']").val(j.userPo.mobile);
$("[name='userPo.email']").val(j.userPo.email);$("[name='userPo.ipAddr']").val(j.userPo.ipAddr);if(j.userPo.visitScope=="both"){$(".outSideDiv").show();
}else{$(".outSideDiv").hide();}$("[name='userPo.visitScope']").val(j.userPo.visitScope);$("[name='userPo.beginHm']").val(j.userPo.beginHm);$("[name='userPo.endHm']").val(j.userPo.endHm);
$("[name='userPo.outIpAddr']").val(j.userPo.outIpAddr);var g=false;$("[name=addr]").val(j.address);b.addressService.init({country:"ChinaCityCateType-root",province:j.province,city:j.city,area:j.area,town:j.town,rowFit:"y",isNotRequired:true,disabled:g,isHideCountry:true});
if(a){$("img.deleteImage").hide();}var o=new StringBuffer();var f=j.userPo.userRoleList;for(var h=0;h<f.length;h++){o.append(f[h].exportColumns);if(h!=f.length-1){o.append(",");
}}GroupUtils.selectGroupTreeBox({selectedGroupId:$('input[name="groupId"]').val(),container:"groupName",isReDisabled:true,positionType:type=="search"?"all":"dept_manager,cs_search",fn:function(p){$('input[name="groupId"]').val(p);
},dataFilter:function(s,p,t){if(t&&t.length){for(var r=0;r<t.length;r++){var q=t[r];if(q.isAgent=="y"){q.chkDisabled=true;}}}}});if(m&&m.length>0){var o=new StringBuffer();
for(var h=0;h<m.length;h++){var e=m[h];o.append("<option value='");o.append(e.id);o.append("'");if(c&&c.indexOf(e.id)>=0){o.append(" selected='selected'");
}o.append(">");o.append(e.name);o.append("</option>");}$("#roleSelect").append(o.toString());$("#roleSelect").chosen("destroy");$("#roleSelect").chosen();
}personalGrantExportColumns=o.toString();});},_saveEmployeeEditBatch:function(e,c,a){var b=this;var f=this._buildParams(e);if(!f){return false;}var d=f.msg;
FormUtils.submit(EmployeeEditBatch._CONS_.SAVE_EDIT_BATCH,"jsondata="+JSON.stringify(f),function(h){if(h.success){DialogUtils.success(msgCode.SUCCESS,"批量修改"+e.length+"个员工资料。"+d);
layer.close(c);var g=$("#employeeSearchForm").serialize();g=g;b.employee._reloadJqgrid(g);}else{DialogUtils.error(msgCode.ERROR,h.msg);}},function(){DialogUtils.error(msgCode.ERROR,"服务器错误");
});},_buildParams:function(a){var b={ids:a,groupId:"",msg:""};var c=new StringBuffer();b.groupId=$("#moveGroupForm").find("input[name=departmentId]").val();
b.msg="将该员工移动到了 ["+$("#moveGroupForm").find("input[name=departmentHideName]").val()+"]";return b;},_searchNode:function(d){var a=$.fn.zTree.getZTreeObj("organizationTree");
var c=$.trim($("#organizationTreeSearch").val());var b="name";if(this.lastValue===c){return;}this.lastValue=c;this._updateNodes(true,this.nodeList);if(c!=""){this.nodeList=a.getNodesByParamFuzzy(b,c);
this._updateNodes(true,this.nodeList);}else{this.nodeList=[];}},_updateNodes:function(b,d){var c=$.fn.zTree.getZTreeObj("organizationTree");if(d){for(var e=0,a=d.length;
e<a;e++){d[e].highlight=b;if(b){c.expandNode(d[e].getParentNode(),true,false,false);}c.updateNode(d[e]);}}},_callNumber:function(){var a=$.fn.zTree.getZTreeObj("organizationTree");
if(this.nodeList.length){a.selectNode(this.nodeList[0],false);this.clickCount=1;document.getElementById("number").innerHTML="["+this.clickCount+"/"+this.nodeList.length+"]";
}else{if(this.nodeList.length==0){document.getElementById("number").innerHTML="[0/0]";a.cancelSelectedNode();}}if($.trim($("#organizationTreeSearch").val())==""){document.getElementById("number").innerHTML="";
a.cancelSelectedNode();}},_clickUp:function(){var a=$.fn.zTree.getZTreeObj("organizationTree");if(this.nodeList.length==0){DialogUtils.error(msgCode.FAIL_MSG,"没有搜索结果！");
return;}else{if(this.clickCount==1){DialogUtils.error(msgCode.FAIL_MSG,"您已位于第一条记录上！");return;}else{this.clickCount--;a.selectNode(this.nodeList[this.clickCount-1],false);
}}document.getElementById("number").innerHTML="["+this.clickCount+"/"+this.nodeList.length+"]";},_clickDown:function clickDown(){var a=$.fn.zTree.getZTreeObj("organizationTree");
if(this.nodeList.length==0){DialogUtils.error(msgCode.FAIL_MSG,"没有搜索结果！");return;}else{if(this.nodeList.length==this.clickCount){DialogUtils.error(msgCode.FAIL_MSG,"您已位于最后一条记录上！");
return;}else{a.selectNode(this.nodeList[this.clickCount],false);this.clickCount++;}}document.getElementById("number").innerHTML="["+this.clickCount+"/"+this.nodeList.length+"]";
},_resetTab:function(){var a=$("div.tabs-container");a.find("li.tabli, div.tab-pane").removeClass("active");a.find("li.tabli").eq(0).addClass("active");
a.find("div.tab-pane").eq(0).addClass("active");},_delete:function(b){var a=this;if(b.indexOf("admin")>=0){DialogUtils.error(msgCode.ERROR,"admin用户不能删除,请检查后重试");
return;}FormUtils.del(Employee._CONS_.DELETE_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.SUCCESS,c.msg);}else{DialogUtils.error(msgCode.error,c.msg);
}$(".employeeSearch").trigger("click");});},_cancel:function(b){var a=this;FormUtils.del(Employee._CONS_.CANCEL_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.SUCCESS,c.msg);
}else{DialogUtils.error(msgCode.SUCCESS,c.msg);}$(".employeeSearch").trigger("click");});},_loadEmpPkData:function(a){FormUtils.loadData(Employee._CONS_.EMP_PK_URL+"?id="+a,function(c){if(c&&c.length>0){var d=new StringBuffer();
d.append('<option value="">请选择</option>');for(var b=0;b<c.length;b++){d.append("<option value='"+c[b].id+"'>"+c[b].aid+":"+c[b].name+"</option>");}$("#employeePk").empty().append(d.toString()).select2();
}else{DialogUtils.error("没有可选择的员工",msg.msg);}});},_forceLogout:function(b){var a=this;FormUtils.del(Employee._CONS_.FORCE_LOGOUT_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.SUCCESS,c.msg);
}else{DialogUtils.error(msgCode.SUCCESS,c.msg);}$(".employeeSearch").trigger("click");});},_refreshCredit:function(){var a=this;FormUtils.del(Employee._CONS_.REFRESHCREDIT_URL,"",function(b){if(b.success){DialogUtils.success(msgCode.SUCCESS,b.msg);
}else{DialogUtils.error(msgCode.SUCCESS,b.msg);}$(".employeeSearch").trigger("click");});},_active:function(b){var a=this;FormUtils.del(Employee._CONS_.ACTIVE_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.SUCCESS,c.msg);
}else{DialogUtils.error(msgCode.SUCCESS,c.msg);}$(".employeeSearch").trigger("click");});},_openUserResIframe:function(b,a){layer.open({type:2,title:"用户权限信息",maxmin:false,shadeClose:true,btn:["关闭","关闭"],area:["95%","95%"],skin:"cs-opt-layer",content:Employee._CONS_.SHOW_RES_TREE_URL+"?id="+b});
},_resetPass:function(a){var b={title:"确定重置密码吗?",text:"重置密码将会把员工密码重置为默认的6位密码",cancelButtonText:"取消",confirmButtonText:"重置",isNeedAutoClose:false,yesFunc:function(){FormUtils.submit(Employee._CONS_.RESET_PASS_URL,{userId:a},function(d){if(d.success){var c={title:d.msg,text:"请使用此重置后的密码进行登录",showCancelButton:false,confirmButtonText:"确定",confirmButtonColor:"#1ab394",yesFunc:function(){},};
DialogUtils.confirmWithOptions(c);}else{DialogUtils.error("失败",d.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});}};DialogUtils.confirmWithOptions(b);
},_getAddrsJson:function(){var a=this.addressService.getAddress();var b="province="+a.province+"&city="+a.city+"&area="+a.area+"&town="+a.town;b+="&address="+$('input[name="addr"]').val();
return b;},_getSingleSelectedId:function(b){var a=b.attr("idVal");if(!a){a=$(Employee._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(a==null||a.length==0){DialogUtils.error("错误","请选择要操作的记录");
return;}if(a.length>1){DialogUtils.error("错误","不能同时操作多条记录");return;}}return a;},_getMultiSelectedId:function(b){var a=b.attr("idVal");if(!a){a=$(Employee._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(a==null||a.length==0){DialogUtils.error("错误","请选择要操作的记录");return;}}return a;},_hideNotGrantBtn:function(){if(!ResUtils.canShow("employee.button.moveGroupForEmps")){$(".moveGroupBatch").hide();
}if(!ResUtils.canShow("employee.button.teamManage")){$(".teamManageDiv").hide();}if(!ResUtils.canShow("employee.button.add")){$(".employeeAdd").hide();
}if(!ResUtils.canShow("employee.button.resetPass")){$(".resetPass").hide();}if(!ResUtils.canShow("employee.button.delete")){$(".employeeDel").hide();}if(!ResUtils.canShow("employee.button.showUserRes")){$(".resTreeDetail").hide();
}if(!ResUtils.canShow("employee.button.exportEmployee")){$(".exportEmployee").hide();}if(!ResUtils.canShow("employee.button.employeeModuleExport")){$(".employeeModuleExport").hide();
}if(!ResUtils.canShow("employee.button.employeeImport")){$(".employeeImport").hide();}if(!ResUtils.canShow("employee.button.addEmp")){$("#addEmp").hide();
}if(!ResUtils.canShow("employee.button.cancelEmp")){$("#cancelEmp").hide();}if(!ResUtils.canShow("employee.button.editEmp")){$("#editEmp").hide();}if(deploySys.indexOf("scm")<0||!ResUtils.canShow("employee.button.employeeAddScm")){$(".employeeAddScm").hide();
}if("myGroup"==type){$(".employeeAdd").hide();$(".employeeEdit").hide();$(".employeeDel").hide();$(".employeeCancel").hide();$(".employeeActive").hide();
$(".employeePWEdit").hide();$(".exportEmployee").hide();$(".showSecureOperLog").hide();$(".employeeForceLogout").hide();$(".employeeAddScm").hide();$(".subEmp").hide();
}},_fixedModalWidth:function(){var a=$(window).width();var c=0.3;var b=1024;if(a){if(a<=b){c=0.8;}else{if(a>b&&a<=1280){c=0.7;}else{if(a>1280&&a<=1440){c=0.6;
}else{if(a>1440&&a<=1600){c=0.5;}else{c=0.4;}}}}}$("#officerModalContainer").find(".modal-dialog").width($(document).width()*c);$("#orgModalContainer").find(".modal-dialog").width($(document).width()*c);
},_bindFormValidation:function(){jQuery.validator.addMethod("isDate",function(d,c){return this.optional(c)||/^(20|21|22|23|[0-1]{1}[0-9]{1}):[0-5]{1}[0-9]{1}$/.test(d);
},"格式必须是HH:mm");var b={rules:{"profile":{maxlength:["255"],},"aid":{required:true,isExistsAccount:"id"},"adn":{required:true,},"userPo.mobile":{required:false,mobile:true,isExistsMob:"id",}},messages:{aid:{isExistsAccount:"工号已经存在"}}};
FormUtils.bindFormValidation("partyForm",b);var a={rules:{"userPo.email":{required:false,email:true,},"userPo.beginHm":{isDate:true,},"userPo.endHm":{isDate:true,},},messages:{}};
FormUtils.bindFormValidation("detailForm",a);},_reloadJqgrid:function(b){var a=this;if(b&&jQuery.type(b)=="string"){b=b+"&treeNodeId="+a.employeeGroup.currentClickTreeNode.id;
}else{if(b&&jQuery.type(b)=="object"){b.treeNodeId=a.employeeGroup.currentClickTreeNode.id;}else{b="&treeNodeId="+a.employeeGroup.currentClickTreeNode.id;
}}JTJqgridUtils.reloadJqgrid(Employee._CONS_.GRID,b);},_initJqgrid:function(b){var a=this;$(Employee._CONS_.GRID).JTJqgrid({url:Employee._CONS_.LIST_DATA_URL,pager:Employee._CONS_.PAGER,postData:b,hasBreadcrumb:true,colNames:["头像","工号","姓名","分机","所属部门","角色","岗位","部门id","已有客户","每日需跟进客户","创建时间","最后登录","是否销售部门","在线","状态","操作","操作","操作",],simplify:{key:"yggl",entry:[],must:["工号","姓名"]},colModel:[{name:"profile",width:38,sortable:false,formatter:function(c,f,h){var g=Employee._CONS_.DE_IMG;
var e="<img onerror='onImageError()' style='display: inline; height:35px;' ";if(h.profile!=""&&h.profile!=null){var d={url:h.profile,name:"",id:""};e=e+" src='"+ImageUtils.getUrl(d)+"?dm=_mm' ";
}else{e=e+" src='"+ctx+"/img/jt/defaulTouXiang.png' ";}e+=" >";return e;}},{name:"aid",width:65,index:"employee.aid_",formatter:function(e,d,f){if(f.footData){$(".ui-jqgrid-title").css({"width":"100%"});
var g=new StringBuffer();g.append(f.aid);return g.toString();}else{if(f.aid!=null&&f.aid!=""){if(f.status=="deleted"){var c=f.aid.split("_");return c[0];
}else{return f.aid;}}}}},{name:"name",width:60,index:"employee.name_",sortable:false,},{name:"adn",width:45,index:"employee.adn_"},{name:"orgName",width:110,index:"group_.name_"},{name:"roleNames",width:90,sortable:false},{name:"positionNames",width:100,sortable:false,formatter:function(g,d,f){if(g){g=g.split(",");
}var c="";if(g&&g.length){for(var e=0;e<g.length;e++){c+=g[e];if(e<g.length-1){c+="<br>";}}}return c;}},{name:"groupId",width:120,sortable:false,hidden:true},{name:"csCount",width:60,index:"employee.cs_count_",formatter:function(c,d,e){return e.csCount;
}},{name:"dayFollowCsSum",width:60,index:"employee.day_follow_csSum_",sortable:false,hidden:true},{name:"createTime",width:100,index:"employee.create_time_",classes:"autoHideCol",formatter:function(c){return DateUtils.miniTime(c);
}},{name:"lastLoginSys",width:100,index:"user.last_login_sys_",classes:"autoHideCol",formatter:function(c){return DateUtils.miniTime(c);}},{name:"isBelongSaleOrg",hidden:true,width:10},{name:"online",index:"user.is_online_",width:36,sortable:true,formatter:function(c,d,e){if(e.isOnline=="y"){return"<font style='color:red'>在线 </font>";
}else{return"离线";}}},{name:"statusName",width:36,index:"employee.status_",formatter:function(c,d,e){if(e.status=="actived"){return"<span class='text text-primary'>激活</span>";
}else{if(e.status=="locked"){return"<span class='text text-warning'>锁定</span>";}else{if(e.status=="inactive"){return"<span class='text text-warning'>已注销</span>";
}else{if(e.status=="deleted"){return"<span class='text text-danger'>已删除</span>";}else{return"";}}}}}},{name:"operate",width:180,sortable:false,formatter:function(c,d,e){var f=new StringBuffer();
if("myGroup"!=type){if(ResUtils.canShow("employee.button.edit")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-opt employeeEdit'>编辑</button>");
}if(ResUtils.canShow("employee.button.detail")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-safe employeeDetail'>明细</button>");}f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-opt employeePWEdit'>改密</button>");
if(ResUtils.canShow("employee.button.showSecureOperLog")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-safe showSecureOperLog'>日志</button>");
}if(e.isOnline=="y"&&ResUtils.canShow("employee.button.employeeForceLogout")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-warn employeeForceLogout'>下线</button>");
}if(e.status=="inactive"&&ResUtils.canShow("employee.button.active")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-opt employeeActive'>激活</button>");
}if(e.status=="actived"&&ResUtils.canShow("employee.button.cancel")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-error employeeCancel'>注销</button>");
}}else{if(ResUtils.canShow("employee.button.detail")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-safe employeeDetail'>明细</button>");
}if(ResUtils.canShow("employee.button.resetPass")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-opt resetPass'>重置密码</button>");}if(ResUtils.canShow("employee.button.employeeForceLogout")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-safe showSecureOperLog'>日志</button>");
}if(ResUtils.canShow("employee.button.showUserRes")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-opt resTreeDetail'>权限</button>");}}return f.toString();
}},{name:"status",width:0,sortable:false,hidden:true},{name:"__manage",width:40,classes:"rowOps",sortable:false,align:"center",formatter:"manage",title:"操作",formatoptions:a._getManagerBtns()}],footerrow:true,userDataOnFooter:true,gridComplete:function(){var c=$(".ui-jqgrid-sdiv").find("tr.footrow");
c.find("td").css({"font-weight":500,"width":"auto"});c.find("td").hide();c.find('td[aria-describedby*="employeeGrid_aid"]').show();}});},_getManagerBtns:function(){var b=this;
var a=[];if(ResUtils.canShow("employee.button.detail")){a.push({lable:"明细",btnClasses:"btn btn-primary employeeDetail",iconClasses:"fa fa-list"});}if(ResUtils.canShow("employee.button.edit")&&"myGroup"!=type){a.push({switchCol:{colName:"status",colVals:["actived","inactive"],colLables:["编辑","编辑"],btnClasses:["btn btn-primary employeeEdit","btn btn-primary employeeEdit"],iconClasses:["fa fa-edit","fa fa-edit"]}});
}if(ResUtils.canShow("employee.button.showSecureOperLog")&&"myGroup"!=type){a.push({lable:"查看日志",btnClasses:"btn btn-primary showSecureOperLog",iconClasses:"fa fa-list"});
}if(ResUtils.canShow("employee.button.active")&&"myGroup"!=type){a.push({switchCol:{colName:"status",colVals:["inactive"],colLables:["激活"],btnClasses:["btn btn-primary employeeActive"],}});
}if(ResUtils.canShow("employee.button.changePw")&&"myGroup"!=type){a.push({switchCol:{colName:"status",colVals:["actived"],colLables:["修改密码"],btnClasses:["btn btn-primary employeePWEdit"],iconClasses:["fa fa-edit","fa fa-edit"]}});
}if(ResUtils.canShow("employee.button.resetPass")){a.push({switchCol:{colName:"status",colVals:["actived"],colLables:["重置密码"],btnClasses:["btn btn-primary resetPass"],iconClasses:["fa fa-edit","fa fa-edit"]}});
}if(ResUtils.canShow("employee.button.rate")&&"myGroup"!=type){a.push({switchCol:{colName:"status",colVals:["actived"],colLables:["提成比率"],btnClasses:["btn btn-primary addEmployeeRateBtn"],iconClasses:["fa fa-edit"]}});
}if(ResUtils.canShow("employee.button.percentage")&&"myGroup"!=type){a.push({switchCol:{colName:"status",colVals:["actived"],colLables:["录入提成"],btnClasses:["btn btn-primary addEmployeeRateMoneyBtn"],iconClasses:["fa fa-edit"]}});
}if(ResUtils.canShow("employee.button.employeeForceLogout")&&"myGroup"!=type){a.push({switchCol:{colName:"status",colVals:["actived"],colLables:["强制下线"],btnClasses:["btn btn-warning employeeForceLogout"],}});
}if(ResUtils.canShow("employee.button.cancel")&&"myGroup"!=type){a.push({switchCol:{colName:"status",colVals:["actived"],colLables:["注销"],btnClasses:["btn btn-danger employeeCancel"],}});
}if(ResUtils.canShow("employee.button.delete")&&"myGroup"!=type){a.push({switchCol:{colName:"status",colVals:["actived","inactive"],colLables:["删除","删除"],btnClasses:["btn btn-danger employeeDel","btn btn-danger employeeDel"],iconClasses:["fa fa-remove","fa fa-remove"]}});
}return a;},};function EmployeeGroup(a){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.employee=a;this.prodRootCate=null;this.treeMenu={};
}EmployeeGroup._CONS_={GRID:"#employeeGrid",PAGER:"#employeePager",LISTORG_DATA_URL:ctx+"/gl/ou/group/listData.htm?type=all",LIST_MY_GROUP_URL:ctx+"/gl/ou/group/findVisiableGroupTree.htm",LIST_ALL_EMPLOYEE_TREE:ctx+"/gl/ou/group/findAllEmployeeTree.htm",LIST_VISIABLE_EMPLOYEE_TREE:ctx+"/gl/ou/group/findVisiableEmployeeTree.htm",DELETEORG_URL:ctx+"/gl/ou/group/delete.htm",GET_ROOT_PROD_CATE_URL:ctx+"/ec/product/prodEntity/getRootCate.htm",GET_STORE_LIST_URL:ctx+"/gl/cs/csSeaConfig/getStoreList.htm"};
EmployeeGroup.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._bindFormValidation();this.initOrganizationTree(a);
this._initSelect();this._hideNotGrantBtn();this._initProdRootCatePo();this._initStore();this._initStoreList();this._loadStore();$("#salePercentA").popover({html:true,container:"body"});
$("#autoPercentA").popover({html:true,container:"body"});}},_loadStore:function(){var a=this;var b=EmployeeGroup._CONS_.GET_STORE_LIST_URL;var c=a._getContainer("storeIds");
if(!c){return false;}FormUtils.loadData(b,function(e){if(e&&e.length>0){var f=new StringBuffer();for(var d=0;d<e.length;d++){f.append("<option value='"+e[d].id+"'>"+e[d].name+"</option>");
}c.empty().append(f.toString());}if(c&&c.is(".selectpicker")){c.selectpicker("refresh");}});},_getContainer:function(b){var a=this;var c=false;if(b){c=$("#"+b);
if(c.length==0){c=$("select."+b);if(c.length==0){c=$("select[name='"+b+"']");if(c.length==0){return false;}}}}return c;},_initProdRootCatePo:function(){var a=this;
FormUtils.loadData(EmployeeGroup._CONS_.GET_ROOT_PROD_CATE_URL,function(b){a.prodRootCate=b;});},visibleTreeMenu:function(){var a=this;},_hideNotGrantBtn:function(){var a=this;
if("myGroup"==type){$(".addPhoneBtn").remove();$("#orgDelBtn").remove();$(".orgDelBtn").remove();a.treeMenu.idl=false;$(".orgRateBtn").remove();if(!ResUtils.canShow("group.button.showAdd")){$("#orgAddBtn").remove();
$(".orgAddBtn").remove();a.treeMenu.ia=false;}if(!ResUtils.canShow("group.button.showEdit")){$("#orgUpdateBtn").remove();$(".orgUpdateBtn").remove();a.treeMenu.ie=false;
}if(!ResUtils.canShow("group.button.profitPK")){$(".profitPK").hide();}if(!ResUtils.canShow("group.button.saveAddBtn")&&!ResUtils.canShow("group.button.saveEditBtn")){$(".saveBtn").hide();
}}else{if(!ResUtils.canShow("group.button.add")){$("#orgAddBtn").remove();$(".orgAddBtn").remove();a.treeMenu.ia=false;}if(!ResUtils.canShow("group.button.edit")){$("#orgUpdateBtn").remove();
$(".orgUpdateBtn").remove();a.treeMenu.ie=false;}if(!ResUtils.canShow("employee.button.profitPK")){$(".profitPK").hide();}if(!ResUtils.canShow("employee.button.saveAddBtn")&&!ResUtils.canShow("employee.button.saveEditBtn")){$(".saveBtn").hide();
}}},_initSelect:function(){CateUtils.getOptions([{typeKey:"system",pKey:"CsSecondTypes",container:"secTypeSelect"}]);},initOrganizationTree:function(c){var a=this;
var b={edit:{enable:true,showRemoveBtn:false,showRenameBtn:false,drag:{autoExpandTrigger:true,isCopy:false,isMove:ResUtils.canShow("group.button.drag")?true:false,prev:true,next:true,inner:true,borderMax:10,borderMin:-5,minMoveSize:5,autoOpenTime:500}},async:{enable:true,url:type=="myGroup"?EmployeeGroup._CONS_.LIST_VISIABLE_EMPLOYEE_TREE:EmployeeGroup._CONS_.LIST_ALL_EMPLOYEE_TREE,contentType:"application/json",dataType:"json",type:"get",autoParam:["id"],dataFilter:function(g,d,h){console.log(h);
if(h&&h.length){for(var f=0;f<h.length;f++){var e=h[f];if(e.isSale=="y"){e.name=e.name+"【销】";e.font={"color":"red"};}if(e.name=="代理商"){e.nocheck=true;}}}return h;
},},data:{simpleData:{enable:true,idKey:"id",pIdKey:"parentId",isAgent:"isAgent"}},callback:{beforeDrag:function(e,d){if(type=="myGroup"){return false;
}if(!d[0].parentId){return false;}else{return true;}},beforeDrop:function(g,f,h,e){var d=f[0];if(!h.parentId&&(e=="prev"||e=="next")){return false;}if(e==="prev"||e==="next"){if((d.parentId.isEmpty()&&h.parentId.isEmpty())||(d.parentId==h.parentId)){a._moveHandler(d.id,h.id,null,e);
}else{if(d.parentId!=null&&h.parentId!=null&&d.parentId!=h.parentId){a._moveHandler(d.id,h.id,h.parentId,e);}else{if(d.parentId!=null&&h.parentId==null){a._moveHandler(d.id,h.id,h.id,h.id,e);
}}}return true;}else{if(e==="inner"){if(d==null||h==null){return false;}else{a._moveHandler(d.id,null,h.id,null);return true;}}}return false;},onClick:function(d,f,e){$(".list_wrapper").show();
$(".form_wrapper").stop().animate({"left":$(".form_wrapper").outerWidth()+15+"px"},"fast");a.currentClickTreeNode=e;a._selectOrg(e);if(c){c.initCrumbs(e,"organizationTree");
}if($("#orgMenuContainer").is(":visible")){$("#orgMenuContainer").stop().slideUp("fast");}a.setTreeBarsLimit(e);},onRightClick:function(d,f,e){a.currentRightClickTreeNode=e;
if(e.type=="employee"){return false;}if(e.isAgent){return false;}if(e.isSale=="y"){$(".orgRateBtn").show();$(".addPhoneBtn").show();a.treeMenu.ie=false;
}else{$(".orgRateBtn").hide();$(".addPhoneBtn").hide();}if(e.isParent){$("#orgDelBtn").hide();a.treeMenu.idl=false;}else{$("#orgDelBtn").show();a.treeMenu.idl=true;
}$("#orgMenuContainer").css({top:(d.pageY-25)+"px",left:(d.pageX-10)+"px",display:"block"});},onAsyncSuccess:function(e,k,m,g){var h=$.fn.zTree.getZTreeObj("organizationTree");
if(m){var n=m.children;for(var j=0;j<n.length;j++){if(n[j].isParent==true){n[j].icon=ctx+"/js/zTree_v3/css/zTreeStyle/img/jt-diy/jt-16.png";}else{n[j].icon=ctx+"/js/zTree_v3/css/zTreeStyle/img/jt-diy/jt-30.png";
}if(childNodes[j].isSale=="y"){childNodes[j].font={"color":"red"};}h.updateNode(n[j]);}}else{var d=h.getNodes();for(var j=0;j<d.length;j++){d[j].icon=ctx+"/js/plugins/zTree_v3/css/zTreeStyle/img/jt-diy/jt-orgRoot.png";
if(d[j].isSale=="y"){d[j].font={"color":"red"};}h.updateNode(d[j]);}}if(m==null){var h=$.fn.zTree.getZTreeObj("organizationTree");var l=h.getNodes();if(l&&l.length){var f=l[0];
h.expandNode(f,true,false,true);h.selectNode(f);a.setTreeBarsLimit(f);a.currentClickTreeNode=f;a._selectOrg(f);if(c){c.initCrumbs(f,"organizationTree");
}}}}},view:{selectedMulti:false,fontCss:function(e,d){return(!!d.highlight)?{color:"#A60000","font-weight":"bold"}:{color:"#333","font-weight":"normal"};
}}};$.fn.zTree.init($("#organizationTree"),b);},treeNodeBtn:function(b){var a=this;},_moveHandler:function(d,c,a,b){var e={};if(d&&c&&a==null){e.type="changeSort";
}else{if(d&&c&&a!=null){e.type="changeSortAndParentId";}else{if(d&&a!=null){e.type="changeParentId";}}}e.srcId=d;e.destId=c;e.destParentId=a;e.moveType=b;
FormUtils.submit(ctx+"/gl/ou/group/move.htm",e,function(f){if(f.success){DialogUtils.success("成功","移动成功");}},function(){DialogUtils.error("错误","网络错误，请稍候重试");
});},clear:function(c){var a=this;function b(){}if(a.isEdit&&a.isFormDataChange){DialogUtils.warning(function(){b();});}else{b();}},_loadSeaConfig:function(b){var a=this;
FormUtils.loadData(ctx+"/gl/cs/csSeaConfig/getByGroupId.htm?groupId="+b,function(c){a._setSeaConfigExpData("lastCompleteTime",c.lastCompleteTime);a._setSeaConfigExpData("csCreateTime",c.csCreateTime);
a._setSeaConfigExpData("soTotal",c.soTotal);a._setSeaConfigExpData("soCount",c.soCount);a._setSeaShopData("shopName",c.shopName);a._setSeaConfigExpData("skuCode",c.skuCode);
a._setSeaConfigExpData("shippingTime",c.shippingTime);a._setSeaConfigExpData("soSub",c.soSub);});},_loadCompetencyConfig:function(a){FormUtils.loadData(ctx+"/gl/ou/group/getCompetencyConfig.htm?groupId="+a,function(b){$("#competencyConfigForm input[name='allowCompetency']").removeAttr("checked");
$("#competencyConfigForm input[name='allowCallSc']").removeAttr("checked");$("#competencyConfigForm input[name='allowCallLong']").removeAttr("checked");
$("#competencyConfigForm input[name='allowWxToCs']").removeAttr("checked");$("#competencyConfigForm input[name='allowWxCsTo']").removeAttr("checked");$("#competencyConfigForm input[name='allowCsFollows']").removeAttr("checked");
if(b.allowCompetency){$("#competencyConfigForm input[name='allowCompetency'][value='"+b.allowCompetency+"']").prop("checked","checked");$("#competencyConfigForm input[name='allowCallSc'][value='"+b.allowCallSc+"']").prop("checked","checked");
$("#competencyConfigForm input[name='callScPercent']").val(b.callScPercent);$("#competencyConfigForm input[name='callScMid']").val(b.callScMid);$("#competencyConfigForm input[name='allowCallLong'][value='"+b.allowCallLong+"']").prop("checked","checked");
$("#competencyConfigForm input[name='callLongPercent']").val(b.callLongPercent);$("#competencyConfigForm input[name='callLongMid']").val(b.callLongMid);
$("#competencyConfigForm input[name='allowWxToCs'][value='"+b.allowWxToCs+"']").prop("checked","checked");$("#competencyConfigForm input[name='wxToCsPercent']").val(b.wxToCsPercent);
$("#competencyConfigForm input[name='wxToCsMid']").val(b.wxToCsMid);$("#competencyConfigForm input[name='allowWxCsTo'][value='"+b.allowWxCsTo+"']").prop("checked","checked");
$("#competencyConfigForm input[name='wxCsToPercent']").val(b.wxCsToPercent);$("#competencyConfigForm input[name='wxCsToMid']").val(b.wxCsToMid);$("#competencyConfigForm input[name='allowCsFollows'][value='"+b.allowCsFollows+"']").prop("checked","checked");
$("#competencyConfigForm input[name='csFollowsPercent']").val(b.csFollowsPercent);$("#competencyConfigForm input[name='csFollowsMid']").val(b.csFollowsMid);
}else{$("#competencyConfigForm input[name='allowCompetency'][value='n']").prop("checked","checked");$("#competencyConfigForm input[name='allowCallSc'][value='n']").prop("checked","checked");
$("#competencyConfigForm input[name='callScPercent']").val("");$("#competencyConfigForm input[name='callScMid']").val("");$("#competencyConfigForm input[name='allowCallLong'][value='n']").prop("checked","checked");
$("#competencyConfigForm input[name='callLongPercent']").val("");$("#competencyConfigForm input[name='callLongMid']").val("");$("#competencyConfigForm input[name='allowWxToCs'][value='n']").prop("checked","checked");
$("#competencyConfigForm input[name='wxToCsPercent']").val("");$("#competencyConfigForm input[name='wxToCsMid']").val("");$("#competencyConfigForm input[name='allowWxCsTo'][value='n']").prop("checked","checked");
$("#competencyConfigForm input[name='wxCsToPercent']").val("");$("#competencyConfigForm input[name='wxCsToMid']").val("");$("#competencyConfigForm input[name='allowCsFollows'][value='n']").prop("checked","checked");
$("#competencyConfigForm input[name='csFollowsPercent']").val("");$("#competencyConfigForm input[name='csFollowsMid']").val("");}});},_saveCompetencyConfig:function(c){$("#competencyConfigForm input[name='groupId']").val(c);
var a=this;var b=ctx+"/gl/ou/group/saveCompetencyConfig.htm";var d=$("#competencyConfigForm").serialize();FormUtils.submit(b,d,function(e){if(e.success){$("#competencyConfigContainer").modal("hide");
DialogUtils.success("","修改成功");}});},_initStoreList:function(){FormUtils.loadData(EmployeeGroup._CONS_.GET_STORE_LIST_URL,function(b){if(b&&b.length>0){var c=new StringBuffer();
c.append('<option value="">请先选择仓库</option>');for(var a=0;a<b.length;a++){c.append("<option value='"+b[a].id+"'>"+b[a].name+"</option>");}$("#storeId").empty().append(c.toString()).select2();
}});},_initStore:function(){CateUtils.getOptions([{typeKey:"system",pKey:"soEntityStoreName",container:"shopName",fn:function(a){var e=new StringBuffer();
for(var c=0;c<a.length;c++){var d=a[c].value;var b=a[c].name;e.append("<option value='"+d+"'>"+b+"</option>");}$("#shopName").empty().append(e.toString()).attr("multiple",true).chosen("destroy").chosen();
}}]);},_saveSeaConfig:function(c){var a=this;var b=ctx+"/gl/cs/csSeaConfig/saveAdd.htm";var d={lastCompleteTime:a._getSeaConfigExpData("lastCompleteTime"),csCreateTime:a._getSeaConfigExpData("csCreateTime"),soTotal:a._getSeaConfigExpData("soTotal"),soCount:a._getSeaConfigExpData("soCount"),shopName:a._getSeaShopData("shopName"),skuCode:a._getSeaConfigExpData("skuCode"),shippingTime:a._getSeaConfigExpData("shippingTime"),soSub:a._getSeaConfigExpData("soSub"),groupId:c};
FormUtils.submit(b,d,function(e){if(e.success){$("#csSeaConfigContainer").modal("hide");DialogUtils.success("","修改成功");}});},_setSeaShopData:function(d,e){var c=this;
var f="";if(!d){return;}if(!e){$("#csSeaConfigForm select[name='"+d+"_c']").val("");return;}var a=e.split("_c_");if(a.length<2){return;}$("#csSeaConfigForm select[name='"+d+"_c']").val(a[0]);
var b=a[1].split(",");for(i=0;i<b.length;i++){f=b[i];$("#csSeaConfigForm select[name='"+d+"']"+" option[value='"+f+"']").attr("selected","selected");}$("#shopName").trigger("chosen:updated");
},_setSeaConfigExpData:function(b,c){if(!b){return;}if(!c){$("#csSeaConfigForm select[name='"+b+"_c']").val("");$("#csSeaConfigForm input[name='"+b+"']").val("");
return;}var a=c.split("_c_");if(a.length<2){return;}$("#csSeaConfigForm select[name='"+b+"_c']").val(a[0]);$("#csSeaConfigForm input[name='"+b+"']").val(a[1]);
},_getSeaConfigExpData:function(e){if(!e){return"";}var d=$("#csSeaConfigForm select[name='"+e+"_c']").val();var c=$("#csSeaConfigForm input[name='"+e+"']").val();
if(!d||!c){return"";}return d+"_c_"+c;},_getSeaShopData:function(e){if(!e){return"";}var d=$("#csSeaConfigForm select[name='"+e+"_c']").val();var c=$("#csSeaConfigForm select[name='"+e+"']").val();
if(!d||!c){return"";}return d+"_c_"+c;},_bindEventHander:function(){var a=this;$("#competencyConfigBtn").on("click",function(){$("#competencyConfigContainer").modal("show");
a._loadCompetencyConfig(a.currentRightClickTreeNode.id);});$("#saveCompetencyConfigBtn").on("click",function(){a._saveCompetencyConfig(a.currentRightClickTreeNode.id);
});$("#orgSeaConfigBtn").on("click",function(){$("#csSeaConfigContainer").modal("show");a._loadSeaConfig(a.currentRightClickTreeNode.id);});$("#saveSeaConfigBtn").on("click",function(){DialogUtils.confirmWithOptions({title:"确定修改公海规则吗？",text:"",confirmButtonText:"确定",yesFunc:function(){a._saveSeaConfig(a.currentRightClickTreeNode.id);
}});});$('input[name="isSale"]').on("click",function(){var b=$(this).val();if(b=="y"){$("#prodCatesDiv").show();$("#createToDiv").show();$("#transToDiv").show();
$("#secTypeDiv").show();$("#saleRangeDiv").show();$("#saleLineDiv").show();$("#salePercentDiv").show();$(".needFinanceConfirmDiv").show();$("[name=saleLine]").val(["one"]);
$("[name=needFinanceConfirm]").val(["y"]);$("[name=saleRange]").val("all");$("[name=saleRange]").attr("required",true);$("[name=saleLine]").attr("required",true);
$("[name=needFinanceConfirm]").attr("required",true);$("[name=prodCateNames]").attr("required",true);}else{if(b=="n"){$("#prodCatesDiv").hide();$("#createToDiv").hide();
$("#transToDiv").hide();$("#secTypeDiv").hide();$("#saleRangeDiv").hide();$("#saleLineDiv").hide();$("#salePercentDiv").hide();$(".needFinanceConfirmDiv").hide();
$("[name=createTo]").val("");$("[name=createToName]").val("");$("[name=transTo]").val("");$("[name=secType]").val("");$("[name=saleRange]").val("");$("[name=saleLine]").val([""]);
$("[name=needFinanceConfirm]").val(["y"]);$("[name=prodCates]").val("");$("[name=saleRange]").removeAttr("required");$("[name=saleLine]").removeAttr("required");
$("[name=needFinanceConfirm]").removeAttr("required");$("[name=prodCateNames]").attr("required",false);}}});$(document).on("mouseleave","#orgMenuContainer",function(){$(this).hide();
$("#orgContainer").show();$("#officerContainer").hide();});$(document).on("click",".chooseCreateTo",function(){var b=new EmployeesSelect();var c={grantType:"/role/",isMultiple:0,isSale:0,mode:0,callBack:function(d){$("[name=createToName]").val(d[0].aid+":"+d[0].name);
$("[name='createTo']").val(d[0].id);}};b.init(c);});$(document).on("click","#clearTransTo",function(){$("[name=transToName]").val("");$("[name='transTo']").val("");
});$(document).on("click","#clearCreateTo",function(){$("[name=createToName]").val("");$("[name='createTo']").val("");});$(document).on("click",".chooseTransTo",function(){var b=new EmployeesSelect();
var c={grantType:"/role/",isMultiple:0,isSale:0,mode:0,callBack:function(d){$("[name=transToName]").val(d[0].aid+":"+d[0].name);$("[name='transTo']").val(d[0].id);
}};b.init(c);});$(document).on("click",".chooseGroupMgr",function(){var b=new EmployeesSelect();var c={grantType:"/role/",isMultiple:0,isSale:0,mode:0,callBack:function(d){$("[name=groupMgrName]").val(d[0].aid+":"+d[0].name);
$("[name='groupMgr']").val(d[0].id);}};b.init(c);});$(document).on("click","#clearGroupMgr",function(){$("[name=groupMgrName]").val("");$("[name='groupMgr']").val("");
});$(document).on("click","[name=prodCateNames]",function(){ProdCateService.selectProdCateTreeBox({selectedCateId:$('[name="prodCates"]').val(),container:"prodCateNames",isMultiple:1,fn:function(b){$('[name="prodCates"]').val(b);
}});});$(document).on("click",".orgAddBtn",function(c){var b=a.getSelectDpm();if(b.length==0){DialogUtils.warning("无法执行","请先选择一个部门");return false;}a.currentRightClickTreeNode=b[0];
$("#orgAddBtn").trigger("click");});$(document).on("click",".orgUpdateBtn",function(c){var b=a.getSelectDpm();if(b.length==0){DialogUtils.warning("无法执行","请先选择一个部门");
return false;}a.currentRightClickTreeNode=b[0];$("#orgUpdateBtn").trigger("click");});$(document).on("click",".orgDelBtn",function(c){var b=a.getSelectDpm();
if(b.length==0){DialogUtils.warning("无法执行","请先选择一个部门");return false;}a.currentRightClickTreeNode=b[0];$("#orgDelBtn").trigger("click");});$(document).on("click",".orgRateBtn",function(b){});
$(document).on("click",".orgSeaConfigBtn",function(c){var b=a.getSelectDpm();if(b.length==0){DialogUtils.warning("无法执行","请先选择一个部门");return false;}a.currentRightClickTreeNode=b[0];
$("#orgSeaConfigBtn").trigger("click");});$(document).on("click",".orgSearchDpm",function(b){$(".jt-more-drop").hide("fast","swing",function(){$(".tree-div").css({"height":"calc(100% - 70px)"});
$(".jt-tree-search").stop().slideDown("fast");setTimeout(function(){$(".jt-more-drop").removeAttr("style");},250);});});$(document).on("click",".jt-tree-search-close",function(b){$(".jt-tree-search").stop().slideUp("fast");
$(".tree-div").removeAttr("style");});$("#orgAddBtn").on("click",function(){$("#orgModalLabel").text("添加部门");$("input[name='parentId']").val(a.currentRightClickTreeNode.id);
$("input[name='partyTypeKey']").val("organization");$("input[name='hasUser']").val("n");$("input[name='srcType']").val("admin");$("#orgModalContainer").modal("show");
$("#isSaleDiv").show();$("[name=saleRange]").val(["all"]);$("[name=saleLine]").val(["one"]);$("[name=needFinanceConfirm]").val(["y"]);$("[name=prodCates]").val(a.prodRootCate?a.prodRootCate.id:"");
$("[name=prodCateNames]").val(a.prodRootCate?a.prodRootCate.name:"");$("[name=isUpdateSubGroup]").val(["n"]);if(a.currentRightClickTreeNode.isSale=="y"){$("[name=isSale]").val(["y"]);
$("#isNotSale").attr("disabled","disabled");$("#prodCatesDiv").show();$("#createToDiv").show();$("#transToDiv").show();$("#groupMgrDiv").show();$("#secTypeDiv").show();
$("#saleRangeDiv").show();$("#saleLineDiv").show();$("#salePercentDiv").show();$(".needFinanceConfirmDiv").show();$("[name=saleLine]").attr("required",true);
$("[name=needFinanceConfirm]").attr("required",true);$("[name=saleRange]").attr("required",true);$("[name=prodCateNames]").attr("required",true);}else{$("#isNotSale").removeAttr("disabled");
$("[name=isSale]").val(["n"]);$("#prodCatesDiv").hide();$("#createToDiv").hide();$("#transToDiv").hide();$("#groupMgrDiv").hide();$("#secTypeDiv").hide();
$("#saleRangeDiv").hide();$("#saleLineDiv").hide();$("#salePercentDiv").hide();$(".needFinanceConfirmDiv").hide();$("[name=saleLine]").removeAttr("required").val([""]);
$("[name=needFinanceConfirm]").removeAttr("required").val(["y"]);$("[name=saleRange]").removeAttr("required").val([""]);$("[name=prodCateNames]").removeAttr("required").val("");
$("[name=prodCates]").val("");}ConfigUtils.findByKey("employee.isShowdeductRates",function(b){if(b.success){a.addDeductRates(false);}});});$("#orgUpdateBtn").on("click",function(){$("#orgModalLabel").text("更新部门");
$("#orgModalContainer").modal("show");$("input[name='partyTypeKey']").val("organization");$("input[name='hasUser']").val("n");$("input[name='srcType']").val("admin");
$("#isSaleDiv").show();$("[name=isUpdateSubGroup]").val(["n"]);FormUtils.loadData(ctx+"/gl/ou/group/edit.htm?id="+a.currentRightClickTreeNode.id,function(c){$("#orgForm").find("input[name='id']").val(c.id);
$("#orgForm").find("input[name='depth']").val(c.depth);$("#orgForm").find("input[name='path']").val(c.path);$("#orgForm").find("input[name='sort']").val(c.sort);
$("#orgForm").find("input[name='createBy']").val(c.createBy);$("#orgForm").find("input[name='createTime']").val(c.createTIme);$("input[name='parentId']").val(c.parentId);
$("#orgForm").find("input[name='name']").val(c.name);$("[name=secType]").val([c.secType]);$("[name=saleRange]").val([c.saleRange]);$("[name=saleLine]").val([c.saleLine]);
$("[name=needFinanceConfirm]").val([c.needFinanceConfirm]);$("[name=createTo]").val([c.createTo]);$("[name=createToName]").val([c.createToName]);$("[name=transTo]").val([c.transTo]);
$("[name=transToName]").val([c.transToName]);$("[name=groupMgrName]").val(c.groupMgrName);$("[name=groupMgr]").val(c.groupMgr);$("[name=workDays]").val([c.workDays]);
$("[name=workHours]").val([c.workHours]);$("[name=upperLimit]").val([c.upperLimit]);$("[name=smsLimit]").val([c.smsLimit]);$("[name=seaLimit]").val([c.seaLimit]);
$("[name=noOrderTime]").val([c.noOrderTime]);if(c.percentLimit){$("[name=percentLimit]").val([c.percentLimit]);}else{$("[name=percentLimit]").val("");}if(c.autoPercent){$("[name=autoPercent]").val([c.autoPercent]);
}else{$("[name=autoPercent]").val("");}$('select[name="prodCates"]').val((c.prodCates&&c.prodCates)?c.prodCates.split(","):"");$("[name=prodCates]").val(c.prodCates);
$("[name=prodCateNames]").val(c.prodCateNames);if(c.isParentIsSale){$("#isNotSale").attr("disabled","disabled");}else{$("#isNotSale").removeAttr("disabled");
}$("[name=isSale]").val([c.isSale]);if(c.isSale==="y"){$("#prodCatesDiv").show();$("#createToDiv").show();$("#transToDiv").show();$("#groupMgrDiv").show();
$("#secTypeDiv").show();$("#saleRangeDiv").show();$("#saleLineDiv").show();$("#salePercentDiv").show();$(".needFinanceConfirmDiv").show();$("[name=saleLine]").attr("required",true);
$("[name=needFinanceConfirm]").attr("required",true);$("[name=saleRange]").attr("required",true);$("[name=prodCateNames]").attr("required",true);}else{$("#prodCatesDiv").hide();
$("#createToDiv").hide();$("#transToDiv").hide();$("#groupMgrDiv").hide();$("#secTypeDiv").hide();$("#saleRangeDiv").hide();$("#saleLineDiv").hide();$("#salePercentDiv").hide();
$(".needFinanceConfirmDiv").hide();$("[name=saleRange]").removeAttr("required");$("[name=saleLine]").removeAttr("required");$("[name=needFinanceConfirm]").removeAttr("required");
$("[name=prodCateNames]").attr("required",false);}var d=a._getContainer("storeIds");var b=c.storeIds.split(",");if(d){d.selectpicker("val",b);d.selectpicker("refresh");
}ConfigUtils.findByKey("employee.isShowdeductRates",function(e){if(e.success){a.buildDeductRates(c.deductRates);}});});});$("#orgDelBtn").on("click",function(){DialogUtils.confirm(function(){FormUtils.submit(EmployeeGroup._CONS_.DELETEORG_URL,{ids:a.currentRightClickTreeNode.id},function(d){if(d.success){var b=$.fn.zTree.getZTreeObj("organizationTree");
var c=b.getNodeByTId(a.currentRightClickTreeNode.tId);b.removeChildNodes(c);b.removeNode(c);DialogUtils.success(msgCode.SUCCESS,"删除成功");}else{DialogUtils.error(msgCode.ERROR,d.msg);
}});});});$("#orgModalContainer").on("hidden.bs.modal",function(){FormUtils.clear("orgForm");$("#orgContainer").show();$("#officerContainer").hide();}).on("shown.bs.modal",function(){$("select[name='prodCates']").chosen("destroy");
$("select[name='prodCates']").chosen();});$("#saveOrgBtn").on("click",function(){if($("#orgForm").valid()){var f=$("#id").val();var b=$("#orgForm").find("input[name='id']").val()?ctx+"/gl/ou/group/saveEdit.htm":ctx+"/gl/ou/group/saveAdd.htm";
ButtonUtils.disableBtn("saveOrgBtn");var e=$("[name=isSale]:checked").val();if(e!="y"){$("[name=prodCates]").val("");$("[name=secType]").val("");$("[name=createTo]").val("");
$("[name=transTo]").val("");$("[name=createToName]").val("");$("[name=transToName]").val("");$("[name=saleRange]").val([""]);$("[name=saleLine]").val([""]);
$("[name=percentLimit]").val([""]);$("[name=needFinanceConfirm]").val(["y"]);}var c=$("#storeIds option:selected").length;if(c!=0){a._buildstoreIdlSearch(c);
}var d=$("#orgForm").serialize();d+="&deductRates="+a.getDeductRate();FormUtils.submit(b,d,function(m){ButtonUtils.enableBtn("saveOrgBtn");if(m.success){FormUtils.clear("orgForm");
$("#orgModalContainer").modal("hide");var h=$.fn.zTree.getZTreeObj("organizationTree");if(m.msgCode==actionCode.CREATE){DialogUtils.success("提示","添加成功");
var g=h.getNodeByTId(a.currentRightClickTreeNode.tId);g.isParent="true";h.updateNode(g);var j=JSON.parse(m.msg);h.addNodes(g,-1,j);}else{DialogUtils.success("提示","修改成功");
var k=h.getNodeByTId(a.currentRightClickTreeNode.tId);var l=JSON.parse(m.msg);k.name=l.name;k.isSale=l.isSale;h.updateNode(k);}}else{DialogUtils.error("失败",m.msg);
}},function(){ButtonUtils.enableBtn("saveOrgBtn");DialogUtils.error("错误","后台异常，请稍后重试");});}});$(document).on("click",".placeOrder",function(){if($(this).hasClass("btn-primary")){var c=$(CsEntityEdit._CONS_.FORM_ID).find("[name=id]").val();
var d=$("input[name='name']").val();var b=CsEntityEdit._CONS_.ORDER_PLACE_URL+"?isAdd=true&csId="+$(CsEntityEdit._CONS_.FORM_ID).find("[name=id]").val()+"&isPoint=false"+"&type="+type;
if(outNum){b=b+"&outNum="+outNum;}JTTabUtils.addOrRefreshTab(b,"客户["+d+"]下订单");}});$("#selectSkuBtn").on("click",function(){if($("select[name=storeId]").val()==""||$("select[name=storeId]").val()==null){DialogUtils.error(msgCode.WARING,"请先选择仓库");
return false;}var d=$("#csSeaConfigForm input[name='skuCode']").val();var e="";var c="product";var b="y";a.hadClose=false;SelectProdService.selectSku({storeId:$("select[name=storeId]").val(),isMultiple:1,type:c,canSale:"y",isSale:"y",userId:currentUserId,priceType:$("#prod-price-type").val(),hasStock:$("#hasStock").is(":checked")?"y":"n",limitProdCate:b,fn:function(f){for(var g=0;
g<f.length;g++){e+=f[g].prodName+",";}if(e!=null&&e.length>0){if(d!=""){e+=d;}e=(e.substring(e.length-1)==",")?e.substring(0,e.length-1):e;$("#csSeaConfigForm input[name='skuCode']").val(e);
}}});});$("#csSeaConfigContainer").on("hidden.bs.modal",function(){$("#csSeaConfigForm select[name='shopName']").val("");$("#shopName").trigger("chosen:updated");
a._initStore();});$(document).on("click",".deductRatesAdd",function(){a.addDeductRates(true);});$(document).on("click",".deductRatesRemove",function(){$(this).parents(".form-group").remove();
});},getSelectDpm:function(){return $.fn.zTree.getZTreeObj("organizationTree").getSelectedNodes();},setTreeBarsClick:function(a,c){var b=this;if($(a).length==0||$(c).length==0){return false;
}$(document).on("click",a,function(f){var d=b.getSelectDpm();if(d.length==0){DialogUtils.warning("无法执行","请先选择一个部门");return false;}b.currentRightClickTreeNode=d[0];
$(c).trigger("click");});},setTreeBarsLimit:function(b){var a=this;if(b.type=="employee"||b.isAgent){$(".jt-tree-bars").stop().hide();if($(".jt-tree-search").is(":visible")){$(".tree-div").css({"height":"calc(100% - 40px)"});
}else{$(".jt-tree-search").stop().show();}$(".jt-tree-search-close").hide();$(".search-div").css({"width":"100%"}).parent().css({"margin-top":"8px"});}else{if($(".jt-tree-bars").is(":hidden")){$(".jt-tree-bars").stop().show();
$(".tree-div").css({"height":"calc(100% - 80px)"});$(".search-div").removeAttr("style").parent().css({"margin-top":0});$(".jt-tree-search-close").show();
}}if(b.isSale=="y"){$(".orgRateBtn").show();}else{$(".orgRateBtn").hide();}if(b.isParent){$(".orgDelBtn").stop().hide();}else{$(".orgDelBtn").stop().show();
}if($(".jt-tree-bars").children("button:visible").eq(0).is(".orgTreeMoreBars")){$(".orgTreeMoreBars").children(".jt-more-drop").addClass("only");}else{$(".orgTreeMoreBars").children(".jt-more-drop").removeClass("only");
}},_buildstoreIdlSearch:function(b){var a=this;var c=new StringBuffer();$("#storeIds option:selected").each(function(d){if($(this).val()){c.append($(this).val());
}if(d==b-1){return false;}else{c.append(",");}});$("input[name=storeIds]").val(c.toString());},getDeductRate:function(){var b=new StringBuffer();$("#deductRatesDiv .form-group").each(function(c){if($(this).find("input[name=deductRatesStart]").val()&&$(this).find("input[name=deductRatesEnd]").val()&&$(this).find("input[name=deductRatesPercent]").val()){b.append($(this).find("input[name=deductRatesStart]").val()+","+$(this).find("input[name=deductRatesEnd]").val()+","+$(this).find("input[name=deductRatesPercent]").val()+"|");
}});var a=b.toString();if(a.length>1){a=a.substring(0,a.length-1);}return a;},buildDeductRates:function(e){var b=this;if(e){var f=new StringBuffer();var d=e.split("|");
for(var c=0;c<d.length;c++){var a=d[c].split(",");f.append("<div class='form-group'>");f.append("<label class='col-sm-2 control-label'>梯度等级设置</label>");
f.append("<div class='col-sm-2'>");f.append("<input name='deductRatesStart' placeholder='' value='"+a[0]+"' class='form-control' validateType='default'>");
f.append("</div>");f.append("<div class='col-sm-1'>");f.append("<span style='margin-left:7px;margin-top:3px;'>&lt; = X &lt; </span>");f.append("</div>");
f.append("<div class='col-sm-2'>");f.append("<input name='deductRatesEnd' placeholder='' value='"+a[1]+"' class='form-control' validateType='default'>");
f.append("</div>");f.append("<label class='col-sm-2 control-label'>提成百分比</label>");f.append("<div class='col-sm-1'>");f.append("<input name='deductRatesPercent' placeholder='' value='"+a[2]+"' class='form-control' validateType='default'>");
f.append("</div>");f.append("<div class='col-sm-1'>");f.append("<span>%</span>");f.append("</div>");f.append("<div class='col-sm-1'>");f.append("<button type='button' class='btn btn-sm btn-primary deductRatesAdd'><i class='fa fa-plus'></i></button>&nbsp;");
f.append("<button type='button' class='btn btn-sm btn-danger deductRatesRemove'><i class='fa fa-times'></i></button>");f.append("</div>");f.append("</div>");
}$("#deductRatesDiv").empty().append(f.toString());}else{b.addDeductRates(false);}},addDeductRates:function(a){var b=new StringBuffer();b.append("<div class='form-group'>");
b.append("<label class='col-sm-2 control-label'>梯度等级设置</label>");b.append("<div class='col-sm-2'>");b.append("<input name='deductRatesStart' placeholder='' class='form-control' validateType='default'>");
b.append("</div>");b.append("<div class='col-sm-1'>");b.append("<span style='margin-left:7px;margin-top:3px;'>&lt; = X &lt; </span>");b.append("</div>");
b.append("<div class='col-sm-2'>");b.append("<input name='deductRatesEnd' placeholder='' class='form-control' validateType='default'>");b.append("</div>");
b.append("<label class='col-sm-2 control-label'>提成百分比</label>");b.append("<div class='col-sm-1'>");b.append("<input name='deductRatesPercent' placeholder='' class='form-control' validateType='default'>");
b.append("</div>");b.append("<div class='col-sm-1'>");b.append("<span>%</span>");b.append("</div>");b.append("<div class='col-sm-1'>");b.append("<button type='button' class='btn btn-sm btn-primary deductRatesAdd'><i class='fa fa-plus'></i></button>&nbsp;");
b.append("<button type='button' class='btn btn-sm btn-danger deductRatesRemove'><i class='fa fa-times'></i></button>");b.append("</div>");b.append("</div>");
if(a){$("#deductRatesDiv").append(b.toString());}else{$("#deductRatesDiv").empty().append(b.toString());}},_selectOrg:function(d){var b=this;var g=[];var a=d;
while(a){g.push(a);a=a.getParentNode();}var f=new StringBuffer();for(var c=g.length-1;c>=0;c--){if(c==0){f.append('<li class="active">'+g[c].name+"</li>");
}else{f.append("<li>"+g[c].name+"</li>");}}$(".breadcrumb").empty().append(f.toString());var e={treeNodeId:d.id,treeNodeType:d.type};if(b.employee._hadInitJqgrid){b.employee._reloadJqgrid(e);
}else{b.employee._hadInitJqgrid=true;b.employee._initJqgrid(e);}},_bindFormValidation:function(){jQuery.validator.addMethod("isNumber",function(c,b){return this.optional(b)||/^[-\+]?\d+$/.test(c)||/^[-\+]?\d+(\.\d{1}|\.\d{2})?$/.test(c);
},"只能输入两位小数");var a={rules:{name:{required:true},isSale:{required:true},workHours:{isNumber:true,min:0.01},workDays:{isNumber:true,min:0.01},smsLimit:{required:false,digits:true,min:0,},percentLimit:{digits:true,number:true,min:10,max:100},autoPercent:{digits:true,number:true,min:0,max:100}}};
FormUtils.bindFormValidation("orgForm",a);}};function EmployeeRate(a){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.employee=a;
}EmployeeRate._CONS_={SAVE_BATCH_RATE:ctx+"/gl/ou/employeeRate/saveBatch.htm",GRID:"#employeeGrid",};EmployeeRate.prototype={init:function(b){var a=this;
if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._hideNotGrantBtn();}},_hideNotGrantBtn:function(){if(!ResUtils.canShow("employee.button.rate")){$(".addEmployeeRateBtn").hide();
$(".addEmployeeRateBtn").hide();}if("myGroup"==type){$(".addEmployeeRateBtn").hide();$(".addEmployeeRateBtn").hide();}},_bindEventHander:function(){var a=this;
$(document).on("click",".orgRateBtn",function(){var b=a.employee.employeeGroup.currentRightClickTreeNode.id;a._setOrgRate(b,a.employee.employeeGroup.currentRightClickTreeNode.name);
});$(document).on("click",".addEmployeeRateBtn",function(){var b=$(this).attr("idVal");if(!b){b=$(EmployeeRate._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error("错误","请选择要操作的记录");return;}if(b.length>1){DialogUtils.error("错误","不能同时操作多个");return;}}var c=$(EmployeeRate._CONS_.GRID).jqGrid("getRowData",b);
if(c.isBelongSaleOrg!="y"){DialogUtils.error("错误","所选员工不属于销售部门,不能设置提成比率");return;}a._setEmployeeRate(b,c.name);});},_setEmployeeRate:function(b,c){var a=this;
layer.open({type:2,title:'设置<font style="color:red;">【'+c+"】</font>员工提成比率",maxmin:false,shadeClose:true,btn:["保存","取消"],area:["70%","65%"],content:ctx+"/crm/ou/employee/toRate.htm?partyId="+b+"&partyType=employee",yes:function(e,d){var f={partyType:"employee",partyId:b,};
a._setPartyRate(f,e,d);}});},_setPartyRate:function(h,e,b){var a=layer.getChildFrame("body",e);var d=$(".groupRatePanel tbody tr",a);var g=[];if(!$("#orgRateForm",a).valid()){return;
}if(d.length){d.each(function(j,m){var n=$(m);var l=n.find(".rate").val().trim();var k=n.find(".money").val().trim();var o=new StringBuffer();o.append("money=");
o.append(k);o.append("#");o.append("rate=");o.append(l);g.push(o.toString());});}var c=g.join(",");var f=new StringBuffer();f.append("values=").append(c);
f.append("&").append("partyType=").append(h.partyType);f.append("&").append("partyId=").append(h.partyId);FormUtils.submit(EmployeeRate._CONS_.SAVE_BATCH_RATE,f.toString(),function(j){if(j.success){DialogUtils.success(msgCode.SUCCESS,j.msg);
layer.close(e);}else{DialogUtils.error(msgCode.ERROR,j.msg);}},function(){DialogUtils.error(msgCode.ERROR,"服务器错误");});},_setOrgRate:function(c,b){var a=this;
layer.open({type:2,title:'设置<font style="color:red;">【'+b+"】</font>提成比率",maxmin:false,shadeClose:true,btn:["保存","取消"],area:["50%","65%"],content:ctx+"/crm/ou/employee/toRate.htm?partyId="+c+"&partyType=organization",yes:function(e,d){var f={partyType:"organization",partyId:c,};
a._setPartyRate(f,e,d);}});}};function EmployeePercent(a){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.employee=a;}EmployeePercent._CONS_={SAVE_PERCENTAGES:ctx+"/gl/ou/employeePercentage/saveBatch.htm",GRID:"#employeeGrid",};
EmployeePercent.prototype={init:function(b){var a=this;if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._hideNotGrantBtn();}},_hideNotGrantBtn:function(){if(!ResUtils.canShow("employee.button.percentage")){$(".addEmployeeRateMoneyBtn").hide();
}if("myGroup"==type){$(".addEmployeeRateMoneyBtn").hide();}},_bindEventHander:function(){var a=this;$(document).on("click",".addEmployeeRateMoneyBtn",function(){var b=$(this).attr("idVal");
if(!b){b=$(EmployeePercent._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error("错误","请选择要操作的记录");return;}if(b.length>1){DialogUtils.error("错误","不能同时操作多个");
return;}}var c=$(EmployeePercent._CONS_.GRID).jqGrid("getRowData",b);if(c.isBelongSaleOrg!="y"){DialogUtils.error("错误","所选员工不属于销售部门,不能录入提成");return;}a._addEmployeePercentage(b,c.name);
});},_addEmployeePercentage:function(b,c){var a=this;layer.open({type:2,title:'录入<font style="color:red;">【'+c+"】</font>员工提成",maxmin:false,btn:["保存","取消"],shadeClose:true,area:["75%","75%"],content:ctx+"/gl/ou/employeePercentage/toEmployeePercentage.htm?employeeId="+b+"&periodType=month",yes:function(h,e){var d=layer.getChildFrame("body",h);
if(!$("#employeePercentageForm",d).valid()){return;}var k=[];var g=$(".data-table tbody tr",d);if(g.length){g.each(function(m,n){var o=$(n);var q=""+o.find(".periodYear").val()+o.find(".periodMonth").val();
var l=o.find(".percentage").val();var p=new StringBuffer();p.append("percentage=");p.append(l);p.append("#");p.append("period=");p.append(q);k.push(p.toString());
});}var f=k.join(",");var j=new StringBuffer();j.append("values=").append(f);j.append("&").append("periodType=").append("month");j.append("&").append("employeeId=").append(b);
FormUtils.submit(EmployeePercent._CONS_.SAVE_PERCENTAGES,j.toString(),function(l){if(l.success){DialogUtils.success(msgCode.SUCCESS,l.msg);layer.close(h);
}else{DialogUtils.error(msgCode.ERROR,l.msg);}},function(){DialogUtils.error(msgCode.ERROR,"服务器错误");});}});}};function EmployeeEditBatch(a){this.hadInit=false;
this.isEdit=false;this.isFormDataChange=false;this.currentPosition=null;this.employee=a;}EmployeeEditBatch._CONS_={SAVE_EDIT_BATCH:ctx+"/crm/ou/employee/saveEditBatch.htm",LIST_ID_DATA:ctx+"/crm/ou/employee/listIdData.htm",GRID:"#employeeGrid",};
EmployeeEditBatch.prototype={init:function(b){var a=this;if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._hideNotGrantBtn();}},_hideNotGrantBtn:function(){if(!ResUtils.canShow("employee.button.editBatch")){$(".employeeEditBtch").hide();
}if("myGroup"==type){$(".employeeEditBtch").hide();}},_bindEventHander:function(){var a=this;$(document).on("click",".employeeEditBtch",function(){var b=$(EmployeeRate._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(!b||b.length<=0){var c=$("#employeeSearchForm").serialize();c=c+"&treeNodeId="+a.employee.employeeGroup.currentClickTreeNode.id;FormUtils.loadData(EmployeeEditBatch._CONS_.LIST_ID_DATA+"?"+c,function(d){a._setEmployeeEditBatch(d);
});}else{a._setEmployeeEditBatch(b);}});},_setEmployeeEditBatch:function(c){var a=this;var b="demo-class";layer.open({type:2,title:'您正在对<font style="color:red;">【'+c.length+'个】</font>员工进行批量修改操作。<font style="color:red;">提示：只有勾选才有效</font>',maxmin:false,shadeClose:true,btn:["保存","取消"],area:["600px","520px"],zIndex:"9999",content:ctx+"/crm/ou/employee/toEditBatch.htm",skin:b,yes:function(e,d){DialogUtils.confirmWithOptions({title:"确定批量修改当前结果？",text:"",confirmButtonText:"确定",yesFunc:function(){a._saveEmployeeEditBatch(c,e,d);
}});}});},_saveEmployeeEditBatch:function(f,d,b){var c=this;var a=layer.getChildFrame("body",d);var g=this._getParams(f,a);if(!g){return false;}var e=g.msg;
FormUtils.submit(EmployeeEditBatch._CONS_.SAVE_EDIT_BATCH,"jsondata="+JSON.stringify(g),function(j){if(j.success){DialogUtils.success(msgCode.SUCCESS,"批量修改"+f.length+"个员工资料。修改了"+e);
layer.close(d);var h=$("#employeeSearchForm").serialize();h=h;c.employee._reloadJqgrid(h);}else{DialogUtils.error(msgCode.ERROR,j.msg);}},function(){DialogUtils.error(msgCode.ERROR,"服务器错误");
});},_getParams:function(a,g){var j=$("#editBatchForm table tr",g);var c={ids:a,positions:"",roleIds:"",status:"",groupId:"",msg:""};var f=false;var e=false;
var m=new StringBuffer();for(var d=0,h=j.length;d<h;d++){if(!$(j[d]).find("input[type=checkbox]")[0].checked){continue;}if(d==0){var k=$(j[d]).find("input[name=positionBatch]").val();
c.positions=k;if(c.positions){m.append("[岗位]、");}e=true;}else{if(d==1){f=true;var b=$(j[d]).find("select[name=roleIds]").val();c.roleIds=(b&&b.length>0)?b.join(","):"";
if(c.roleIds){m.append("[角色]、");}}else{if(d==2){f=true;c.status=$(j[d]).find("input[name=status]:checked").val();if(c.status){m.append("[状态]、");}}else{if(d==3){f=true;
c.groupId=$(j[d]).find("input[name=groupId]").val();if(c.groupId){m.append("[部门],将部门移动到了["+$(j[d]).find("input[name=orgName]").val()+"]、");}}}}}}if(e&&!c.positions){c.positions=true;
}if(!(f||e)){DialogUtils.error("警告","勾选需要修改的项！或者点击取消",g);return false;}if(!((f&&(c.roleIds||c.status||c.groupId))||e)){DialogUtils.error("警告","请填写需要修改的内容！或者点击取消",g);
return false;}var l=m.toString();c.msg=l.substring(0,l.length-1)+"。";return c;}};var PositionUtils={loadPositionOptions:function(a){a.url=ctx+"/gl/ou/position/findAllPosition.htm",a.caption="请选择岗位";
return OptionsBaseUtils.getOptions(a);},clearPositionCache:function(a){var b=ctx+"/gl/ou/position/findAllPosition.htm";window.sessionStorage.removeItem(b);
},};var RoleUtils={loadAllRole:function(a){a.url=ctx+"/crm/ou/role/listData.htm?Q__S__EQ__sys_="+a.sys+"&sys="+a.sys;if(!a.positionType){a.url=a.url;}a.key="id";
a.keyName="name";a.caption="选择要复制的角色(角色不复制到用户)";return OptionsBaseUtils.getOptions(a);},loadEcmRoleOpt:function(a){a.url=ctx+"/crm/ou/role/listData.htm?Q__S__EQ__sys_=ecm&sys=ecm";
a.key="id";a.keyName="name";a.caption="请选择角色";return OptionsBaseUtils.getOptions(a);},};function AddressService(a){this.container=a;this.isHideCountry=false;
}AddressService._CONS_={CATE_TYPE_KEY:"AddressCateType",ROOT_KEY:"AddressCateType-root"};AddressService.prototype={init:function(b,a){if(!b||!b.isNotRequired){$("#"+this.container).empty().append("<div class='col-sm-12'><label class='control-label col-sm-2'>所在地<span style='color:red;'>*</span></label><div class='col-sm-10 container' style='padding-left:0px !important;'></div></div>");
}else{if(b.isSelect&&b.isSelect=="y"){$("#"+this.container).empty().append("<div class='col-sm-12'><div class='col-sm-10 container' style='padding-left:0px !important;'></div></div>");
}else{if(b.rowFit&&b.rowFit=="y"){$("#"+this.container).empty().append("<label class='control-label col-sm-1'>所在地</label><div class='col-sm-11 container' style='padding-left:0px !important;'></div>");
}else{$("#"+this.container).empty().append("<label class='control-label col-sm-1'>所在地</label><div class='col-sm-6 container'></div></div>");}}}this.params=b;
this._bindEventHandler();if(b.isHideCountry){self.isHideCountry=b.isHideCountry;this._loadProvinces("ChinaCityCateType-root");}else{this._loadCountrys();
}if(a&&typeof(a)=="function"){a();}},getAddress:function(){var e=$("#"+this.container).find('select[name="country_"]').val();var a=$("#"+this.container).find('select[name="province_"]').val();
var d=$("#"+this.container).find('select[name="city_"]').val();var c=$("#"+this.container).find('select[name="area_"]').val();var b=$("#"+this.container).find("select[name='town_']").val();
return{country:e,countryName:$("#"+this.container).find('select[name="country_"]').find('option[value="'+e+'"]').text(),province:a,provinceName:$("#"+this.container).find('select[name="province_"]').find('option[value="'+a+'"]').text(),city:d,cityName:$("#"+this.container).find('select[name="city_"]').find('option[value="'+d+'"]').text(),area:c,areaName:$("#"+this.container).find('select[name="area_"]').find('option[value="'+c+'"]').text(),town:b,townName:b?$("#"+this.container).find("select[name='town_']").find("option[value='"+b+"']").text():"",};
},isValid:function(b){var a=true;$("#"+this.container).find("select").each(function(){var c=$(this).attr("name");var e=$(this).val();if(!e&&c!="town_"){a=false;
var d="";switch(c){case"country_":d="请选择国家";break;case"province_":d="请选择省份";break;case"city_":d="请选择城市";break;case"area_":d="请选择区县";break;}DialogUtils.error(msgCode.ERROR,d,b);
return false;}});return a;},_loadCountrys:function(){this._loadCates(AddressService._CONS_.ROOT_KEY,"country_");},_loadProvinces:function(a){this._loadCates(a,"province_");
},_loadCitys:function(a){this._loadCates(a,"city_");},_loadAreas:function(a){this._loadCates(a,"area_");},_loadTowns:function(a){this._loadCates(a,"town_");
},_loadCates:function(c,d){var a=this;var b=ctx+"/gl/cate/cate/getCateByCateTypeAndParentId.htm";b+="?cateType="+AddressService._CONS_.CATE_TYPE_KEY+"&parentKey="+c;
FormUtils.loadData(b,function(h){if(h.success){if(h.msg!=null&&h.msg!=""){var j=new StringBuffer();var g=JSON.parse(h.msg);if(g&&g.length>0){j.append("<div class='col-sm-2' style='padding-left:0px !important;'>");
j.append("<select class='form-control' name='"+d+"'>");j.append("<option value=''>请选择</option>");for(var e=0;e<g.length;e++){var f="";if(a.params){switch(d){case"country_":if(g[e].value==a.params.country){f="selected='selected'";
}break;case"province_":if(g[e].value==a.params.province){f="selected='selected'";}break;case"city_":if(g[e].value==a.params.city){f="selected='selected'";
}break;case"area_":if(g[e].value==a.params.area){f="selected='selected'";}break;case"town_":if(g[e].value==a.params.town){f="selected='selected'";}break;
}}j.append("<option "+f+" idValue='"+g[e].id+"' value='"+g[e].value+"'>"+g[e].name+"</option>");}j.append("</select>");j.append("</div>");$("#"+a.container).find(".container").append(j.toString());
if(a.params&&a.params.disabled){$("#"+a.container).find(".container").find("select").attr("disabled","disabled");}if(a.params){switch(d){case"country_":if(a.params.country&&!a.isHideCountry){a._loadProvinces(a.params.country);
}break;case"province_":if(a.params.province){a._loadCitys(a.params.province);}break;case"city_":if(a.params.city){a._loadAreas(a.params.city);}break;case"area_":if(a.params.area){a._loadTowns(a.params.area);
}break;}}}}}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},_bindEventHandler:function(){var a=this;$("#"+this.container).off("change",'select[name="country_"]');
$("#"+this.container).off("change",'select[name="province_"]');$("#"+this.container).off("change",'select[name="city_"]');$("#"+this.container).off("change","select[name='area_']");
$("#"+this.container).find("select[name='area_']").off("change");$("#"+this.container).on("change",'select[name="country_"]',function(){a.params=null;var b=$(this).val();
if(b){$(this).parent().nextAll().remove();a._loadProvinces(b);}else{$("#"+a.container).find("select[name=province_]").empty().append("<option value=''>请选择</option>");
$("#"+a.container).find("select[name=city_]").empty().append("<option value=''>请选择</option>");$("#"+a.container).find("select[name=area_]").empty().append("<option value=''>请选择</option>");
}$.log("change");});$("#"+this.container).on("change",'select[name="province_"]',function(){a.params=null;var b=$(this).val();if(b){$(this).parent().nextAll().remove();
a._loadCitys(b);}else{$("#"+a.container).find("select[name=city_]").empty().append("<option value=''>请选择</option>");$("#"+a.container).find("select[name=area_]").empty().append("<option value=''>请选择</option>");
}$.log("change");});$("#"+this.container).on("change",'select[name="city_"]',function(){a.params=null;var b=$(this).val();if(b){$(this).parent().nextAll().remove();
a._loadAreas(b);}else{$("#"+a.container).find("select[name=area_]").empty().append("<option value=''>请选择</option>");}$.log("change");});$("#"+this.container).on("change","select[name='area_']",function(){a.params=null;
var b=$(this).val();if(b){$(this).parent().nextAll().remove();a._loadTowns(b);}else{$("#"+a.container).find("select[name='town_']").empty().append("<option value=''>请选择</option>");
}$.log("change");});}};function UserPw(){this.hadInit=false;this.isEdit=false;this.layerIndex=null;}UserPw._CONS_={FORM_ID:"changeUserPwForm",PAGER:"#rolePager",SAVE_EDIT_URL:ctx+"/crm/ou/user/changePw.htm"};
UserPw.prototype={init:function(){if(!this.hadInit){var a=this;this.hadInit=true;this._bindEventHander();this._bindFormValidation();CapsLockUtils.listen($("#newPassword"));
CapsLockUtils.listen($("#password"));}},_changePassword:function(a){FormUtils.clear(UserPw._CONS_.FORM_ID);$("#passwordModalContainer").modal("show");$("#changeUserPwForm_userId").val(a);
},_bindEventHander:function(){var a=this;$(".changePwIndex").on("click",function(){a._changePassword(currentUserId);});$("body").on("click",".employeePWEdit",function(){a.isEdit=true;
var b=$(this).attr("idVal");if(!b){b=$(Employee._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error("错误","请选择要修改密码的记录");
return;}if(b.length>1){DialogUtils.error("错误","不能同时编辑多条记录");return;}}a._changePassword(b);});$("#savePasswordBtn").on("click",function(){if($("#"+UserPw._CONS_.FORM_ID).valid()){var b=$("#"+UserPw._CONS_.FORM_ID).serialize();
FormUtils.submit(UserPw._CONS_.SAVE_EDIT_URL,b,function(c){if(c.success){DialogUtils.success("提示",c.msg);$("#passwordModalContainer").modal("hide");FormUtils.clear(UserPw._CONS_.FORM_ID);
}else{DialogUtils.error("失败",c.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});}});$("#passwordModalContainer").on("hidden.bs.modal",function(){FormUtils.clear(UserPw._CONS_.FORM_ID);
});$("#passwordModalContainer").on("shown.bs.modal",function(){$("input[name='oldPassword']").focus();});},_bindFormValidation:function(){var a=this;var b={rules:{oldPassword:{required:true,minlength:["5"],},newPassword:{required:true,minlength:["5"],},rNewPassword:{required:true,equalTo:"#newPassword"}},messages:{rNewPassword:{equalTo:"两次输入的密码不一样"}}};
FormUtils.bindFormValidation(UserPw._CONS_.FORM_ID,b);}};var CapsLockUtils={listen:function(c){var b=false,a=false;c.tooltip("destroy");c.tooltip({title:"已启用大写锁定",trigger:"manual"});
c.keyup(function(f){var j=f||window.event,d=j.keyCode?j.keyCode:j.which,g=j.shiftKey?j.shiftKey:((d==16)?true:false),k=c.val().length;if(d==20){if(a){if(b){b=false;
c.tooltip("hide");}else{b=true;c.tooltip("show");}}}else{if(k){var h=c.val().charCodeAt(c.val().length-1);if(d>=65&&d<=90){if(((h>=65&&h<=90)&&!g)||((h>=97&&h<=122)&&g)){if(!b){b=true;
if(!a){a=true;}c.tooltip("show");}}else{if(b){b=false;c.tooltip("hide");}}}}}});}};function EmployeesSelect(){}EmployeesSelect.prototype={init:function(b){var c=ctx+"/crm/ou/employee/selectEmployee.htm";
var e=new StringBuffer();for(var a in b){if(a!="callBack"){e.append("&"+a+"="+b[a]);}else{window.myCallBack=b.callBack;}}e.append("&treeNodeType=group");
var d=e.toString();parent.layer.open({type:2,title:b.title?b.title:"选择员工",maxmin:false,shadeClose:true,btn:["确定","取消"],area:["85%","83%"],scrollbar:false,content:c+"?1=1"+d,success:function(f,g){f.myCallBack=b.callBack;
},end:function(){window.parent.myCallBack=null;},yes:function(j,g){var f=parent.layer.getChildFrame("body",j);var l=[];if(b&&b.isMultiple==1){var l=$("#employeeGrid",f).jqGrid("getGridParam","selarrrow");
}else{var n=$("#employeeGrid",f).jqGrid("getGridParam","selrow");if(n){l.push(n);}}if(l.length<0){DialogUtils.error(msgCode.ERROR,"请选择员工",f);return;}var m=[];
for(var k=0;k<l.length;k++){var h=$("#employeeGrid",f).jqGrid("getRowData",l[k]);h.id=l[k];m.push(h);}if(b.callBack){b.callBack(m);}parent.layer.close(j);
}});},initSelectComponent:function(a){function b(c){var d=null;if(c.container){if((typeof c.container)=="string"){d=$("#"+c.container);if(d.length==0){d=$("."+c.container);
if(d.length==0){d=$("[name='"+c.container+"']");if(d.length==0){d=null;throw Error(c.container+"容器不存在");}}}}else{if(c.container.length){d=c.container;}}}return d;
}FormUtils.loadData(ctx+"/crm/ou/employee/listEmployees.htm"+"?groupId="+a.groupId+"",function(g){if(a.fn){a.fn(g);return;}var c=b(a);c.empty();if(a.buildSelector){var d='<select class="form-control '+a.buildSelector.className+'" name="'+a.buildSelector.name+'" ></select>';
var f=$(d);c.append(f);c=f;}var h=new StringBuffer();h.append("<option value=''>请选择</option>");if(g&&g.length){for(var e=0;e<g.length;e++){if(a.selectedIds&&a.selectedIds.indexOf(g[e].id)>-1){h.append("<option selected='selected' value='"+g[e].id+"'>"+g[e].aid+":"+g[e].name+"</option>");
}else{h.append("<option value='"+g[e].id+"'>"+g[e].aid+":"+g[e].name+"</option>");}}}c.append(h.toString());if("chosen"==a.containerType){c.chosen("destroy");
c.chosen();}else{c.select2();}},null,true);},};var PositionUtils={loadPositionOptions:function(a){a.url=ctx+"/gl/ou/position/findAllPosition.htm",a.caption="请选择岗位";
return OptionsBaseUtils.getOptions(a);},clearPositionCache:function(a){var b=ctx+"/gl/ou/position/findAllPosition.htm";window.sessionStorage.removeItem(b);
},};var ProdCateService={selectProdCateTreeBox:function(a){var a={selectedIds:jQuery.isArray(a.selectedCateId)?a.selectedCateId.toString():a.selectedCateId,container:a.container,treeId:"menuContentForProdCate",isMultiple:a.isMultiple,otherParam:{selectedCateIds:a.selectedCateId},isSelectRoot:a.isSelectRoot,url:ctx+"/gl/cate/cate/loadCateTreeData.htm?cateTypeKey=product_catalog&rootKey=category",fn:a.fn};
CateUtils.selectTreeBox(a);}};function SeniorSearch(){this.hadInit=false;this.hadInitClik=false;this.treeNodeName="";}SeniorSearch.prototype={init:function(){if(!this.hadInit){this.hadInit=true;
this._hideSearchDiv();this._bindEventHander();}},_hideSearchDiv:function(){$("#seniorSearchDiv").hide();},_bindEventHander:function(){var a=this;$("#seniorSearch").on("click",function(){if($(this).text().indexOf("展开")!=-1){$("#seniorSearchDiv").slideDown("fast");
$(this).empty().append('收起<span class="fa fa-sort-up"></span>');}else{$(this).empty().append('展开<span class="fa fa-sort-down"></span>');$("#seniorSearchDiv").slideUp("fast");
}});$(document).on("click",".jt-blue",function(){if($(this).attr("id")=="attr-value"){return;}var d=$(this).attr("id-value");var c=$.fn.zTree.getZTreeObj(a.treeNodeName);
var b=c.getNodesByParam("id",d,null);$("#"+b[0].tId).find("a:eq(0)").trigger("click");});},initCrumbs:function(c,b,a){this.treeNodeName=b;var e=new StringBuffer();
if(a){e.append("<span id='attr-value' id-value='"+a.id+"' class='jt-blue'>"+$(".tabli.active").attr(a.attr)+"</span>");e.append("<i class='fa fa-angle-right'></i>");
if(!this.hadInitClik){$("body").on("click",".tabli",function(){var f=$(this).attr(a.attr);var g=$(this).attr("id");$("#attr-value").empty().append(f).attr("id-value",g);
});this.hadInitClik=true;}}e.append(d(c));$("#jt-crumbs").empty().append(e.toString());function d(f){if(f.level==0){return"<span class='jt-blue' id-value='"+f.id+"'>"+f.name+"</span>";
}else{return d(f.getParentNode())+"<i class='fa fa-angle-right'></i>"+"<span class='jt-blue' id-value='"+f.id+"'>"+f.name+"</span>";}}},};var SelectProdService={selectSku:function(p){var o=p&&p.storeId;
var f=p.isMultiple;var l=p.type;var n=p.hasStock;var e=p.canSale;var b=p.hideCanSale;var k=p.isSale;var d=p.limitProdCate;var j=p.priceType;var h=p.userId;
var m=p.showNotOnSale;var g=p.filterSeries;var c=p.agentId;if(!n){n="n";}if(!l){l="product";}if(!o){o="";}if(!b){b="n";}if(!d){d="n";}if(!k){k="n";}if(!j){j="";
}if(!e){e="n";}if(!m){m="n";}if(!c){c="";}var a=ctx+"/ec/product/prodEntity/selectSku.htm?";a+="storeId="+o;a+="&isMultiple="+f;a+="&type="+l;a+="&hasStock="+n;
a+="&hideCanSale="+b;a+="&limitProdCate="+d;a+="&priceType="+j;a+="&canSale="+e;a+="&isSale="+k;a+="&userId="+h;a+="&showNotOnSale="+m;a+="&filterSeries="+g;
a+="&agentId="+c;layer.open({type:2,title:"选择商品",maxmin:true,shadeClose:true,btn:["确定","取消"],area:["95%","95%"],scrollbar:false,maxmin:false,content:a,yes:function(r,q){var t=layer.getChildFrame("body",r);
var s=$("#selectedRowData",t).val();if(s&&s.length){layer.close(r);if(p.fn){p.fn(JSON.parse(s));}}else{DialogUtils.error("警告","请选择商品！或者点击取消",t);}},end:function(){if(p.end){p.end();
}}});},selectProd:function(a){var b=a.isMultiple;layer.open({type:2,title:"选择商品",shadeClose:true,btn:["确定","取消"],area:["80%","80%"],scrollbar:false,content:ctx+"/ec/product/prodEntity/selectProd.htm?isMultiple="+b,yes:function(e,c){var j=layer.getChildFrame("body",e);
var d=$("#prodEntityGrid",j).jqGrid("getGridParam","selarrrow");if(d){var h=[];for(var f=0;f<d.length;f++){var g=$("#prodEntityGrid",j).jqGrid("getRowData",d[f]);
g.prodId=d[f];g.prodName=g.name;h.push(g);}layer.close(e);if(a.fn){a.fn(h);}}}});}};var ReportDateUtil={initDate:function(f,e){e=e||$(document);var a=new Date();
var c=a.getFullYear();var d=new StringBuffer();for(var b=2010;b<=c;b++){d.append("<option value='").append(b).append("' >").append(b).append("年</option>");
}e.find("select[name=yearSearch]").append(d.toString());this._bindEventHander(f,e);},_bindEventHander:function(b,a){a=a||$(document);a.find(b).off("change","#timeTypeSearch");
a.find(b).on("change","#timeTypeSearch",function(){var d=new Date();a.find("select[name=yearSearch]").val(d.getFullYear());if(a.find(this).val()=="day"){a.find(".yearElement").hide();
a.find(".quarterElement").hide();a.find(".monthElement").hide();a.find(".dayElement").show();a.find(".dayElementBtn").show();a.find(".weekElement").hide();
a.find("input[id=endDate]").val(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+" 23:59:59");a.find("input[id=beginDate]").val(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+" 00:00:00");
}else{if(a.find(this).val()=="month"){a.find(".yearElement").show();a.find(".quarterElement").hide();a.find(".monthElement").show();a.find(".dayElement").hide();
a.find(".dayElementBtn").hide();a.find(".weekElement").hide();a.find("select[name=monthSearch]").val(d.getMonth()+1);}else{if(a.find(this).val()=="quarter"){a.find(".yearElement").show();
a.find(".quarterElement").show();a.find(".monthElement").hide();a.find(".dayElement").hide();a.find(".dayElementBtn").hide();a.find(".weekElement").hide();
a.find("select[name=quarterSearch]").val(parseInt((d.getMonth()+1)/3)+((d.getMonth()+1)%3>0?1:0));}else{if(a.find(this).val()=="year"){a.find(".yearElement").show();
a.find(".quarterElement").hide();a.find(".monthElement").hide();a.find(".dayElement").hide();a.find(".dayElementBtn").hide();a.find(".weekElement").hide();
}else{if(a.find(this).val()=="week"){a.find(".yearElement").hide();a.find(".quarterElement").hide();a.find(".monthElement").hide();a.find(".dayElement").show();
a.find(".dayElementBtn").hide();a.find(".weekElement").show();var e=d.getTime();var c=new Date(e-7*24*3600*1000);a.find("input[id=beginDate]").val(c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate());
a.find("input[id=endDate]").val(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate());}}}}}});a.find(b).off("click","#prevBtn");a.find(b).on("click","#prevBtn",function(){var c=new Date(a.find("input[id=beginDate]").val());
var d=new Date(a.find("input[id=endDate]").val());c.setDate(c.getDate()-1);d.setDate(d.getDate()-1);a.find("input[id=beginDate]").val(c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()+" 00:00:00");
a.find("input[id=endDate]").val(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+" 23:59:59");});a.find(b).off("click","#nextBtn");a.find(b).on("click","#nextBtn",function(){var c=new Date(a.find("input[id=beginDate]").val());
var d=new Date(a.find("input[id=endDate]").val());c.setDate(c.getDate()+1);d.setDate(d.getDate()+1);a.find("input[id=beginDate]").val(c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()+" 00:00:00");
a.find("input[id=endDate]").val(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+" 23:59:59");});a.find(b).off("click","#prevWeekBtn");a.find(b).on("click","#prevWeekBtn",function(){var c=new Date(a.find("input[id=beginDate]").val());
var d=new Date(a.find("input[id=endDate]").val());c.setDate(c.getDate()-7);d.setDate(d.getDate()-7);a.find("input[id=beginDate]").val(c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate());
a.find("input[id=endDate]").val(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate());});a.find(b).off("click","#nextWeekBtn");a.find(b).on("click","#nextWeekBtn",function(){var c=new Date(a.find("input[id=beginDate]").val());
var d=new Date(a.find("input[id=endDate]").val());c.setDate(c.getDate()+7);d.setDate(d.getDate()+7);a.find("input[id=beginDate]").val(c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate());
a.find("input[id=endDate]").val(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate());});},getDateTimeRangeStr:function(b){b=b||$(document);var a=new StringBuffer();
if(b.find("#timeTypeSearch").val()=="day"){if(b.find("#beginDate").val()!=""){a.append(b.find("#beginDate").val()).append(",");}else{a.append(",");}if(b.find("#endDate").val()!=""){a.append(b.find("#endDate").val());
}}else{if(b.find("#timeTypeSearch").val()=="week"){if(b.find("#beginDate").val()!=""){a.append(b.find("#beginDate").val()).append(" 00:00:00,");}else{a.append(",");
}if(b.find("#endDate").val()!=""){a.append(b.find("#endDate").val()).append(" 23:59:59");}}else{if(b.find("#timeTypeSearch").val()=="month"){a.append(DateUtils.format(DateUtils.getMonthFirst(b.find("#yearSearch").val(),b.find("#monthSearch").val()),DateUtils._CONS_.DEFAULT_DATE_TIME_PATTERN)).append(",").append(DateUtils.format(DateUtils.getMonthLast(b.find("#yearSearch").val(),b.find("#monthSearch").val()),DateUtils._CONS_.DEFAULT_DATE_TIME_PATTERN));
}else{if(b.find("#timeTypeSearch").val()=="quarter"){a.append(DateUtils.format(DateUtils.getQuarterFirst(b.find("#yearSearch").val(),parseInt(b.find("#quarterSearch").val())),DateUtils._CONS_.DEFAULT_DATE_TIME_PATTERN)).append(",").append(DateUtils.format(DateUtils.getQuarterLast(b.find("#yearSearch").val(),parseInt(b.find("#quarterSearch").val())),DateUtils._CONS_.DEFAULT_DATE_TIME_PATTERN));
}else{if(b.find("#timeTypeSearch").val()=="year"){a.append(DateUtils.format(DateUtils.getYearFirst(b.find("#yearSearch").val()),DateUtils._CONS_.DEFAULT_DATE_TIME_PATTERN)).append(",").append(DateUtils.format(DateUtils.getYearLast(b.find("#yearSearch").val()),DateUtils._CONS_.DEFAULT_DATE_TIME_PATTERN));
}}}}}return a.toString();},getEndDateTimeRangeStr:function(b){b=b||$(document);var a=new StringBuffer();if(b.find("#timeTypeSearch").val()=="day"){if(b.find("#endDate").val()!=""){a.append(b.find("#endDate").val());
}}else{if(b.find("#timeTypeSearch").val()=="month"){a.append(DateUtils.format(DateUtils.getMonthLast(b.find("#yearSearch").val(),b.find("#monthSearch").val()),DateUtils._CONS_.DEFAULT_DATE_PATTERN));
}else{if(b.find("#timeTypeSearch").val()=="quarter"){a.append(DateUtils.format(DateUtils.getQuarterLast(b.find("#yearSearch").val(),parseInt(b.find("#quarterSearch").val())),DateUtils._CONS_.DEFAULT_DATE_PATTERN));
}else{if(b.find("#timeTypeSearch").val()=="year"){a.append(DateUtils.format(DateUtils.getYearLast(b.find("#yearSearch").val()),DateUtils._CONS_.DEFAULT_DATE_PATTERN));
}}}}return a.toString();},getStartDateTimeRangeStr:function(b){b=b||$(document);var a=new StringBuffer();if(b.find("#timeTypeSearch").val()=="day"){if(b.find("#beginDate").val()!=""){a.append(b.find("#beginDate").val());
}}else{if(b.find("#timeTypeSearch").val()=="month"){a.append(DateUtils.format(DateUtils.getMonthFirst(b.find("#yearSearch").val(),b.find("#monthSearch").val()),DateUtils._CONS_.DEFAULT_DATE_PATTERN));
}else{if(b.find("#timeTypeSearch").val()=="quarter"){a.append(DateUtils.format(DateUtils.getQuarterFirst(b.find("#yearSearch").val(),parseInt(b.find("#quarterSearch").val())),DateUtils._CONS_.DEFAULT_DATE_PATTERN));
}else{if(b.find("#timeTypeSearch").val()=="year"){a.append(DateUtils.format(DateUtils.getYearFirst(b.find("#yearSearch").val()),DateUtils._CONS_.DEFAULT_DATE_PATTERN));
}}}}return a.toString();},getDateRangeStr:function(c){c=c||$(document);var b=new StringBuffer();if(c.find("#timeTypeSearch").val()=="day"){if(c.find("#beginDate").val()!=""){var a=c.find("#beginDate").val();
b.append(a.substring(0,4));a=a.substring(5,a.length);if(a.indexOf("-")<2){b.append("0");}b.append(a.replaceAll("-",""));}b.append(",");if(c.find("#endDate").val()!=""){var a=c.find("#endDate").val();
b.append(a.substring(0,4));a=a.substring(5,a.length);if(a.indexOf("-")<2){b.append("0");}b.append(a.replaceAll("-",""));}}else{if(c.find("#timeTypeSearch").val()=="month"){var a=DateUtils.format(DateUtils.getMonthFirst(c.find("#yearSearch").val(),c.find("#monthSearch").val()),"yyyy-MM-dd");
b.append(a.substring(0,4));a=a.substring(5,a.length);if(a.indexOf("-")<2){b.append("0");}b.append(a.replaceAll("-","")).append(",");a=DateUtils.format(DateUtils.getMonthLast(c.find("#yearSearch").val(),c.find("#monthSearch").val()),"yyyy-MM-dd");
b.append(a.substring(0,4));a=a.substring(5,a.length);if(a.indexOf("-")<2){b.append("0");}b.append(a.replaceAll("-",""));}else{if(c.find("#timeTypeSearch").val()=="quarter"){var a=DateUtils.format(DateUtils.getQuarterFirst(c.find("#yearSearch").val(),parseInt(c.find("#quarterSearch").val())),"yyyy-MM-dd");
b.append(a.substring(0,4));a=a.substring(5,a.length);if(a.indexOf("-")<2){b.append("0");}b.append(a.replaceAll("-","")).append(",");a=DateUtils.format(DateUtils.getQuarterLast(c.find("#yearSearch").val(),parseInt(c.find("#quarterSearch").val())),"yyyy-MM-dd");
b.append(a.substring(0,4));a=a.substring(5,a.length);if(a.indexOf("-")<2){b.append("0");}b.append(a.replaceAll("-",""));}else{if(c.find("#timeTypeSearch").val()=="year"){var a=DateUtils.format(DateUtils.getYearFirst(c.find("#yearSearch").val()),"yyyy-MM-dd");
b.append(a.substring(0,4));a=a.substring(5,a.length);if(a.indexOf("-")<2){b.append("0");}b.append(a.replaceAll("-","")).append(",");a=DateUtils.format(DateUtils.getYearLast(c.find("#yearSearch").val()),"yyyy-MM-dd");
b.append(a.substring(0,4));a=a.substring(5,a.length);if(a.indexOf("-")<2){b.append("0");}b.append(a.replaceAll("-",""));}}}}return b.toString();}};function EmployeeProfitPk(){this.hadInit=false;
this.options={callBack:null,};this.selectedEmployee=[];this.selectedEmployeeId=[];this.selectedEmployeeMap={};}EmployeeProfitPk._CONS_={FIND_PROFIT_PK_URL:ctx+"/crm/ou/employee/findProfitPk.htm",EXPORT_PROFIT_PK_URL:ctx+"/crm/ou/employee/exportProfitPk.htm",};
EmployeeProfitPk.prototype={init:function(a){this.selectedEmployee=[];this.selectedEmployeeId=[];this.selectedEmployeeMap={};this._openDialog(a);this._bindEventHander();
this._initEmployee();this._addSelectedEmployee(a);},_openDialog:function(a){$("#profitPkContainer").modal("show");FormUtils.clear("employeeProfitPkForm");
$("#timeTypeSearch").change();},_bindEventHander:function(){var a=this;$("body").off("click","#selectEmployeeBtn").on("click","#selectEmployeeBtn",function(){var b=new EmployeesSelect();
var c=0;b.init({isShowAllGroup:c,grantType:"/cs/",isOnlySelfGroup:1,isMultiple:1,mode:1,type:"positionContext",callBack:function(d){a._addSelectedEmployee(d);
}});});$("#selected-emp-container").off("click",".deleteEmployeeBtn").on("click",".deleteEmployeeBtn",function(){var c=$(this).parents(".emp").attr("id").replace("emp-","");
$(this).parents(".emp").remove();delete a.selectedEmployeeMap[c];for(var b=0;b<a.selectedEmployee.length;b++){if(a.selectedEmployee[b].id==c){$("#select-employee").trigger("keyup");
a.selectedEmployee.splice(b,1);break;}}for(var b=0;b<a.selectedEmployeeId.length;b++){if(a.selectedEmployeeId[b]==c){a.selectedEmployeeId.splice(b,1);break;
}}$("#employee-table-"+c).find("input[type='checkbox']").prop("checked",false);});$("body").on("click",function(b){if($(b.target).attr("id")=="select-employee"){return;
}if($(b.target).parents("#select-employee-container").length<=0){$("#select-employee-container").hide();}});$("#select-employee").off("keyup").on("keyup",function(){var b=$(this).val();
a._fiterEmployee(b);});$("#select-employee").off("focus").on("focus",function(){$("#select-employee-container").show();});$(".employProfitPkClose").off("focus").on("focus",function(){$("#profitPkContainer").modal("hide");
$("#reset-emp-Btn").trigger("click");});$("#reset-emp-Btn").off("click").on("click",function(){$("#selected-emp-container").empty();a.selectedEmployee=[];
a.selectedEmployeeId=[];a.selectedEmployeeMap={};$("#select-employee").trigger("keyup");$("#select-employee-container").find("input[type='checkbox']").prop("checked",false);
});$(".profitPKSearch").off("click").on("click",function(){var e=a.selectedEmployee;var c=$("#employeeProfitPkForm").find("input[name=Q__S__EQ__type_]:checked").val();
if(e==null){DialogUtils.success(msgCode.ERROR,"请选择员工");return;}if($("#beginDate").val()==null||$("#endDate").val()==null){DialogUtils.error(msgCode.ERROR,"请选择时间");
return;}if(c==null){DialogUtils.error(msgCode.ERROR,"请选择PK类型");return;}var b=JSON.stringify(a.selectedEmployeeId);var d=$("#employeeProfitPkForm").serialize()+"&Q__D__BW__place_time_="+ReportDateUtil.getDateTimeRangeStr()+"&employeeIds="+b.substr(1,b.length-2).replaceAll('"',"");
FormUtils.loadData(EmployeeProfitPk._CONS_.FIND_PROFIT_PK_URL+"?"+d,function(g){var h=new StringBuffer();for(var f=0;f<g.length;f++){h.append("<tr>");h.append('<td style="width: 20%">');
h.append(f+1);h.append("</td>");h.append('<td style="width: 25%">');h.append(g[f].aid);h.append("</td>");h.append('<td style="width: 25%">');h.append(g[f].name);
h.append("</td>");h.append('<td style="width: 30%">');if("ship"==c){h.append(g[f].shipAmount);}else{h.append(g[f].auditAmount);}h.append("</td>");h.append("</tr>");
}$("#profitPKTableContainer").empty().append(h.toString());});});$(".profitPKExportExcel").off("click").on("click",function(){var b=JSON.stringify(a.selectedEmployeeId);
var c=$("#employeeProfitPkForm").serialize()+"&Q__D__BW__place_time_="+ReportDateUtil.getDateTimeRangeStr()+"&employeeIds="+b.substr(1,b.length-2).replaceAll('"',"");
window.location.href=EmployeeProfitPk._CONS_.EXPORT_PROFIT_PK_URL+"?"+c;});$("body").off("click","#select-employee-table tr").on("click","#select-employee-table tr",function(h){if(h.target.tagName=="INPUT"||h.target.tagName=="input"){}else{var m=$(this).find("input[type='checkbox']")[0].checked;
$(this).find("input[type='checkbox']").prop("checked",!m);}var d=$(this).find("input[type='checkbox']");var m=d[0].checked;var c=d.attr("data-id");var b=d.attr("data-name");
var f=d.attr("data-aid");var k=d.attr("data-orgName");var l={id:c,name:b,aid:f,orgName:k};var j=[];j.push(l);if(m){a._addSelectedEmployee(j);}else{$("#emp-"+c).remove();
delete a.selectedEmployeeMap[c];for(var g=0;g<a.selectedEmployee.length;g++){if(a.selectedEmployee[g].id==c){a.selectedEmployee.splice(g,1);break;}}for(var g=0;
g<a.selectedEmployeeId.length;g++){if(a.selectedEmployeeId[g]==c){a.selectedEmployeeId.splice(g,1);break;}}}});},_fiterEmployee:function(c){for(var b=0;
b<this.employeeList.length;b++){var a=this.employeeList[b];if(!this.selectedEmployeeMap.hasOwnProperty(a.id)){if((a.name.indexOf(c)!=-1||a.aid.indexOf(c)!=-1)){$("#employee-table-"+a.id).show();
}else{$("#employee-table-"+a.id).hide();}}}},_addSelectedEmployee:function(d){var a=this;var e=new StringBuffer();for(var c=0;c<d.length;c++){var b=d[c];
if(!a.selectedEmployeeMap.hasOwnProperty(b.id)){e.append('<div class="emp" id="emp-'+b.id+'"').append(">").append("<span>"+b.aid+":"+b.name+"</span>").append('<span class="blue">|</span>').append('<i class="fa fa-remove deleteEmployeeBtn"></i>').append("</div>");
a.selectedEmployee.push(b);a.selectedEmployeeId.push(b.id);a.selectedEmployeeMap[b.id]=b.id;$("#employee-table-"+b.id).find("input[type='checkbox']").prop("checked",true);
}}$("#selected-emp-container").append(e.toString());},_initEmployee:function(){var a=this;var b=ctx+"/crm/ou/employee/search.htm?keyword=";FormUtils.loadData(b,function(c){a.employeeList=c.value;
a._createEmployeeTable();});},_createEmployeeTable:function(){var b=this.employeeList;var c=new StringBuffer();for(var a=0;a<b.length;a++){c.append('<tr id="employee-table-'+b[a].id+'">').append('<td width="10%"><input type="checkbox"').append(' data-id="'+b[a].id+'"').append(' data-groupId="'+b[a].groupId+'"').append(' data-name="'+b[a].name+'"').append(' data-aid="'+b[a].aid+'"').append(' data-orgName="'+b[a].orgName+'"').append('<td width="45%">'+b[a].name+":"+b[a].aid+"</td>").append('<td width="45%">'+b[a].orgName+"</td>").append("</tr>");
}$("#select-employee-table").empty().append(c.toString());},};var excelUtil={toGenExcel:function(a,b,c){JTTabUtils.addOrRefreshTab(ctx+"/gl/mc/moduleColumn/toGenExcel.htm?module="+a+"&moduleText="+c,b);
},importExcel:function(a){if(a.isCreateSub){JTTabUtils.addOrRefreshTab(ctx+"/gl/mc/moduleColumn/importExcel.htm?importUrl="+a.importUrl+"&isCreateSub="+a.isCreateSub,a.tabTitle);
}else{JTTabUtils.addOrRefreshTab(ctx+"/gl/mc/moduleColumn/importExcel.htm?importUrl="+a.importUrl,a.tabTitle);}},findExportColByModule:function(c,b,d){var a=ctx+"/gl/mc/moduleColumn/findByModule.htm?module="+c;
if(b){a=ctx+"/gl/mc/moduleColumn/findGrantCol.htm?module="+c;}FormUtils.loadData(a,function(e){if(d){d(e);}});}};function TeamPk(){this.hadInit=false;this.isEdit=false;
this.isFormDataChange=false;this.selectedEmployee=[];this.selectedEmployeeMap={};this.teamPkEmp=new TeamPkEmp();}TeamPk._CONS_={EDIT_URL:ctx+"/crm/ou/team/teamPk/edit.htm",DETAIL_URL:ctx+"/crm/ou/team/teamPk/detail.htm",DELETE_URL:ctx+"/crm/ou/team/teamPk/delete.htm",SAVE_ADD_URL:ctx+"/crm/ou/team/teamPk/saveAdd.htm",SAVE_EDIT_URL:ctx+"/crm/ou/team/teamPk/saveEdit.htm",LIST_DATA_URL:ctx+"/crm/ou/team/teamPk/listData.htm",FIND_TEAMINFO_URL:ctx+"/crm/ou/team/teamPk/findTeamInfo.htm",EDIT_FORM_ID:"teamPkForm",GRID:"#teamPkGrid",PAGER:"#teamPkPager"};
TeamPk.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._loadData();this._initEmployee();this._hideNotGrantBtn();
}},_initEmployee:function(){var a=this;var b=ctx+"/crm/ou/employee/search.htm?keyword=";FormUtils.loadData(b,function(c){a.employeeList=c.value;});},_initEmployeeTable:function(d){var a=this;
if(d&&d.length>0){var e=new StringBuffer();for(var c=0;c<d.length;c++){var b=d[c];e.append('<div class="emp" idVal="'+b.empId+'" id="emp-'+b.empId+'"').append(">").append('<i class="fa fa-user" aria-hidden="true" style="color: #f8ac59;"></i>&nbsp;').append("<span>"+b.aid+":"+b.name+"").append('<span class="blue">|</span>').append('<i class="fa fa-remove deleteEmployeeBtn"></i>').append("</div>");
a.selectedEmployeeMap[b.empId]=b.empId;}return e.toString();}else{return"<span class='noData'>该团队内还没有任何成员哦</span>";}},_createEmployeeTable:function(c,a,f,e){var g=this.employeeList;
if(e=="1"){c="";}var h=new StringBuffer();for(var d=0;d<g.length;d++){var b=g[d];if(this.selectedEmployeeMap.hasOwnProperty(b.id)){continue;}if(c==""||c.indexOf(b.groupId)!=-1){h.append('<tr id="employee-table-'+g[d].id+'">').append('<td width="10%"><input type="checkbox"');
if($.inArray(b.id,f)!=-1){h.append(' data-id="'+g[d].id+'" checked ');}else{h.append(' data-id="'+g[d].id+'"');}h.append(' data-groupId="'+g[d].groupId+'"').append(' data-name="'+g[d].name+'"').append(' data-aid="'+g[d].aid+'"').append(' data-orgName="'+g[d].orgName+'"></td>');
h.append('<td width="45%">'+g[d].name+":"+g[d].aid+"</td>").append('<td width="45%">'+g[d].orgName+"</td>").append("</tr>");}}a.find(".select-employee-table").empty().append(h.toString());
},_loadTeam:function(c){var a=this;var b=TeamPk._CONS_.FIND_TEAMINFO_URL;FormUtils.loadData(b+"?id="+c,function(d){if(d){$("#teamPkInfo").empty().append(a.tGLi(d));
}});},_loadData:function(c){var a=this;var b=TeamPk._CONS_.LIST_DATA_URL;FormUtils.loadData(b,function(g){teamDatas=g;if(!c){var h=new StringBuffer();if(g.rows&&g.rows.length>0){h.append("<li class='teamLi'><input  readonly='readonly' style='text-align:center' class='form-control activeLi' value='全部'></li>");
var d=g.rows;for(var e=0;e<d.length;e++){h.append("<li class='teamLi teamLiOne'><input readonly='readonly' idVal='"+d[e].id+"' style='text-align:center' class='form-control' value='"+d[e].name+"'></li>");
}}if(ResUtils.canShow("teamPk.button.add")){h.append("<li class='addTeamLi' style='margin:10px 0;'> ");h.append("<div class='addTeamLi-input'><input id='addTeamInput'></div>");
h.append("<div class='addTeamLi-btn'><button class='btn btn-sm btn-primary' id='addTeamBtn'><i class='fa fa-plus'></i>&nbsp;添加</button></div></li>");}$("#loadTeam").empty().append(h.toString());
}if(g){var d=g.rows;var f=new StringBuffer();$.each(d,function(j,k){f.append(a.tGLi(this));});}$("#teamPkInfo").empty().append(f.toString());});},tGLi:function(b){var a=this;
var c=new StringBuffer();c.append('<div class="team-group-li">').append('<div class="imageDiv" style="display:none;"></div>').append('<div class="team-group-profile">').append("<div>").append('<img class="imgDiv" urlval="'+b.img+'" src="'+ctx+b.img+'" onerror="tgImgError(this);">').append("</div>").append("</div>").append('<div class="team-group-msg">').append('<div class="team-group-name"><i class="fa fa-bookmark" aria-hidden="true"></i>&nbsp;<span class="teamId" createTime="'+b.createTime+'" idVal="'+b.id+'">'+b.name+"</span></div>").append('<div class="team-group-member tg-active"><i class="fa fa-user" aria-hidden="true"></i>&nbsp;团队成员&nbsp;:&nbsp;<span class="selected-emp-count">'+b.teamPkEmpPos.length+"</span>人</div>").append("</div>").append('<div class="team-group-pk"><div><img src="'+ctx+'/img/jt/cs/pk.png"></div><div class="team-group-direct"></div></div>').append('<div class="team-group-target">').append(a._selectPkTeam(b.id,b.pkTeamId)).append('<div class="tg-target-border"></div>').append("</div>").append('<div class="team-group-list">').append('<div class="tg-list-head">').append('<div class="tg-head-title">已选成员</div>').append('<button type="button" class="btn btn-sm  btn-blank add-employee-Btn"><i class="fa fa-plus"></i>&nbsp;添加成员</button>').append('<button type="button" class="btn btn-sm  btn-reset reset-employee-Btn"><i class="fa fa-trash-o"></i>&nbsp;清空</button>').append("</div>").append('<div class="tg-list-body">').append('<div class="samll-scrollbar selected-emp-container">'+a._initEmployeeTable(b.teamPkEmpPos)+"</div>").append("</div>").append("</div>").append('<div class="tg-select">').append('<div class="selectDep">').append('<input readonly="" placeholder="请选择部门" class="form-control select-by-group" id="select-by-group'+b.id+'" title="请选择部门">').append('<input name="assignOgn" type="hidden">').append("</div>").append('<div class="selectEmp">'+a._initEmps()+"</div>").append("</div>").append("</div>");
return c.toString();},_initEmps:function(){var a=this;var b=new StringBuffer();b.append("<input placeholder='请选择员工' readonly class='form-control select-employee'></div>");
b.append("<div class='select-employee-container'>");b.append("<div style='height:7%;width:100%;'>");b.append("<table class='table' style='background-color: #1caf9a;color: #fff;'>");
b.append("<tr><th width='10%'><input type='checkbox' class='employee-select-all'/></th>");b.append("<th width='45%'>员工</th><th width='45%'>部门</th></tr></table></div>");
b.append("<div style='height: 352px;width: 100%;overflow: auto;border-top: 1px solid #ccc; border-bottom: 1px solid #ccc;'>");b.append("<table class='select-employee-table'></table></div>");
return b.toString();},_initEmp:function(){var a=this;var b=new StringBuffer();b.append("<input placeholder='请选择员工' readonly class='form-control select-employee' style='cursor: pointer;float: left;'>");
b.append("<div  class='col-md-12 col-sm-12 select-employee-container' style='width:calc(100% - 4px);display: none;height: 380px;position: absolute;background-color: #fff;z-index: 100;margin: 27px 0px 0px 0px; border: 1px solid #ccc;'>");
b.append("<div style='height:7%;width:100%;'>");b.append("<table class='table' style='background-color:#e6e2e2;'>");b.append("<tr><th width='10%'><input type='checkbox' class='employee-select-all'/></th>");
b.append("<th width='45%'>员工</th><th width='45%'>部门</th></tr></table></div>");b.append("<div style='height: 352px;width: 100%;overflow: auto;border-top: 1px solid #ccc; border-bottom: 1px solid #ccc;'>");
b.append("<table class='select-employee-table'></table></div></div>");return b.toString();},_selectPkTeam:function(e,b){var d=new StringBuffer();var a=teamDatas.rows;
d.append("<select class='selectPkTeam'>");d.append("<option value=''>请选择</option>");for(var c=0;c<a.length;c++){if(e!=a[c].id){if(b==a[c].id){d.append("<option selected='selected' value='"+a[c].id+"'>"+a[c].name+"</option>");
}else{d.append("<option value='"+a[c].id+"'>"+a[c].name+"</option>");}}}d.append("</select>");return d.toString();},_hideNotGrantBtn:function(){if(!ResUtils.canShow("teamPk.button.saveAll")){$(".saveButtonDiv").hide();
}},_save:function(e){var b=this;var a=e?TeamPk._CONS_.SAVE_EDIT_URL:TeamPk._CONS_.SAVE_ADD_URL;var c=$("#addTeamInput").val();if(!c){DialogUtils.error("提示","队名不能为空");
return false;}var d="";d+="&name="+c;FormUtils.submit(a,d,function(f){$(".saveBtn").attr("disabled",false);if(f.success){DialogUtils.success("提示",f.msg);
b._loadData();}else{DialogUtils.error("失败",f.msg);}},function(){$(".saveBtn").attr("disabled",false);DialogUtils.error("错误","后台异常，请稍后重试");});},_showRightMenu:function(a){$("#editTeam-menu").css({top:(a.y-50)+"px",left:(a.x-25)+"px",display:"block"});
if(!ResUtils.canShow("teamPk.button.editName")){$("#teamEditBtn").hide();}if(!ResUtils.canShow("teamPk.button.delete")){$("#teamDelBtn").hide();}},_updateName:function(d,c){var a=this;
var b=ctx+"/crm/ou/team/teamPk/updateName.htm";FormUtils.submit(b,{"id":d,"name":c},function(e){if(e){DialogUtils.success(msgCode.INFO,"修改成功");$("#teamUpdateNameModalContainer").modal("hide");
a._loadData();}else{DialogUtils.error("错误","后台异常！");}});},_saveTeamAll:function(a,b,e){var c=this;var d=ctx+"/crm/ou/team/teamPk/saveTeamAll.htm";ButtonUtils.disableBtn("teamSaveBtn");
FormUtils.submit(d,{type:e,teamPkPos:JSON.stringify(a),teamPkEmpPos:JSON.stringify(b)},function(f){ButtonUtils.enableBtn("teamSaveBtn");if(f.success){DialogUtils.success("提示","保存成功");
}else{DialogUtils.error("错误","后台异常，请稍后重试");}},function(){ButtonUtils.enableBtn("teamSaveBtn");DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},_bindEventHander:function(){var a=this;
$(document).on("click","#teamSaveBtn",function(){var e=$(".team-group-li");var b=new Array();var c=new Array();var d="all";if(e.length==1){d="one";}e.each(function(){var g={};
var h=$(this);var f=h.find(".emp");var j=h.find(".teamId").attr("idVal");f.each(function(){var k={};k.teamId=j;k.empId=$(this).attr("idval");c.push(k);
});g.img=h.find(".imgDiv").attr("urlval");g.id=j;g.name=h.find(".teamId").text();g.pkTeamId=h.find(".selectPkTeam").val();g.createTime=h.find(".teamId").attr("createTime");
b.push(g);});a._saveTeamAll(b,c,d);});$(document).on("click",".imgDiv",function(){var b=$(this);var c=b.closest(".team-group-profile").prev();ImageUtils.selectImage(0,function(d){var f=ImageUtils.createImageDivStr(d);
c.empty().append(f);var g=ctx+c.find(".file").attr("urlval");var e=c.find(".file").attr("urlval");b.attr("src",g);b.attr("urlval",e);});});$(document).on("click","#teamUpdateNameBtn",function(){var c=$("#teamUpdateName").find("input[name=id]").val();
var b=$("#teamUpdateName").find("input[name=name]").val();if(!b){DialogUtils.error("提示","名称不能为空！");return false;}a._updateName(c,b);});$("div").bind("contextmenu",function(){return false;
});$(document).on("mousedown",".teamLiOne",function(c){if(3==c.which){var d=$(this).find("input").attr("idVal");var b=$(this).find("input").val();$("#teamDelBtn").attr("idVal",d);
$("#teamEditBtn").attr("idVal",d);$("#teamEditBtn").attr("name",b);c.stopPropagation();a._showRightMenu({x:event.pageX,y:event.pageY});}});$(document).on("mouseleave","#editTeam-menu",function(){$("#editTeam-menu").hide();
});$(document).on("click","#teamEditBtn",function(){var c=$(this).attr("idVal");var b=$(this).attr("name");$("#teamUpdateNameModalContainer").modal("show");
$("#teamUpdateName").find("input[name=name]").val(b);$("#teamUpdateName").find("input[name=id]").val(c);});$(document).on("click","#teamDelBtn",function(){var b=$(this).attr("idVal");
DialogUtils.confirm(function(){FormUtils.del(TeamPk._CONS_.DELETE_URL,b,function(c){if(c.success){DialogUtils.success("成功","操作成功");a._loadData();}else{DialogUtils.success("失败","后台异常，请稍后重试");
}});});});$(document).on("click",".select-employee",function(){var b=$(this).closest(".team-group-li").find(".select-employee-container");var c=$(this).closest(".team-group-li").find("input[name=assignOgn]").val();
var e=$(this).closest(".team-group-li").find("input[name=assignOgn]").attr("keys");var d=$(this).closest(".team-group-li").find(".selected-emp-container").find(".emp");
var f=new Array();if(d){d.each(function(){f.push($(this).attr("idVal"));});}a._createEmployeeTable(c,b,f,e);if(b.is(":visible")){b.stop().slideUp("fast");
}else{$(".select-employee-container").stop().slideUp("fast");b.stop().slideDown("fast");}});$(document).on("click","#addTeamBtn",function(){a._save();});
$(document).on("click",".teamLi",function(){var b=$(this).find("input").attr("idVal");if(b){a._loadTeam(b);}else{a._loadData(b);}});$(document).on("click",".select-by-group",function(){var b=$(this);
var d=b.attr("id");var c={isMultiple:1,selectedGroupId:$("input[name=assignOgn]").val(),container:d,nolimit:true,positionType:"dept_manager",fn:function(e,f){b.parent().find("input[name=assignOgn]").val(e);
b.parent().find("input[name=assignOgn]").attr("keys",f);}};GroupUtils.selectGroupTreeBox(c);$(".select-employee-container:visible").stop().slideUp("fast");
});$(document).off("click",".select-employee-table tr").on("click",".select-employee-table tr",function(k){var h=$(this).closest(".team-group-li");var j=h.find(".selected-emp-count").text();
var n=$(this);if(k.target.tagName=="INPUT"||k.target.tagName=="input"){}else{var p=$(this).find("input[type='checkbox']")[0].checked;$(this).find("input[type='checkbox']").prop("checked",!p);
}var d=$(this).find("input[type='checkbox']");var p=d[0].checked;var c=d.attr("data-id");var b=d.attr("data-name");var f=d.attr("data-aid");var m=d.attr("data-orgName");
var o={id:c,name:b,aid:f,orgName:m};var l=[];l.push(o);if(p){a._addSelectedEmployee(l,h,j);}else{j--;$("#emp-"+c).remove();delete a.selectedEmployeeMap[c];
for(var g=0;g<a.selectedEmployee.length;g++){if(a.selectedEmployee[g].id==c){a.selectedEmployee.splice(g,1);break;}}if(j<=0){h.find(".selected-emp-container").find(".noData").show();
}h.find(".selected-emp-count").empty().text(j);}});$(document).off("click",".deleteEmployeeBtn").on("click",".deleteEmployeeBtn",function(){var c=$(this).closest(".team-group-li");
var d=c.find(".selected-emp-count").text();var e=$(this).parents(".emp").attr("id").replace("emp-","");$(this).parents(".emp").remove();delete a.selectedEmployeeMap[e];
for(var b=0;b<a.selectedEmployee.length;b++){if(a.selectedEmployee[b].id==e){a.selectedEmployee.splice(b,1);break;}}d--;c.find("#employee-table-"+e).find("input[type='checkbox']").prop("checked",false);
c.find(".selected-emp-count").empty().text(d);if(d==0){if(c.find(".noData").length==0){c.find(".selected-emp-container").append("<span class='noData'>该团队内还没有任何成员哦</span>");
}else{c.find(".noData").show();}}});$(document).on("click",".reset-employee-Btn",function(){var b=$(this).closest(".team-group-li");var c=b.find(".selected-emp-container").find(".emp");
c.each(function(){var d=$(this).attr("id").replace("emp-","");delete a.selectedEmployeeMap[d];});b.find(".selected-emp-container").empty().append('<span class="noData">该团队内还没有任何成员哦</span>');
b.find(".selected-emp-count").empty().text(0);b.find(".select-employee-container").find("input[type='checkbox']").prop("checked",false);});$(document).on("click",".team-group-member",function(){if($(this).is(".tg-active")){a.slideTGLayer($(this).closest(".team-group-li"),false);
$(this).removeClass("tg-active");}else{a.slideTGLayer($(this).closest(".team-group-li"),true);$(this).addClass("tg-active");}});$(document).on("click",".add-employee-Btn",function(){var c=$(this).closest(".team-group-li").find(".team-group-target");
var b="10%";if(a.EmpSelect){layer.close(a.EmpSelect);}a.EmpSelect=layer.open({type:1,title:$(this).closest(".team-group-li").find(".team-group-name").children("span").text()+"&emsp;选择员工面板",area:"500px",offset:b,zIndex:99,shadeClose:true,skin:"tg-select-layer",content:$(this).closest(".team-group-li").find(".tg-select"),success:function(d,e){},cancel:function(f,d){var e=$(d).find(".select-employee-container");
if(e.is(":visible")){e.hide();}$(d).find(".select-by-group").val("");$(d).find(".select-by-group").next().val("");$(d).find(".select-employee").val("");
delete a.EmpSelect;}});});},slideTGLayer:function(c,b){var a=this;if(b){$(c).find(".team-group-direct").stop().show();setTimeout(function(){$(c).find(".team-group-list").stop().slideDown("fast");
},125);}else{$(c).find(".team-group-list").stop().slideUp("fast");setTimeout(function(){$(c).find(".team-group-direct").stop().hide();},200);}},_addSelectedEmployee:function(e,a,d){var f=new StringBuffer();
for(var c=0;c<e.length;c++){var b=e[c];f.append('<div class="emp" idVal="'+b.id+'" id="emp-'+b.id+'"').append(">").append('<i class="fa fa-user" aria-hidden="true" style="color: #ed5565;"></i>&nbsp;').append("<span>"+b.aid+":"+b.name+"").append('<span class="blue">|</span>').append('<i class="fa fa-remove deleteEmployeeBtn"></i>').append("</div>");
d++;this.selectedEmployeeMap[b.id]=b.id;$("#employee-table-"+b.id).find("input[type='checkbox']").prop("checked",true);}if(d>0){a.find(".selected-emp-container").find(".noData").hide();
}a.find(".selected-emp-container").append(f.toString());a.find(".selected-emp-count").empty().text(d);},};function tgImgError(a){$(a).attr("src",ctx+"/img/jt/cs/yk.jpg");
}function TeamPkEmp(){this.hadInit=false;this.isEdit=false;this.teamPkEmpRowid=0;}TeamPkEmp._CONS_={GRID:"#teamPkEmpGrid",GRID_ID:"teamPkEmpGrid",PAGER:"#teamPkEmpPager",PAGER_ID:"teamPkEmpPager",JSON_ID:"teamPkEmpJSON",};
TeamPkEmp.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();a._initJqgrid(b);}},_bindEventHander:function(){var a=this;
},_initJqgrid:function(b){var a=this;$.jgrid.defaults.styleUI="Bootstrap";$(TeamPkEmp._CONS_.GRID).jqGrid({datatype:"json",url:ctx+"/ou/team/teamPk/teamPkEmpListData.htm",height:350,autowidth:true,shrinkToFit:true,rowNum:20,mtype:"POST",viewrecords:true,multiselect:true,rowList:[10,20,30],colNames:["团队 ID","员工 ID","创建时间","更新时间","操作"],colModel:[{name:"teamId",editable:true,width:120},{name:"empId",editable:true,width:120},{name:"createTime",editable:true,hidedlg:true,hidden:true,width:120},{name:"updateTime",editable:true,hidedlg:true,hidden:true,width:120},{name:"button",width:120}],pager:TeamPkEmp._CONS_.PAGER,hidegrid:false,gridComplete:function(){JTSubGridUtils.addRowButtons(TeamPkEmp._CONS_.GRID_ID);
}});$(TeamPkEmp._CONS_.GRID).jqGrid("navGrid",TeamPkEmp._CONS_.PAGER,{add:true,addtitle:"添加",addfunc:a.addTeamPkEmpRow,del:true,deltitle:"删除",delfunc:a.delTeamPkEmp,refresh:false,search:false,edit:false});
},addTeamPkEmpRow:function(){var a=new Date().getTime();JTSubGridUtils.addRow(TeamPkEmp._CONS_.GRID_ID,"tmpteamPkEmp"+a);},delTeamPkEmp:function(a){showConfirm(function(){JTSubGridUtils.delRows(TeamPkEmp._CONS_.GRID_ID,a);
});},teamPkEmpGridData2Json:function(){var e=$(TeamPkEmp._CONS_.GRID);var a=new StringBuffer();a.append("[");var c=e.jqGrid("getDataIDs");for(var b=0;b<c.length;
b++){var d=e.jqGrid("getRowData",c[b]);if(d["isGridRowEdit"]=="Y"){alert("有参数尚未保存，请选择保存或者取消变更!");getElementById(c[b]).focus();return false;}a.append("{");
a.append("'teamId':'").append(d["teamId"]).append("',");a.append("'empId':'").append(d["empId"]).append("',");a.append("'createTime':'").append(d["createTime"]).append("',");
a.append("'updateTime':'").append(d["updateTime"]).append("',");if(!c[b].startsWith("tmpteamPkEmp")){a.append("'id':'").append(c[b]).append("'");}a.append("},");
}var f=""+a;if(c.length>0){f=f.substring(0,f.length-1);}f=f+"]";$("#"+TeamPkEmp._CONS_.JSON_ID).val(f);return true;},validateTeamPkEmpGrid:function(b,a){var c=$("#teamPkEmpForm").validate();
return true;},reloadJqgrid:function(b){var a=this;$(TeamPkEmp._CONS_.GRID).jqGrid("setGridParam",{postData:b}).trigger("reloadGrid");},};var glHelpUtil={init:function(a){this._createGlHelpTag();
this._bindEventHandler(a);},_createGlHelpTag:function(){var a=new StringBuffer();a.append("<a style='margin-left:10px' title='帮助'><img src='/t9-ecm/img/jt/help.png'></a>");
$("#glHelpContainer").empty().append(a.toString());},_bindEventHandler:function(a){$(document).on("click","#glHelpContainer",function(){FormUtils.loadData(ctx+"/gl/km/glHelp/findGlHelpData.htm"+"?cateKey="+a,function(b){JTTabUtils.addOrRefreshTab(b.url,"<"+b.name+"> "+"帮助文档");
});});},};