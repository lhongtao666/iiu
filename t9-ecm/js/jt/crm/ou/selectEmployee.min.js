function EmployeeSelectService(){this.orgId=null;this.options=null;}EmployeeSelectService._CONS_={LIST_GROUP_DATA:ctx+"/gl/ou/group/listData4EmployeeSelector.htm",TO_RADAR:ctx+"/gl/ou/employeeInterst/toEmployeeInterstRadar.htm",LIST_EMPLOYEE_DATA:ctx+"/crm/ou/employee/listData.htm?searchRole=no",};
EmployeeSelectService.prototype={init:function(a){this.options=a;this._initOrgTree(a);this._bindEventHanlder();if(!(a.mode==1)){this._initSimpleMode();
}},_initSimpleMode:function(){$(".performanceDiv").hide();$("#positionSelectDiv").removeClass("col-sm-9").removeClass("col-sm-9");$("#positionSelectDiv").addClass("col-sm-6").addClass("col-sm-6");
var a=new StringBuffer();a.append('<div class="col-sm-3 col-xs-3">');a.append('<button type="button" class="jt-btn-search csEntitySearch pull-right" style="padding: 3px 15px;"><i class="fa fa-search"></i>&nbsp;');
a.append("搜索");a.append("</button>");a.append("</div>");$("#positionDiv").append(a.toString());},_initOrgTree:function(c){var a=this;if(!ResUtils.canShow("employee.button.detail")){$(".employeeDetail").hide();
}var e=EmployeeSelectService._CONS_.LIST_GROUP_DATA;var b=e;b=b+"?type="+a.options.type;if(a.options.agentId){b=b+"&agentId="+a.options.agentId;}var d={async:{enable:true,url:b,contentType:"application/json",dataType:"json",type:"get",otherParam:{},autoParam:["id"],dataFilter:function(j,f,k){if(k&&k.length){for(var h=0;
h<k.length;h++){var g=k[h];if(g.isSale=="y"){g.name=g.name+"【销】";g.font={"color":"red"};}}}return k;},},data:{simpleData:{enable:true,idKey:"id",pIdKey:"parentId"}},callback:{onClick:function(f,h,g){var i={treeNodeId:g.id,treeNodeType:"group"};
a.orgId=g.id;a._reloadJqgrid(i);},onAsyncSuccess:function(g,n,p,h){var j=$.fn.zTree.getZTreeObj("organizationTree");if(p){var q=p.children;for(var m=0;
m<q.length;m++){if(q[m].isParent==true){q[m].icon=ctx+"/js/zTree_v3/css/zTreeStyle/img/jt-diy/jt-16.png";}else{q[m].icon=ctx+"/js/zTree_v3/css/zTreeStyle/img/jt-diy/jt-30.png";
}j.updateNode(q[m]);}}else{var f=j.getNodes();for(var m=0;m<f.length;m++){f[m].icon=ctx+"/js/plugins/zTree_v3/css/zTreeStyle/img/jt-diy/jt-orgRoot.png";
j.updateNode(f[m]);}}if(p==null){var j=$.fn.zTree.getZTreeObj("organizationTree");var k=null;var p=j.getNodeByParam("id",a.options.defGroupId);if(p){k=p;
}else{var o=j.getNodes();k=o[0];}j.expandNode(k,true,false,true);j.selectNode(k);a.currentClickTreeNode=k;a.orgId=k.id;var l={treeNodeId:k.id,treeNodeType:"group"};
a._initJqgrid(l);}}},view:{selectedMulti:false}};$.fn.zTree.init($("#organizationTree"),d);},_bindEventHanlder:function(){var a=this;$("body").on("click",".interstCompare",function(f){f.stopPropagation();
var b=$("#employeeGrid").jqGrid("getGridParam","multiselect");var d=null;if(b){var c=$("#employeeGrid").jqGrid("getGridParam","selarrrow");if(c==null||c.length==0){DialogUtils.error("错误","请选择要查看的员工");
return false;}d=c.join(",");}else{var c=$("#employeeGrid").jqGrid("getGridParam","selrow");d=c;if(!c){DialogUtils.error("错误","请选择要查看的员工");return false;
}}JTTabUtils.addOrRefreshTab(EmployeeSelectService._CONS_.TO_RADAR+"?isHidePanelTitle=true&radarType=personal_type&employeeIds="+d,"员工能力对比");});$("body").on("click",".csEntitySearch",function(){var b=$(this).closest("form").serialize();
b=b+"&treeNodeId="+a.orgId;a._reloadJqgrid(b);});$("#searchEmployeeForm").on("keypress",function(b){if(b.keyCode=="13"){$(".csEntitySearch").eq(0).trigger("click");
}});$("#positionSelect").on("click",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$('input[name="Q__S__LK__employee.position_"]').val(),container:"positionSelect",isMultiple:0,hideSale:true,positionType:"all",fn:function(b){$('input[name="Q__S__LK__employee.position_"]').val(b);
}});});},_initJqgrid:function(d){var a=this;if(!d){d="";}$.jgrid.defaults.styleUI="Bootstrap";$.jgrid.styleUI.Bootstrap.base.rowTable="table table-bordered table-striped";
var c=$("#searchEmployeeForm").width()-10;var b=EmployeeSelectService._CONS_.LIST_EMPLOYEE_DATA+"&Q__S__EQ__employee.status_=actived";if(a.options.sys){b=b+"&Q__S__EQ__employee.sys_="+a.options.sys;
}if(a.options&&1==a.options.isSale){var b=b+"&Q__S__EQ__group_.is_sale_=y";}$("#employeeGrid").jqGrid({url:b,pager:"#employeePager",datatype:"json",mtype:"post",shrinkToFix:true,multiselect:true,width:c,rowNum:100,pagerpos:"center",viewrecords:true,postData:d,colNames:["姓名","工号","员工","岗位","部门","意向","年度业绩","已有客户","新进客户","在线"],colModel:[{name:"name",width:100,index:"employee.name_",hidden:true,},{name:"aid",width:100,index:"employee.aid_",hidden:true},{name:"aidShow",width:100,index:"employee.aid_",sortable:true,formatter:function(e,f,g){return g.aid+"："+g.name;
}},{name:"positionNames",width:140,sortable:false,formatter:function(j,f,h){var e="";if(j){j=j.split(",");if(j.length){for(var g=0;g<j.length;g++){e+=j[g];
if(g<j.length-1){e+="<br>";}}}}return e;}},{name:"orgName",width:100,sortable:false},{name:"interestes",width:100,index:"interst.interest_",sortable:false,hidden:(a.options.mode==1)?false:true},{name:"performance",index:"interst.performance_",hidden:(a.options.mode==1)?false:true,sortable:false,width:100,},{name:"csCount",hidden:(a.options.mode==1)?false:true,width:120,index:"employee.cs_count_",},{name:"newCs",hidden:(a.options.mode==1)?false:true,width:120,index:"employee.cs_count_",},{name:"online",width:36,sortable:false,formatter:function(e,f,g){if(g.isOnline=="y"){return"<font style='color:red'>在线 </font>";
}else{return"离线";}}}],loadBeforeSend:function(){a.loading=layer.load();},loadError:function(){layer.close(a.loading);},gridComplete:function(){layer.close(a.loading);
var f=$("#employeeGrid").jqGrid("getGridParam","records");if(f<=0){if($(".norecords").html()==null){$("#employeeGrid").parent().append('<div class="norecords">没有符合数据！</div>');
$(".norecords").show();}else{$(".norecords").show();}}else{$(".norecords").hide();}if(!a._hadSetHeight){a._hadSetHeight=true;var e=$(window).height()-$(".panel-heading").outerHeight()-$("#employeePager").outerHeight()-$(".ui-jqgrid-hdiv").outerHeight()-25;
$("#employeeGrid").jqGrid("setGridHeight",e);}},beforeSelectRow:function(e){if(a.options.isMultiple!=1){$("#employeeGrid").jqGrid("resetSelection");a._lastRowId=e;
}return true;},onSelectAll:function(f,e){if(a.options.isMultiple!=1){$("#employeeGrid").jqGrid("resetSelection");$("#employeeGrid").jqGrid("setSelection",a._lastRowId,true);
}else{}},ondblClickRow:function(k){var g=a.options;var j=[];if(g&&g.isMultiple==1){var j=$("#employeeGrid").jqGrid("getGridParam","selarrrow");}else{var m=k;
if(m){j.push(m);}}var l=[];if(j&&j.length){for(var h=0;h<j.length;h++){var f=$("#employeeGrid").jqGrid("getRowData",j[h]);f.id=j[h];l.push(f);}window.parent.myCallBack(l);
var e=window.parent.layer.getFrameIndex(window.name);window.parent.layer.close(e);}}});},_reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid("#employeeGrid",a);
}};