function EmployeeProfitPk(){this.hadInit=false;this.options={callBack:null,};this.selectedEmployee=[];this.selectedEmployeeId=[];this.selectedEmployeeMap={};
}EmployeeProfitPk._CONS_={FIND_PROFIT_PK_URL:ctx+"/crm/ou/employee/findProfitPk.htm",EXPORT_PROFIT_PK_URL:ctx+"/crm/ou/employee/exportProfitPk.htm",};EmployeeProfitPk.prototype={init:function(a){this.selectedEmployee=[];
this.selectedEmployeeId=[];this.selectedEmployeeMap={};this._openDialog(a);this._bindEventHander();this._initEmployee();this._addSelectedEmployee(a);},_openDialog:function(a){$("#profitPkContainer").modal("show");
FormUtils.clear("employeeProfitPkForm");$("#timeTypeSearch").change();},_bindEventHander:function(){var a=this;$("body").off("click","#selectEmployeeBtn").on("click","#selectEmployeeBtn",function(){var b=new EmployeesSelect();
var c=0;b.init({isShowAllGroup:c,grantType:"/cs/",isOnlySelfGroup:1,isMultiple:1,mode:1,type:"positionContext",callBack:function(d){a._addSelectedEmployee(d);
}});});$("#selected-emp-container").off("click",".deleteEmployeeBtn").on("click",".deleteEmployeeBtn",function(){var c=$(this).parents(".emp").attr("id").replace("emp-","");
$(this).parents(".emp").remove();delete a.selectedEmployeeMap[c];for(var b=0;b<a.selectedEmployee.length;b++){if(a.selectedEmployee[b].id==c){$("#select-employee").trigger("keyup");
a.selectedEmployee.splice(b,1);break;}}for(var b=0;b<a.selectedEmployeeId.length;b++){if(a.selectedEmployeeId[b]==c){a.selectedEmployeeId.splice(b,1);break;
}}$("#employee-table-"+c).find("input[type='checkbox']").prop("checked",false);});$("body").on("click",function(b){if($(b.target).attr("id")=="select-employee"){return;
}if($(b.target).parents("#select-employee-container").length<=0){$("#select-employee-container").hide();}});$("#select-employee").off("keyup").on("keyup",function(){var b=$(this).val();
a._fiterEmployee(b);});$("#select-employee").off("focus").on("focus",function(){$("#select-employee-container").show();});$(".employProfitPkClose").off("focus").on("focus",function(){$("#profitPkContainer").modal("hide");
$("#reset-emp-Btn").trigger("click");});$("#reset-emp-Btn").off("click").on("click",function(){$("#selected-emp-container").empty();a.selectedEmployee=[];
a.selectedEmployeeId=[];a.selectedEmployeeMap={};$("#select-employee").trigger("keyup");$("#select-employee-container").find("input[type='checkbox']").prop("checked",false);
});$(".profitPKSearch").off("click").on("click",function(){var e=a.selectedEmployee;var c=$("#employeeProfitPkForm").find("input[name=Q__S__EQ__type_]:checked").val();
if(e==null){DialogUtils.success(msgCode.ERROR,"请选择员工");return;}if($("#beginDate").val()==null||$("#endDate").val()==null){DialogUtils.error(msgCode.ERROR,"请选择时间");
return;}if(c==null){DialogUtils.error(msgCode.ERROR,"请选择PK类型");return;}var b=JSON.stringify(a.selectedEmployeeId);var d=$("#employeeProfitPkForm").serialize()+"&Q__D__BW__place_time_="+ReportDateUtil.getDateTimeRangeStr()+"&employeeIds="+b.substr(1,b.length-2).replaceAll('"',"");
FormUtils.loadData(EmployeeProfitPk._CONS_.FIND_PROFIT_PK_URL+"?"+d,function(g){var h=new StringBuffer();for(var f=0;f<g.length;f++){h.append("<tr>");h.append('<td style="width: 20%">');
h.append(f+1);h.append("</td>");h.append('<td style="width: 25%">');h.append(g[f].aid);h.append("</td>");h.append('<td style="width: 25%">');h.append(g[f].name);
h.append("</td>");h.append('<td style="width: 30%">');if("ship"==c){h.append(g[f].shipAmount);}else{h.append(g[f].auditAmount);}h.append("</td>");h.append("</tr>");
}$("#profitPKTableContainer").empty().append(h.toString());});});$(".profitPKExportExcel").off("click").on("click",function(){var b=JSON.stringify(a.selectedEmployeeId);
var c=$("#employeeProfitPkForm").serialize()+"&Q__D__BW__place_time_="+ReportDateUtil.getDateTimeRangeStr()+"&employeeIds="+b.substr(1,b.length-2).replaceAll('"',"");
window.location.href=EmployeeProfitPk._CONS_.EXPORT_PROFIT_PK_URL+"?"+c;});$("body").off("click","#select-employee-table tr").on("click","#select-employee-table tr",function(h){if(h.target.tagName=="INPUT"||h.target.tagName=="input"){}else{var m=$(this).find("input[type='checkbox']")[0].checked;
$(this).find("input[type='checkbox']").prop("checked",!m);}var d=$(this).find("input[type='checkbox']");var m=d[0].checked;var c=d.attr("data-id");var b=d.attr("data-name");
var f=d.attr("data-aid");var k=d.attr("data-orgName");var l={id:c,name:b,aid:f,orgName:k};var j=[];j.push(l);if(m){a._addSelectedEmployee(j);}else{$("#emp-"+c).remove();
delete a.selectedEmployeeMap[c];for(var g=0;g<a.selectedEmployee.length;g++){if(a.selectedEmployee[g].id==c){a.selectedEmployee.splice(g,1);break;}}for(var g=0;
g<a.selectedEmployeeId.length;g++){if(a.selectedEmployeeId[g]==c){a.selectedEmployeeId.splice(g,1);break;}}}});},_fiterEmployee:function(c){for(var b=0;
b<this.employeeList.length;b++){var a=this.employeeList[b];if(!this.selectedEmployeeMap.hasOwnProperty(a.id)){if((a.name.indexOf(c)!=-1||a.aid.indexOf(c)!=-1)){$("#employee-table-"+a.id).show();
}else{$("#employee-table-"+a.id).hide();}}}},_addSelectedEmployee:function(d){var a=this;var e=new StringBuffer();for(var c=0;c<d.length;c++){var b=d[c];
if(!a.selectedEmployeeMap.hasOwnProperty(b.id)){e.append('<div class="emp" id="emp-'+b.id+'"').append(">").append("<span>"+b.aid+":"+b.name+"</span>").append('<span class="blue">|</span>').append('<i class="fa fa-remove deleteEmployeeBtn"></i>').append("</div>");
a.selectedEmployee.push(b);a.selectedEmployeeId.push(b.id);a.selectedEmployeeMap[b.id]=b.id;$("#employee-table-"+b.id).find("input[type='checkbox']").prop("checked",true);
}}$("#selected-emp-container").append(e.toString());},_initEmployee:function(){var a=this;var b=ctx+"/crm/ou/employee/search.htm?keyword=";FormUtils.loadData(b,function(c){a.employeeList=c.value;
a._createEmployeeTable();});},_createEmployeeTable:function(){var b=this.employeeList;var c=new StringBuffer();for(var a=0;a<b.length;a++){c.append('<tr id="employee-table-'+b[a].id+'">').append('<td width="10%"><input type="checkbox"').append(' data-id="'+b[a].id+'"').append(' data-groupId="'+b[a].groupId+'"').append(' data-name="'+b[a].name+'"').append(' data-aid="'+b[a].aid+'"').append(' data-orgName="'+b[a].orgName+'"').append('<td width="45%">'+b[a].name+":"+b[a].aid+"</td>").append('<td width="45%">'+b[a].orgName+"</td>").append("</tr>");
}$("#select-employee-table").empty().append(c.toString());},};