function CreateForSub(){}CreateForSub.prototype={init:function(a){$("#selected-emp-container").empty();this._bindEventHanlder();this._initEmployee();this.options=a;
$("#createForSubContainer").modal("show");},_createSubCsEntity:function(c){var b=null;var a=this.options;if(a.csIds){b=ctx+"/crm/cs/csEntity/batchCreateForSub.htm";
}else{if(a.csId){b=ctx+"/crm/cs/csEntity/saveAddCsSub.htm";}else{throw new Error("必须选择客户才能创建");}}FormUtils.submit(b,{csId:a.csId,csIds:a.csIds,employeeId:c},function(e){if(a.callbackFn){a.callbackFn(e);
if(e.success){$("#createForSubContainer").modal("hide");}}else{if(e.success){if(a.csIds){$("#createForSubContainer").modal("hide");DialogUtils.success("成功","操作成功");
return;}else{if(a.csId){$("#createForSubContainer").modal("hide");var g=$.parseJSON(e.msg);var f=g.name;var d=g.id;JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/toEdit.htm?csId="+d+"&type="+type,f);
DialogUtils.success("成功","操作成功");return;}}}else{DialogUtils.error("错误",e.msg);return;}}});},_bindEventHanlder:function(){CreateForSub;var a=this;$("#saveCreateForSub").off("click").on("click",function(){var c=$("#createForSub-selected-emp-container .emp").size();
var b=$("#createForSubContainer");if(!c){DialogUtils.error(msgCode.ERROR,"请选择员工",b);return;}var d=$("#createForSub-selected-emp-container .emp").attr("employeeId");
DialogUtils.confirmWithOptions({title:"确定创建从客户？",text:"",confirmButtonText:"确定",yesFunc:function(){a._createSubCsEntity(d);}});});$("#createForSubContainer").off("shown.bs.modal").on("shown.bs.modal",function(){a._dealSyle();
});$("#createForSubContainer input[name='employee-online']").off("change").on("change",function(){$("#createForSub-select-employee").trigger("keyup");});
$("body").on("click",function(b){if($(b.target).attr("id")=="createForSub-select-employee"){return;}if($(b.target).parents("#createForSub-select-employee-container").length<=0){$("#createForSub-select-employee-container").hide();
}});$("#createForSub-select-employee").off("keyup").on("keyup",function(){var b=$(this).val();a._fiterEmployee(b);});$("#createForSub-select-employee").off("focus").on("focus",function(){$("#createForSub-select-employee-container").show();
});$("body").on("click","#createForSub-select-employee-table tr input[type='checkbox']",function(b){b.stopPropagation();$(this).parents("tr").trigger("click");
});$("body").off("click","#createForSub-select-employee-table tr").on("click","#createForSub-select-employee-table tr",function(f){if(f.target.tagName=="INPUT"||f.target.tagName=="input"){return;
}f.stopPropagation();f.preventDefault();var c=$(this).find("input[type='checkbox']")[0].checked;var d=$(this).find("input[type='checkbox']")[0];var b=$(d);
$(this).find("input[type='checkbox']").prop("checked",true);$(this).parents("#createForSub-select-employee-table").find(".createForSub-employee-tr input[type='checkbox']").not(b).prop("checked",false);
$("#createForSub-select-employee-container").hide();var g=[];$.each(b,function(){var n=$(this).attr("data-id");var i=$(this).attr("data-name");var k=$(this).attr("data-aid");
var l=$(this).attr("data-newCs");var h=$(this).attr("data-csCount");var m=$(this).attr("data-isOnline");var j=$(this).attr("data-orgName");var e={id:n,name:i,aid:k,newCs:l,csCount:h,isOnline:m,orgName:j};
g.push(e);});a._addSelectedEmployee(g);});$("#createForSub-employee-select-submit").off("click").on("click",function(){var b=$("#createForSub-select-employee-table").find("tr:visible").find("input[type='checkbox']:checked");
var c=[];$.each(b,function(){var k=$(this).attr("data-id");var f=$(this).attr("data-name");var h=$(this).attr("data-aid");var i=$(this).attr("data-newCs");
var e=$(this).attr("data-csCount");var j=$(this).attr("data-isOnline");var g=$(this).attr("data-orgName");var d={id:k,name:f,aid:h,newCs:i,csCount:e,isOnline:j,orgName:g};
c.push(d);});$("#createForSub-select-employee-table").find("input[type='checkbox']").prop("checked",false);$("#createForSub-select-employee-container").hide();
a._addSelectedEmployee(c);});$("body").off("click","#createForSubSelectEmployeeBtn").on("click","#createForSubSelectEmployeeBtn",function(){var b=new EmployeesSelect();
var c=0;if(ResUtils.canShow("employeeSelector.button.cs")){c:1;}b.init({isShowAllGroup:c,grantType:"/cs/",isOnlySelfGroup:1,isMultiple:0,mode:1,type:"positionContext",callBack:function(d){$("#createForSub-select-employee-table").find(".createForSub-employee-tr input[type='checkbox']").prop("checked",false);
$("#createForSub-employee-table-"+d[0].id).find("input[type='checkbox']").prop("checked",true);a._addSelectedEmployee(d);}});});$("#createForSub-selected-emp-container").off("click",".deleteEmployeeBtn").on("click",".deleteEmployeeBtn",function(){var c=$(this).parents(".emp").attr("id").replace("emp-","");
$(this).parents(".emp").remove();delete a.selectedEmployeeMap[c];for(var b=0;b<a.selectedEmployee.length;b++){if(a.selectedEmployee[b].id==c){$("#select-employee").trigger("keyup");
a.selectedEmployee.splice(b,1);break;}}a._dealSyle();});},_fiterEmployee:function(d){var c=$("#createForSubContainer input[name='employee-online']")[0].checked;
for(var b=0;b<this.employeeList.length;b++){var a=this.employeeList[b];if(a.name.indexOf(d)!=-1||a.aid.indexOf(d)!=-1){if(c&&a.isOnline!="y"){$("#createForSub-employee-table-"+a.id).hide();
}else{$("#createForSub-employee-table-"+a.id).show();}}else{$("#createForSub-employee-table-"+a.id).hide();}}},_addSelectedEmployee:function(b){var c=new StringBuffer();
var a=b[0];c.append('<div class="emp" employeeId="'+a.id+'" id="emp-'+a.id+'"').append(">").append("<span>"+a.aid+":"+a.name+'（新进<span class="blue">'+a.newCs+"</span>）</span>").append('<span class="blue">|</span>').append('<i class="fa fa-remove deleteEmployeeBtn"></i>').append("</div>");
$("#createForSub-selected-emp-container").empty().append(c.toString());this._dealSyle();},_dealSyle:function(){var a=$("#createForSubContainer").find(".modal-body").height()-$("#createForSubPartyContainer").outerHeight()-$("#createForSubEmployeeContainer").outerHeight()-28-34-31-20;
},_initEmployee:function(){var a=this;var b=ctx+"/crm/ou/employee/search.htm?keyword=";FormUtils.loadData(b,function(c){a.employeeList=c.value;a._createEmployeeTable();
});},_createEmployeeTable:function(){var b=this.employeeList;var c=new StringBuffer();for(var a=0;a<b.length;a++){c.append('<tr class="createForSub-employee-tr" id="createForSub-employee-table-'+b[a].id+'" >').append('<td width="10%"><input type="checkbox"').append(' data-id="'+b[a].id+'"').append(' data-name="'+b[a].name+'"').append(' data-aid="'+b[a].aid+'"').append(' data-orgName="'+b[a].orgName+'"').append(' data-isOnline="'+(b[a].isOnline?b[a].isOnline:"n")+'"').append(' data-newCs="'+b[a].newCs+'"></input></td>').append('<td width="25%">'+b[a].orgName+"</td>").append('<td width="25%">'+b[a].name+":"+b[a].aid+"</td>").append('<td width="20%" class="blue">'+b[a].newCs+"</td>").append('<td width="20%">'+(b[a].isOnline&&b[a].isOnline=="y"?'<span class="red">在线</span>':"离线")+"</td>").append("</tr>");
}$("#createForSub-select-employee-table").empty().append(c.toString());},};