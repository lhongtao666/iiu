function Employee(){this.hadInit=false;this.isEdit=false;this.isAdd=false;this.isFormDataChange=false;this._hadInitJqgrid=false;this.userPw=new UserPw();
this.addrService=null;this.addressService=new AddressService("addrContainer");this.commonEav=null;this.employeeGroup=new EmployeeGroup(this);this.employeeEditBatch=new EmployeeEditBatch(this);
this.employeeRate=new EmployeeRate(this);this.employeePercent=new EmployeePercent(this);this.isBatchCreateSwitchery=null;this.seniorSearch=new SeniorSearch();
if(type.length==0){this.teamPk=new TeamPk();}else{$(".teamManage").hide();}}Employee._CONS_={PAGER:"#employeePager",LIST_DATA_URL:ctx+"/crm/ou/employee/listData.htm?searchInterest=no&searchPerformance=no",SAVE_ADD_URL:ctx+"/crm/ou/employee/saveAdd.htm",SAVE_EDIT_URL:ctx+"/crm/ou/employee/saveEdit.htm",DELETE_URL:ctx+"/crm/ou/employee/delete.htm",CANCEL_URL:ctx+"/crm/ou/employee/cancel.htm",FORCE_LOGOUT_URL:ctx+"/crm/ou/employee/forceLogout.htm",REFRESHCREDIT_URL:ctx+"/crm/ou/employee/refreshCredit.htm",ACTIVE_URL:ctx+"/crm/ou/employee/active.htm",EXPORT_URL:ctx+"/crm/ou/employee/export.htm",SHOW_RES_TREE_URL:ctx+"/crm/ou/user/showUserResTree.htm",DE_IMG:'<img style=\'width:100px; height:100px;\' alt="默认图片"  src="'+ctx+'/img/jt/nophoto.png" />',LIST_ROLE_DATA_URL:ctx+"/crm/ou/role/listRoleByAgent.htm",RESET_PASS_URL:ctx+"/crm/ou/user/resetPass.htm",ADD_EMP_URL:ctx+"/crm/ou/employee/addEmployee.htm",GRID:"#employeeGrid",PARTY_FORM_ID:"#partyForm",DETAIL_FOMR_ID:"#detailForm",COMMON_EAV_PARAM:{eavSetKey:"employee",containerId:"eavCommonContainer"},EMP_EDIT_URL:ctx+"/crm/ou/employee/editEmp.htm",EDIT_URL:ctx+"/crm/ou/employee/edit.htm",DETAIL_URL:ctx+"/crm/ou/employee/detail.htm",PERSON_DEATAIL_URL:ctx+"/crm/ou/employee/personDetail.htm",LIST_ID_DATA:ctx+"/crm/ou/employee/listIdData.htm",IMPORT_EXCEL_URL:ctx+"/crm/ou/employee/importExcel.htm",EMP_PK_URL:ctx+"/crm/ou/employee/findEmpPk.htm",CLEAR_PK_URL:ctx+"/gl/ou/employeePk/deleteByEmpId.htm",GROUPNAMES:""};
Employee.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._isGroupMgr();a.userPw.init();a.employeeGroup.init(a.seniorSearch);a.employeeRate.init();
a.employeePercent.init();a.addressService.init({rowFit:"y",isNotRequired:true});a.employeeEditBatch.init();a._hideNotGrantBtn();a._bindFormValidation();
a._bindEventHander();a.seniorSearch.init();a.commonEav=new Eav(Employee._CONS_.COMMON_EAV_PARAM);a._resetRoleChosen();a._initCustomerGroup();$(".i-checks").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green",});
RoleUtils.loadEcmRoleOpt({fn:function(e){if(e){var d=new StringBuffer();d.append('<option value="">请选择</option>');for(var c=0;c<e.length;c++){d.append("<option value='"+e[c].id+"'>"+e[c].name+"</option>");
}$("#roleSearchSelect").empty().append(d.toString()).select2();}}});ReportDateUtil.initDate(".report-content");a._loadUserLoginState();this._locateToGlHelp();
}},_initCustomerGroup:function(){var a=this;var b=ctx+"/gl/ou/customerGroup/findAll.htm";FormUtils.loadData(b,function(c){if(c.length>0){var e=new StringBuffer();
for(var d=0;d<c.length;d++){e.append("<option value='"+c[d].id+"'>"+c[d].name+"</option>");}$("#customerGroupSelect").empty().append(e.toString());$("#customerGroupSelect").chosen("destroy");
$("#customerGroupSelect").chosen();}});},_isGroupMgr:function(){if("myGroup"==type){$(".myGroup").show();$(".employeeBtnGroup").hide();FormUtils.loadData(ctx+"/crm/ou/employee/isGroupMgr.htm",function(a){if(a.success==false){$("#cancelEmp").hide();
$("#addEmp").hide();$("#editEmp").hide();}else{$("#cancelEmp").show();$("#editEmp").show();Employee._CONS_.GROUPNAMES=a.msg;}});}},_locateToGlHelp:function(){if(type=="myGroup"){var a="glHelp.group_employee.myGroup";
}else{var a="glHelp.group_employee.employee";}glHelpUtil.init(a);},_loadUserLoginState:function(){var a=this;FormUtils.loadData(ctx+"/crm/ou/user/userOnlineState.htm",function(b){if(b){$("#userState").show();
if("myGroup"==type){$("#userState").empty();}else{$("#userState").empty().append(a._createUserStateStr(b,deploySys));}}});},_createUserStateStr:function(b,a){var c=new StringBuffer();
c.append('<span style="font-weight:bold;">授权在线(<span style="font-size:'+this._getSize(b.activedUserCount,b.maxActiveUserCount)+";color:"+this._getColor(b.loginUserCount,b.maxLoginUserCount)+'">'+b.loginUserCount+"/"+b.maxLoginUserCount+"</span>)</span>");
if(b.loginUserCount>b.maxLoginUserCount*0.9){c.append('<span><i title="授权将达上限，请联系购买" class="fa fa-exclamation-triangle"></i></span>');}c.append('<span style="font-weight:bold;">激活(<span style="font-size:'+this._getSize(b.activedUserCount,b.maxActiveUserCount)+";color:"+this._getColor(b.activedUserCount,b.maxActiveUserCount)+'">'+b.activedUserCount+"/"+b.maxActiveUserCount+")</span></span>");
if(a&&a.indexOf("scm")>-1){c.append("|").append('<span style="font-weight:bold;">SCM授权在线(<span style="font-size:'+this._getSize(b.scmloginUserCount,b.scmmaxLoginUserCountt)+";color:"+this._getColor(b.scmloginUserCount,b.scmmaxLoginUserCount)+'">'+b.scmloginUserCount+"/"+b.scmmaxLoginUserCount+"</span>)</span>").append('<span style="font-weight:bold;">激活(<span style="font-size:'+this._getSize(b.scmloginUserCount,b.scmmaxLoginUserCount)+";color:"+this._getColor(b.scmactivedUserCount,b.scmmaxActiveUserCount)+'">'+b.scmactivedUserCount+"/"+b.scmmaxActiveUserCount+"</span>)</span>");
}return c.toString();},_getSize:function(a,c){var b=a/c;if(b>=0.95){return"18px";}},_getColor:function(a,c){var b=a/c;if(b>=0.95){return"red";}else{if(b>=0.8){return"#ea7f09";
}else{return"green";}}},_clear:function(c){var a=this;function b(){$(Employee._CONS_.PARTY_FORM_ID).validate().resetForm();a._resetTab();$(".deletedHide").show();
$(".addPhoneRow").show();$(".operateCol").show();$(".list_wrapper").show();$(".form_wrapper").stop().animate({"left":$(".form_wrapper").outerWidth()+15+"px"},"fast");
$("#custRelTabLi").show();$("#resTip").text("").hide();$(".saveBtn").show();$("#eavCommonContainer").empty();FormUtils.clear("partyForm");$("input[name=aid]").removeAttr("readonly");
$("#partyForm [name=status]").val(["actived"]).trigger("change");$("[name=name]").attr("required","true");$(".addGroup").hide();$("#batch-create-info").hide();
$(".not-batch-create").show();$("#batch-create-label").empty().hide();$(".dataGroup").show();$("#partyForm").find("input[name=title]").val(["男士"]);$("[name=createTime]").text("");
$("[name=updateTime]").text("");$("[name='lastLoginSys']").text("");$("[name='lastLoginCti']").text("");$("[name=adn]").text("");$("#csCount").text("").attr("disabled",true);
$("#selectOrganization").attr("disabled",false);$("#selectDefaultImageBtn").attr("disabled",false);$("#imageConatiner").empty();$(".addPhonePanel tbody").empty();
$(".addPhonePanel tbody").find("input").attr("disabled",false);$(".deleteRow").show();$(".showWhenNoPhone").hide();if(a.isAdd){$(".employeeAdd").trigger("click");
return false;}a.isEdit=false;a.isFormDataChange=false;if(c){$(".employeeSearch").trigger("click");}}if(a.isFormDataChange){DialogUtils.warning(function(){b();
});}else{b();}},_getParams:function(){var h=this;var c=($("[name=roleIds]").val()&&$("[name=roleIds]").val().length>0)?$("[name=roleIds]").val().join(","):"";
var b="&"+$(Employee._CONS_.PARTY_FORM_ID).serialize();var f=($("#imageConatiner").find("div.file").length)?("&profile="+$("#imageConatiner").find("div.file").attr("urlVal")):"";
if(f.indexOf("?")>-1){f=f.split("?")[0];}var a="&"+$(Employee._CONS_.DETAIL_FOMR_ID).serialize()+f;var g="&"+this.commonEav.getEavParams();var e=h._getAddrsJson();
var i="&userPo.id="+$("[name=id]").val()+"&userPo.account="+$("[name=aid]").val()+"&userPo.roleIds="+c;var d=b+"&"+e+"&"+i+"&"+g+"&"+a;return d;},_commitUpdateFunc:function(b,a){var c=this;
var d=c._getParams();FormUtils.submit(b,d,function(e){$(".saveBtn").attr("disabled",false);if(e.success){DialogUtils.success("提示",e.msg);c.isFormDataChange=false;
c.isEdit=false;if(a){a();}else{c._clear(true);}}else{DialogUtils.error("失败",e.msg);}},function(){$(".saveBtn").attr("disabled",false);DialogUtils.error("错误","后台异常，请稍后重试");
});},_batchCreate:function(){var b=this;var d=$(Employee._CONS_.PARTY_FORM_ID).valid()&&this.commonEav.isValid()&&$(Employee._CONS_.PARTY_FORM_ID).valid();
if(d){}else{return false;}var c=b._getParams();var a=ctx+"/crm/ou/employee/batchCreate.htm";FormUtils.submit(a,c,function(e){$(".saveBtn").attr("disabled",false);
if(e.success){DialogUtils.success(msgCode.SUCCESS,e.msg);b.isFormDataChange=false;b.isEdit=false;b._clear(true);}else{DialogUtils.error("失败",e.msg);}},function(){$(".saveBtn").attr("disabled",false);
DialogUtils.error("错误","后台异常，请稍后重试");});},_saveEmployee:function(a){var b=this;var c=$(Employee._CONS_.PARTY_FORM_ID).valid()&&this.commonEav.isValid()&&$(Employee._CONS_.PARTY_FORM_ID).valid();
if(c){}else{return false;}$(".saveBtn").attr("disabled",true);b._commitUpdateFunc(a);},_add:function(d){var a=this;$("#saveAddBtn").show();$("[name=sys]").val(d);
$("input[name='groupId']").val(a.employeeGroup.currentClickTreeNode.id);$("#groupName").val(a.employeeGroup.currentClickTreeNode.name);$("#saveEmpTip").show();
$(".dataGroup").hide();$(".addGroup").show();$(".outSideDiv").hide();$(".is-batch-create-status").empty().append('<input type="checkbox" value="y" name="isBatchCreate" class="js-switch" />');
a.isBatchCreateSwitchery=new Switchery(document.querySelector(".is-batch-create-status .js-switch"),{size:"small"});a.isBatchCreateSwitchery.handleOnchange=function(g){if(g){$("#batch-create-info").show();
$(".not-batch-create").hide();var h=new StringBuffer();h.append('<div class="col-sm-6 batch-create" style="float:left;">');h.append('<div class="input-group">');
h.append('<input required="true" digits="true" min="1" max="1000" name="batchCreateCount" placeholder="" validatetype="default" type="text" class="form-control">');
h.append('<span class="input-group-addon">个</span>');h.append("</div>");h.append("</div>");$("#batch-create-info").empty().append(h.toString());var f=new StringBuffer();
f.append('<div class="control-label batch-create" style="text-align:left;">');f.append("<strong>(工号顺序递增)</strong>");f.append("</div>");$("#batch-create-label").empty().show().append(f.toString());
}else{$("#batch-create-info").empty();$(".not-batch-create").show();$("#batch-create-info").hide();$("#batch-create-label").empty().hide();}};$(".list_wrapper").hide();
$(".form_wrapper").stop().animate({"left":"15px"},"fast");$("#roleSelect").empty();$("#partyForm [name=status]").val(["actived"]);$("#partyForm [name=title]").val(["男士"]);
var c="/img/jt/defaulTouXiang.png";var e=[{url:c,name:"",id:""}];var b=ImageUtils.createImageDivStr(e);$("#imageConatiner").empty().append(b);$(".deleteImage ").hide();
this._loadRoleData("roleSelect",null,d);this.commonEav.renderEavForm();},_addEmp:function(b){var a=this;$.ajax({url:Employee._CONS_.ADD_EMP_URL,type:"POST",dataType:"JSON",success:function(e){$(".dataGroup").hide();
$(".addGroup").show();$(".is-batch-create-status").empty().append('<input type="checkbox" value="y" name="isBatchCreate" class="js-switch" />');a.isBatchCreateSwitchery=new Switchery(document.querySelector(".is-batch-create-status .js-switch"),{size:"small"});
a.isBatchCreateSwitchery.handleOnchange=function(h){if(h){$("#batch-create-info").show();$(".not-batch-create").hide();var i=new StringBuffer();i.append('<div class="col-sm-6 batch-create" style="float:left;">');
i.append('<div class="input-group">');i.append('<input required="true" digits="true" min="1" max="1000" name="batchCreateCount" placeholder="" validatetype="default" type="text" class="form-control">');
i.append('<span class="input-group-addon">个</span>');i.append("</div>");i.append("</div>");$("#batch-create-info").empty().append(i.toString());var g=new StringBuffer();
g.append('<div class="control-label batch-create" style="text-align:left;">');g.append("<strong>(工号顺序递增)</strong>");g.append("</div>");$("#batch-create-label").empty().show().append(g.toString());
}else{$("#batch-create-info").empty();$(".not-batch-create").show();$("#batch-create-info").hide();$("#batch-create-label").empty().hide();}};$(".list_wrapper").hide();
$(".form_wrapper").stop().animate({"left":"15px"},"fast");$("#roleSelect").empty();$("#partyForm [name=status]").val(["actived"]);$("#partyForm [name=title]").val(["男士"]);
GroupUtils.selectGroupTreeBox({selectedGroupId:$('input[name="groupId"]').val(),container:"groupName",isReDisabled:true,positionType:type=="search"?"all":"dept_manager,cs_search",fn:function(g){$('input[name="groupId"]').val(g);
},dataFilter:function(k,g,l){if(l&&l.length){for(var j=0;j<l.length;j++){var h=l[j];if(h.isAgent=="y"){h.chkDisabled=true;}}}return l;}});$("[name=sys]").val(b);
var d=e[0];if(d&&d.length>0){var f=new StringBuffer();for(var c=0;c<d.length;c++){f.append("<option value='"+d[c].id+"'>"+d[c].name+"</option>");}$("#roleSelect").append(f.toString());
$("#roleSelect").chosen("destroy");$("#roleSelect").chosen();}a.commonEav.renderEavForm();}});},_edit:function(a){$(".saveBtn").html("保存");this._loadEmpPkData(a);
$(".dataGroup").show();$(".addGroup").hide();$(".list_wrapper").hide();$(".form_wrapper").stop().animate({"left":"15px"},"fast");$(".addAddr").show();$("#selectOrganization").show();
$("#selectDefaultImageBtn").show();$(".edit-addr").show();$(".operation").show();$("#saveEmpTip").hide();$("input[name='adn']").attr("readonly","readonly");
$(".employeePkDiv").show();this._loadData(a);this.commonEav.setEntityId(a);this.commonEav.renderEavForm();FormUtils.enableForm("partyForm");},_detail:function(b,a){$(".dataGroup").show();
$(".deleteImage").hide();$(".addGroup").hide();$(".list_wrapper").hide();$(".form_wrapper").stop().animate({"left":"15px"},"fast");$(".addPhoneRow").hide();
$(".operateCol").hide();$(".addAddr").show();$("#selectOrganization").show();$("#selectDefaultImageBtn").show();$(".edit-addr").show();$(".operation").show();
$("#saveEmpTip").hide();$("input[name='adn']").attr("readonly","readonly");this._loadData(b,true,a);$(".addAddr").hide();$("#selectOrganization").attr("disabled",true);
$("#selectDefaultImageBtn").hide();$("img.deleteImage").hide();$(".edit-addr").hide();$(".operation").hide();$(".saveBtn").hide();FormUtils.disableForm("partyForm");
this.commonEav.setEntityId(b);this.commonEav.renderEavForm(function(){$("#eavCommonContainer form").find("input,select,textarea").attr("disabled","disabled");
});},_loadData:function(e,b,d){var a=this;var c="";if(b){if(d){c=Employee._CONS_.PERSON_DEATAIL_URL;}else{c=Employee._CONS_.DETAIL_URL;}}else{c=Employee._CONS_.EDIT_URL;
}FormUtils.loadData(c+"?id="+e,function(k){if(e=="admin"){$("[name=aid]").attr("readonly",true);}$("[name=sys]").val(k.sys);if(k.sex!=""){$("input[name='sex'][value="+k.sex+"]").attr("checked",true);
}$("[id=id]").val(k.id);$("[id=name]").val(k.name);$("[name=agentId]").val(k.agentId);$("[name=aid]").val(k.aid);$("#partyForm").find("[name=status]").val([k.status]);
$("[id=desc]").val(k.desc);$("#csCount").text(k.csCount).attr("disabled",true);$("#roleSelect").empty();$("[name=groupId]").val(k.groupId);$("[name=groupName]").val(k.orgName);
$("[name=position]").val(k.position);$("[name=positionNames]").val(k.positionNames);$("[name=wxCsToAid]").val(k.wxCsToAid);$("[name='lastLoginSys']").text(k.lastLoginSys?k.lastLoginSys:"无");
$("[name='lastLoginCti']").text(k.lastLoginCti?k.lastLoginCti:"无");$("[name='createTime']").text(k.createTime?k.createTime:"无");$("[name=adn]").text(k.adn?k.adn:"无");
$("#employeePk").val(k.employeePk).trigger("change");$(".removeEmpPk").attr({"id":e});$("input[name=activeTime]").val(k.activeTime);var n="";if(k.profile==""){var l="/img/jt/defaulTouXiang.png";
n=[{url:l,name:"",id:""}];}else{n=[{url:k.profile,name:"",id:""}];}var j=ImageUtils.createImageDivStr(n);$("#imageConatiner").empty().append(j);$("[name='userPo.mobile']").val(k.userPo.mobile);
$("[name='userPo.email']").val(k.userPo.email);$("[name='userPo.ipAddr']").val(k.userPo.ipAddr);if(k.userPo.visitScope=="both"){$(".outSideDiv").show();
}else{$(".outSideDiv").hide();}$("[name='userPo.visitScope']").val(k.userPo.visitScope);$("[name='userPo.beginHm']").val(k.userPo.beginHm);$("[name='userPo.endHm']").val(k.userPo.endHm);
$("[name='userPo.outIpAddr']").val(k.userPo.outIpAddr);a._loadRoleData("roleSelect",k.userPo.id,$("[name=sys]").val());$("[name='customerGroup']").val(k.customerGroup);
$("#customerGroupSelect").chosen("destroy");$("#customerGroupSelect").chosen();var h=b?true:false;$("[name=addr]").val(k.address);a.addressService.init({country:"ChinaCityCateType-root",province:k.province,city:k.city,area:k.area,town:k.town,rowFit:"y",isNotRequired:true,disabled:h,isHideCountry:true});
if(b){$("img.deleteImage").hide();}var m=new StringBuffer();var f=k.userPo.userRoleList;for(var g=0;g<f.length;g++){m.append(f[g].exportColumns);if(g!=f.length-1){m.append(",");
}}personalGrantExportColumns=m.toString();});},_loadRoleData:function(d,c,b){var a=this;FormUtils.loadData(Employee._CONS_.LIST_ROLE_DATA_URL+"?id="+c+"&sys="+b,function(f){if(f.success){var e=JSON.parse(f.msg);
a._resetRoleChosen(e,[]);}else{DialogUtils.error("错误",f.msg);}});},_resetRoleChosen:function(d,a){var e=new StringBuffer();if(d&&d.length>0){for(var c=0;
c<d.length;c++){if(d[c].selected==true){e.append("<option value='").append(d[c].value).append("' selected='selected'>").append(d[c].name).append("</option>");
}else{e.append("<option value='").append(d[c].value).append("' ");for(var b=0;b<a.length;b++){if(d[c].value==a[b]){e.append("selected='selected' ");break;
}}e.append(">").append(d[c].name).append("</option>");}}}$("#roleSelect").empty().append(e.toString());$("#roleSelect").chosen("destroy");$("#roleSelect").chosen({width:"100%"});
},_bindEventHander:function(){var a=this;$(document).on("click","#groupInfo",function(){$(".groupType").show();$(".teamType").hide();$(this).addClass("activeBtn");
$("#teamInfo").removeClass("activeBtn");});$(document).on("click","#teamInfo",function(){$(".teamType").show();$(".groupType").hide();$(this).addClass("activeBtn");
$("#groupInfo").removeClass("activeBtn");a.teamPk.init();});$(document).on("click",".chooseWxCsToAid",function(){var c=new EmployeesSelect();var d={grantType:"/role/",isMultiple:0,isSale:0,mode:0,callBack:function(e){$("[name=wxCsToAid]").val(e[0].aid);
}};c.init(d);});$(document).on("click",".removeWxCsToAid",function(){$("[name=wxCsToAid]").val("");});$(window).on("resize",function(){$("#roleSelect").chosen("destroy");
$("#roleSelect").chosen({width:"100%"});var c=$("#imageConatiner").width();$(".file").width(c);});function b(d){if($.isArray(d)){for(var e=d.length-1;e>=0;
e--){var c=d[e];var f=$(Employee._CONS_.GRID).jqGrid("getRowData",c);if("deleted"==f.status){DialogUtils.error(msgCode.ERROR,"已删除员工不能操作");return false;
}}return true;}else{var f=$(Employee._CONS_.GRID).jqGrid("getRowData",d);if("deleted"==f.status){DialogUtils.error(msgCode.ERROR,"已删除员工不能操作");return false;
}else{return true;}}}$(document).on("click",".exportEmployee",function(){var d=$("#employeeSearchForm").serialize();d=d;var c=Employee._CONS_.EXPORT_URL+"?"+d;
FormUtils.loadData(c,function(e){if(e.success){DialogUtils.success("成功",e.msg);}else{DialogUtils.error("错误",e.msg);}});});$(document).on("click",".resetPass",function(){var c=a._getMultiSelectedId($(this));
if(c){if(b(c)){a._resetPass(c);}}});$(document).on("click",".profitPK",function(){var f=[];var c=$(Employee._CONS_.GRID).jqGrid("getGridParam","selarrrow");
for(var d=0;d<c.length;d++){var e=$(Employee._CONS_.GRID).jqGrid("getRowData",c[d]);var g={id:c[d],aid:e.aid,name:e.name};f.push(g);}a._profitPK(f);});
$(document).on("click",".followCsCount",function(){var c=$(Employee._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(c.length==0){DialogUtils.error("提示","请选择要操作的记录");
return false;}var f=[];for(var d=0;d<c.length;d++){var e=$(Employee._CONS_.GRID).jqGrid("getRowData",c[d]);var g={id:c[d],aid:e.aid,name:e.name,csCount:e.csCount,dayFollowCsSum:e.dayFollowCsSum};
f.push(g);}$("#followCsContainer").modal("show");a._bulidFollowCs(f);});$(document).on("click","#bacthAddCsFollow",function(){var c=$(".csFollowCountInput").val();
if(!(/^\d+$/.test(c))){DialogUtils.error("提示","输入必须为整数");return false;}$(".dayFollowCsSum").val(c);});$(document).on("click",".saveFollowCs",function(){var c=[];
$("#followCsTableForm").find("table tr").each(function(){var d={};$(this).find("td").each(function(){if($(this).hasClass("empId")){d.id=$(this).text();
}else{if($(this).children().length>0){d.dayFollowCsSum=($(this).find("input").val());}}});c.push(d);});a._saveFollowCs(c);});$("body").on("click",".employeeModuleExport",function(){var e={};
var d=d=["aid","name","group","position","role"];e.module="csEntity";e.moduleColumnPos=[{name:"工号",showCode:"00139"},{name:"姓名",showCode:"00140"},{name:"部门",showCode:"00141"},{name:"岗位",showCode:"00142"},{name:"角色",showCode:"00143"}];
LocalStorageUtils.set("CS_EXPORT_COLUMNS_TMPL"+currentUserId,d.toString());var c={columnJson:JSON.stringify(e),moduleText:"员工模块"};window.location.href=ctx+"/gl/mc/moduleColumn/genExcel.htm?"+$.param(c);
});$("body").on("click",".employeeImport",function(){var c={"importUrl":Employee._CONS_.IMPORT_EXCEL_URL,"tabTitle":"导入员工excel数据"};excelUtil.importExcel(c);
});$("#groupName").on("click",function(){var c=$("#groupType").val();if(c=="add"){GroupUtils.selectGroupTreeBox({selectedGroupId:$('input[name="groupId"]').val(),container:"groupName",hideSale:true,isReDisabled:true,positionType:"all",fn:function(d){$('input[name="groupId"]').val(d);
},dataFilter:function(g,d,h){if(h&&h.length){for(var f=0;f<h.length;f++){var e=h[f];if(e.isAgent=="y"&&e.agentId==""){e.chkDisabled=true;}}}return h;}});
}else{GroupUtils.selectGroupTreeBox({selectedGroupId:$('input[name="groupId"]').val(),container:"groupName",hideSale:true,isReDisabled:true,positionType:type=="search"?"all":"dept_manager,cs_search",fn:function(d){$('input[name="groupId"]').val(d);
},dataFilter:function(g,d,h){if(h&&h.length){for(var f=0;f<h.length;f++){var e=h[f];if(e.isAgent=="y"&&e.agentId==""){e.chkDisabled=true;}}}return h;}});
}});$("#positionNames").on("click",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$('input[name="position"]').val(),container:"positionNames",isMultiple:1,hideSale:true,isReDisabled:true,positionType:"all",fn:function(c){$('input[name="position"]').val(c);
},dataFilter:function(f,c,g){if(g&&g.length){for(var e=0;e<g.length;e++){var d=g[e];if(d.isAgent=="y"&&d.agentId==""){d.chkDisabled=true;}}}return g;}});
});$("#positionSearchSelect").on("click",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$('input[name="Q__S__LK__employee.position_"]').val(),container:"positionSearchSelect",isMultiple:0,hideSale:true,positionType:"all",fn:function(c){$('input[name="Q__S__LK__employee.position_"]').val(c);
}});});$(document).on("click",".prevBtn",function(){a.isAdd=false;a._clear(false);});$(document).on("click",".saveBtn",function(){if(a.isBatchCreateSwitchery&&a.isBatchCreateSwitchery.isChecked()){a._batchCreate();
}else{var c=$("[name=id]").val()?Employee._CONS_.SAVE_EDIT_URL:Employee._CONS_.SAVE_ADD_URL;if($(this).attr("id")=="saveAddBtn"){a.isAdd=true;}a._saveEmployee(c);
}});$("body").on("click",".employeeAdd",function(){a.isEdit=false;var c="ecm";$("#groupType").val("add");$(".employeePkDiv").hide();a._add(c);});$("body").on("click",".employeeAddScm",function(){a.isEdit=false;
var c="scm";$("#groupType").val("add");a._add(c);});$("body").on("click",".employeeEdit",function(){$("#saveAddBtn").hide();var c=a._getSingleSelectedId($(this));
if(c){if(b(c)){a.isEdit=true;a._edit(c);}}});$("body").on("click",".employeeDel",function(){var c=a._getMultiSelectedId($(this));if(($.isArray(c)&&!c.length)||(!$.isArray(c)&&!c)){return;
}if(b(c)){DialogUtils.confirmWithOptions({title:"删除会释放工号,删除的员工无法恢复,确定吗?",text:"",confirmButtonText:"确定",yesFunc:function(){a._delete(c);}});}});$("body").on("click",".employeeCancel",function(){var d=a._getMultiSelectedId($(this));
var f="";var c=new Array();if(($.isArray(d)&&!d.length)||(!$.isArray(d)&&!d)){return;}if(!$.isArray(d)){var h=[];h.push(d);d=h;}for(var e=0;e<d.length;
e++){var g=$(Employee._CONS_.GRID).jqGrid("getRowData",d[e]);if(g.csCount>0){f+=g.aid+",";}else{c+=d[e]+",";}}if(b(d)){DialogUtils.confirmWithOptions({title:"确定注销吗？",text:"",confirmButtonText:"确定",yesFunc:function(){if(f.length>0){DialogUtils.error("错误","无法注销工号"+f+"有客户的员工");
}if(c.length!=0){a._cancel(c);}}});}});$("body").on("click",".employeeForceLogout",function(){var c=a._getMultiSelectedId($(this));if(($.isArray(c)&&!c.length)||(!$.isArray(c)&&!c)){return;
}if(b(c)){DialogUtils.confirmWithOptions({title:"确定强制员工下线吗？",text:"",confirmButtonText:"确定",yesFunc:function(){a._forceLogout(c);}});}});$("body").on("click",".refreshCredit",function(){DialogUtils.confirmWithOptions({title:"确定刷新授权吗？",text:"",confirmButtonText:"确定",yesFunc:function(){a._refreshCredit();
}});});$("body").on("click",".employeeActive",function(){var c=a._getMultiSelectedId($(this));if(($.isArray(c)&&!c.length)||(!$.isArray(c)&&!c)){return;
}if(b(c)){a._active(c);}});$("body").on("click",".employeeDetail",function(){a.isEdit=false;var c=a._getSingleSelectedId($(this));if(c){var d=$(Employee._CONS_.GRID).jqGrid("getRowData",c);
if("deleted"==d.status){$(".deletedHide").hide();}a._detail(c);}});$("body").on("click",".resTreeDetail",function(){var c=a._getSingleSelectedId($(this));
if(c){if(b(c)){a._openUserResIframe(c);}}});$("body").on("click",".showSecureOperLog",function(){var c=a._getSingleSelectedId($(this));if(c){var d={operatorId:c};
SecureLogService.openEmployeeSecureLog(d);}});$("#selectDefaultImageBtn").click(function(){ImageUtils.selectImage(0,function(c){var d=ImageUtils.createImageDivStr(c);
$("#imageConatiner").empty().append(d);});});$(document).on("click",".employeeSearch",function(){$("#nameSearch").val($("#nameSearch").val().trim());var c=$(this).closest("form").serialize();
c=c;a._reloadJqgrid(c);});$("#employeeSearchForm").on("keypress",function(c){if(c.keyCode=="13"){$(".employeeSearch").trigger("click");}});$(".form_wrapper").on("change","input",function(){if(a.isEdit){a.isFormDataChange=true;
}});$(".form_wrapper").on("change",".form_wrapper select",function(){if(a.isEdit){a.isFormDataChange=true;}});$(".form_wrapper").on("change",".form_wrapper textarea",function(){if(a.isEdit){a.isFormDataChange=true;
}});$("body").on("change",".visitScope",function(){if($(this).val()=="both"){$(".outSideDiv").show();}else{$(".outSideDiv").hide();}});$("#organizationTreeSearch").on("keyup",function(c){if(c.keyCode==13){a._searchNode(c);
a._callNumber();}});$("#clickUp").on("click",function(){a._clickUp();});$("#clickDown").on("click",function(){a._clickDown();});$("#moveGroupForm").on("click","#departmentName",function(){var c={isMultiple:0,selectedGroupId:$("input[name='departmentId']").val(),container:"departmentName",nolimit:true,positionType:"statistics,dept_manager",fn:function(d,e,f){$("#moveGroupForm").find("input[name=departmentHideName]").val(f);
$("#moveGroupForm").find("input[name=departmentId]").val(d);}};GroupUtils.selectGroupTreeBox(c);});$("body").on("click",".moveGroupBatch",function(){var c=$(EmployeeRate._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(!c||c.length<=0){var d=$("#employeeSearchForm").serialize();d=d+"&treeNodeId="+a.employeeGroup.currentClickTreeNode.id;FormUtils.loadData(EmployeeEditBatch._CONS_.LIST_ID_DATA+"?"+d,function(e){a._batchMoveGroupForEmp(e);
});}else{a._batchMoveGroupForEmp(c);}});$("body").on("click","#addEmp",function(){a.isEdit=false;var c="ecm";$("#groupType").val("addEmp");a._addEmp(c);
});$("body").on("click","#editEmp",function(){var c=a._getSingleSelectedId($(this));var g="";var e=Employee._CONS_.GROUPNAMES.split(",");if(c){if(b(c)){var f=$(Employee._CONS_.GRID).jqGrid("getRowData",c);
if(c){for(var d=0;d<e.length;d++){if(f.orgName!=e[d]){g=f.aid;break;}else{break;}}}if(g!=""&&g!=null){DialogUtils.error("错误","无法编辑工号"+g+"非本部门的员工");return;
}else{a.isEdit=true;a._editEmp(c);}}}});$("body").on("click","#cancelEmp",function(){var e=a._getMultiSelectedId($(this));var m="";var k="";var l=Employee._CONS_.GROUPNAMES.split(",");
var h=new Array();if(($.isArray(e)&&!e.length)||(!$.isArray(e)&&!e)){return;}for(var g=0;g<e.length;g++){var c=true;var d=$(Employee._CONS_.GRID).jqGrid("getRowData",e[g]);
for(var f=0;f<l.length;f++){if(d.orgName==l[f]){c=false;break;}}if(c==true){k+=d.aid+",";}if(c==false){if(d.csCount=="0"){h+=e[g]+",";}else{m+=d.aid+",";
}}}if(b(e)){DialogUtils.confirmWithOptions({title:"确定注销吗？",text:"",confirmButtonText:"确定",yesFunc:function(){if(m.length>0){DialogUtils.error("错误","无法注销工号"+m+"有客户的员工");
}if(k.length>0){DialogUtils.error("错误","无法注销工号"+k+"非本部门的员工");}if(h.length!=0){a._cancel(h);}}});}});$("body").on("click",".removeEmpPk",function(){var c=new Array();
c=$(this).attr("id");if(c!=""&&c.length>0){DialogUtils.confirmWithOptions({title:"确定清空Pk对象吗",text:"",confirmButtonText:"确定",yesFunc:function(){FormUtils.del(Employee._CONS_.CLEAR_PK_URL,c,function(e){if(e.success){var d=c;
a._loadEmpPkData(d);DialogUtils.success(msgCode.SUCCESS,e.msg);}else{DialogUtils.error(msgCode.error,e.msg);}});}});}});},_saveFollowCs:function(c){var b=this;
var a=ctx+"/crm/ou/employee/saveFollowCs.htm";FormUtils.submit(a,"jsondata="+JSON.stringify(c),function(d){if(d.success){DialogUtils.success("提示","保存成功");
$(".employeeSearch").trigger("click");$("#followCsContainer").modal("hide");}});},_bulidFollowCs:function(c){var a=this;var d=new StringBuffer();for(var b=0;
b<c.length;b++){d.append("<tr>");d.append('<td style="display:none" class="empId">');d.append(c[b].id);d.append("</td>");d.append('<td style="width: 25%">');
d.append(c[b].aid);d.append("</td>");d.append('<td style="width: 25%">');d.append(c[b].name);d.append("</td>");d.append('<td style="width: 25%">');d.append(c[b].csCount);
d.append("</td>");d.append('<td style="width: 25%">');if(c[b].dayFollowCsSum!="0"){d.append("<input type='text' class='form-control dayFollowCsSum' name='dayFollowCsSum' value='"+c[b].dayFollowCsSum+"'>");
}else{d.append("<input type='text' class='form-control dayFollowCsSum' name='dayFollowCsSum'>");}d.append("</td>");d.append("</tr>");}$("#followCsTableContainer").empty().append(d.toString());
},_profitPK:function(a){var b=new EmployeeProfitPk();b.init(a);},_batchMoveGroupForEmp:function(b){var a=this;layer.open({type:1,title:'您正在对<font style="color:red;">【'+b.length+"个】</font>员工进行批量更改部门",maxmin:false,shadeClose:false,btn:["保存","取消"],area:["50%","50%"],content:$(".moveGroupBatchLayer"),yes:function(d,c){a._saveEmployeeEditBatch(b,d,c);
}});},_editEmp:function(b){var a=this;$(".dataGroup").show();$(".addGroup").hide();$(".list_wrapper").hide();$(".form_wrapper").stop().animate({"left":"15px"},"fast");
$(".addAddr").show();$("#selectOrganization").show();$("#selectDefaultImageBtn").show();$(".edit-addr").show();$(".operation").show();$("input[name='adn']").attr("readonly","readonly");
a.loadEditEmp(b);this.commonEav.setEntityId(b);this.commonEav.renderEavForm();FormUtils.enableForm("partyForm");},loadEditEmp:function(d){var b=this;var c="";
var a=false;FormUtils.loadData(Employee._CONS_.EMP_EDIT_URL+"?id="+d,function(j){var m=j[0];var j=j[1];c=j.userPo.roleIds;if(d=="admin"){$("[name=aid]").attr("readonly",true);
}$("[name=sys]").val(j.sys);if(j.sex!=""){$("input[name='sex'][value="+j.sex+"]").attr("checked",true);}$("[id=id]").val(j.id);$("[id=name]").val(j.name);
$("[name=aid]").val(j.aid);$("#partyForm").find("[name=status]").val([j.status]);$("[id=desc]").val(j.desc);$("#csCount").text(j.csCount).attr("disabled",true);
$("#roleSelect").empty();$("[name=groupId]").val(j.groupId);$("[name=groupName]").val(j.orgName);$("[name='lastLoginSys']").text(j.lastLoginSys?j.lastLoginSys:"无");
$("[name='lastLoginCti']").text(j.lastLoginCti?j.lastLoginCti:"无");$("[name='createTime']").text(j.createTime?j.createTime:"无");$("[name=adn]").text(j.adn?j.adn:"无");
$("[name=positionNames]").val(j.positionNames);$("[name=position]").val(j.position);var k="";if(j.profile==""){var n="/img/jt/defaulTouXiang.png";k=[{url:n,name:"",id:""}];
}else{k=[{url:j.profile,name:"",id:""}];}var l=ImageUtils.createImageDivStr(k);$("#imageConatiner").empty().append(l);$("[name='userPo.mobile']").val(j.userPo.mobile);
$("[name='userPo.email']").val(j.userPo.email);$("[name='userPo.ipAddr']").val(j.userPo.ipAddr);if(j.userPo.visitScope=="both"){$(".outSideDiv").show();
}else{$(".outSideDiv").hide();}$("[name='userPo.visitScope']").val(j.userPo.visitScope);$("[name='userPo.beginHm']").val(j.userPo.beginHm);$("[name='userPo.endHm']").val(j.userPo.endHm);
$("[name='userPo.outIpAddr']").val(j.userPo.outIpAddr);var g=false;$("[name=addr]").val(j.address);b.addressService.init({country:"ChinaCityCateType-root",province:j.province,city:j.city,area:j.area,town:j.town,rowFit:"y",isNotRequired:true,disabled:g,isHideCountry:true});
if(a){$("img.deleteImage").hide();}var o=new StringBuffer();var f=j.userPo.userRoleList;for(var h=0;h<f.length;h++){o.append(f[h].exportColumns);if(h!=f.length-1){o.append(",");
}}GroupUtils.selectGroupTreeBox({selectedGroupId:$('input[name="groupId"]').val(),container:"groupName",isReDisabled:true,positionType:type=="search"?"all":"dept_manager,cs_search",fn:function(i){$('input[name="groupId"]').val(i);
},dataFilter:function(s,p,t){if(t&&t.length){for(var r=0;r<t.length;r++){var q=t[r];if(q.isAgent=="y"){q.chkDisabled=true;}}}}});if(m&&m.length>0){var o=new StringBuffer();
for(var h=0;h<m.length;h++){var e=m[h];o.append("<option value='");o.append(e.id);o.append("'");if(c&&c.indexOf(e.id)>=0){o.append(" selected='selected'");
}o.append(">");o.append(e.name);o.append("</option>");}$("#roleSelect").append(o.toString());$("#roleSelect").chosen("destroy");$("#roleSelect").chosen();
}personalGrantExportColumns=o.toString();});},_saveEmployeeEditBatch:function(e,c,a){var b=this;var f=this._buildParams(e);if(!f){return false;}var d=f.msg;
FormUtils.submit(EmployeeEditBatch._CONS_.SAVE_EDIT_BATCH,"jsondata="+JSON.stringify(f),function(h){if(h.success){DialogUtils.success(msgCode.SUCCESS,"批量修改"+e.length+"个员工资料。"+d);
layer.close(c);var g=$("#employeeSearchForm").serialize();g=g;b.employee._reloadJqgrid(g);}else{DialogUtils.error(msgCode.ERROR,h.msg);}},function(){DialogUtils.error(msgCode.ERROR,"服务器错误");
});},_buildParams:function(a){var b={ids:a,groupId:"",msg:""};var c=new StringBuffer();b.groupId=$("#moveGroupForm").find("input[name=departmentId]").val();
b.msg="将该员工移动到了 ["+$("#moveGroupForm").find("input[name=departmentHideName]").val()+"]";return b;},_searchNode:function(d){var a=$.fn.zTree.getZTreeObj("organizationTree");
var c=$.trim($("#organizationTreeSearch").val());var b="name";if(this.lastValue===c){return;}this.lastValue=c;this._updateNodes(true,this.nodeList);if(c!=""){this.nodeList=a.getNodesByParamFuzzy(b,c);
this._updateNodes(true,this.nodeList);}else{this.nodeList=[];}},_updateNodes:function(b,d){var c=$.fn.zTree.getZTreeObj("organizationTree");if(d){for(var e=0,a=d.length;
e<a;e++){d[e].highlight=b;if(b){c.expandNode(d[e].getParentNode(),true,false,false);}c.updateNode(d[e]);}}},_callNumber:function(){var a=$.fn.zTree.getZTreeObj("organizationTree");
if(this.nodeList.length){a.selectNode(this.nodeList[0],false);this.clickCount=1;document.getElementById("number").innerHTML="["+this.clickCount+"/"+this.nodeList.length+"]";
}else{if(this.nodeList.length==0){document.getElementById("number").innerHTML="[0/0]";a.cancelSelectedNode();}}if($.trim($("#organizationTreeSearch").val())==""){document.getElementById("number").innerHTML="";
a.cancelSelectedNode();}},_clickUp:function(){var a=$.fn.zTree.getZTreeObj("organizationTree");if(this.nodeList.length==0){DialogUtils.error(msgCode.FAIL_MSG,"没有搜索结果！");
return;}else{if(this.clickCount==1){DialogUtils.error(msgCode.FAIL_MSG,"您已位于第一条记录上！");return;}else{this.clickCount--;a.selectNode(this.nodeList[this.clickCount-1],false);
}}document.getElementById("number").innerHTML="["+this.clickCount+"/"+this.nodeList.length+"]";},_clickDown:function clickDown(){var a=$.fn.zTree.getZTreeObj("organizationTree");
if(this.nodeList.length==0){DialogUtils.error(msgCode.FAIL_MSG,"没有搜索结果！");return;}else{if(this.nodeList.length==this.clickCount){DialogUtils.error(msgCode.FAIL_MSG,"您已位于最后一条记录上！");
return;}else{a.selectNode(this.nodeList[this.clickCount],false);this.clickCount++;}}document.getElementById("number").innerHTML="["+this.clickCount+"/"+this.nodeList.length+"]";
},_resetTab:function(){var a=$("div.tabs-container");a.find("li.tabli, div.tab-pane").removeClass("active");a.find("li.tabli").eq(0).addClass("active");
a.find("div.tab-pane").eq(0).addClass("active");},_delete:function(b){var a=this;if(b.indexOf("admin")>=0){DialogUtils.error(msgCode.ERROR,"admin用户不能删除,请检查后重试");
return;}FormUtils.del(Employee._CONS_.DELETE_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.SUCCESS,c.msg);}else{DialogUtils.error(msgCode.error,c.msg);
}$(".employeeSearch").trigger("click");});},_cancel:function(b){var a=this;FormUtils.del(Employee._CONS_.CANCEL_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.SUCCESS,c.msg);
}else{DialogUtils.error(msgCode.SUCCESS,c.msg);}$(".employeeSearch").trigger("click");});},_loadEmpPkData:function(a){FormUtils.loadData(Employee._CONS_.EMP_PK_URL+"?id="+a,function(c){if(c&&c.length>0){var d=new StringBuffer();
d.append('<option value="">请选择</option>');for(var b=0;b<c.length;b++){d.append("<option value='"+c[b].id+"'>"+c[b].aid+":"+c[b].name+"</option>");}$("#employeePk").empty().append(d.toString()).select2();
}else{DialogUtils.error("没有可选择的员工",msg.msg);}});},_forceLogout:function(b){var a=this;FormUtils.del(Employee._CONS_.FORCE_LOGOUT_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.SUCCESS,c.msg);
}else{DialogUtils.error(msgCode.SUCCESS,c.msg);}$(".employeeSearch").trigger("click");});},_refreshCredit:function(){var a=this;FormUtils.del(Employee._CONS_.REFRESHCREDIT_URL,"",function(b){if(b.success){DialogUtils.success(msgCode.SUCCESS,b.msg);
}else{DialogUtils.error(msgCode.SUCCESS,b.msg);}$(".employeeSearch").trigger("click");});},_active:function(b){var a=this;FormUtils.del(Employee._CONS_.ACTIVE_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.SUCCESS,c.msg);
}else{DialogUtils.error(msgCode.SUCCESS,c.msg);}$(".employeeSearch").trigger("click");});},_openUserResIframe:function(b,a){layer.open({type:2,title:"用户权限信息",maxmin:false,shadeClose:true,btn:["关闭","关闭"],area:["95%","95%"],skin:"cs-opt-layer",content:Employee._CONS_.SHOW_RES_TREE_URL+"?id="+b});
},_resetPass:function(a){var b={title:"确定重置密码吗?",text:"重置密码将会把员工密码重置为默认的6位密码",cancelButtonText:"取消",confirmButtonText:"重置",isNeedAutoClose:false,yesFunc:function(){FormUtils.submit(Employee._CONS_.RESET_PASS_URL,{userId:a},function(d){if(d.success){var c={title:d.msg,text:"请使用此重置后的密码进行登录",showCancelButton:false,confirmButtonText:"确定",confirmButtonColor:"#1ab394",yesFunc:function(){},};
DialogUtils.confirmWithOptions(c);}else{DialogUtils.error("失败",d.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});}};DialogUtils.confirmWithOptions(b);
},_getAddrsJson:function(){var a=this.addressService.getAddress();var b="province="+a.province+"&city="+a.city+"&area="+a.area+"&town="+a.town;b+="&address="+$('input[name="addr"]').val();
return b;},_getSingleSelectedId:function(b){var a=b.attr("idVal");if(!a){a=$(Employee._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(a==null||a.length==0){DialogUtils.error("错误","请选择要操作的记录");
return;}if(a.length>1){DialogUtils.error("错误","不能同时操作多条记录");return;}}return a;},_getMultiSelectedId:function(b){var a=b.attr("idVal");if(!a){a=$(Employee._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(a==null||a.length==0){DialogUtils.error("错误","请选择要操作的记录");return;}}return a;},_hideNotGrantBtn:function(){if(!ResUtils.canShow("employee.button.moveGroupForEmps")){$(".moveGroupBatch").hide();
}if(!ResUtils.canShow("employee.button.teamManage")){$(".teamManageDiv").hide();}if(!ResUtils.canShow("employee.button.add")){$(".employeeAdd").hide();
}if(!ResUtils.canShow("employee.button.resetPass")){$(".resetPass").hide();}if(!ResUtils.canShow("employee.button.delete")){$(".employeeDel").hide();}if(!ResUtils.canShow("employee.button.showUserRes")){$(".resTreeDetail").hide();
}if(!ResUtils.canShow("employee.button.exportEmployee")){$(".exportEmployee").hide();}if(!ResUtils.canShow("employee.button.employeeModuleExport")){$(".employeeModuleExport").hide();
}if(!ResUtils.canShow("employee.button.employeeImport")){$(".employeeImport").hide();}if(!ResUtils.canShow("employee.button.addEmp")){$("#addEmp").hide();
}if(!ResUtils.canShow("employee.button.cancelEmp")){$("#cancelEmp").hide();}if(!ResUtils.canShow("employee.button.editEmp")){$("#editEmp").hide();}if(deploySys.indexOf("scm")<0||!ResUtils.canShow("employee.button.employeeAddScm")){$(".employeeAddScm").hide();
}if("myGroup"==type){$(".employeeAdd").hide();$(".employeeEdit").hide();$(".employeeDel").hide();$(".employeeCancel").hide();$(".employeeActive").hide();
$(".employeePWEdit").hide();$(".exportEmployee").hide();$(".showSecureOperLog").hide();$(".employeeForceLogout").hide();$(".employeeAddScm").hide();$(".subEmp").hide();
}},_fixedModalWidth:function(){var a=$(window).width();var c=0.3;var b=1024;if(a){if(a<=b){c=0.8;}else{if(a>b&&a<=1280){c=0.7;}else{if(a>1280&&a<=1440){c=0.6;
}else{if(a>1440&&a<=1600){c=0.5;}else{c=0.4;}}}}}$("#officerModalContainer").find(".modal-dialog").width($(document).width()*c);$("#orgModalContainer").find(".modal-dialog").width($(document).width()*c);
},_bindFormValidation:function(){jQuery.validator.addMethod("isDate",function(d,c){return this.optional(c)||/^(20|21|22|23|[0-1]{1}[0-9]{1}):[0-5]{1}[0-9]{1}$/.test(d);
},"格式必须是HH:mm");var b={rules:{"profile":{maxlength:["255"],},"aid":{required:true,isExistsAccount:"id"},"adn":{required:true,},"userPo.mobile":{required:false,mobile:true,isExistsMob:"id",}},messages:{aid:{isExistsAccount:"工号已经存在"}}};
FormUtils.bindFormValidation("partyForm",b);var a={rules:{"userPo.email":{required:false,email:true,},"userPo.beginHm":{isDate:true,},"userPo.endHm":{isDate:true,},},messages:{}};
FormUtils.bindFormValidation("detailForm",a);},_reloadJqgrid:function(b){var a=this;if(b&&jQuery.type(b)=="string"){b=b+"&treeNodeId="+a.employeeGroup.currentClickTreeNode.id;
}else{if(b&&jQuery.type(b)=="object"){b.treeNodeId=a.employeeGroup.currentClickTreeNode.id;}else{b="&treeNodeId="+a.employeeGroup.currentClickTreeNode.id;
}}JTJqgridUtils.reloadJqgrid(Employee._CONS_.GRID,b);},_initJqgrid:function(b){var a=this;$(Employee._CONS_.GRID).JTJqgrid({url:Employee._CONS_.LIST_DATA_URL,pager:Employee._CONS_.PAGER,postData:b,hasBreadcrumb:true,colNames:["头像","工号","姓名","分机","所属部门","角色","岗位","部门id","已有客户","每日需跟进客户","创建时间","最后登录","是否销售部门","在线","状态","操作","操作","操作",],simplify:{key:"yggl",entry:[],must:["工号","姓名"]},colModel:[{name:"profile",width:38,sortable:false,formatter:function(c,f,h){var g=Employee._CONS_.DE_IMG;
var e="<img onerror='onImageError()' style='display: inline; height:35px;' ";if(h.profile!=""&&h.profile!=null){var d={url:h.profile,name:"",id:""};e=e+" src='"+ImageUtils.getUrl(d)+"?dm=_mm' ";
}else{e=e+" src='"+ctx+"/img/jt/defaulTouXiang.png' ";}e+=" >";return e;}},{name:"aid",width:65,index:"employee.aid_",formatter:function(e,d,f){if(f.footData){$(".ui-jqgrid-title").css({"width":"100%"});
var g=new StringBuffer();g.append(f.aid);return g.toString();}else{if(f.aid!=null&&f.aid!=""){if(f.status=="deleted"){var c=f.aid.split("_");return c[0];
}else{return f.aid;}}}}},{name:"name",width:60,index:"employee.name_",sortable:false,},{name:"adn",width:45,index:"employee.adn_"},{name:"orgName",width:110,index:"group_.name_"},{name:"roleNames",width:90,sortable:false},{name:"positionNames",width:100,sortable:false,formatter:function(g,d,f){if(g){g=g.split(",");
}var c="";if(g&&g.length){for(var e=0;e<g.length;e++){c+=g[e];if(e<g.length-1){c+="<br>";}}}return c;}},{name:"groupId",width:120,sortable:false,hidden:true},{name:"csCount",width:60,index:"employee.cs_count_",formatter:function(c,d,e){return e.csCount;
}},{name:"dayFollowCsSum",width:60,index:"employee.day_follow_csSum_",sortable:false,hidden:true},{name:"createTime",width:100,index:"employee.create_time_",classes:"autoHideCol",formatter:function(c){return DateUtils.miniTime(c);
}},{name:"lastLoginSys",width:100,index:"user.last_login_sys_",classes:"autoHideCol",formatter:function(c){return DateUtils.miniTime(c);}},{name:"isBelongSaleOrg",hidden:true,width:10},{name:"online",index:"user.is_online_",width:36,sortable:true,formatter:function(c,d,e){if(e.isOnline=="y"){return"<font style='color:red'>在线 </font>";
}else{return"离线";}}},{name:"statusName",width:36,index:"employee.status_",formatter:function(c,d,e){if(e.status=="actived"){return"<span class='text text-primary'>激活</span>";
}else{if(e.status=="locked"){return"<span class='text text-warning'>锁定</span>";}else{if(e.status=="inactive"){return"<span class='text text-warning'>已注销</span>";
}else{if(e.status=="deleted"){return"<span class='text text-danger'>已删除</span>";}else{return"";}}}}}},{name:"operate",width:180,sortable:false,formatter:function(c,d,e){var f=new StringBuffer();
if("myGroup"!=type){if(ResUtils.canShow("employee.button.edit")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-opt employeeEdit'>编辑</button>");
}if(ResUtils.canShow("employee.button.detail")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-safe employeeDetail'>明细</button>");}f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-opt employeePWEdit'>改密</button>");
if(ResUtils.canShow("employee.button.showSecureOperLog")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-safe showSecureOperLog'>日志</button>");
}if(e.isOnline=="y"&&ResUtils.canShow("employee.button.employeeForceLogout")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-warn employeeForceLogout'>下线</button>");
}if(e.status=="inactive"&&ResUtils.canShow("employee.button.active")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-opt employeeActive'>激活</button>");
}if(e.status=="actived"&&ResUtils.canShow("employee.button.cancel")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-error employeeCancel'>注销</button>");
}}else{if(ResUtils.canShow("employee.button.detail")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-safe employeeDetail'>明细</button>");
}if(ResUtils.canShow("employee.button.resetPass")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-opt resetPass'>重置密码</button>");}if(ResUtils.canShow("employee.button.employeeForceLogout")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-safe showSecureOperLog'>日志</button>");
}if(ResUtils.canShow("employee.button.showUserRes")){f.append("<button idVal='"+e.id+"' type='button' class='jt-btn-opt resTreeDetail'>权限</button>");}}return f.toString();
}},{name:"status",width:0,sortable:false,hidden:true},{name:"__manage",width:40,classes:"rowOps",sortable:false,align:"center",formatter:"manage",title:"操作",formatoptions:a._getManagerBtns()}],footerrow:true,userDataOnFooter:true,gridComplete:function(){var c=$(".ui-jqgrid-sdiv").find("tr.footrow");
c.find("td").css({"font-weight":500,"width":"auto"});c.find("td").hide();c.find('td[aria-describedby*="employeeGrid_aid"]').show();}});},_getManagerBtns:function(){var b=this;
var a=[];if(ResUtils.canShow("employee.button.detail")){a.push({lable:"明细",btnClasses:"btn btn-primary employeeDetail",iconClasses:"fa fa-list"});}if(ResUtils.canShow("employee.button.edit")&&"myGroup"!=type){a.push({switchCol:{colName:"status",colVals:["actived","inactive"],colLables:["编辑","编辑"],btnClasses:["btn btn-primary employeeEdit","btn btn-primary employeeEdit"],iconClasses:["fa fa-edit","fa fa-edit"]}});
}if(ResUtils.canShow("employee.button.showSecureOperLog")&&"myGroup"!=type){a.push({lable:"查看日志",btnClasses:"btn btn-primary showSecureOperLog",iconClasses:"fa fa-list"});
}if(ResUtils.canShow("employee.button.active")&&"myGroup"!=type){a.push({switchCol:{colName:"status",colVals:["inactive"],colLables:["激活"],btnClasses:["btn btn-primary employeeActive"],}});
}if(ResUtils.canShow("employee.button.changePw")&&"myGroup"!=type){a.push({switchCol:{colName:"status",colVals:["actived"],colLables:["修改密码"],btnClasses:["btn btn-primary employeePWEdit"],iconClasses:["fa fa-edit","fa fa-edit"]}});
}if(ResUtils.canShow("employee.button.resetPass")){a.push({switchCol:{colName:"status",colVals:["actived"],colLables:["重置密码"],btnClasses:["btn btn-primary resetPass"],iconClasses:["fa fa-edit","fa fa-edit"]}});
}if(ResUtils.canShow("employee.button.rate")&&"myGroup"!=type){a.push({switchCol:{colName:"status",colVals:["actived"],colLables:["提成比率"],btnClasses:["btn btn-primary addEmployeeRateBtn"],iconClasses:["fa fa-edit"]}});
}if(ResUtils.canShow("employee.button.percentage")&&"myGroup"!=type){a.push({switchCol:{colName:"status",colVals:["actived"],colLables:["录入提成"],btnClasses:["btn btn-primary addEmployeeRateMoneyBtn"],iconClasses:["fa fa-edit"]}});
}if(ResUtils.canShow("employee.button.employeeForceLogout")&&"myGroup"!=type){a.push({switchCol:{colName:"status",colVals:["actived"],colLables:["强制下线"],btnClasses:["btn btn-warning employeeForceLogout"],}});
}if(ResUtils.canShow("employee.button.cancel")&&"myGroup"!=type){a.push({switchCol:{colName:"status",colVals:["actived"],colLables:["注销"],btnClasses:["btn btn-danger employeeCancel"],}});
}if(ResUtils.canShow("employee.button.delete")&&"myGroup"!=type){a.push({switchCol:{colName:"status",colVals:["actived","inactive"],colLables:["删除","删除"],btnClasses:["btn btn-danger employeeDel","btn btn-danger employeeDel"],iconClasses:["fa fa-remove","fa fa-remove"]}});
}return a;},};