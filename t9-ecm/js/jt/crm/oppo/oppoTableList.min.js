function OppoEntityList(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.params="";this.coId="";this.oppoTable=null;}OppoEntityList._CONS_={EDIT_URL:ctx+"/crm/oppo/oppoRecord/edit.htm",DETAIL_URL:ctx+"/crm/oppo/oppoRecord/detail.htm",DELETE_URL:ctx+"/crm/oppo/oppoEntity/delete.htm",SAVE_ADD_URL:ctx+"/crm/oppo/oppoRecord/saveAdd.htm",SAVE_EDIT_URL:ctx+"/crm/oppo/oppoRecord/saveEdit.htm",LIST_ENTITY_DATA_URL:ctx+"/crm/oppo/oppoEntity/listData.htm",LIST_ENTITY_BY_CS_URL:ctx+"/crm/oppo/oppoEntity/findByCsId.htm",UPDATE_STAGE_URL:ctx+"/crm/oppo/oppoEntity/updateStage.htm",EDIT_FORM_ID:"oppoRecordForm",GRID:"#oppoRecordGrid",PAGER:"#oppoRecordPager"};
OppoEntityList.prototype={initInfo:function(){if(!this.hadInit){this.hadInit=true;this._bindEventHander();}},reloadEntityList:function(c,b){var a=this;
a.coId=b;a.params=c;FormUtils.submit(OppoEntityList._CONS_.LIST_ENTITY_BY_CS_URL+"?coId="+b,null,function(d){a._dealEntityRows(d.data);},null,true);},_dealEntityRows:function(b){var c=this;
var f=new StringBuffer();for(var d=0;d<b.length;d++){var e=b[d];var a=c._dealEntity2(e);f.append(a);}$("#oppoContainer").empty().append(f.toString());},_dealEntity2:function(b){var i=this;
var g=new StringBuffer();g.append('<tr class="oppo-row" idVal="'+b.id+'">');g.append('<td class="td">');g.append(b.key);g.append("</td>");g.append('<td class="td ellipsis-class">');
g.append(b.name);g.append("</td>");g.append('<td class="td">');var f="";switch(b.stage){case"begin":f='<label type="lable" class="label label-default">挖掘商机</label>';
break;case"interest":f='<label type="lable" class="label label-warning">确定客户意向</label>';break;case"project":f='<label type="lable" class="label label-warning">引导客户立项</label>';
break;case"agree":f='<label type="lable" class="label label-success">赢得客户认可</label>';break;case"discuss":f='<label type="lable" class="label label-success">进行商务谈判</label>';
break;case"win":f='<label type="lable" class="label label-info">赢单</label>';break;case"lost":f='<label type="lable" class="label label-danger">丢单</label>';
break;}g.append(f);g.append("</td>");g.append('<td class="td">');var d="";var e=new StringBuffer();switch(b.interest){case 1:e.append('<label type="lable" class="label label-default">');
e.append("很小");break;case 2:e.append('<label type="lable" class="label label-warning">');e.append("普通");break;case 3:e.append('<label type="lable" class="label label-info">');
e.append("较大");break;case 4:e.append('<label type="lable" class="label label-info">');e.append("很大");break;}e.append("</label>");d=e.toString();g.append(d);
g.append("</td>");g.append('<td class="td">');var a="";switch(b.srcType){case"qq":a="QQ";break;case"wechart":a="微信";break;case"tel":a="电话";break;case"other":a="其它";
break;}g.append(a);g.append("</td>");g.append('<td class="td">');g.append(b.profitRange);g.append("</td>");g.append('<td class="td">');var c="";var h=new StringBuffer();
if(b.rate===1){h.append('<label type="lable" class="label label-default">');h.append("很小");h.append("</label>");}else{if(b.rate===2){h.append('<label type="lable" class="label label-warning">');
h.append("普通");h.append("</label>");}else{if(b.rate===3){h.append('<label type="lable" class="label label-info">');h.append("较大");h.append("</label>");
}else{if(b.rate===4){h.append('<label type="lable" class="label label-info">');h.append("很大");h.append("</label>");}}}}c=h.toString();g.append(c);g.append("</td>");
g.append('<td class="td">');g.append(b.endTime);g.append("</td>");g.append("<td >");g.append(i._dealOperateBtn(b.id,b.stage));g.append("</td>");return g.toString();
},_dealOperateBtn:function(e,b){var d=new StringBuffer();d.append('<div class="btn-group operation">');d.append('<button data-toggle="dropdown" class="btn btn-default dropdown-toggle ">操作 <span class="caret"></span>');
d.append("</button>");d.append('<ul class="dropdown-menu">');d.append("<li>");d.append('<button type="button" class="btn btn-outline btn-danger delete-oppo" idVal="'+e+'" >删除</button>');
d.append("</li>");d.append("<li>");d.append('<button type="button" class="btn btn-outline btn-primary detail-oppo" idVal="'+e+'" >编辑</button>');d.append("</li>");
if(b!="win"&&b!="lost"){var a="";var c="";switch(b){case"":a="begin";c="挖掘商机";break;case"begin":a="interest";c="确定客户意向";break;case"interest":a="project";
c="引导客户立项";break;case"project":a="agree";c="赢得客户认可";break;case"agree":a="discuss";c="进行商务谈判";break;}if(a){d.append("<li>");d.append('<button type="button" next-stage="'+a+'" current-statge="'+b+'" class="btn btn-outline btn-primary push-oppo" idVal="'+e+'" >推进</button>');
d.append("</li>");}if(b!="lost"||b!="win"){if(b!="lost"){d.append("<li>");d.append('<button type="button"  next-stage="lost"  current-statge="'+b+'" class="btn btn-outline btn-primary push-oppo" idVal="'+e+'" >丢单</button>');
d.append("</li>");}if(b!="win"){d.append("<li>");d.append('<button type="button"  next-stage="win"  current-statge="'+b+'" class="btn btn-outline btn-primary push-oppo" idVal="'+e+'" >赢单</button>');
d.append("</li>");}}}d.append("</ul>");d.append("</div>");return d.toString();},_bindEventHander:function(){var a=this;$("body").on("click",".add-oppo-record",function(){var b=$("[name=content]").val();
a._saveOppoRecord();});$("body").on("click",".detail-oppo",function(){var b=$(this).attr("idVal");if(!b){$(this).parent().attr("idVal");}layer.open({title:["商机详情","text-align:center;"],type:2,area:["85%","90%"],fix:false,maxmin:true,scrollbar:false,content:ctx+"/crm/oppo/oppoEntity/openOppoDetail.htm?id="+b,end:function(){a.reloadEntityList(a.params,a.coId);
}});});$("body").on("click",".delete-oppo",function(c){var b=$(this).attr("idVal");a._delete(b);c.stopPropagation();});$("body").on("click",".push-oppo",function(c){var d=new StringBuffer();
var b=$(this).attr("next-stage");var f=$(this).attr("idVal");d.append("stage="+b);d.append("&ids="+f);d=d.toString();FormUtils.submit(OppoEntityList._CONS_.UPDATE_STAGE_URL,d,function(e){if(e.success){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
a.reloadEntityList(a.params,a.coId);}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);}});});$("body").on("click",".add-entity-oppo",function(){var b=a.coId;
layer.open({title:["添加商机","text-align:center;"],type:2,area:["85%","90%"],fix:false,maxmin:true,scrollbar:false,content:ctx+"/crm/oppo/oppoEntity/oppoEntityAdd.htm.htm?coId="+b,end:function(){a.reloadEntityList(a.params,a.coId);
}});});},init:function(a){if(!this.hadInit){this.hadInit=true;this._bindFormValidation();this._bindEventHander();this._initJqgrid(a);this._hideNotGrantBtn();
}},_hideNotGrantBtn:function(){},_delete:function(b){var a=this;DialogUtils.confirm(function(){FormUtils.del(OppoEntityList._CONS_.DELETE_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,msgCode.DELETE_MSG);
a.reloadEntityList(a.params);}else{DialogUtils.error(msgCode.ERROR,c.msg);}});});},};