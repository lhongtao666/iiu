$(function(){var a=new SoBackReasonReport();a.init();});function SoBackReasonReport(){this.hadInit=false;}SoBackReasonReport._CONS_={LIST_DATA_URL:ctx+"/crm/report/soStatisticsReport/findSoBackReport.htm",EXPORT_URL:ctx+"/crm/report/soStatisticsReport/exportBackReport.htm",};
SoBackReasonReport.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();$(".minCreateTime").val(new Date().currentDate());
$(".maxCreateTime").val(new Date().currentDate());a._initJqgrid();ShipCompanyUtils.getOptions({container:"scCodeQry",caption:"全部"});}},_bindEventHander:function(){var a=this;
$("body").on("click","#searchBtn",function(){a._initJqgrid();});$("body").on("click","#todayBtn",function(){$(".minCreateTime").val(new Date().currentDate());
$(".maxCreateTime").val(new Date().currentDate());a._initJqgrid();});$("body").on("click","#yesterdayBtn",function(){$(".minCreateTime").val(new Date(new Date().getTime()-1*24*60*60*1000).currentDate());
$(".maxCreateTime").val(new Date(new Date().getTime()-1*24*60*60*1000).currentDate());a._initJqgrid();});$("body").on("click","#sevendayBtn",function(){$(".minCreateTime").val(new Date(new Date().getTime()-7*24*60*60*1000).currentDate());
$(".maxCreateTime").val(new Date().currentDate());a._initJqgrid();});$("body").on("click","#thirtyBtn",function(){$(".minCreateTime").val(new Date(new Date().getTime()-30*24*60*60*1000).currentDate());
$(".maxCreateTime").val(new Date().currentDate());a._initJqgrid();});$("body").on("click","#monthBtn",function(){var b=new Date();b.setDate(1);$(".minCreateTime").val(b.currentDate());
$(".maxCreateTime").val(new Date().currentDate());a._initJqgrid();});$("body").on("click","#exportBtn",function(){var b=$("#soBackReasonReportSearchForm").serialize();
ButtonUtils.disableBtn("exportBtn");FormUtils.submit(SoBackReasonReport._CONS_.EXPORT_URL,b,function(c){ButtonUtils.enableBtn("exportBtn");if(c.success){DialogUtils.success(msgCode.INFO,c.msg+"成功");
}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},function(){ButtonUtils.enableBtn("exportBtn");DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});
});$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",fn:function(c,d){$("input[name=belongOgn]").val(d);
}};GroupUtils.selectGroupTreeBox(b);});$("body").on("click",".history",function(){var d=$(this).attr("reason");var b=$(".minCreateTime").val();var c=$(".maxCreateTime").val();
return;JTTabUtils.addOrRefreshTab(ctx+"/crm/report/soEntityReport/soBackReasonReport/history.htm?beginTime="+b+"&endTime="+c,"退货原因历史详情");});},_initJqgrid:function(){var b=$("#soBackReasonReportSearchForm").serialize();
var a=SoBackReasonReport._CONS_.LIST_DATA_URL+"?"+b;FormUtils.loadData(a,function(c){$("#ship-total").empty();$("#back-total").empty();$("#back-rate").empty();
$("#soBackReasonReportGrid").find("tbody").empty();var k=new StringBuffer();var e=0;var h=0;var d="";var g="";if(c.length<=0){return;}for(var f=0;f<c.length;
f++){var j=c[f];k.append("<tr>").append("<td></td>").append("<td>").append(j.reasonLarge).append("</td>").append("<td>").append(j.reason).append("</td>").append("<td>").append(j.shipStr).append("</td>").append("<td>").append("<a href='#' class='history' reason='"+j.reason+"'> "+j.backStr+"</a>").append("</td>").append("<td>").append(j.backRate).append("</td>").append("</tr>");
e+=j.backCount;h+=parseFloat(j.backAmount);shipStr=j.shipStr;g=j.shipCount;}$("#soBackReasonReportGrid").find("tbody").empty().append(k.toString());$("#ship-total").append(shipStr);
$("#back-total").append(e+"/"+h.toFixed(2));$("#back-rate").append((e*100/g).toFixed(2)+"%");});}};