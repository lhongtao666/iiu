$(function(){var a=new SaleProdReport();a.init();});function SaleProdReport(){this.hadInit=false;this.isEdit=false;}SaleProdReport._CONS_={SO_LIST_URL:ctx+"/ec/salesorder/soEntity/listSaleProdData.htm",EXPORT_URL:ctx+"/crm/report/performanceForEmpReport/exportProdSaleReport.htm",GRID:"#saleProdReportGrid",PAGER:"#saleProdReportPager",FORM:"saleProdSearchFrom"};
SaleProdReport.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();ReportDateUtil.initDate(".report-content");$("#"+SaleProdReport._CONS_.FORM).find("#timeTypeSearch").val("month");
$("#timeTypeSearch").change();if($(".sign").val()=="1"){$(".sign").attr("disabled",true);}else{$(".place").attr("disabled",true);}}},_bindEventHander:function(){var a=this;
$(document).on("click",".prodSaleStatistic",function(){if(!a.isEdit){var b=$(this).closest("form").serialize();a._initJqgrid(a.toPostParam(b));a.isEdit=true;
}});$(".report-content").off("click","#saleProdReportSearchBtn");$(".report-content").on("click","#saleProdReportSearchBtn",function(){a.reloadJqgrid(a.toPostParam($(this).closest("form").serialize()));
});$("#saleGroupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"saleGroupName",positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
}};GroupUtils.selectGroupTreeBox(b);});$("#cateName").on("click",function(){CateUtils.selectCateTreeBox({isMultiple:0,typeKey:"product_catalog",pKey:"category",selectedCateIds:$('input[name="Q__S__EQ__cate_id_"]').val(),container:"cateName",fn:function(b){$('input[name="Q__S__EQ__cate_id_"]').val(b);
}});});$(document).on("click",".detail",function(){var c=$(this).attr("value");var f={};if($("input[name=belongOgn]").val()){f.belongOgn=$("input[name=belongOgn]").val();
}if($("input[name=Q__S__EQ__cate_id_]").val()){f.Q__S__EQ__cate_id_=$("input[name=Q__S__EQ__cate_id_]").val();}f.Q__S__EQ__sku_key_=c;if($(".sign").val()=="1"){f.timeType="sign";
}else{f.timeType="place";}var e=ReportDateUtil.getStartDateTimeRangeStr();var b=ReportDateUtil.getEndDateTimeRangeStr();var d="/crm/report/soStatisticsReport/detail.htm?paramsDetail="+encodeURIComponent(JSON.stringify(f))+"&timeStart="+e+"&timeEnd="+b;
JTTabUtils.addOrRefreshTab(ctx+d,"款号为"+c+"的订单明细");});$(".prodSaleExportExcel").on("click",function(){ButtonUtils.disableBtn("exportExcel");FormUtils.submit(SaleProdReport._CONS_.EXPORT_URL,a.toPostParam(),function(b){ButtonUtils.enableBtn("exportExcel");
if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(SaleProdReport._CONS_.GRID,a);},_initJqgrid:function(a){$(SaleProdReport._CONS_.GRID).JTJqgrid({url:SaleProdReport._CONS_.SO_LIST_URL,postData:a,pager:SaleProdReport._CONS_.PAGER,multiselect:false,colNames:["产品名称","款号","销售数量","订单数量","购买客户数"],colModel:[{name:"prodName",index:"prodName",sortable:false},{name:"skuKey",index:"item.sku_key_"},{name:"count",index:"count",sortable:false},{name:"soCount",index:"soCount",sortable:false,formatter:function(b,c,d){return"<a href='#' class='detail' value='"+d.skuKey+"'>"+d.soCount+"</a>";
}},{name:"csCount",index:"csCount",sortable:false}],loadComplete:function(){$("#saleProdReportGrid").setGridWidth($(window).width()-20);$(window).resize(function(){$("#saleProdReportGrid").setGridWidth($(window).width()-20);
});}});},toPostParam:function(b){var b=$("#"+SaleProdReport._CONS_.FORM).serialize();var a=$("#timeType").val();if("ship"==a){b+="&Q__D__BW__entity.ship_time_="+ReportDateUtil.getDateTimeRangeStr($("#"+SaleProdReport._CONS_.FORM));
b+="&timeType=ship";}else{if("sign"==a){b+="&Q__D__BW__entity.complete_time_="+ReportDateUtil.getDateTimeRangeStr($("#"+SaleProdReport._CONS_.FORM));b+="&timeType=sign";
}else{b+="&Q__D__BW__entity.create_time_="+ReportDateUtil.getDateTimeRangeStr($("#"+SaleProdReport._CONS_.FORM));b+="&timeType=place";}}b+="&reportType="+$("input[name=reportKey]").val();
return b;}};