$(function(){var a=new SoBackProdReport();a.init();});function SoBackProdReport(){this.hadInit=false;}SoBackProdReport._CONS_={LIST_DATA_URL:ctx+"/crm/report/soStatisticsReport/findBackProdReport.htm",EXPORT_URL:ctx+"/crm/report/soStatisticsReport/exportBackProdReport.htm",LIST_BACK_HISTORY_URL:ctx+"/crm/report/soStatisticsReport/listBackProdHistory.htm",};
SoBackProdReport.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();$(".minCreateTime").val(new Date().currentDate());
$(".maxCreateTime").val(new Date().currentDate());a._initJqgrid();}},_bindEventHander:function(){var a=this;$("body").on("click","#prevBtn",function(){$(".list_data_wrap").show();
$(".history_data_wrap").hide();});$("body").on("click","#searchBtn",function(){a._initJqgrid();});$("body").on("click","#todayBtn",function(){$(".minCreateTime").val(new Date().currentDate());
$(".maxCreateTime").val(new Date().currentDate());a._initJqgrid();});$("body").on("click","#yesterdayBtn",function(){$(".minCreateTime").val(new Date(new Date().getTime()-1*24*60*60*1000).currentDate());
$(".maxCreateTime").val(new Date(new Date().getTime()-1*24*60*60*1000).currentDate());a._initJqgrid();});$("body").on("click","#sevendayBtn",function(){$(".minCreateTime").val(new Date(new Date().getTime()-7*24*60*60*1000).currentDate());
$(".maxCreateTime").val(new Date().currentDate());a._initJqgrid();});$("body").on("click","#thirtyBtn",function(){$(".minCreateTime").val(new Date(new Date().getTime()-30*24*60*60*1000).currentDate());
$(".maxCreateTime").val(new Date().currentDate());a._initJqgrid();});$("body").on("click","#monthBtn",function(){var b=new Date();b.setDate(1);$(".minCreateTime").val(b.currentDate());
$(".maxCreateTime").val(new Date().currentDate());a._initJqgrid();});$("body").on("click","#exportBtn",function(){var b=$("#soBackProdReportSearchForm").serialize();
ButtonUtils.disableBtn("exportBtn");FormUtils.submit(SoBackProdReport._CONS_.EXPORT_URL,b,function(c){ButtonUtils.enableBtn("exportBtn");if(c.success){DialogUtils.success(msgCode.INFO,c.msg+"成功");
}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},function(){ButtonUtils.enableBtn("exportBtn");DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});
});$("body").on("click",".history",function(){var e=$(this).attr("cate-id");var c=$(this).attr("prod-name");var b=$(".minCreateTime").val();var d=$(".maxCreateTime").val();
JTTabUtils.addOrRefreshTab(ctx+"/crm/report/soEntityReport/soBackProdReport/history.htm?cateId="+e+"&prodName="+encodeURI(c)+"&beginTime="+b+"&endTime="+d,"退货产品历史详情");
});},_showHistory:function(d,b){$(".list_data_wrap").hide();$(".history_data_wrap").show();$("#soBackProdReportHistoryGrid").find("tbody").empty();$("#histtory-back-total").empty();
var c="cateId="+d+"&prodName="+encodeURI(b);var a=SoBackProdReport._CONS_.LIST_BACK_HISTORY_URL+"?"+c;FormUtils.loadData(a,function(e){var g=0;var j=new StringBuffer();
for(var f=0;f<e.length;f++){var h=e[f];j.append("<tr>").append("<td></td>").append("<td>").append(h.soNo).append("</td>").append("<td>").append(h.skuKey).append("</td>").append("<td>").append(h.prodName).append("</td>").append("<td>").append(h.price).append("</td>").append("<td>").append(h.count).append("</td>").append("<td>").append(h.time).append("</td>").append("</tr>");
g++;}$("#soBackProdReportHistoryGrid").find("tbody").append(j.toString());$("#histtory-back-total").append(g);});},_initJqgrid:function(){var b=$("#soBackProdReportSearchForm").serialize();
var a=SoBackProdReport._CONS_.LIST_DATA_URL+"?"+b;FormUtils.loadData(a,function(c){$("#back-total").empty();$("#soBackProdReportGrid").find("tbody").empty();
var j=new StringBuffer();var e=0;var g=0;var d="";if(c.length<=0){return;}e=c[0].count;g=parseFloat(c[0].amount);for(var f=0;f<c.length;f++){var h=c[f];
j.append("<tr>").append("<td></td>").append("<td>").append(h.cateName).append("</td>").append("<td>").append(h.prodName).append("</td>").append("<td>").append(h.backStr).append("</td>").append("<td>").append("<button class='btn btn-sm btn-primary history' cate-id='"+h.cateId+"' prod-name='"+h.prodName+"'>历史</button>").append("</td>").append("</tr>");
}$("#soBackProdReportGrid").find("tbody").empty().append(j.toString());$("#back-total").append(e+"/"+g.toFixed(2));});}};