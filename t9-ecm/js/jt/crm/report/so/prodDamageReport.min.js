$(function(){var a=new ProdDamageReport();a.init();});function ProdDamageReport(){this.hadInit=false;this.isEdit=false;}ProdDamageReport._CONS_={SO_LIST_URL:ctx+"/ec/salesorder/soEntity/prodDamageData.htm",EXPORT_URL:ctx+"/crm/report/performanceForEmpReport/exportProdDamageReport.htm",GRID:"#prodDamageReportGrid",PAGER:"#prodDamageReportPager",FORM:"prodDamageSearchForm"};
ProdDamageReport.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();ReportDateUtil.initDate(".report-content");$("#timeTypeSearch").change();
CateUtils.getOptions([{typeKey:"system",pKey:"damageType",container:"damageType"},{typeKey:"system",pKey:"damageReason",container:"damageReason"}]);a._initJqgrid(a.toPostParam());
}},_bindEventHander:function(){var a=this;$(".report-content").off("click","#searchBtn");$(".report-content").on("click","#searchBtn",function(){a.reloadJqgrid(a.toPostParam());
});$("#cateName").on("click",function(){CateUtils.selectCateTreeBox({isMultiple:0,typeKey:"product_catalog",pKey:"category",selectedCateIds:$('input[name="Q__S__EQ__cate_id_"]').val(),container:"cateName",fn:function(b){$('input[name="Q__S__EQ__cate_id_"]').val(b);
}});});$(".exportExcel").on("click",function(){ButtonUtils.disableBtn("exportExcel");FormUtils.submit(ProdDamageReport._CONS_.EXPORT_URL,a.toPostParam(),function(b){ButtonUtils.enableBtn("exportExcel");
if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(ProdDamageReport._CONS_.GRID,a);},_initJqgrid:function(a){$(ProdDamageReport._CONS_.GRID).JTJqgrid({url:ProdDamageReport._CONS_.SO_LIST_URL,postData:a,pager:ProdDamageReport._CONS_.PAGER,multiselect:false,hidegrid:false,colNames:["产品名称","销售量","破损量","破损原因","破损程度","破损率"],colModel:[{name:"prodName",width:90,index:"prod_name_"},{name:"count",width:90,index:"count_"},{name:"damageCount",width:90,index:"damage_count_"},{name:"damageReason",width:90,index:"damage_reason_"},{name:"damageType",width:80,index:"damage_type_"},{name:"damageOdds",width:90,index:"damageOdds",formatter:function(b,c,d){return(d.damageOdds*100).toFixed(0)+"%";
}},],});},toPostParam:function(){var b=$("#"+ProdDamageReport._CONS_.FORM).serialize();var a=$("#damageOdds").val();if(a){if(a=="3"){b+="&minDamageOdds=0";
b+="&maxDamageOdds=0.3";}else{if(a=="5"){b+="&minDamageOdds=0.3";b+="&maxDamageOdds=0.5";}else{if(a=="8"){b+="&minDamageOdds=0.5";b+="&maxDamageOdds=0.8";
}else{if(a=="10"){b+="&minDamageOdds=0.8";b+="&maxDamageOdds=1";}}}}}b+="&Q__D__BW__item.update_time_="+ReportDateUtil.getDateTimeRangeStr();b+="&reportType="+$("input[name=reportKey]").val();
return b;}};