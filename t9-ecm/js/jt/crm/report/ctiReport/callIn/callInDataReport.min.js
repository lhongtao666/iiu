$(function(){var a=new CallInDataReport();a.init();});function CallInDataReport(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}CallInDataReport._CONS_={LIST_DATA_URL:ctx+"/crm/report/callInData/listData.htm",GRID:"#callInDataReportGrid",PAGER:"#callInDataReportPager",};
CallInDataReport.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._initJqgrid();this._initEmployeeSelect("");
}},_initEmployeeSelect:function(a){FormUtils.loadData(ctx+"/crm/ou/employee/listEmployees.htm?groupId="+a+"&type=dept_manager",function(c){$("#agentId").empty();
var d=new StringBuffer();d.append("<option value=''>请选择</option>");if(c&&c.length){for(var b=0;b<c.length;b++){d.append("<option value='"+c[b].aid+"'>"+c[b].aid+":"+c[b].name+"</option>");
}}$("#agentId").append(d.toString()).select2();},null,true);},_bindEventHander:function(){var a=this;$(document).on("click","#orgName",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$("#orgId").val(),container:"orgName",fn:function(b){a._initEmployeeSelect(b);
$("#orgId").val(b);}});});$(document).on("click",".adnRecordSearch",function(){var b={startTime:$("input[name='startTime']").val(),endTime:$("input[name='endTime']").val(),orgId:$("#orgId").val(),agentId:$("#agentId option:selected").val(),};
a._reloadJqgird(b);});$(document).on("click",".openAgentIdDetail",function(){var e={agentId:$(this).attr("agentId"),startTime:$("input[name='startTime']").val(),endTime:$("input[name='endTime']").val(),};
var c=$(this).attr("IsCallOk");if(c!=null&&c!=undefined){e.IsCallOk=c;}var d=$(this).attr("Duration");if(d){e.Duration=d;}var b=$.param(e);JTTabUtils.addOrRefreshTab(ctx+"/gl/cti/tRKSheetRecord/listRecord.htm?reqType=ctiReport&adnStaticReqParamStr="+encodeURIComponent(b),"工号["+$(this).attr("agentId")+"]记录");
});},_reloadJqgird:function(a){JTJqgridUtils.reloadJqgrid(CallInDataReport._CONS_.GRID,a);},_initJqgrid:function(){var b=this;var c=new Date().currentDate()+" 00:00:00";
var a=new Date().currentDate()+" 23:59:59";$("input[name=startTime]").val(c);$("input[name=endTime]").val(a);var d={startTime:c,endTime:a};$(CallInDataReport._CONS_.GRID).JTJqgrid({url:CallInDataReport._CONS_.LIST_DATA_URL,postData:d,rowNum:10000,footerrow:true,multiselect:false,colNames:[" ","员工","部门","呼入总电话量","20s内接听量","人工呼损电话量","总时长","大于小时呼叫数","服务水平","一次性解决率"],colModel:[{name:"id",width:10,index:""},{modelName:"agentId",name:"agentId",index:"agentId",width:120,formatter:function(e,f,g){return e+":"+g.empName;
}},{modelName:"groupName",name:"groupName",index:"groupName",width:90},{modelName:"callInTotal",name:"callInTotal",index:"callInTotal",width:90},{modelName:"lessTwentyTotal",name:"lessTwentyTotal",index:"lessTwentyTotal",width:120},{modelName:"failCallTotal",name:"failCallTotal",index:"failCallTotal",width:120},{modelName:"durationLength",name:"durationLength",index:"durationLength",width:120,formatter:function(e,f,g){return DateUtils.toChineseTime(e);
}},{modelName:"moreHourTotal",name:"moreHourTotal",index:"moreHourTotal",width:120},{modelName:"serviceTotal",name:"serviceTotal",index:"serviceTotal",width:120,formatter:function(e,f,g){if(!parseInt(g.callInTotal)){return 0;
}return parseFloat(parseInt(g.lessTwentyTotal)/parseInt(g.callInTotal)*100).toFixed(2)+"%";}},{modelName:"anoTotal",name:"anoTotal",index:"anoTotal",width:120,formatter:function(e,f,g){if(!parseInt(g.callInTotal)){return 0;
}return parseFloat(parseInt(g.anoTotal)/parseInt(g.callInTotal)*100).toFixed(2)+"%";}}],beforeProcessing:function(e){b.footData=e.footData;},gridComplete:function(){if(b.footData){var e=b.footData;
$(CallInDataReport._CONS_.GRID).footerData("set",{agentId:"总计:",callInTotal:e.callInTotal,failCallTotal:e.failCallTotal,moreHourTotal:e.moreHourTotal,durationLength:DateUtils.toChineseTime(e.durationLength),lessTwentyTotal:e.lessTwentyTotal,serviceTotal:(parseInt(e.serviceTotal)&&parseInt(e.callInTotal))?parseFloat((parseInt(e.serviceTotal)/parseInt(e.callInTotal))*100).toFixed(2)+"%":0,},false);
}},});}};