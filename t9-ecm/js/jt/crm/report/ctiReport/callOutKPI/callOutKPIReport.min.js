$(function(){var a=new CallOutKPIReport();a.init();});function CallOutKPIReport(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}CallOutKPIReport._CONS_={LIST_DATA_URL:ctx+"/crm/report/callOutKPI/listData.htm",GRID:"#callOutKPIReportGrid",PAGER:"#callOutKPIReportPager",};
CallOutKPIReport.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._initJqgrid();}},_bindEventHander:function(){var a=this;
$(document).on("click","#orgName",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$("#orgId").val(),container:"orgName",fn:function(b){$("#orgId").val(b);
}});});$(document).on("click",".adnRecordSearch",function(){var b={startTime:$("input[name='startTime']").val(),endTime:$("input[name='endTime']").val(),orgId:$("#orgId").val(),ano:$("#ano").val(),};
a._reloadJqgird(b);});$(document).on("click",".openAnoDetail",function(){var e={ano:$(this).attr("ano"),startTime:$("input[name='startTime']").val(),endTime:$("input[name='endTime']").val(),};
var c=$(this).attr("IsCallOk");if(c!=null&&c!=undefined){e.IsCallOk=c;}var d=$(this).attr("Duration");if(d){e.Duration=d;}var b=$.param(e);JTTabUtils.addOrRefreshTab(ctx+"/gl/cti/tRKSheetRecord/listRecord.htm?reqType=ctiReport&adnStaticReqParamStr="+encodeURIComponent(b),"工号["+$(this).attr("ano")+"]记录");
});},_reloadJqgird:function(a){JTJqgridUtils.reloadJqgrid(CallOutKPIReport._CONS_.GRID,a);},_initJqgrid:function(){var b=this;var c=new Date().currentDate()+" 00:00:00";
var a=new Date().currentDate()+" 23:59:59";$("input[name=startTime]").val(c);$("input[name=endTime]").val(a);var d={startTime:c,endTime:a};$(CallOutKPIReport._CONS_.GRID).JTJqgrid({url:CallOutKPIReport._CONS_.LIST_DATA_URL,postData:d,rowNum:10000,viewrecords:true,footerrow:true,multiselect:false,userDataOnFooter:true,colNames:[" ","日期时间","主叫号码","呼通总量","接通总量","通话总时长","未通总量","10s通话量","10s通话率","接通率","放弃率","平均振铃时长","平均通话时长","最长通话时长"],colModel:[{name:"id",width:10,index:""},{modelName:"dateTime",name:"dateTime",index:"dateTime",width:100},{modelName:"ano",name:"ano",index:"ano",width:90},{modelName:"callOutTotal",name:"callOutTotal",index:"callOutTotal",width:90,formatter:function(e,f,g){return'<a type="button" class="openAnoDetail" ano="'+g.ano+'">'+e+"</a>";
}},{modelName:"successCallTotal",name:"successCallTotal",index:"successCallTotal",width:80,formatter:function(e,f,g){return'<a type="button" class="openAnoDetail" ano="'+g.ano+'" IsCallOk="1">'+e+"</a>";
}},{modelName:"callingLength",name:"callingLength",index:"callingLength",width:120,formatter:function(e,f,g){return DateUtils.toChineseTime(e);}},{modelName:"failCallTotal",name:"failCallTotal",index:"failCallTotal",width:80,formatter:function(e,f,g){return'<a type="button" class="openAnoDetail" ano="'+g.ano+'" IsCallOk="0">'+e+"</a>";
}},{modelName:"lessTenTotal",name:"lessTenTotal",index:"lessTenTotal",width:80,formatter:function(e,f,g){return'<a type="button" class="openAnoDetail" ano="'+g.ano+'" IsCallOk="1" Duration="10">'+e+"</a>";
}},{modelName:"lessTenTotalPercent",name:"lessTenTotalPercent",index:"lessTenTotalPercent",width:80,formatter:function(e,f,g){return parseFloat((parseInt(g.lessTenTotal)/parseInt(g.callOutTotal))*100).toFixed(2)+"%";
}},{modelName:"percent",name:"percent",index:"",width:80,formatter:function(e,f,g){return parseFloat((parseInt(g.successCallTotal)/parseInt(g.callOutTotal))*100).toFixed(2)+"%";
}},{modelName:"failPercent",name:"failPercent",index:"",width:80,formatter:function(e,f,g){return parseFloat((parseInt(g.failCallTotal)/parseInt(g.callOutTotal))*100).toFixed(2)+"%";
}},{modelName:"avgRingingLength",name:"avgRingingLength",index:"avgRingingLength",width:120,formatter:function(e,f,g){return DateUtils.toChineseTime(e);
}},{modelName:"avgCallingLength",name:"avgCallingLength",index:"avgCallingLength",width:120,formatter:function(e,f,g){return DateUtils.toChineseTime(e);
}},{modelName:"maxCallingLength",name:"maxCallingLength",index:"maxCallingLength",width:120,formatter:function(e,f,g){return DateUtils.toChineseTime(e);
}}],beforeProcessing:function(e){b.footData=e.footData;},gridComplete:function(){if(b.footData){var e=b.footData;$(CallOutKPIReport._CONS_.GRID).footerData("set",{dateTime:"总计:",callOutTotal:e.callOutTotal,successCallTotal:e.successCallTotal,callingLength:DateUtils.toChineseTime(e.callingLength),failCallTotal:e.failCallTotal,lessTenTotal:e.lessTenTotal,lessTenTotalPercent:(parseInt(e.lessTenTotal)&&parseInt(e.callOutTotal))?parseFloat((parseInt(e.lessTenTotal)/parseInt(e.callOutTotal))*100).toFixed(2)+"%":0,percent:(parseInt(e.successCallTotal)&&parseInt(e.callOutTotal))?parseFloat((parseInt(e.successCallTotal)/parseInt(e.callOutTotal))*100).toFixed(2)+"%":0,failPercent:(parseInt(e.failCallTotal)&&parseInt(e.callOutTotal))?parseFloat((parseInt(e.failCallTotal)/parseInt(e.callOutTotal))*100).toFixed(2)+"%":0,avgRingingLength:DateUtils.toChineseTime(e.avgRingingLength),avgCallingLength:DateUtils.toChineseTime(e.avgCallingLength),maxCallingLength:DateUtils.toChineseTime(e.maxCallingLength)},false);
}},});}};