$(function(){var a=new CallOutDataReport();a.init();});function CallOutDataReport(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}CallOutDataReport._CONS_={LIST_DATA_URL:ctx+"/crm/report/callOutData/listData.htm",GRID:"#callOutDataReportGrid",PAGER:"#callOutDataReportPager",};
CallOutDataReport.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._initJqgrid();this._initEmployeeSelect("");
}},_initEmployeeSelect:function(a){FormUtils.loadData(ctx+"/crm/ou/employee/listEmployees.htm?groupId="+a+"&type=dept_manager",function(c){$("#agentId").empty();
var d=new StringBuffer();d.append("<option value=''>请选择</option>");if(c&&c.length){for(var b=0;b<c.length;b++){d.append("<option value='"+c[b].aid+"'>"+c[b].aid+":"+c[b].name+"</option>");
}}$("#agentId").append(d.toString()).select2();},null,true);},_bindEventHander:function(){var a=this;$(document).on("click","#orgName",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$("#orgId").val(),container:"orgName",fn:function(b){a._initEmployeeSelect(b);
$("#orgId").val(b);}});});$(document).on("click",".adnRecordSearch",function(){var b={startTime:$("input[name='startTime']").val(),endTime:$("input[name='endTime']").val(),orgId:$("#orgId").val(),agentId:$("#agentId option:selected").val(),};
a._reloadJqgird(b);});$(document).on("click",".openAgentIdDetail",function(){var e={agentId:$(this).attr("agentId"),startTime:$("input[name='startTime']").val(),endTime:$("input[name='endTime']").val(),};
var c=$(this).attr("IsCallOk");if(c!=null&&c!=undefined){e.IsCallOk=c;}var d=$(this).attr("Duration");if(d){e.Duration=d;}var b=$.param(e);JTTabUtils.addOrRefreshTab(ctx+"/gl/cti/tRKSheetRecord/listRecord.htm?reqType=ctiReport&adnStaticReqParamStr="+encodeURIComponent(b),"工号["+$(this).attr("agentId")+"]记录");
});},_reloadJqgird:function(a){JTJqgridUtils.reloadJqgrid(CallOutDataReport._CONS_.GRID,a);},_initJqgrid:function(){var b=this;var c=new Date().currentDate()+" 00:00:00";
var a=new Date().currentDate()+" 23:59:59";$("input[name=startTime]").val(c);$("input[name=endTime]").val(a);var d={startTime:c,endTime:a};$(CallOutDataReport._CONS_.GRID).JTJqgrid({url:CallOutDataReport._CONS_.LIST_DATA_URL,postData:d,rowNum:10000,viewrecords:true,footerrow:true,multiselect:false,userDataOnFooter:true,colNames:[" ","员工","部门","呼通总量","呼出总时长","接通总量","通话总时长","未通总量","10s通话量","接通率","平均振铃时长","平均通话时长","最长通话时长"],colModel:[{name:"id",width:10,index:""},{modelName:"agentId",name:"agentId",index:"agentId",width:120,summaryType:"sum",summaryTpl:"部门分组总计：",formatter:function(e,f,g){return e+":"+g.empName;
}},{modelName:"groupName",name:"groupName",index:"groupName",width:90},{modelName:"callOutTotal",name:"callOutTotal",index:"callOutTotal",width:90,summaryType:"sum",summaryTpl:"<b>{0}</b>",formatter:function(e,f,g){return'<a type="button" class="openAgentIdDetail" agentId="'+g.agentId+'">'+e+"</a>";
}},{modelName:"durationLength",name:"durationLength",index:"durationLength",summaryType:"sum",summaryTpl:"<b>{0}</b>",width:120,formatter:function(e,f,g){return DateUtils.toChineseTime(e);
}},{modelName:"successCallTotal",name:"successCallTotal",index:"successCallTotal",summaryType:"sum",summaryTpl:"<b>{0}</b>",width:80,formatter:function(e,f,g){return'<a type="button" class="openAgentIdDetail" agentId="'+g.agentId+'" IsCallOk="1">'+e+"</a>";
}},{modelName:"callingLength",name:"callingLength",index:"callingLength",summaryType:"sum",summaryTpl:'<b style="color:black;">{0}</b>',width:120,formatter:function(e,f,g){return DateUtils.toChineseTime(e);
}},{modelName:"failCallTotal",name:"failCallTotal",index:"failCallTotal",width:80,summaryType:"sum",summaryTpl:'<b style="color:black;">{0}</b>',formatter:function(e,f,g){return'<a type="button" class="openAgentIdDetail" agentId="'+g.agentId+'" IsCallOk="0">'+e+"</a>";
}},{modelName:"lessTenTotal",name:"lessTenTotal",index:"lessTenTotal",width:80,summaryType:"sum",summaryTpl:'<b style="color:black;">{0}</b>',formatter:function(e,f,g){return'<a type="button" class="openAgentIdDetail" agentId="'+g.agentId+'" IsCallOk="1" Duration="10">'+e+"</a>";
}},{modelName:"percent",name:"percent",index:"",width:80,formatter:function(e,f,g){return parseFloat((parseInt(g.successCallTotal)/parseInt(g.callOutTotal))*100).toFixed(2)+"%";
}},{modelName:"avgRingingLength",name:"avgRingingLength",index:"avgRingingLength",summaryType:"avg",summaryTpl:"<b>{0}</b>",width:120,formatter:function(e,f,g){return DateUtils.toChineseTime(e);
}},{modelName:"avgCallingLength",name:"avgCallingLength",index:"avgCallingLength",summaryType:"avg",summaryTpl:"<b>{0}</b>",width:120,formatter:function(e,f,g){return DateUtils.toChineseTime(e);
}},{modelName:"maxCallingLength",name:"maxCallingLength",index:"maxCallingLength",summaryType:"max",summaryTpl:"<b>{0}</b>",width:120,formatter:function(e,f,g){return DateUtils.toChineseTime(e);
}}],beforeProcessing:function(e){b.footData=e.footData;},gridComplete:function(){if(b.footData){var e=b.footData;$(CallOutDataReport._CONS_.GRID).footerData("set",{agentId:"总计:",callOutTotal:e.callOutTotal,durationLength:DateUtils.toChineseTime(e.durationLength),successCallTotal:e.successCallTotal,callingLength:DateUtils.toChineseTime(e.callingLength),failCallTotal:e.failCallTotal,lessTenTotal:e.lessTenTotal,percent:(parseInt(e.successCallTotal)&&parseInt(e.callOutTotal))?parseFloat((parseInt(e.successCallTotal)/parseInt(e.callOutTotal))*100).toFixed(2)+"%":0,avgRingingLength:DateUtils.toChineseTime(e.avgRingingLength),avgCallingLength:DateUtils.toChineseTime(e.avgCallingLength),maxCallingLength:DateUtils.toChineseTime(e.maxCallingLength)},false);
}},grouping:true,groupingView:{groupField:["groupName"],groupSummary:[true],groupColumnShow:[true],groupText:['<b style="color:#1caf9a;font-size: 18px;">{0} - {1}条记录</b>'],groupCollapse:false,groupDataSorted:true,}});
}};