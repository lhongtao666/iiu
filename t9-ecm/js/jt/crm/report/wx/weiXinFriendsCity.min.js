$(function(){var a=new WeiXinFriendsCity();a.init();});function WeiXinFriendsCity(){this.hadInit=false;}WeiXinFriendsCity._CONS_={LIST_URL:ctx+"/crm/report/weiXinFriendsReport/listCityData.htm",GRID:"#weiXinFriendsCityGrid",};
WeiXinFriendsCity.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._initJqgrid({beginTime:beginTime,endTime:endTime,groupId:groupId,province:province});
}},_bindEventHander:function(){$(document).on("click",".showHistory",function(){var b=$(this).attr("value");var a={beginTime:beginTime,endTime:endTime,groupId:groupId,province:province,city:b};
JTTabUtils.addOrRefreshTab(ctx+"/crm/report/weiXinFriendsReport/toAreaHistory.htm?beginTime="+a.beginTime+"&endTime="+a.endTime+"&groupId="+a.groupId+"&province="+a.province+"&city="+a.city,a.city+"进粉历史");
});},_initJqgrid:function(a){$(WeiXinFriendsCity._CONS_.GRID).JTJqgrid({url:WeiXinFriendsCity._CONS_.LIST_URL,pager:"",postData:a,multiselect:false,rowNum:-1,footerrow:true,colNames:["地域","进粉数量","转化客户","转化率","历史"],colModel:[{name:"city",width:120,formatter:function(b,c,d){if(b==""||b==null){return"未知区域";
}else{if(b.indexOf("总计")!=-1){return b;}else{return d.province+","+b;}}}},{name:"count",width:120},{name:"csCount",width:120},{name:"rate",width:120},{name:"button",width:120,formatter:function(b,c,d){return"<a class='showHistory' value='"+d.city+"'>历史</a>";
}}],gridComplete:function(){var e=$(WeiXinFriendsCity._CONS_.GRID).jqGrid("getCol","count",true,"sum");var c=$(WeiXinFriendsCity._CONS_.GRID).jqGrid("getCol","csCount",true,"sum");
var d=c==0?0:(c*100/e).toFixed(0)+"%";var b=$(WeiXinFriendsCity._CONS_.GRID).jqGrid("getGridParam","records");$(WeiXinFriendsCity._CONS_.GRID).footerData("set",{"city":"总计：<span style='color:red;'>"+b+"</span>条","count":"<span style='color:red;'>"+e+"</span>","csCount":"<span style='color:red;'>"+c+"</span>","rate":"<span style='color:red;'>"+d+"</span>"});
var f=$(WeiXinFriendsCity._CONS_.GRID).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow");f.find("td").css({"font-weight":400});},});
}};