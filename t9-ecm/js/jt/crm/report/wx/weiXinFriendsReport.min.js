$(function(){var a=new WeiXinFriendsReport();a.init();});function WeiXinFriendsReport(){this.hadInit=false;this.hadInitCity=false;}WeiXinFriendsReport._CONS_={LIST_URL:ctx+"/crm/report/weiXinFriendsReport/listData.htm",LIST_CITY_URL:ctx+"/crm/report/weiXinFriendsReport/listCityData.htm",GRID:"#weiXinFriendsReportGrid",PAGER:"#weiXinFriendsReportPager",CITY_GRID:"#weiXinFriendsCityGrid",EXPORT_URL:ctx+"/crm/report/weiXinFriendsReport/exportExcel.htm",};
WeiXinFriendsReport.prototype={init:function(b){if(!this.hadInit){this.hadInit=true;this._bindEventHander();ReportDateUtil.initDate(".report-content");
$("#timeTypeSearch").change();var a=ReportDateUtil.getDateTimeRangeStr().split(",");this._initJqgrid({beginTime:a[0],endTime:a[1]});}},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(WeiXinFriendsReport._CONS_.GRID,a);
},_bindEventHander:function(){var a=this;$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='groupId']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",isSale:true,fn:function(c){$("#groupId").val(c);
}};GroupUtils.selectGroupTreeBox(b);});$("#searchBtn").on("click",function(){var b=ReportDateUtil.getDateTimeRangeStr().split(",");var c={beginTime:b[0],endTime:b[1],groupId:$("#groupId").val()};
a.reloadJqgrid(c);});$(".exportExcel").on("click",function(){a._exportExcel();});$(document).on("click",".showCityDetail",function(){var b=$(this).attr("value");
var c=ReportDateUtil.getDateTimeRangeStr().split(",");var d={beginTime:c[0],endTime:c[1],groupId:$("#groupId").val(),province:b};JTTabUtils.addOrRefreshTab(ctx+"/crm/report/weiXinFriendsReport/toCityList.htm?beginTime="+d.beginTime+"&endTime="+d.endTime+"&groupId="+d.groupId+"&province="+d.province,d.province+"进粉明细");
});$(document).on("click",".showHistory",function(){var b=$(this).attr("value");var c=ReportDateUtil.getDateTimeRangeStr().split(",");var d={beginTime:c[0],endTime:c[1],groupId:$("#groupId").val(),province:b};
JTTabUtils.addOrRefreshTab(ctx+"/crm/report/weiXinFriendsReport/toAreaHistory.htm?beginTime="+d.beginTime+"&endTime="+d.endTime+"&groupId="+d.groupId+"&province="+d.province,d.province+"进粉历史");
});},_initJqgrid:function(a){$(WeiXinFriendsReport._CONS_.GRID).JTJqgrid({url:WeiXinFriendsReport._CONS_.LIST_URL,pager:WeiXinFriendsReport._CONS_.PAGER,postData:a,multiselect:false,rowNum:-1,footerrow:true,colNames:["地域","进粉数量","转化客户","转化率","历史"],colModel:[{name:"province",width:120,formatter:function(b,c,d){if(b==""||b==null){return"未知区域";
}else{if(b.indexOf("总计")!=-1){return b;}else{return b+"【<a class='showCityDetail' value='"+b+"'>城市</a>】";}}}},{name:"count",width:120},{name:"csCount",width:120},{name:"rate",width:120},{name:"button",width:120,formatter:function(b,c,d){return"<a class='showHistory' value='"+d.province+"'>历史</a>";
}}],gridComplete:function(){var e=$(WeiXinFriendsReport._CONS_.GRID).jqGrid("getCol","count",true,"sum");var c=$(WeiXinFriendsReport._CONS_.GRID).jqGrid("getCol","csCount",true,"sum");
var d=c==0?0:(c*100/e).toFixed(0)+"%";var b=$(WeiXinFriendsReport._CONS_.GRID).jqGrid("getGridParam","records");$(WeiXinFriendsReport._CONS_.GRID).footerData("set",{"province":"总计：<span style='color:red;'>"+b+"</span>条","count":"<span style='color:red;'>"+e+"</span>","csCount":"<span style='color:red;'>"+c+"</span>","rate":"<span style='color:red;'>"+d+"</span>"});
var f=$(WeiXinFriendsReport._CONS_.GRID).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow");f.find("td").css({"font-weight":400});},});
},_exportExcel:function(){var a=ReportDateUtil.getDateTimeRangeStr().split(",");var b={beginTime:a[0],endTime:a[1],groupId:$("#groupId").val()};FormUtils.submit(WeiXinFriendsReport._CONS_.EXPORT_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,"导出中...");
}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},};