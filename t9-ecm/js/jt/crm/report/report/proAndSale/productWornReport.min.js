$(function(){var a=new ProductWorn();a.init();});function ProductWorn(){this.hadInit=false;this.isEdit=false;this.soTypeCatePos=null;this.type="pie";this.beginDate=beginDate;
this.endDate=endDate;}ProductWorn._CONS_={INDEX_URL:ctx+"/ec/salesorder/soEntity/getPieData.htm",};ProductWorn.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;
a._bindEventHander();$(".graphPieAmountBtn").attr("disabled",true);a._getData(a.toPostParam(),"pie");}},createReportChartByCount:function(c){var a=new Report();
for(var b=0;b<c.damageReason.length;b++){c.damageReason[b].damageReason=c.damageReason[b].damageReason+"("+c.damageReason[b].percent+")";}a.data=c.damageReason;
a.setLegend(true,null,"damageReason");a.initSeries([{type:"pie",colName:"damageNumber",legendName:"数量"}],"damageReason");a._initChart("productWornReportChart","产品破损原因图(破损总件数:"+c.totalCount+"件)");
},_bindEventHander:function(){var a=this;window.onmessage=function(f){var c=JSON.parse(f.data);if(c&&c.messageType=="reloadIframe"){var b=c.beginDate;var d=c.endDate;
a.beginDate=b;a.endDate=d;a._getData(a.toPostParam(),a.type);}};$("body").on("click","#searchBtn",function(){a._getData(a.toPostParam(),a.type);return false;
});$(".showMoreInfo").on("click",function(){JTTabUtils.addOrRefreshTab(ctx+"/crm/report/prodDamageReport/list.htm?reportKey=no","产品破损统计报表");});},_getData:function(a,c){var b=this;
$.ajax({type:"GET",url:ProductWorn._CONS_.INDEX_URL,data:a,contentType:"application/json",dataType:"json",success:function(d){if(c=="pie"){b.createReportChartByCount(d);
}else{if(c=="bar"){b.createBarReport(d);}else{if(c=="pieCount"){b.createReportChartByMoney(d);}}}},error:function(d){DialogUtils.error(msgCode.ERROR,d);
}});},toPostParam:function(){var a={};a.currentUserId=currentUserId;a.positionType="statistics,dept_manager";a.selectType="statistics";a["Q__D__BW__item.update_time_"]=this.beginDate+","+this.endDate;
return a;}};