$(function(){var a=new EmpFollowCsTaskCount();a.init();});function EmpFollowCsTaskCount(){this.hadInit=false;this.isEdit=false;}EmpFollowCsTaskCount._CONS_={LIST_DATA_URL:ctx+"/ou/csfollow/csfollowDayCount/listData.htm",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",EXPORT_URL:ctx+"/crm/report/performanceForEmpReport/empFollowCsTaskExport.htm",PAGER:"#empFollowCsTaskPager",GRID:"#empFollowCsTaskGrid",};
EmpFollowCsTaskCount.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();ReportDateUtil.initDate(".report-content");
$("#timeTypeSearch").change();a._initJqgrid();a._buildEmployeeSelect();}},_buildEmployeeSelect:function(b){var a=this;$.ajax({type:"GET",url:ctx+"/crm/ou/employee/listEmployees.htm"+"?groupId="+(b?b:""),contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(d){if(d&&d.length>0){var e=new StringBuffer();
e.append("<option value=''>请选择</option>");for(var c=0;c<d.length;c++){e.append("<option value='"+d[c].id+"'>"+d[c].aid+":"+d[c].name+"</option>");}$("#belongEmployee").empty().append(e.toString()).select2();
}}});},_bindEventHander:function(){var a=this;$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
FormUtils.loadData(EmpFollowCsTaskCount._CONS_.EMPLOYEE_LIST_URL+"?groupId="+c+"&type=statistics,dept_manager",function(e){var f=new StringBuffer();f.append('<option value="">请选择</option>');
for(var d=0;d<e.length;d++){f.append("<option value='"+e[d].id+"'>"+e[d].aid+":"+e[d].name+"</option>");}$("#belongEmployee").empty().append(f.toString());
});}};GroupUtils.selectGroupTreeBox(b);});$("#searchBtn").on("click",function(){a.reloadJqgrid(a.toPostParam());});$(document).on("click",".empFollowCsExportExcel",function(){ButtonUtils.disableBtn("empFollowCsExportExcel");
FormUtils.submit(EmpFollowCsTaskCount._CONS_.EXPORT_URL,a.toPostParam(),function(b){ButtonUtils.enableBtn("empFollowCsExportExcel");if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");
}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});},toPostParam:function(){var a=this;
var b=$("#empFollowCsTaskSearchForm").serialize();b+="&Q__D__BW__d.create_time_="+ReportDateUtil.getDateTimeRangeStr();return b;},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(EmpFollowCsTaskCount._CONS_.GRID,a);
},_buildEmployeeOption:function(a,b){FormUtils.loadData(EmpFollowCsTaskCount._CONS_.EMPLOYEE_LIST_URL,function(d){var e=new StringBuffer();for(var c=0;
c<d.length;c++){if(c==0){e.append("<option selected='selected' value='"+d[c].id+"'>"+d[c].name+":"+d[c].aid+"</option>");}else{e.append("<option value='"+d[c].id+"'>"+d[c].name+":"+d[c].aid+"</option>");
}}$("#selectEmployee").empty().append(e.toString());});},_initJqgrid:function(){var b={};var a=this;b="Q__D__BW__d.create_time_="+ReportDateUtil.getDateTimeRangeStr();
$(EmpFollowCsTaskCount._CONS_.GRID).JTJqgrid({url:EmpFollowCsTaskCount._CONS_.LIST_DATA_URL,pager:EmpFollowCsTaskCount._CONS_.PAGER,postData:b,multiselect:false,colNames:["部门","员工","任务总数","已跟进总数","完成率"],colModel:[{name:"groupName",align:"center",width:60},{name:"empName",align:"center",width:50,formatter:function(c,d,e){return e.empAid+":"+e.empName;
}},{name:"dayFollowCsSum",index:"day_follow_csSum_",align:"center",width:60,formatter:function(c,d,e){return e.csfollowSum;}},{name:"finishCount",align:"center",width:60},{name:"rate",align:"center",width:60}],loadComplete:function(){$(window).resize();
},gridComplete:function(){$(window).resize();},});}};