$(function(){var a=new CtiSatisfation();a.init();});function CtiSatisfation(){this.hadInit=false;this.isEdit=false;this.soTypeCatePos=null;this.type="pie";
this.beginDate=beginDate;this.endDate=endDate;}CtiSatisfation._CONS_={INDEX_URL:ctx+"/gl/cti/trkRecordCsReport/getPieData.htm",};CtiSatisfation.prototype={init:function(b){var a=this;
if(!a.hadInit){a.hadInit=true;a._bindEventHander();$(".graphPieAmountBtn").attr("disabled",true);a._getData(a.toPostParam(),"pie");}},createPieReport:function(f){var b=new Report();
var h=f.type;var d=[];var a=new Array(f.satisfationCount,f.normalCount,f.unsatisfationCount,f.noPJCount);for(var c=0;c<a.length;c++){var g={percent:0,name:"",typeCount:0,};
var e=0;if(a[c]!=0&&f.count!=0){e=(a[c]/f.count*100).toFixed(2)+"%";}else{e=0+"%";}g.percent=e;g.name=f.type[c];g.typeCount=a[c];g.name=g.name+"("+e+")";
d.push(g);}b.data=d;b.setLegend(true,null,"name");b.initSeries([{type:"pie",colName:"typeCount",legendName:"数量"}],"name");b._initChart("ctiSatisfationReportChart","通话满意度分布图(:"+f.count+"件)");
},_bindEventHander:function(){var a=this;window.onmessage=function(f){var c=JSON.parse(f.data);if(c&&c.messageType=="reloadIframe"){var b=c.beginDate;var d=c.endDate;
a.beginDate=b;a.endDate=d;a._getData(a.toPostParam(),a.type);}};$("body").on("click","#searchBtn",function(){a._getData(a.toPostParam(),a.type);return false;
});$("body").on("click","[name=groupName]",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$('input[name="groupId"]').val(),container:"groupName",fn:function(c,b){$('input[name="orgId"]').val(c);
$('input[name="orgKey"]').val(b);a._getData(a.toPostParam(),a.type);}});});$(".showMoreInfo").on("click",function(){JTTabUtils.addOrRefreshTab(ctx+"/gl/cti/trkRecordCsReport/toCsSatifactionReport.htm?reportKey=no","通话满意度报表");
});},_getData:function(a,c){var b=this;$.ajax({type:"GET",url:CtiSatisfation._CONS_.INDEX_URL,data:a,contentType:"application/json",dataType:"json",success:function(d){if(c=="pie"){b.createPieReport(d);
}else{if(c=="bar"){b.createBarReport(d);}else{if(c=="pieCount"){b.createPieCountReport(d);}}}},error:function(d){DialogUtils.error(msgCode.ERROR,d);}});
},toPostParam:function(){var b=this.beginDate;var a=this.endDate;var c={};c=$("#groupName").closest("form").serialize();c+="&startTime="+b;c+="&endTime="+a;
return c;}};