$(function(){var a=new InterestStatisticsReport();a.init();});function InterestStatisticsReport(){this.hadInit=false;this.isEdit=false;this.sortColumn="";
this.sortorder="";this.beginDate=beginDate;this.endDate=endDate;this.selectShowType="";this.selelctShowText="";}InterestStatisticsReport._CONS_={LIST_DATA_URL:ctx+"/ec/rp/reportProfit/listInterestData.htm",};
InterestStatisticsReport.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();a._getPieData(a.toPostParam());a.selectShowType=$("#showInterestListType option:selected").val();
}},_bindEventHander:function(){var a=this;$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
}};GroupUtils.selectGroupTreeBox(b);});$(".showMoreInfo").on("click",function(){JTTabUtils.addOrRefreshTab(ctx+"/crm/report/interestStatisticsReport/list.htm?reportKey=no","意向统计");
});window.onmessage=function(f){var c=JSON.parse(f.data);if(c&&c.messageType=="reloadIframe"){var b=c.beginDate;var d=c.endDate;a.beginDate=b;a.endDate=d;
a._getPieData(a.toPostParam());}};$("#showInterestListType").on("change",function(){a.selectShowType=$(this).val();a.selelctShowText=$("#showInterestListType option:selected").text();
a._getPieData(a.toPostParam());});},_getPieData:function(a){var b=this;$.ajax({type:"GET",url:InterestStatisticsReport._CONS_.LIST_DATA_URL,data:a,contentType:"application/json",dataType:"json",success:function(c){b.createReport(c.rows);
},error:function(c){DialogUtils.error(msgCode.ERROR,c);}});},createReport:function(a){var k=this;var e=k.selectShowType;var l=new Report();var b=0;var h=[];
if(a!=null&&a!=""){for(var c=0;c<a.length;c++){b=b+a[c][e];}if(k.selectShowType=="newCsCount"){for(var c=0;c<a.length;c++){var j=0;var g="";if(a[c].newCsCount!=0){j=(a[c].newCsCount/b*100).toFixed(0);
g=j+"%";}else{g=0+"%";continue;}if(j>0){a[c].aid=a[c].interest+"("+g+")";h.push(a[c]);}}l.data=h;l.setLegend(true,null,"aid");l.initSeries([{type:"pie",colName:"newCsCount",legendName:"数量"}],"aid");
l._initChart("interestStatisticsReportChart","客户数量饼图");}else{for(var c=0;c<a.length;c++){var f=0;var d="";if(a[c][e]!=0){f=(a[c][e]/b*100).toFixed(0);d=f+"%";
}else{d=0+"%";continue;}if(f>0){a[c].auditAmount=a[c].interest+"("+d+")";h.push(a[c]);}}l.data=h;l.setLegend(true,null,"auditAmount");l.initSeries([{type:"pie",colName:e,legendName:"金额(元)"}],"auditAmount");
l._initChart("interestStatisticsReportChart",k.selelctShowText+"金额饼图");}}else{l.data=a;l.setLegend(true,null,"aid");l.initSeries([{type:"pie",colName:"newCsCount",legendName:"数量"}],"aid");
l._initChart("interestStatisticsReportChart","客户数量饼图");}},toPostParam:function(){var a={};a["Q__D__BW__create_time_"]=this.beginDate+","+this.endDate;return a;
}};