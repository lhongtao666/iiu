$(function(){var a=new SoExpressRate();a.init();});function SoExpressRate(){this.hadInit=false;this.isEdit=false;this.soTypeCatePos=null;this.type="pie";
this.beginDate=beginDate;this.endDate=endDate;}SoExpressRate._CONS_={INDEX_URL:ctx+"/crm/report/reportEntity/expressRateReport.htm",};SoExpressRate.prototype={init:function(b){var a=this;
if(!a.hadInit){a.hadInit=true;a._bindEventHander();$(".graphPieAmountBtn").attr("disabled",true);a._getData(a.toPostParam(),"pie");}},createPieReport:function(d){var c=new Report();
var h=d.rows;var a=[];var f=["德邦快递","顺丰快递","EMS","其他"];var k=new Array(h[0].debanExpressCount,h[0].shunfengExpressCount,h[0].emsExpressCount,h[0].otherExpressCount);
var j=h[0].debanExpressCount+h[0].emsExpressCount+h[0].shunfengExpressCount+h[0].otherExpressCount;for(var e=0;e<4;e++){var b={percent:0,name:"",typeCount:0,};
var g=0;if(k[e]!=0&&j!=0){g=(k[e]/j*100).toFixed(2)+"%";}else{g=0+"%";}b.percent=g;b.name=f[e]+"("+g+")";b.typeCount=k[e];a.push(b);}c.data=a;c.setLegend(true,null,"name");
c.initSeries([{type:"pie",colName:"typeCount",legendName:"数量"}],"name");c._initChart("soExpressRateReportChart","快递占比分布图(快递总件数:"+j+"件)");},_bindEventHander:function(){var a=this;
window.onmessage=function(f){var c=JSON.parse(f.data);if(c&&c.messageType=="reloadIframe"){var b=c.beginDate;var d=c.endDate;a.beginDate=b;a.endDate=d;
a._getData(a.toPostParam(),a.type);}};$("body").on("click","#searchBtn",function(){a._getData(a.toPostParam(),a.type);return false;});$(".showMoreInfo").on("click",function(){JTTabUtils.addOrRefreshTab(ctx+"/crm/report/reportEntity/toExpressRateReport.htm?reportKey=no","订单统计");
});},_getData:function(a,c){var b=this;$.ajax({type:"GET",url:SoExpressRate._CONS_.INDEX_URL,data:a,contentType:"application/json",dataType:"json",success:function(d){if(c=="pie"){b.createPieReport(d);
}},error:function(d){DialogUtils.error(msgCode.ERROR,d);}});},toPostParam:function(){var a={};a.currentUserId=currentUserId;a.positionType="statistics,dept_manager";
a.startTime=this.beginDate;a.endTime=this.endDate;return a;}};