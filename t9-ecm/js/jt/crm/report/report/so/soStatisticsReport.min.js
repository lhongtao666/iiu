$(function(){var a=new SoStatisticsReport();a.init();});function SoStatisticsReport(){this.hadInit=false;this.isEdit=false;this.soTypeCatePos=null;this.type="pie";
this.beginDate=beginDate;this.endDate=endDate;}SoStatisticsReport._CONS_={INDEX_URL:ctx+"/crm/report/soStatisticsReport/getPieData.htm",};SoStatisticsReport.prototype={init:function(b){var a=this;
if(!a.hadInit){a.hadInit=true;a._bindEventHander();$(".graphPieAmountBtn").attr("disabled",true);a._getData(a.toPostParam(),"pie");}},createPieReport:function(c){var a=new Report();
for(var b=0;b<c.detailStatusVos.length;b++){c.detailStatusVos[b].statusName=c.detailStatusVos[b].statusName+"("+c.detailStatusVos[b].percent+")";}a.data=c.detailStatusVos;
a.setLegend(true,null,"statusName");a.initSeries([{type:"pie",colName:"statusAmount",legendName:"金额"}],"statusName");a._initChart("soStatisticsReportChart","订单状态分布图(总订单金额:"+c.totalAmount+"元)");
},createPieCountReport:function(c){var a=new Report();for(var b=0;b<c.detailStatusVos.length;b++){c.detailStatusVos[b].statusName=c.detailStatusVos[b].statusName+"("+c.detailStatusVos[b].countPercent+")";
}a.data=c.detailStatusVos;a.setLegend(true,null,"statusName");a.initSeries([{type:"pie",colName:"statusCount",legendName:"数量"}],"statusName");a._initChart("soStatisticsReportChart","订单状态分布图(总订单数:"+c.totalCount+"单)");
},createBarReport:function(c){var a=new Report();for(var b=0;b<c.detailStatusVos.length;b++){if(c.detailStatusVos[b].statusName=="包裹丢失"){c.detailStatusVos[b].statusName="丢失("+c.detailStatusVos[b].percent+")";
}else{if(c.detailStatusVos[b].statusName=="订单拒收"){c.detailStatusVos[b].statusName="拒收("+c.detailStatusVos[b].percent+")";}else{c.detailStatusVos[b].statusName=c.detailStatusVos[b].statusName+"("+c.detailStatusVos[b].percent+")";
}}}a.data=c.detailStatusVos;a.setLegend(true,null,"statusName");a.setBarSeriesStyle(true,"right","{c}");a.setGridX(100);a.initSeries([{type:"bar",colName:"statusAmount",legendName:"金额"},{type:"bar",colName:"statusCount",legendName:"数量"}],"statusName",null,"transverse");
a._initChart("soStatisticsReportChart","订单状态分布图(总订单金额:"+c.totalAmount+"元)");},_bindEventHander:function(){var a=this;window.onmessage=function(f){var c=JSON.parse(f.data);
if(c&&c.messageType=="reloadIframe"){var b=c.beginDate;var d=c.endDate;a.beginDate=b;a.endDate=d;a._getData(a.toPostParam(),a.type);}};$("body").on("click","#searchBtn",function(){a._getData(a.toPostParam(),a.type);
return false;});$("body").on("click",".graphPieAmountBtn",function(){$(".graphName").text("金额饼图");$(this).attr("disabled",true);$(".graphBarBtn").attr("disabled",false);
$(".graphPieCountBtn").attr("disabled",false);a.type="pie";a._getData(a.toPostParam(),"pie");});$("body").on("click",".graphPieCountBtn",function(){$(".graphName").text("数量饼图");
$(this).attr("disabled",true);$(".graphBarBtn").attr("disabled",false);$(".graphPieAmountBtn").attr("disabled",false);a.type="pieCount";a._getData(a.toPostParam(),"pieCount");
});$("body").on("click",".graphBarBtn",function(){$(".graphName").text("柱形图");$(this).attr("disabled",true);$(".graphPieCountBtn").attr("disabled",false);
$(".graphPieAmountBtn").attr("disabled",false);a.type="bar";a._getData(a.toPostParam(),"bar");});$(".showMoreInfo").on("click",function(){JTTabUtils.addOrRefreshTab(ctx+"/crm/report/soStatisticsReport/list.htm?reportKey=no","订单统计");
});},_getData:function(a,c){var b=this;$.ajax({type:"GET",url:SoStatisticsReport._CONS_.INDEX_URL,data:a,contentType:"application/json",dataType:"json",success:function(d){if(c=="pie"){b.createPieReport(d);
}else{if(c=="bar"){b.createBarReport(d);}else{if(c=="pieCount"){b.createPieCountReport(d);}}}},error:function(d){DialogUtils.error(msgCode.ERROR,d);}});
},toPostParam:function(){var a={};a.currentUserId=currentUserId;a.positionType="statistics,dept_manager";a["Q__S__NEQ__entity.so_type_"]="point";a.selectType="statistics";
a["Q__D__BW__entity.create_time_"]=this.beginDate+","+this.endDate;return a;}};