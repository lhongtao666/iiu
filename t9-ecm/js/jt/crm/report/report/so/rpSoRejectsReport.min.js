$(function(){var a=new RpSoRejectsReport();a.init();});function RpSoRejectsReport(){this.hadInit=false;this.isEdit=false;this.soTypeCatePos=null;this.type="pie";
this.beginDate=beginDate;this.endDate=endDate;}RpSoRejectsReport._CONS_={INDEX_URL:ctx+"/ec/rp/rpSoReject/getPieData.htm",};RpSoRejectsReport.prototype={init:function(b){var a=this;
if(!a.hadInit){a.hadInit=true;a._bindEventHander();$(".graphPieAmountBtn").attr("disabled",true);a._getData(a.toPostParam(),"pie");}},createReportChartByCount:function(c){var a=new Report();
for(var b=0;b<c.detailReasonVos.length;b++){c.detailReasonVos[b].rejectReason=c.detailReasonVos[b].rejectType+":"+c.detailReasonVos[b].rejectReason+"("+c.detailReasonVos[b].percent+")";
}a.data=c.detailReasonVos;a.setLegend(true,null,"rejectReason");a.initSeries([{type:"pie",colName:"reasonAmount",legendName:"金额"}],"rejectReason");a._initChart("rpSoRejectsReportChart","拒收原因图(按金额)(拒收总额:"+c.totalRejectAmount+"元)");
},createReportChartByMoney:function(c){var a=new Report();for(var b=0;b<c.detailReasonVos.length;b++){c.detailReasonVos[b].rejectReason=c.detailReasonVos[b].rejectType+":"+c.detailReasonVos[b].rejectReason+"("+c.detailReasonVos[b].countPercent+")";
}a.data=c.detailReasonVos;a.setLegend(true,null,"rejectReason");a.initSeries([{type:"pie",colName:"reasonCount",legendName:"数量"}],"rejectReason");a._initChart("rpSoRejectsReportChart","拒收原因图(按单数)(拒收总数:"+c.totalRejectCount+"件)");
},createBarReport:function(c){var a=new Report();for(var b=0;b<c.detailReasonVos.length;b++){if(c.detailReasonVos[b].rejectReason=="包裹丢失"){c.detailReasonVos[b].rejectReason="丢失("+c.detailReasonVos[b].percent+")";
}else{if(c.detailReasonVos[b].rejectReason=="订单拒收"){c.detailReasonVos[b].rejectReason="拒收("+c.detailReasonVos[b].percent+")";}else{c.detailReasonVos[b].rejectReason=c.detailReasonVos[b].rejectReason+"("+c.detailReasonVos[b].percent+")";
}}}a.data=c.detailReasonVos;a.setLegend(true,null,"rejectReason");a.setBarSeriesStyle(true,"right","{c}");a.setGridX(100);a.initSeries([{type:"bar",colName:"statusAmount",legendName:"金额"},{type:"bar",colName:"statusCount",legendName:"数量"}],"rejectReason",null,"transverse");
a._initChart("rpSoRejectsReportChart","拒收原因图(总订单金额:"+c.totalAmount+"元)");},_bindEventHander:function(){var a=this;window.onmessage=function(f){var c=JSON.parse(f.data);
if(c&&c.messageType=="reloadIframe"){var b=c.beginDate;var d=c.endDate;a.beginDate=b;a.endDate=d;a._getData(a.toPostParam(),a.type);}};$("body").on("click","#searchBtn",function(){a._getData(a.toPostParam(),a.type);
return false;});$("body").on("click",".graphPieAmountBtn",function(){$(".graphName").text("金额饼图");$(this).attr("disabled",true);$(".graphBarBtn").attr("disabled",false);
$(".graphPieCountBtn").attr("disabled",false);a.type="pie";a._getData(a.toPostParam(),"pie");});$("body").on("click",".graphPieCountBtn",function(){$(".graphName").text("数量饼图");
$(this).attr("disabled",true);$(".graphBarBtn").attr("disabled",false);$(".graphPieAmountBtn").attr("disabled",false);a.type="pieCount";a._getData(a.toPostParam(),"pieCount");
});$("body").on("click",".graphBarBtn",function(){$(".graphName").text("柱形图");$(this).attr("disabled",true);$(".graphPieCountBtn").attr("disabled",false);
$(".graphPieAmountBtn").attr("disabled",false);a.type="bar";a._getData(a.toPostParam(),"bar");});$(".showMoreInfo").on("click",function(){JTTabUtils.addOrRefreshTab(ctx+"/ec/rp/rpSoReject/list.htm?reportKey=no","订单拒收");
});},_getData:function(a,c){var b=this;$.ajax({type:"GET",url:RpSoRejectsReport._CONS_.INDEX_URL,data:a,contentType:"application/json",dataType:"json",success:function(d){if(c=="pie"){b.createReportChartByCount(d);
}else{if(c=="bar"){b.createBarReport(d);}else{if(c=="pieCount"){b.createReportChartByMoney(d);}}}},error:function(d){DialogUtils.error(msgCode.ERROR,d);
}});},toPostParam:function(){var a={};a.currentUserId=currentUserId;a.positionType="statistics,dept_manager";a.selectType="statistics";a.beginTime=this.beginDate;
a.endTime=this.endDate;return a;}};