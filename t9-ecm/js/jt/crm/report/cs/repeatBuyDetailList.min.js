$(function(){var a=new RepeatBuyDetailList();a.init();});function RepeatBuyDetailList(){this.hadInit=false;this.isEdit=false;this.sortColumn="";this.sortorder="";
}RepeatBuyDetailList._CONS_={LIST_DATA_URL:ctx+"/crm/report/repeatBuy/detailList.htm",FIND_BY_SONO_URL:ctx+"/ec/salesorder/soEntity/findCsBySoNo.htm",SO_DETAIL_PAGE_URL:ctx+"/ec/salesorder/soEntity/detail.htm",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detail.htm",GRID:"#repeatBuyDtailGrid",PAGER:"#repeatBuyDetailPager"};
RepeatBuyDetailList.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;this._bindEventHander();a._initJqgrid();$(".timeRange").text("时间: "+timeStart+" 至 "+timeEnd);
}},_bindEventHander:function(){$("body").on("click",".soTab",function(){var b=$(this).attr("value");var c=$(this).attr("valueCsName");var a=RepeatBuyDetailList._CONS_.FIND_BY_SONO_URL;
JTTabUtils.addOrRefreshTab(RepeatBuyDetailList._CONS_.SO_DETAIL_PAGE_URL+"?soNo="+b,c+"的订单明细");});$("body").on("click",".csTab",function(){var b=$(this).attr("valueCsName");
var a=$(this).attr("valueCsId");if(b.length>4){b="*"+b.substring(b.length-3,b.length);}JTTabUtils.addOrRefreshTab(RepeatBuyDetailList._CONS_.DETAIL_CS_PAGE_URL+"?csId="+a,"客户["+b+"]明细");
});},_initJqgrid:function(){var b=paramsDetail;var a=this;$(RepeatBuyDetailList._CONS_.GRID).JTJqgrid({url:RepeatBuyDetailList._CONS_.LIST_DATA_URL,postData:b,multiselect:false,footerrow:true,rowNum:-1,colNames:["订单编号","客户编号","支付方式","订单状态","总金额","下单时间",],colModel:[{name:"soNo",width:60,sortable:false,formatter:function(c,d,e){return"<a href='#' class='soTab' value='"+e.soNo+"' valueCsName= '"+e.csName+"'>"+e.soNo+"</a>";
}},{name:"csCode",width:60,sortable:false,formatter:function(c,d,e){if(e.csCode.indexOf("记录")>-1){return e.csCode;}else{return"<a href='#'  class='csTab' valueCsId = '"+e.csId+"' valueCsName = '"+e.csName+"'>"+e.csName+":"+e.csCode+"</a>";
}}},{name:"cashType",width:60,sortable:false,formatter:function(c,e,f){var d=f.cashType;if(f.cashType=="pay"){d="款到发货";}else{if(f.cashType=="pay_sub"){d="支付订金";
}else{if(f.cashType=="green"){d="绿色通道";}else{if(f.cashType=="green_by"){d="绿色通道订金";}else{if(f.cashType=="cod"){d="货到付款";}else{if(f.cashType=="free"){d="免费已付";
}}}}}}return d;}},{name:"status",width:60,formatter:function(c,e,f){var d=f.status;if(f.status=="complete"){d="已签收";}return d;}},{name:"totalAmount",width:70,sortable:false},{name:"placeTime",width:70,sortable:false},],gridComplete:function(){var d=$(RepeatBuyDetailList._CONS_.GRID).jqGrid("getCol","totalAmount",true,"sum");
var c=$(RepeatBuyDetailList._CONS_.GRID).jqGrid("getGridParam","records");$(RepeatBuyDetailList._CONS_.GRID).footerData("set",{"csCode":"共<span style='color:red;'>"+c+"</span>条记录, 订单总金额：<span style='color:red;'>"+d.toFixed(2)+"</span>"});
var e=$(RepeatBuyDetailList._CONS_.GRID).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow");e.find('td[aria-describedby*="cashType"],td[aria-describedby*="totalAmount"],td[aria-describedby*="placeTime"],td[aria-describedby*="status"],td[aria-describedby*="soNo"]').hide();
e.find("td").css({"font-weight":400});},});}};