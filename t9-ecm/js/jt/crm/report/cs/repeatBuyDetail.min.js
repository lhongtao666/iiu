$(function(){var a=new RepeatBuyDetail();a.init();});function RepeatBuyDetail(){this.hadInit=false;this.isEdit=false;this.sortColumn="";this.sortorder="";
}RepeatBuyDetail._CONS_={LIST_DATA_URL:ctx+"/crm/report/repeatBuy/detailList.htm",FIND_BY_SONO_URL:ctx+"/ec/salesorder/soEntity/findCsBySoNo.htm",SO_DETAIL_PAGE_URL:ctx+"/ec/salesorder/soEntity/detail.htm",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detail.htm",GRID:"#repeatBuyDtailGrid",PAGER:"#repeatBuyDetailPager"};
RepeatBuyDetail.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;this._bindEventHander();a._initJqgrid();$(".timeRange").text("时间: "+timeStart+" 至 "+timeEnd);
}},_bindEventHander:function(){$("body").on("click",".soTab",function(){var b=$(this).attr("value");var c=$(this).attr("valueCsName");var a=RepeatBuyDetail._CONS_.FIND_BY_SONO_URL;
JTTabUtils.addOrRefreshTab(RepeatBuyDetail._CONS_.SO_DETAIL_PAGE_URL+"?soNo="+b,c+"的订单明细");});$("body").on("click",".csTab",function(){var b=$(this).attr("valueCsName");
var a=$(this).attr("valueCsId");if(b.length>4){b="*"+b.substring(b.length-3,b.length);}JTTabUtils.addOrRefreshTab(RepeatBuyDetail._CONS_.DETAIL_CS_PAGE_URL+"?csId="+a,"客户["+b+"]明细");
});},_initJqgrid:function(){if(employeeId){params="Q__S__EQ__entity.employee_id_="+employeeId;}if(belongOgn){params="belongOgn="+belongOgn;}if(repeatCount!=0){params+="&Q__N__EQ__entity.so_repeat_buy_="+repeatCount;
}else{params+="&Q__S__NEQ__entity.so_repeat_buy_=0";params+="&isCountRepeat=0";}if(dateTime!=""){params+="&Q__D__BW__entity.last_complete_time_="+dateTime;
}$(RepeatBuyDetail._CONS_.GRID).JTJqgrid({url:RepeatBuyDetail._CONS_.LIST_DATA_URL,postData:params,multiselect:false,footerrow:true,rowNum:-1,colNames:["客户编号","订单编号","归属员工","订单金额","签收时间",],colModel:[{name:"csCode",width:60,sortable:false,formatter:function(a,b,c){if(c.code.indexOf("记录")>-1){return c.csCode;
}else{return"<a href='#'  class='csTab' valueCsId = '"+c.id+"' valueCsName = '"+c.name+"'>"+c.name+":"+c.code+"</a>";}}},{name:"lastSoNo",width:70,sortable:false,formatter:function(a,b,c){if(c.code.indexOf("记录")>-1){return c.csCode;
}else{return"<a href='#'  class='soTab' value = '"+c.lastSoNo+"' valueCsName = '"+c.name+"'>"+c.lastSoNo+"</a>";}}},{name:"aid",width:70,sortable:false,formatter:function(a,b,c){if(c.employeeAid.indexOf("记录")>-1){return"";
}else{return c.employeeAid+":"+c.employeeName;}}},{name:"soPrice",width:70,sortable:false},{name:"lastCompleteTime",width:70,sortable:false}]});}};