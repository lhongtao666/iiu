$(function(){var a=new RepeatBuyDetail();a.init();});function RepeatBuyDetail(){this.hadInit=false;this.isEdit=false;this.sortColumn="";this.sortorder="";
}RepeatBuyDetail._CONS_={LIST_URL:ctx+"/crm/report/repeatBuy/repeatEmpListData.htm",GRID:"#repeatBuyEmpDetailGrid",PAGER:"#repeatBuyEmpDetailPager"};RepeatBuyDetail.prototype={init:function(b){var a=this;
if(!a.hadInit){a.hadInit=true;this._bindEventHander();a._initJqgrid();$(".timeRange").text("时间: "+timeStart+" 至 "+timeEnd);}},_bindEventHander:function(){$(document).on("click",".tabDetail",function(){var c=$(this).attr("empId");
var a=$(this).attr("repeatCount");var b="/crm/report/repeatBuy/detail.htm?employeeId="+c+"&repeatCount="+a+"&timeStart="+timeStart+"&timeEnd="+timeEnd+"&dateTime="+dateTime;
JTTabUtils.addOrRefreshTab(ctx+b,"复购客户明细");});},_initJqgrid:function(){params="belongOgn="+belongOgn;if(saleLine){params+="&saleLine="+saleLine;}params+="&Q__D__BW__entity.last_complete_time_="+dateTime;
if(timeType){params+="&timeType="+timeType;if(timeType=="oper"){params+="&Q__D__BW__oper_time_="+dateTime;}else{params+="&Q__D__BW__place_time_="+dateTime;
}params+="&countType=count";}$(RepeatBuyDetail._CONS_.GRID).JTJqgrid({url:RepeatBuyDetail._CONS_.LIST_URL,postData:params,multiselect:false,rowNum:-1,footerrow:true,colNames:["部门","员工","总客户数","复购金额","复购客户","复购客户/金额","占比率","新进客户","下单","金额","下单/金额","签收","金额","签收/金额","一次复购客户/金额","一次复购","金额","二次复购客户/金额","二次复购","金额","三次复购客户/金额","三次复购","金额","四次复购客户/金额","四次复购","金额","五次复购客户/金额","五次复购","金额",],colModel:[{name:"groupName",width:60,index:"groupName",sortable:false,formatter:function(a,b,c){if(c.groupName.indexOf("总计：")>-1){return c.groupName;
}else{return c.groupName;}}},{name:"employeeName",index:"employeeName",width:60},{name:"entityCount",index:"entityCount",width:60,hidedlg:true},{name:"sumSoTotal",index:"sumSoTotal",width:60,hidden:true,hidedlg:true},{name:"sumRepeatHide",index:"sumRepeat",width:60,hidden:true,hidedlg:true,formatter:function(a,b,c){return c.sumRepeat;
}},{name:"sumRepeat",index:"sumRepeat",width:60,hidedlg:true,formatter:function(a,b,c){if(c.groupName.indexOf("总计：")>-1){return"<span>"+c.sumRepeat+"/"+c.sumSoTotal+"</span>";
}else{return"<a href='javascript:void(0)' class='tabDetail' repeatCount='0' empId='"+c.employeeId+"'>"+c.sumRepeat+"/"+c.sumSoTotal+"</a>";}}},{name:"repeatRate",index:"repeatRate",width:60,hidedlg:true,formatter:function(a,b,c){return c.repeatRate;
}},{name:"newCsCount",index:"new_cs_count_",width:52,sortable:false},{name:"placeCount",index:"place_count_",hidedlg:true,hidden:true,sortable:false},{name:"placeAmountHide",hidedlg:true,hidden:true,sortable:false,formatter:function(a,b,c){return c.placeAmount;
}},{name:"placeAmount",index:"place_amount_",width:60,sortable:false,formatter:function(a,b,c){return"<span>"+c.placeCount+"/"+parseFloat(c.placeAmount).toFixed(2)+"</span>";
}},{name:"signCount",index:"sign_count_",hidedlg:true,hidden:true,sortable:false},{name:"signAmountHide",index:"sign_amount_",hidedlg:true,hidden:true,sortable:false,formatter:function(a,b,c){return c.signAmount;
}},{name:"signAmount",index:"sign_amount_",width:60,sortable:false,formatter:function(a,b,c){return"<span>"+c.signCount+"/"+parseFloat(c.signAmount).toFixed(2)+"</span>";
}},{name:"firstBuy",index:"firstBuy",width:60,hidedlg:true,formatter:function(a,b,c){if(c.groupName.indexOf("总计：")>-1){return"<span>"+c.firstBuy+"/"+c.firstTotal+"</span>";
}else{return"<a href='javascript:void(0)' class='tabDetail' repeatCount='1' empId='"+c.employeeId+"'>"+c.firstBuy+"</a>/<span style='color:red'>"+c.firstTotal+"</span>";
}}},{name:"firstBuyHide",index:"firstBuy",width:60,hidedlg:true,hidden:true,formatter:function(a,b,c){return c.firstBuy;}},{name:"firstTotal",index:"firstTotal",width:60,hidedlg:true,hidden:true},{name:"secondBuy",index:"secondBuy",width:60,hidedlg:true,formatter:function(a,b,c){if(c.groupName.indexOf("总计：")>-1){return"<span>"+c.secondBuy+"/"+c.secondTotal+"</span>";
}else{return"<a href='javascript:void(0)' class='tabDetail' repeatCount='2' empId='"+c.employeeId+"'>"+c.secondBuy+"</a>/<span style='color:red'>"+c.secondTotal+"</span>";
}}},{name:"secondBuyHide",index:"secondBuy",width:60,hidedlg:true,hidden:true,formatter:function(a,b,c){return c.secondBuy;}},{name:"secondTotal",index:"secondTotal",width:60,hidedlg:true,hidden:true},{name:"thirdBuy",index:"thirdBuy",width:60,hidedlg:true,formatter:function(a,b,c){if(c.groupName.indexOf("总计：")>-1){return"<span>"+c.thirdBuy+"/"+c.thirdTotal+"</span>";
}else{return"<a href='javascript:void(0)' class='tabDetail' repeatCount='3' empId='"+c.employeeId+"'>"+c.thirdBuy+"</a>/<span style='color:red'>"+c.thirdTotal+"</span>";
}}},{name:"thirdBuyHide",index:"thirdBuy",width:60,hidedlg:true,hidden:true,formatter:function(a,b,c){return c.thirdBuy;}},{name:"thirdTotal",index:"thirdTotal",width:60,hidedlg:true,hidden:true},{name:"fourBuy",index:"fourBuy",width:60,hidedlg:true,formatter:function(a,b,c){if(c.groupName.indexOf("总计：")>-1){return"<span>"+c.fourBuy+"/"+c.fourTotal+"</span>";
}else{return"<a href='javascript:void(0)' class='tabDetail' repeatCount='4' empId='"+c.employeeId+"'>"+c.fourBuy+"</a>/<span style='color:red'>"+c.fourTotal+"</span>";
}}},{name:"fourBuyHide",index:"fourBuy",width:60,hidedlg:true,hidden:true,formatter:function(a,b,c){return c.fourBuy;}},{name:"fourTotal",index:"fourTotal",width:60,hidedlg:true,hidden:true},{name:"fiveBuy",index:"fiveBuy",width:60,hidedlg:true,formatter:function(a,b,c){if(c.groupName.indexOf("总计：")>-1){return"<span>"+c.fiveBuy+"/"+c.fiveTotal+"</span>";
}else{return"<a href='javascript:void(0)' class='tabDetail' repeatCount='5' empId='"+c.employeeId+"'>"+c.fiveBuy+"</a>/<span style='color:red'>"+c.fiveTotal+"</span>";
}}},{name:"fiveBuyHide",index:"fiveBuy",width:60,hidedlg:true,hidden:true,formatter:function(a,b,c){return c.fiveBuy;}},{name:"fiveTotal",index:"fiveTotal",width:60,hidedlg:true,hidden:true},],loadComplete:function(){var o=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getGridParam","records");
var b=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","entityCount",true,"sum");var k=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","sumRepeatHide",true,"sum");
var d=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","sumSoTotal",true,"sum");var i=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","firstBuyHide",true,"sum");
var r=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","secondBuyHide",true,"sum");var h=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","thirdBuyHide",true,"sum");
var q=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","fourBuyHide",true,"sum");var g=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","fiveBuyHide",true,"sum");
var l=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","firstTotal",true,"sum");var m=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","secondTotal",true,"sum");
var f=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","thirdTotal",true,"sum");var j=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","fourTotal",true,"sum");
var e=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","fiveTotal",true,"sum");var n=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","newCsCount",true,"sum");
var a=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","placeCount",true,"sum");var t=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","signCount",true,"sum");
var p=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","placeAmount",true,"sum");var s=$(RepeatBuyDetail._CONS_.GRID).jqGrid("getCol","signAmount",true,"sum");
var c=0+"%";if(k!=0&&b==0){c=100+"%";}else{if(k!=0&&b!=0){c=(k/b*100).toFixed(0)+"%";}}$(RepeatBuyDetail._CONS_.GRID).jqGrid("footerData","set",{"groupName":"总计："+o+"条","entityCount":+b,"sumRepeat":k,"sumSoTotal":d,"repeatRate":c,"newCsCount":n,"placeCount":a,"placeAmount":p,"signCount":t,"signAmount":s,"firstBuy":i,"firstTotal":l,"secondTotal":m,"secondBuy":r,"thirdBuy":h,"thirdTotal":f,"fourBuy":q,"fourTotal":j,"fiveBuy":g,"fiveTotal":e});
}});$(window).bind("resize",function(){$(RepeatBuy._CONS_.GRID).setGridWidth($(".report-content").width()-4);});},};