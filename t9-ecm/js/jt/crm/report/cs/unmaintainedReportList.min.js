$(function(){var a=new UnmaintainedReportList();a.init();});function UnmaintainedReportList(){this.hadInit=false;this.isEdit=false;}UnmaintainedReportList._CONS_={LIST_DATA_URL:ctx+"/crm/report/unmaintainedReport/listData.htm",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",EXPORT_URL:ctx+"/crm/report/unmaintainedReport/export.htm",GRID:"#unmaintainedReportGrid",PAGER:"#unmaintainedReportPager"};
UnmaintainedReportList.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();a._initJqgrid();a._buildEmployeeSelect();
}},_buildEmployeeSelect:function(a){$.ajax({type:"GET",url:ctx+"/crm/ou/employee/listEmployees.htm"+"?groupId="+(a?a:""),contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(c){if(c&&c.length>0){var d=new StringBuffer();
d.append("<option value=''>请选择</option>");for(var b=0;b<c.length;b++){d.append("<option value='"+c[b].id+"'>"+c[b].aid+":"+c[b].name+"</option>");}$("#belongEmployee").empty().append(d.toString()).select2();
}}});},_bindEventHander:function(){var a=this;$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
FormUtils.loadData(UnmaintainedReportList._CONS_.EMPLOYEE_LIST_URL+"?groupId="+c+"&type=statistics,dept_manager",function(e){var f=new StringBuffer();f.append('<option value="">请选择</option>');
for(var d=0;d<e.length;d++){f.append("<option value='"+e[d].id+"'>"+e[d].aid+":"+e[d].name+"</option>");}$("#belongEmployee").empty().append(f.toString()).select2();
});}};GroupUtils.selectGroupTreeBox(b);});$("#searchBtn").on("click",function(){var b=$("#searchForm").serialize();a.reloadJqgrid(b);});$(".exportExcel").on("click",function(){ButtonUtils.disableBtn("exportExcel");
FormUtils.submit(UnmaintainedReportList._CONS_.EXPORT_URL,$("#searchForm").serialize(),function(b){ButtonUtils.enableBtn("exportExcel");if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");
}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});$(document).on("click",".csDetail",function(){var f={};
var e="";var d=$(this).attr("employeeId");var b=$("#belongEmployee").val();if(d!=""&&d!="undefined"){e=d;}if(b!=""&&b!=null){e=b;}var g=$(this).attr("value");
var c="/crm/report/unmaintainedReport/detail.htm?employeeId="+e+"&days="+g;JTTabUtils.addOrRefreshTab(ctx+c,"超期维护客户明细");});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(UnmaintainedReportList._CONS_.GRID,a);
},_initJqgrid:function(){var b={};var a=this;$(UnmaintainedReportList._CONS_.GRID).JTJqgrid({url:UnmaintainedReportList._CONS_.LIST_DATA_URL,postData:b,multiselect:false,footerrow:true,rowNum:-1,colNames:["部门","员工","数据总量","当天未维护总量","≥2天未维护总量","≥3天未维护总量","≥10天未维护总量","≥20天未维护总量","≥30天未维护总量","≥40天未维护总量",],colModel:[{name:"groupName",width:40,sortable:false},{name:"employeeName",width:40,sortable:false,formatter:function(c,d,e){return e.employeeName+":"+e.employeeAid;
}},{name:"csCount",width:40,sortable:false},{name:"todayCount",width:40,sortable:false,formatter:function(c,d,e){return"<a href='#' class='csDetail' employeeId='"+e.employeeId+"' value='0'>"+e.todayCount+"</a>";
}},{name:"twoDayCount",width:40,sortable:false,formatter:function(c,d,e){return"<a href='#' class='csDetail' employeeId='"+e.employeeId+"' value='2'>"+e.twoDayCount+"</a>";
}},{name:"threeDayCount",width:40,sortable:false,formatter:function(c,d,e){return"<a href='#' class='csDetail' employeeId='"+e.employeeId+"' value='3'>"+e.threeDayCount+"</a>";
}},{name:"tenDayCount",width:40,sortable:false,formatter:function(c,d,e){return"<a href='#' class='csDetail' employeeId='"+e.employeeId+"' value='10'>"+e.tenDayCount+"</a>";
}},{name:"twentyDayCount",width:40,sortable:false,formatter:function(c,d,e){return"<a href='#' class='csDetail' employeeId='"+e.employeeId+"' value='20'>"+e.twentyDayCount+"</a>";
}},{name:"thirtyDayCount",width:40,sortable:false,formatter:function(c,d,e){return"<a href='#' class='csDetail' employeeId='"+e.employeeId+"' value='30'>"+e.thirtyDayCount+"</a>";
}},{name:"fortyDayCount",width:40,sortable:false,formatter:function(c,d,e){return"<a href='#' class='csDetail' employeeId='"+e.employeeId+"' value='40'>"+e.fortyDayCount+"</a>";
}},],beforeProcessing:function(d){var c={groupName:"总计：",csCount:d.footData.csCount,csNewCount:d.footData.csNewCount,todayCount:d.footData.todayCount,twoDayCount:d.footData.twoDayCount,threeDayCount:d.footData.threeDayCount,tenDayCount:d.footData.tenDayCount,twentyDayCount:d.footData.twentyDayCount,thirtyDayCount:d.footData.thirtyDayCount,fortyDayCount:d.footData.fortyDayCount,};
a.footerData=c;},gridComplete:function(){if(a.footerData){var c=$(UnmaintainedReportList._CONS_.GRID).jqGrid("getGridParam","records");a.footerData.aid="总计：<span style='color:red;'>"+c+"</span>个";
$(UnmaintainedReportList._CONS_.GRID).footerData("set",a.footerData);}},});}};