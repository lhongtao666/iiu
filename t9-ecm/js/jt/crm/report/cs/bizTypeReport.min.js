$(function(){var a=new BizTypeReport();a.init();});function BizTypeReport(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}BizTypeReport._CONS_={EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",EXPORT_URL:ctx+"/crm/report/reportCsBizType/exportExcel.htm",EDIT_FORM_ID:"reportCsBizTypeForm",GRID:"#reportCsBizTypeGrid",PAGER:"#reportCsBizTypePager"};
BizTypeReport.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;ReportDateUtil.initDate(".report-content");$("#timeTypeSearch").change();
this._bindEventHander();this._initJqgrid(a);this._buildEmployeeOption("");this._initBizTypeSearch();}},_bindEventHander:function(){var a=this;$("#searchBtn").on("click",function(){var b=a._toPostParam();
a._initJqgrid(b);});$("#reportCsBizTypeSearchForm").on("keypress",function(b){if(b.keyCode=="13"){$(".reportCsBizTypeSearch").trigger("click");}});$("#belongOgnName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"belongOgnName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
a._buildEmployeeOption(c);}};GroupUtils.selectGroupTreeBox(b);});$(".exportExcel").on("click",function(){ButtonUtils.disableBtn("exportExcel");FormUtils.submit(ctx+"/crm/cs/csEntity/exportBizTypeReport.htm",a._toPostParam(),function(b){ButtonUtils.enableBtn("exportExcel");
if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});$(document).on("click",".bizTypeDetail",function(){var c=$(this).attr("emp-id");var b=$(this).attr("biz-type");var d=ReportDateUtil.getDateTimeRangeStr();
JTTabUtils.addOrRefreshTab(ctx+"/crm/report/reportCsBizType/list.htm?employeeId="+c+"&bizType="+encodeURIComponent(b)+"&createTime="+d,"客户分类明细");});},_toPostParam:function(){var a=$("#bizTypeReportSearchForm").closest("form").serialize();
a+="&Q__D__BW__create_time_="+ReportDateUtil.getDateTimeRangeStr();return a;},_initBizTypeSearch:function(){CateUtils.getOptions({typeKey:"system",pKey:"CsBizTypes",fn:function(a){var e=new StringBuffer();
for(var c=0;c<a.length;c++){var d=a[c].value;var b=a[c].name;e.append("<option value='"+d+"'>"+b+"</option>");}$("#bizTypeSearch").empty().append(e.toString());
$("#bizTypeSearch").chosen();$("#bizTypeSearch").val("").trigger("chosen:updated");}});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(BizTypeReport._CONS_.GRID,a);
},_buildEmployeeOption:function(b){var a=BizTypeReport._CONS_.EMPLOYEE_LIST_URL+"?groupId="+b+"&type=dept_manager";FormUtils.loadData(a,function(d){$("#belongEmployeeSearch").empty();
if(d&&d.length>0){var e=new StringBuffer();e.append("<option value=''>请选择</option>");for(var c=0;c<d.length;c++){e.append("<option value='"+d[c].id+"'>"+d[c].aid+":"+d[c].name+"</option>");
}$("#belongEmployeeSearch").append(e.toString()).select2();}},null,true);},_initJqgrid:function(c){var a=this;if(c==null||typeof c==undefined){c={};}$(BizTypeReport._CONS_.GRID).jqGrid("clearGridData");
$.jgrid.defaults.styleUI="Bootstrap";$.jgrid.styleUI.Bootstrap.base.rowTable="table table-bordered table-striped";var b=$("#bizTypeReportSearchForm").width()-10;
c=a._toPostParam();FormUtils.submit(ctx+"/crm/cs/csEntity/findBizTypeReportData.htm",c,function(e){var g=[];var d=[];$.each(e[0],function(h,i){g.push(h);
d.push({name:h,sortable:false,width:100});});$(BizTypeReport._CONS_.GRID).jqGrid({datatype:"local",width:b,colNames:g,colModel:d,shrinkToFit:false,autoScroll:true,footerrow:true,gridComplete:function(){$(BizTypeReport._CONS_.GRID).closest(".ui-jqgrid-bdiv").css({"overflow-x":"scroll"});
var i=$(BizTypeReport._CONS_.GRID).jqGrid("getGridParam","records");if(i<=0){if($(".norecords").html()==null){$(BizTypeReport._CONS_.GRID).parent().append('<div class="norecords">没有符合数据！</div>');
$(".norecords").show();}else{$(".norecords").show();}}else{var j=$(BizTypeReport._CONS_.GRID).jqGrid("getRowData",1).部门;if(j=="--"){$(BizTypeReport._CONS_.GRID).jqGrid("clearGridData");
$(".norecords").show();}else{$(".norecords").hide();}}if(!a._hadSetHeight){a._hadSetHeight=true;var h=$(window).height()-$(".panel-heading").outerHeight()-$(".ui-jqgrid-hdiv").outerHeight()-25;
$(BizTypeReport._CONS_.GRID).jqGrid("setGridHeight",h);}},});for(var f=0;f<=e.length;f++){if(f==e.length-1){e[f].部门="合计";e[f].员工=e.length-1;$(BizTypeReport._CONS_.GRID).jqGrid("footerData","set",e[f]);
}else{$(BizTypeReport._CONS_.GRID).jqGrid("addRowData",f+1,e[f],"last");}}});}};