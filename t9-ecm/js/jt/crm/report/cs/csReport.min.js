$(function(){var a=new CsReport();a.init();});function CsReport(){this.hadInit=false;this.isEdit=false;this.baseUrl=ctx+"/crm/report/csReport/listData.htm";
if(typeof CsReport._initialized=="undefined"){CsReport._initialized=true;CsReport.prototype.init=function(c){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();
CateUtils.getOptions({typeKey:"system",pKey:"CsStatuss",container:"csStatusSearch"});CateUtils.getOptions({typeKey:"system",pKey:"CsBizTypes",container:"bizTypeSearch"});
CateUtils.getOptions({typeKey:"system",pKey:"CsTypes",container:"typeSearch"});CateUtils.getOptions({typeKey:"system",pKey:"CsTrades",container:"tradeSearch"});
$("#typeSearch").attr("disabled","disabled");a.csTypeOptions=getCatesObjectByTypeAndKey("CsEntityManager",null,"csTypes");a.csBizTypeOptions=getCatesObjectByTypeAndKey("CsEntityManager",null,"CsBizTypes");
a.statusOptions=getCatesObjectByTypeAndKey("CsEntityManager",null,"CsStatuss");a.tradeOptions=getCatesObjectByTypeAndKey("CsEntityManager",null,"CsTrades");
a.srcOptions=getCatesObjectByTypeAndKey("CsEntityManager",null,"CsSrcs");var b=new StringBuffer();b.append(a.baseUrl).append("?G__group_by_=").append($("#reportTypeSearch").val());
a.getData(b,a);}};CsReport.prototype.createReport=function(f,c){var b=$("#reportTypeSearch").val();var d=b.split("_");legTypeStr=d[0];for(var e=1;e<d.length;
e++){legTypeStr+=d[e].substring(0,1).toUpperCase()+d[e].substring(1);}if(!jQuery.isEmptyObject(f)){var a=new Report();a.data=f;a.setLegend(false);if(b=="cs_type_"){a.cates=c.csTypeOptions;
}else{if(b=="biz_type_"){a.cates=c.CsBizTypeOptions;}else{if(b=="cs_status_"){a.cates=c.statusOptions;}else{if(b=="trade_"){a.cates=c.tradeOptions;}else{if(b=="src_"){a.cates=c.srcOptions;
}}}}}a.initSeries([{type:$("#chartTypeSearch").val(),colName:"count",legendName:"数量"}],legTypeStr);a._initChart("main","客户分析报表");}c._initJqgrid(f,c);};
CsReport.prototype._bindEventHander=function(){var a=this;$(document).on("click","#searchBtn",function(){var b=$("#reportTypeSearch").val();var c=new StringBuffer();
var d=new StringBuffer();d.append("  查询条件：  ");c.append(a.baseUrl).append("?G__group_by_=").append(b);if(b!="cs_type_"){c.append("&Q__S__EQ__cs_type_=").append($("#typeSearch").val());
d.append(" 客户类型=").append($("#typeSearch").find("option:selected").text());}if(b!="biz_type_"){c.append("&Q__S__EQ__biz_type_=").append($("#bizTypeSearch").val());
d.append(" 客户业务类型=").append($("#bizTypeSearch").find("option:selected").text());}if(b!="cs_status_"){c.append("&Q__S__EQ__cs_status_=").append($("#csStatusSearch").val());
d.append(" 客户状态=").append($("#csStatusSearch").find("option:selected").text());}if(b!="src_"){c.append("&Q__S__EQ__src_=").append($("#srcSearch").val());
d.append(" 客户来源=").append($("#srcSearch").find("option:selected").text());}if(b!="trade_"){c.append("&Q__S__EQ__trade_=").append($("#tradeSearch").val());
d.append(" 行业类别=").append($("#tradeSearch").find("option:selected").text());}$("#searchShow").text(""+d);a.getData(c,a);return false;});$(document).on("change","#reportTypeSearch",function(){var b=$("#reportTypeSearch").val();
if(b=="cs_type_"){$("#typeSearch").attr("disabled","disabled");$("#bizTypeSearch").removeAttr("disabled");$("#csStatusSearch").removeAttr("disabled");$("#srcSearch").removeAttr("disabled");
$("#tradeSearch").removeAttr("disabled");}else{if(b=="biz_type_"){$("#typeSearch").removeAttr("disabled");$("#bizTypeSearch").attr("disabled","disabled");
$("#csStatusSearch").removeAttr("disabled");$("#srcSearch").removeAttr("disabled");$("#tradeSearch").removeAttr("disabled");}else{if(b=="cs_status_"){$("#typeSearch").removeAttr("disabled");
$("#bizTypeSearch").removeAttr("disabled");$("#csStatusSearch").attr("disabled","disabled");$("#srcSearch").removeAttr("disabled");$("#tradeSearch").removeAttr("disabled");
}else{if(b=="src_"){$("#typeSearch").removeAttr("disabled");$("#bizTypeSearch").removeAttr("disabled");$("#csStatusSearch").removeAttr("disabled");$("#srcSearch").attr("disabled","disabled");
$("#tradeSearch").removeAttr("disabled");}else{if(b=="trade_"){$("#typeSearch").removeAttr("disabled");$("#bizTypeSearch").removeAttr("disabled");$("#csStatusSearch").removeAttr("disabled");
$("#srcSearch").removeAttr("disabled");$("#tradeSearch").attr("disabled","disabled");}}}}}});};CsReport.prototype.getData=function(b,a){$.ajax({type:"GET",url:b,contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(c){a.createReport(c,a);
},error:function(c){alert("网络错误或者未授权");}});};CsReport.prototype._initJqgrid=function(b,a){$("#csReportGridDiv").empty().html('<table id="csReportGrid"></table>');
$.jgrid.defaults.styleUI="Bootstrap";$(CsReport.GRID).jqGrid({datatype:"jsonstring",datastr:b,height:200,autowidth:true,shrinkToFit:true,rowNum:20,viewrecords:true,rownumbers:true,multiselect:false,rowList:[10,20,30],colNames:["客户类型","客户业务类型","客户状态","客户来源","行业类别","数量"],colModel:[{name:"csType",editable:false,width:120,formatter:function(c,d,g){var f="全部";
if(a.csTypeOptions!=null){if(g.csType==undefined){for(var e=0;e<a.csTypeOptions.length;e++){if(c==a.csTypeOptions[e].value){f=a.csTypeOptions[e].name;}}}else{for(var e=0;
e<a.csTypeOptions.length;e++){if(g.csType==a.csTypeOptions[e].value){f=a.csTypeOptions[e].name;}}}}return f;}},{name:"bizType",editable:false,width:120,formatter:function(c,d,g){var f="全部";
if(a.csBizTypeOptions!=null){if(g.bizType==undefined){for(var e=0;e<a.csBizTypeOptions.length;e++){if(c==a.csBizTypeOptions[e].value){f=a.csBizTypeOptions[e].name;
}}}else{for(var e=0;e<a.csBizTypeOptions.length;e++){if(g.bizType==a.csBizTypeOptions[e].value){f=a.csBizTypeOptions[e].name;}}}}return f;}},{name:"csStatus",editable:false,width:120,formatter:function(c,d,g){var f="全部";
if(a.statusOptions!=null){if(g.csStatus==undefined){for(var e=0;e<a.statusOptions.length;e++){if(c==a.statusOptions[e].value){f=a.statusOptions[e].name;
}}}else{for(var e=0;e<a.statusOptions.length;e++){if(g.csStatus==a.statusOptions[e].value){f=a.statusOptions[e].name;}}}}return f;}},{name:"src",editable:false,width:120,formatter:function(c,d,g){var f="全部";
if(a.srcOptions!=null){if(g.src==undefined){for(var e=0;e<a.srcOptions.length;e++){if(c==a.srcOptions[e].value){f=a.srcOptions[e].name;}}}else{for(var e=0;
e<a.srcOptions.length;e++){if(g.src==a.srcOptions[e].value){f=a.srcOptions[e].name;}}}}return f;}},{name:"trade",editable:false,width:120,formatter:function(c,d,g){var f="全部";
if(a.tradeOptions!=null){if(g.trade==undefined){for(var e=0;e<a.tradeOptions.length;e++){if(c==a.tradeOptions[e].value){f=a.tradeOptions[e].name;}}}else{for(var e=0;
e<a.tradeOptions.length;e++){if(g.trade==a.tradeOptions[e].value){f=a.tradeOptions[e].name;}}}}return f;}},{name:"count",editable:false,width:120}],hidegrid:false});
};}}CsReport.GRID="#csReportGrid";