$(function(){var a=new SaleCustStatistic();a.init();});function SaleCustStatistic(){this.hadInit=false;}SaleCustStatistic._CONS_={LIST_URL:ctx+"/crm/cs/csEntity/saleCustStatistic.htm",GRID:"#saleCustStatisticGrid",PAGER:"#saleCustStatisticPager",EXPORT_URL:ctx+"/crm/report/csSleepStatistic/saleCustStatisticExport.htm",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detail.htm",};
SaleCustStatistic.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;ReportDateUtil.initDate(".report-content");$("#timeTypeSearch").change();
this._bindEventHander();this._initJqgrid();}},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(SaleCustStatistic._CONS_.GRID,a);},_bindEventHander:function(){var a=this;
$("#saleCustStatisticForm").on("click",".saleCustSearchBtn",function(){var b=a._handleParams();a.reloadJqgrid(b);});$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
}};GroupUtils.selectGroupTreeBox(b);});$("#saleCustStatisticForm").on("click",".saleCustExportExcel",function(){a._exportExcel();});$("body").on("click",".csTab",function(){var b=$(this).attr("value");
var d=$(this).attr("valueCsName");var c=$(this).attr("valueCsId");if(d.length>4){d="*"+d.substring(d.length-3,d.length);}JTTabUtils.addOrRefreshTab(SaleCustStatistic._CONS_.DETAIL_CS_PAGE_URL+"?csId="+c,"客户["+d+"]明细");
});},_initJqgrid:function(a){$(SaleCustStatistic._CONS_.GRID).JTJqgrid({url:SaleCustStatistic._CONS_.LIST_URL,postData:this._handleParams(a),multiselect:false,rowNum:-1,colNames:["部门","员工","客户","消费金额","订单数"],colModel:[{name:"groupName",sortable:false,width:120},{name:"employeeName",sortable:false,width:120,formatter:function(b,c,d){if(d.employeeAid){return d.employeeAid+":"+d.employeeName;
}return d.employeeName;}},{name:"code",sortable:false,width:120,formatter:function(b,c,d){return"<a href='#'  class='csTab' value='"+d.code+"' valueCsId = '"+d.id+"' valueCsName = '"+d.name+"'>"+d.code+"</a>"+":"+d.name;
}},{name:"soTotal",index:"cs.so_total_",width:120,formatter:function(b,c,d){return"<strong>"+d.soTotal+"</strong>";}},{name:"soCount",index:"cs.so_count_",width:120},]});
},_handleParams:function(a){var a=$("#saleCustStatisticForm").serialize();a+="&Q__D__BW__cs.last_complete_time_="+ReportDateUtil.getDateTimeRangeStr();
a+="&reportType="+$("input[name=reportKey]").val();return a;},_exportExcel:function(){var a=this._handleParams();FormUtils.submit(SaleCustStatistic._CONS_.EXPORT_URL,a,function(b){if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");
}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},};