$(function(){var a=new CsCareReport();a.init();});function CsCareReport(){this.hadInit=false;this.isEdit=false;this.baseUrl=ctx+"/crm/report/csCareReport/listData.htm";
if(typeof CsCareReport._initialized=="undefined"){CsCareReport._initialized=true;CsCareReport.prototype.init=function(c){var a=this;if(!a.hadInit){a.hadInit=true;
a._bindEventHander();this.careTypeOptions=[{value:"email",name:"邮件"},{value:"sms",name:"短信"},{value:"call",name:"呼出电话"},{value:"visit",name:"外访"}];this.statusOptions=[{value:"undo",name:"未执行"},{value:"done",name:"已执行"},{value:"follow",name:"需后续跟进"},{value:"follow_done",name:"后续跟进完毕"}];
var b=new StringBuffer();b.append(a.baseUrl).append("?G__group_by_=").append($("#reportTypeSearch").val());a.getData(b,a);}};CsCareReport.prototype.createReport=function(f,c){var b=$("#reportTypeSearch").val();
var d=b.split("_");legTypeStr=d[0];for(var e=1;e<d.length;e++){legTypeStr+=d[e].substring(0,1).toUpperCase()+d[e].substring(1);}var a=new Report();a.data=f;
if(b=="care_type_"){a.cates=c.careTypeOptions;}else{if(b=="status_"){a.cates=c.statusOptions;}else{a.cates=null;}}a.setLegend(false);a.initSeries([{type:$("#chartTypeSearch").val(),colName:"count",legendName:"数量"}],legTypeStr);
a._initChart("main","图三");c._initJqgrid(f,c);};CsCareReport.prototype._bindEventHander=function(){var a=this;$(document).on("click","#searchBtn",function(){var b=$("#reportTypeSearch").val();
var c=new StringBuffer();var d=new StringBuffer();d.append("  查询条件：  ");c.append(a.baseUrl).append("?G__group_by_=").append(b);if(b!="care_type_"){c.append("&Q__S__EQ__care_type_=").append($("#careTypeSearch").val());
d.append(" 关怀类型=").append($("#careTypeSearch").find("option:selected").text());}if(b!="status_"){c.append("&Q__S__EQ__status_=").append($("#statusSearch").val());
d.append(" 状态=").append($("#statusSearch").find("option:selected").text());}$("#searchShow").text(""+d);a.getData(c,a);return false;});$(document).on("change","#reportTypeSearch",function(){var b=$("#reportTypeSearch").val();
if(b=="care_type_"){$("#careTypeSearch").attr("disabled","disabled");$("#statusSearch").removeAttr("disabled");}else{if(b=="status_"){$("#statusSearch").attr("disabled","disabled");
$("#careTypeSearch").removeAttr("disabled");}else{$("#careTypeSearch").removeAttr("disabled");$("#statusSearch").removeAttr("disabled");}}});};CsCareReport.prototype.getData=function(b,a){$.ajax({type:"GET",url:b,contentType:"application/json",dataType:"json",success:function(c){a.createReport(c,a);
},error:function(c){alert(c);}});};CsCareReport.prototype._initJqgrid=function(c,b){var a=$("#reportTypeSearch").val();$("#csCareReportGridDiv").empty().html('<table id="csCareReportGrid"></table>');
$.jgrid.defaults.styleUI="Bootstrap";$(CsCareReport.GRID).jqGrid({datatype:"jsonstring",datastr:c,height:200,autowidth:true,shrinkToFit:true,rowNum:20,viewrecords:true,rownumbers:true,multiselect:false,rowList:[10,20,30],colNames:["关怀类型","状态","关怀人","关怀时间","数量"],colModel:[{name:"careType",editable:false,width:120,formatter:function(d,e,h){var g="全部";
if(h.careType==undefined){for(var f=0;f<b.careTypeOptions.length;f++){if(d==b.careTypeOptions[f].value){g=b.careTypeOptions[f].name;}}}else{for(var f=0;
f<b.careTypeOptions.length;f++){if(h.careType==b.careTypeOptions[f].value){g=b.careTypeOptions[f].name;}}}return g;}},{name:"status",editable:false,width:120,formatter:function(d,e,h){var g="全部";
if(h.status==undefined){for(var f=0;f<b.statusOptions.length;f++){if(d==b.statusOptions[f].value){g=b.statusOptions[f].name;}}}else{for(var f=0;f<b.statusOptions.length;
f++){if(h.status==b.statusOptions[f].value){g=b.statusOptions[f].name;}}}return g;}},{name:"partyId",editable:false,width:120,formatter:function(d,e,g){var f="全部";
if(a=="party_id_"){if(g.partyId==undefined){f=d;}else{f=g.partyId;}}return f;}},{name:"careTime",editable:false,width:120,formatter:function(d,e,g){var f="全部";
if(a=="care_time_"){if(g.careTime==undefined){f=d;}else{f=g.careTime;}}return f;}},{name:"count",editable:false,width:120}],hidegrid:false});};}}CsCareReport.GRID="#csCareReportGrid";
