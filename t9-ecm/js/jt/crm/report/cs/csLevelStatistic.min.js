$(function(){var a=new CsLevelStatistic();a.init();});function CsLevelStatistic(){this.hadInit=false;this.isEdit=false;this.isExistEmp=false;}CsLevelStatistic._CONS_={LIST_DATA_URL:ctx+"/crm/report/levelStatisticReport/listData.htm",EXPORT_URL:ctx+"/crm/report/levelStatisticReport/export.htm",ALL_TOTAL_URL:ctx+"/crm/report/levelStatisticReport/allTotal.htm",GROUP_TOTAL_URL:ctx+"/crm/report/levelStatisticReport/groupTotal.htm",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",};
CsLevelStatistic.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();$("#timeTypeSearch").val("month");ReportDateUtil.initDate(".report-content");
$("#timeTypeSearch").change();a.loadLevelStatistic();}},_bindEventHander:function(){var a=this;$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("#authPartyName").val(),container:"groupName",nolimit:true,isSale:true,positionType:"all",fn:function(c){$("#authPartyName").val(c);
FormUtils.loadData(CsLevelStatistic._CONS_.EMPLOYEE_LIST_URL+"?groupId="+c+"&type=all",function(e){var f=new StringBuffer();f.append('<option value="">请选择</option>');
for(var d=0;d<e.length;d++){f.append("<option value='"+e[d].id+"'>"+e[d].aid+":"+e[d].name+"</option>");}$("#authEmpName").empty().append(f.toString());
});}};GroupUtils.selectGroupTreeBox(b);});$("#searchBtn").on("click",function(){a.isExistEmp=false;a.loadLevelStatistic();});$(document).on("click",".isDefaultMember",function(){if($(this).attr("checked")=="checked"){$(this).prop("checked",false);
$(this).removeAttr("checked");}else{$(this).attr("checked","checked");}});$(".exportExcel").on("click",function(){var b=$(this).closest("form").serialize();
FormUtils.submit(CsLevelStatistic._CONS_.EXPORT_URL,a.toPostParam(b),function(c){ButtonUtils.enableBtn("exportExcel");if(c.success){DialogUtils.success(msgCode.INFO,c.msg+"成功");
}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});},loadLevelStatistic:function(){var a=this;
var b=CsLevelStatistic._CONS_.LIST_DATA_URL;var c=$(this).closest("form").serialize();FormUtils.submit(b,a.toPostParam(c),function(e){var l=new StringBuffer();
for(var f=0;f<e.length;f++){if(e[f].employeePos.length!=0){a.isExistEmp=true;var k="";for(var h=3;h<e[f].depth;h++){var k=k.concat("　　");}l.append("<tr>");
l.append("<td style='text-align: left;'><strong>"+k+e[f].name+"</strong></td>");l.append("<td></td>");l.append("<td class='defaultLevel'></td>");l.append("<td></td>");
l.append("<td></td>");l.append("<td></td>");l.append("<td></td>");l.append("<td></td>");l.append("<td></td>");l.append("<td></td>");l.append("</tr>");if(e[f].employeePos){for(var d=0;
d<e[f].employeePos.length;d++){l.append("<tr idVal='"+e[f].employeePos[d].id+"' ><td>"+(d+1)+"　　</td>");var g=e[f].employeePos[d].levelCountOne+e[f].employeePos[d].levelCountTwo+e[f].employeePos[d].levelCountThree+e[f].employeePos[d].levelCountFour+e[f].employeePos[d].levelCountFive+e[f].employeePos[d].levelCountSix+e[f].employeePos[d].levelCountSeven;
l.append("<td>"+e[f].employeePos[d].aid+":"+e[f].employeePos[d].name+"</td>");l.append("<td class='defaultLevel'>"+e[f].employeePos[d].levelCountOne+"</td>");
l.append("<td>"+e[f].employeePos[d].levelCountTwo+"</td>");l.append("<td>"+e[f].employeePos[d].levelCountThree+"</td>");l.append("<td>"+e[f].employeePos[d].levelCountFour+"</td>");
l.append("<td>"+e[f].employeePos[d].levelCountFive+"</td>");l.append("<td>"+e[f].employeePos[d].levelCountSix+"</td>");l.append("<td>"+e[f].employeePos[d].levelCountSeven+"</td>");
l.append("<td>"+g+"</td></tr>");}}l.append("<tr idVal="+e[f].id+" style='background-color:#DAEFFF;'>");l.append("<td colspan='2'>"+k+e[f].name+"合计</td>");
l.append("<td class='groupTd'>0</td>");l.append("<td class='groupTd'>0</td>");l.append("<td class='groupTd'>0</td>");l.append("<td class='groupTd'>0</td>");
l.append("<td class='groupTd'>0</td>");l.append("<td class='groupTd'>0</td>");l.append("<td class='groupTd'>0</td>");l.append("<td class='groupTd'>0</td>");
l.append("</tr>");}}if(a.isExistEmp){l.append("<tr class='allTotal' style='background-color:#6293BA;'>");l.append("<td>总计</td>");l.append("</tr>");}$("#levelStatisticTbody").empty().append(l.toString());
if(!a.isExistEmp||!e&&e.length<0){$("#levelStatisticTbody").empty().append("<div class='norecords' style='display: block;'>没有符合数据！</div>");}a.levelStatisticAllTotal();
a.levelStatisticTotal();});},levelStatisticTotal:function(){var a=this;var b=CsLevelStatistic._CONS_.GROUP_TOTAL_URL;var c=$(this).closest("form").serialize();
FormUtils.submit(b,a.toPostParam(c),function(f){for(var d=0;d<f.length;d++){var g=new StringBuffer();var e=f[d].levelCountOne+f[d].levelCountTwo+f[d].levelCountThree+f[d].levelCountFour+f[d].levelCountFive+f[d].levelCountSix+f[d].levelCountSeven;
g.append("<td class='defaultLevel'>"+f[d].levelCountOne+"</td>");g.append("<td>"+f[d].levelCountTwo+"</td>");g.append("<td>"+f[d].levelCountThree+"</td>");
g.append("<td>"+f[d].levelCountFour+"</td>");g.append("<td>"+f[d].levelCountFive+"</td>");g.append("<td>"+f[d].levelCountSix+"</td>");g.append("<td>"+f[d].levelCountSeven+"</td>");
g.append("<td>"+e+"</td>");$("#levelStatisticTbody").find("tr").each(function(){if($(this).attr("idVal")==f[d].groupId){$(this).find(".groupTd").remove();
$(this).append(g.toString());}});}a.hideDefalutMember();});},levelStatisticAllTotal:function(){var a=this;var b=CsLevelStatistic._CONS_.ALL_TOTAL_URL;var c=$(this).closest("form").serialize();
FormUtils.submit(b,a.toPostParam(c),function(f){for(var d=0;d<f.length;d++){var g=new StringBuffer();var e=f[d].levelCountOne+f[d].levelCountTwo+f[d].levelCountThree+f[d].levelCountFour+f[d].levelCountFive+f[d].levelCountSix+f[d].levelCountSeven;
g.append("<td></td>");g.append("<td class='defaultLevel'>"+f[d].levelCountOne+"</td>");g.append("<td>"+f[d].levelCountTwo+"</td>");g.append("<td>"+f[d].levelCountThree+"</td>");
g.append("<td>"+f[d].levelCountFour+"</td>");g.append("<td>"+f[d].levelCountFive+"</td>");g.append("<td>"+f[d].levelCountSix+"</td>");g.append("<td>"+f[d].levelCountSeven+"</td>");
g.append("<td>"+e+"</td>");$(".allTotal").append(g.toString());}});},hideDefalutMember:function(){if($(".isDefaultMember").attr("checked")){$(".defaultLevel").show();
}else{$(".defaultLevel").attr("style","display:none");}},toPostParam:function(a){a=a+"&Q__D__BW__create_time_="+ReportDateUtil.getDateRangeStr();if($("select[name=authEmpName]").val()){a=a+"&authEmpName="+$("select[name=authEmpName]").val();
}if($("input[name=authPartyName]").val()){a=a+"&authPartyName="+$("input[name=authPartyName]").val();}a+="&reportType="+$("input[name=reportKey]").val();
return a;}};