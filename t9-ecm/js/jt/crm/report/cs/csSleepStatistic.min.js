$(function(){var a=new CsSleepStatistic();a.init();});function CsSleepStatistic(){this.hadInit=false;}CsSleepStatistic._CONS_={LIST_URL:ctx+"/crm/report/csSleepStatistic/listData.htm",GRID:"#csSleepStatisticGrid",PAGER:"#csSleepStatisticPager",EXPORT_URL:ctx+"/crm/report/csSleepStatistic/exportExcel.htm",};
CsSleepStatistic.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._initSearchForm();this._initJqgrid();}},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(CsSleepStatistic._CONS_.GRID,a);
},_initSearchForm:function(){CateUtils.getOptions([{typeKey:"system",pKey:"CsBizTypes",container:"bizTypeSearch"},{typeKey:"system",pKey:"CsInterestType",container:"interestsSearch"}]);
},_bindEventHander:function(){var a=this;$("#csSleepSearchForm").on("click",".csSleepSearchBtn",function(){var b=a._handleParams();a.reloadJqgrid(b);});
$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("#groupId").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("#groupId").val(c);
}};GroupUtils.selectGroupTreeBox(b);});$("#csSleepSearchForm").on("click",".csSleepExportExcel",function(){a._exportExcel();});$(document).on("click",".detail",function(){var h=$(this).attr("employeeId");
var c=$(this).attr("employeeName");var i=$(this).attr("employeeAid");var d=$(".sleepCountDay").val();var b=$("#interestsSearch").val();var j=$("#bizTypeSearch").val();
var f=$("#limitTypeSearch").val();var g={};if(b){g.interests=b;}if(j){g.bizType=j;}if(f){g.limitType=f;}g.aid=h;g.empName=c;g.sleepCountDay=d;var e="/crm/report/csReport/sleepList.htm?paramsDetail="+encodeURIComponent(JSON.stringify(g));
JTTabUtils.addOrRefreshTab(ctx+e,i+"：沉睡客户数量");});},_initJqgrid:function(a){$(CsSleepStatistic._CONS_.GRID).JTJqgrid({url:CsSleepStatistic._CONS_.LIST_URL,pager:CsSleepStatistic._CONS_.PAGER,postData:this._handleParams(a),multiselect:false,colNames:["部门","员工","员工客户总数","沉睡客户数量","最长沉睡天数","最短沉睡天数"],colModel:[{name:"groupName",width:120},{name:"employeeName",width:120,formatter:function(b,c,d){if(d.employeeAid){return d.employeeAid+":"+d.employeeName;
}return d.employeeName;}},{name:"csSum",width:120,formatter:function(b,c,d){if(d.csSum==0){return"<a href='#' style='color:red;' class='detail' employeeName='"+d.employeeName+"' employeeAid='"+d.employeeAid+"' employeeId='"+d.employeeId+"'>"+d.csCount+"</a>";
}else{return"<a href='#' style='color:red;' class='detail' employeeName='"+d.employeeName+"' employeeAid='"+d.employeeAid+"' employeeId='"+d.employeeId+"'>"+d.csSum+"</a>";
}}},{name:"csCount",width:120,formatter:function(b,c,d){return"<a href='#' style='color:bule;' class='detail' employeeName='"+d.employeeName+"' employeeAid='"+d.employeeAid+"' employeeId='"+d.employeeId+"'>"+d.csCount+"<a/>";
}},{name:"maxDays",width:120},{name:"minDays",width:120}]});},_handleParams:function(c){var a=this;if(c==null||typeof c==undefined){c={};}c=$("#csSleepSearchForm").serialize();
c+="&reportType="+reportType;var b=$("#groupId").val();if(b){c+="&groupId="+b;}return c;},_exportExcel:function(){var a=this._handleParams();FormUtils.submit(CsSleepStatistic._CONS_.EXPORT_URL,a,function(b){if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");
}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},};