$(function(){var a=new CsRepeat();a.init();});function CsRepeat(){this.hadInit=false;}CsRepeat._CONS_={LIST_DATA_URL:ctx+"/crm/cs/report/getRepeatData.htm",GRID:"#csRepeatGrid",PAGER:"#csRepeatPager",EXPORT_URL:ctx+"/crm/cs/report/exportExcel.htm",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",};
CsRepeat.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;$("[name=startMonth]").val(startMonth);$("[name=endMonth]").val(endMonth);
a._bindEventHander();a._initJqgrid();a._buildEmployeeOption("");}},_bindEventHander:function(){var a=this;$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
}};GroupUtils.selectGroupTreeBox(b);});$("#searchBtn").on("click",function(){$(".csGridDiv").empty().append("<table id='csRepeatGrid'></table><div id='csRepeatPager'></div>");
a._initJqgrid();});$("#csRepForm").on("click",".repeatExportExcel",function(){a._exportExcel();});$("#belongOgnName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"belongOgnName",nolimit:true,positionType:"all",fn:function(c){$("input[name=belongOgn]").val(c);
a._buildEmployeeOption(c);}};GroupUtils.selectGroupTreeBox(b);});},_initJqgrid:function(){var a=this;var b=$("#csRepForm").serialize();b+="&reportType="+$("input[name=reportKey]").val();
$(CsRepeat._CONS_.GRID).JTJqgrid({url:CsRepeat._CONS_.LIST_DATA_URL,postData:b,multiselect:false,footerrow:true,sortable:true,rowNum:-1,colNames:["月份","注册客户","一次购买","二次购买","三次购买","四次购买","五次购买","五次以上购买","总下单数量","总签收数量"],colModel:[{name:"regMonth",width:100},{name:"csCount",width:100},{name:"firstBuy",width:100},{name:"secondBuy",width:100},{name:"thirdBuy",width:100},{name:"fourBuy",width:100},{name:"fiveBuy",width:100},{name:"beyondFiveBuy",width:100},{name:"saleCount",width:100},{name:"checkCount",width:100}],gridComplete:function(){}});
},reloadJqgrid:function(){JTJqgridUtils.reloadJqgrid(CsEntity._CONS_.GRID,this.toPostParam());},toPostParam:function(){var a=$("#csRepForm").serialize();
a+="&searchMonth="+ReportDateUtil.getDateTimeRangeStr();a+="&reportType="+$("input[name=reportKey]").val();return a;},_buildEmployeeOption:function(b){var a=CsRepeat._CONS_.EMPLOYEE_LIST_URL+"?groupId="+b+"&type=dept_manager";
FormUtils.loadData(a,function(d){$("#belongEmployeeSearch").empty();if(d&&d.length>0){var e=new StringBuffer();e.append("<option value=''>请选择</option>");
for(var c=0;c<d.length;c++){e.append("<option value='"+d[c].id+"'>"+d[c].aid+":"+d[c].name+"</option>");}$("#belongEmployeeSearch").append(e.toString()).select2();
}},null,true);},_exportExcel:function(){var a=this;var b=a.toPostParam();FormUtils.submit(CsRepeat._CONS_.EXPORT_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,c.msg+"成功");
}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}};