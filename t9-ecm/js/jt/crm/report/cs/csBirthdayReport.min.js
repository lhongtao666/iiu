$(function(){var a=new CsBirthdayReport();a.init();});function CsBirthdayReport(){this.hadInit=false;this.hadInitCity=false;}CsBirthdayReport._CONS_={LIST_URL:ctx+"/crm/report/csBirthdayReport/listData.htm",EXPORT_URL:ctx+"/crm/report/csBirthdayReport/exportExcel.htm",GRID:"#csBirthdayReportGrid",PAGER:"#csBirthdayReportPager",};
CsBirthdayReport.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();$("#beginTime").val(DateUtils.format(new Date(),"yyyy-MM-dd"));
$("#endTime").val(DateUtils.format(new Date(),"yyyy-MM-dd"));this._initJqgrid({beginTime:$("#beginTime").val(),endTime:$("#beginTime").val()});}},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(CsBirthdayReport._CONS_.GRID,a);
},_bindEventHander:function(){var a=this;$(".layer-date").unbind("click");$(".layer-date").on("click",function(){laydate({istime:true,format:"YYYY-MM-DD"});
});$("#preDateBtn").on("click",function(){var b=$("#beginTime").val();if(b==""||b==null){b=DateUtils.format(new Date(),"yyyy-MM-dd");}var c=$("#endTime").val();
if(c==""||c==null){c=DateUtils.format(new Date(),"yyyy-MM-dd");}$("#beginTime").val(DateUtils.getBeforeDate(1,b));$("#endTime").val(DateUtils.getBeforeDate(1,c));
});$("#nextDateBtn").on("click",function(){var b=$("#beginTime").val();if(b==""||b==null){b=DateUtils.format(new Date(),"yyyy-MM-dd");}var c=$("#endTime").val();
if(c==""||c==null){c=DateUtils.format(new Date(),"yyyy-MM-dd");}$("#beginTime").val(DateUtils.getBeforeDate(-1,b));$("#endTime").val(DateUtils.getBeforeDate(-1,c));
});$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='groupId']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",isSale:true,fn:function(c){$("#groupId").val(c);
}};GroupUtils.selectGroupTreeBox(b);});$("#searchBtn").on("click",function(){var b={beginTime:$("#beginTime").val(),endTime:$("#endTime").val(),groupId:$("#groupId").val()};
a.reloadJqgrid(b);});$(".exportExcel").on("click",function(){a._exportExcel();});},_initJqgrid:function(a){$(CsBirthdayReport._CONS_.GRID).JTJqgrid({url:CsBirthdayReport._CONS_.LIST_URL,pager:CsBirthdayReport._CONS_.PAGER,postData:a,multiselect:false,rowNum:-1,footerrow:true,colNames:["部门","归属员工","客户编号","姓名","生日日期"],colModel:[{name:"groupName",width:120},{name:"employeeName",width:120},{name:"csCode",width:120},{name:"csName",width:120},{name:"csBirthday",width:120}],});
},_exportExcel:function(){var a={beginTime:$("#beginTime").val(),endTime:$("#endTime").val(),groupId:$("#groupId").val()};FormUtils.submit(CsBirthdayReport._CONS_.EXPORT_URL,a,function(b){if(b.success){DialogUtils.success(msgCode.INFO,"导出中...");
}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},};