$(function(){var a=new FinanceTurnoverReport();a.init();});function FinanceTurnoverReport(){this.hadInit=false;}FinanceTurnoverReport._CONS_={LIST_DATA_URL:ctx+"/crm/finance/financeTurnover/listData.htm",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detail.htm",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",EXPORT_URL:ctx+"/crm/finance/financeTurnover/export.htm",GRID:"#financeTurnoverReportGrid",PAGER:"#financeTurnoverReportPager"};
FinanceTurnoverReport.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();ReportDateUtil.initDate(".report-content");
$("#timeTypeSearch").change();a._initJqgrid();}},_bindEventHander:function(){var a=this;$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
FormUtils.loadData(FinanceTurnoverReport._CONS_.EMPLOYEE_LIST_URL+"?groupId="+c+"&type=statistics,dept_manager",function(e){var f=new StringBuffer();f.append('<option value="">请选择</option>');
for(var d=0;d<e.length;d++){f.append("<option value='"+e[d].id+"'>"+e[d].aid+":"+e[d].name+"</option>");}$("#belongEmployee").empty().append(f.toString());
});}};GroupUtils.selectGroupTreeBox(b);});$("body").on("click",".csTab",function(){var c=$(this).text();var b=$(this).attr("value");if(c.length>4){c="*"+c.substring(c.length-3,c.length);
}JTTabUtils.addOrRefreshTab(FinanceTurnoverReport._CONS_.DETAIL_CS_PAGE_URL+"?csId="+b,"客户["+c+"]明细");});$("body").on("click","#searchBtn",function(){var b=$("#searchForm").serialize();
b+="&Q__D__BW__start_time_="+ReportDateUtil.getDateTimeRangeStr();a.reloadJqgrid(b);});$(".exportExcel").on("click",function(){var b=$("#searchForm").serialize();
b+="&Q__D__BW__start_time_="+ReportDateUtil.getDateTimeRangeStr();ButtonUtils.disableBtn("exportExcel");FormUtils.submit(FinanceTurnoverReport._CONS_.EXPORT_URL,b,function(c){ButtonUtils.enableBtn("exportExcel");
if(c.success){DialogUtils.success(msgCode.INFO,c.msg+"成功");}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(FinanceTurnoverReport._CONS_.GRID,a);},_initJqgrid:function(){var a=this;var b={};b.Q__D__BW__start_time_=ReportDateUtil.getDateTimeRangeStr();
$(FinanceTurnoverReport._CONS_.GRID).JTJqgrid({url:FinanceTurnoverReport._CONS_.LIST_DATA_URL,postData:b,multiselect:false,footerrow:true,rowNum:-1,colNames:["部门","员工","客户","产品名称","签约金额","签约时间","锁定期（天）","确认业绩（年化）",],colModel:[{name:"groupName",width:50,sortable:false},{name:"employeeName",width:50,sortable:false,formatter:function(c,d,e){if(e.employeeName){return e.placerAid+":"+e.employeeName;
}}},{name:"csName",width:50,sortable:false,formatter:function(c,d,e){if(e.csName!=null&&e.csName!=""){return"<a href='#'  class='csTab' value='"+e.csId+"' >"+e.csName+"</a>";
}}},{name:"prodName",width:50,sortable:false},{name:"amount",width:50,sortable:false},{name:"startTime",width:50,sortable:false},{name:"endTime",width:100,sortable:false,formatter:function(c,d,e){return DateUtils.getDateDiff(e.startTime,e.endTime,"day");
}},{name:"id",width:90,sortable:false,formatter:function(c,d,e){return(e.amount/360*DateUtils.getDateDiff(e.startTime,e.endTime,"day")).toFixed(2);}},],});
},};