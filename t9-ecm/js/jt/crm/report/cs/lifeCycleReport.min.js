$(function(){var a=new LifeCycleReport();a.init();});function LifeCycleReport(){this.hadInit=false;}LifeCycleReport._CONS_={LIST_DATA_URL:ctx+"/crm/cs/report/getLifeCycleData.htm",GRID:"#lifeCycleReportGrid",PAGER:"#lifeCycleReportPager",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",GET_MONTH_URL:ctx+"/crm/cs/report/getMonth.htm",};
LifeCycleReport.prototype={init:function(d){var b=this;if(!b.hadInit){b.hadInit=true;b._bindEventHander();$("[name=startMonth]").val(startMonth);var a="（"+startMonth+" - "+endMonth+"）";
$("#dateTip").text(a);var c=months.split(",");b._initJqgrid(c);b._buildEmployeeOption("");}},_bindEventHander:function(){var a=this;$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
}};GroupUtils.selectGroupTreeBox(b);});$("#searchBtn").on("click",function(){$(".lifeCycleGridDiv").empty().append("<table id='lifeCycleReportGrid'></table><div id='lifeCycleReportPager'></div>");
var c=$("[name=startMonth]").val();var b=LifeCycleReport._CONS_.GET_MONTH_URL+"?startMonth="+c;FormUtils.loadData(b,function(f){var d="（"+c+" - "+f.endMonth+"）";
$("#dateTip").text(d);var e=f.months.split(",");a._initJqgrid(e);});});$("#belongOgnName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"belongOgnName",nolimit:true,positionType:"all",fn:function(c){$("input[name=belongOgn]").val(c);
a._buildEmployeeOption(c);}};GroupUtils.selectGroupTreeBox(b);});},_initJqgrid:function(b){var a=this;var c=$("#lifeCycleForm").serialize();c+="&reportType="+$("input[name=reportKey]").val();
$(LifeCycleReport._CONS_.GRID).JTJqgrid({url:LifeCycleReport._CONS_.LIST_DATA_URL,postData:c,multiselect:false,footerrow:true,sortable:true,rowNum:-1,colNames:["月份","注册客户",b[0],b[1],b[2],b[3],b[4],b[5],],colModel:[{name:"month",width:100},{name:"csCount",width:100},{name:"month0",width:100},{name:"month1",width:100},{name:"month2",width:100},{name:"month3",width:100},{name:"month4",width:100},{name:"month5",width:100}],gridComplete:function(){}});
},toPostParam:function(){var a=$("#lifeCycleForm").serialize();a+="&searchMonth="+ReportDateUtil.getDateTimeRangeStr();a+="&reportType="+$("input[name=reportKey]").val();
return a;},_buildEmployeeOption:function(b){var a=LifeCycleReport._CONS_.EMPLOYEE_LIST_URL+"?groupId="+b+"&type=dept_manager";FormUtils.loadData(a,function(d){$("#belongEmployeeSearch").empty();
if(d&&d.length>0){var e=new StringBuffer();e.append("<option value=''>请选择</option>");for(var c=0;c<d.length;c++){e.append("<option value='"+d[c].id+"'>"+d[c].aid+":"+d[c].name+"</option>");
}$("#belongEmployeeSearch").append(e.toString()).select2();}},null,true);},};