$(function(){var a=new CsCountStat();a.init();});function CsCountStat(){this.hadInit=false;this.sortColumn="";this.sortorder="";}CsCountStat._CONS_={LIST_URL:ctx+"/crm/report/csCountStat/listData.htm",GRID:"#csCountStatGrid",EXPORT_URL:ctx+"/crm/report/csCountStat/exportExcel.htm"};
CsCountStat.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._initSearchForm();this._initJqgrid();}},_bindEventHander:function(){var a=this;
$("#csCountStatSearchForm").on("click",".csCountStatSearchBtn",function(){a.reloadJqgrid();});$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='groupId']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",isSale:true,fn:function(c){$("#groupId").val(c);
}};GroupUtils.selectGroupTreeBox(b);});$("#csCountStatSearchForm").on("click",".csCountStatExportExcel",function(){a._exportExcel();});},reloadJqgrid:function(){JTJqgridUtils.reloadJqgrid(CsCountStat._CONS_.GRID,$("#csCountStatSearchForm").serialize());
},_initJqgrid:function(){var b={};var a=this;$(CsCountStat._CONS_.GRID).JTJqgrid({url:CsCountStat._CONS_.LIST_URL,postData:b,multiselect:false,rowNum:-1,footerrow:true,sortable:true,colNames:["工号","姓名","客户总数"],colModel:[{name:"employeeAid",width:120,sortable:false},{name:"employeeName",width:120,sortable:false},{name:"csCount",index:"csCount",width:120}],gridComplete:function(){var c=$(CsCountStat._CONS_.GRID).jqGrid("getGridParam","records");
var d=$(CsCountStat._CONS_.GRID).jqGrid("getCol","csCount",true,"sum");$(CsCountStat._CONS_.GRID).footerData("set",{"employeeAid":"总计：<span style='color:red;'>"+c+"</span>人","csCount":d});
},onSortCol:function(d,e,c){a.sortColumn=d;a.sortorder=c;}});},_initSearchForm:function(){ChannelUtils.getOptions({container:"channelSearch",caption:"全部"});
CateUtils.getOptions([{typeKey:"system",pKey:"CsBizTypes",container:"bizTypeSearch"},{typeKey:"system",pKey:"CsInterestType",container:"interestsSearch"}]);
},_exportExcel:function(){var a=$("#csCountStatSearchForm").serialize()+"&sidx="+this.sortColumn+"&sord="+this.sortorder;FormUtils.submit(CsCountStat._CONS_.EXPORT_URL,a,function(b){if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");
}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}};