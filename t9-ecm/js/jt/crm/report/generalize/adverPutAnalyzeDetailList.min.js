$(function(){var a=new AdverputAnalyzeDetailList();a.init();});function AdverputAnalyzeDetailList(){this.hadInit=false;this.isEdit=false;this.sortColumn="";
this.sortorder="";}AdverputAnalyzeDetailList._CONS_={LIST_DATA_URL:ctx+"/ec/rp/reportProfit/adverPutAnalyzeList.htm",FIND_BY_SONO_URL:ctx+"/ec/salesorder/soEntity/findCsBySoNo.htm",SO_DETAIL_PAGE_URL:ctx+"/ec/salesorder/soEntity/detail.htm",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detail.htm",EXPORT_URL:ctx+"/crm/report/performanceForEmpReport/exportDetail.htm",GRID:"#adverputDetailGrid",PAGER:"#adverputDetailPager"};
AdverputAnalyzeDetailList.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;this._bindEventHander();this._hideNotGrantBtn();a._initJqgrid();
}},_hideNotGrantBtn:function(){if(!ResUtils.canShow("report.button.exportDetail")){$(".exportExcelDetail").hide();}},_bindEventHander:function(){$("body").on("click",".soTab",function(){var b=$(this).attr("value");
var c=$(this).attr("valueCsName");var a=AdverputAnalyzeDetailList._CONS_.FIND_BY_SONO_URL;JTTabUtils.addOrRefreshTab(AdverputAnalyzeDetailList._CONS_.SO_DETAIL_PAGE_URL+"?soNo="+b,c+"的订单明细");
});$("body").on("click",".csTab",function(){var a=$(this).attr("value");var c=$(this).attr("valueCsName");var b=$(this).attr("valueCsId");if(c.length>4){c="*"+c.substring(c.length-3,c.length);
}RefreshTab(AdverputAnalyzeDetailList._CONS_.DETAIL_CS_PAGE_URL+"?csId="+b,"客户["+c+"]明细");});$(".exportExcelDetail").on("click",function(){var a=paramsDetail;
ButtonUtils.disableBtn("exportExcelDetail");FormUtils.submit(AdverputAnalyzeDetailList._CONS_.EXPORT_URL,a,function(b){ButtonUtils.enableBtn("exportExcelDetail");
if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});},_initJqgrid:function(){var b=paramsDetail;var a=this;$(AdverputAnalyzeDetailList._CONS_.GRID).JTJqgrid({url:AdverputAnalyzeDetailList._CONS_.LIST_DATA_URL,postData:b,multiselect:false,footerrow:true,rowNum:-1,colNames:["订单编号","客户编号","支付方式","订单状态","总金额","业绩工号","个人业绩","业绩分成","下单时间","签收时间",],colModel:[{name:"soNo",width:50,sortable:false,formatter:function(c,d,e){return"<a href='#' class='soTab' value='"+e.soNo+"' valueCsName= '"+e.csName+"'>"+e.soNo+"</a>";
}},{name:"csNo",width:50,sortable:false,formatter:function(c,d,e){if(e.csNo.indexOf("记录")>-1){return e.csNo;}else{return"<a href='#'  class='csTab' value='"+e.csNo+"' valueCsId = '"+e.csId+"' valueCsName = '"+e.csName+"'>"+e.csNo+"</a>";
}}},{name:"payType",width:50,sortable:false,formatter:function(c,e,f){var d=f.payType;if(f.payType=="pay"){d="款到发货";}else{if(f.payType=="pay_sub"){d="支付订金";
}else{if(f.payType=="green"){d="绿色通道";}else{if(f.payType=="green_by"){d="绿色通道订金";}else{if(f.payType=="cod"){d="货到付款";}else{if(f.payType=="free"){d="免费已付";
}}}}}}return d;}},{name:"status",width:50,formatter:function(c,e,f){var d=f.status;if(f.status=="awaiting_pay"){d="待支付";}else{if(f.status=="awaiting_post"){d="待提交";
}else{if(f.status=="awaiting_comfirm"){d="待审核";}else{if(f.status=="comfirm"){d="待发货";}else{if(f.status=="shipping"){d="已发货";}else{if(f.status=="complete"){d="已签收";
}else{if(f.status=="close"){d="已作废";}else{if(f.status=="close_reject"){d="已拒收";}else{if(f.status=="close_lost"){d="已丢失";}}}}}}}}}return d;}},{name:"totalAmount",width:50,sortable:false},{name:"aid",width:50,sortable:false},{name:"profitAmount",width:50,sortable:false},{name:"profitAid",width:100,sortable:false},{name:"placeTime",width:90,sortable:false},{name:"completeTime",width:90,sortable:false},],gridComplete:function(){var e=$(AdverputAnalyzeDetailList._CONS_.GRID).jqGrid("getCol","totalAmount",true,"sum");
var d=$(AdverputAnalyzeDetailList._CONS_.GRID).jqGrid("getCol","profitAmount",true,"sum");var c=$(AdverputAnalyzeDetailList._CONS_.GRID).jqGrid("getGridParam","records");
$(AdverputAnalyzeDetailList._CONS_.GRID).footerData("set",{"csNo":"共<span style='color:red;'>"+c+"</span>条记录, 订单总金额：<span style='color:red;'>"+e.toFixed(2)+"</span>, 个人总业绩：<span style='color:red;'>"+d.toFixed(2)+"</span>"});
var f=$(AdverputAnalyzeDetailList._CONS_.GRID).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow");f.find('td[aria-describedby*="payType"],td[aria-describedby*="totalAmount"],td[aria-describedby*="aid"],td[aria-describedby*="profitAmount"],td[aria-describedby*="placeTime"],td[aria-describedby*="completeTime"],td[aria-describedby*="profitAid"],td[aria-describedby*="status"],td[aria-describedby*="soNo"]').hide();
},});}};