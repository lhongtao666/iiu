$(function(){var a=new AdverPutAnalyzeReport();a.init();});function AdverPutAnalyzeReport(){this.hadInit=false;this.isEdit=false;this.sortColumn="";this.sortorder="";
}AdverPutAnalyzeReport._CONS_={LIST_DATA_URL:ctx+"/ec/rp/reportProfit/listAdverPutData.htm",EXPORT_URL:ctx+"/crm/report/performanceForEmpReport/exportAdverPut.htm",GRID:"#adverPutAnalyzeReportGrid",PAGER:"#adverPutAnalyzeReportPager"};
AdverPutAnalyzeReport.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();ReportDateUtil.initDate(".report-content");
$("#periodDaySearch").val(DateUtils.format(new Date(),"yyyy-MM-dd"));$("#timeTypeSearch").change();a._initJqgrid($("#adverPutSearchForm").serialize());
}},_bindEventHander:function(){var a=this;$(".adverPutSearch").on("click",function(){a.reloadJqgrid(a.toPostParam());});$(document).on("click",".prevDay",function(){$("#periodDaySearch").val(DateUtils.getBeforeDate(1,$("#periodDaySearch").val()));
});$(document).on("click",".nextDay",function(){$("#periodDaySearch").val(DateUtils.getAfterDate(1,$("#periodDaySearch").val()));});$(document).on("click",".toDay",function(){$("#periodDaySearch").val(DateUtils.format(new Date(),"yyyy-MM-dd"));
});$(document).on("click",".detail",function(){var c=$(this).attr("profitType");var b=$(this).attr("csNo");ConfigUtils.findByKey("salesorder.isAddCloseProfit",function(e){var d={};
ConfigUtils.findByKey("salesorder.isAddAwaitPostProfit",function(g){if(e.success&&c=="place"){d.Q__S__IN__type_="place";}else{if(g.success&&c=="place"){d.Q__S__IN__type_="place,post";
}else{if(c=="delaySign"){d.Q__S__IN__type_="delay,complete";}else{d.Q__S__EQ__type_=c;}}}d.type="aid";d.csNo=b;if($(".opterate").val()=="1"){d.timeType="oper";
}else{d.timeType="place";}if($(".searchChannelVal").val()){d.Q__S__EQ__channel_id_=$(".searchChannelVal").val();}if($(".interstSearch").val()){d.interests=$(".interstSearch").val();
}if($("#searchProd").val()){d.Q__S__EQ__product_name_=$("#searchProd").val();}if($(".csEntrySearch").val()){d.Q__S__EQ__cs_entry_=$(".csEntrySearch").val();
}if($(".completeStartTime").val()){d.completeStartTime=$(".completeStartTime").val();}if($(".completeEndTime").val()){d.completeStartTime=$(".completeStartTime").val()+","+$(".completeEndTime").val();
}if($(".rejectStartTime").val()){d.rejectStartTime=$(".rejectStartTime").val();}if($(".rejectEndTime").val()){d.rejectStartTime=$(".rejectStartTime").val()+","+$(".rejectEndTime").val();
}var f="/crm/report/adverPutAnalyzeReport/detail.htm?paramsDetail="+encodeURIComponent(JSON.stringify(d));JTTabUtils.addOrRefreshTab(ctx+f,"业绩明细");});});
});$(".exportExcel").on("click",function(){ButtonUtils.disableBtn("exportExcel");FormUtils.submit(AdverPutAnalyzeReport._CONS_.EXPORT_URL,a.toPostParam()+"&sidx="+a.sortColumn+"&sord="+a.sortorder,function(b){ButtonUtils.enableBtn("exportExcel");
if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});},_initJqgrid:function(b){var a=this;$(AdverPutAnalyzeReport._CONS_.GRID).JTJqgrid({url:AdverPutAnalyzeReport._CONS_.LIST_DATA_URL,postData:b,multiselect:false,footerrow:true,sortable:true,shrinkToFit:false,autoScroll:true,rowNum:-1,colNames:["媒体","推广计划","产品意向","广告费","进线数量","单线成本","下单/金额","成交率","下单投产比","核单/金额","核单率","签收/金额","签收率","签收投产比",],colModel:[{name:"channelName",index:"channel_name_",width:90,sortable:false},{name:"generalizeTime",width:100,sortable:false,formatter:function(c,d,e){return e.startTime.substring(11,16)+" - "+e.endTime.substring(11,16);
}},{name:"productName",index:"prodect_name_",width:60,sortable:false},{name:"cost",iondex:"cost_",width:60,sortable:false},{name:"callInTotal",index:"call_in_total",width:60,sortable:false,formatter:function(c,d,e){return e.lineCount;
}},{name:"oneCost",index:"one_cost_",width:100,sortable:false},{name:"plan",width:60,sortable:false,formatter:function(c,d,e){return"<a href='#' class='detail' profitType='place' csNo='"+e.hasLineSoCsNo+"'><span style='color:red;'>"+e.placeNum+"</span>"+"/<span style='color:blue;'>"+parseFloat(e.placeAmount).toFixed(2)+"</span></a>";
return e.placeNum+"/"+parseFloat(e.placeAmount).toFixed(2);}},{name:"planRate",index:"plan_rate_",width:60,sortable:false},{name:"planPutRate",index:"plan_put_rate_",width:60,sortable:false},{name:"audit",width:60,sortable:false,formatter:function(c,d,e){return"<a href='#' class='detail' profitType='confirm' csNo='"+e.hasLineSoCsNo+"'><span style='color:red;'>"+e.confirmNum+"</span>"+"/<span style='color:blue;'>"+parseFloat(e.confirmAmount).toFixed(2)+"</span></a>";
return e.confirmNum+"/"+parseFloat(e.confirmAmount).toFixed(2);}},{name:"confirmRate",index:"confirm_rate_",width:42,sortable:false},{name:"signAmount",index:"sign_amount_",width:70,sortable:true,formatter:function(c,d,e){return"<a href='#' class='detail' profitType='complete' csNo='"+e.hasLineSoCsNo+"'><span style='color:red;'>"+e.completeNum+"</span>"+"/<span style='color:blue;'>"+parseFloat(e.completeAmount).toFixed(2)+"</span></a>";
return e.completeNum+"/"+parseFloat(e.completeAmount).toFixed(2);}},{name:"completeRate",index:"complete_rate_",sortable:false,width:42},{name:"signPutRate",index:"sign_put_rate_",width:60,sortable:false},],});
},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(AdverPutAnalyzeReport._CONS_.GRID,a);},toPostParam:function(){var a=$("#adverPutSearchForm").serialize();
return a;}};