$(function(){var a=new LogisticsStatReport();a.init();});function LogisticsStatReport(){this.hadInit=false;this.isEdit=false;this.baseUrl=ctx+"/crm/report/logisticsStatReport/listData.htm";
}LogisticsStatReport._CONS_={EXPORT_URL:ctx+"/crm/report/logisticsStatReport/export.htm",GRID:"#logisticsStatReportGrid",PAGER:"#logisticsStatReportPager"};
LogisticsStatReport.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();$("#timeTypeSearch").val("month");ReportDateUtil.initDate(".report-content");
$("#timeTypeSearch").change();this._initJqgrid(this.toPostParam());}},_bindEventHander:function(){var a=this;$(".report-content").off("click","#searchBtn");
$(".report-content").on("click","#searchBtn",function(){a.reloadJqgrid(a.toPostParam());});$(".report-content").off("click",".exportExcel");$(".report-content").on("click",".exportExcel",function(){ButtonUtils.disableBtn("exportExcel");
FormUtils.submit(LogisticsStatReport._CONS_.EXPORT_URL,a.toPostParam(),function(b){ButtonUtils.enableBtn("exportExcel");if(b.success){DialogUtils.success(msgCode.Stat,b.msg+"成功");
}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});$(document).on("click",".detail",function(){var f=$("input[name=belongOgn]").val();
var h=$(this).attr("profitType");var i=$(this).attr("valueName");var b=$(this).attr("value");var d=null;if(h=="ship"){d="shipping,complete,close_reject";
}if(h=="unterwegs"){d="shipping";}if(h=="complete"){d="complete";}if(h=="reject"){d="close_reject";}var g=ReportDateUtil.getStartDateTimeRangeStr();var c=ReportDateUtil.getEndDateTimeRangeStr();
var e="/crm/report/logisticsStatReport/detail.htm"+"?scCode="+b+"&status="+d+"&timeStart="+g+"&timeEnd="+c+"&groupId="+f;JTTabUtils.addOrRefreshTab(ctx+e,i+"明细");
});$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
}};GroupUtils.selectGroupTreeBox(b);});},_initJqgrid:function(a){$(LogisticsStatReport._CONS_.GRID).JTJqgrid({url:this.baseUrl,footerrow:true,postData:a,multiselect:false,colNames:["名称","代收货款金额(元)","实付物流运费(元)","物流赔偿金额(元)","发货","金额","发货/金额","在途","金额","在途/金额","签收","金额","签收/金额","拒收","金额","拒收/金额"],colModel:[{name:"scName",width:90,index:"sc_name_",formatter:function(b,c,d){if(d.scName=="本页合计"){return"<span style='color:red;'>"+d.scName+"</span>";
}return d.scName;}},{name:"proxyAmount",width:90,index:"proxy_amount_",formatter:function(b,c,d){if(d.scName=="本页合计"){return"<span style='color:red;'>"+d.proxyAmount.toFixed(2)+"元</span>";
}else{return d.proxyAmount.toFixed(2);}}},{name:"actualAmount",width:90,index:"actual_amount_",formatter:function(b,c,d){if(d.scName=="本页合计"){return"<span style='color:red;'>"+d.actualAmount.toFixed(2)+"元</span>";
}else{return d.actualAmount.toFixed(2);}}},{name:"breakAmount",width:100,index:"break_amount_",formatter:function(b,c,d){if(d.scName=="本页合计"){return"<span style='color:red;'>"+d.breakAmount.toFixed(2)+"元</span>";
}else{return d.breakAmount.toFixed(2);}}},{name:"shippingCount",index:"shippingCount",hidedlg:true,hidden:true,sortable:false},{name:"shipAmountHide",sortable:false,index:"shippingAmount",hidedlg:true,hidden:true,sortable:false,formatter:function(b,c,d){return d.shippingAmount;
}},{name:"shippingAmount",width:100,index:"shippingAmount",formatter:function(b,c,d){if(d.scName=="本页合计"){return"<span style='color:red;'>"+d.shippingCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(d.shippingAmount).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='ship' value='"+d.scCode+"'  valueName='"+d.scName+"'><span style='color:red;'>"+d.shippingCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(d.shippingAmount).toFixed(2)+"</span></a>";
}}},{name:"unterwegsCount",index:"unterwegsCount",hidedlg:true,hidden:true,sortable:false},{name:"unterwegsAmountHide",sortable:false,index:"unterwegsAmount",hidedlg:true,hidden:true,sortable:false,formatter:function(b,c,d){return d.unterwegsAmount;
}},{name:"unterwegsAmount",width:100,index:"unterwegsAmount",formatter:function(b,c,d){if(d.scName=="本页合计"){return"<span style='color:red;'>"+d.unterwegsCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(d.unterwegsAmount).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='unterwegs' value='"+d.scCode+"'  valueName='"+d.scName+"'><span style='color:red;'>"+d.unterwegsCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(d.unterwegsAmount).toFixed(2)+"</span></a>";
}}},{name:"completeCount",index:"completeCount",hidedlg:true,hidden:true,sortable:false},{name:"completeAmountHide",sortable:false,index:"completeAmount",hidedlg:true,hidden:true,sortable:false,formatter:function(b,c,d){return d.completeAmount;
}},{name:"completeAmount",width:100,index:"completeAmount",formatter:function(b,c,d){if(d.scName=="本页合计"){return"<span style='color:red;'>"+d.completeCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(d.completeAmount).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='complete' value='"+d.scCode+"'  valueName='"+d.scName+"'><span style='color:red;'>"+d.completeCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(d.completeAmount).toFixed(2)+"</span></a>";
}}},{name:"rejectCount",index:"rejectCount",hidedlg:true,hidden:true,sortable:false},{name:"rejectAmountHide",sortable:false,index:"rejectAmount",hidedlg:true,hidden:true,sortable:false,formatter:function(b,c,d){return d.rejectAmount;
}},{name:"rejectAmount",width:100,index:"rejectAmount",formatter:function(b,c,d){if(d.scName=="本页合计"){return"<span style='color:red;'>"+d.rejectCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(d.rejectAmount).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='reject' value='"+d.scCode+"'  valueName='"+d.scName+"'><span style='color:red;'>"+d.rejectCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(d.rejectAmount).toFixed(2)+"</span></a>";
}}},],pager:LogisticsStatReport._CONS_.PAGER,gridComplete:function(){var l=$(LogisticsStatReport._CONS_.GRID).jqGrid("getCol","proxyAmount",true,"sum");
var e=$(LogisticsStatReport._CONS_.GRID).jqGrid("getCol","actualAmount",true,"sum");var i=$(LogisticsStatReport._CONS_.GRID).jqGrid("getCol","breakAmount",true,"sum");
var j=$(LogisticsStatReport._CONS_.GRID).jqGrid("getCol","shippingCount",true,"sum");var f=$(LogisticsStatReport._CONS_.GRID).jqGrid("getCol","shipAmountHide",true,"sum");
var b=$(LogisticsStatReport._CONS_.GRID).jqGrid("getCol","unterwegsCount",true,"sum");var c=$(LogisticsStatReport._CONS_.GRID).jqGrid("getCol","unterwegsAmountHide",true,"sum");
var g=$(LogisticsStatReport._CONS_.GRID).jqGrid("getCol","completeCount",true,"sum");var k=$(LogisticsStatReport._CONS_.GRID).jqGrid("getCol","completeAmountHide",true,"sum");
var m=$(LogisticsStatReport._CONS_.GRID).jqGrid("getCol","rejectCount",true,"sum");var d=$(LogisticsStatReport._CONS_.GRID).jqGrid("getCol","rejectAmountHide",true,"sum");
var h=l+i;$(LogisticsStatReport._CONS_.GRID).footerData("set",{scName:"本页合计",proxyAmount:l,actualAmount:e,breakAmount:i,shippingCount:j,shippingAmount:f,unterwegsCount:b,unterwegsAmount:c,completeCount:g,completeAmount:k,rejectCount:m,rejectAmount:d});
}});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(LogisticsStatReport._CONS_.GRID,a);},toPostParam:function(){var a=$("input[name=belongOgn]").val();
var b=$(this).closest("form").serialize();b=b+"&Q__D__BW__ship.create_time_="+ReportDateUtil.getDateTimeRangeStr();b+="&reportType="+$("input[name=reportKey]").val();
b+="&Q__S__EQ__entity.group_id_="+a;return b;}};