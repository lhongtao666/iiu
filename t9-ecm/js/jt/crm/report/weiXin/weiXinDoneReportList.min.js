$(function(){var a=new WeiXinDoneReportList();a.init();});function WeiXinDoneReportList(){this.hadInit=false;this.isEdit=false;}WeiXinDoneReportList._CONS_={LIST_DATA_URL:ctx+"/crm/report/weiXinDoneReport/listData.htm",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",EXPORT_URL:ctx+"/crm/report/weiXinDoneReport/export.htm",GRID:"#weixinDoneReportGrid",PAGER:"#weixinDoneReportPager"};
WeiXinDoneReportList.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();ReportDateUtil.initDate(".report-content");
$("#timeTypeSearch").change();a._initJqgrid(a.toPostParam());}},_bindEventHander:function(){var a=this;$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
FormUtils.loadData(WeiXinDoneReportList._CONS_.EMPLOYEE_LIST_URL+"?groupId="+c+"&type=statistics,dept_manager",function(e){var f=new StringBuffer();f.append('<option value="">请选择</option>');
for(var d=0;d<e.length;d++){f.append("<option value='"+e[d].id+"'>"+e[d].aid+":"+e[d].name+"</option>");}$("#belongEmployee").empty().append(f.toString());
});}};GroupUtils.selectGroupTreeBox(b);});$("#searchBtn").on("click",function(){var b=a.toPostParam();a.params=b;a.reloadJqgrid(b);});$(".exportExcel").on("click",function(){ButtonUtils.disableBtn("exportExcel");
FormUtils.submit(WeiXinDoneReportList._CONS_.EXPORT_URL,a.toPostParam(),function(b){ButtonUtils.enableBtn("exportExcel");if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");
}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});$(document).on("click",".detail",function(){var b=$(this).attr("csType");
var e=$(this).attr("value");var d=$(this).attr("aidValue");var c="/crm/cs/csEntity/subList.htm?Q__D__EQ__create_time_="+ReportDateUtil.getDateTimeRangeStr()+"&belongEmployee="+e+"&csType="+b;
if(currentUserId==e){c="/crm/cs/csEntity/list.htm?Q__D__EQ__create_time_="+ReportDateUtil.getDateTimeRangeStr()+"&belongEmployee="+e+"&csType="+b;}JTTabUtils.addOrRefreshTab(ctx+c,d+"的客户 ");
});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(WeiXinDoneReportList._CONS_.GRID,a);},toPostParam:function(){var a=$("#searchForm").serialize();
if(ReportDateUtil.getDateTimeRangeStr()!=","){a+="&Q__D__BW__so.complete_time_="+ReportDateUtil.getDateTimeRangeStr();}return a;},_initJqgrid:function(b){var a=this;
$(WeiXinDoneReportList._CONS_.GRID).JTJqgrid({url:WeiXinDoneReportList._CONS_.LIST_DATA_URL,postData:b,multiselect:false,footerrow:true,rowNum:-1,colNames:["部门","员工","月目标业绩","实际业绩","新进客户","成交新客","转化率","新客客单价","成交老客","老客客单价"],colModel:[{name:"groupName",width:40,sortable:false},{name:"employeeName",width:40,sortable:false,formatter:function(c,d,e){return e.employeeName+":"+e.employeeAid;
}},{name:"monthProfit",width:40,sortable:false},{name:"profit",width:40,sortable:false},{name:"weiXinAdd",width:40,sortable:false},{name:"csDoneNew",width:40,sortable:false,formatter:function(c,d,e){if(e.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+e.csDoneNew+"</span>"+"/<span style='color:blue;'>"+parseFloat(e.csDoneNewAmount).toFixed(2)+"</span>";
}else{return"<a href='#' csType='newCs' aidValue='"+e.employeeAid+"' value='"+e.employeeId+"'><span style='color:red;'>"+e.csDoneNew+"</span>"+"/<span style='color:blue;'>"+parseFloat(e.csDoneNewAmount).toFixed(2)+"</span></a>";
}}},{name:"percent",width:40,sortable:false},{name:"newCsPrice",width:40,sortable:false},{name:"csDoneOld",width:40,sortable:false,formatter:function(c,d,e){if(e.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+e.csDoneOld+"</span>"+"/<span style='color:blue;'>"+parseFloat(e.csDoneOldAmount).toFixed(2)+"</span>";
}else{return"<a href='#' csType='oldCs' aidValue='"+e.employeeAid+"' value='"+e.employeeId+"'><span style='color:red;'>"+e.csDoneOld+"</span>"+"/<span style='color:blue;'>"+parseFloat(e.csDoneOldAmount).toFixed(2)+"</span></a>";
}}},{name:"oldCsPrice",width:40,sortable:false}],beforeProcessing:function(d){var c={groupName:"总计："+d.records,monthProfit:d.footData.monthProfit,profit:d.footData.profit,weiXinAdd:d.footData.weiXinAdd,csDoneNew:d.footData.csDoneNew,csDoneNewAmount:d.footData.csDoneNewAmount.toFixed(0),percent:d.footData.percent,newCsPrice:d.footData.newCsPrice,csDoneOld:d.footData.csDoneOld,csDoneOldAmount:d.footData.csDoneOldAmount,oldCsPrice:d.footData.oldCsPrice};
a.footerData=c;},gridComplete:function(){if(a.footerData){var c=$(WeiXinDoneReportList._CONS_.GRID).jqGrid("getGridParam","records");a.footerData.aid="总计：<span style='color:red;'>"+c+"</span>个";
$(WeiXinDoneReportList._CONS_.GRID).footerData("set",a.footerData);}},});}};