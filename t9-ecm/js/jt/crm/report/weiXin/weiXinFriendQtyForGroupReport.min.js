$(function(){var a=new WeiXinFriendQtyForGroupReport();a.init();});function WeiXinFriendQtyForGroupReport(){this.hadInit=false;this.baseUrl=ctx+"/crm/report/weiXinFriendQtyForGroupReport/listData.htm";
}WeiXinFriendQtyForGroupReport._CONS_={EXPORT_URL:ctx+"/crm/report/weiXinFriendQtyForGroupReport/export.htm",GRID:"#weiXinFriendQtyForGroupReportGrid",};
WeiXinFriendQtyForGroupReport.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();$("#timeTypeSearch").val("day");
ReportDateUtil.initDate(".report-content");$("#timeTypeSearch").change();this._initJqgrid(this.toPostParam());}},_bindEventHander:function(){var a=this;
$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c,d){$("input[name=belongOgn]").val(d);
}};GroupUtils.selectGroupTreeBox(b);});$(".report-content").off("click","#searchBtn");$(".report-content").on("click","#searchBtn",function(){a.reloadJqgrid(a.toPostParam());
});$(".report-content").off("click",".exportExcel");$(".report-content").on("click",".exportExcel",function(){ButtonUtils.disableBtn("exportExcel");FormUtils.submit(WeiXinFriendQtyForGroupReport._CONS_.EXPORT_URL,a.toPostParam(),function(b){ButtonUtils.enableBtn("exportExcel");
if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});$(document).on("click",".showDelFriendDetail",function(){var c=$(this).attr("value").split(",");var b=ReportDateUtil.getDateTimeRangeStr().split(",");
var d={beginTime:b[0],endTime:b[1],groupId:c[0],groupName:c[1],friendForType:"group"};var e=ctx+"/crm/report/weiXinFriendDeleteReport/toDetailList.htm?beginTime="+d.beginTime+"&endTime="+d.endTime+"&groupId="+d.groupId+"&friendForType="+d.friendForType;
JTTabUtils.addOrRefreshTab(e,d.groupName+"删粉明细");});$(document).on("click","#clearSearchBtn",function(){FormUtils.clear("weiXinFriendQtyForGroupSearchForm");
$("#timeTypeSearch").val("day");ReportDateUtil.initDate(".report-content");$("#timeTypeSearch").change();});},_initJqgrid:function(a){$(WeiXinFriendQtyForGroupReport._CONS_.GRID).JTJqgrid({url:this.baseUrl,postData:a,multiselect:false,footerrow:true,rowNum:-1,colNames:["部门","进粉数量","删粉数量(hidden)","删粉数量","已关联客户"],colModel:[{name:"groupName",width:120},{name:"friendQty",width:120},{name:"delFriendQty",width:120,hidden:true},{name:"delFriendQty",width:120,formatter:function(b,c,d){if(d.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+d.delFriendQty+"</span>";
}else{return"<a class='showDelFriendDetail' value='"+d.groupId+","+d.groupName+"'>"+d.delFriendQty+"</a>";}}},{name:"relateQty",width:120}],gridComplete:function(){var b=$(WeiXinFriendQtyForGroupReport._CONS_.GRID).jqGrid("getGridParam","records");
var e=$(WeiXinFriendQtyForGroupReport._CONS_.GRID).jqGrid("getCol","friendQty",true,"sum");var d=$(WeiXinFriendQtyForGroupReport._CONS_.GRID).jqGrid("getCol","relateQty",true,"sum");
var c=$(WeiXinFriendQtyForGroupReport._CONS_.GRID).jqGrid("getCol","delFriendQty",true,"sum");$(WeiXinFriendQtyForGroupReport._CONS_.GRID).jqGrid("footerData","set",{"groupName":"总计：<span style='color:red;'>"+b+"</span>条","friendQty":"<span style='color:red;'>"+e+"</span>","delFriendQty":"<span style='color:red;'>"+c+"</span>","relateQty":"<span style='color:red;'>"+d+"</span>"});
},});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(WeiXinFriendQtyForGroupReport._CONS_.GRID,a);},toPostParam:function(){var a=ReportDateUtil.getDateTimeRangeStr().split(",");
var b={beginTime:a[0],endTime:a[1],radioValue:$("input[type='radio']:checked").val(),groupKey:$("input[name='belongOgn']").val()};return b;},};