$(function(){var a=new WeiXinAdverPutAnalyzeReport();a.init();});function WeiXinAdverPutAnalyzeReport(){this.hadInit=false;this.isEdit=false;}WeiXinAdverPutAnalyzeReport._CONS_={LIST_DATA_URL:ctx+"/crm/report/weiXinAdverPutAnalyzeReport/listData.htm",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",EXPORT_URL:ctx+"/crm/ou/employee/listEmployees.htm",EXPORT_DATA_URL:ctx+"/crm/report/weiXinAdverPutAnalyzeReport/exportData.htm",GRID:"#weiXinAdverPutAnalyzeReportGrid",PAGER:"#weiXinAdverPutAnalyzeReportPager"};
WeiXinAdverPutAnalyzeReport.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();ReportDateUtil.initDate(".report-content");
$("#periodDaySearch").val(DateUtils.format(new Date(),"yyyy-MM-dd"));$("#timeTypeSearch").change();a._initChannelSelect();a._initJqgrid();}},_bindEventHander:function(){var a=this;
$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
FormUtils.loadData(WeiXinAdverPutAnalyzeReport._CONS_.EMPLOYEE_LIST_URL+"?groupId="+c+"&type=statistics,dept_manager",function(e){var f=new StringBuffer();
f.append('<option value="">请选择</option>');for(var d=0;d<e.length;d++){f.append("<option value='"+e[d].id+"'>"+e[d].aid+":"+e[d].name+"</option>");}$("#belongEmployee").empty().append(f.toString());
});}};GroupUtils.selectGroupTreeBox(b);});$(".winXinAdverPutSearch").on("click",function(){var b=a.toPostParam();a.params=b;a.reloadJqgrid(b);});$(document).on("click",".prevDay",function(){$("#periodDaySearch").val(DateUtils.getBeforeDate(1,$("#periodDaySearch").val()));
});$(document).on("click",".nextDay",function(){$("#periodDaySearch").val(DateUtils.getAfterDate(1,$("#periodDaySearch").val()));});$(document).on("click",".toDay",function(){$("#periodDaySearch").val(DateUtils.format(new Date(),"yyyy-MM-dd"));
});$(".exportExcel").on("click",function(){ButtonUtils.disableBtn("exportExcel");FormUtils.submit(WeiXinAdverPutAnalyzeReport._CONS_.EXPORT_DATA_URL,a.toPostParam(),function(b){ButtonUtils.enableBtn("exportExcel");
if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(WeiXinAdverPutAnalyzeReport._CONS_.GRID,a);},_initChannelSelect:function(){var a=ctx+"/ec/media/mediaChannel/findActived.htm";
var b=new StringBuffer();b.append("<option value=''>请选择</option>");FormUtils.loadData(a,function(d){if(d&&d.length>0){for(var c=0;c<d.length;c++){b.append("<option value='"+d[c].id+"'>"+d[c].name+"</option>");
}}$("#channelSearch").empty().append(b.toString());$("#channelSearch").chosen("destroy");$("#channelSearch").chosen();});},toPostParam:function(){var d=$("#weiXinAdverPutSearchForm").serialize();
var c=$("#channelSearch").val();if(c){c=c+"";var a=c.split(",");if(a.length){for(var b=0;b<a.length;b++){d+="&channelSearch[]="+a[b];}}}d+="&Q__D__BW__period.day_="+ReportDateUtil.getDateTimeRangeStr();
return d;},_initJqgrid:function(){var b="";var a=this;b+="&Q__D__BW__period.day_="+ReportDateUtil.getDateTimeRangeStr();$(WeiXinAdverPutAnalyzeReport._CONS_.GRID).JTJqgrid({url:WeiXinAdverPutAnalyzeReport._CONS_.LIST_DATA_URL,postData:b,pager:WeiXinAdverPutAnalyzeReport._CONS_.PAGER,multiselect:false,footerrow:false,colNames:["日期","媒体","流量量（先隐藏）","进粉数量","进粉率","一次成交数量","一次成交率","二次成交数量","二次成交率","三次及以上成交量","三次及以上成交率",],colModel:[{name:"periodDay",width:40,sortable:false},{name:"channelName",index:"channel_name_",width:40,sortable:false},{name:"viewNum",index:"view_num_",width:40,hidden:true,sortable:false},{name:"friendQty",index:"friend_qty_",width:40,sortable:false},{name:"friendQtyRate",hidden:true,width:40,sortable:false},{name:"allComplete",width:40,sortable:false},{name:"allCompleteRate",width:40,sortable:false},{name:"twoComplete",width:40,sortable:false},{name:"twoCompleteRate",width:40,sortable:false},{name:"moreComplete",width:40,sortable:false},{name:"moreCompleteRate",width:40,sortable:false},],});
}};