$(function(){var a=new WeiXinFriendDeleteReport();a.init();});function WeiXinFriendDeleteReport(){this.hadInit=false;this.baseUrl=ctx+"/crm/report/weiXinFriendDeleteReport/listData.htm";
}WeiXinFriendDeleteReport._CONS_={EXPORT_URL:ctx+"/crm/report/weiXinFriendDeleteReport/export.htm",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",GRID:"#weiXinFriendDeleteReportGrid",};
WeiXinFriendDeleteReport.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();$("#timeTypeSearch").val("day");ReportDateUtil.initDate(".report-content");
$("#timeTypeSearch").change();this._initJqgrid(this.toPostParam());this._buildEmployeeSelect();}},_buildEmployeeSelect:function(a){$.ajax({type:"GET",url:ctx+"/crm/ou/employee/listEmployees.htm"+"?groupId="+(a?a:""),contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(c){if(c&&c.length>0){var d=new StringBuffer();
d.append("<option value=''>请选择</option>");for(var b=0;b<c.length;b++){d.append("<option value='"+c[b].id+"'>"+c[b].aid+":"+c[b].name+"</option>");}$("#belongEmployeeSearch").empty().append(d.toString()).select2();
}}});},_bindEventHander:function(){var a=this;$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c,d){$("input[name=belongOgn]").val(d);
FormUtils.loadData(PerformanceForEmpReport._CONS_.EMPLOYEE_LIST_URL+"?groupId="+c+"&type=statistics,dept_manager",function(f){var g=new StringBuffer();
g.append('<option value="">请选择</option>');for(var e=0;e<f.length;e++){g.append("<option value='"+f[e].id+"'>"+f[e].aid+":"+f[e].name+"</option>");}$("#belongEmployeeSearch").empty().append(g.toString());
});}};GroupUtils.selectGroupTreeBox(b);});$(".report-content").off("click","#searchBtn");$(".report-content").on("click","#searchBtn",function(){a.reloadJqgrid(a.toPostParam());
});$(".report-content").off("click",".exportExcel");$(".report-content").on("click",".exportExcel",function(){ButtonUtils.disableBtn("exportExcel");FormUtils.submit(WeiXinFriendDeleteReport._CONS_.EXPORT_URL,a.toPostParam(),function(b){ButtonUtils.enableBtn("exportExcel");
if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});$(document).on("click",".showDetail",function(){var c=$(this).attr("value").split(",");var b=ReportDateUtil.getDateTimeRangeStr().split(",");var d={beginTime:b[0],endTime:b[1],employeeId:c[0],employeeName:c[1]};
var e=ctx+"/crm/report/weiXinFriendDeleteReport/toDetailList.htm?beginTime="+d.beginTime+"&endTime="+d.endTime+"&employeeId="+d.employeeId;JTTabUtils.addOrRefreshTab(e,d.employeeName+"删粉明细");
});},_initJqgrid:function(a){$(WeiXinFriendDeleteReport._CONS_.GRID).JTJqgrid({url:this.baseUrl,postData:a,multiselect:false,footerrow:true,rowNum:-1,colNames:["部门","员工/工号","删粉数量"],colModel:[{name:"groupName",width:120},{name:"employeeName",width:120,formatter:function(b,c,d){return"<a class='showDetail' value='"+d.employeeId+","+d.employeeName+"'>"+d.employeeName+" : "+d.aid+"</a>";
}},{name:"deleteQty",width:120}],gridComplete:function(){var b=$(WeiXinFriendDeleteReport._CONS_.GRID).jqGrid("getGridParam","records");var c=$(WeiXinFriendDeleteReport._CONS_.GRID).jqGrid("getCol","deleteQty",true,"sum");
$(WeiXinFriendDeleteReport._CONS_.GRID).jqGrid("footerData","set",{"groupName":"总计：<span style='color:red;'>"+b+"</span>条","deleteQty":"<span style='color:red;'>"+c+"</span>"});
},});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(WeiXinFriendDeleteReport._CONS_.GRID,a);},toPostParam:function(){var a=ReportDateUtil.getDateTimeRangeStr().split(",");
var b={beginTime:a[0],endTime:a[1],groupKey:$("input[name='belongOgn']").val(),belongEmployee:$("select[name='belongEmployee']").val(),};return b;},};