$(function(){var a=new EmpWxFriendQtyReport();a.init();});function EmpWxFriendQtyReport(){this.hadInit=false;this.baseUrl=ctx+"/crm/report/empWxFriendQtyReport/listData.htm";
}EmpWxFriendQtyReport._CONS_={EXPORT_URL:ctx+"/crm/report/empWxFriendQtyReport/export.htm",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",GRID:"#empWxFriendQtyReportGrid",};
EmpWxFriendQtyReport.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();$("#timeTypeSearch").val("day");ReportDateUtil.initDate(".report-content");
$("#timeTypeSearch").change();this._initJqgrid(this.toPostParam());this._buildEmployeeSelect();}},_buildEmployeeSelect:function(a){$.ajax({type:"GET",url:ctx+"/crm/ou/employee/listEmployees.htm"+"?groupId="+(a?a:""),contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(c){if(c&&c.length>0){var d=new StringBuffer();
d.append("<option value=''>请选择</option>");for(var b=0;b<c.length;b++){d.append("<option value='"+c[b].id+"'>"+c[b].aid+":"+c[b].name+"</option>");}$("#belongEmployeeSearch").empty().append(d.toString()).select2();
}}});},_bindEventHander:function(){var a=this;$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c,d){$("input[name=belongOgn]").val(d);
FormUtils.loadData(EmpWxFriendQtyReport._CONS_.EMPLOYEE_LIST_URL+"?groupId="+c+"&type=statistics,dept_manager",function(f){var g=new StringBuffer();g.append('<option value="">请选择</option>');
for(var e=0;e<f.length;e++){g.append("<option value='"+f[e].id+"'>"+f[e].aid+":"+f[e].name+"</option>");}$("#belongEmployeeSearch").empty().append(g.toString());
});}};GroupUtils.selectGroupTreeBox(b);});$(".report-content").off("click","#searchBtn");$(".report-content").on("click","#searchBtn",function(){a.reloadJqgrid(a.toPostParam());
});$(".report-content").on("click","#clearSearchBtn",function(){FormUtils.clear("weiXinFriendQtySearchForm");$("#timeTypeSearch").val("day");ReportDateUtil.initDate(".report-content");
$("#timeTypeSearch").change();});$(".report-content").off("click",".exportExcel");$(".report-content").on("click",".exportExcel",function(){ButtonUtils.disableBtn("exportExcel");
FormUtils.submit(EmpWxFriendQtyReport._CONS_.EXPORT_URL,a.toPostParam(),function(b){ButtonUtils.enableBtn("exportExcel");if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");
}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});$(document).on("click",".showDetail",function(){var h=a.toPostParam();
var f=$(this).attr("value");var d=$(this).attr("empName");var e=$(this).attr("empAlias");var g=f+"-"+(parseInt(f)+1);var b=new RegExp(",");if(b.test(f)){var c=f.split(",")[0];
g=c+"-"+(parseInt(c)+2);}var i=ctx+"/crm/report/addedFriendsTimeReport/toDetailList.htm?beginTime="+h.beginTime+"&endTime="+h.endTime+"&radioValue="+h.radioValue+"&groupKey="+h.groupKey+"&timeFrame="+f+"&employeeAlias="+e;
JTTabUtils.addOrRefreshTab(i,d+":"+g+"点"+"进粉明细");});$(document).on("click",".showFriendDetail",function(){var e=$(this).attr("value").split(",");var c=ReportDateUtil.getDateTimeRangeStr().split(",");
var b=$("input[type='radio']:checked").val();var d={beginTime:c[0],endTime:c[1],employeeName:e[0],employeeId:e[1],radioValue:b,employeeAlias:e[2],};JTTabUtils.addOrRefreshTab(ctx+"/crm/report/weiXinFriendQtyReport/toDetailList.htm?beginTime="+d.beginTime+"&endTime="+d.endTime+"&employeeId="+d.employeeId+"&radioValue="+d.radioValue+"&employeeAlias="+d.employeeAlias,d.employeeName+"进粉明细");
});},_initJqgrid:function(a){$(EmpWxFriendQtyReport._CONS_.GRID).JTJqgrid({url:this.baseUrl,postData:a,multiselect:false,footerrow:true,rowNum:-1,colNames:["部门","员工","微信号","0-2(hide)","2-4(hide)","4-6(hide)","6-8(hide)","8-9(hide)","9-10(hide)","10-11(hide)","11-12(hide)","12-13(hide)","13-14(hide)","14-15(hide)","15-16(hide)","16-17(hide)","17-18(hide)","18-20(hide)","20-22(hide)","22-24(hide)","0-2","2-4","4-6","6-8","8-9","9-10","10-11","11-12","12-13","13-14","14-15","15-16","16-17","17-18","18-20","20-22","22-24","合计","合计(hide)"],colModel:[{name:"groupName",width:120},{name:"employeeName",width:120,formatter:function(b,c,d){return d.aid+":"+d.employeeName;
}},{name:"employeeAlias",width:150},{name:"one",width:120,hidedlg:true,hidden:true},{name:"two",width:120,hidedlg:true,hidden:true},{name:"three",width:120,hidedlg:true,hidden:true},{name:"four",width:120,hidedlg:true,hidden:true},{name:"five",width:120,hidedlg:true,hidden:true},{name:"six",width:120,hidedlg:true,hidden:true},{name:"seven",width:120,hidedlg:true,hidden:true},{name:"eight",width:120,hidedlg:true,hidden:true},{name:"nine",width:120,hidedlg:true,hidden:true},{name:"ten",width:120,hidedlg:true,hidden:true},{name:"eleven",width:120,hidedlg:true,hidden:true},{name:"twelve",width:120,hidedlg:true,hidden:true},{name:"thirteen",width:120,hidedlg:true,hidden:true},{name:"fourteen",width:120,hidedlg:true,hidden:true},{name:"fifteen",width:120,hidedlg:true,hidden:true},{name:"sixteen",width:120,hidedlg:true,hidden:true},{name:"seventeen",width:120,hidedlg:true,hidden:true},{name:"one",width:110,formatter:function(b,c,d){if((d.timeFrame+"").indexOf("总计：")>-1){return"<span style='color:red;'>"+d.one+"</span>";
}else{return"<a href='#' class='showDetail' empAlias='"+d.employeeUserName+"' empName='"+d.employeeName+"' value='00,01'>"+d.one+"</a>";}}},{name:"two",width:110,formatter:function(b,c,d){if((d.timeFrame+"").indexOf("总计：")>-1){return"<span style='color:red;'>"+d.two+"</span>";
}else{return"<a href='#' class='showDetail' empAlias='"+d.employeeUserName+"' empName='"+d.employeeName+"' value='02,03'>"+d.two+"</a>";}}},{name:"three",width:110,formatter:function(b,c,d){if((d.timeFrame+"").indexOf("总计：")>-1){return"<span style='color:red;'>"+d.three+"</span>";
}else{return"<a href='#' class='showDetail' empAlias='"+d.employeeUserName+"' empName='"+d.employeeName+"' value='04,05'>"+d.three+"</a>";}}},{name:"four",width:110,formatter:function(b,c,d){if((d.timeFrame+"").indexOf("总计：")>-1){return"<span style='color:red;'>"+d.four+"</span>";
}else{return"<a href='#' class='showDetail' empAlias='"+d.employeeUserName+"' empName='"+d.employeeName+"' value='06,07'>"+d.four+"</a>";}}},{name:"five",width:110,formatter:function(b,c,d){if((d.timeFrame+"").indexOf("总计：")>-1){return"<span style='color:red;'>"+d.five+"</span>";
}else{return"<a href='#' class='showDetail' empAlias='"+d.employeeUserName+"' empName='"+d.employeeName+"' value='08'>"+d.five+"</a>";}}},{name:"six",width:110,formatter:function(b,c,d){if((d.timeFrame+"").indexOf("总计：")>-1){return"<span style='color:red;'>"+d.six+"</span>";
}else{return"<a href='#' class='showDetail' empAlias='"+d.employeeUserName+"' empName='"+d.employeeName+"' value='09'>"+d.six+"</a>";}}},{name:"seven",width:110,formatter:function(b,c,d){if((d.timeFrame+"").indexOf("总计：")>-1){return"<span style='color:red;'>"+d.seven+"</span>";
}else{return"<a href='#' class='showDetail' empAlias='"+d.employeeUserName+"' empName='"+d.employeeName+"' value='10'>"+d.seven+"</a>";}}},{name:"eight",width:110,formatter:function(b,c,d){if((d.timeFrame+"").indexOf("总计：")>-1){return"<span style='color:red;'>"+d.eight+"</span>";
}else{return"<a href='#' class='showDetail' empAlias='"+d.employeeUserName+"' empName='"+d.employeeName+"' value='11'>"+d.eight+"</a>";}}},{name:"nine",width:110,formatter:function(b,c,d){if((d.timeFrame+"").indexOf("总计：")>-1){return"<span style='color:red;'>"+d.nine+"</span>";
}else{return"<a href='#' class='showDetail' empAlias='"+d.employeeUserName+"' empName='"+d.employeeName+"' value='12'>"+d.nine+"</a>";}}},{name:"ten",width:110,formatter:function(b,c,d){if((d.timeFrame+"").indexOf("总计：")>-1){return"<span style='color:red;'>"+d.ten+"</span>";
}else{return"<a href='#' class='showDetail' empAlias='"+d.employeeUserName+"' empName='"+d.employeeName+"' value='13'>"+d.ten+"</a>";}}},{name:"eleven",width:110,formatter:function(b,c,d){if((d.timeFrame+"").indexOf("总计：")>-1){return"<span style='color:red;'>"+d.eleven+"</span>";
}else{return"<a href='#' class='showDetail' empAlias='"+d.employeeUserName+"' empName='"+d.employeeName+"' value='14'>"+d.eleven+"</a>";}}},{name:"twelve",width:110,formatter:function(b,c,d){if((d.timeFrame+"").indexOf("总计：")>-1){return"<span style='color:red;'>"+d.twelve+"</span>";
}else{return"<a href='#' class='showDetail' empAlias='"+d.employeeUserName+"' empName='"+d.employeeName+"' value='15'>"+d.twelve+"</a>";}}},{name:"thirteen",width:110,formatter:function(b,c,d){if((d.timeFrame+"").indexOf("总计：")>-1){return"<span style='color:red;'>"+d.thirteen+"</span>";
}else{return"<a href='#' class='showDetail' empAlias='"+d.employeeUserName+"'  empName='"+d.employeeName+"' value='16'>"+d.thirteen+"</a>";}}},{name:"fourteen",width:110,formatter:function(b,c,d){if((d.timeFrame+"").indexOf("总计：")>-1){return"<span style='color:red;'>"+d.fourteen+"</span>";
}else{return"<a href='#' class='showDetail' empAlias='"+d.employeeUserName+"' empName='"+d.employeeName+"' value='17'>"+d.fourteen+"</a>";}}},{name:"fifteen",width:110,formatter:function(b,c,d){if((d.timeFrame+"").indexOf("总计：")>-1){return"<span style='color:red;'>"+d.fifteen+"</span>";
}else{return"<a href='#' class='showDetail' empAlias='"+d.employeeUserName+"' empName='"+d.employeeName+"' value='18,19'>"+d.fifteen+"</a>";}}},{name:"sixteen",width:110,formatter:function(b,c,d){if((d.timeFrame+"").indexOf("总计：")>-1){return"<span style='color:red;'>"+d.sixteen+"</span>";
}else{return"<a href='#' class='showDetail' empAlias='"+d.employeeUserName+"' empName='"+d.employeeName+"' value='20,21'>"+d.sixteen+"</a>";}}},{name:"seventeen",width:110,formatter:function(b,c,d){if((d.timeFrame+"").indexOf("总计：")>-1){return"<span style='color:red;'>"+d.seventeen+"</span>";
}else{return"<a href='#' class='showDetail' empAlias='"+d.employeeUserName+"' empName='"+d.employeeName+"' value='22,23'>"+d.seventeen+"</a>";}}},{name:"friendQty",width:110,formatter:function(b,c,d){return"<a class='showFriendDetail' style='color:bule;' value='"+d.employeeName+","+d.employeeId+","+d.employeeUserName+"'>"+d.friendQty+"</a>";
}},{name:"friendQtyHide",width:110,hidedlg:true,hidden:true,formatter:function(b,c,d){return d.friendQty;}},],gridComplete:function(){var q=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getGridParam","records");
var k=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","one",true,"sum");var j=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","two",true,"sum");
var i=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","three",true,"sum");var g=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","four",true,"sum");
var f=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","five",true,"sum");var e=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","six",true,"sum");
var d=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","seven",true,"sum");var c=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","eight",true,"sum");
var b=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","nine",true,"sum");var t=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","ten",true,"sum");
var s=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","eleven",true,"sum");var r=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","twelve",true,"sum");
var p=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","thirteen",true,"sum");var o=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","fourteen",true,"sum");
var n=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","fifteen",true,"sum");var m=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","sixteen",true,"sum");
var l=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","seventeen",true,"sum");var h=$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("getCol","friendQtyHide",true,"sum");
$(EmpWxFriendQtyReport._CONS_.GRID).jqGrid("footerData","set",{"groupName":"总计：<span style='color:red;'>"+q+"</span>条","one":"<span style='color:red;'>"+k+"</span>","two":"<span style='color:red;'>"+j+"</span>","three":"<span style='color:red;'>"+i+"</span>","four":"<span style='color:red;'>"+g+"</span>","five":"<span style='color:red;'>"+f+"</span>","six":"<span style='color:red;'>"+e+"</span>","seven":"<span style='color:red;'>"+d+"</span>","eight":"<span style='color:red;'>"+c+"</span>","nine":"<span style='color:red;'>"+b+"</span>","ten":"<span style='color:red;'>"+t+"</span>","eleven":"<span style='color:red;'>"+s+"</span>","twelve":"<span style='color:red;'>"+r+"</span>","thirteen":"<span style='color:red;'>"+p+"</span>","fourteen":"<span style='color:red;'>"+o+"</span>","fifteen":"<span style='color:red;'>"+n+"</span>","sixteen":"<span style='color:red;'>"+m+"</span>","seventeen":"<span style='color:red;'>"+l+"</span>","friendQty":"<span style='color:blue;'>"+h+"</span>"});
},});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(EmpWxFriendQtyReport._CONS_.GRID,a);},toPostParam:function(){var a=ReportDateUtil.getDateTimeRangeStr().split(",");
var b={beginTime:a[0],endTime:a[1],radioValue:$("input[type='radio']:checked").val(),groupKey:$("input[name='belongOgn']").val(),belongEmployee:$("select[name='belongEmployee']").val()};
return b;},};