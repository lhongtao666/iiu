$(function(){var a=new CsSatifactionReport();a.init();});function CsSatifactionReport(){this.hadInit=false;}CsSatifactionReport._CONS_={GRID:"#csSatifactionReportGrid",PAGER:"#csSatifactionReportPager",URL_LIST_DATA:ctx+"/gl/cti/trkRecordCsReport/csSatifactionReport.htm",};
CsSatifactionReport.prototype={init:function(a){if("hidden"==showPJ){DialogUtils.error(msgCode.ERROR,"该报表没有开放,请联系管理员");return;}if(!this.hadInit){this.hadInit=true;
this._bindEventHander();this._initJqgrid(a);this._initEmployeeSelect();}},_initEmployeeSelect:function(a){FormUtils.loadData(ctx+"/crm/ou/employee/listEmployees.htm?groupId="+a+"&type=dept_manager",function(c){$("#agentId").empty();
var d=new StringBuffer();d.append("<option value=''>请选择</option>");if(c&&c.length){for(var b=0;b<c.length;b++){d.append("<option value='"+c[b].aid+"'>"+c[b].aid+":"+c[b].name+"</option>");
}}$("#agentId").append(d.toString()).select2();},null,true);},_bindEventHander:function(){var a=this;$("body").on("click","[name=groupName]",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$('input[name="groupId"]').val(),container:"groupName",fn:function(c,b){$('input[name="orgId"]').val(c);
$('input[name="orgKey"]').val(b);a._initEmployeeSelect(c);}});});$("body").on("click",".export",function(){if(!$('input[name="startTime"]').val()){var b=new Date();
var c=b.currentDate()+"00:00:00";$('input[name="startTime"]').val(c);}var d=$("#searchForm").closest("form").serialize();FormUtils.submit(ctx+"/crm/report/reportEntity/exportCsSatifactionReport.htm",d,function(e){if(e.success){DialogUtils.success(msgCode.SUCCESS,e.msg);
}else{DialogUtils.error(msgCode.ERROR,e.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});$(".list_wrapper").on("click",".csSatifactionSearch",function(){if(!$('input[name="startTime"]').val()){var b=new Date();
var c=b.currentDate()+"00:00:00";$('input[name="startTime"]').val(c);}var d=$(this).closest("form").serialize();a.reloadJqgrid(d);});$("#searchForm").on("keypress",function(b){if(b.keyCode=="13"){$(".csSatifactionSearch").trigger("click");
}});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(CsSatifactionReport._CONS_.GRID,a);},_initJqgrid:function(a){FormUtils.loadData(ctx+"//gl/cti/trkRecordCsReport/getCsCtiSatifationMap.htm",function(e){console.log("resultMap==="+e);
if(a==null||typeof a==undefined){a={};}var c=this;var b=new Date();var g=b.currentDate()+" 00:00:00";$('input[name="startTime"]').val(g);var i=["部门","员工","通话量"];
for(var f in e){i.push(f);}i.push("无");i.push("满意率");var d=[{name:"groupId",width:120,sortable:false,formatter:function(k,j,l){return l.groupName;}},{name:"employeeAid",width:120,sortable:false,formatter:function(k,j,l){return l.employeeAid+" : "+l.employeeName;
}},{name:"recordCount",width:120,sortable:false,formatter:function(k,j,l){return l.recordCount;}},];for(var f in e){var h={name:f,width:120,sortable:false,formatter:function(l,j,k){return k.satisfationCountMap[f];
}};d.push(h);}d.push({name:"noPJCount",width:120,sortable:false,formatter:function(l,j,k){return l;}});d.push({name:"satifationRate",width:120,sortable:false});
$(CsSatifactionReport._CONS_.GRID).JTJqgrid({url:CsSatifactionReport._CONS_.URL_LIST_DATA,postData:{startTime:g,},pager:CsSatifactionReport._CONS_.PAGER,footerrow:false,multiselect:false,colNames:i,colModel:d,});
},null,true);}};