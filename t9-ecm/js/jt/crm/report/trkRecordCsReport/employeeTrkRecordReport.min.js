$(function(){var a=new EmployeeTrkRecordReport();a.init();});function EmployeeTrkRecordReport(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;
this.sortColumn="";this.sortorder="";}EmployeeTrkRecordReport._CONS_={EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",LIST_DATA_URL:ctx+"/crm/report/cti/listData.htm",EXPORT_URL:ctx+"/crm/report/cti/exportExcel.htm",GRID:"#employeeTrkRecordReportGrid",PAGER:"#employeeTrkRecordReportPager"};
EmployeeTrkRecordReport.prototype={init:function(a){if(!this.hadInit){ReportDateUtil.initDate(".report-content");$("#timeTypeSearch").change();this.hadInit=true;
this._initJqgrid(a);this._hideNotGrantBtn();this._bindEventHander();}},_hideNotGrantBtn:function(){},_bindEventHander:function(){var a=this;$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
FormUtils.loadData(EmployeeTrkRecordReport._CONS_.EMPLOYEE_LIST_URL+"?groupId="+c+"&type=statistics,dept_manager",function(e){var f=new StringBuffer();
f.append('<option value="">请选择</option>');for(var d=0;d<e.length;d++){f.append("<option value='"+e[d].id+"'>"+e[d].aid+":"+e[d].name+"</option>");}$("#belongEmployee").empty().append(f.toString());
});}};GroupUtils.selectGroupTreeBox(b);});$("#searchBtn").on("click",function(){a.reloadJqgrid(a.toPostParam());});$(".exportExcel").on("click",function(){ButtonUtils.disableBtn("exportExcel");
FormUtils.submit(EmployeeTrkRecordReport._CONS_.EXPORT_URL,a.toPostParam()+"&sidx="+a.sortColumn+"&sord="+a.sortorder,function(b){ButtonUtils.enableBtn("exportExcel");
if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(EmployeeTrkRecordReport._CONS_.GRID,a);},_getManagerBtns:function(){var a=[];return a;},_initJqgrid:function(){var b={};
var a=this;b["Q__D__BW__record.BegTime"]=ReportDateUtil.getDateTimeRangeStr();$(EmployeeTrkRecordReport._CONS_.GRID).JTJqgrid({url:EmployeeTrkRecordReport._CONS_.LIST_DATA_URL,postData:b,footerrow:true,sortable:true,rowNum:-1,colNames:["部门","员工","电话总数","通话总时长","平均时长","呼入总数","呼入时长","呼出总数","呼出时长","有效时长","有效沟通数","接听数","接听率","意向达标率","操作"],colModel:[{name:"groupName",sortable:false,width:120},{name:"employeeName",sortable:false,width:120},{name:"totalCall",width:120},{name:"totalCallTimeStr",index:"totalCallTime",width:120},{name:"averageCallTimeStr",index:"averageCallTime",width:120},{name:"inCall",width:120},{name:"inCallTimeStr",index:"inCallTime",width:120},{name:"outCall",width:120},{name:"outCallTimeStr",index:"outCallTime",width:120},{name:"validCallTimeStr",index:"validCallTime",width:120},{name:"validCallCount",index:"validCallCount",width:120},{name:"answerCall",width:120},{name:"answerCallRateStr",index:"answerCallRate",width:120},{name:"intentionRateStr",index:"intentionRate",width:120},{name:"__manage",width:40,classes:"rowOps",sortable:false,align:"center",formatter:"manage",formatoptions:this._getManagerBtns()}],gridComplete:function(){},onSortCol:function(d,e,c){a.sortColumn=d;
a.sortorder=c;}});},toPostParam:function(){var a=$("#profixSearchForm").serialize();a+="&Q__D__BW__record.BegTime="+ReportDateUtil.getDateTimeRangeStr();
return a;}};