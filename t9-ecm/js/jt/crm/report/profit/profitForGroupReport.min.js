$(function(){var a=new ProfitForGroupReport();a.init();});function ProfitForGroupReport(){this.hadInit=false;this.hasInitJqgrid=false;this.isEdit=false;
this.sortColumn="";this.sortorder="";this.chartUtil=new ChartUtil();}ProfitForGroupReport._CONS_={LIST_DATA_URL:ctx+"/ec/rp/reportProfit/listGroupData.htm",EXPORT_URL:ctx+"/crm/report/performanceForEmpReport/exportGroup.htm",GRID:"#profitForGroupReportGrid",PAGER:"#profitForGroupReportPager"};
ProfitForGroupReport.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();ReportDateUtil.initDate(".report-content");
$("#timeTypeSearch").change();a._initJqgrid();a._prodSearch();a._channelSearch();CateUtils.getOptions([{typeKey:"system",pKey:"CsInterestType",container:"interstSearch"},{typeKey:"system",pKey:"CsEntryType",container:"csEntrySearch"}]);
if($(".opterate").val()=="1"){$(".opterate").attr("disabled",true);}else{$(".place").attr("disabled",true);}}},_prodSearch:function(){$("#searchProd").bsSuggest("destroy");
var a=this;var d=$("#searchProd").width()+"px";var b="entity";var e="n";var c="n";$("#searchProd").bsSuggest({url:ctx+"/ec/product/prodEntity/search.htm?prodType="+b+"&hasStock="+e+"&storeId="+"&limitProdCate="+c+"&keyword=",effectiveFields:["prodName"],searchFields:["prodName","skuCode"],effectiveFieldsAlias:{prodName:"产品名字"},showBtn:false,idField:"skuId",keyField:"skuCode",showBtn:false,twoWayMatch:false,ignorecase:true,allowNoKeyword:true,multiWord:false,autoSelect:false,delayUntilKeyup:false,getDataMethod:"firstByUrl",processData:function(f){a.searchProds=f.value;
return f;},listStyle:{"padding-top":0,"max-height":"500px","max-width":d,"overflow":"auto","width":"auto","transition":"0.3s","-webkit-transition":"0.3s","-moz-transition":"0.3s","-o-transition":"0.3s"}}).on("onDataRequestSuccess",function(g,f){a.searchProds=f.value;
}).on("onSetSelectValue",function(h,f){for(var g=0;g<a.searchProds.length;g++){if(a.searchProds[g].skuId==f.id){a.currentProd=a.searchProds[g];break;}}$("#searchProd").val(a.currentProd.prodName);
}).on("onUnsetSelectValue",function(f){a.currentProd={};});},_channelSearch:function(){ChannelUtils.getOptions({container:"channelQry",caption:"",type:"noChannelId"});
},_bindEventHander:function(){var a=this;$("button.clearSearchFormBtn").on("click",function(){FormUtils.clear("profixSearchForm");if(a._getContainer("channelQry")){a._getContainer("channelQry").selectpicker("refresh");
}});$("#groupName").on("click",function(){var b={isMultiple:1,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
}};GroupUtils.selectGroupTreeBox(b);});$("#searchBtn").on("click",function(){var b=a.toPostParam();a.params=b;a.reloadJqgrid(b);});$(".opterate").on("click",function(){var b=$("#profixSearchForm").serialize();
b+="&positionType=statistics,dept_manager";b+="&Q__D__BW__oper_time_="+ReportDateUtil.getDateTimeRangeStr();b+="&timeType=oper";$(".place").val("0");$(this).val("1");
$(".place").attr("disabled",false);$(".opterate").attr("disabled",true);a.reloadJqgrid(b);});$(".place").on("click",function(){var b=$("#profixSearchForm").serialize();
b+="&positionType=statistics,dept_manager";b+="&Q__D__BW__place_time_="+ReportDateUtil.getDateTimeRangeStr();b+="&timeType=place";$(".opterate").val("0");
$(this).val("1");$(".place").attr("disabled",true);$(".opterate").attr("disabled",false);a.reloadJqgrid(b);});$(document).on("click",".history",function(){var c=$(this).attr("value");
if($(".opterate").val()=="1"){var b="oper";}else{var b="place";}JTTabUtils.addOrRefreshTab(ctx+"/crm/report/performanceForEmpReport/history.htm?type=groupPath&timeType="+b+"&param="+c,"业绩历史详情");
});$(".exportExcel").on("click",function(){FormUtils.submit(ProfitForGroupReport._CONS_.EXPORT_URL,a.toPostParam()+"&sidx="+a.sortColumn+"&sord="+a.sortorder,function(b){ButtonUtils.enableBtn("exportExcel");
if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});$(document).on("click",".detail",function(){var c=$(this).attr("profitType");var b=$(this).attr("value");var e=$(this).attr("valueName");var d={};
ConfigUtils.findByKey("salesorder.isAddCloseProfit",function(f){ConfigUtils.findByKey("salesorder.isAddAwaitPostProfit",function(l){if(f.success&&c=="place"){d.Q__S__IN__type_="place";
}else{if(l.success&&c=="place"){d.Q__S__IN__type_="place,post";}else{if(c=="delaySign"){d.Q__S__IN__type_="delay,complete";}else{d.Q__S__EQ__type_=c;}}}d.group_key_=b;
d.type="group";if($(".opterate").val()=="1"){d.timeType="oper";}else{d.timeType="place";}if($(".interstSearch").val()){d.interests=$(".interstSearch").val();
}if($("#searchProd").val()){d.Q__S__EQ__product_name_=$("#searchProd").val();}if($(".csEntrySearch").val()){d.Q__S__EQ__cs_entry_=$(".csEntrySearch").val();
}if($(".completeStartTime").val()){d.completeStartTime=$(".completeStartTime").val();}if($(".completeEndTime").val()){d.completeStartTime=$(".completeStartTime").val()+","+$(".completeEndTime").val();
}if($(".rejectStartTime").val()){d.rejectStartTime=$(".rejectStartTime").val();}if($(".rejectEndTime").val()){d.rejectStartTime=$(".rejectStartTime").val()+","+$(".rejectEndTime").val();
}var k=ReportDateUtil.getStartDateTimeRangeStr();var h=ReportDateUtil.getEndDateTimeRangeStr();e=e.replaceAll("_","");var i="/crm/report/performanceForEmpReport/groupDetail.htm?paramsDetail="+encodeURIComponent(JSON.stringify(d))+"&timeStart="+k+"&timeEnd="+h;
var m=$("#channelQry option:selected").length;if(m!=0){i=a._buildDetailChanelSearch(m,i);}else{var j="";var g="";i+="&withOut="+g+"&channelId="+j;}JTTabUtils.addOrRefreshTab(ctx+i,e+"业绩明细");
});});});},_initJqgrid:function(){var f={};var j=this;f.Q__D__BW__place_time_=ReportDateUtil.getDateTimeRangeStr();f.timeType="place";j.params="Q__D__BW__place_time_="+f.Q__D__BW__place_time_+"&timeType="+f.timeType;
var e=false;var d=false;var a=true;var c=true;var l=false;var i=false;var k=true;var b=false;var g=false;var h=false;ConfigUtils.findByKey("profit.isAddNewOther",function(m){if(m.success){e=true;
$(".addNewOther").show();$(".notAddNewOther").hide();}ConfigUtils.findByKey("soEntity.Rejected.isAddComplete",function(n){if(n.success){g=true;}ConfigUtils.findByKey("profit.isHideNewMember",function(o){if(o.success){d=true;
$(".addNewOther").hide();$(".notAddNewOther").hide();}ConfigUtils.findByKey("profit.isShowWaitComfirm",function(p){if(p.success){a=false;}ConfigUtils.findByKey("system.isBanDelayConfirm",function(q){if(q.success){i=true;
}ConfigUtils.findByKey("salesorder.isAddCreateProfit",function(r){if(r.success){c=false;}ConfigUtils.findByKey("profit.isSubtractProfitReturn",function(s){if(s.success){k=false;
}ConfigUtils.findByKey("salesorder.isConfirmCloseAddPlaceProfit",function(u){if(u.success){b=true;}var t="下单/金额";if(!c){t="提交/金额";}ConfigUtils.findByKey("profit.isHidePayedAndUnpayed",function(w){if(w.success){h=true;
}var v=true;ConfigUtils.findByKey("employee.isShowdeductRates",function(x){if(x.success){v=false;}$(ProfitForGroupReport._CONS_.GRID).JTJqgrid({url:ProfitForGroupReport._CONS_.LIST_DATA_URL,postData:f,multiselect:false,footerrow:true,sortable:true,rowNum:-1,colNames:["部门","新进客户","删除客户","新进会员","新进其它","下单","金额","下单/金额","提交","金额",t,"提交率","成单率","延审","金额","延审/金额","待审核/金额","审核作废","金额","审核作废/金额","审单","金额","审单/金额","核单率","发货","金额","发货/金额","已收","待收","拒收订金","拒丢","金额","拒丢/金额","签收","金额","签收/金额","签收率","产值","退货","金额","退货/金额","换货","金额","换货/金额","延审+签收（隐藏）","延审+签收（隐藏）","延审+签收","已回款数量隐藏","已回款金额隐藏","已回款","已提成金额隐藏","已提成","历史"],simplify:{must:["部门"]},colModel:[{name:"groupName",width:85,index:"groupName",sortable:false,formatter:function(y,z,A){if(A.groupName){return A.groupName;
}return"";}},{name:"newCsCount",index:"new_cs_count_",width:45,sortable:true},{name:"deleteCsCount",index:"delete_cs_count_",width:45,sortable:false},{name:"newMemberCount",index:"new_member_count_",width:52,hidden:d},{name:"newOthersCount",index:"new_others_count_",width:52,hidden:d},{name:"createCount",index:"create_count_",width:70,hidedlg:true,hidden:true,sortable:false},{name:"createAmountHide",width:70,hidedlg:true,hidden:true,sortable:false,formatter:function(y,z,A){return A.createAmount;
}},{name:"createAmount",index:"create_amount_",width:70,sortable:true,hidden:c,formatter:function(y,z,A){if(window.localStorage.getItem("ts_money_reduce")=="true"){if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.createCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.createAmount/10).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='create'  value='"+A.group+"' valueName='"+A.groupName+"'><span style='color:red;'>"+A.createCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.createAmount/10).toFixed(2)+"</span></a>";
}}else{if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.createCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.createAmount).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='create'  value='"+A.group+"' valueName='"+A.groupName+"'><span style='color:red;'>"+A.createCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.createAmount).toFixed(2)+"</span></a>";
}}}},{name:"placeCount",index:"place_count_",width:70,hidedlg:true,hidden:true,sortable:false},{name:"placeAmountHide",width:70,hidedlg:true,hidden:true,sortable:false,formatter:function(y,z,A){return A.placeAmount;
}},{name:"placeAmount",index:"place_amount_",width:70,sortable:true,formatter:function(y,z,A){if(window.localStorage.getItem("ts_money_reduce")=="true"){if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.placeCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.placeAmount/10).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='place' value='"+A.group+"' valueName='"+A.groupName+"'><span style='color:red;'>"+A.placeCount.toFixed(1)+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.placeAmount/10).toFixed(2)+"</span></a>";
}}else{if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.placeCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.placeAmount).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='place' value='"+A.group+"' valueName='"+A.groupName+"'><span style='color:red;'>"+A.placeCount.toFixed(1)+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.placeAmount).toFixed(2)+"</span></a>";
}}}},{name:"postRate",index:"post_rate_",width:42,sortable:false,hidden:c},{name:"doneRate",index:"done_rate_",width:42,sortable:true},{name:"delayCount",index:"place_count_",width:70,hidedlg:true,hidden:true,sortable:false},{name:"delayAmountHide",width:70,hidedlg:true,hidden:true,sortable:false,formatter:function(y,z,A){return A.delayAmount;
}},{name:"delayAmount",index:"delay_amount_",width:70,sortable:false,hidden:i,formatter:function(y,z,A){if(window.localStorage.getItem("ts_money_reduce")=="true"){if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.delayCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.delayAmount/10).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='delay' value='"+A.group+"' valueName='"+A.groupName+"'><span style='color:red;'>"+A.delayCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.delayAmount/10).toFixed(2)+"</span></a>";
}}else{if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.delayCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.delayAmount).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='delay' value='"+A.group+"' valueName='"+A.groupName+"'><span style='color:red;'>"+A.delayCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.delayAmount).toFixed(2)+"</span></a>";
}}}},{name:"comfirm",hidden:a,width:70,sortable:false,formatter:function(y,z,A){if(window.localStorage.getItem("ts_money_reduce")=="true"){if(b){return parseFloat(A.placeCount-A.auditCount-A.closeCount).toFixed(0)+"/"+parseFloat((A.placeAmount-A.auditAmount-A.closeAmount)/10).toFixed(2);
}else{return parseFloat(A.placeCount-A.auditCount).toFixed(0)+"/"+parseFloat((A.placeAmount-A.auditAmount)/10).toFixed(2);}}else{if(b){return parseFloat(A.placeCount-A.auditCount-A.closeCount).toFixed(0)+"/"+parseFloat(A.placeAmount-A.auditAmount-A.closeAmount).toFixed(2);
}else{return parseFloat(A.placeCount-A.auditCount).toFixed(0)+"/"+parseFloat(A.placeAmount-A.auditAmount).toFixed(2);}}}},{name:"closeCount",index:"close_count_",width:70,hidedlg:true,hidden:true,sortable:false},{name:"closeAmountHide",width:70,hidedlg:true,hidden:true,sortable:false,formatter:function(y,z,A){return A.closeAmount;
}},{name:"closeAmount",index:"close_amount_",width:70,sortable:true,formatter:function(y,z,A){if(window.localStorage.getItem("ts_money_reduce")=="true"){if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.closeCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.closeAmount/10).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='close' value='"+A.aid+"'><span style='color:red;'>"+A.closeCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.closeAmount/10).toFixed(2)+"</span></a>";
}}else{if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.closeCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.closeAmount).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='close' value='"+A.aid+"'><span style='color:red;'>"+A.closeCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.closeAmount).toFixed(2)+"</span></a>";
}}}},{name:"auditCount",index:"audit_count_",hidedlg:true,hidden:true,sortable:false},{name:"auditAmountHide",index:"audit_amount_",hidedlg:true,hidden:true,sortable:false,formatter:function(y,z,A){return A.auditAmount;
}},{name:"auditAmount",index:"audit_amount_",width:70,sortable:true,formatter:function(y,z,A){if(window.localStorage.getItem("ts_money_reduce")=="true"){if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.auditCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.auditAmount/10).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='confirm' value='"+A.group+"' valueName='"+A.groupName+"'><span style='color:red;'>"+A.auditCount.toFixed(1)+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.auditAmount/10).toFixed(2)+"</span></a>";
}}else{if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.auditCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.auditAmount).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='confirm' value='"+A.group+"' valueName='"+A.groupName+"'><span style='color:red;'>"+A.auditCount.toFixed(1)+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.auditAmount).toFixed(2)+"</span></a>";
}}}},{name:"checkRate",width:42,sortable:false},{name:"shipCount",index:"ship_count_",hidedlg:true,hidden:true,sortable:false},{name:"shipAmountHide",sortable:false,index:"ship_amount_",hidedlg:true,hidden:true,sortable:false,formatter:function(y,z,A){return A.shipAmount;
}},{name:"shipAmount",index:"ship_amount_",width:70,sortable:true,formatter:function(y,z,A){if(window.localStorage.getItem("ts_money_reduce")=="true"){if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.shipCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.shipAmount/10).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='ship' value='"+A.group+"'  valueName='"+A.groupName+"'><span style='color:red;'>"+A.shipCount.toFixed(1)+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.shipAmount/10).toFixed(2)+"</span></a>";
}}else{if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.shipCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.shipAmount).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='ship' value='"+A.group+"'  valueName='"+A.groupName+"'><span style='color:red;'>"+A.shipCount.toFixed(1)+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.shipAmount).toFixed(2)+"</span></a>";
}}}},{name:"payedAmount",width:60,hidden:h,sortable:false,formatter:function(y,z,A){if(window.localStorage.getItem("ts_money_reduce")=="true"){if(g){return parseFloat(A.payedAmount/10).toFixed(2);
}else{return parseFloat((A.payedAmount-A.rejectSubAmount)/10).toFixed(2);}}else{if(g){return parseFloat(A.payedAmount).toFixed(2);}else{return parseFloat(A.payedAmount-A.rejectSubAmount).toFixed(2);
}}}},{name:"waitPay",width:60,hidden:h,formatter:function(y,z,A){if(window.localStorage.getItem("ts_money_reduce")=="true"){return parseFloat(A.waitPay/10).toFixed(2);
}else{return parseFloat(A.waitPay).toFixed(2);}}},{name:"rejectSubAmount",width:60,sortable:false,formatter:function(y,z,A){return parseFloat(A.rejectSubAmount).toFixed(2);
}},{name:"rejectCount",index:"reject_count_",hidedlg:true,hidden:true,sortable:false},{name:"rejectAmountHide",index:"reject_amount_",hidedlg:true,hidden:true,sortable:false,formatter:function(y,z,A){return A.rejectAmount;
}},{name:"rejectAmount",index:"reject_amount_",width:70,sortable:true,formatter:function(y,z,A){if(window.localStorage.getItem("ts_money_reduce")=="true"){if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.rejectCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.rejectAmount/10).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='reject' value='"+A.group+"'  valueName='"+A.groupName+"'><span style='color:red;'>"+A.rejectCount.toFixed(1)+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.rejectAmount/10).toFixed(2)+"</span></a>";
}}else{if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.rejectCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.rejectAmount).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='reject' value='"+A.group+"'  valueName='"+A.groupName+"'><span style='color:red;'>"+A.rejectCount.toFixed(1)+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.rejectAmount).toFixed(2)+"</span></a>";
}}}},{name:"signCount",index:"sign_count_",hidedlg:true,hidden:true,sortable:false},{name:"signAmountHide",index:"sign_amount_",hidedlg:true,hidden:true,sortable:false,formatter:function(y,z,A){return A.signAmount;
}},{name:"signAmount",sortable:true,index:"sign_amount_",width:70,formatter:function(y,z,A){if(window.localStorage.getItem("ts_money_reduce")=="true"){if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.signCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.signAmount/10).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='complete' value='"+A.group+"'  valueName='"+A.groupName+"'><span style='color:red;'>"+A.signCount.toFixed(1)+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.signAmount/10).toFixed(2)+"</span></a>";
}}else{if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.signCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.signAmount).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='complete' value='"+A.group+"'  valueName='"+A.groupName+"'><span style='color:red;'>"+A.signCount.toFixed(1)+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.signAmount).toFixed(2)+"</span></a>";
}}}},{name:"signRate",index:"sign_",sortable:false,width:42},{name:"outputRate",index:"output_",sortable:true,width:42},{name:"backCount",index:"back_count_",hidedlg:true,hidden:true,sortable:false},{name:"backAmountHide",index:"back_amount_",hidedlg:true,hidden:true,sortable:false,formatter:function(y,z,A){return A.backAmount;
}},{name:"backAmount",index:"back_amount_",sortable:false,hidden:false,width:70,formatter:function(y,z,A){if(window.localStorage.getItem("ts_money_reduce")=="true"){if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.backCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.backAmount/10).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='back' value='"+A.group+"' valueName='"+A.groupName+"'><span style='color:red;'>"+A.backCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.backAmount/10).toFixed(2)+"</span></a>";
}}else{if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.backCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.backAmount).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='back' value='"+A.group+"' valueName='"+A.groupName+"'><span style='color:red;'>"+A.backCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.backAmount).toFixed(2)+"</span></a>";
}}}},{name:"exchangeCount",index:"exchange_count_",hidedlg:true,hidden:true,sortable:false},{name:"exchangeAmountHide",index:"exchange_amount_",hidedlg:true,hidden:true,sortable:false,formatter:function(y,z,A){return A.exchangeAmount;
}},{name:"exchangeAmount",index:"exchange_amount_",sortable:false,hidden:false,width:70,formatter:function(y,z,A){if(window.localStorage.getItem("ts_money_reduce")=="true"){if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.exchangeCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.exchangeAmount/10).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='exchange' value='"+A.group+"' valueName='"+A.groupName+"'><span style='color:red;'>"+A.exchangeCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.exchangeAmount/10).toFixed(2)+"</span></a>";
}}else{if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+A.exchangeCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.exchangeAmount).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='exchange' value='"+A.group+"' valueName='"+A.groupName+"'><span style='color:red;'>"+A.exchangeCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.exchangeAmount).toFixed(2)+"</span></a>";
}}}},{name:"delaySignCount",index:"sign_count_",hidedlg:true,hidden:true,sortable:false},{name:"delaySignAmountHide",index:"sign_amount_",hidedlg:true,hidden:true,sortable:false},{name:"delaySignAmount",index:"delay_amount_",width:70,sortable:false,hidden:i,formatter:function(y,z,A){if(window.localStorage.getItem("ts_money_reduce")=="true"){if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+(A.delaySignCount)+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.delaySignAmount/10).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='delaySign' value='"+A.group+"' valueName='"+A.groupName+"'><span style='color:red;'>"+(A.delayCount+A.signCount)+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.delayAmount+A.signAmount).toFixed(2)+"</span></a>";
}}else{if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+(A.delaySignCount)+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.delaySignAmount).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='delaySign' value='"+A.group+"' valueName='"+A.groupName+"'><span style='color:red;'>"+(A.delayCount+A.signCount)+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.delayAmount+A.signAmount).toFixed(2)+"</span></a>";
}}}},{name:"callbackCount",index:"callback_count_",hidedlg:true,hidden:true,sortable:false},{name:"callbackAmountHide",index:"callback_amount_",hidedlg:true,hidden:true,sortable:false},{name:"callbackAmount",index:"callback_amount_",width:70,sortable:true,hidden:v,formatter:function(y,z,A){if(window.localStorage.getItem("ts_money_reduce")=="true"){if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+(A.callbackCount)+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.callbackAmount/10).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='callBack' value='"+A.group+"' valueName='"+A.groupName+"'><span style='color:red;'>"+A.callbackCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.callbackAmount/10).toFixed(2)+"</span></a>";
}}else{if(A.groupName.indexOf("总计：")>-1){return"<span style='color:red;'>"+(A.callbackCount)+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.callbackAmount).toFixed(2)+"</span>";
}else{return"<a href='#' class='detail' profitType='callBack' value='"+A.group+"' valueName='"+A.groupName+"'><span style='color:red;'>"+A.callbackCount+"</span>"+"/<span style='color:blue;'>"+parseFloat(A.callbackAmount).toFixed(2)+"</span></a>";
}}}},{name:"deductedAmountHide",index:"deducted_amount_",hidedlg:true,hidden:true,sortable:false},{name:"deductedAmount",index:"deducted_amount_",width:70,sortable:true,hidden:v,formatter:function(y,z,A){if(window.localStorage.getItem("ts_money_reduce")=="true"){return"<span style='color:blue;'>"+parseFloat(A.deductedAmount/10).toFixed(2)+"</span>";
}else{return"<span style='color:blue;'>"+parseFloat(A.deductedAmount).toFixed(2)+"</span>";}}},{name:"history",sortable:false,width:35,formatter:function(y,z,A){return"<a href='#' class='history' value='"+A.group+"'>历史</a>";
}},],beforeProcessing:function(z){var y={groupName:"总计：",newCsCount:z.footData.newCsCount,deleteCsCount:z.footData.deleteCsCount,newMemberCount:z.footData.newMemberCount,newOthersCount:z.footData.newOthersCount,createCount:z.footData.createCount.toFixed(0),createAmount:z.footData.createAmount.toFixed(2),placeCount:z.footData.placeCount.toFixed(0),placeAmount:z.footData.placeAmount.toFixed(2),delayCount:z.footData.delayCount.toFixed(0),delayAmount:z.footData.delayAmount.toFixed(2),postRate:z.footData.postRate,doneRate:z.footData.doneRate,closeCount:z.footData.closeCount.toFixed(0),closeAmount:z.footData.closeAmount.toFixed(0),auditCount:z.footData.auditCount.toFixed(0),auditAmount:z.footData.auditAmount.toFixed(2),checkRate:z.footData.checkRate,shipCount:z.footData.shipCount.toFixed(0),shipAmount:z.footData.shipAmount.toFixed(2),payedAmount:z.footData.payedAmount.toFixed(2),rejectSubAmount:z.footData.rejectSubAmount.toFixed(2),waitPay:z.footData.waitPay.toFixed(2),rejectCount:z.footData.rejectCount.toFixed(0),rejectAmount:z.footData.rejectAmount.toFixed(2),signCount:z.footData.signCount.toFixed(0),signAmount:z.footData.signAmount.toFixed(2),signRate:z.footData.signRate,outputRate:z.footData.outputRate,backCount:z.footData.backCount.toFixed(0),backAmount:z.footData.backAmount.toFixed(2),exchangeCount:z.footData.exchangeCount.toFixed(0),exchangeAmount:z.footData.exchangeCount.toFixed(2),supplementaryCount:z.footData.supplementaryCount.toFixed(0),supplementaryAmount:z.footData.supplementaryAmount.toFixed(2),delaySignCount:(z.footData.signCount+z.footData.delayCount).toFixed(0),delaySignAmountHide:(z.footData.signAmount+z.footData.delayAmount).toFixed(2),delaySignAmount:z.footData.signAmount.toFixed(2)+z.footData.delayAmount.toFixed(2),callbackCount:z.footData.callbackCount.toFixed(2),callbackAmount:z.footData.callbackAmount.toFixed(2),deductedAmount:z.footData.deductedAmount.toFixed(2)};
j.footerData=y;},gridComplete:function(){if(j.footerData){var A=$(ProfitForGroupReport._CONS_.GRID).jqGrid("getGridParam","records");j.footerData.groupName="总计：<span style='color:red;'>"+A+"</span>个";
$(ProfitForGroupReport._CONS_.GRID).footerData("set",j.footerData);}if(!j.hasInitJqgrid){var B=$(ProfitForGroupReport._CONS_.GRID).jqGrid("getGridParam","colModel");
var z=new Array();for(var D=2;D<B.length;D++){if(B[D].hidden){z.push(B[D].name);}}window.localStorage.setItem(ProfitForGroupReport._CONS_.GRID+"defaultHideItems",z);
j.hasInitJqgrid=true;}var C=window.localStorage.getItem(ProfitForGroupReport._CONS_.GRID+"HideItems");var y=window.localStorage.getItem(ProfitForGroupReport._CONS_.GRID+"ShowItems");
var A=$(ProfitForGroupReport._CONS_.GRID).getGridParam("width");if(C!=null){var E=C.split(",");for(var D=0;D<E.length;D++){$(ProfitForGroupReport._CONS_.GRID).setGridParam().hideCol(E[D]);
}}$(ProfitForGroupReport._CONS_.GRID).setGridWidth(A);if(y!=null){var E=y.split(",");for(var D=0;D<E.length;D++){$(ProfitForGroupReport._CONS_.GRID).setGridParam().showCol(E[D]);
}}$(window).resize();},onSortCol:function(z,A,y){j.sortColumn=z;j.sortorder=y;j.reloadJqgrid(j.params+"&sortColumn="+j.sortColumn+"&sortorder="+j.sortorder);
}});});});});});});});});});});});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(ProfitForGroupReport._CONS_.GRID,a);},toPostParam:function(){var a=this;
var c=$("#profixSearchForm").serialize();c+="&positionType=dept_manager";if(ReportDateUtil.getDateTimeRangeStr()!=","){if($(".opterate").val()=="1"){c+="&Q__D__BW__oper_time_="+ReportDateUtil.getDateTimeRangeStr();
}else{c+="&Q__D__BW__place_time_="+ReportDateUtil.getDateTimeRangeStr();}}c+="&reportType="+$("input[name=reportKey]").val();var b=$("#channelQry option:selected").length;
if(channelQry!=0){c=a._buildChanelSearch(c,b);}return c;},_buildChanelSearch:function(d,c){var b=this;var e=new StringBuffer();var a=null;$("#channelQry option:selected").each(function(f){if($(this).val()==""){a="withOut";
}e.append($(this).val());if(f==c-1){return false;}else{e.append(",");}});d=d+"&channelId="+e.toString();if(a){d+="&withOut="+"withOut";}return d;},_buildDetailChanelSearch:function(d,c){var b=this;
var e=new StringBuffer();var a="";$("#channelQry option:selected").each(function(f){if($(this).val()==""){a="withOut";}e.append($(this).val());if(f==d-1){return false;
}else{e.append(",");}});c+="&channelId="+e.toString()+"&withOut="+a;return c;},_getContainer:function(b){var a=this;var c=false;if(b){c=$("#"+b);if(c.length==0){c=$("select."+b);
if(c.length==0){c=$("select[name='"+b+"']");if(c.length==0){return false;}}}}return c;},};