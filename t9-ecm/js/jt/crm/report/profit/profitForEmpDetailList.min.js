$(function(){var a=new ProfitForEmpDetailList();a.init();});function ProfitForEmpDetailList(){this.hadInit=false;this.isEdit=false;this.sortColumn="";this.sortorder="";
}ProfitForEmpDetailList._CONS_={LIST_DATA_URL:ctx+"/ec/rp/reportProfit/detailList.htm",FIND_BY_SONO_URL:ctx+"/ec/salesorder/soEntity/findCsBySoNo.htm",SO_DETAIL_PAGE_URL:ctx+"/ec/salesorder/soEntity/detail.htm",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detail.htm",EXPORT_URL:ctx+"/crm/report/performanceForEmpReport/exportDetail.htm",GRID:"#profitForEmpDetailGrid",PAGER:"#profitForEmpDetailPager"};
ProfitForEmpDetailList.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;this._bindEventHander();this._hideNotGrantBtn();a._initJqgrid();
$(".timeRange").text("时间: "+timeStart+" 至 "+timeEnd);}},_hideNotGrantBtn:function(){if(!ResUtils.canShow("report.button.exportDetail")){$(".exportExcelDetail").hide();
}},_bindEventHander:function(){$("body").on("click",".soTab",function(){var b=$(this).attr("value");var c=$(this).attr("valueCsName");var a=ProfitForEmpDetailList._CONS_.FIND_BY_SONO_URL;
JTTabUtils.addOrRefreshTab(ProfitForEmpDetailList._CONS_.SO_DETAIL_PAGE_URL+"?soNo="+b,c+"的订单明细");});$("body").on("click",".csTab",function(){var a=$(this).attr("value");
var c=$(this).attr("valueCsName");var b=$(this).attr("valueCsId");if(c.length>4){c="*"+c.substring(c.length-3,c.length);}JTTabUtils.addOrRefreshTab(ProfitForEmpDetailList._CONS_.DETAIL_CS_PAGE_URL+"?csId="+b,"客户["+c+"]明细");
});$(".exportExcelDetail").on("click",function(){var a=paramsDetail;a.timeStart=timeStart+" 00:00:00";a.timeEnd=timeEnd+" 23:59:59";ButtonUtils.disableBtn("exportExcelDetail");
FormUtils.submit(ProfitForEmpDetailList._CONS_.EXPORT_URL,a,function(b){ButtonUtils.enableBtn("exportExcelDetail");if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");
}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});},_initJqgrid:function(){var c=paramsDetail;
if(timeStart){c.timeStart=timeStart+" 00:00:00";}if(timeEnd){c.timeEnd=timeEnd+" 23:59:59";}if(channelId){c.channelId=channelId;}if(withOut){c.withOut="withOut";
}var a=this;var b=false;ConfigUtils.findByKey("soEntity.Rejected.isAddComplete",function(d){if(d.success){b=true;}$(ProfitForEmpDetailList._CONS_.GRID).JTJqgrid({url:ProfitForEmpDetailList._CONS_.LIST_DATA_URL,postData:c,multiselect:false,footerrow:true,rowNum:-1,colNames:["订单编号","客户编号","支付方式","订单状态","总金额","已收","待收","业绩工号","个人业绩","业绩分成","下单时间","签收时间",],colModel:[{name:"soNo",width:50,sortable:false,formatter:function(e,f,g){return"<a href='#' class='soTab' value='"+g.soNo+"' valueCsName= '"+g.csName+"'>"+g.soNo+"</a>";
}},{name:"csNo",width:50,sortable:false,formatter:function(e,f,g){if(g.csNo.indexOf("记录")>-1){return g.csNo;}else{return"<span><a href='#'  class='csTab' value='"+g.csNo+"' valueCsId = '"+g.csId+"' valueCsName = '"+g.csName+"'>"+g.csNo+"</a>:"+g.csName+"</span>";
}}},{name:"payType",width:50,sortable:false,formatter:function(e,g,h){var f=h.payType;if(h.payType=="pay"){f="款到发货";}else{if(h.payType=="pay_sub"){f="支付订金";
}else{if(h.payType=="green"){f="绿色通道";}else{if(h.payType=="green_by"){f="绿色通道订金";}else{if(h.payType=="cod"){f="货到付款";}else{if(h.payType=="free"){f="免费已付";
}}}}}}return f;}},{name:"status",width:50,formatter:function(e,g,h){var f=h.status;if(h.status=="awaiting_pay"){f="待支付";}else{if(h.status=="awaiting_post"){f="待提交";
}else{if(h.status=="awaiting_comfirm"){f="待审核";}else{if(h.status=="comfirm"){f="待发货";}else{if(h.status=="shipping"){f="已发货";}else{if(h.status=="complete"){f="已签收";
}else{if(h.status=="close"){f="已作废";}else{if(h.status=="close_reject"){f="已拒收";}else{if(h.status=="close_lost"){f="已丢失";}}}}}}}}}return f;}},{name:"totalAmount",width:50,sortable:false,formatter:function(e,f,g){if(window.localStorage.getItem("ts_money_reduce")=="true"){return parseFloat(g.totalAmount/10).toFixed(2);
}else{return parseFloat(g.totalAmount).toFixed(2);}}},{name:"payedAmount",width:60,sortable:false,formatter:function(e,f,g){if(window.localStorage.getItem("ts_money_reduce")=="true"){if(g.status=="complete"){return parseFloat(g.totalAmount/10).toFixed(2);
}else{if(!b&&g.status=="close_reject"){return"0.00";}else{return parseFloat(g.payedAmount/10).toFixed(2);}}}else{if(g.status=="complete"){return parseFloat(g.totalAmount).toFixed(2);
}else{if(!b&&g.status=="close_reject"){return"0.00";}else{return parseFloat(g.payedAmount).toFixed(2);}}}}},{name:"payableAmount",width:60,sortable:false,formatter:function(e,f,g){if(g.status=="close_reject"){return"0.00";
}else{if(g.status=="complete"){return"0.00";}else{if(window.localStorage.getItem("ts_money_reduce")=="true"){return parseFloat((g.totalAmount-g.payedAmount)/10).toFixed(2);
}else{return parseFloat(g.totalAmount-g.payedAmount).toFixed(2);}}}}},{name:"aid",width:50,sortable:false},{name:"profitAmount",width:50,sortable:false,formatter:function(e,f,g){if(window.localStorage.getItem("ts_money_reduce")=="true"){return g.profitAmount/10;
}else{return g.profitAmount;}}},{name:"profitAid",width:100,sortable:false,formatter:function(e,f,g){return"<span>"+g.profitAid+":"+g.empName+"</span>";
}},{name:"placeTime",width:90,sortable:false},{name:"completeTime",width:90,sortable:false},],gridComplete:function(){var g=$(ProfitForEmpDetailList._CONS_.GRID).jqGrid("getCol","totalAmount",true,"sum");
var f=$(ProfitForEmpDetailList._CONS_.GRID).jqGrid("getCol","profitAmount",true,"sum");var e=$(ProfitForEmpDetailList._CONS_.GRID).jqGrid("getGridParam","records");
$(ProfitForEmpDetailList._CONS_.GRID).footerData("set",{"csNo":"共<span style='color:red;'>"+e+"</span>条记录, 订单总金额：<span style='color:red;'>"+g.toFixed(2)+"</span>, 个人总业绩：<span style='color:red;'>"+f.toFixed(2)+"</span>"});
var h=$(ProfitForEmpDetailList._CONS_.GRID).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow");h.find('td[aria-describedby*="payType"],td[aria-describedby*="totalAmount"],td[aria-describedby*="aid"],td[aria-describedby*="profitAmount"],td[aria-describedby*="placeTime"],td[aria-describedby*="completeTime"],td[aria-describedby*="profitAid"],td[aria-describedby*="status"],td[aria-describedby*="soNo"]').hide();
},});});}};