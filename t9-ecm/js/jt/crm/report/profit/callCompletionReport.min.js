$(function(){var a=new CallCompletionReport();a.init();});function CallCompletionReport(){this.hadInit=false;this.isEdit=false;this.sortColumn="";this.sortorder="";
}CallCompletionReport._CONS_={LIST_DATA_URL:ctx+"/gl/cti/tRKSheetRecord/listDataReport.htm",EXPORT_URL:ctx+"/gl/cti/tRKSheetRecord/exportCallCompleted.htm",GRID:"#callCompletionReportGrid",PAGER:"#callCompletionReportPager"};
CallCompletionReport.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();ReportDateUtil.initDate(".report-content");
$("#timeTypeSearch").change();a._initJqgrid();}},_bindEventHander:function(){var a=this;$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
}};GroupUtils.selectGroupTreeBox(b);});$("#searchBtn").on("click",function(){a.reloadJqgrid(a.toPostParam());});$(".exportExcel").on("click",function(){ButtonUtils.disableBtn("exportExcel");
FormUtils.submit(CallCompletionReport._CONS_.EXPORT_URL,a.toPostParam()+"&sidx="+a.sortColumn+"&sord="+a.sortorder,function(b){ButtonUtils.enableBtn("exportExcel");
if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});},_initJqgrid:function(){var b={};var a=this;b.month=$("#monthSearch").val();b.Q__D__BW__begTime=ReportDateUtil.getDateTimeRangeStr();$(CallCompletionReport._CONS_.GRID).JTJqgrid({url:CallCompletionReport._CONS_.LIST_DATA_URL,postData:b,multiselect:false,footerrow:true,sortable:true,rowNum:-1,colNames:["员工","本月通话时长(隐藏)","本月通话时长","每月工作日(隐藏)","每日达标数"],colModel:[{name:"belongEmployeeId",index:"belongEmployeeId",width:62,sortable:false,formatter:function(c,d,e){if(e.belongEmployeeId){if(e.belongEmployeeId.indexOf("总计：")>-1){return e.belongEmployeeId;
}else{return e.belongEmployeeAid+":"+e.belongEmployeeName;}}else{return"";}}},{name:"sumDuration",width:62,index:"sumDuration",hidedlg:true,hidden:true},{name:"durationStr",width:62,index:"duration",formatter:function(c,d,e){if(e.sumDuration){return DateUtils.toChineseTime(e.sumDuration);
}else{return"";}}},{name:"workDays",index:"workDays",width:52,sortable:false,hidedlg:true,hidden:true},{name:"percentCount",index:"percentCount",width:52,sortable:false,formatter:function(c,d,e){return e.percentCount+"/"+e.workDays;
}}],gridComplete:function(){var d=$(CallCompletionReport._CONS_.GRID).jqGrid("getCol","sumDuration",true,"sum");var c=$(CallCompletionReport._CONS_.GRID).jqGrid("getGridParam","records");
$(CallCompletionReport._CONS_.GRID).footerData("set",{"belongEmployeeId":"总计：<span style='color:red;'>"+c+"</span>人","sumDuration":d,"sumDurationStr":d});
},onSortCol:function(d,e,c){a.sortColumn=d;a.sortorder=c;}});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(CallCompletionReport._CONS_.GRID,a);
},toPostParam:function(){var a=$("#callCompletionForm").serialize();a+="&Q__D__BW__begTime="+ReportDateUtil.getDateTimeRangeStr();a+="&reportType="+$("input[name=reportKey]").val();
return a;}};