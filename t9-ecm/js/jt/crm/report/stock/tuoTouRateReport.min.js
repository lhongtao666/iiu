$(function(){var a=new TuoTouRateReport();a.init();});function TuoTouRateReport(){this.hadInit=false;}TuoTouRateReport._CONS_={GRID:"#tuoTouRateReportGrid",PAGER:"#tuoTouRateReportPager",URL_LIST_DATA:ctx+"/crm/report/reportEntity/tuoTouRateReport.htm",};
TuoTouRateReport.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._initSelect();this._initJqgrid(a);}},_initSelect:function(){},_bindEventHander:function(){var a=this;
$("body").on("click","[name=groupName]",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$('input[name="groupId"]').val(),container:"groupName",fn:function(c,b){$('input[name="groupId"]').val(c);
$('input[name="groupKey"]').val(b);}});});$(".list_wrapper").on("click",".saleStockSearch",function(){if(!$('input[name="startTime"]').val()){var b=new Date();
var c=b.currentDate()+" 00:00:00";$('input[name="startTime"]').val(c);}var d=$(this).closest("form").serialize();a.reloadJqgrid(d);});$("body").on("click",".export",function(){if(!$('input[name="startTime"]').val()){var b=new Date();
var c=b.currentDate()+" 00:00:00";$('input[name="startTime"]').val(c);}var d=$("#searchForm").closest("form").serialize();FormUtils.submit(ctx+"/crm/report/reportEntity/exportTuoTouRateReport.htm",d,function(e){if(e.success){DialogUtils.success(msgCode.SUCCESS,e.msg);
}else{DialogUtils.error(msgCode.ERROR,e.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});$("#searchForm").on("keypress",function(b){if(b.keyCode=="13"){$(".saleStockSearch").trigger("click");
}});$("body").on("click",".openDetail",function(){var e=$(this).attr("startTime");var c=$(this).attr("endTime");var b=$(this).attr("groupKey");var d=$(this).attr("type");
var g="明细";if("sign"===d){g="签收数";}else{if("reject"===d){g="拒收数";}else{if("shipping"===d){g="发货数";}}}var f="startTime="+e+"&endTime="+c+"&groupKey="+b+"&type="+d;
JTTabUtils.addOrRefreshTab(ctx+"/crm/report/reportEntity/openSaleStockDetail.htm?"+f,g);});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(TuoTouRateReport._CONS_.GRID,a);
},_decorateData:function(c,e,f){var b=e.split("/");var d=b[0];var a=b[1];return"<a startTime='"+f.startTime+"' groupKey='"+f.groupKey+"' href='javascript: void(0);' endTime='"+f.endTime+"' type='"+c+"' class='openDetail'>"+"<span style='color:red;'>"+d+"</span>"+"/<span style='color:blue;'>"+a+"</span>"+"</a>";
},_initJqgrid:function(d){var b=this;if(d==null||typeof d==undefined){d={};}var a=new Date();var c=a.currentDate()+" 00:00:00";$('input[name="startTime"]').val(c);
$(TuoTouRateReport._CONS_.GRID).JTJqgrid({url:TuoTouRateReport._CONS_.URL_LIST_DATA,postData:{startTime:c},pager:TuoTouRateReport._CONS_.PAGER,footerrow:true,multiselect:false,colNames:["部门","签收数","拒收数","发货数(在途)","已发货(发货+签收+拒收)","妥投率",],colModel:[{name:"groupName",width:120,sortable:false,formatter:function(f,e,g){return g.groupName;
}},{name:"sign",width:120,sortable:false,formatter:function(g,e,f){return b._decorateData("sign",f.sign,f);}},{name:"reject",width:120,sortable:false,formatter:function(g,e,f){return b._decorateData("reject",f.reject,f);
}},{name:"shipping",width:120,sortable:false,formatter:function(g,e,f){return b._decorateData("shipping",f.shipping,f);}},{name:"hasShipped",width:120,sortable:false,formatter:function(g,e,f){return g;
}},{name:"tuoTouRate",width:120,sortable:false,},],beforeProcessing:function(f){if(f.rows&&f.rows.length){var e={groupName:"总计：",sign:f.footData.sign,reject:f.footData.reject,shipping:f.footData.shipping,hasShipped:f.footData.hasShipped,tuoTouRate:f.footData.tuoTouRate,};
b.footerData=e;}},gridComplete:function(){if(b.footerData){var e=$(TuoTouRateReport._CONS_.GRID).jqGrid("getGridParam","records");b.footerData.groupName="总计：<span style='color:red;'>"+e+"</span>个";
$(TuoTouRateReport._CONS_.GRID).footerData("set",b.footerData);}},});}};