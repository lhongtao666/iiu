$(function(){var a=new StockReportForDay();a.init();});function StockReportForDay(){this.hadInit=false;}StockReportForDay._CONS_={LIST_DATA_URL:ctx+"/crm/report/stStockReport/listDayData.htm",EXPORT_URL:ctx+"/crm/report/stStockReport/exportDay.htm",GRID:"#stockDayReportGrid",};
StockReportForDay.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;$(".minCreateTime").val(new Date().currentDate());StoreUtils.loadStores("","storeIdSearch");
a._bindEventHander();a._initJqgrid();}},_bindEventHander:function(){var a=this;$("body").on("click","#searchBtn",function(){var b=$(this).closest("form").serialize();
a.reloadJqgrid(b);});$("body").on("click","#exportBtn",function(){var b=$(this).closest("form").serialize();a._export(b);});$("#stockDayReportSearchForm").on("keypress",function(b){if(b.keyCode=="13"){var c=$(this).closest("form").serialize();
a.reloadJqgrid(c);}});$(document).on("click",".detail",function(){var b=$(this).attr("value");var c=$(".minTime").val()+" 00:00:00";var e=$(".maxTime").val()+" 23:59:59";
var d="/crm/report/stStockReport/toOutQtyDetail.htm?stockId="+b+"&minTime="+c+"&maxTime="+e;JTTabUtils.addOrRefreshTab(ctx+d,"出库数量明细");});},_export:function(a){FormUtils.submit(StockReportForDay._CONS_.EXPORT_URL,a,function(b){if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");
}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg+"失败");}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(StockReportForDay._CONS_.GRID,a);
},_initJqgrid:function(){var b={"Q__D__BW__stlog.create_time_":new Date().currentDate()};var a=this;$(StockReportForDay._CONS_.GRID).JTJqgrid({url:StockReportForDay._CONS_.LIST_DATA_URL,postData:b,multiselect:false,footerrow:true,sortable:true,rowNum:-1,colNames:["款号","品名","仓库","仓位","入库数","出库数(hide)","出库数","良品","次品"],colModel:[{name:"skuCode",width:120},{name:"prodName",width:120},{name:"storeName",width:120},{name:"position",width:120},{name:"inQty",width:120},{name:"outQty",width:120,hidedlg:true,hidden:true},{name:"outQty",width:120,formatter:function(c,d,e){return"<a class='detail' value='"+e.stockId+"'><span style='color:red;'>"+e.outQty+"</span></a>";
}},{name:"goodQty",width:120},{name:"badQty",width:80}],gridComplete:function(){var g=$(StockReportForDay._CONS_.GRID).jqGrid("getCol","inQty",true,"sum");
var f=$(StockReportForDay._CONS_.GRID).jqGrid("getCol","outQty",true,"sum");var e=$(StockReportForDay._CONS_.GRID).jqGrid("getCol","goodQty",true,"sum");
var d=$(StockReportForDay._CONS_.GRID).jqGrid("getCol","badQty",true,"sum");var c=$(StockReportForDay._CONS_.GRID).jqGrid("getGridParam","records");$(StockReportForDay._CONS_.GRID).footerData("set",{"skuCode":"总计：<span style='color:red;'>"+c+"</span>条","inQty":"<span style='color:red;'>"+g+"</span>","outQty":"<span style='color:red;'>"+f+"</span>","goodQty":"<span style='color:red;'>"+e+"</span>","badQty":"<span style='color:red;'>"+d+"</span>"});
var h=$(StockReportForDay._CONS_.GRID).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow");h.find("td").css({"font-weight":400});},});
}};