$(function(){var a=new StStockReportOutQtyDetail();a.init();});function StStockReportOutQtyDetail(){this.hadInit=false;}StStockReportOutQtyDetail._CONS_={LIST_DATA_URL:ctx+"/crm/report/stStockReport/outQtyDetail.htm",FIND_BY_SONO_URL:ctx+"/ec/salesorder/soEntity/findCsBySoNo.htm",SO_DETAIL_PAGE_URL:ctx+"/ec/salesorder/soEntity/detail.htm",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detail.htm",GRID:"#StStockReportOutQtyDetailGrid",PAGER:"#StStockReportOutQtyDetailPager"};
StStockReportOutQtyDetail.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;this._bindEventHander();a._initJqgrid();$(".timeRange").text("时间: "+minTime+" 至 "+maxTime);
}},_bindEventHander:function(){$("body").on("click",".soTab",function(){var b=$(this).attr("value");var c=$(this).attr("valueCsName");var a=StStockReportOutQtyDetail._CONS_.FIND_BY_SONO_URL;
JTTabUtils.addOrRefreshTab(StStockReportOutQtyDetail._CONS_.SO_DETAIL_PAGE_URL+"?soNo="+b,c+"的订单明细");});$("body").on("click",".csTab",function(){var a=$(this).attr("value");
var c=$(this).attr("valueCsName");var b=$(this).attr("valueCsId");if(c.length>4){c="*"+c.substring(c.length-3,c.length);}JTTabUtils.addOrRefreshTab(StStockReportOutQtyDetail._CONS_.DETAIL_CS_PAGE_URL+"?csId="+b,"客户["+c+"]明细");
});},_initJqgrid:function(){var a=this;var b={};if(maxTime){b["maxTime"]=maxTime;}if(minTime){b["minTime"]=minTime;}if(stockId){b["stockId"]=stockId;}$(StStockReportOutQtyDetail._CONS_.GRID).JTJqgrid({url:StStockReportOutQtyDetail._CONS_.LIST_DATA_URL,postData:b,multiselect:false,footerrow:true,rowNum:-1,colNames:["订单编号","客户编号","订单状态","出库数量","下单时间","签收时间",],colModel:[{name:"soNo",width:60,sortable:false,formatter:function(c,d,e){return"<a href='#' class='soTab' value='"+e.soNo+"' valueCsName= '"+e.csName+"'>"+e.soNo+"</a>";
}},{name:"csCode",width:60,sortable:false,formatter:function(c,d,e){if(e.csCode.indexOf("记录")>-1){return e.csCode;}else{return"<span>"+e.csCode+":"+e.csName+"</span>";
}}},{name:"status",width:60,formatter:function(c,e,f){var d=f.status;if(f.status=="awaiting_pay"){d="待支付";}else{if(f.status=="awaiting_post"){d="待提交";}else{if(f.status=="awaiting_comfirm"){d="待审核";
}else{if(f.status=="comfirm"){d="待发货";}else{if(f.status=="shipping"){d="已发货";}else{if(f.status=="complete"){d="已签收";}else{if(f.status=="close"){d="已作废";
}else{if(f.status=="close_reject"){d="已拒收";}else{if(f.status=="close_lost"){d="已丢失";}}}}}}}}}return d;}},{name:"qty",width:90,sortable:true},{name:"placeTime",width:90,sortable:false},{name:"completeTime",width:90,sortable:false},],gridComplete:function(){var d=$(StStockReportOutQtyDetail._CONS_.GRID).jqGrid("getCol","qty",true,"sum");
var c=$(StStockReportOutQtyDetail._CONS_.GRID).jqGrid("getGridParam","records");$(StStockReportOutQtyDetail._CONS_.GRID).footerData("set",{"csCode":"共<span style='color:red;'>"+c+"</span>条记录, 数量总计：<span style='color:red;'>"+d+"</span>"});
var e=$(StStockReportOutQtyDetail._CONS_.GRID).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow");e.find('td[aria-describedby*="placeTime"],td[aria-describedby*="completeTime"],td[aria-describedby*="profitAid"],td[aria-describedby*="status"],td[aria-describedby*="soNo"]').hide();
},});}};