$(function(){var a=new StockProdReport();a.init();});function StockProdReport(){this.hadInit=false;this.isEdit=false;this.baseUrl=ctx+"/crm/report/prodAndStockReport/stockProdReport/listData.htm";
this.exportUrl=ctx+"/crm/report/prodAndStockReport/stockProdReport/exportReport.htm";this.isManyStore=isManyStore?isManyStore:"y";}StockProdReport.GRID="#stockProdReportGrid";
StockProdReport.PAGER="#stockProdReportPager";StockProdReport.prototype={init:function(b){if(!this.hadInit){this.hadInit=true;this._bindEventHander();StoreUtils.loadStores("","storeIdSearch");
this._loadProdCateTree();var a={};this._hideNeedHide();this._initJqgrid(a);}},_hideNeedHide:function(){if(this.isManyStore=="n"){$(".hiddenWhenHasOneStore").hide();
}},_buildParams:function(){var a={};if($("#storeIdSearch").val()!=null&&$("#storeIdSearch").val()!=""){a.Q__S__EQ__store_id_=$("#storeIdSearch").val();
}if($("#cateIdSearch").val()!=null&&$("#cateIdSearch").val()!=""){a.Q__S__EQ__cate_id_=$("#cateIdSearch").val();}if($("#prodName").val()!=null&&$("#prodName").val()!=""){a.Q__S__LK__name_=$("#prodName").val();
}return a;},_bindEventHander:function(){var a=this;$("#searchBtn").on("click",function(){var b=a._buildParams();a.reloadJqgrid(b);});$(".exportExcel").on("click",function(){var b=a.exportUrl;
var c=a._buildParams();FormUtils.submit(b,c,function(d){if(d.success){DialogUtils.success(msgCode.INFO,d.msg);}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});$("#prodDetType").on("click",function(){var b={isMultiple:0,typeKey:"product_catalog",selectedCateIds:$("#cateIdSearch").val(),pKey:"category",container:"prodDetType",reinit:true,fn:function(c){$("#cateIdSearch").val(c);
}};if($("#prodTypeSearch").val()=="point"){b.pKey="prodPoint";}CateUtils.selectCateTreeBox(b);});},_loadProdCateTree:function(){var a=this;var b={treeId:"prodEntityCateTree",cateTypeKey:"product_catalog",rootKey:"category",onClick:function(c){var d=c.id;
$("#cateIdSearch").val(d);}};ZtreeUtils.init(b);},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(StockProdReport.GRID,a);},_initJqgrid:function(b){var a=false;
if(this.isManyStore=="n"){a=true;}$(StockProdReport.GRID).JTJqgrid({url:this.baseUrl,postData:b,multiselect:false,rowNum:-1,footerrow:true,colNames:["仓库名称","产品分类","sku款号","品名","仓位","库存总数","不良品数","采购周期","周转率","销售总数","平均销售","可支持天数","库存下限"],colModel:[{name:"storeName",width:100},{name:"cateName",width:100},{name:"skuCode",width:120},{name:"prodName",width:120},{name:"position",width:80},{name:"total",width:90},{name:"badQty",width:70},{name:"salesDays",width:80},{name:"turnoverRate",width:80,formatter:function(c,d,f){if(f.inNum&&f.outNum){var e=parseFloat(((f.outNum/f.inNum)*100).toFixed(2))+"%";
return e;}else{return"0%";}}},{name:"salesSum",width:70},{name:"salesAvg",width:70},{name:"salesSupport",width:120,formatter:function(c){return Math.round(parseFloat(c));
}},{name:"alertMin",width:100}],gridComplete:function(){var f=$(StockProdReport.GRID).jqGrid("getCol","total",true,"sum");var e=$(StockProdReport.GRID).jqGrid("getCol","badQty",true,"sum");
var d=$(StockProdReport.GRID).jqGrid("getCol","salesSum",true,"sum");var c=$(StockProdReport.GRID).jqGrid("getGridParam","records");$(StockProdReport.GRID).footerData("set",{"skuCode":"总计：<span style='color:red;'>"+c+"</span>条","total":"库存总数：<span style='color:red;'>"+f+"</span>","badQty":"不良品数：<span style='color:red;'>"+e+"</span>","salesSum":"销售总数：<span style='color:red;'>"+d+"</span>"});
var g=$(StockProdReport.GRID).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow");g.find("td").css({"font-weight":400});},});}};