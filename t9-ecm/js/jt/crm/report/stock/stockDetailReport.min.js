$(function(){var a=new StockDetailReport();a.init();});function StockDetailReport(){this.hadInit=false;this.isEdit=false;this.baseUrl=ctx+"/crm/report/prodAndStockReport/stockDetailReport/listData.htm";
this.exportUrl=ctx+"/crm/report/prodAndStockReport/stockDetailReport/exportReport.htm";this.isManyStore=isManyStore?isManyStore:"y";}StockDetailReport.GRID="#stockDetailReportGrid";
StockDetailReport.PAGER="#stockDetailReportPager";StockDetailReport.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();
StoreUtils.loadStores("","storeIdSearch");a._loadProdCateTree();a._hideNeedHide();$("#thisMonth").trigger("click");a._initJqgrid(a._getParam());a._setYearAndMonth();
}},_hideNeedHide:function(){if(this.isManyStore=="n"){$(".hiddenWhenHasOneStore").hide();}},_getParam:function(){var a={};if($("#storeIdSearch").val()!=null&&$("#storeIdSearch").val()!=""){a["Q__S__EQ__stlog.store_id_"]=$("#storeIdSearch").val();
}if($("#cateIdSearch").val()!=null&&$("#cateIdSearch").val()!=""){a["cateId"]=$("#cateIdSearch").val();}if($("#prodName").val()!=null&&$("#prodName").val()!=""){a["Q__S__LK__prod.name_"]=$("#prodName").val();
}if($("#beginTime").val()!=null&&$("#beginTime").val()!=""){a["beginTime"]=$("#beginTime").val();}if($("#endTime").val()!=null&&$("#endTime").val()!=""){a["endTime"]=$("#endTime").val();
}return a;},_bindEventHander:function(){var b=this;$("#searchBtn").on("click",function(){var e=b._getParam();b.reloadJqgrid(e);return false;});$(".exportExcel").on("click",function(){var f=$("#exportType").val();
var e=b.exportUrl;var g=b._getParam();FormUtils.submit(e,g,function(h){if(h.success){DialogUtils.success(msgCode.INFO,h.msg+"成功");}else{DialogUtils.error(msgCode.FAIL_MSG,h.msg+"失败");
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});function c(j,g){if(g=="first"){return j.getFullYear()+(j.getMonth()+1>9?"-"+(j.getMonth()+1):"-0"+(j.getMonth()+1))+"-01 00:00:00";
}else{if(g=="last"){var h=j.getMonth();var f=++h;var i=new Date(j.getFullYear(),f,1);var e=1000*60*60*24;j=new Date(i.getTime()-e);return j.getFullYear()+(j.getMonth()+1>9?"-"+(j.getMonth()+1):"-0"+(j.getMonth()+1))+(j.getDate()>9?"-"+j.getDate():"-0"+j.getDate())+" 23:59:59";
}else{return j.getFullYear()+(j.getMonth()+1>9?"-"+(j.getMonth()+1):"-0"+(j.getMonth()+1))+(j.getDate()>9?"-"+j.getDate():"-0"+j.getDate())+" 23:59:59";
}}}$("#thisMonth").on("click",function(){var g=new Date();var f=c(g);var e=c(g,"first");$("#beginTime").val(e);$("#endTime").val(f);});$("#preMonth").on("click",function(){var e=new Date();
if(e==""||e==null){e=c(new Date());}var g=new Date(e);g.setMonth(g.getMonth()-1);var f=c(g,"last");e=c(g,"first");$("#beginTime").val(e);$("#endTime").val(f);
});$("#yearSelect").on("change",function(){a();});$("#monthSelect").on("change",function(){a();});$(".layer-date").unbind("click");$(".layer-date").on("click",function(){laydate({istime:true,format:"YYYY-MM-DD"});
});function a(){var h=$("#yearSelect").val();var j=$("#monthSelect").val();if(d(h)&&d(j)){var e=h+"-"+j+"-01 00:00:00";var f=c(new Date(e),"last");$("#beginTime").val(e);
$("#endTime").val(f);}else{if(d(h)){var e=h+"-01-01 00:00:00";var f=h+"-12-31 23:59:59";$("#beginTime").val(e);$("#endTime").val(f);}else{if(d(j)){var g=new Date();
var e=g.getFullYear()+"-"+j+"-01 00:00:00";var i=new Date(e);var f=c(i,"last");$("#beginTime").val(e);$("#endTime").val(f);}else{$("#beginTime").val("");
$("#endTime").val("");}}}}function d(e){if(e!=null&&e!=""){return true;}else{return false;}}$("#prodDetType").on("click",function(){var e={isMultiple:0,typeKey:"product_catalog",selectedCateIds:$("#cateIdSearch").val(),pKey:"category",container:"prodDetType",reinit:true,fn:function(f){$("#cateIdSearch").val(f);
}};if($("#prodTypeSearch").val()=="point"){e.pKey="prodPoint";}CateUtils.selectCateTreeBox(e);});},_loadProdCateTree:function(){var a=this;var b={treeId:"prodEntityCateTree",cateTypeKey:"product_catalog",rootKey:"category",onClick:function(c){var d=c.id;
$("#cateIdSearch").val(d);}};ZtreeUtils.init(b);},_setYearAndMonth:function(){var d="<option value=''>选择年份</option>";var a=new Date();var c=a.getFullYear();
for(var b=c;b>c-10;b--){d+="<option value='"+b+"'>"+b+"</option>";}$("#yearSelect").append(d);var e="<option value=''>选择月份</option>";for(var b=1;b<13;b++){if(b<10){e+="<option value='"+"0"+b+"'>"+"0"+b+"</option>";
}else{e+="<option value='"+b+"'>"+b+"</option>";}}$("#monthSelect").append(e);},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(StockDetailReport.GRID,a);
},_initJqgrid:function(b){var a=false;if(this.isManyStore=="n"){a=true;}$(StockDetailReport.GRID).JTJqgrid({url:this.baseUrl,postData:b,footerrow:true,multiselect:false,rowNum:-1,colNames:["仓库名称","产品分类","sku款号","品名","报表简称","采购入库","调库入库","拒收退回","盘盈","销售出库","调库出库","盘亏","人工出库","差额","现有库存","平均每日出库量"],colModel:[{name:"storeName",width:120},{name:"cateName",width:100},{name:"skuCode",width:80},{name:"prodName",width:120},{name:"shortName",width:120},{name:"in",width:80},{name:"allocateIn",width:120},{name:"rejectIn",width:120},{name:"checkIn",width:80},{name:"out",width:120},{name:"allocateOut",width:120},{name:"checkOut",width:80},{name:"manualOut",width:120},{name:"balance",width:80},{name:"currentStock",width:120},{name:"avgOfOut",width:120}],gridComplete:function(){var j=$(StockDetailReport.GRID).jqGrid("getCol","in",true,"sum");
var o=$(StockDetailReport.GRID).jqGrid("getCol","allocateIn",true,"sum");var f=$(StockDetailReport.GRID).jqGrid("getCol","rejectIn",true,"sum");var d=$(StockDetailReport.GRID).jqGrid("getCol","checkIn",true,"sum");
var i=$(StockDetailReport.GRID).jqGrid("getCol","out",true,"sum");var g=$(StockDetailReport.GRID).jqGrid("getCol","allocateOut",true,"sum");var k=$(StockDetailReport.GRID).jqGrid("getCol","checkOut",true,"sum");
var h=$(StockDetailReport.GRID).jqGrid("getCol","manualOut",true,"sum");var e=$(StockDetailReport.GRID).jqGrid("getCol","balance",true,"sum");var n=$(StockDetailReport.GRID).jqGrid("getCol","currentStock",true,"sum");
var c=$(StockDetailReport.GRID).jqGrid("getCol","avgOfOut",true,"sum");var l=$(StockDetailReport.GRID).jqGrid("getGridParam","records");$(StockDetailReport.GRID).footerData("set",{"skuCode":"总计：<span style='color:red;'>"+l+"</span>条","in":"<span style='color:red;'>"+j+"</span>","allocateIn":"<span style='color:red;'>"+o+"</span>","rejectIn":"<span style='color:red;'>"+f+"</span>","checkIn":"<span style='color:red;'>"+d+"</span>","out":"<span style='color:red;'>"+i+"</span>","allocateOut":"<span style='color:red;'>"+g+"</span>","manualOut":"<span style='color:red;'>"+h+"</span>","checkOut":"<span style='color:red;'>"+k+"</span>","balance":"<span style='color:red;'>"+e+"</span>","currentStock":"<span style='color:red;'>"+n+"</span>","avgOfOut":"<span style='color:red;'>"+c+"</span>"});
var m=$(StockDetailReport.GRID).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow");m.find("td").css({"font-weight":400});},});}};