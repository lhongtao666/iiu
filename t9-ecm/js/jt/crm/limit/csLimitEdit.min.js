$(function(){var a=new CsLimitEdit();a.init();});function CsLimitEdit(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.csLimitAttach=new CsLimitAttach();
}CsLimitEdit._CONS_={EDIT_URL:ctx+"/crm/limit/csLimit/edit.htm",MODIFY_URL:ctx+"/crm/limit/csLimit/modifyStatus.htm",MODIFY_RETURN_URL:ctx+"/crm/limit/csLimit/modifyReturnStatus.htm",SAVE_EDIT_URL:ctx+"/crm/limit/csLimit/saveEdit.htm",EDIT_FORM_ID:"csLimitForm"};
CsLimitEdit.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindFormValidation();this._bindEventHander();this.csLimitAttach.init();
this._loadData(id);}},_loadData:function(b){var a=this;FormUtils.loadData(CsLimitEdit._CONS_.EDIT_URL+"?id="+b,function(e){var d=$("#csLimitForm");var c=e.status;
if(c=="awaiting_confirm"){d.find("input[name=statusShow]").val("待确认条款");}else{if(c=="close"){d.find("input[name=statusShow]").val("作废");}else{if(c=="accept"){d.find("input[name=statusShow]").val("已接受条款");
}else{if(c=="post"){d.find("input[name=statusShow]").val("已提交材料");}else{if(c=="reject"){d.find("input[name=statusShow]").val("风控拒绝");}else{if(c=="awaiting_limit"){d.find("input[name=statusShow]").val("待接受额度");
}else{if(c=="reject_limit"){d.find("input[name=statusShow]").val("放弃额度");}else{if(c=="accept_limit"){d.find("input[name=statusShow]").val("接受额度");}else{if(c=="expire"){d.find("input[name=statusShow]").val("过期");
}}}}}}}}}if("none"==e.returnStatus){d.find("input[name=returnStatus]").val("未回访");}else{if("done"==e.returnStatus){d.find("input[name=returnStatus]").val("已回访");
}}d.find("input[name=id]").val(e.id);d.find("input[name=csId]").val(e.csId);d.find("input[name=expectLimit]").val(e.expectLimit);d.find("input[name=limit]").val(e.limit);
d.find("textarea[name=comment]").val(e.comment);d.find("input[name=riskAuditor]").val(e.riskAuditor);d.find("input[name=auditTime]").val(e.auditTime);d.find("input[name=auditComment]").val(e.auditComment);
d.find("input[name=createBy]").val(e.createBy);d.find("input[name=createTime]").val(e.createTime);d.find("input[name=updateBy]").val(e.updateBy);d.find("input[name=hidden]").val(e.hidden);
a.csLimitAttach.createFiles(e.csLimitAttachPos);if(("close"==e.status||"reject"==e.status||"reject_limit"==e.status||"accept_limit"==e.status)&&e.returnStatus=="none"){$(".csLimitReturn").show();
}if("awaiting_confirm"==e.status){$(".acceptBtn").show();$(".uploadDiv").hide();}if("accept"==e.status){$(".saveBtn").show();$(".csLimitPost").show();$(".trunDownBtn").show();
}if("awaiting_limit"==e.status){$(".csLimitAccept").show();$(".csLimitReject").show();$("input[name=limit]").attr("disabled",false);}});},_saveEdit:function(a){var c=this;
if($("#csLimitForm").valid()){$("#csLimitForm").find("input[name=status]").val(a);ButtonUtils.disableBtn("saveBtn");var b=$("#"+CsLimitEdit._CONS_.EDIT_FORM_ID).serialize()+"&csLimitAttachJSON="+c.csLimitAttach.getFiles();
FormUtils.submit(CsLimitEdit._CONS_.SAVE_EDIT_URL,b,function(d){ButtonUtils.enableBtn("saveBtn");if(d.success){if(d.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);
c.init(id);}else{if(d.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);}}c.isEdit=false;}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);
}},function(){ButtonUtils.enableBtn("saveBtn");DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}},_modify:function(d,a){var b=this;var c=$("#csLimitForm").find("input[name=csId]").val();
if(a=="accept"){var e="是否确认接受条款？";}if(a=="awaiting_confirm"){var e="是否驳回至待确认状态？";}DialogUtils.confirmWithOptions({title:e,text:"",confirmButtonText:"确认",yesFunc:function(){FormUtils.submit(CsLimitEdit._CONS_.MODIFY_URL,"csLimitId="+d+"&status="+a,function(f){if(f.success){b.init(id);
DialogUtils.success(msgCode.INFO,"修改成功");}else{DialogUtils.error(msgCode.ERROR,f.msg);}});}});},_modifyReturnStatus:function(c,a){var b=this;FormUtils.submit(CsLimitEdit._CONS_.MODIFY_RETURN_URL,"csLimitId="+c,function(d){if(d.success){DialogUtils.success(msgCode.INFO,"已回访");
}else{DialogUtils.error(msgCode.ERROR,d.msg);}});},_bindEventHander:function(){var a=this;$(document).on("click",".prevBtn",function(){JTTabUtils.closeTab($(window.top.document).find(".page-tabs-content").find(".active").attr("data-id"));
});$(document).on("click",".saveBtn",function(){a._saveEdit("accept");});$(document).on("click",".acceptBtn",function(){a._saveEdit("accept");});$(document).on("click",".csLimitAccept",function(){a._saveEdit("awaiting_confirm");
});$(document).on("click",".csLimitPost",function(){a._saveEdit("post");});$(document).on("click",".trunDownBtn",function(){var b="awaiting_confirm";var c=$("#csLimitForm").find("input[name=id]").val();
a._modify(c,b);});$(document).on("click",".csLimitReject",function(){var b="awaiting_confirm";var c=$("#csLimitForm").find("input[name=id]").val();a._modify(c,b);
});$(document).on("click",".csLimitReturn",function(){var b=$("#csLimitForm").find("input[name=id]").val();a._modifyReturnStatus(b);});$("#"+CsLimitEdit._CONS_.EDIT_FORM_ID).on("change","input",function(){if(a.isEdit){a.isFormDataChange=true;
}});$("#"+CsLimitEdit._CONS_.EDIT_FORM_ID).on("change","select",function(){if(a.isEdit){a.isFormDataChange=true;}});$("#"+CsLimitEdit._CONS_.EDIT_FORM_ID).on("change","textarea",function(){if(a.isEdit){a.isFormDataChange=true;
}});},_bindFormValidation:function(){var a={rules:{expectLimit:{required:true}},messages:{}};FormUtils.bindFormValidation(CsLimitEdit._CONS_.EDIT_FORM_ID,a);
},};