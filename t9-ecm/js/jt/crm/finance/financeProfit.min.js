$(function(){var a=new FinanceProfit();a.init();});function FinanceProfit(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.sortColumn="";
this.sortorder="";}FinanceProfit._CONS_={EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",LIST_DATA_URL:ctx+"/crm/finance/financeProfit/listData.htm",EXPORT_URL:ctx+"/crm/finance/financeProfit/exportExcel.htm",EDIT_FORM_ID:"financeProfitForm",GRID:"#financeProfitGrid",PAGER:"#financeProfitPager"};
FinanceProfit.prototype={init:function(a){if(!this.hadInit){ReportDateUtil.initDate(".report-content");$("#timeTypeSearch").change();this.hadInit=true;
this._bindFormValidation();this._bindEventHander();this._initJqgrid(a);this._hideNotGrantBtn();}},_hideNotGrantBtn:function(){if(!ResUtils.canShow("financeProfit.button.detail")){$(".financeProfitDetail").hide();
}if(!ResUtils.canShow("financeProfit.button.add")){$(".financeProfitAdd").hide();}if(!ResUtils.canShow("financeProfit.button.edit")){$(".financeProfitEdit").hide();
}if(!ResUtils.canShow("financeProfit.button.delete")){$(".financeProfitDel").hide();}},clear:function(c){var a=this;function b(){a._showListWrapper();a.isFormDataChange=false;
a.isEdit=false;$(".form_wrapper .saveBtn").show();FormUtils.clear(FinanceProfit._CONS_.EDIT_FORM_ID);FormUtils.enableForm(FinanceProfit._CONS_.EDIT_FORM_ID);
if(c){a.reloadJqgrid();}}if(a.isEdit&&a.isFormDataChange){DialogUtils.warning(function(){b();});}else{b();}},_showListWrapper:function(){$(".list_wrapper").show();
$(".form_wrapper").hide();},_showFormWrapper:function(){$(".list_wrapper").hide();$(".form_wrapper").show();},_add:function(){this._showFormWrapper();},_edit:function(a){this._showFormWrapper();
this.edit=true;this._loadData(a);},_detail:function(a){this._showFormWrapper();this._loadData(a);$(".form_wrapper .saveBtn").hide();FormUtils.disableForm(FinanceProfit._CONS_.EDIT_FORM_ID);
},_loadData:function(b){var a=this;FormUtils.loadData(FinanceProfit._CONS_.EDIT_URL+"?id="+b,function(c){$("input[name=id]").val(c.id);$("input[name=csId]").val(c.csId);
$("input[name=csName]").val(c.csName);$("input[name=csCode]").val(c.csCode);$("input[name=employeeId]").val(c.employeeId);$("input[name=employeeAid]").val(c.employeeAid);
$("input[name=employeeName]").val(c.employeeName);$("input[name=groupKey]").val(c.groupKey);$("input[name=groupId]").val(c.groupId);$("input[name=type]").val(c.type);
$("input[name=amount]").val(c.amount);$("input[name=operTime]").val(c.operTime);$("input[name=createTime]").val(c.createTime);$("input[name=createBy]").val(c.createBy);
});},_save:function(){var b=this;var c=$("#id").val();var a=null;if(c!=null&&c!=""){a=FinanceProfit._CONS_.SAVE_EDIT_URL;}else{a=FinanceProfit._CONS_.SAVE_ADD_URL;
}if($("#financeProfitForm").valid()){ButtonUtils.disableBtn("saveBtn");FormUtils.submitByFormId(a,FinanceProfit._CONS_.EDIT_FORM_ID,function(d){ButtonUtils.enableBtn("saveBtn");
if(d.success){if(d.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);}else{if(d.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
}}b.isEdit=false;b.clear(true);}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);}},function(){ButtonUtils.enableBtn("saveBtn");DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}},_delete:function(b){var a=this;DialogUtils.confirm(function(){FormUtils.del(FinanceProfit._CONS_.DELETE_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,msgCode.DELETE_MSG);
a.reloadJqgrid();}else{DialogUtils.error(msgCode.ERROR,c.msg);}});});},_bindEventHander:function(){var a=this;$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
FormUtils.loadData(FinanceProfit._CONS_.EMPLOYEE_LIST_URL+"?groupId="+c+"&type=statistics,dept_manager",function(e){var f=new StringBuffer();f.append('<option value="">请选择</option>');
for(var d=0;d<e.length;d++){f.append("<option value='"+e[d].id+"'>"+e[d].aid+":"+e[d].name+"</option>");}$("#belongEmployee").empty().append(f.toString());
});}};GroupUtils.selectGroupTreeBox(b);});$("#searchBtn").on("click",function(){a.reloadJqgrid(a.toPostParam());});$(".exportExcel").on("click",function(){ButtonUtils.disableBtn("exportExcel");
FormUtils.submit(FinanceProfit._CONS_.EXPORT_URL,a.toPostParam()+"&sidx="+a.sortColumn+"&sord="+a.sortorder,function(b){ButtonUtils.enableBtn("exportExcel");
if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});},_bindFormValidation:function(){var a={rules:{},messages:{}};FormUtils.bindFormValidation(FinanceProfit._CONS_.EDIT_FORM_ID,a);},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(FinanceProfit._CONS_.GRID,a);
},_getManagerBtns:function(){var a=[];if(ResUtils.canShow("financeProfit.button.delete")){a.push({lable:msgCode.DELETE_BTN_TEXT,btnClasses:"financeProfitDel",iconClasses:"fa fa-remove"});
}if(ResUtils.canShow("financeProfit.button.edit")){a.push({lable:msgCode.EDIT_BTN_TEXT,btnClasses:"financeProfitEdit",iconClasses:"fa fa-edit"});}if(ResUtils.canShow("financeProfit.button.detail")){a.push({lable:msgCode.DETAIL_BTN_TEXT,btnClasses:"financeProfitDetail",iconClasses:"fa fa-list"});
}return a;},_initJqgrid:function(){var b={};var a=this;b.Q__D__BW__oper_time_=ReportDateUtil.getDateTimeRangeStr();$(FinanceProfit._CONS_.GRID).JTJqgrid({url:FinanceProfit._CONS_.LIST_DATA_URL,postData:b,footerrow:true,sortable:true,rowNum:-1,colNames:["部门","员工","新意向客户数","新面谈客户数","面谈客户数","成交客户数","成交金额","操作"],colModel:[{name:"groupName",sortable:false,width:120},{name:"employeeName",sortable:false,width:120},{name:"intention",width:120},{name:"newMeeting",width:120},{name:"meeting",width:120},{name:"turnover",width:120},{name:"totalAmount",width:120},{name:"__manage",width:40,classes:"rowOps",sortable:false,align:"center",formatter:"manage",formatoptions:this._getManagerBtns()}],gridComplete:function(){var h=$(FinanceProfit._CONS_.GRID).jqGrid("getCol","intention",true,"sum");
var d=$(FinanceProfit._CONS_.GRID).jqGrid("getCol","newMeeting",true,"sum");var g=$(FinanceProfit._CONS_.GRID).jqGrid("getCol","meeting",true,"sum");var f=$(FinanceProfit._CONS_.GRID).jqGrid("getCol","turnover",true,"sum");
var e=$(FinanceProfit._CONS_.GRID).jqGrid("getCol","totalAmount",true,"sum");var c=$(FinanceProfit._CONS_.GRID).jqGrid("getGridParam","records");$(FinanceProfit._CONS_.GRID).footerData("set",{"groupName":"总计：<span style='color:red;'>"+c+"</span>人","employeeName":"","intention":h,"newMeeting":d,"meeting":g,"turnover":f,"totalAmount":e.toFixed(2)});
},onSortCol:function(d,e,c){a.sortColumn=d;a.sortorder=c;}});},toPostParam:function(){var a=$("#profixSearchForm").serialize();a+="&Q__D__BW__oper_time_="+ReportDateUtil.getDateTimeRangeStr();
return a;}};