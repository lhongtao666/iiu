$(function(){var a=new AgentEntity();a.init();});function AgentEntity(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.rootAgent="";
this.agentDatas=null;this.agentId="";}AgentEntity._CONS_={EDIT_URL:ctx+"/crm/agent/agentEntity/edit.htm",DETAIL_URL:ctx+"/crm/agent/agentEntity/detail.htm",DELETE_URL:ctx+"/crm/agent/agentEntity/delete.htm",SAVE_ADD_URL:ctx+"/crm/agent/agentEntity/saveAdd.htm",SAVE_EDIT_URL:ctx+"/crm/agent/agentEntity/saveEdit.htm",LIST_DATA_URL:ctx+"/crm/agent/agentEntity/listData.htm",LEVEL_URL:ctx+"/crm/agent/agentLevel/listData.htm",FORBIDORACTIVE_URL:ctx+"/crm/agent/agentEntity/forbidOrActive.htm",EXPORT_URL:ctx+"/crm/agent/agentEntity/export.htm",LIST_AGENT_TREE:ctx+"/gl/ou/group/findAgentTree.htm",STORE_URL:ctx+"/crm/agent/agentEntity/store.htm",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",EDIT_FORM_ID:"agentEntityForm",GRID:"#agentEntityGrid",PAGER:"#agentEntityPager"};
AgentEntity.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._initAgentEntityTree();this._bindFormValidation();this._bindEventHander();
this._initJqgrid(a);this._hideNotGrantBtn();this._loadLevel();this._loadStore();$(".storeIdGroup").show();}},_hideNotGrantBtn:function(){if(!ResUtils.canShow("agentEntity.button.add")){$(".agentEntityAdd").hide();
}},clear:function(c){var a=this;function b(){a._showListWrapper();a.isFormDataChange=false;a.isEdit=false;$(".form_wrapper .saveBtn").show();FormUtils.clear(AgentEntity._CONS_.EDIT_FORM_ID);
FormUtils.enableForm(AgentEntity._CONS_.EDIT_FORM_ID);if(c){a.reloadJqgrid();}}if(a.isEdit&&a.isFormDataChange){DialogUtils.warning(function(){b();});}else{b();
}},_add:function(){JTTabUtils.addOrRefreshTab(ctx+"/crm/agent/agentEntity/add.htm","新增代理商");},_loadLevel:function(){var a=this;var b=AgentEntity._CONS_.LEVEL_URL;
FormUtils.loadData(b,function(e){var c=e.rows;if(c){var f=new StringBuffer();f.append("<option value=''>请选择</option>");for(var d=0;d<c.length;d++){f.append("<option value='"+c[d].id+"'>"+c[d].name+"</option>");
}$(".levelId").empty().append(f.toString());}});},_loadStore:function(){var a=this;var b=AgentEntity._CONS_.STORE_URL;var c=a._getContainer("storeIds");
if(!c){return false;}FormUtils.loadData(b,function(e){if(e&&e.length>0){var f=new StringBuffer();for(var d=0;d<e.length;d++){f.append("<option value='"+e[d].id+"'>"+e[d].name+"</option>");
}c.empty().append(f.toString());}if(c&&c.is(".selectpicker")){c.selectpicker("refresh");}});},_getContainer:function(b){var a=this;var c=false;if(b){c=$("#"+b);
if(c.length==0){c=$("select."+b);if(c.length==0){c=$("select[name='"+b+"']");if(c.length==0){return false;}}}}return c;},_edit:function(b,a){JTTabUtils.addOrRefreshTab(ctx+"/crm/agent/agentEntity/toEdit.htm?agentId="+b,a);
},_delete:function(b){var a=this;DialogUtils.confirm(function(){FormUtils.del(AgentEntity._CONS_.DELETE_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,msgCode.DELETE_MSG);
a.reloadJqgrid();}else{DialogUtils.error(msgCode.ERROR,c.msg);}});});},_forbidOrActive:function(d,a){var b=this;var c=AgentEntity._CONS_.FORBIDORACTIVE_URL;
FormUtils.submit(c,{id:d,status:a},function(e){if(e.success){DialogUtils.success("提示","操作成功");b.reloadJqgrid();}else{DialogUtils.error("提示","后台异常");}});
},_bindEventHander:function(){var a=this;$(document).on("click",".chooseGroupMgr",function(){var b=new EmployeesSelect();var c={grantType:"/role/",isMultiple:0,isSale:0,mode:0,type:"agentEmp",agentId:a.agentId,callBack:function(d){$("#orgGroupForm").find("[name=groupMgrName]").val(d[0].aid+":"+d[0].name);
$("#orgGroupForm").find("[name='groupMgr']").val(d[0].id);}};b.init(c);});$(document).on("click","#clearGroupMgr",function(){$("#orgGroupForm").find("[name=groupMgrName]").val("");
$("#orgGroupForm").find("[name='groupMgr']").val("");});$(document).on("click",".chooseCreateTo",function(){var b=new EmployeesSelect();var c={grantType:"/role/",isMultiple:0,isSale:0,mode:0,type:"agentEmp",agentId:a.agentId,callBack:function(d){$("#orgGroupForm").find("[name=createToName]").val(d[0].aid+":"+d[0].name);
$("#orgGroupForm").find("[name='createTo']").val(d[0].id);}};b.init(c);});$(document).on("click","#clearTransTo",function(){$("#orgGroupForm").find("[name=transToName]").val("");
$("#orgGroupForm").find("[name='transTo']").val("");});$(document).on("click","#clearCreateTo",function(){$("#orgGroupForm").find("[name=createToName]").val("");
$("#orgGroupForm").find("[name='createTo']").val("");});$(document).on("click",".chooseTransTo",function(){var b=new EmployeesSelect();var c={grantType:"/role/",isMultiple:0,isSale:0,mode:0,type:"agentEmp",agentId:a.agentId,callBack:function(d){$("#orgGroupForm").find("[name=transToName]").val(d[0].aid+":"+d[0].name);
$("#orgGroupForm").find("[name='transTo']").val(d[0].id);}};b.init(c);});$(document).on("click",".agentForbid",function(){var c=$(this).attr("idVal");var b="actived";
DialogUtils.confirmWithOptions({title:"提示",text:"要禁用该代理商吗，请谨慎操作？",confirmButtonText:"确认",yesFunc:function(){a._forbidOrActive(c,b);}});});$(document).on("click",".agentActive",function(){var c=$(this).attr("idVal");
var b="inactive";DialogUtils.confirmWithOptions({title:"提示",text:"要激活该代理商吗，请谨慎操作？",confirmButtonText:"确认",yesFunc:function(){a._forbidOrActive(c,b);}});
});$(document).on("click",".agentEntityBill",function(){JTTabUtils.addOrRefreshTab(ctx+"/crm/agent/agentBill/list.htm?agentId="+$(this).attr("idVal")+"&agentName="+$(this).attr("agentName"),$(this).attr("agentName")+"对账管理");
});$(document).on("click",".prevBtn",function(){a.clear(false);});$(document).on("click",".saveBtn",function(){a._save();});$(document).on("click",".agentEntitySearch",function(){var b=$(this).closest("form").serialize();
a.reloadJqgrid(b);});$(document).on("keypress",".agentEntitySearch",function(b){if(b.keyCode=="13"){$(".agentEntitySearch").trigger("click");}});$("body").on("click",".agentEntityAdd",function(){a._add();
});$("body").on("click",".agentEntityEdit",function(){a.isEdit=true;var b=$(this).attr("idVal");var c=$(this).attr("agentName");c="代理商["+c+"]";if(!b){b=$(AgentEntity._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);
return;}}}a._edit(b,c);});$("body").on("click",".agentEntityDel",function(){var b=$(this).attr("idVal");if(!b){b=$(AgentEntity._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_DELETE);return;}}a._delete(b);});$(document).on("click",".exportExcel",function(){var b=$(this).closest("form").serialize();
a._exportExcel(b);});$("#agentEntityTreeSearch").on("keyup",function(b){if(b.keyCode==13){a._searchNode(b);a._callNumber();}});$("#clickUp").on("click",function(){a._clickUp();
});$("#clickDown").on("click",function(){a._clickDown();});$(document).on("click","input[name=isSale]",function(){var b=$(this).val();if(b=="y"){$("#orgGroupForm").find("#createToDiv").show();
$("#orgGroupForm").find("#saleRangeDiv").show();$("#orgGroupForm").find("#saleLineDiv").show();$("#orgGroupForm").find("#salePercentDiv").show();$("#orgGroupForm").find(".needFinanceConfirmDiv").show();
$("#orgGroupForm").find("[name=saleLine]").val(["one"]);$("#orgGroupForm").find("[name=needFinanceConfirm]").val(["y"]);$("#orgGroupForm").find("[name=saleLine]").attr("required",true);
$("#orgGroupForm").find("[name=needFinanceConfirm]").attr("required",true);}else{if(b=="n"){$("#orgGroupForm").find("#createToDiv").hide();$("#orgGroupForm").find("#saleRangeDiv").hide();
$("#orgGroupForm").find("#saleLineDiv").hide();$("#orgGroupForm").find("#salePercentDiv").hide();$("#orgGroupForm").find(".needFinanceConfirmDiv").hide();
$("#orgGroupForm").find("[name=transTo]").val("");$("#orgGroupForm").find("[name=createTo]").val("");$("#orgGroupForm").find("[name=createToName]").val("");
$("#orgGroupForm").find("[name=saleLine]").val([""]);$("#orgGroupForm").find("[name=needFinanceConfirm]").val(["y"]);$("#orgGroupForm").find("[name=saleLine]").removeAttr("required");
$("#orgGroupForm").find("[name=needFinanceConfirm]").removeAttr("required");}}});$(document).on("click","#agentEntityAddBtn",function(){$("input[name='parentId']").val(a.currentRightClickTreeNode.id);
if(a.currentRightClickTreeNode.level=="1"){var b="add";$("#groupMgrDiv").hide();$(".chooseTransTo").attr("disabled",true);$(".chooseCreateTo").attr("disabled",true);
$("#belongAgent").removeAttr("disabled");a._loadAgentArea(a.currentRightClickTreeNode.id,b);}else{$("#orgModalLabel").text("添加代理区域");$("#agentModalContainer").modal("show");
}});$(document).on("click","#agentEntityUpBtn",function(){if(a.currentRightClickTreeNode.agentId){$("#agentGroupModalContainer").modal("show");$("#orgGroupModalLabel").text("更新代理一级部门");
$("#groupMgrDiv").show();$(".chooseTransTo").removeAttr("disabled");$(".chooseCreateTo").removeAttr("disabled");var b="edit";FormUtils.loadData(ctx+"/gl/ou/group/edit.htm?id="+a.currentRightClickTreeNode.id,function(d){$("#orgGroupForm").find("input[name='id']").val(d.id);
$("#orgGroupForm").find("input[name='depth']").val(d.depth);$("#orgGroupForm").find("input[name='path']").val(d.path);$("#orgGroupForm").find("input[name='sort']").val(d.sort);
$("#orgGroupForm").find("input[name='createBy']").val(d.createBy);$("#orgGroupForm").find("input[name='createTime']").val(d.createTIme);$("#orgGroupForm").find("input[name='parentId']").val(d.parentId);
$("#orgGroupForm").find("input[name='name']").val(d.name);$("#orgGroupForm").find("input[name='isAgent']").val(d.isAgent);$("#orgGroupForm").find("select[name='agentId']").val(d.agentId);
$("#orgGroupForm").find("[name=saleLine]").val([d.saleLine]);$("#orgGroupForm").find("[name=needFinanceConfirm]").val([d.needFinanceConfirm]);$("#orgGroupForm").find("[name=createTo]").val([d.createTo]);
$("#orgGroupForm").find("[name=createTo]").val([d.createTo]);$("#orgGroupForm").find("[name=transTo]").val([d.transTo]);$("#orgGroupForm").find("[name=transToName]").val([d.transToName]);
$("#orgGroupForm").find("[name=workDays]").val([d.workDays]);$("#orgGroupForm").find("[name=workHours]").val([d.workHours]);$("#orgGroupForm").find("[name=upperLimit]").val([d.upperLimit]);
$("#orgGroupForm").find("[name=smsLimit]").val([d.smsLimit]);$("#orgGroupForm").find("[name=seaLimit]").val([d.seaLimit]);$("#orgGroupForm").find("[name=noOrderTime]").val([d.noOrderTime]);
a.agentId=d.agentId;if(d.percentLimit){$("#orgGroupForm").find("[name=percentLimit]").val([d.percentLimit]);}else{$("#orgGroupForm").find("[name=percentLimit]").val("");
}if(d.isParentIsSale){$("#orgGroupForm").find("#isNotSale").attr("disabled","disabled");}else{$("#orgGroupForm").find("#isNotSale").removeAttr("disabled");
}$("#orgGroupForm").find("[name=isSale]").val([d.isSale]);if(d.isSale==="y"){$("#orgGroupForm").find("#createToDiv").show();$("#orgGroupForm").find("#transToDiv").show();
$("#orgGroupForm").find("#saleRangeDiv").show();$("#orgGroupForm").find("#saleLineDiv").show();$("#orgGroupForm").find("#salePercentDiv").show();$("#orgGroupForm").find(".needFinanceConfirmDiv").show();
$("#orgGroupForm").find("[name=saleLine]").attr("required",true);$("#orgGroupForm").find("[name=needFinanceConfirm]").attr("required",true);$("#orgGroupForm").find("[name=saleRange]").attr("required",true);
}else{$("#orgGroupForm").find("#createToDiv").hide();$("#orgGroupForm").find("#transToDiv").hide();$("#orgGroupForm").find("#saleRangeDiv").hide();$("#orgGroupForm").find("#saleLineDiv").hide();
$("#orgGroupForm").find("#salePercentDiv").hide();$("#orgGroupForm").find(".needFinanceConfirmDiv").hide();$("#orgGroupForm").find("[name=saleRange]").removeAttr("required");
$("#orgGroupForm").find("[name=saleLine]").removeAttr("required");$("#orgGroupForm").find("[name=needFinanceConfirm]").removeAttr("required");}var e=a._getContainer("storeIds");
var c=d.storeIds.split(",");if(e){e.selectpicker("val",c);e.selectpicker("refresh");}a._loadAgentArea(a.currentRightClickTreeNode.parentId,b,d);$("#orgGroupForm").find("#belongAgent").attr("disabled","disabled");
});}else{$("#orgModalLabel").text("更新代理区域");$("#agentModalContainer").modal("show");FormUtils.loadData(ctx+"/gl/ou/group/edit.htm?id="+a.currentRightClickTreeNode.id,function(c){$("#orgForm").find("input[name='id']").val(c.id);
$("#orgForm").find("input[name='depth']").val(c.depth);$("#orgForm").find("input[name='path']").val(c.path);$("#orgForm").find("input[name='sort']").val(c.sort);
$("#orgForm").find("input[name='createBy']").val(c.createBy);$("#orgForm").find("input[name='createTime']").val(c.createTIme);$("#orgForm").find("input[name='parentId']").val(c.parentId);
$("#orgForm").find("input[name='name']").val(c.name);$("#orgForm").find("input[name='isAgent']").val(c.isAgent);$("#orgForm").find("select[name='agentId']").val(c.agentId);
});}});$("#agentModalContainer").on("hidden.bs.modal",function(){FormUtils.clear("orgForm");});$("#agentGroupModalContainer").on("hidden.bs.modal",function(){FormUtils.clear("orgGroupForm");
});$(document).on("click","#agentEntityDelBtn",function(){DialogUtils.confirm(function(){FormUtils.submit(ctx+"/gl/ou/group/delete.htm",{ids:a.currentRightClickTreeNode.id},function(d){if(d.success){var b=$.fn.zTree.getZTreeObj("agentEntityTree");
var c=b.getNodeByTId(a.currentRightClickTreeNode.tId);b.removeChildNodes(c);b.removeNode(c);DialogUtils.success(msgCode.SUCCESS,"删除成功");}else{DialogUtils.error(msgCode.ERROR,d.msg);
}});});});$(document).on("click",".saveAgentGroupBtn",function(){if($("#orgGroupForm").valid()){ButtonUtils.disableBtn("saveAgentGroupBtn");$("#orgGroupForm").find("input[name=isAgent]").val("y");
var b=$("#orgGroupForm").find("input[name='id']").val()?ctx+"/gl/ou/group/saveEdit.htm":ctx+"/gl/ou/group/saveAdd.htm";var e=$("#orgGroupForm").find("[name=isSale]:checked").val();
if(e!="y"){$("#orgGroupForm").find("[name=saleLine]").val(["one"]);$("#orgGroupForm").find("[name=createTo]").val("");$("#orgGroupForm").find("[name=transTo]").val("");
$("#orgGroupForm").find("[name=createToName]").val("");$("#orgGroupForm").find("[name=transToName]").val("");$("#orgGroupForm").find("[name=saleLine]").val([""]);
$("#orgGroupForm").find("[name=percentLimit]").val([""]);$("#orgGroupForm").find("[name=needFinanceConfirm]").val(["y"]);}$("#belongAgent").removeAttr("disabled");
var c=$("#storeIds option:selected").length;if(c!=0){a._buildstoreIdlSearch(c);}var d=$("#orgGroupForm").serialize();FormUtils.submit(b,d,function(k){ButtonUtils.enableBtn("saveAgentGroupBtn");
if(k.success){FormUtils.clear("orgGroupForm");$("#agentGroupModalContainer").modal("hide");var g=$.fn.zTree.getZTreeObj("agentEntityTree");if(k.msgCode==actionCode.CREATE){DialogUtils.success("提示","添加成功");
var f=g.getNodeByTId(a.currentRightClickTreeNode.tId);f.isParent="true";g.updateNode(f);var h=JSON.parse(k.msg);g.addNodes(f,-1,h);}else{DialogUtils.success("提示","修改成功");
var i=g.getNodeByTId(a.currentRightClickTreeNode.tId);var j=JSON.parse(k.msg);i.name=j.name;i.isSale=j.isSale;g.updateNode(i);}}else{DialogUtils.error("失败",k.msg);
}},function(){ButtonUtils.enableBtn("saveAgentGroupBtn");DialogUtils.error("错误","后台异常，请稍后重试");});}});$(document).on("click",".saveAgentAreaBtn",function(){var b=$("#orgForm").find("input[name='id']").val()?ctx+"/gl/ou/group/saveEdit.htm":ctx+"/gl/ou/group/saveAdd.htm";
ButtonUtils.disableBtn("saveAgentAreaBtn");$("#orgForm").find("input[name=isAgent]").val("y");$("#orgForm").find("input[name=isSale]").val("n");var c=$("#orgForm").serialize();
FormUtils.submit(b,c,function(i){ButtonUtils.enableBtn("saveAgentAreaBtn");if(i.success){FormUtils.clear("orgForm");$("#agentModalContainer").modal("hide");
var e=$.fn.zTree.getZTreeObj("agentEntityTree");if(i.msgCode==actionCode.CREATE){DialogUtils.success("提示","添加成功");var d=e.getNodeByTId(a.currentRightClickTreeNode.tId);
d.isParent="true";e.updateNode(d);var f=JSON.parse(i.msg);e.addNodes(d,-1,f);}else{DialogUtils.success("提示","修改成功");var g=e.getNodeByTId(a.currentRightClickTreeNode.tId);
var h=JSON.parse(i.msg);g.name=h.name;g.isSale=h.isSale;e.updateNode(g);}}else{DialogUtils.error("失败",i.msg);}},function(){ButtonUtils.enableBtn("saveAgentAreaBtn");
DialogUtils.error("错误","后台异常，请稍后重试");});});$(document).on("mouseleave","#orgMenuContainer",function(){$(this).hide();});$("input[name=belongAgent]").on("click",function(){var b=$(this);
if(b=="y"){$("#belongAgentDiv").show();}else{$("#belongAgentDiv").show();}});},_buildstoreIdlSearch:function(b){var a=this;var c=new StringBuffer();$("#storeIds option:selected").each(function(d){if($(this).val()){c.append($(this).val());
}if(d==b-1){return false;}else{c.append(",");}});$("input[name=storeIds]").val(c.toString());},_loadAgentArea:function(d,c,a){var b=this;FormUtils.loadData(ctx+"/crm/agent/agentEntity/findByAreaId.htm?id="+d+"&isAdd="+c,function(f){if(f.rows&&f.rows.length>0){if(c=="add"){$("#orgGroupModalLabel").text("添加代理一级部门");
$("#agentGroupModalContainer").modal("show");$("#orgGroupForm").find("[name=saleLine]").val(["one"]);if(b.currentRightClickTreeNode.isSale=="y"){$("#orgGroupForm").find("#createToDiv").show();
$("#orgGroupForm").find("#saleRangeDiv").show();$("#orgGroupForm").find("#saleLineDiv").show();$("#orgGroupForm").find("#salePercentDiv").show();$("#orgGroupForm").find(".needFinanceConfirmDiv").show();
$("#orgGroupForm").find("[name=saleLine]").val(["one"]);$("#orgGroupForm").find("[name=needFinanceConfirm]").val(["y"]);$("#orgGroupForm").find("[name=saleLine]").attr("required",true);
$("#orgGroupForm").find("[name=needFinanceConfirm]").attr("required",true);}else{$("#orgGroupForm").find("#createToDiv").hide();$("#orgGroupForm").find("#saleRangeDiv").hide();
$("#orgGroupForm").find("#saleLineDiv").hide();$("#orgGroupForm").find("#salePercentDiv").hide();$("#orgGroupForm").find(".needFinanceConfirmDiv").hide();
$("#orgGroupForm").find("[name=transTo]").val("");$("#orgGroupForm").find("[name=createTo]").val("");$("#orgGroupForm").find("[name=createToName]").val("");
$("#orgGroupForm").find("[name=saleLine]").val([""]);$("#orgGroupForm").find("[name=needFinanceConfirm]").val(["y"]);$("#orgGroupForm").find("[name=saleLine]").removeAttr("required");
$("#orgGroupForm").find("[name=needFinanceConfirm]").removeAttr("required");}}var g=new StringBuffer();g.append("<option value=''>请选择</option>");for(var e=0;
e<f.rows.length;e++){g.append("<option value='"+f.rows[e].id+"'>"+f.rows[e].name+"</option>");}$("#belongAgent").empty().append(g.toString());if(c=="edit"){$("#belongAgent").val(a.agentId);
}}else{DialogUtils.error("提示","该代理区没有代理商或代理商都分配了一级部门");}});},_initAgentEntityTree:function(){var a=this;var b={edit:{enable:true,showRemoveBtn:false,showRenameBtn:false,drag:{autoExpandTrigger:true,isCopy:false,isMove:ResUtils.canShow("group.button.drag")?true:false,prev:true,next:true,inner:true,borderMax:10,borderMin:-5,minMoveSize:5,autoOpenTime:500}},async:{enable:true,url:AgentEntity._CONS_.LIST_AGENT_TREE,contentType:"application/json",dataType:"json",type:"get",autoParam:["id"],dataFilter:function(f,c,g){if(g&&g.length){for(var e=0;
e<g.length;e++){var d=g[e];}}return g;},},data:{simpleData:{enable:true,idKey:"id",pIdKey:"parentId",agentId:"agentId",}},callback:{beforeDrag:function(d,c){if(!c[0].parentId){return false;
}else{return true;}},beforeDrop:function(f,e,g,d){var c=e[0];if(!g.parentId&&(d=="prev"||d=="next")){return false;}if(d==="prev"||d==="next"){if((c.parentId.isEmpty()&&g.parentId.isEmpty())||(c.parentId==g.parentId)){a._moveHandler(c.id,g.id,null,d);
}else{if(c.parentId!=null&&g.parentId!=null&&c.parentId!=g.parentId){a._moveHandler(c.id,g.id,g.parentId,d);}else{if(c.parentId!=null&&g.parentId==null){a._moveHandler(c.id,g.id,g.id,g.id,d);
}}}return true;}else{if(d==="inner"){if(c==null||g==null){return false;}else{a._moveHandler(c.id,null,g.id,null);return true;}}}return false;},onClick:function(c,e,d){$(".list_wrapper").show();
$(".form_wrapper").stop().animate({"left":$(".form_wrapper").outerWidth()+15+"px"},"fast");a.currentClickTreeNode=d;a._selectOrg(d);a.initCrumbs(d,"agentEntityTree");
var f={};if(d.agentId){f+="&agentId="+a.currentClickTreeNode.agentId;}else{if(d.parentId){f=$(".agentEntitySearch").closest("form").serialize();f+="&areaId="+a.currentClickTreeNode.id;
}}a.reloadJqgrid(f);},onRightClick:function(c,e,d){a.currentRightClickTreeNode=d;if(d.agentId){$("#agentEntityAddBtn").hide();$("#agentEntityDelBtn").hide();
}else{$("#agentEntityAddBtn").show();if(d.isParent){$("#agentEntityDelBtn").hide();}else{$("#agentEntityDelBtn").show();}}$("#orgMenuContainer").css({top:(c.pageY-25)+"px",left:(c.pageX-10)+"px",display:"block"});
},onAsyncSuccess:function(d,k,m,f){var g=$.fn.zTree.getZTreeObj("agentEntityTree");if(m){var n=m.children;for(var j=0;j<n.length;j++){if(n[j].isParent==true){n[j].icon=ctx+"/js/zTree_v3/css/zTreeStyle/img/jt-diy/jt-16.png";
}else{n[j].icon=ctx+"/js/zTree_v3/css/zTreeStyle/img/jt-diy/jt-30.png";}if(childNodes[j].isSale=="y"){childNodes[j].font={"color":"red"};}g.updateNode(n[j]);
}}else{var c=g.getNodes();a.rootAgent=c[0].name;for(var j=0;j<c.length;j++){c[j].icon=ctx+"/js/plugins/zTree_v3/css/zTreeStyle/img/jt-diy/jt-orgRoot.png";
if(c[j].isSale=="y"){c[j].font={"color":"red"};}g.updateNode(c[j]);}}if(m==null){var g=$.fn.zTree.getZTreeObj("agentEntityTree");var l=g.getNodes();if(l&&l.length){var e=l[0];
g.expandNode(e,true,false,true);g.selectNode(e);a.currentClickTreeNode=e;a._selectOrg(e);var h={hadInit:true,hadInitClik:false,treeNodeName:""};a.initCrumbs(e,"agentEntityTree");
}}}},view:{selectedMulti:false,fontCss:function(d,c){return(!!c.highlight)?{color:"#A60000","font-weight":"bold"}:{color:"#333","font-weight":"normal"};
}}};$.fn.zTree.init($("#agentEntityTree"),b);},_selectOrg:function(d){var b=this;var g=[];var a=d;while(a){g.push(a);a=a.getParentNode();}var f=new StringBuffer();
for(var c=g.length-1;c>=0;c--){if(c==0){f.append('<li class="active">'+g[c].name+"</li>");}else{f.append("<li>"+g[c].name+"</li>");}}$(".breadcrumb").empty().append(f.toString());
var e={treeNodeId:d.id,treeNodeType:d.type};},initCrumbs:function(c,b,a){this.treeNodeName=b;var e=new StringBuffer();if(a){e.append("<span id='attr-value' id-value='"+a.id+"' class='jt-blue'>"+$(".tabli.active").attr(a.attr)+"</span>");
e.append("&gt;");if(!this.hadInitClik){$("body").on("click",".tabli",function(){var f=$(this).attr(a.attr);var g=$(this).attr("id");$("#attr-value").empty().append(f).attr("id-value",g);
});this.hadInitClik=true;}}e.append(d(c));$("#jt-crumbs").empty().append(e.toString());function d(f){if(f.level==0){return"<span class='jt-blue' id-value='"+f.id+"'>"+f.name+"</span>";
}else{return d(f.getParentNode())+"&gt;"+"<span class='jt-blue' id-value='"+f.id+"'>"+f.name+"</span>";}}},_searchNode:function(d){var a=$.fn.zTree.getZTreeObj("agentEntityTree");
var c=$.trim($("#agentEntityTreeSearch").val());var b="name";if(this.lastValue===c){return;}this.lastValue=c;this._updateNodes(true,this.nodeList);if(c!=""){this.nodeList=a.getNodesByParamFuzzy(b,c);
this._updateNodes(true,this.nodeList);}else{this.nodeList=[];}},_updateNodes:function(b,d){var c=$.fn.zTree.getZTreeObj("agentEntityTree");if(d){for(var e=0,a=d.length;
e<a;e++){d[e].highlight=b;if(b){c.expandNode(d[e].getParentNode(),true,false,false);}c.updateNode(d[e]);}}},_callNumber:function(){var a=$.fn.zTree.getZTreeObj("agentEntityTree");
if(this.nodeList.length){a.selectNode(this.nodeList[0],false);this.clickCount=1;document.getElementById("number").innerHTML="["+this.clickCount+"/"+this.nodeList.length+"]";
}else{if(this.nodeList.length==0){document.getElementById("number").innerHTML="[0/0]";a.cancelSelectedNode();}}if($.trim($("#agentEntityTreeSearch").val())==""){document.getElementById("number").innerHTML="";
a.cancelSelectedNode();}},_clickUp:function(){var a=$.fn.zTree.getZTreeObj("agentEntityTree");if(this.nodeList.length==0){DialogUtils.error(msgCode.FAIL_MSG,"没有搜索结果！");
return;}else{if(this.clickCount==1){DialogUtils.error(msgCode.FAIL_MSG,"您已位于第一条记录上！");return;}else{this.clickCount--;a.selectNode(this.nodeList[this.clickCount-1],false);
}}document.getElementById("number").innerHTML="["+this.clickCount+"/"+this.nodeList.length+"]";},_clickDown:function clickDown(){var a=$.fn.zTree.getZTreeObj("agentEntityTree");
if(this.nodeList.length==0){DialogUtils.error(msgCode.FAIL_MSG,"没有搜索结果！");return;}else{if(this.nodeList.length==this.clickCount){DialogUtils.error(msgCode.FAIL_MSG,"您已位于最后一条记录上！");
return;}else{a.selectNode(this.nodeList[this.clickCount],false);this.clickCount++;}}document.getElementById("number").innerHTML="["+this.clickCount+"/"+this.nodeList.length+"]";
},_exportExcel:function(c){var a=this;var b=AgentEntity._CONS_.EXPORT_URL;FormUtils.submit(b,c,function(d){if(d.success){DialogUtils.success(msgCode.INFO,"导出中...");
ButtonUtils.enableBtn("exportExcel");}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);}});},_bindFormValidation:function(){var a={rules:{"name":{required:true,},"levelId":{required:true,},"contactName":{required:true,}},messages:{}};
FormUtils.bindFormValidation(AgentEntity._CONS_.EDIT_FORM_ID,a);jQuery.validator.addMethod("isNumber",function(d,c){return this.optional(c)||/^[-\+]?\d+$/.test(d)||/^[-\+]?\d+(\.\d{1}|\.\d{2})?$/.test(d);
},"只能输入两位小数");var b={rules:{name:{required:true},agentId:{required:true},isSale:{required:true},workHours:{isNumber:true,min:0.01},workDays:{isNumber:true,min:0.01},smsLimit:{required:false,digits:true,min:0,},percentLimit:{digits:true,number:true,min:10,max:100}}};
FormUtils.bindFormValidation("orgGroupForm",b);},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(AgentEntity._CONS_.GRID,a);},_initJqgrid:function(c){var a=this;
if(c==null||typeof c==undefined){c={};}var b=false;if(!ResUtils.canShow("agentEntity.button.edit")&&!ResUtils.canShow("agentEntity.button.forbid")){b=true;
}$(AgentEntity._CONS_.GRID).JTJqgrid({url:AgentEntity._CONS_.LIST_DATA_URL,pager:AgentEntity._CONS_.PAGER,postData:c,multiselect:false,colNames:["名称","编号","级别","代理商区域","业务联系人","联系人手机","工号数","状态","创建时间","更新时间","操作"],colModel:[{name:"name",index:"name_",align:"center",width:60},{name:"code",index:"code_",align:"center",width:50},{name:"agentLevel",index:"level_id_",align:"center",width:60,formatter:function(d,e,f){return f.levelName;
}},{name:"agentArea",iAgentRecordDetailReportndex:"area_id_",align:"center",width:60,formatter:function(d,e,f){if(f.areaName){return f.areaName;}else{return a.rootAgent;
}}},{name:"contactName",index:"contact_name_",align:"center",width:60,formatter:function(d,e,f){if(f.empAid&&f.empName){return f.empAid+":"+f.empName;}else{return f.contactName;
}}},{name:"contactMobile",index:"contact_mobile_",align:"center",width:80},{name:"empSum",index:"empSum",align:"center",width:40},{name:"status",index:"status_",align:"center",width:40,formatter:function(e,f,g){var d="<b style='color:red'>激活</b>";
if(g.status=="inactive"){var d="禁用";}return d;}},{name:"createTime",index:"create_time_",align:"center",width:100},{name:"updateTime",index:"update_time_",align:"center",width:100},{name:"manage",width:120,hidden:b,align:"center",formatter:function(d,e,f){var g=new StringBuffer();
if(ResUtils.canShow("agentEntity.button.edit")){g.append("<button idVal='"+f.id+"' agentName='"+f.name+"' style='min-width:auto;' type='button' class='btn btn-sm jt-btn-normal agentEntityEdit'>编辑</button>&nbsp;");
}if(ResUtils.canShow("agentEntity.button.bill")){g.append("<button idVal='"+f.id+"' agentName='"+f.name+"' style='min-width:auto;' type='button' class='btn btn-sm jt-btn-normal agentEntityBill'>对账</button>&nbsp;");
}if(ResUtils.canShow("agentEntity.button.forbid")){if(f.status=="inactive"){g.append("<button idVal='"+f.id+"' style='min-width:auto;' type='button' class='btn btn-sm jt-btn-normal agentActive'>激活</button>&nbsp;");
}else{if(f.status=="actived"){g.append("<button idVal='"+f.id+"' style='min-width:auto;' type='button' class='btn btn-sm jt-btn-normal agentForbid'>禁用</button>&nbsp;");
}}}if(ResUtils.canShow("agentEntity.button.deleteAgent")){g.append("<button idVal='"+f.id+"' style='min-width:auto;' type='button' class='btn btn-sm jt-btn-normal jt-bn-red agentEntityDel'>删除</button>&nbsp;");
}return g.toString();}}],loadComplete:function(){$(window).resize();a.agentDatas=$("#agentEntityGrid").jqGrid("getRowData");},gridComplete:function(){$(window).resize();
},});}};