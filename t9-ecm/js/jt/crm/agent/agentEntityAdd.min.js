$(function(){var a=new AgentEntityAdd();a.init();});function AgentEntityAdd(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}AgentEntityAdd._CONS_={SAVE_ADD_URL:ctx+"/crm/agent/agentEntity/saveAdd.htm",LEVEL_URL:ctx+"/crm/agent/agentLevel/listData.htm",EDIT_FORM_ID:"agentEntityForm",};
AgentEntityAdd.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindFormValidation();this._bindEventHander();this._loadLevel();this._loadArea();
}},_loadArea:function(){var a=this;var b=ctx+"/gl/ou/group/findAreaGroup.htm";FormUtils.loadData(b,function(d){if(d&&d.length>0){var e=new StringBuffer();
e.append("<option value=''>请选择</option>");for(var c=0;c<d.length;c++){e.append("<option value='"+d[c].id+"'>"+d[c].name+"</option>");}$(".areaId").empty().append(e.toString());
}});},_loadLevel:function(){var a=this;var b=AgentEntityAdd._CONS_.LEVEL_URL;FormUtils.loadData(b,function(e){var c=e.rows;if(c){var f=new StringBuffer();
f.append("<option value=''>请选择</option>");for(var d=0;d<c.length;d++){f.append("<option value='"+c[d].id+"'>"+c[d].name+"</option>");}$(".levelId").empty().append(f.toString());
}});},_save:function(){var b=this;var a=AgentEntityAdd._CONS_.SAVE_ADD_URL;$("#agentEntityForm").find("input[name=empCount]").val(0);var c=$("#agentEntityForm").serialize();
if($("#agentEntityForm").valid()){ButtonUtils.disableBtn("saveBtn");FormUtils.submit(a,c,function(d){ButtonUtils.enableBtn("saveBtn");if(d.success){var e=$("input[name=name]").val();
e="代理商["+e+"]";JTTabUtils.addOrRefreshTab(ctx+"/crm/agent/agentEntity/toEdit.htm?agentId="+d.msg,e);JTTabUtils.closeTab(ctx+"/crm/agent/agentEntity/add.htm");
DialogUtils.success("提示","操作成功");}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);}},function(){ButtonUtils.enableBtn("saveBtn");DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}},_changeEmployee:function(d,a){var b=1;var e={isShowAllGroup:b,grantType:"/cs/",isMultiple:0,mode:0,isSale:1,isOnlySelfGroup:1,type:"positionContext",callBack:function(g){if(g!=null){if(g.length>0){$("input[name=contactName]").val(g[0].id);
$("input[name=employeeShow]").val(g[0].aid+"："+g[0].name);if(!a){var f=[];f.push({employeeId:g[0].id,csEntityIds:d});FormUtils.submit(ctx+"/crm/cs/csEntity/saveAssign.htm",{resultJson:JSON.stringify(f),csType:"csEntity"},function(h){if(h.success){DialogUtils.success("提示",h.msg);
}else{DialogUtils.error("失败",h.msg);}});}}}}};var c=new EmployeesSelect();c.init(e);},_bindEventHander:function(){var a=this;$(document).on("click",".changRelEmployee",function(){a._changeEmployee($("#csEntityForm").find("[name=id]").val());
});$(".closeBtn").on("click",function(){JTTabUtils.closeTab($(window.top.document).find(".page-tabs-content").find(".active").attr("data-id"));});$(document).on("click",".prevBtn",function(){a.clear(false);
});$(document).on("click",".saveBtn",function(){a._save();});},_bindFormValidation:function(){var a={rules:{"name":{required:true,},"levelId":{required:true,},"contactName":{required:true,},"areaId":{required:true,},"groupName":{required:true,},"bank":{required:true,},"bankPerson":{required:true,},"bankAccount":{required:true,}},messages:{"groupName":{required:"请选择区域",}}};
FormUtils.bindFormValidation(AgentEntityAdd._CONS_.EDIT_FORM_ID,a);},};