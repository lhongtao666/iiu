$(function(){var a=new AgentEntityEdit();a.init();});function AgentEntityEdit(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.agentSku=new AgentSku();
}AgentEntityEdit._CONS_={LOG_DATA_URL:ctx+"/crm/agent/agentLog/listData.htm",LEVEL_URL:ctx+"/crm/agent/agentLevel/listData.htm",AGENT_ENTITY_DATA:ctx+"/crm/agent/agentEntity/edit.htm",SAVE_EDIT_URL:ctx+"/crm/agent/agentEntity/saveEdit.htm",EDIT_FORM_ID:"agentEntityEditForm",GRID:"#agentEntityLogGrid",PAGER:"#agentEntityLogPager"};
AgentEntityEdit.prototype={init:function(a){if(!this.hadInit){if(agentId){this.hadInit=true;this._loadArea();this._bindFormValidation();this._bindEventHander();
this._loadLevel();this._initJqgrid();this._loadData();}else{DialogUtils.error(msgCode.ERROR,"当前员工没有归属代理商");$(".wrapper").hide();}if(agentWeihu=="agentWeihu"){$("#agentWeihu").hide();
$("#infoPrevBtn").hide();$("#agentEntityEditForm").find("input[name=name]").attr("readonly",true);$("#agentEntityEditForm").find("select[name=levelId]").attr("disabled",true);
$("#agentEntityEditForm").find("input[name=bank]").attr("readonly",true);$("#agentEntityEditForm").find("input[name=bankPerson]").attr("readonly",true);
$("#agentEntityEditForm").find("input[name=bankAccount]").attr("readonly",true);$("#agentEntityEditForm").find("select[name=areaId]").attr("disabled",true);
}else{$("#agentWeihu").show();}}},_loadArea:function(){var a=this;var b=ctx+"/gl/ou/group/findAreaGroup.htm";FormUtils.loadData(b,function(d){if(d&&d.length>0){var e=new StringBuffer();
e.append("<option value=''>请选择</option>");for(var c=0;c<d.length;c++){e.append("<option value='"+d[c].id+"'>"+d[c].name+"</option>");}$(".areaId").empty().append(e.toString());
}});},_loadData:function(){var a=this;var b=AgentEntityEdit._CONS_.AGENT_ENTITY_DATA+"?id="+agentId;FormUtils.loadData(b,function(c){$("#agentEntityEditForm").find("input[name=name]").val(c.name);
if(c.empAid&&c.empName){$("#agentEntityEditForm").find("input[name=employeeShow]").val(c.empAid+":"+c.empName);}else{$("#agentEntityEditForm").find("input[name=employeeShow]").val(c.contactName);
}$("#agentEntityEditForm").find("input[name=contactMobile]").val(c.contactMobile);$("#agentEntityEditForm").find("input[name=contactAddr]").val(c.contactAddr);
$("#agentEntityEditForm").find("input[name=bank]").val(c.bank);$("#agentEntityEditForm").find("input[name=bankPerson]").val(c.bankPerson);$("#agentEntityEditForm").find("input[name=bankAccount]").val(c.bankAccount);
$("#agentEntityEditForm").find("input[name=empCount]").val(c.empCount);$("#agentEntityEditForm").find("input[name=welcome]").val(c.welcome);$("#agentEntityEditForm").find("input[name=id]").val(c.id);
$("#agentEntityEditForm").find("input[name=code]").val(c.code);$("#agentEntityEditForm").find("input[name=createTime]").val(c.createTime);$("#agentEntityEditForm").find("select[name=status]").val(c.status);
$("#agentEntityEditForm").find("select[name=levelId]").val(c.levelId);$("#agentEntityEditForm").find("input[name=completeDays]").val(c.comDays);$("#agentEntityEditForm").find("select[name=areaId]").val(c.areaId);
$("#agentEntityEditForm").find("input[name=rootGroupId]").val(c.rootGroupId);});},_loadLevel:function(){var a=this;var b=AgentEntityEdit._CONS_.LEVEL_URL;
FormUtils.loadData(b,function(e){var c=e.rows;if(c){var f=new StringBuffer();for(var d=0;d<c.length;d++){f.append("<option value='"+c[d].id+"' comDays='"+c[d].completeDays+"'>"+c[d].name+"</option>");
}$(".levelId").empty().append(f.toString());}});},_save:function(){var b=this;var a=AgentEntityEdit._CONS_.SAVE_EDIT_URL;$("#levelId").removeAttr("disabled");
$("#agentStatus").removeAttr("disabled");$("#areaId").removeAttr("disabled");if($("#agentEntityEditForm").valid()){ButtonUtils.disableBtn("saveBtn");FormUtils.submitByFormId(a,AgentEntityEdit._CONS_.EDIT_FORM_ID,function(c){ButtonUtils.enableBtn("saveBtn");
if(c.success){DialogUtils.success("提示","编辑成功");b.reloadJqgrid();}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},function(){ButtonUtils.enableBtn("saveBtn");
DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}},_changeEmployee:function(d,a){var b=1;var e={isShowAllGroup:b,grantType:"/cs/",isMultiple:0,mode:0,isSale:1,isOnlySelfGroup:1,type:"positionContext",callBack:function(g){if(g!=null){if(g.length>0){$("input[name=contactName]").val(g[0].id);
$("input[name=employeeShow]").val(g[0].aid+"："+g[0].name);if(!a){var f=[];f.push({employeeId:g[0].id,csEntityIds:d});FormUtils.submit(ctx+"/crm/cs/csEntity/saveAssign.htm",{resultJson:JSON.stringify(f),csType:"csEntity"},function(h){if(h.success){DialogUtils.success("提示",h.msg);
}else{DialogUtils.error("失败",h.msg);}});}}}}};var c=new EmployeesSelect();c.init(e);},_bindEventHander:function(){var a=this;$(document).on("click",".changRelEmployee",function(){a._changeEmployee($("#csEntityForm").find("[name=id]").val());
});$("#areaName").on("click",function(){GroupUtils.selectGroupTreeBox({selectedGroupId:$('input[name="areaId"]').val(),container:"areaName",hideSale:true,positionType:"isAgent",fn:function(b){$('input[name="areaId"]').val(b);
}});});$(document).on("click",".infoPrevBtn",function(){JTTabUtils.closeTab(ctx+"/crm/agent/agentEntity/toEdit.htm?agentId="+agentId);});$(document).on("click",".saveEditBtn",function(){a._save();
});$(document).on("change","#levelId",function(){var b=$("#levelId option:selected").attr("comDays");$("#agentEntityEditForm").find("input[name=completeDays]").val(b);
});$("#"+AgentEntityEdit._CONS_.EDIT_FORM_ID).on("change","input",function(){if(a.isEdit){a.isFormDataChange=true;}});$("#"+AgentEntityEdit._CONS_.EDIT_FORM_ID).on("change","select",function(){if(a.isEdit){a.isFormDataChange=true;
}});$("#"+AgentEntityEdit._CONS_.EDIT_FORM_ID).on("change","textarea",function(){if(a.isEdit){a.isFormDataChange=true;}});$(".tabs-container").on("click",".tabli",function(){var b=$(this).attr("id");
switch(b){case"skuManagerTabLi":break;case"groupEmpTabLi":break;}});},reloadJqgrid:function(a){if(a==null||typeof a==undefined){a={};}a.agentId=agentId;
JTJqgridUtils.reloadJqgrid(AgentEntityEdit._CONS_.GRID,a);},_initJqgrid:function(b){if(b==null||typeof b==undefined){b={};}var a=false;if(!ResUtils.canShow("agentEntity.button.edit")&&!ResUtils.canShow("agentEntity.button.forbid")){a=true;
}b.agentId=agentId;$(AgentEntityEdit._CONS_.GRID).JTJqgrid({url:AgentEntityEdit._CONS_.LOG_DATA_URL,pager:AgentEntityEdit._CONS_.PAGER,postData:b,multiselect:false,colNames:["时间","操作人","操作内容"],colModel:[{name:"createTime",index:"create_time_",align:"center",width:100},{name:"operateEmp",index:"emp_id_",width:140,formatter:function(c,d,e){return"<div class='col-sm-12' style='text-align:center;'>"+e.aid+":"+e.name+"</div>";
}},{name:"content",index:"content_",align:"center",width:260},],loadComplete:function(){$(window).resize();},gridComplete:function(){},});},_bindFormValidation:function(){var a={rules:{"name":{required:true,},"levelId":{required:true,},"contactName":{required:true,},"bank":{required:true,},"bankPerson":{required:true,},"bankAccount":{required:true,}},messages:{}};
FormUtils.bindFormValidation(AgentEntityEdit._CONS_.EDIT_FORM_ID,a);},};