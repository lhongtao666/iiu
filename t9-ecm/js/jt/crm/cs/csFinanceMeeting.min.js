function CsFinanceMeeting(){this.hadInit=false;this.params=null;this.csType="";this.permissionType="";}CsFinanceMeeting._CONS_={SAVE_ADD_URL:ctx+"/crm/finance/financeMeeting/saveAdd.htm"};
CsFinanceMeeting.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._bindFormValidation();this.params=a;this.csType=a.csType;
this.permissionType=a.permissionType;CateUtils.getOptions({typeKey:"system",pKey:"financeMeetingArea",container:"meetingArea"});}this._initTable(a);},_bindEventHander:function(){var a=this;
$(document).on("click",".deleteCsMeeting",function(){var c={csId:$(this).attr("csIdVal"),ids:$(this).attr("idVal")};DialogUtils.confirm(function(){FormUtils.submit(ctx+"/crm/finance/financeMeeting/delete.htm",c,function(d){if(d.success){DialogUtils.success(msgCode.SUCCESS,d.msg);
a._initTable(a.params);}});});});$(document).on("click","#addMeetingBtn",function(){ButtonUtils.disableBtn("addMeetingBtn");layer.close(a.layerIndex);a.layerIndex=layer.open({type:1,title:"面谈记录",shade:false,btn:["保存","关闭"],area:["550px","350px"],offset:"10%",content:$(".csFinanceMeetingAdd"),scrollbar:true,success:function(c,d){ButtonUtils.enableBtn("addMeetingBtn");
a._initForm();},yes:function(d,c){if(!$("#csFinanceMeetingAdd").valid()){return;}a._save();}});});var b=$("#csFinanceMeetingAdd");b.on("click",".selectEmployeeId",function(){var c=0;
if(ResUtils.canShow("employeeSelector.button.cs")){c:1;}var e={isShowAllGroup:c,grantType:"/cs/",isMultiple:1,isOnlySelfGroup:1,callBack:function(f){if(f!=null||f.length>0){b.find("input[name=employeeShow]").val(f[0].aid+"："+f[0].name);
b.find("input[name=employeeId]").val(f[0].id);b.find("input[name=employeeAid]").val(f[0].aid);b.find("input[name=employeeName]").val(f[0].name);}}};var d=new EmployeesSelect();
d.init(e);});b.on("click",".selectPartakeId",function(){var c=0;if(ResUtils.canShow("employeeSelector.button.cs")){c:1;}var e={isShowAllGroup:c,grantType:"/cs/",isMultiple:1,isOnlySelfGroup:1,callBack:function(f){if(f!=null||f.length>0){b.find("input[name=partakeShow]").val(f[0].aid+"："+f[0].name);
b.find("input[name=partakeId]").val(f[0].id);b.find("input[name=partakeAid]").val(f[0].aid);b.find("input[name=partakeName]").val(f[0].name);}}};var d=new EmployeesSelect();
d.init(e);});},_initForm:function(){FormUtils.clear("csFinanceMeetingAdd");var a=$("#csFinanceMeetingAdd");a.find("input[name=employeeShow]").val(currentUserAid+"："+currentUserName);
a.find("input[name=employeeId]").val(currentUserId);a.find("input[name=employeeAid]").val(currentUserAid);a.find("input[name=employeeName]").val(currentUserName);
a.find("input[name=csId]").val(this.params.csId);},_initTable:function(e){var a=this;var d="";if(a.csType){if("self"==a.csType||(a.permissionType&&"self"==a.permissionType)){if(ResUtils.canShow("csMeeting.button.deleteMyself")){d="<th width='7%'>操作</th>";
}}else{if("mysub"==a.csType||(a.permissionType&&"mysub"==a.permissionType)){if(ResUtils.canShow("csMeeting.button.deleteSub")){d="<th width='7%'>操作</th>";
}}}}$("#csMeetingDiv").empty().append("<table class='table table-bordered table-stripped' id='csMeetingTable'>"+"<thead><tr>"+"<th width='4%'></th><th width='8%'>时间</th><th width='8%'>面谈人</th>"+"<th width='8%'>参与人</th>"+"<th width='8%'>地点</th>"+"<th width='9%'>内容</th>"+"<th width='9%'>创建时间</th>"+d+"</tr>"+"</thead></table>");
var b=ctx+"/crm/finance/financeMeeting/findByCsId.htm?csId="+e.csId;var c=[{data:"lineNum"},{data:"meetingTime",render:function(i,h,g){var f="<span title='"+i+"'>"+DateUtils.miniTime(i)+"</span>";
return f;}},{data:"employeeName",render:function(h,g,f){return f.employeeAid+":"+h;}},{data:"partakeName",render:function(h,g,f){if(f.partakeId==null||f.partakeId==""){return"无";
}return f.partakeAid+":"+h;}},{data:"meetingArea"},{data:"meetingContent"},{data:"createTime",render:function(i,h,g){var f="<span title='"+i+"'>"+DateUtils.miniTime(i)+"</span>";
return f;}},];if(a.csType){if("self"==a.csType||(a.permissionType&&"self"==a.permissionType)){if(ResUtils.canShow("csMeeting.button.deleteMyself")){c.push({data:"id",width:"7%",render:function(h,g,f){return"<i class='fa fa-remove deleteCsMeeting' title='删除' csIdVal='"+f.csId+"' idVal='"+h+"'style='color: red; cursor: pointer;'></i>";
}});}}else{if("mysub"==a.csType||(a.permissionType&&"mysub"==a.permissionType)){if(ResUtils.canShow("csMeeting.button.deleteSub")){c.push({data:"id",width:"7%",render:function(h,g,f){return"<i class='fa fa-remove deleteCsMeeting' title='删除' csIdVal='"+f.csId+"' idVal='"+h+"'style='color: red; cursor: pointer;'></i>";
}});}}}}$("#csMeetingTable").DataTable({ajax:{url:b},columns:c,rowId:"id",lengthMenu:[[20],],searching:false,ing:true,pagingType:"simple",lengthChange:false,autoWidth:false,ordering:false,});
},_save:function(){var b=this;var a=CsFinanceMeeting._CONS_.SAVE_ADD_URL;FormUtils.submitByFormId(a,"csFinanceMeetingAdd",function(c){if(c.success){DialogUtils.success(msgCode.INFO,c.msg);
}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}layer.close(b.layerIndex);b._initTable(b.params);},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});},_bindFormValidation:function(){var a={rules:{"meetingTime":{required:true},"meetingContent":{required:true,},}};FormUtils.bindFormValidation("csFinanceMeetingAdd",a);
},};