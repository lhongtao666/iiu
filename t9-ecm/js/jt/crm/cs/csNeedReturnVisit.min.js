$(function(){var a=new CsNeedReturnVisit();a.init();});function CsNeedReturnVisit(){this.hadInit=false;this.isEdit=false;this.noTree=false;this.isFormDataChange=false;
this.seniorSearch=new SeniorSearch();}CsNeedReturnVisit._CONS_={EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",LIST_DATA_URL:ctx+"/crm/cs/csEntity/listData.htm",FINISH_VISIT:ctx+"/crm/cs/csEntity/finishVisit.htm",AGAIN_VISIT:ctx+"/crm/cs/csEntity/againVisit.htm",GRID:"#csNeedReturnGrid",PAGER:"#csNeedReturnPager",HASGRID:"#csHasReturnGrid",HASPAGER:"#csHasReturnPager",CURRENORGINID:"",CURRENTYPE:"",};
CsNeedReturnVisit.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindFormValidation();this._bindEventHander();this._hideNotGrantBtn();
this._getEmployeeOption("");this._buildEmployeeOption("");this.initOrganizationTree();this.seniorSearch.init();}},_hideNotGrantBtn:function(){if(!ResUtils.canShow("csEntity.button.finishVisit")){$("#finishVisit").hide();
}if(!ResUtils.canShow("csEntity.button.againVisit")){$("#againVisit").hide();}},_initTree:function(){var a=this;var b=new StringBuffer();FormUtils.loadData(ctx+"/gl/cate/cateOpt/listData4CateId.htm?cateId=1110851285290176512",function(c){var d=c.cateOptPos;
if(d&&d.length){var g="";b.append("<li class='wxGroupLi' idVal='' name=''>全部</li>");for(var e=0;e<d.length;e++){var f="";b.append("<li class='wxGroupLi' idVal='").append(d[e].id).append("' name='"+d[e].name+"'>").append(d[e].name).append("</li>");
}}else{b.append("<li class='wxGroupLi' idVal='' name=''>全部</li>");}$(".wxGroupUl").empty().append(b.toString());$(".wxGroupUl").find("li:eq(0)").addClass("active");
$(".wxGroupUl").find("li:eq(0)").trigger("click");a._initJqgrid();});},initOrganizationTree:function(c){var a=this;var b={async:{enable:true,url:ctx+"/gl/ou/group/findVisiableEmployeeTreeForWx.htm",contentType:"application/json",dataType:"json",type:"get",autoParam:["id"],dataFilter:function(e,d,f){if(f.length==0){a.noTree=true;
a._initJqgrid();}else{return f;}},},data:{simpleData:{enable:true,idKey:"id",pIdKey:"parentId"}},callback:{onClick:function(d,f,e){a._removeOtherWx();if(!a.hadInitJqgrid){a.hadInitJqgrid=true;
var g={startDate:$(".startDate").val()};if(e.type=="group"){g.belongOgn=e.id;a.partyId=e.id;a.partyType="group";CsNeedReturnVisit._CONS_.CURRENORGINID=e.id;
CsNeedReturnVisit._CONS_.CURRENTYPE="group";}else{g.employeeId=e.id;a.partyId=e.id;a.partyType="employee";CsNeedReturnVisit._CONS_.CURRENORGINID=e.id;CsNeedReturnVisit._CONS_.CURRENTYPE="employee";
}a._initJqgrid();}else{if(e.type=="group"){a.partyId=e.id;a.partyType="group";CsNeedReturnVisit._CONS_.CURRENORGINID=e.id;CsNeedReturnVisit._CONS_.CURRENTYPE="group";
}else{a.partyId=e.id;a.partyType="employee";CsNeedReturnVisit._CONS_.CURRENORGINID=e.id;CsNeedReturnVisit._CONS_.CURRENTYPE="employee";}a.reloadJqgrid();
a.reloadHasJqgrid();}a.seniorSearch.initCrumbs(e,"organizationTree");},onAsyncSuccess:function(g,i,h,j){var f=$.fn.zTree.getZTreeObj("organizationTree");
if(h==null){var f=$.fn.zTree.getZTreeObj("organizationTree");var d=f.getNodes();if(d&&d.length){var e=d[0];f.expandNode(e,true,false,false);f.selectNode(e);
f.setting.callback.onClick(null,e.id,e);}}}},view:{selectedMulti:false,fontCss:function(e,d){return(!!d.highlight)?{color:"#A60000","font-weight":"bold"}:{color:"#333","font-weight":"normal"};
}}};a.reloadJqgrid();a.reloadHasJqgrid();$.fn.zTree.init($("#organizationTree"),b);},_buildEmployeeOption:function(b){var a=CsNeedReturnVisit._CONS_.EMPLOYEE_LIST_URL+"?groupId="+b+"&type=dept_manager";
FormUtils.loadData(a,function(d){$("#belongEmployeeSearch").empty();if(d&&d.length>0){var e=new StringBuffer();e.append("<option value=''>请选择</option>");
for(var c=0;c<d.length;c++){e.append("<option value='"+d[c].id+"'>"+d[c].aid+":"+d[c].name+"</option>");}$("#belongEmployeeSearch").append(e.toString()).select2();
}},null,true);},_setFinishVisit:function(c){var a=this;var b=CsNeedReturnVisit._CONS_.FINISH_VISIT;DialogUtils.confirmWithOptions({title:"提示",text:"确定选择的客户结束回访？",confirmButtonText:"确认",yesFunc:function(){FormUtils.submit(b,{ids:c},function(d){if(d){DialogUtils.success(msgCode.INFO,"操作成功");
a.reloadJqgrid();}else{DialogUtils.error("提示","后台异常，请稍后再试");}},function(){DialogUtils.error("提示","后台异常");});}});},_setAgainVisit:function(c){var a=this;
var b=CsNeedReturnVisit._CONS_.AGAIN_VISIT;DialogUtils.confirmWithOptions({title:"提示",text:"确定选择的客户设置为待回访状态？",confirmButtonText:"确认",yesFunc:function(){FormUtils.submit(b,{ids:c},function(d){if(d){DialogUtils.success(msgCode.INFO,"操作成功");
a.reloadHasJqgrid();}else{DialogUtils.error("提示","后台异常，请稍后再试");}},function(){DialogUtils.error("提示","后台异常");});}});},_bindEventHander:function(){var a=this;
$(document).on("click",".visitDay",function(){$(this).addClass("activeDay");$(this).siblings().removeClass("activeDay");$(this).attr("disabled","disabled");
$(this).siblings().removeAttr("disabled");a.reloadHasJqgrid();});$(document).on("click","#finishVisit",function(){var b=$(CsNeedReturnVisit._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b&&b.length>0){a._setFinishVisit(b);}else{DialogUtils.error("提示","请选择需要结束回访客户");}});$(document).on("click","#againVisit",function(){var b=$(CsNeedReturnVisit._CONS_.HASGRID).jqGrid("getGridParam","selarrrow");
if(b&&b.length>0){a._setAgainVisit(b);}else{DialogUtils.error("提示","请选择需要重新回访客户");}});$(document).on("click",".tabli",function(){var b=$(this).attr("id");
switch(b){case"csWaitVisitTabLi":$("#waitVisitDiv").show();$("#hasVisitDiv").hide();a.reloadJqgrid();break;case"csHasVisitTabLi":$("#hasVisitDiv").show();
$("#waitVisitDiv").hide();if(!a.hadInitHasVist){a.hadInitHasVist=true;a._initHasVisitJqgrid();}else{a.reloadHasJqgrid();}break;}});$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
a._buildEmployeeOption(c);}};GroupUtils.selectGroupTreeBox(b);});$("body").on("click",".csEntityEditTmp",function(){var b=$(this).attr("attr-id");a._edit(b);
});$("#organizationTreeSearch").on("keyup",function(b){if(b.keyCode==13){a._searchNode(b);a._callNumber();}});},_edit:function(d,a){var c="客户["+$(CsNeedReturnVisit._CONS_.GRID).jqGrid("getRowData",d).name+"]";
var b="isReturnVisit";if($(".tabli.active").attr("id")=="csHasVisitTabLi"){b="hasVisit";}JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/toEdit.htm?type="+b+"&csId="+d,c);
},_searchNode:function(d){var a=$.fn.zTree.getZTreeObj("organizationTree");var c=$.trim($("#organizationTreeSearch").val());var b="name";if(this.lastValue===c){return;
}this.lastValue=c;this._updateNodes(false,this.nodeList);if(c!=""){this.nodeList=a.getNodesByParamFuzzy(b,c);this._updateNodes(true,this.nodeList);}else{this.nodeList=[];
}},_callNumber:function(){var a=$.fn.zTree.getZTreeObj("organizationTree");if(this.nodeList.length){a.selectNode(this.nodeList[0],false);this.clickCount=1;
document.getElementById("number").innerHTML="["+this.clickCount+"/"+this.nodeList.length+"]";}else{if(this.nodeList.length==0){document.getElementById("number").innerHTML="[0/0]";
a.cancelSelectedNode();}}if($.trim($("#organizationTreeSearch").val())==""){document.getElementById("number").innerHTML="";a.cancelSelectedNode();}},_updateNodes:function(b,d){var c=$.fn.zTree.getZTreeObj("organizationTree");
if(d){for(var e=0,a=d.length;e<a;e++){d[e].highlight=b;if(b){c.expandNode(d[e].getParentNode(),true,false,false);}c.updateNode(d[e]);}}},_getEmployeeOption:function(b){var a=CsNeedReturnVisit._CONS_.EMPLOYEE_LIST_URL+"?groupId="+b+"&type=dept_manager";
FormUtils.loadData(a,function(d){var e=new StringBuffer();e.append("<option value=''>请选择</option>");if(d&&d.length>0){for(var c=0;c<d.length;c++){e.append("<option value='"+d[c].id+"'>"+d[c].aid+":"+d[c].name+"</option>");
}}$("#select-employee").empty().append(e.toString()).select2();},null,true);},_bindFormValidation:function(){},_postParams:function(a){var b=this;var c=CsNeedReturnVisit._CONS_.CURRENORGINID;
var e="";var d=CsNeedReturnVisit._CONS_.CURRENTYPE;if(a){e+="&isReturnVisit=n";e+="&lastVisitDay="+$(".activeDay").attr("val");}else{e+="&isReturnVisit=y";
}if(d!=""&&d){if(d=="group"){e+="&belongOgnVisit="+c;}else{e+="&Q__S__EQ__entity.employee_id_="+c;}}if(b.noTree){e+="&Q__S__EQ__entity.employee_id_="+currentUserId;
}return e;},reloadJqgrid:function(c){var b=this;var a=false;JTJqgridUtils.reloadJqgrid(CsNeedReturnVisit._CONS_.GRID,b._postParams(a));},reloadHasJqgrid:function(c){var b=this;
var a=true;JTJqgridUtils.reloadJqgrid(CsNeedReturnVisit._CONS_.HASGRID,b._postParams(a));},_removeOtherWx:function(){$(".employee-wx").remove();},_initJqgrid:function(){var a=this;
var b=CsNeedReturnVisit._CONS_.LIST_DATA_URL;var e=true;var c=$(window).width();var d={"isReturnVisit":"y"};if(a.noTree){d={"isReturnVisit":"y","Q__S__EQ__entity.employee_id_":currentUserId};
}ConfigUtils.findByKey("csEntity.limit.wineIndustry",function(g){if(g.success){e=false;$(".wineIndustryDiv").show();}var f=true;if(ResUtils.canShow("csEntity.button.csListShowSrc")){f=false;
}ConfigUtils.findByKey("csEntity.hiddenConsumeField",function(i){var h=false;if(i.success){h=true;}ConfigUtils.findByKey("csEntity.createTimeToMonth",function(k){var j=[{modelName:"code",name:"code",index:"entity.code_",width:c<1024?100:150,formatter:function(l,m,o){if(o.footData){$(".ui-jqgrid-title").css({"width":"100%"});
var n="<div style='float:left'>"+o.code+"</div><div style='float:right;margin-left: 10%;'></div>";$(CsNeedReturnVisit._CONS_.GRID).jqGrid("setCaption",n);
return o.code;}else{var p=new StringBuffer();p.append('<div class="nameClass">');if(o.turnNew=="y"){p.append("<span style='color:red'>新</span>");}if(o.isSub=="y"){p.append("<span style='color:red;white-space:pre'> 从</span>");
}p.append(o.code);p.append("</div>");return p.toString();}}},{modelName:"_name",name:"_name",index:"entity._name_",width:100,formatter:function(l,m,n){return"<a class='csEntityEditTmp' attr-id='"+n.id+"'>"+n.name+"</a>";
}},{modelName:"name",name:"name",index:"entity.name_",hidden:true},{modelName:"isOrderSo",name:"isOrderSo",width:50,index:"entity.is_order_so_",formatter:function(l,m,o){var n=o.isOrderSo;
if(n=="y"){return"是";}else{return"<font style='color:red;'>否</font>";}}},{modelName:"canPlaceSo",name:"canPlaceSo",width:50,index:"entity.can_place_so_",formatter:function(l,m,o){var n=o.canPlaceSo;
if(n=="y"){return"是";}if(n=="n"){return"<font style='color:red;'>否</font>";}}},{modelName:"gender",name:"gender",index:"entity.gender_",width:35},{modelName:"care",name:"care",index:"care",width:50,sortable:false,formatter:function(l,t,m){var o=new StringBuffer();
var r=new Date();var p=DateUtils.format(r,"yyyy-MM-dd")+" 00:00:00";var q="";if(m.birthday.length<9||m.birthday.length==5){q=r.getFullYear()+m.birthday+" 00:00:00";
}else{q=r.getFullYear()+"-"+m.birthday.substring(5,m.birthday.length)+" 00:00:00";}var n=DateUtils.getDateDiff(p,q,"day");if(n<=7&&n>=0){var s=ctx+"/img/jt/cake2.png";
if(n==0){o.append("<div title='今天生日' style='background-image:url(/t9-ecm/img/jt/cake2.png);width:20px; height:20px;float:left;'></div>");}else{o.append("<div title='"+q.substring(5,10)+"生日, 还差"+n+"天' style='background-image:url(/t9-ecm/img/jt/cake2.png);width:20px; height:20px;float:left;'></div>");
}}if(m.lastCompleteTime){if(DateUtils.getDateDiff(m.lastCompleteTime,p,"day")>7&&DateUtils.getDateDiff(m.lastCompleteTime,p,"day")<28){o.append("<div title='购买满7天' style='background-image:url(/t9-ecm/img/jt/7.png);width:20px; height:20px;float:left;'></div>");
}if(DateUtils.getDateDiff(m.lastCompleteTime,p,"day")>=28){o.append("<div title='购买满28天' style='background-image:url(/t9-ecm/img/jt/28.png);width:20px; height:20px;float:left;'></div>");
}}return o.toString();}},{modelName:"bizType",name:"bizType",index:"entity.biz_type_",width:70,sortable:true},{modelName:versionType&&versionType=="finance"?"isTurnover":"hasDeal",name:versionType&&versionType=="finance"?"isTurnover":"hasDeal",index:versionType&&versionType=="finance"?"entity.is_turnover_":"entity.so_total_",width:35,sortable:true,formatter:function(l,m,o){var n="<div  style='background-image:url(/t9-ecm/img/jt/queren.png);width:20px; height:20px;float:left;'></div><i class='fa' style='margin-right:3px;'></i>";
if(versionType&&versionType=="finance"){if(l&&l=="y"){return n;}else{return"";}}else{if(o.soTotal&&o.soTotal>0){return n;}else{return"";}}}},{modelName:"soComplete",name:"soComplete",index:"entity.so_complete_",width:35},{modelName:"soTotal",name:"soTotal",index:"entity.so_total_",width:70,hidden:h,formatter:function(l,m,n){return n.soTotal;
}},{modelName:"pointTotal",name:"pointTotal",index:"entity.point_total_",width:70,formatter:function(l,m,n){return n.pointTotal;}},{modelName:"jdPoint",name:"jdPoint",index:"entity.jd_point_",hidden:e,width:60,sortable:true},{modelName:"youzanPoint",name:"youzanPoint",index:"entity.youzan_point_",hidden:e,width:60,sortable:true},{modelName:"interests",name:"interests",index:"entity.interests_",width:80,sortable:true},{modelName:"productName",name:"productName",index:"entity.product_name_",width:80,sortable:true},{modelName:"srcNames",name:"srcNames",index:"entity.srcs_",width:80,sortable:true,hidden:f},{modelName:"relatedWeixin",name:"relatedWeixin",index:"entity.related_weixin_",width:80,sortable:true,formatter:function(l,m,o){var n="<div  style='background-image:url(/t9-ecm/img/jt/queren.png);width:20px; height:20px;float:left;'></div><i class='fa' style='margin-right:3px;'></i>";
if(l=="y"){return n;}else{return"";}}},{modelName:"prName",name:"prName",index:"entity.pr_name_",width:120,sortable:true,formatter:function(l,n,o){var p=new StringBuffer();
if(o.prName){p.append(o.prName);}if(o.ciName){p.append(",").append(o.ciName);}var m=p.toString();if(m){m=m.replace("省","");m=m.replace("市","");m=m.replace("自治区","");
m=m.replace("自治州","");}return m;}},{modelName:"lastFollowTime",name:"lastFollowTime",index:"entity.last_follow_time_",width:82,formatter:function(l){var m=new StringBuffer();
if(l&&0==DateUtils.getDateDiff(l,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){m.append("今天 ").append(DateUtils.mini3Time(l));}else{if(l&&1==DateUtils.getDateDiff(l,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){m.append("昨天 ").append(DateUtils.mini3Time(l));
}else{m.append(DateUtils.mini2Time(l));}}return m.toString();}},{modelName:"follow",name:"follow",index:"entity.follow_",width:70},{modelName:"lastFollowContent",name:"lastFollowContent",index:"entity.last_follow_content_",sortable:false,width:100,formatter:function(l){var m="";
if(l!=""&&l!=null){m='<span  style="color:#1ab394;'+(a.simpleShowDesc=="true"?"":"display:none")+'" class="tooltip-desc fa fa-bell" data-toggle="tooltip"  data-placement="right" title="'+l+'"></span>';
m+='<span style="'+(a.simpleShowDesc=="true"?"display:none":"")+'" class="desc-detail">'+l+"</span>";}return m;}},{modelName:"desc",name:"desc",index:"entity.desc_",width:100,formatter:function(m){var l="";
if(m!=""&&m!=null){l='<span  style="color:#1ab394;'+(a.simpleShowDesc=="true"?"":"display:none")+'" class="tooltip-desc fa fa-bell" data-toggle="tooltip"  data-placement="right" title="'+m+'"></span>';
l+='<span style="'+(a.simpleShowDesc=="true"?"display:none":"")+'" class="desc-detail">'+m+"</span>";}return l;}},{modelName:"turnTime",name:"turnTime",index:"entity.turn_time_",width:82,formatter:function(l){var m=new StringBuffer();
if(l&&0==DateUtils.getDateDiff(l,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){m.append("今天 ").append(DateUtils.mini3Time(l));}else{if(l&&1==DateUtils.getDateDiff(l,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){m.append("昨天 ").append(DateUtils.mini3Time(l));
}else{m.append(DateUtils.mini2Time(l));}}return m.toString();}},{modelName:"lastCompleteTime",name:"lastCompleteTime",index:"entity.last_complete_time_",width:82,formatter:function(l){var m=new StringBuffer();
if(l&&0==DateUtils.getDateDiff(l,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){m.append("今天 ").append(DateUtils.mini3Time(l));}else{if(l&&1==DateUtils.getDateDiff(l,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){m.append("昨天 ").append(DateUtils.mini3Time(l));
}else{m.append(DateUtils.mini2Time(l));}}return m.toString();}},{modelName:"employeeName",name:"employeeName",index:"entity.employee_id_",width:100,hidden:true,formatter:function(l,m,n){if(n.employeeAid){return n.employeeAid+":"+n.employeeName;
}return n.employeeAid;}},{modelName:"groupName",name:"groupName",index:"entity.group_Id_",width:70,hidden:true},{modelName:"createTime",name:"createTime",index:"entity.create_time_",width:82,formatter:function(l){var m=new StringBuffer();
if(l&&0==DateUtils.getDateDiff(l,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){m.append("今天 ").append(DateUtils.mini3Time(l));}else{if(l&&1==DateUtils.getDateDiff(l,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){m.append("昨天 ").append(DateUtils.mini3Time(l));
}else{m.append(DateUtils.mini2Time(l));}}return m.toString();}},{modelName:"phone",name:"phone",index:"entity.phone",hidden:true,width:60},{modelName:"subPhone",name:"subPhone",index:"entity.subPhone",hidden:true,width:60}];
$(CsNeedReturnVisit._CONS_.GRID).JTJqgrid({url:b,pager:CsNeedReturnVisit._CONS_.PAGER,postData:d,shrinkToFit:false,autoScroll:true,width:"100%",autowidth:true,colNames:["客户编号","姓名","客户姓名（隐藏）","约单","可下单","性别","关怀","分类","成交","N次","消费(元)","积分","京享值","有赞积分","意向","产品意向","渠道","微信","地区","最新跟进","跟进标签","跟进内容","备注","转单时间","最新签收","工号","部门","注册时间","手机号","从属客户手机号码"],colModel:j,footerrow:true,userDataOnFooter:true,loadComplete:function(){if("true"==window.localStorage.getItem("csentity_need_clear_selectedJqgrid")){a.selectedJqgrid=new Array();
window.localStorage.removeItem("csentity_need_clear_selectedJqgrid");}if($(CsNeedReturnVisit._CONS_.GRID).jqGrid("getGridParam","records")<1000){$("#endExportNum").val($(CsNeedReturnVisit._CONS_.GRID).jqGrid("getGridParam","records"));
}else{$("#endExportNum").val(1000);}a._hideNotGrantBtn();$(window).resize();},gridComplete:function(){var l=$(CsNeedReturnVisit._CONS_.GRID).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow");
l.find('td[aria-describedby*="rn"],td[aria-describedby*="cb"],td[aria-describedby*="care"],td[aria-describedby*="srcNames"],td[aria-describedby*="relatedWeixin"],td[aria-describedby*="name"],td[aria-describedby*="gender"],td[aria-describedby*="bizType"],td[aria-describedby*="winePurpose"],td[aria-describedby*="taste"],td[aria-describedby*="hasDeal"],td[aria-describedby*="soRepeatBuy"],td[aria-describedby*="soTotal"],td[aria-describedby*="interests"],td[aria-describedby*="productName"],td[aria-describedby*="follow"],td[aria-describedby*="turnTime"],td[aria-describedby*="lastCompleteTime"],td[aria-describedby*="employeeName"],td[aria-describedby*="levelName"],td[aria-describedby*="lastFollowTime"],td[aria-describedby*="canPlaceSo"],td[aria-describedby*="soComplete"],td[aria-describedby*="jdPoint"],td[aria-describedby*="prName"],td[aria-describedby*="desc"],td[aria-describedby*="groupName"],td[aria-describedby*="createTime"]').hide();
l.find('td[aria-describedby*="csEntityGrid_code"]').show();}});});});});},_initHasVisitJqgrid:function(){var a=this;var b=CsNeedReturnVisit._CONS_.LIST_DATA_URL;
var e=true;var c=$(window).width();var d={"isReturnVisit":"n","lastVisitDay":"30"};if(a.noTree){var d={"isReturnVisit":"n","lastVisitDay":"30","Q__S__EQ__entity.employee_id_":currentUserId};
}ConfigUtils.findByKey("csEntity.limit.wineIndustry",function(g){if(g.success){e=false;$(".wineIndustryDiv").show();}var f=true;if(ResUtils.canShow("csEntity.button.csListShowSrc")){f=false;
}ConfigUtils.findByKey("csEntity.hiddenConsumeField",function(i){var h=false;if(i.success){h=true;}ConfigUtils.findByKey("csEntity.createTimeToMonth",function(k){var j=[{modelName:"code",name:"code",index:"entity.code_",width:c<1024?100:150,formatter:function(l,m,o){if(o.footData){$(".ui-jqgrid-title").css({"width":"100%"});
var n="<div style='float:left'>"+o.code+"</div><div style='float:right;margin-left: 10%;'></div>";$(CsNeedReturnVisit._CONS_.GRID).jqGrid("setCaption",n);
return o.code;}else{var p=new StringBuffer();p.append('<div class="nameClass">');if(o.turnNew=="y"){p.append("<span style='color:red'>新</span>");}if(o.isSub=="y"){p.append("<span style='color:red;white-space:pre'> 从</span>");
}p.append("<a class='csEntityEditTmp' style='font-weight:bold' attr-id='"+o.id+"'>"+o.code+":<span title='"+o.name+"' style='word-break:break-all'>"+o.name+"</span></a></div>");
return p.toString();}}},{name:"name",index:"entity.name_",hidden:true},{modelName:"isOrderSo",name:"isOrderSo",width:50,index:"entity.is_order_so_",formatter:function(l,m,o){var n=o.isOrderSo;
if(n=="y"){return"是";}else{return"<font style='color:red;'>否</font>";}}},{modelName:"canPlaceSo",name:"canPlaceSo",width:50,index:"entity.can_place_so_",formatter:function(l,m,o){var n=o.canPlaceSo;
if(n=="y"){return"是";}if(n=="n"){return"<font style='color:red;'>否</font>";}}},{modelName:"gender",name:"gender",index:"entity.gender_",width:35},{modelName:"care",name:"care",index:"care",width:50,sortable:false,formatter:function(l,t,m){var o=new StringBuffer();
var r=new Date();var p=DateUtils.format(r,"yyyy-MM-dd")+" 00:00:00";var q="";if(m.birthday.length<9||m.birthday.length==5){q=r.getFullYear()+m.birthday+" 00:00:00";
}else{q=r.getFullYear()+"-"+m.birthday.substring(5,m.birthday.length)+" 00:00:00";}var n=DateUtils.getDateDiff(p,q,"day");if(n<=7&&n>=0){var s=ctx+"/img/jt/cake2.png";
if(n==0){o.append("<div title='今天生日' style='background-image:url(/t9-ecm/img/jt/cake2.png);width:20px; height:20px;float:left;'></div>");}else{o.append("<div title='"+q.substring(5,10)+"生日, 还差"+n+"天' style='background-image:url(/t9-ecm/img/jt/cake2.png);width:20px; height:20px;float:left;'></div>");
}}if(m.lastCompleteTime){if(DateUtils.getDateDiff(m.lastCompleteTime,p,"day")>7&&DateUtils.getDateDiff(m.lastCompleteTime,p,"day")<28){o.append("<div title='购买满7天' style='background-image:url(/t9-ecm/img/jt/7.png);width:20px; height:20px;float:left;'></div>");
}if(DateUtils.getDateDiff(m.lastCompleteTime,p,"day")>=28){o.append("<div title='购买满28天' style='background-image:url(/t9-ecm/img/jt/28.png);width:20px; height:20px;float:left;'></div>");
}}return o.toString();}},{modelName:"bizType",name:"bizType",index:"entity.biz_type_",width:70,sortable:true},{modelName:versionType&&versionType=="finance"?"isTurnover":"hasDeal",name:versionType&&versionType=="finance"?"isTurnover":"hasDeal",index:versionType&&versionType=="finance"?"entity.is_turnover_":"entity.so_total_",width:35,sortable:true,formatter:function(l,m,o){var n="<div  style='background-image:url(/t9-ecm/img/jt/queren.png);width:20px; height:20px;float:left;'></div><i class='fa' style='margin-right:3px;'></i>";
if(versionType&&versionType=="finance"){if(l&&l=="y"){return n;}else{return"";}}else{if(o.soTotal&&o.soTotal>0){return n;}else{return"";}}}},{modelName:"soComplete",name:"soComplete",index:"entity.so_complete_",width:35},{modelName:"soTotal",name:"soTotal",index:"entity.so_total_",width:70,hidden:h,formatter:function(l,m,n){return n.soTotal;
}},{modelName:"pointTotal",name:"pointTotal",index:"entity.point_total_",width:70,formatter:function(l,m,n){return n.pointTotal;}},{modelName:"jdPoint",name:"jdPoint",index:"entity.jd_point_",hidden:e,width:60,sortable:true},{modelName:"youzanPoint",name:"youzanPoint",index:"entity.youzan_point_",hidden:e,width:60,sortable:true},{modelName:"interests",name:"interests",index:"entity.interests_",width:80,sortable:true},{modelName:"productName",name:"productName",index:"entity.product_name_",width:80,sortable:true},{modelName:"srcNames",name:"srcNames",index:"entity.srcs_",width:80,sortable:true,hidden:f},{modelName:"relatedWeixin",name:"relatedWeixin",index:"entity.related_weixin_",width:80,sortable:true,formatter:function(l,m,o){var n="<div  style='background-image:url(/t9-ecm/img/jt/queren.png);width:20px; height:20px;float:left;'></div><i class='fa' style='margin-right:3px;'></i>";
if(l=="y"){return n;}else{return"";}}},{modelName:"prName",name:"prName",index:"entity.pr_name_",width:120,sortable:true,formatter:function(l,n,o){var p=new StringBuffer();
if(o.prName){p.append(o.prName);}if(o.ciName){p.append(",").append(o.ciName);}var m=p.toString();if(m){m=m.replace("省","");m=m.replace("市","");m=m.replace("自治区","");
m=m.replace("自治州","");}return m;}},{modelName:"lastFollowTime",name:"lastFollowTime",index:"entity.last_follow_time_",width:82,formatter:function(l){var m=new StringBuffer();
if(l&&0==DateUtils.getDateDiff(l,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){m.append("今天 ").append(DateUtils.mini3Time(l));}else{if(l&&1==DateUtils.getDateDiff(l,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){m.append("昨天 ").append(DateUtils.mini3Time(l));
}else{m.append(DateUtils.mini2Time(l));}}return m.toString();}},{modelName:"follow",name:"follow",index:"entity.follow_",width:70},{modelName:"lastFollowContent",name:"lastFollowContent",index:"entity.last_follow_content_",sortable:false,width:100,formatter:function(l){var m="";
if(l!=""&&l!=null){m='<span  style="color:#1ab394;'+(a.simpleShowDesc=="true"?"":"display:none")+'" class="tooltip-desc fa fa-bell" data-toggle="tooltip"  data-placement="right" title="'+l+'"></span>';
m+='<span style="'+(a.simpleShowDesc=="true"?"display:none":"")+'" class="desc-detail">'+l+"</span>";}return m;}},{modelName:"desc",name:"desc",index:"entity.desc_",width:100,formatter:function(m){var l="";
if(m!=""&&m!=null){l='<span  style="color:#1ab394;'+(a.simpleShowDesc=="true"?"":"display:none")+'" class="tooltip-desc fa fa-bell" data-toggle="tooltip"  data-placement="right" title="'+m+'"></span>';
l+='<span style="'+(a.simpleShowDesc=="true"?"display:none":"")+'" class="desc-detail">'+m+"</span>";}return l;}},{modelName:"turnTime",name:"turnTime",index:"entity.turn_time_",width:82,formatter:function(l){var m=new StringBuffer();
if(l&&0==DateUtils.getDateDiff(l,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){m.append("今天 ").append(DateUtils.mini3Time(l));}else{if(l&&1==DateUtils.getDateDiff(l,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){m.append("昨天 ").append(DateUtils.mini3Time(l));
}else{m.append(DateUtils.mini2Time(l));}}return m.toString();}},{modelName:"lastCompleteTime",name:"lastCompleteTime",index:"entity.last_complete_time_",width:82,formatter:function(l){var m=new StringBuffer();
if(l&&0==DateUtils.getDateDiff(l,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){m.append("今天 ").append(DateUtils.mini3Time(l));}else{if(l&&1==DateUtils.getDateDiff(l,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){m.append("昨天 ").append(DateUtils.mini3Time(l));
}else{m.append(DateUtils.mini2Time(l));}}return m.toString();}},{modelName:"employeeName",name:"employeeName",index:"entity.employee_id_",width:100,hidden:true,formatter:function(l,m,n){if(n.employeeAid){return n.employeeAid+":"+n.employeeName;
}return n.employeeAid;}},{modelName:"groupName",name:"groupName",index:"entity.group_Id_",width:70,hidden:true},{modelName:"createTime",name:"createTime",index:"entity.create_time_",width:82,formatter:function(l){var m=new StringBuffer();
if(l&&0==DateUtils.getDateDiff(l,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){m.append("今天 ").append(DateUtils.mini3Time(l));}else{if(l&&1==DateUtils.getDateDiff(l,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){m.append("昨天 ").append(DateUtils.mini3Time(l));
}else{m.append(DateUtils.mini2Time(l));}}return m.toString();}},{modelName:"phone",name:"phone",index:"entity.phone",hidden:true,width:60},{modelName:"subPhone",name:"subPhone",index:"entity.subPhone",hidden:true,width:60}];
$(CsNeedReturnVisit._CONS_.HASGRID).JTJqgrid({url:b,pager:CsNeedReturnVisit._CONS_.HASPAGER,postData:d,shrinkToFit:false,autoScroll:true,width:"100%",autowidth:true,colNames:["客户","客户姓名（隐藏）","约单","可下单","性别","关怀","分类","成交","N次","消费(元)","积分","京享值","有赞积分","意向","产品意向","渠道","微信","地区","最新跟进","跟进标签","跟进内容","备注","转单时间","最新签收","工号","部门","注册时间","手机号","从属客户手机号码"],colModel:j,footerrow:true,userDataOnFooter:true,loadComplete:function(){if("true"==window.localStorage.getItem("csentity_need_clear_selectedJqgrid")){a.selectedJqgrid=new Array();
window.localStorage.removeItem("csentity_need_clear_selectedJqgrid");}if($(CsNeedReturnVisit._CONS_.HASGRID).jqGrid("getGridParam","records")<1000){$("#endExportNum").val($(CsNeedReturnVisit._CONS_.HASGRID).jqGrid("getGridParam","records"));
}else{$("#endExportNum").val(1000);}a._hideNotGrantBtn();$(window).resize();},gridComplete:function(){var l=$(CsNeedReturnVisit._CONS_.HASGRID).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow");
l.find('td[aria-describedby*="rn"],td[aria-describedby*="cb"],td[aria-describedby*="care"],td[aria-describedby*="srcNames"],td[aria-describedby*="relatedWeixin"],td[aria-describedby*="name"],td[aria-describedby*="gender"],td[aria-describedby*="bizType"],td[aria-describedby*="winePurpose"],td[aria-describedby*="taste"],td[aria-describedby*="hasDeal"],td[aria-describedby*="soRepeatBuy"],td[aria-describedby*="soTotal"],td[aria-describedby*="interests"],td[aria-describedby*="productName"],td[aria-describedby*="follow"],td[aria-describedby*="turnTime"],td[aria-describedby*="lastCompleteTime"],td[aria-describedby*="employeeName"],td[aria-describedby*="levelName"],td[aria-describedby*="lastFollowTime"],td[aria-describedby*="canPlaceSo"],td[aria-describedby*="soComplete"],td[aria-describedby*="jdPoint"],td[aria-describedby*="prName"],td[aria-describedby*="desc"],td[aria-describedby*="groupName"],td[aria-describedby*="createTime"]').hide();
l.find('td[aria-describedby*="csEntityGrid_code"]').show();}});});});});},};