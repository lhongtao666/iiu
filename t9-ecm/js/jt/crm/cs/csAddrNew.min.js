function CsAddr(){this.csType="";this.employeeId="";this.permissionType="";}CsAddr.prototype={init:function(){this._bindEventHander();},_bindEventHander:function(){var a=this;
$(document).on("click",".addAddr",function(){var c=new ShopAddrOpt();var b=$("input[name=id]").val();c.init({csId:b,callBack:function(e){var d=[];d.push(e);
$(".addrDiv").append(a.fillAddr(d));$(".noConformData").empty();}});});$(document).on("click",".showMapWeather",function(){var c=$(this).attr("idVal");
var b=$(this).attr("cityNameVal");FormUtils.submit(ctx+"/crm/cs/csEntity/addr/loadMapInfo.htm",{addrId:c},function(d){if(d.status=="200"){DialogUtils.error("提示",d.message);
}else{JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/mapWeatherForm.htm?cityName="+b+"&longitude="+d.result.locationPo.lng+"&latitude="+d.result.locationPo.lat,"地图|天气");
}});});$(document).on("click",".edit-addr",function(){var b=$(this);var c=new ShopAddrOpt();c.init({addrId:$(this).attr("idVal"),csId:$('input[name="id"]').val(),callBack:function(d){b.parents("li").eq(0).find("input[name=addrName]").val(d.name);
b.parents("li").eq(0).find(".showMapWeather").attr("cityNameVal",d.ciName);b.parents("li").eq(0).find("input[name=addr]").val(a._buildDetailAddr(d));}});
});$(document).on("click",".remove-addr",function(){var c=$(this).attr("idval");var b=$("input[name=id]").val();DialogUtils.confirm(function(){if(c){FormUtils.submit(CsEntityEdit._CONS_.DEL_ADDR_URL,{id:c},function(e){if(e.success){var d={csId:b,csType:a.csType,employeeId:a.employeeId,permissionType:a.permissionType,};
a.loadData(d);}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);}});}});});},loadData:function(b){var a=this;a.csType=b.csType;a.employeeId=b.employeeId;
a.permissionType=b.permissionType;FormUtils.loadData(CsEntityEdit._CONS_.EDIT_INFO_URL+"?party_id_="+b.csId,function(c){$(".addrDiv").empty();if(c&&c.length>0){$(".addrDiv").append(a.fillAddr(c));
}else{$(".addrDiv").append(a.buildAddBtn());}if(b.fn&&typeof b.fn==="function"){b.fn();}if("isReturnVisit"==type){$(".operPhone").hide();$(".operAddr").hide();
}},function(){},true);},buildAddBtn:function(){var a=new StringBuffer();a.append("<div class='noConformData form-group'>");a.append("<div class='col-sm-12' style='text-align:center'>");
a.append("<div class='noConformData col-sm-8' style='text-align:center'><span style='color: #9E9E9E;'>暂无客户地址</span></div>");a.append("<div class='col-sm-2'>");
a.append("<button type='button' class='jt-form-select addAddr'><i class='fa fa-plus'></i>&nbsp;添加地址</button>");a.append("</div>");a.append("</div>");a.append("</div>");
return a.toString();},fillAddr:function(c){var a=this;var d=new StringBuffer();for(var b=0;b<c.length;b++){if(c[b].isSnapshot=="n"){d.append("<li id='"+c[b].id+"' ");
if((c[b].isDefault=="y"||(c.length==1&&c[b].isDefault=="n"))){$("input[name=addrId]").val(c[b].id);}d.append("'>");d.append("<div class='form-group'>");
d.append("<div class='col-sm-3'>");d.append("<label class='col-sm-5 control-label'>联系人</label>");d.append("<div class='col-sm-7'>");d.append("<input type='text' name='addrName' readonly class='form-control' validateType='default' value='"+c[b].name+"'>");
d.append("</div>");d.append("</div>");d.append("<div class='col-sm-6'>");d.append("<input type='text' name='addr' readonly class='form-control' validateType='default' value='"+a._buildDetailAddr(c[b])+"'>");
d.append("</div>");d.append("<div class='col-sm-3 operAddr'>");d.append("<button type='button' class='jt-form-select addAddr'><i class='fa fa-plus'></i></button>");
d.append("<button type='button' class='jt-form-select edit-addr' idVal='"+c[b].id+"'><i class='fa fa-edit'></i></button>");d.append("<button type='button' class='jt-form-select showMapWeather' style='display:none;' idVal='"+c[b].id+"' cityNameVal='"+c[b].ciName+"' ><i class='fa fa-map-marker'></i></button>");
if(this.csType){if("self"==this.csType||(this.permissionType&&"self"==this.permissionType)){if(ResUtils.canShow("csEntity.button.deleteAddrBtn")){d.append("<button type='button' class='jt-form-select remove-addr' idval='"+c[b].id+"'><i class='fa fa-remove'></i></button>");
}}else{if("mysub"==this.csType||(this.permissionType&&"mysub"==this.permissionType)){if(ResUtils.canShow("csEntity.button.deleteAddrBtnSub")){d.append("<button type='button' class='jt-form-select remove-addr' idval='"+c[b].id+"'><i class='fa fa-remove'></i></button>");
}}else{if("task"==this.csType&&ResUtils.canShow("csEntity.button.deleteAddrBtnTask")){d.append("<button type='button' class='jt-form-select remove-addr' idval='"+c[b].id+"'><i class='fa fa-remove'></i></button>");
}else{if("callRecord"==this.csType&&ResUtils.canShow("csEntity.button.deleteAddrBtnCallRecord")){d.append("<button type='button' class='jt-form-select remove-addr' idval='"+c[b].id+"'><i class='fa fa-remove'></i></button>");
}else{if(ResUtils.canShow("csEntity.button.deleteAddrBtnSearch")){d.append("<button type='button' class='jt-form-select remove-addr' idval='"+c[b].id+"'><i class='fa fa-remove'></i></button>");
}}}}}}d.append("</div>");d.append("</div>");d.append("</li>");}}return d.toString();},_buildDetailAddr:function(b){var a=b.coName+b.prName+b.ciName+b.arName;
if(b.toName){a+=b.toName;}if(this.csType){if("self"==this.csType||(this.permissionType&&"self"==this.permissionType)){if(ResUtils.canShow("csEntity.button.viewAddrBtn")){a+=b.addr;
}else{a+=MaskPhoneNum.maskAddr(b.addr);}}else{if("mysub"==this.csType||(this.permissionType&&"mysub"==this.permissionType)){if(ResUtils.canShow("csEntity.button.viewAddrBtnSub")){a+=b.addr;
}else{a+=MaskPhoneNum.maskAddr(b.addr);}}else{if("task"==this.csType){if(ResUtils.canShow("csEntity.button.viewAddrBtnTask")){a+=b.addr;}else{a+=MaskPhoneNum.maskAddr(b.addr);
}}else{if("callRecord"==this.csType){if(ResUtils.canShow("csEntity.button.viewAddrBtnCallRecord")){a+=b.addr;}else{a+=MaskPhoneNum.maskAddr(b.addr);}}else{if(ResUtils.canShow("csEntity.button.viewAddrBtnSearch")){a+=b.addr;
}else{a+=MaskPhoneNum.maskAddr(b.addr);}}}}}}return a;},};