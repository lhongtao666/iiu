function FormConfig(a){if(!a){a={};}this.title=a.title?a.title:"表单字段配置";if(a.formId){if(typeof a.formId=="string"){this.formId=$("#"+a.formId);}else{if(typeof a.formId=="object"){this.formId=a.formId;
}}}else{console.log("无法识别的表单对象！");this.isError=true;return false;}if(a.entry){if(typeof a.entry=="string"){this.entry=$("#"+a.entry);}else{if(typeof a.entry=="object"){this.entry=a.entry;
}}}else{this.entry=$(".jt-form-config");console.log("找不到指定配置的入口，组件默认点击类：jt-form-config！");}if(a.modular){this.modular=a.modular;}else{console.log("参数modualer为空，请指定模块唯一标识符！");
this.isError=true;return false;}this.endLess=a.endLess?a.endLess:[];this.forceParam=a.forceParam?a.forceParam:[];this.isHidden=a.isHidden?a.isHidden:false;
this.marker=null;this.sysMarker=null;this.isInit=false;this.sysMarkerId=null;}FormConfig._CONS_={GET_FORM_MARKER:ctx+"/gl/formText/findByKey.htm",SAVE_FORM_MARKER:ctx+"/gl/formText/updateByKey.htm",ADD_FORM_MARKER:ctx+"/gl/formText/saveAdd.htm"};
FormConfig.prototype={init:function(){var a=this;if(a.isError){return false;}$(a.entry).addClass("jt-"+a.modular+"-config");a.getFormParams();a.getBasicParams();
a.getSysMarker();a.bindEvent();},bindEvent:function(){var a=this;$(document).on("click",".jt-"+a.modular+"-config",function(b){a.loadFormConfigLayer(a.marker);
});$(document).on("click","#jt-form-config-list > div",function(c){var d=$(this).find("input[type='checkbox']");if(!$(c.target).is(".form-config-check")){d.trigger("click");
}if($(this).is(".jt-form-allcheck")){$(".form-config-check").each(function(f,g){if(!$(this).is("[disabled]")){$(this).prop("checked",d.prop("checked"));
if(d.prop("checked")){$("."+$(this).attr("name")).removeClass("jt-form-leftA");}else{$("."+$(this).attr("name")).addClass("jt-form-leftA");}}});}else{if(!$(this).is(".jt-form-endless")){if(d.prop("checked")){$("."+d.attr("name")).removeClass("jt-form-leftA");
var b=true;$(".form-config-check").each(function(f,g){if(!$(this).prop("checked")&&$(this).attr("name")!="allCheck"){b=false;}});if(b){$(".jt-form-allcheck").find(".form-config-check").prop("checked",true);
}}else{$("."+d.attr("name")).addClass("jt-form-leftA");$(".jt-form-allcheck").find(".form-config-check").prop("checked",false);}}}});},loadFormConfigLayer:function(d){var m=this;
var g="<div class='panel-default jt-form-config-layer' style='display:none;'>"+"<div class='panel-body'>"+"<form class='form-horizontal'>"+"<div class='form-group' id='jt-form-config-list'>"+"</div>"+"</form>"+"</div>"+"</div>";
if($("#jt-form-config-list").length==0){$("body").append(g);}var f="";var a="";for(var e=0;e<d.length;e++){var j=$.inArray(d[e].name.replace(/\s*/g,""),m.endLess);
var b=null;if(m.basicParam){b=$.inArray(d[e].name.replace(/\s*/g,""),m.basicParam);}var l="col-sm-3";if(d[e].key=="allCheck"){continue;}var c='<div class="'+l+((j!=-1)?" jt-form-endless":"")+((d[e].key=="allCheck")?" jt-form-allcheck":"")+'">'+'<div class="checkbox checkbox-success checkbox-inline">'+'<input type="checkbox" class="form-config-check" '+((j!=-1)?'disabled="disabled"':"")+' name="'+d[e].key+'" '+(d[e].isCheck?'checked="true"':"")+">"+'<label for="'+d[e].key+'">'+d[e].name+"</label>"+"</div>"+"</div>";
if(m.basicParam&&(b!=-1)){a+=c;}else{f+=c;}}if(a){f="<div class='basic-items-title'>常用字段</div>"+a+"<div  class='other-items-title'>其他字段</div>"+f;}$("#jt-form-config-list").empty().append(f);
var k="demo-class";if(ResUtils.canShow("form.button.config")){k+=" sys-form-config";}var h=$(window).width()/3;if(h<500){h=500+"px";}else{h="33.33%";}layer.open({type:1,title:m.title,shade:false,btn:["保存","取消","保存为全局"],offset:"10%",area:[h,"auto"],skin:k,content:$(".jt-form-config-layer"),scrollbar:false,success:function(i,n){},yes:function(n,i){m.marker=m.getMarker();
window.localStorage.removeItem(m.modular+"FormItems");window.localStorage.setItem(m.modular+"FormItems",JSON.stringify(m.marker));layer.close(n);},btn3:function(n,i){if(ResUtils.canShow("form.button.config")){m.saveSysMarker();
}else{DialogUtils.error("您无权修改系统配置项！");}},btn2:function(n,i){m.reMarker();},cancel:function(){m.reMarker();}});},getFormParams:function(){var c=this;var b=c.formId;
var a=[];var d=window.localStorage.getItem(c.modular+"FormItems");if(d){c.marker=JSON.parse(d);c.doMarker();c.isInit=true;}else{if(b.length!=1){console.log("传入的表单对象不存在或不唯一!");
}else{b.find(".jt-form-group").children().each(function(f,g){var h=$(this).children("label").text().replace(/\s*/g,"");if($.inArray(h,c.forceParam)>=0){return true;
}if(c.isHidden){a.push({"key":("marker"+f),"name":h,"isCheck":true});}else{if($(this).is(":visible")){a.push({"key":("marker"+f),"name":h,"isCheck":true});
}}});a.push({"key":"allCheck","name":"全选","isCheck":true});}c.marker=a;}},getBasicParams:function(){var c=this;var b=c.formId;var a=[];b.find(".jt-form-group").children().each(function(d,f){var g=$(this).children("label").text().replace(/\s*/g,"");
if($(this).is(".jt-basic-param")){a.push(g);}});if(a.length>0){c.basicParam=a;}},doMarker:function(){var a=this;if(a.marker){a.examMarker();$.each(a.marker,function(b,d){var c=this;
a.formId.find(".jt-form-group").children().each(function(f,g){var h=$(this).children("label").text().replace(/\s*/g,"");if($.inArray(h,a.forceParam)>=0){return true;
}if(h==c.name){$(this).addClass(c.key);if(!c.isCheck&&!$(this).is(".jt-form-leftA")){$(this).addClass("jt-form-leftA");}return false;}});});a.formId.find(".jt-form-group").animate({"opacity":1},"fast");
}},reMarker:function(b){var a=this;var c=a.marker;if(b){c=b;}$.each(c,function(f,h){var g=this;var d=a.formId.find(".jt-form-group").find("."+g.key);if(g.isCheck&&d.is(".jt-form-leftA")){d.removeClass("jt-form-leftA");
}else{if(!g.isCheck&&!d.is(".jt-form-leftA")){d.addClass("jt-form-leftA");}}});},getMarker:function(){var b=this;var a=[];$(".form-config-check").each(function(c,d){a.push({"key":$(this).attr("name"),"name":$(this).next().text().replace(/\s*/g,""),"isCheck":$(this).prop("checked")});
});return a;},getSysMarker:function(){var a=this;FormUtils.loadData(FormConfig._CONS_.GET_FORM_MARKER+"?key="+this.modular,function(b){if(b.msg){var c=JSON.parse(b.msg);
if(typeof c=="object"){a.sysMarker=c;a.sysMarkerId=b.msgCode;if(!a.isInit&&a.sysMarker){a.marker=a.sysMarker;}}}if(!a.isInit){a.doMarker();a.isInit=true;
}},false);},saveSysMarker:function(){var a=this;var d=a.getMarker();var b=FormConfig._CONS_.ADD_FORM_MARKER;var c={key:a.modular,content:JSON.stringify(d)};
if(a.sysMarkerId){b=FormConfig._CONS_.SAVE_FORM_MARKER;c.id=a.sysMarkerId;}FormUtils.submit(b,c,function(e){if(e.success){window.localStorage.removeItem(a.modular+"FormItems");
window.localStorage.setItem(a.modular+"FormItems",JSON.stringify(d));a.sysMarker=d;a.marker=d;if(!a.sysMarkerId){a.sysMarkerId=e.msgCode;}DialogUtils.success("提示","系统表单字段配置项保存成功！");
}});},examMarker:function(){var b=this;var c=[];var a=null;b.formId.find(".jt-form-group").children().each(function(d,f){var g=$(this).children("label").text().replace(/\s*/g,"");
if($.inArray(g,b.forceParam)>=0){return true;}if(b.isHidden){c.push({"key":("marker"+d),"name":g,"isCheck":true});}else{if($(this).is(":visible")){c.push({"key":("marker"+d),"name":g,"isCheck":true});
}}});if(b.marker&&c.length!=b.marker.length){c.push({"key":"allCheck","name":"全选","isCheck":true});$.each(b.marker,function(d,g){var f=this;$.each(c,function(h,e){if(this.name==f.name){c[h].isCheck=f.isCheck;
return false;}});});b.marker=c;}}};