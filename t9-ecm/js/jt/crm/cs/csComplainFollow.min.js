function CsComplainFollow(){this.canDelete=false;}CsComplainFollow._CONS_={LIST_DATA_URL:ctx+"/crm/cs/csComplain/findFollowByComplainId.htm",SAVE_ADD_URL:ctx+"/crm/cs/csComplain/addFollow.htm",};
CsComplainFollow.prototype={init:function(b){var a=this;a._initTable(b);if(b.canDelete){a.canDelete=b.canDelete;}},_bindTableEvent:function(){var a=this;
$("#saveFollowRecord").on("click",function(){a.openAddFollowDiv();});},_initTable:function(c){var a=this;var b=CsComplainFollow._CONS_.LIST_DATA_URL+"?complainId="+c.complainId;
if(a.csComplainFollowTable){a.csComplainFollowTable.ajax.url(b).load(function(){a._bindTableEvent();});}else{a.csComplainFollowTable=$("#csComplainFollowTable").DataTable({ajax:{url:b},columns:[{data:"desc",width:"70%"},{data:"createTime",width:"20%",render:function(f,e,d){return DateUtils.miniTime(f);
}},{data:"id",render:function(f,e,d){if(a.canDelete){return"<input type='button' value='删除' attr-id='"+d.id+"' class='btn btn-sm btn-outline btn-primary deleteComplainFollow' style='margin: 0px 0px 0px 15px;' />";
}else{return"";}},width:"10%"},],rowId:"id",lengthMenu:[[5,10],[5,10]],paging:true,pagingType:"simple",lengthChange:false,autoWidth:false,ordering:false,order:[[1,"desc"]],fnInitComplete:function(e,d){a._bindTableEvent();
},"dom":'<"toolbar">frtip'});}if("self"==type){$("div.toolbar").html("<input id='saveFollowRecord'  type='button' class='btn btn-sm btn-outline btn-primary'  value='添加'>");
}},openAddFollowDiv:function(){var a=this;a.layerIndex=layer.open({type:1,title:"添加跟进记录",shadeClose:false,btn:["提交","关闭"],area:["500px","350px"],scrollbar:false,content:$(".csComplainFollowAddDiv"),yes:function(d,c){var f=$("#csComplainFollowAddForm").find("[name=desc]").val();
if(!f){DialogUtils.error(msgCode.FAIL_MSG,"请填写跟进记录");return;}var b=CsComplainFollow._CONS_.SAVE_ADD_URL;var e={"desc":f,"complainId":$("[name=id]").val()};
FormUtils.submit(b,e,function(g){if(g.success){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);$("#csComplainFollowAddForm").find("[name=desc]").val("");
if("new"==$("#csComplainForm").find("[name=status]").val()){$("#csComplainForm").find("[name=status]").val("follow");}a._initTable({complainId:$("input[name='id']").val()});
layer.close(a.layerIndex);}else{DialogUtils.error(msgCode.FAIL_MSG,g.msg);}});}});$("#csComplainFollowAddForm").find("[name=desc]").focus();}};