function CsPhonePanel(){this.hadInit=false;this.csName="";this.soStatus="";}CsPhonePanel._CONS_={FIND_PHONES_URL:ctx+"/crm/cs/csEntity/findPhonesByCsId.htm",FIND_CS_BY_PHONE:ctx+"/crm/cs/csEntity/getByPhone.htm",EDIT_CS_NAME:ctx+"/crm/cs/csEntity/editCsName.htm",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detail.htm",};
CsPhonePanel.prototype={init:function(b,a){if(!this.hadInit){this.hadInit=true;this._bindEventHandler();}this.soStatus=a;this._initForm();this._fillData(b);
},_bindEventHandler:function(){var a=this;var b=$("#csPhonePanel");b.on("click",".callPhone",function(){var c=b.find("[name=phoneSelect]").find("option:selected").attr("attr-phone");
if(c.startsWith("020")){c=c.substring(3);}window.top.jtCtiService.dialout("9"+c);});b.on("click",".callPhoneAddZero",function(){var c=b.find("[name=phoneSelect]").find("option:selected").attr("attr-phone");
var d=/^(((1[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{9})$/;if(c.startsWith("020")){c=c.substring(3);}if(d.test(c)){window.top.jtCtiService.dialout("90"+c);
}else{window.top.jtCtiService.dialout("9"+c);}});b.on("click",".sendMessage",function(){var d=b.find("[name=csId]").val();var g=b.find("[name=phoneSelect]").val();
var f=b.find("[name=phoneSelect]").find("option:selected").text();var e=new SendMessage();var c={csId:d,number:g,maskNum:f};e.openSendMessageView(c);});
b.on("change","[name=phoneSelect]",function(){var c=$(this).find("option:selected").attr("attr-type");b.find("[name=phoneType]").val(c);});b.on("click","[name=csName]",function(){a.csName=$(this).val();
$(this).removeClass("validate_input_error");});b.on("blur","[name=csName]",function(){if(ResUtils.canShow("soEntity.button.editCsName")){if($(this).val()){if(a.csName!=$(this).val()){a._editCsName();
}}else{$(this).addClass("validate_input_error");DialogUtils.error("提示","请填写客户名称");}}});b.on("click",".csCode",function(){var c=b.find("[name=csId]").val();
JTTabUtils.addOrRefreshTab(CsPhonePanel._CONS_.DETAIL_CS_PAGE_URL+"?csId="+c,"客户明细");});b.on("click",".changeEmployee",function(){a._changeEmployee();});
$(document).on("click","#servicePhoneBtn",function(d){var c=$(this).attr("masknum");if(c&&c!=""){if(c.startsWith("020")){c=c.substring(3);}window.top.jtCtiService.dialout("9"+c);
}else{DialogUtils.error(msgCode.ERROR,"没有此快递公司的客服电话");return;}});},_changeEmployee:function(){var a=this;var d=$("#csPhonePanel");var b=0;if(ResUtils.canShow("employeeSelector.button.cs")){b:1;
}var e={isShowAllGroup:b,grantType:"/cs/",isMultiple:0,mode:0,isSale:1,callBack:function(g){if(g!=null){if(g.length>0){var i=d.find("input[name=employeeAid]").val();
d.find("input[name=employeeId]").val(g[0].id);d.find("input[name=employeeAid]").val(g[0].aid);d.find("input[name=csBelong]").val(g[0].aid+"："+g[0].name);
var f=[];f.push({employeeId:g[0].id,csEntityIds:d.find("input[name=csId]").val()});var h={soId:$("input[name=id]").val(),comment:"签收转工号，从工号"+i+"转到工号"+g[0].aid};
FormUtils.submit(ctx+"/crm/cs/csEntity/saveAssign.htm",{resultJson:JSON.stringify(f),csType:"csEntity",soInfo:JSON.stringify(h)},function(j){if(j.success){DialogUtils.success("提示",j.msg);
}else{DialogUtils.error("失败",j.msg);}});}}}};var c=new EmployeesSelect();c.init(e);},maskPhoneNum:function(a){if(a){return PhoneEncryptUtils.encryptPhone(a);
}return"";},_loadPhones:function(b,c){var a=this;FormUtils.loadData(CsPhonePanel._CONS_.FIND_PHONES_URL+"?csId="+b,function(d){if(d&&d.length>0){if(c&&typeof c==="function"){c(d);
}}});},_editCsName:function(){var a=$("#csPhonePanel");$.ajax({type:"GET",url:CsPhonePanel._CONS_.EDIT_CS_NAME+"?csId="+a.find("[name=csId]").val()+"&csName="+a.find("[name=csName]").val(),contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(b){if(b.success){DialogUtils.success("成功","修改客户名字成功");
}}});},_descryptPhoneNum:function(a,d,c){var b={number:a,callback:c,};DecryptHelper.decrypt(b);},_fillData:function(c){var a=this;if(c){var b=$("#csPhonePanel");
b.find("[name=csId]").val(c.id);b.find("[name=csName]").val(c.name);if(!ResUtils.canShow("soEntity.button.editCsName")){b.find("[name=csName]").attr("readonly",true);
}b.find(".csCode").text(c.code);b.find("[name=csBelong]").val(c.employeeAid+"："+c.employeeName);b.find("[name=employeeId]").val(c.employeeId);b.find("[name=employeeAid]").val(c.employeeAid);
a._loadPhones(c.id,function(f){var g=new StringBuffer();var d=false;for(var e=0;e<f.length;e++){if("停用"!=f[e].type){g.append("<option value='"+f[e].number+"' attr-type='"+f[e].type+"' attr-phone = '"+f[e].phone+"'>"+f[e].maskPhone+"</option>");
}if(!d){b.find("[name=phoneType]").val(f[0].type);d=true;}}b.find("[name=phoneSelect]").append(g.toString());b.find("#callPhoneDiv").show();});$("input[name=pointUsable]").val(c.pointUsable);
}},_initForm:function(){var a=$("#csPhonePanel");a.find("[name=csId]").val("");a.find("[name=csName]").val("");a.find("[name=csBelong]").val("");a.find("[name=phoneSelect]").val("");
a.find("#callPhoneDiv").hide();if(this.soStatus&&"complete"==this.soStatus&&ResUtils.canShow("soEntity.button.completeChangeEmp")){a.find(".changeEmployee").show();
}}};