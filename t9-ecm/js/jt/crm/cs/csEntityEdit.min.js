$(function(){var a=new CsEntityEdit();a.init(csId);});function CsEntityEdit(){this.csFollow=new CsFollow();this.financeMeeting=new CsFinanceMeeting();this.financeContract=new CsFinanceContract();
this.financeTurnover=new CsFinanceTurnover();this.csCashHi=new CsCashHi();this.statisticInfo=new StatisticInfo();this.csContract=new CsContract();this.csAccount=new CsAccount();
this.csLevelChange=new CsLevelChange();this.csCallRecord=new CsCallRecord();this.csMailHistory=new CsMailHistory();this.csPhone=new CsPhone();this.csEav=new CsEav();
this.oppoList=new OppoEntityList();this.csComplainAdd=new CsComplainAdd();this.csAddr=new CsAddr();this.sendMessage=new SendMessage();this.csEmployee=new CsEmployee(this);
this.csOrder=new CsOrder();this.pointLog=new PointLog();this.csLimit=new CsLimit();this.weiXinChatForm=new WeiXinChatForm();this.csRfmtModel=new CsRfmtModel();
this.formFrontConfig=new FormConfig({"formId":"csEntityForm","endLess":["姓名","客户编号","归属工号","备注"],modular:"csEntity"});this.isDetail=false;this.addPhone=true;
this.changeAddr=true;this.changeName=true;this.changeSrcs=true;this.changeInterests=true;this.eavInit=false;this.complainInit=false;this.levelChangeInit=false;
this.emailInit=false;this.csOrderInit=false;this.callRecordInit=false;this.smsRecordInit=false;this.csLimitInit=false;this.financeMeetingInit=false;this.financeTurnoverInit=false;
this.financeContractInit=false;this.csCashHiInit=false;this.isEdit=false;if(!isNewPage){this.recommendInit=false;this.pointLogInit=false;}this.canViewPhone=false;
this.data="";}CsEntityEdit._CONS_={EDIT_URL:ctx+"/crm/cs/csEntity/edit.htm",SAVE_EDIT_URL:ctx+"/crm/cs/csEntity/saveEdit.htm",CUSTOMER_EAV_KEY:"customer",ORDER_PLACE_URL:ctx+"/ec/salesorder/soEntity/place.htm",POINT_ORDER_PLACE_URL:ctx+"/ec/salesorder/soEntity/place/pointOrder.htm",ORDER_AFTER_LIST_URL:ctx+"/ec/salesorder/soEntity/saleafter/list.htm",EDIT_INFO_URL:ctx+"/crm/cs/csEntity/addr/partyAddrListData.htm",DEL_ADDR_URL:ctx+"/crm/cs/csEntity/deleteAddr.htm",COMBINE_CS_URL:ctx+"/crm/cs/csEntity/combineCs.htm",SEND_MAIL:ctx+"/gl/mail/mailQueue/sendMail.htm",DESCRYPT_WEIXIN:ctx+"/crm/cs/csEntity/decryptWeixin.htm",DESCRYPT_EMAIL:ctx+"/crm/cs/csEntity/decryptEmail.htm",GET_BY_CSCODE_URL:ctx+"/gl/cs/weiXinFriends/getByCsCode.htm",GET_BY_ANDROID_CSCODE_URL:ctx+"/crm/android/getByFriendCode.htm",FORM_ID:"#csEntityForm",LOAD_RECOMMEND:ctx+"/crm/cs/csEntity/loadRecommend.htm",LOAD_THREEDAYS_ORDER:ctx+"/ec/salesorder/soEntity/loadThreeDaysOrder.htm",FIND_EMPLOYEE_WEIXIN:ctx+"/gl/ou/employeeWeiXin/findByEmployee.htm",ADD_BY_PHONE_URL:ctx+"/crm/android/addByPhone.htm",FIND_THREE_DAYS_ORDER_URL:ctx+"/ec/salesorder/soEntity/findByCsIdAndTime.htm",NEED_RETURN_VISIT:ctx+"/crm/cs/csEntity/needReturnVisit.htm",FINISH_VISIT:ctx+"/crm/cs/csEntity/finishVisit.htm",};
CsEntityEdit.prototype={init:function(b){var a=this;this._bindFormValidation();this._bindEventHander();CsEntityUtils.init();this.loadData(b);this.csEmployee.init();
callRecordOperate.init();this.sendMessage.init();this.csEav.init();this.csAddr.init();this.csPhone.init();this._initSystemTag(b);this._prodSearch();CateUtils.getOptions({typeKey:"system",pKey:"degree",container:"degree"});
if(isUseRfmt&&isUseRfmt=="true"){this.csRfmtModel.init();this.csRfmtModel.getCsRfmtModel(csId);}},_initSystemTag:function(a){params={module:systemTagUtil._CONS_.CS_MODULE,type:systemTagUtil._CONS_.CS_TYPE,entityId:a,container:"systemTagSelect",selectType:"multiple"};
systemTagUtil.init(params);},_prodSearch:function(h){$("#searchProd").bsSuggest("destroy");var i=this;var b="entity";var g="n";var c="n";var f="prodEntity-csEntity";
var d=window.sessionStorage.getItem(f);if(d){var e=JSON.parse(d);i._prodSearchSuggest(e);}else{var a=ctx+"/ec/product/prodEntity/search.htm?prodType="+b+"&hasStock="+g+"&storeId="+"&limitProdCate="+c+"&keyword=";
FormUtils.loadData(a,function(j){window.sessionStorage.setItem(f,JSON.stringify(j));i._prodSearchSuggest(j);});}},_prodSearchSuggest:function(c){var a=this;
a.searchProds=c.value;var b=$("#searchProd").width()+"px";$("#searchProd").bsSuggest({effectiveFields:["prodName"],searchFields:["prodName","skuCode"],effectiveFieldsAlias:{prodName:"产品名字"},showBtn:false,idField:"skuId",keyField:"skuCode",showBtn:false,twoWayMatch:false,ignorecase:true,allowNoKeyword:true,multiWord:false,autoSelect:false,delayUntilKeyup:false,data:c,getDataMethod:"data",processData:function(d){return d;
},listStyle:{"padding-top":0,"max-height":"500px","max-width":b,"overflow":"auto","width":"auto","transition":"0.3s","-webkit-transition":"0.3s","-moz-transition":"0.3s","-o-transition":"0.3s"}}).on("onDataRequestSuccess",function(f,d){a.searchProds=d.value;
}).on("onSetSelectValue",function(g,d){for(var f=0;f<a.searchProds.length;f++){if(a.searchProds[f].skuId==d.id){a.currentProd=a.searchProds[f];break;}}$("#searchProd").val(a.currentProd.prodName);
}).on("onUnsetSelectValue",function(d){a.currentProd={};});},_hideNotGrantedBtn:function(b,a){if(!ResUtils.canShow("csEntity.questionnaire.button")){$(".questionNaire").hide();
}if("isReturnVisit"==type||"hasVisit"==type){$(".noVisit").hide();$(".addAddr").hide();$(".jt-form-group").find("input").attr("disabled","disabled");$(".jt-form-group").find("select").attr("disabled","disabled");
$(".radio").attr("disabled","disabled");$(".chooseRecommend").attr("disabled","disabled");$(".viewEmail").attr("disabled","disabled");$(".force-align-btn").hide();
$(".viewWeixin").attr("disabled","disabled");$(".showEmployeeWeixin").hide();$(".jt-form-group").find("textarea[name=desc]").attr("disabled","disabled");
}if(!ResUtils.canShow("csEntity.button.returnVisit")){$(".isReturnVisit").hide();}if("isReturnVisit"==type&&ResUtils.canShow("csEntity.button.finishVisit")){$(".finishVisit").show();
}if("self"==type||(b&&"self"==b)){if(!ResUtils.canShow("csEntity.button.increateYouZanPoint")){$(".increateYouZanPoint").remove();}if(!ResUtils.canShow("csEntity.button.giveCash")){$(".giveCashBtn").remove();
}if(!ResUtils.canShow("csEntity.button.viewWeixin")){$(".viewWeixin").remove();$(".maskWeixin").attr("readonly",true);}if(!ResUtils.canShow("csEntity.button.combine")){$(".combineCs").hide();
}if(!ResUtils.canShow("csEntity.button.createSubCsEntity")){$(".createSubCsEntity").hide();}if(!ResUtils.canShow("csEntity.button.saveEdit")){$(".saveBtn").hide();
}if(!ResUtils.canShow("csEntity.button.soAdd")){$(".placeOrder").hide();}if(!ResUtils.canShow("csEntity.button.soPointAdd")){$(".placePointOrder").parents("li").hide();
}if(!ResUtils.canShow("csEntity.button.changeEmployeeForEdit")){$(".changRelEmployee").hide();}if(!ResUtils.canShow("csEntity.button.sendMail")){$(".sendEmail").hide();
}if(!ResUtils.canShow("csEntity.button.batchCall")){$(".csEntityBatchCall").hide();}if(!ResUtils.canShow("csEntity.button.saleAfter")){$(".soAfterList").hide();
}if(!ResUtils.canShow("csEntity.button.addPhone")){this.addPhone=false;}if(!ResUtils.canShow("csEntity.button.changeAddr")){this.changeAddr=false;}if(!ResUtils.canShow("csEntity.button.changeName")){this.changeName=false;
}if(!ResUtils.canShow("csEntity.button.changeSrcs")){$("select[name=srcs]").attr("disabled",true);}if(!ResUtils.canShow("csEntity.button.viewEmail")){$(".viewEmail").hide();
}if(!ResUtils.canShow("csEntity.button.changeInterests")){$("select[name=interests]").attr("disabled",true);}if(!ResUtils.canShow("csEntity.button.changeEmployeeWeixin")){$("select[name=employeeWeixin]").attr("disabled",true);
$("input[name=passTime]").attr("disabled",true);}if(!ResUtils.canShow("csEntity.button.csDesc")){$("textarea[name=desc]").attr("disabled",true);}else{$("textarea[name=desc]").attr("disabled",false);
}}else{if("mysub"==type||(b&&"mysub"==b)){if(!ResUtils.canShow("csEntity.button.increateYouZanPointSub")){$(".increateYouZanPoint").remove();}if(!ResUtils.canShow("csEntity.button.giveCashSub")){$(".giveCashBtn").remove();
}if(!ResUtils.canShow("csEntity.button.viewWeixinSub")){$(".viewWeixin").remove();}if(!ResUtils.canShow("csEntity.button.saveEditSub")){$(".saveBtn").hide();
}if(!ResUtils.canShow("csEntity.button.combineSub")){$(".combineCs").hide();}if(!ResUtils.canShow("csEntity.button.createSubCsEntitySub")){$(".createSubCsEntity").hide();
}if(!ResUtils.canShow("csEntity.button.soAddSub")){$(".placeOrder").hide();}if(!ResUtils.canShow("csEntity.button.soPointAddSub")){$(".placePointOrder").parents("li").hide();
}if(!ResUtils.canShow("csEntity.button.changeEmployeeForEditSub")){$(".changRelEmployee").hide();}if(!ResUtils.canShow("csEntity.button.sendMailSub")){$(".sendEmail").hide();
}if(!ResUtils.canShow("csEntity.button.viewEmailSub")){$(".viewEmail").hide();}if(!ResUtils.canShow("csEntity.button.saleAfterSub")){$(".soAfterList").hide();
}if(!ResUtils.canShow("csEntity.button.addPhoneSub")){this.addPhone=false;}if(!ResUtils.canShow("csEntity.button.changeAddrSub")){this.changeAddr=false;
}if(!ResUtils.canShow("csEntity.button.changeNameSub")){this.changeName=false;}if(!ResUtils.canShow("csEntity.button.changeSrcsSub")){$("select[name=srcs]").attr("disabled",true);
}if(!ResUtils.canShow("csEntity.button.changeInterestsSub")){$("select[name=interests]").attr("disabled",true);}if(!ResUtils.canShow("csEntity.button.changeEmployeeWeixinSub")){$("select[name=employeeWeixin]").attr("disabled",true);
$("input[name=passTime]").attr("disabled",true);}if(!ResUtils.canShow("csEntity.button.viewFollowSub")){$(".followRecordLi").remove();$("#followRecordTab").remove();
}if(!ResUtils.canShow("csEntity.button.viewOrderSub")){$(".csOrderLi").remove();$("#orderTab").remove();}if(!ResUtils.canShow("csEntity.button.viewCallRecordSub")){$(".csllRecordLi").remove();
$("#callRecordTab").remove();}if(!ResUtils.canShow("csEntity.button.viewSmsRecordSub")){$(".smsRecordLi").remove();$("#messageRecordTab").remove();}if(!ResUtils.canShow("csEntity.button.addWxByPhoneSub")){$(".addWeixinFriend").hide();
}if(!ResUtils.canShow("csEntity.button.batchCallSub")){$(".csEntityBatchCall").hide();}$(".downDiv").find("li:eq(0)").addClass("active");$(".downDiv").find(".tab-pane").first().addClass("active").addClass("in").show();
$(".downDiv").find("li:eq(0)").trigger("click");if(!ResUtils.canShow("csEntity.button.csDescSub")){$("textarea[name=desc]").attr("disabled",true);}else{$("textarea[name=desc]").attr("disabled",false);
}}else{if("task"==type){$(".placePointOrder").parents("li").hide();$(".changRelEmployee").hide();$(".sendEmail").hide();$(".viewWeixin").remove();this.addPhone=false;
if(!ResUtils.canShow("csEntity.button.saveEdit")&&!ResUtils.canShow("csEntity.button.saveEditSub")){$(".saveBtn").hide();}if(!ResUtils.canShow("csEntity.button.placeOrderTask")){$(".placeOrder").hide();
}else{$(".placeOrder").show();}if(!ResUtils.canShow("csEntity.button.combineTask")){$(".combineCs").hide();$(".moreBtn").hide();}if(!ResUtils.canShow("csEntity.button.createSubCsEntityTask")){$(".createSubCsEntity").hide();
}if(!ResUtils.canShow("csEntity.button.changeAddrTask")){this.changeAddr=false;}if(!ResUtils.canShow("csEntity.button.viewFollowTask")){$(".followRecordLi").remove();
$("#followRecordTab").remove();}if(!ResUtils.canShow("csEntity.button.viewOrderTask")){$(".csOrderLi").remove();$("#orderTab").remove();}if(!ResUtils.canShow("csEntity.button.viewCallRecordTask")){$(".csllRecordLi").remove();
$("#callRecordTab").remove();}if(!ResUtils.canShow("csEntity.button.viewSmsRecordTask")){$(".smsRecordLi").remove();$("#messageRecordTab").remove();}$(".downDiv").find("li:eq(0)").addClass("active");
$(".downDiv").find(".tab-pane").first().addClass("active").addClass("in").show();$(".downDiv").find("li:eq(0)").trigger("click");}else{if("callRecord"==type){if(!ResUtils.canShow("csEntity.button.saveEdit")&&!ResUtils.canShow("csEntity.button.saveEditSub")){$(".saveBtn").hide();
}$(".placePointOrder").parents("li").hide();$(".changRelEmployee").hide();$(".sendEmail").hide();$(".soAfterList").hide();$(".viewWeixin").remove();$(".viewEmail").remove();
this.addPhone=false;if(!ResUtils.canShow("csEntity.button.placeOrderCallRecord")){$(".placeOrder").hide();}else{$(".placeOrder").show();}if(!ResUtils.canShow("csEntity.button.combineCallRecord")){$(".combineCs").hide();
$(".moreBtn").hide();}if(!ResUtils.canShow("csEntity.button.createSubCsEntityRecord")){$(".createSubCsEntity").hide();}if(!ResUtils.canShow("csEntity.button.changeAddrCallRecord")){this.changeAddr=false;
}if(!ResUtils.canShow("csEntity.button.viewFollowCallRecord")){$(".followRecordLi").remove();$("#followRecordTab").remove();}if(!ResUtils.canShow("csEntity.button.viewOrderCallRecord")){$(".csOrderLi").remove();
$("#orderTab").remove();}if(!ResUtils.canShow("csEntity.button.viewCallRecordCallRecord")){$(".csllRecordLi").remove();$("#callRecordTab").remove();}if(!ResUtils.canShow("csEntity.button.viewSmsRecordCallRecord")){$(".smsRecordLi").remove();
$("#messageRecordTab").remove();}$(".downDiv").find("li:eq(0)").addClass("active");$(".downDiv").find(".tab-pane").first().addClass("active").addClass("in").show();
$(".downDiv").find("li:eq(0)").trigger("click");}else{$(".placePointOrder").parents("li").hide();$(".changRelEmployee").hide();$(".sendEmail").hide();$(".viewWeixin").remove();
$(".viewEmail").remove();this.addPhone=false;if(!ResUtils.canShow("csEntity.button.saveEdit")&&!ResUtils.canShow("csEntity.button.saveEditSub")){$(".saveBtn").hide();
}if(!ResUtils.canShow("csEntity.button.placeOrderSearch")){$(".placeOrder").hide();}else{$(".placeOrder").show();}if(!ResUtils.canShow("csEntity.button.combineSearch")){$(".combineCs").hide();
$(".moreBtn").hide();}if(!ResUtils.canShow("csEntity.button.createSubCsEntitySearch")){$(".createSubCsEntity").hide();}if(!ResUtils.canShow("csEntity.button.changeAddrSearch")){this.changeAddr=false;
}if(!ResUtils.canShow("csEntity.button.viewFollowSearch")){$(".followRecordLi").remove();$("#followRecordTab").remove();}if(!ResUtils.canShow("csEntity.button.viewOrderSearch")){$(".csOrderLi").remove();
$("#orderTab").remove();}if(!ResUtils.canShow("csEntity.button.viewCallRecordSearch")){$(".csllRecordLi").remove();$("#callRecordTab").remove();}if(!ResUtils.canShow("csEntity.button.viewSmsRecordSearch")){$(".smsRecordLi").remove();
$("#messageRecordTab").remove();}this.canViewPhone=false;$(".downDiv").find("li:eq(0)").addClass("active");$(".downDiv").find(".tab-pane").first().addClass("active").addClass("in").show();
$(".downDiv").find("li:eq(0)").trigger("click");if(a.isDelete=="1"){$(".saveBtn").hide();$(".placeOrder").hide();}}}}}if(ResUtils.canShow("csEntity.button.csListShowSrc")){$(".csDetailSrcDiv").show();
}if("y"==a.isSub){$(".createSubCsEntity").hide();}},_bindEventHander:function(){var a=this;$(document).on("click",".add-cs-tags",function(){$(this).closest(".jt-params-tag").find(".plusBtn").trigger("click");
});$(document).on("click",".questionNaire",function(){var c=$("#csEntityForm").find("input[name=id]").val();var b=$("#csEntityForm").find("input[name=name]").val();
JTTabUtils.addOrRefreshTab(ctx+"/cs/questionnaire/questionnaireResult/toCsQustionnaire.htm?csId="+c,"问卷["+b+"]");});$("body").on("click",".toLinkMainCs",function(){var b=$(this).attr("mainCsId");
var c=$(this).attr("mainCsCode");if(!c){DialogUtils.error(msgCode.ERROR,"客户不存在,可能已被删除,请通过查询进入");return;}var d="客户["+c+"]";JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/toEdit.htm?type=search&csId="+b,d);
});$("body").on("click",".soTab",function(){var h=$(this).attr("attr-count");if(h==1){var g=$(this).attr("attr-id");var i=$("#csEntityForm").find("[name=name]").val();
var f=$(this).attr("value");var e=$(this).attr("attr-placerId");var b=$(this).attr("attr-status");var d=ResUtils.canShow("mySoEntity.button.showScTrackNo")?"can":"cannot";
if("awaiting_post"==b&&e==currentUserId){JTTabUtils.addOrRefreshTab(CsOrder._CONS_.PLACE_PAGE_URL+"?soId="+g,"订单["+f+"]提交");}else{if("awaiting_comfirm"==b&&ResUtils.canShow("soEntityComfirm.url")&&a.permissionType&&("self"==a.permissionType||"mysub"==a.permissionType)&&ResUtils.canShow("soEntity.button.comfirm")){JTTabUtils.addOrRefreshTab(CsOrder._CONS_.COMFIRM_PAGE_URL+"?soId="+g,"订单["+f+"审核");
}else{if("shipping"==b&&ResUtils.canShow("soEntity.url")&&a.permissionType&&("self"==a.permissionType||"mysub"==a.permissionType)){JTTabUtils.addOrRefreshTab(CsOrder._CONS_.FOLLOW_PAGE+"?soId="+g+"&soNo="+f,"订单["+f+"]跟进");
}else{JTTabUtils.addOrRefreshTab(CsOrder._CONS_.SO_DETAIL_PAGE_URL+"?soNo="+f+"&canShowScTrankNo="+d,i+"的订单明细");}}}}else{var c=$(this).attr("attr-csId");
if(c){layer.open({type:1,title:"3天内订单列表",btn:"关闭",maxmin:false,shadeClose:true,area:["60%","40%"],content:'<div class="col-sm-12 jqGrid_wrapper"><table id="threeDayOrderTab" class="table"></table></div>',success:function(j,k){a._loadOrderList(c);
}});}}});$("body").on("click",".mySoTab",function(){var c=$(this).attr("value");var d=$(this).attr("csNameVal");var b=ResUtils.canShow("mySoEntity.button.showScTrackNo")?"can":"cannot";
if(c&&c!=""){JTTabUtils.addOrRefreshTab(ctx+"/ec/salesorder/soEntity/detail.htm?soNo="+c+"&canShowScTrankNo="+b,d+"的订单明细");}});$(document).on("click",".increateYouZanPoint",function(c){var b=$("#csEntityForm").find("[name=id]").val();
FormUtils.loadData(ctx+"/crm/cs/csEntity/increateYouzanPoint.htm?ids="+b,function(d){});});$(document).on("click",".giveCashBtn",function(c){var d=$("#csEntityForm").find("[name=id]").val();
$("#giveCashModalContainer").modal("show");$(".cashPicture").hide();CashSettingUtils.getOptions({container:"cashSearch",caption:"请选择"});var b=new UploadImageUtil();
b.getOptions("cashPictureSearch");});$(document).on("change",".cashSearch",function(c){var b=$(".cashSearch").val();if(b){FormUtils.loadData(ctx+"/gl/cash/cashSetting/edit.htm?id="+b,function(d){$("input[name=cashMoney]").val(d.money);
$(".cashInfo").text("面值：￥"+d.money+"    剩余可赠送数量："+d.giveCount);if(d.cashHiPos&&d.cashHiPos.length>0){$("input[name=cashCode]").val(d.cashHiPos[0].code);
$("input[name=cashHiId]").val(d.cashHiPos[0].id);}});}else{$(".cashInfo").text("");$("input[name=cashMoney]").val("");$("input[name=cashCode]").val("");
$("input[name=cashHiId]").val("");}});$(document).on("change",".cashPictureSearch",function(b){if($(this).val()){$(".cashPicture").show();$(".cashPicture").attr("src",ctx+$(this).val());
}else{$(".cashPicture").hide();$(".cashPicture").attr("src","");}});$(document).on("click","#cashBindCs",function(f){var c=$("input[name=id]").val();var d=$("input[name=cashHiId]").val();
var b=$(".cashPictureSearch").val();if(d&&b){FormUtils.submit(ctx+"/gl/cash/cashHi/bindCs.htm","csId="+c+"&cashHiId="+d,function(e){if(e.success){DialogUtils.success(msgCode.SUCCESS,e.msg);
}else{DialogUtils.error(msgCode.ERROR,e.msg);}});FormUtils.loadData(ctx+"/gl/image/image/imageAddWord.htm?path="+b+"&cashCode="+$("input[name=cashCode]").val()+"&cashMoney="+$("input[name=cashMoney]").val(),function(e){$(".cashPicture").attr("src",ctx+e.msg);
});}else{DialogUtils.error(msgCode.ERROR,"没有可选择的现金券或者底图");}});$(document).on("click",".jt-lager-img",function(c){var b=[];$(this).parent().parent().find("img").each(function(d,f){b.push({title:"大图",href:$(this).attr("src")});
});$.fancybox(b);});$(".fastLoginBtn").on("click",function(){var b=ctx+"/crm/cs/csEntity/fastLoginBtn.htm";FormUtils.submit(b,function(c){if(c.success){JTTabUtils.addOrRefreshTab(c.msg,"傲融系统");
}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});});$("#seniorSearch").on("click",function(){if($(this).text().indexOf("展开更多")!=-1){$("#seniorSearchDiv").slideDown("fast",function(){});
$(this).empty().append('收起更多<span class="fa fa-sort-up"></span>');$(".hideSearchParam").stop().slideDown();$(".mutipleSelectEavAttr").chosen("destroy").chosen();
}else{$(this).empty().append('展开更多<span class="fa fa-sort-down"></span>');$("#seniorSearchDiv").slideUp("fast");$(".hideSearchParam").stop().slideUp();
}});$(document).on("click",".saveBtn",function(){a._saveEdit(function(){});});$(document).on("click",".viewWeixin",function(){var b=$("input[name='weixin']").val();
var c=$("#id").val();a._descryptWeixin(b,"viewWeixin",c,function(d){$("input[name='maskWeixin'").val(d);});});$(document).on("click",".viewEmail",function(){var b=$("input[name='email']").val();
var c=$("#id").val();a._descryptEmail(b,"viewEmail",c,function(d){$("input[name='maskEmail'").val(d);});});$(document).on("click",".maskEmail",function(){if($(".maskEmail").val().indexOf("*")>0){$(this).val("");
}});$(document).on("focus",".maskWeixin",function(){if($(".maskWeixin").val().indexOf("*")>0&&!$(this).attr("readonly")==true){$(this).val("");}});$(document).on("click",".preCs",function(){var b=$("#preId").val();
if(b==""||b=="null"){DialogUtils.error("提示","点击过快！！！！");return false;}if(a.isEdit){a._saveEdit(function(){if(b){window.location.href=ctx+"/crm/cs/csEntity/toEdit.htm?type="+type+"&csId="+b;
}});}else{window.location.href=ctx+"/crm/cs/csEntity/toEdit.htm?type="+type+"&csId="+b;}});$(document).on("click",".nextCs",function(){var b=$("#nextId").val();
if(b==""||b=="null"){DialogUtils.error("提示","点击过快！！！！");return false;}if(a.isEdit){a._saveEdit(function(){if(b){window.location.href=ctx+"/crm/cs/csEntity/toEdit.htm?type="+type+"&csId="+b;
}});}else{window.location.href=ctx+"/crm/cs/csEntity/toEdit.htm?type="+type+"&csId="+b;}});$(document).on("click",".placeOrder",function(){var b=$(this);
ConfigUtils.findByKey("soEntityPlace.forbidPlaceOrderTime",function(h){if(h.msg==null){a._placeGeneralOrderMethod(b,a);return;}else{if(h.msg!=null&&h.msg.trim()==""){a._placeGeneralOrderMethod(b,a);
return;}var g=h.msg;var e=g.split("-");if(e.length!=2){DialogUtils.error("提示","禁止下单时段参数格式有误！");return;}var c=e[0].trim();var d=e[1].trim();if(c.length!=5||d.length!=5){DialogUtils.error("提示","禁止下单时段参数格式有误！");
return;}var f=DateUtils.timeRangeJudge(c,d);if(!f){a._placeGeneralOrderMethod(b,a);return;}else{DialogUtils.error("提示","该时段("+h.msg+")禁止下单！");return;}}});
});$(document).on("click",".sendEmail",function(){JTTabUtils.addOrRefreshTab(CsEntityEdit._CONS_.SEND_MAIL+"?customerId="+$("#csEntityForm").find("[name=id]").val(),"发送邮件");
});$(document).on("click",".placePointOrder",function(){var b=$(this);ConfigUtils.findByKey("soEntityPlace.forbidPlaceOrderTime",function(h){if(h.msg==null){a._placePointsOrderMethod(b,a);
return;}else{if(h.msg!=null&&h.msg.trim()==""){a._placePointsOrderMethod(b,a);return;}var g=h.msg;var e=g.split("-");if(e.length!=2){DialogUtils.error("提示","禁止下单时段参数格式有误！");
return;}var c=e[0].trim();var d=e[1].trim();if(c.length!=5||d.length!=5){DialogUtils.error("提示","禁止下单时段参数格式有误！");return;}var f=DateUtils.timeRangeJudge(c,d);
if(!f){a._placePointsOrderMethod(b,a);return;}else{DialogUtils.error("提示","该时段("+h.msg+")禁止下单！");return;}}});});$("body").on("click",".weixinChatBtn",function(){if(weixinUseType=="android"){a._initANdroidchat();
}else{a._initWebchat();}});$("[name=maskEmail]").on("change",function(){var b=$(this).val();$("[name=email]").val(b);});$("[name=maskWeixin]").on("change",function(){var b=$(this).val();
$("[name=weixin]").val(b);});$(document).on("click",".createSubCsEntity",function(){var e=$(CsEntityEdit._CONS_.FORM_ID).find("[name=id]").val();var b=$(CsEntityEdit._CONS_.FORM_ID).find("[name=isSub]").val();
var d={csId:e,};var c=new CreateForSub();c.init(d);});$(document).on("click",".combineCs",function(){$("#radio1").trigger("click");$("#chooseCsValue").val(1);
$("#customer2Id").val("");$("#customer2Info").val("");a.layerIndex=layer.open({type:1,title:"合并客户资料",shadeClose:false,btn:["提交合并","关闭"],area:["650px","500px"],scrollbar:false,content:$(".combineCsDiv"),yes:function(d,b){var c="";
var e="";var f=$("#chooseCsValue").val();if("1"==f){c=$("[name=id]").val();e=$("#customer2Id").val();}else{c=$("#customer2Id").val();e=$("[name=id]").val();
}if(c&&e){a.combineCs(c,e);}else{DialogUtils.error("失败","请先选择客户2的资料再进行合并");}}});});$(document).on("click","[name=chooseCs]",function(){$("#chooseCsValue").val($(this).val());
});$("ul.dropdown-menu").on("click","li",function(){$(this).parents(".dropdown").children("a").eq(0).empty().append($(this).text()+'<b class="caret"></b>');
});$(document).on("click",".chooseCsForCombine",function(){var c={selectedMulti:false,callBack:function(d){if(d!=null){$("#customer2Id").val(d[0].id);$("#customer2Info").val(d[0].code+"("+d[0].name+")");
}},type:"search"};var b=new CustomerSelect();b.init(c);});$(document).on("click",".soAfterList",function(){var b=$(CsEntityEdit._CONS_.FORM_ID).find("[name=id]").val();
var c=$(CsEntityEdit._CONS_.FORM_ID).find("[name=name]").val();JTTabUtils.addOrRefreshTab(CsEntityEdit._CONS_.ORDER_AFTER_LIST_URL+"?csId="+b,"客户["+c+"]退换货订单");
});$(document).on("click",".tabLi",function(){var b=$(CsEntityEdit._CONS_.FORM_ID).find("[name=id]").val();var e=$(CsEntityEdit._CONS_.FORM_ID).find("[name=employeeId]").val();
var d=$(CsEntityEdit._CONS_.FORM_ID).find("[id=permissionType]").val();var c=$(this).attr("attr-id");if("statistic"==c){a._fillOtherStatisticalInfo();a.statisticInfo.init(b);
$("#csInfoRfmtLi").trigger("click");}else{if("complain"==c&&!a.complainInit){a.complainInit=true;a._fillComplain(b,e,d);}else{if("levelChange"==c&&!a.levelChange){a.levelChange=true;
a._fillLevelChange(b);if(isNewPage){a._fillPointLogTab(b);}}else{if("email"==c&&!a.emailInit){a.emailInit=true;a._fillMailHistoryTab(b);}else{if("csOrder"==c&&!a.csOrderInit){a.csOrderInit=true;
a._fillOrderInfo(b,e,d);}else{if("callRecord"==c&&!a.callRecordInit){a.callRecordInit=true;a._initCallRecord(b,e,d);}else{if("smsRecord"==c&&!a.smsRecordInit){a.smsRecordInit=true;
a._fillSmsRecordTab(b);}else{if("csMeeting"==c&&!a.financeMeetingInit){a.financeMeetingInit=true;a._fillFinanceMeeting(b);}else{if("csContract"==c&&!a.financeContractInit){a.financeContractInit=true;
a._fillFinanceContract(b);}else{if("csTurnover"==c&&!a.financeTurnoverInit){a.financeTurnoverInit=true;a._fillFinanceTurnover(b);}else{if("csCashHi"==c&&!a.csCashHiInit){a.csCashHiInit=true;
a._csCashHi(b);}else{if("limit"==c&&!a.csLimitInit){a.csLimitInit=true;a._fillCsLimitTab(b);}else{if("csInfoOrderLi"==c){a.statisticInfo.init();}}}}}}}}}}}}}if(!isNewPage){if("point"==c&&!a.pointLogInit){a.pointLogInit=true;
a._fillPointLogTab(b);}}});$(document).on("click",".bindWx",function(){a.layerIndex=layer.open({type:1,title:"绑定微信",shadeClose:false,btn:["绑定","关闭"],area:["600px","450px"],scrollbar:false,content:$(".bindWxPanel"),success:function(b,d){var c=ctx+"/gl/cs/weiXinFriends/findByNickName.htm";
FormUtils.loadData(c+"?nickName="+$(CsEntityEdit._CONS_.FORM_ID+" input[name='name']").val(),function(e){var g=new StringBuffer();for(var f=0;f<e.length;
f++){g.append("<tr>").append("<td>").append("<input type='checkbox' class='bindWxCheckbox' user-name='"+e[f].userName+"'>").append("</td>").append("<td>").append(e[f].nickName).append("</td>").append("<td>").append(e[f].employeeNickName).append("</td>").append("<td>").append(e[f].lastReplyContent).append("</tr>");
}$("#wait-bind-friends").empty().append(g.toString());});},yes:function(d,c){var b=$(".bindWxCheckbox:checked");if(b.length>0){var e=$(b[0]).attr("user-name");
var f=$(CsEntityEdit._CONS_.FORM_ID+" input[name='csCode']").val();a._bindWx(e,f,d);}else{DialogUtils.error(msgCode.ERROR,"请选择微信好友");}}});});$(document).on("click",".bindWxCheckbox",function(){if(this.checked){var b=$(".bindWxCheckbox");
for(var c=0;c<b.length;c++){b[c].checked=false;}this.checked=true;}});$(document).on("click",".claimCsSea",function(){DialogUtils.confirmWithOptions({title:"确认要领取的客户吗？",text:"",confirmButtonText:"确认",yesFunc:function(){a._claimCsSea($("#id").val());
}});});$(document).on("click",".csEntityRecycle",function(){DialogUtils.confirmWithOptions({title:"确认要回收选中的客户资料吗？",text:"",confirmButtonText:"确认",yesFunc:function(){a._batchRecycle($("#id").val());
}});});$(document).on("click",".csReturnsByIds",function(){DialogUtils.confirmWithOptions({title:"确认要归还的客户吗？",text:"",confirmButtonText:"确认",yesFunc:function(){a._csReturnsByIds($("#id").val());
}});});$(document).on("click",".csSeaChangeGroup",function(){$("input[name=selectedIds]").val($("#id").val());$("#changeGroupModalContainer").modal("show");
});$("body").on("click","#csSeaChangeGroupSave",function(){var b=$("input[name=selectedIds]").val();var c=$("input[name=groupId]").val();a._csSeaChangeGroup(b,c);
});$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='groupId']").val(),container:"groupName",nolimit:true,positionType:"dept_manager,cs_search",fn:function(c){$("input[name=groupId]").val(c);
}};GroupUtils.selectGroupTreeBox(b);});$("body").on("change","input",function(){var b=$(this).parents(".editFlag").attr("id");if(b){a.isEdit=true;}});$("body").on("change","select",function(){var c=$(this).attr("id");
if(c&&"systemTagSelect"==c){return;}var b=$(this).parents(".editFlag").attr("id");if(b){a.isEdit=true;}});$("body").on("change","textarea",function(){var b=$(this).parents(".editFlag").attr("id");
if(b){a.isEdit=true;}});$("body").on("click",".deletePhone",function(){var b=$(this).parents(".editFlag").attr("id");if(b){a.isEdit=true;}});$(".moreBtn").hover(function(b){if(!$(this).is(".currentDrop")){$(this).addClass("currentDrop").addClass("delayer").next().stop().slideDown("fast");
}},function(b){setTimeout(function(){if($(".currentDrop").length>0&&$(".delayer").length>0){$(".delayer").removeClass("delayer");}},1);});$(document).on("mouseover",function(b){if($(".currentDrop").length>0&&$(".delayer").length==0&&!$(b.target).is(".moreBtn,dropdown-menu,.dropdown-menu *")){$(".currentDrop").removeClass("currentDrop").next().stop().slideUp("fast");
}});$("body").on("click",".addWeixinFriend",function(){var b=$(this).attr("attr-num");a.layerIndex=layer.open({type:1,title:"添加微信好友",shadeClose:false,btn:["确定","关闭"],area:["500px","400px"],scrollbar:false,content:$(".showAddWeixinFriendPane"),success:function(c,e){var d=CsEntityEdit._CONS_.FIND_EMPLOYEE_WEIXIN+"?status=2&employeeId="+currentUserId;
FormUtils.loadData(d,function(f){var h=new StringBuffer();h.append("<option value=''>请选择</option>");if(f){for(var g=0;g<f.length;g++){h.append("<option nickname='"+f[g].nickName+"' value='"+f[g].userName+"'>"+f[g].alias+"("+f[g].nickName+")</option>");
}}$("#addEmployeeAlias").empty().append(h.toString());$("#addRemark").val("["+$("#csEntityForm input[name='csCode']").val()+"]_"+$("#csEntityForm input[name='name']").val());
});},yes:function(d,c){a._addWeixinFriend(b,d);}});});if(isNewPage){$(document).on("click",".csTagDown",function(){$(this).next().animate({top:["0px","swing"]},250);
$(this).animate({top:["25px","swing"]},250);if($(".tabView").attr("disabled")){$("#tagContainer").slideUp();$("#tagTableContainer").slideDown();}else{$("#tagContainer").slideDown();
$("#tagTableContainer").slideUp();}});$(document).on("click",".shrinkView",function(){$("#tagTableContainer").stop().slideUp("fast");$("#tagContainer").stop().slideDown("fast");
$(this).css("color","#337ab7");$(".tabView").css("color","#c2c2c2");$(".tabView").attr("disabled",false);$(".shrinkView").attr("disabled",true);$(".mutipleSelectEavAttr").chosen("destroy").chosen();
});$(document).on("click",".tabView",function(){$("#tagContainer").stop().slideUp("fast");$("#tagTableContainer").stop().slideDown("fast");$(this).css("color","#337ab7");
$(".shrinkView").css("color","#c2c2c2");$(".tabView").attr("disabled",true);$(".shrinkView").attr("disabled",false);if(!a.eavInit){a.eavInit=true;a._fillEavTag($("input[name=id]").val());
}});$("#addEmployeeAlias").on("change",function(){var b=$($("#addEmployeeAlias option:selected")[0]).attr("nickname");$("#addSendWords").val("您好！我是"+b);
});$(document).on("click",".copyCsBtn",function(){$("#csCodeText").select();document.execCommand("Copy");DialogUtils.success(msgCode.INFO,"复制成功");});$(".showEmployeeWeixin").on("click",function(){a.layerIndex=layer.open({type:1,title:"员工微信",shadeClose:false,btn:["确定","关闭"],area:["500px","300px"],scrollbar:false,content:$(".showEmployeeWeixinPanel"),success:function(b,d){var c=ctx+"/gl/ou/employeeWeiXin/getByWeiXin.htm?weixin="+$(CsEntityEdit._CONS_.FORM_ID+" input[name='employeeWeixin']").val();
if(weixinUseType=="android"){c=ctx+"/gl/ou/employeeWeiXin/getByFriendCode.htm?friendCode="+$(CsEntityEdit._CONS_.FORM_ID+" input[name='csCode']").val();
}FormUtils.loadData(c,function(e){var f=new StringBuffer();if(e!=null&&e!=""&&e.id){f.append("<tr>").append("<td>").append(e.employeeAid+":"+e.employeeName).append("</td>").append("<td>");
if(weixinUseType=="android"){f.append(e.alias);}else{f.append(e.weixin);}f.append("</td>").append("<td>").append(e.nickName).append("</td>").append("<td>").append(e.nickNameRemark).append("</td>").append("<td>").append(e.status=="0"?"离线":"在线").append("</td>").append("</tr>");
}$("#employee-weixin-list").empty().append(f.toString());});},yes:function(c,b){layer.close(c);}});});}},_claimCsSea:function(c){var a=this;var b=ctx+"/crm/cs/csEntitySea/claimCsSea.htm";
FormUtils.submit(b,{"ids":c},function(d){if(d.success){DialogUtils.success(msgCode.INFO,"客户领取成功");window.location.href=ctx+"/crm/cs/csEntity/toEdit.htm?type="+type+"&csId="+csId;
}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);}});},_batchRecycle:function(c){var a=this;var b=ctx+"/crm/cs/csEntity/batchRecycle.htm";FormUtils.submit(b,{"ids":c},function(d){if(d.success){DialogUtils.success(msgCode.INFO,"客户资料回收成功");
window.location.href=ctx+"/crm/cs/csEntity/toEdit.htm?type="+type+"&csId="+csId;}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);}});},_csReturnsByIds:function(c){var a=this;
var b=ctx+"/crm/cs/csEntitySea/csReturnByIds.htm";FormUtils.submit(b,{"ids":c},function(d){if(d.success){DialogUtils.success(msgCode.INFO,d.msg);window.location.href=ctx+"/crm/cs/csEntity/toEdit.htm?type="+type+"&csId="+csId;
}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);}});},_csSeaChangeGroup:function(d,c){var a=this;var b=ctx+"/crm/cs/csEntitySea/csSeaChangeGroup.htm";FormUtils.submit(b,{"ids":d,"groupId":c},function(e){if(e.success){DialogUtils.success(msgCode.INFO,"客户转移成功");
$("#changeGroupModalContainer").modal("hide");window.location.href=ctx+"/crm/cs/csEntity/toEdit.htm?type="+type+"&csId="+csId;}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);
}});},_bindWx:function(c,d,b){var a=ctx+"/gl/cs/weiXinFriends/bindWx.htm";FormUtils.loadData(a+"?userName="+c+"&friendCode="+d,function(e){if(e.success){DialogUtils.success(msgCode.SUCESS,e.msg);
layer.close(b);$(".bindWx").hide();}else{DialogUtils.error(msgCode.ERROR,e.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},_descryptWeixin:function(a,d,b,c){$.ajax({type:"GET",url:CsEntityEdit._CONS_.DESCRYPT_WEIXIN+"?encryNum="+a+"&type="+d+"&id="+b,contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(e){if(e.success&&c&&typeof c=="function"){c(e.msg);
}}});},_descryptEmail:function(a,d,b,c){$.ajax({type:"GET",url:CsEntityEdit._CONS_.DESCRYPT_EMAIL+"?encryNum="+a+"&type="+d+"&id="+b,contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(e){if(e.success&&c&&typeof c=="function"){c(e.msg);
}}});},loadData:function(b){var a=this;FormUtils.loadData(CsEntityEdit._CONS_.EDIT_URL+"?id="+b+"&type="+type,function(c){a.data=c;a._fillBaseInfo(c);a._hideNotGrantedBtn(c.permissionType,c);
if(c.permissionType&&("self"==c.permissionType||"mysub"==c.permissionType)){}else{a.isDetail=true;a._disableForDetail();}a._fillStatisticalInfo(c);a._fillPhoneInfo(c);
a._fillCommunication(c);a._fillFollowRecordTab(c,{partyId:c.employeeId,partyAid:c.employeeAid,partyName:c.employeeName});a._fillAddrInfo(c);a._fillOtherInfo(c);
a._initTabName(c);a._loadThreeDaysOrder(c);a._initWxchat(c);a._finleCsEntittyFinance(c);if(isNewPage){a._fillEavInfo(b);$(".hideSearchParam").hide();if(!a.eavInit){a.eavInit=true;
a._fillEavTag($("input[name=id]").val());}}});},_finleCsEntittyFinance:function(b){var a=b.csEntityFinancePo;if(a!=""&&a!=null){$("#csEntityForm select[name='csEntityFinancePo.marry']").val(a.marry);
$("#csEntityForm input[name='csEntityFinancePo.investmentExperience']").val(a.investmentExperience);$("#csEntityForm input[name='csEntityFinancePo.investmentPreference']").val(a.investmentPreference);
$("#csEntityForm input[name='csEntityFinancePo.investmentRate']").val(a.investmentRate);$("#csEntityForm select[name='csEntityFinancePo.finalCallState']").val(a.finalCallState);
$("#csEntityForm select[name='csEntityFinancePo.hasInvestmentExperience']").val(a.hasInvestmentExperience);$("#csEntityForm input[name='csEntityFinancePo.expectedRate']").val(a.expectedRate);
$("#csEntityForm textarea[name='csEntityFinancePo.communicationContent']").val(a.communicationContent);$("#csEntityForm input[name='csEntityFinancePo.meetingTime']").val(a.meetingTime);
}},_loadThreeDaysOrder:function(e){var b=this;var c=e.lastFollowTime;var a=e.follow;var d=e.soTotal;$.ajax({type:"GET",url:CsEntityEdit._CONS_.LOAD_THREEDAYS_ORDER+"?csId="+e.id,contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(f){b._fillTip(f,c,a,d);
}});},_fillOtherStatisticalInfo:function(){var a=$(CsEntityEdit._CONS_.FORM_ID).find("[name=id]").val();this.statisticInfo.fillOtherInfo(a);},_fillStatisticalInfo:function(a){this.statisticInfo.fillInfo(a);
},_fillBaseInfo:function(e){var c=this;$(CsEntityEdit._CONS_.FORM_ID).find("[name=id]").val(e.id);$(CsEntityEdit._CONS_.FORM_ID).find("[name=csCode]").val(e.code);
if(e.gender=="男"){$("#genderMan").val("男");$("#genderMan").attr("checked",true);$("#genderWomen").attr("checked",false);}else{if(e.gender=="女"){$("#genderWomen").val("女");
$("#genderMan").attr("checked",false);$("#genderWomen").attr("checked",true);}}$(CsEntityEdit._CONS_.FORM_ID).find("[name=controlNo]").val(e.controlNo);
$(CsEntityEdit._CONS_.FORM_ID).find("[name=canPlaceSo]").val(e.canPlaceSo);$(CsEntityEdit._CONS_.FORM_ID).find("[name=isOrderSo]").val(e.isOrderSo);$(CsEntityEdit._CONS_.FORM_ID).find("[name=income]").val(e.income);
$(CsEntityEdit._CONS_.FORM_ID).find("[name=isTurnover]").val(e.isTurnover);$(CsEntityEdit._CONS_.FORM_ID).find("[name=isMeeting]").val(e.isMeeting);$(CsEntityEdit._CONS_.FORM_ID).find("[name=isIntention]").val(e.isIntention);
$(CsEntityEdit._CONS_.FORM_ID).find("[name=passTime]").val(e.passTime);$(CsEntityEdit._CONS_.FORM_ID).find("[name=degree]").val(e.degree);$(CsEntityEdit._CONS_.FORM_ID).find("[name='name']").val(e.name);
$(CsEntityEdit._CONS_.FORM_ID).find("#searchProd").val(e.productName);$(CsEntityEdit._CONS_.FORM_ID).find("[name='nickName']").val(e.nickName);$(CsEntityEdit._CONS_.FORM_ID).find("[name='isSub']").val(e.isSub);
$(CsEntityEdit._CONS_.FORM_ID).find("[name='mainCsId']").val(e.mainCsId);if(!c.changeName){$(CsEntityEdit._CONS_.FORM_ID).find("[name='name']").attr("readonly",true);
}ConfigUtils.findByKey("csEntity.limit.wineIndustry",function(f){if(f.msg=="y"){$("#csEntityForm .heightWeightDiv").hide();$("#csEntityForm .wineIndustry").show();
$(CsEntityEdit._CONS_.FORM_ID).find("[name=purpose]").val(e.purpose);$(CsEntityEdit._CONS_.FORM_ID).find("[name=taste]").val(e.taste);}else{if(versionType=="finance"){$("#csEntityForm .heightWeightDiv").hide();
}else{$("#csEntityForm .heightWeightDiv").show();}$("#csEntityForm .wineIndustry").hide();$(CsEntityEdit._CONS_.FORM_ID).find("[name=weight]").val(e.weight);
$(CsEntityEdit._CONS_.FORM_ID).find("[name=height]").val(e.height);}});$(CsEntityEdit._CONS_.FORM_ID).find("[name='ipLocations']").val(e.ipLocations);$(CsEntityEdit._CONS_.FORM_ID).find("[name=weixin]").val(e.weixin);
$(CsEntityEdit._CONS_.FORM_ID).find("[name=maskWeixin]").val(e.maskWeixin);if(e.birthday){var a=e.birthday.split("-");$("#birthYear").val(a[0]);$("#birthMonth").val(a[1]);
$("#birthDay").val(a[2]);if(a[0]){var b=(new Date()).getFullYear()-a[0];$("#age").val(b);}}$(CsEntityEdit._CONS_.FORM_ID).find("[name=maritalStatus]").val(e.maritalStatus);
$(CsEntityEdit._CONS_.FORM_ID).find("[name=vocation]").val(e.vocation);$(CsEntityEdit._CONS_.FORM_ID).find("[name=email]").val(e.email);$(CsEntityEdit._CONS_.FORM_ID).find("[name=maskEmail]").val(e.maskEmail);
if(e.maskEmail==null||e.maskEmail==""){$(".sendEmail").hide();}if(ResUtils.canShow("csEntity.button.viewDesc")){$(CsEntityEdit._CONS_.FORM_ID).find("[name='desc']").val(e.desc);
}else{$(CsEntityEdit._CONS_.FORM_ID).find("[name='desc']").val(MaskPhoneNum.maskDesc(e.desc));var d=(e.desc).match(/1\d{10}/g);$("#descPhone").val(d);}$("input[name=employeeId]").val(e.employeeId);
$("input[name=employeeShow]").val(e.employeeAid+"："+e.employeeName);$("input[name=createByInfo]").val(e.createByEmployeeAid+"："+e.createByEmployeeName);
$("input[id=permissionType]").val(e.permissionType);if(e.preId){$("#csEntityForm").find("[name=preId]").val(e.preId);}else{$(".preCs").hide();}if(e.nextId){$("#csEntityForm").find("[name=nextId]").val(e.nextId);
}else{$(".nextCs").hide();}if(e.isDelete!="0"&&ResUtils.canShow("csEntityRecycle.button.recycle")){$(".csEntityRecycle").show();}if(e.isSea!="n"&&e.permissionType=="mysub"&&ResUtils.canShow("csEntitySea.button.claimCsSea")){$(".claimCsSea").show();
}if(e.isSea!="n"&&e.permissionType=="mysub"&&ResUtils.canShow("csEntitySea.button.csSeaChangeGroup")){$(".csSeaChangeGroup").show();}if(e.isSea!="n"&&e.permissionType=="self"&&ResUtils.canShow("csEntitySea.button.csReturnsByIds")){$(".csReturnsByIds").show();
}if(e.isSea=="y"){$(".changRelEmployee").hide();}ConfigUtils.findByKey("csEntity.limit.wineIndustry",function(f){if(f.success){$(".aboutJD").show();$(".canPlaceSoDiv").hide();
$(".noDiv").hide();$("input[name=jdPoint]").val(e.jdPoint);}});setTimeout(function(){c.formFrontConfig.init();},1);},_fillCommunication:function(b){var a=this;
CsEntityUtils.channelSelectTimer=setInterval(function(){if(CsEntityUtils.isInitChannelSelect){if(b.srcs){$("#srcs").val(b.srcs.split(",")).trigger("chosen:updated");
}else{$("#srcs").val("").trigger("chosen:updated");}if(!a.changeSrcs){$("#srcs").attr("disabled",true);}clearInterval(CsEntityUtils.channelSelectTimer);
CsEntityUtils.channelSelectTimer=null;}},250);CsEntityUtils.employeeWxTimer=setInterval(function(){if(CsEntityUtils.isInitEmployeeWx){$("#employeeWeixin").selectpicker();
$("#employeeWeixin").selectpicker("refresh");if(b.employeeWeixin){$("#employeeWeixin").selectpicker("val",b.employeeWeixin);}else{$("#employeeWeixin").selectpicker("val",[]);
}clearInterval(CsEntityUtils.employeeWxTimer);CsEntityUtils.employeeWxTimer=null;}},250);CsEntityUtils.interestsTimer=setInterval(function(){if(CsEntityUtils.isInitInterests){$("#interests").selectpicker();
$("#interests").selectpicker("refresh");if(b.interests){var c=b.interests.split(",");$("#interests").selectpicker("val",c);}else{$("#interests").selectpicker("val",[]);
}clearInterval(CsEntityUtils.interestsTimer);CsEntityUtils.interestsTimer=null;}},250);$(CsEntityEdit._CONS_.FORM_ID).find("select[name=bizType]").val(b.bizType);
$(CsEntityEdit._CONS_.FORM_ID).find("select[name=follow]").val(b.follow).attr("disabled",true);$(CsEntityEdit._CONS_.FORM_ID).find("select[name=entry]").val(b.entry);
},_fillFollowRecordTab:function(b,a){var c={csId:b.id,employeeId:b.employeeId,entityId:"",csCode:b.code,needTable:true,followType:"cs",csType:type,permissionType:b.permissionType,contentExt:"",fn:function(){if(b.isDelete=="1"){$(".addFollow").hide();
}}};this.csFollow.init(c,a);this.csFollow._initEmployeeSuggest();},_csCashHi:function(b){var a={csId:b,csType:type,permissionType:type};this.csCashHi.init(a);
},_fillFinanceMeeting:function(b){var a={csId:b,csType:type,permissionType:type};this.financeMeeting.init(a);},_fillFinanceContract:function(b){var a={csId:b,csType:type,permissionType:type};
this.financeContract.init(a);},_fillFinanceTurnover:function(b){var a={csId:b,csType:type,permissionType:type};this.financeTurnover.init(a);},_initCallRecord:function(b,d,c){var a={csId:b,employeeId:d,csType:type,permissionType:c};
this.csCallRecord.init(a);},_reloadFollow:function(){var a={id:$("#csEntityForm").find("[name=id]").val(),code:$("#statisticInfoDiv").find("[name=csCode]").val()};
this._fillFollowRecordTab(a);},_fillContractTab:function(a){},_fillOppoTab:function(a){var b=new StringBuffer();b.append("Q__S__EQ__co_id_="+a.id);b.append("&rows=999999");
b.append("&page=1");this.oppoList.reloadEntityList(b.toString(),a.id);},_fillAccountTab:function(a){this.csAccount.init({csId:a.id});},_fillComplain:function(a,c,b){var d={csId:a,employeeId:c,isDetail:this.isDetail,csType:type,permissionType:b};
this.csComplainAdd.init(d);},_fillLevelChange:function(a){this.csLevelChange.init({csId:a});},_fillSmsRecordTab:function(a){this.sendMessage.initTable({csId:a});
},_fillMailHistoryTab:function(a){this.csMailHistory.initTable({csId:a});},_fillPointLogTab:function(a){this.pointLog.init({csId:a});},_fillCsLimitTab:function(a){this.csLimit.initTable({csId:a});
},maskEmail:function(a){var c=new StringBuffer();if(a){var b=a.indexOf("@");if(b>2){c.append(a.substring(0,b-2)).append("**").append(a.substring(b));}else{if(b>=1){c.append(a.substring(0,b-1)).append("*").append(a.substring(b));
}}}return c.toString();},_fillOtherInfo:function(a){$("#customer1Info").val(a.code+"("+a.name+")");},combineCs:function(a,b){commomloading=layer.load();
$.ajax({type:"POST",url:CsEntityEdit._CONS_.COMBINE_CS_URL+"?csId="+a+"&combinedCsId="+b,contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(c){layer.close(commomloading);
if(c.success){DialogUtils.success("提示","合并成功");CsEntityUtils.refreshListTab();JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/toEdit.htm?type="+type+"&csId="+a,"客户["+$("#csEntityForm").find('input[name="name"]').val()+"]");
}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},error:function(){layer.close(commomloading);}});},_saveEdit:function(j){var l=this;var c=$(".maskEmail").val();
if(c.indexOf("*@")<0){if(c.indexOf("@")>0){$("input[name=email]").val(c);}else{if(!(c==null||c.trim()=="")){DialogUtils.error("失败","邮箱格式不正确");return;}}}if(!ResUtils.canShow("csEntity.button.viewDesc")){var b=$("#descPhone").val();
var h=$("[name='desc']").val();var a=b.split(",");var e=h.match(/[\~*_]{11}/g);if(e&&e.length>0){for(var f=0;f<a.length;f++){h=h.replace(e[f],a[f]);}}$("[name='desc']").val(h);
}var k=CsEntityEdit._CONS_.SAVE_EDIT_URL;var g=$("#csEntityForm [name=id]").val();var d=$("#csEntityForm [name=isSub]").val();l._validPhone(function(i){ButtonUtils.disableBtn("saveBtn");
var m=new StringBuffer();FormUtils.enableForm("#csEntityForm");m.append($("#csEntityForm").serialize());m.append("&").append(l.csEav.getEavInfoParams());
if(l.eavInit){m.append("&").append(l.csEav.getEavTagParams());}m.append("&csPhoneJSON=").append(l.csPhone.csPhoneData2Json());m.append("&birthday=").append($("#birthYear").val()).append("-").append($("#birthMonth").val()).append("-").append($("#birthDay").val());
FormUtils.submit(k,m.toString(),function(n){ButtonUtils.enableBtn("saveBtn");l._hideNotGrantedBtn(l.data.permissionType,l.data);if(n.success){DialogUtils.success("提示",n.msg);
l.isEdit=false;if(j&&typeof j==="function"){j();}if(l.csAddr.csType=="self"){if(ResUtils.canShow("csEntity.button.isRefreshTal")){JTTabUtils.refreshTable(ctx+"/crm/cs/csEntity/list.htm","我的客户","parentCMD");
}}else{if(l.csAddr.csType=="mysub"){if(ResUtils.canShow("csEntity.button.isRefreshTalSub")){JTTabUtils.refreshTable(ctx+"/crm/cs/csEntity/subList.htm","下属客户","parentCMD");
}}}}else{DialogUtils.error("失败",n.msg);}},function(){ButtonUtils.enableBtn("saveBtn");DialogUtils.error("错误","后台异常，请稍后重试");});},g,d);},_validPhone:function(k,g,l){var c=new StringBuffer();
c.append($("select[name=freeBeginHour]").val()).append($("select[name=freeBeginMinute]").val()).toString();var f=new StringBuffer();f.append($("select[name=freeEndHour]").val()).append($("select[name=freeEndMinute]").val()).toString();
if(parseInt(c)>parseInt(f)){DialogUtils.error("提示","结束时间不可早于开始时间");return;}var e=$(".newPhone");var b=[];if(e&&e.length>0){for(var d=0;d<e.length;d++){if($(e[d]).val()){b.push($(e[d]).val());
var j=$(e[d]).parent().next().find("select").val();var a=$.trim(b[d]);if(!this.csPhone._checkIsPhone(a,j)){if(j=="座机"){if(!this.csPhone._checkIsTel(a,j)){var h="座机号格式错误";
DialogUtils.error("提示",h);return;}}else{DialogUtils.error("提示","非手机类型请选座机");return;}}}}if(b.length>0&&"y"!=l){this.csPhone.vaildPhondIsUsed(b,function(){k();
return;});}else{k();}}else{k();}},_fillPhoneInfo:function(c){var b=this;var a={csId:c.id,fn:function(){if(b.isDetail||!b.addPhone){$(".addCsPhone").hide();
}if("self"==type||(c.permissionType&&"self"==c.permissionType)){if(!ResUtils.canShow("csEntity.button.deletePhone")){$(".deletePhone").hide();}if(!ResUtils.canShow("csEntity.button.callPhoneBtn")){$(".makePhone").hide();
}if(!ResUtils.canShow("csEntity.button.callPhoneAddZeroBtn")){$(".makePhoneAddZero").hide();}if(!ResUtils.canShow("csEntity.button.sendMsgBtn")){$(".sendMessage").hide();
}if(!ResUtils.canShow("csEntity.button.viewPhoneBtn")){$(".viewPhone").hide();}if(!ResUtils.canShow("csEntity.button.addWxByPhone")){$(".addWeixinFriend").hide();
}if(!ResUtils.canShow("csEntity.portray.button")){$("#csEntityPortray").hide();$("#showMoreRfmt").hide();}else{$("#showMoreRfmt").show();}}else{if("mysub"==type||(c.permissionType&&"mysub"==c.permissionType)){if(!ResUtils.canShow("csEntity.button.deletePhoneSub")){$(".deletePhone").hide();
}if(!ResUtils.canShow("csEntity.button.callPhoneBtnSub")){$(".makePhone").hide();}if(!ResUtils.canShow("csEntity.button.callPhoneAddZeroBtnSub")){$(".makePhoneAddZero").hide();
}if(!ResUtils.canShow("csEntity.button.sendMsgBtnSub")){$(".sendMessage").hide();}if(!ResUtils.canShow("csEntity.button.viewPhoneBtnSub")){$(".viewPhone").hide();
}if(!ResUtils.canShow("csEntity.button.addWxByPhoneSub")){$(".addWeixinFriend").hide();}if(!ResUtils.canShow("csEntity.portray.buttonSub")){$("#csEntityPortray").hide();
$("#showMoreRfmt").hide();}else{$("#showMoreRfmt").show();}}else{if("task"==type){if(!ResUtils.canShow("csEntity.button.deletePhoneTask")){$(".deletePhone").hide();
}if(!ResUtils.canShow("csEntity.button.callPhoneBtnTask")){$(".makePhone").hide();}if(!ResUtils.canShow("csEntity.button.callPhoneAddZeroBtnTask")){$(".makePhoneAddZero").hide();
}if(!ResUtils.canShow("csEntity.button.sendMsgBtnTask")){$(".sendMessage").hide();}if(!ResUtils.canShow("csEntity.button.viewPhoneBtnTask")){$(".viewPhone").hide();
}if(!ResUtils.canShow("csEntity.portray.buttonTask")){$("#csEntityPortray").hide();$("#showMoreRfmt").hide();}else{$("#showMoreRfmt").show();}$(".addWeixinFriend").remove();
}else{if("callRecord"==type){if(!ResUtils.canShow("csEntity.button.deletePhoneCallRecord")){$(".deletePhone").hide();}if(!ResUtils.canShow("csEntity.button.callPhoneBtnCallRecord")){$(".makePhone").hide();
}if(!ResUtils.canShow("csEntity.button.callPhoneAddZeroBtnCallRecord")){$(".makePhoneAddZero").hide();}if(!ResUtils.canShow("csEntity.button.sendMsgBtnCallRecord")){$(".sendMessage").hide();
}if(!ResUtils.canShow("csEntity.button.viewPhoneBtnCallRecord")){$(".viewPhone").hide();}if(!ResUtils.canShow("csEntity.portray.buttonCallRecord")){$("#csEntityPortray").hide();
$("#showMoreRfmt").hide();}else{$("#showMoreRfmt").show();}$(".addWeixinFriend").remove();}else{if(!ResUtils.canShow("csEntity.button.deletePhoneSearch")){$(".deletePhone").hide();
}if(!ResUtils.canShow("csEntity.button.callPhoneBtnSearch")){$(".makePhone").hide();}if(!ResUtils.canShow("csEntity.button.callPhoneAddZeroBtnSearch")){$(".makePhoneAddZero").hide();
}if(!ResUtils.canShow("csEntity.button.sendMsgBtnSearch")){$(".sendMessage").hide();}if(!ResUtils.canShow("csEntity.button.viewPhoneBtnSearch")){$(".viewPhone").hide();
}if(!ResUtils.canShow("csEntity.portray.buttonSearch")){$("#csEntityPortray").hide();$("#showMoreRfmt").hide();}else{$("#showMoreRfmt").show();}$(".addWeixinFriend").remove();
}}}}if(c.isDelete=="1"){$(".deletePhone").hide();$(".makePhone").hide();$(".makePhoneAddZero").hide();$(".sendMessage").hide();}}};this.csPhone.loadData(a);
},_fillEavInfo:function(a){var b={csId:a,isDetail:this.isDetail};this.csEav.loadDataEavCommon(b);},_fillEavTag:function(a){var b={csId:a,isDetail:this.isDetail};
this.csEav.loadDataEavTag(b);},_fillAddrInfo:function(c){var a=this;var b={csId:c.id,csType:type,employeeId:c.employeeId,permissionType:c.permissionType,fn:function(){if(!a.changeAddr){$(".addAddr").hide();
$(".edit-addr").hide();$(".addrListDiv").find("button").hide();}else{$("#shopAddrOptForm").find("button").show();$("#shopAddrOptForm").find("input").attr("disabled",false);
$("#shopAddrOptForm").find("select").attr("disabled",false);$("#shopAddrOptForm").find("textarea").attr("disabled",false);}if(c.isDelete=="1"){$(".addAddr").hide();
$(".edit-addr").hide();$(".showMapWeather").hide();$(".remove-addr").hide();}}};this.csAddr.loadData(b);},_fillOrderInfo:function(a,c,b){var d={csId:a,employeeId:c,csType:type,permissionType:b,showThirdSoNo:showThirdSoNo};
this.csOrder.init(d);},_fillTip:function(d,c,a,g){var h=new StringBuffer();var b="&nbsp;&nbsp;&nbsp;";if(c&&0==DateUtils.getDateDiff(c,DateUtils.format(new Date(),"yyyy-MM-dd HH:mm:ss"),"day")){h.append("<span style='color:green;'>今天已跟进</span>").append(b);
}else{h.append("<span style='color:red;'>今天未跟进</span>").append(b);}var f="";if(c){f=c.substring(0,c.length-3);f=f.substring(5,f.length);}h.append("最新跟进：").append("<span title='"+c+"'>"+f+"</span>").append(b);
if(d&&d.length>0){h.append("<span style='color:green;'>3天内订单：</span>");for(var e=0;e<d.length;e++){if(e==1){h.append("...");break;}h.append("<a href='#'' class='soTab' attr-count='"+d.length+"' attr-id='"+(d)[e].id+"' attr-csId='"+(d)[e].csId+"' "+"attr-status='"+(d)[e].status+"' attr-placerId='"+(d)[e].placerId+"' "+"value='"+(d)[e].soNo+"'>"+(d)[e].soNo+"</a>");
}}else{h.append("<span style='color:red;'>3天内无订单</span>").append(b);}h.append(b);h.append("跟进标签：");if(a){h.append("<span style='color:red;'>"+a+"</span>").append(b);
}else{h.append("<span style='color:red;'>无</span>").append(b);}if(!g){g=0;}h.append(b).append("消费总额：<span style='color:red;'>").append(parseFloat(g).toFixed(2)).append("</span>&nbsp;元");
$("#orderTip").empty().append(h.toString());},_bindFormValidation:function(){var a={rules:{maskEmail:{email:true}},messages:{}};FormUtils.bindFormValidation("csEntityForm",a);
},_initTabName:function(a){if(!csPhone){JTTabUtils.renameForActiveTab("客户["+a.name+"]");}else{JTTabUtils.renameForActiveTab("客户来电：["+a.name+"]");}},_disableForDetail:function(){$("body").find("button").hide();
$("#interests").next().find(".dropdown-toggle").show();$("#employeeWeixin").next().find(".dropdown-toggle").show();$("body").find("input").attr("disabled",true);
$("body").find("select").attr("disabled",true);$("body").find("textarea").attr("disabled",true);$("a.placePointOrder").hide();$("a.soAfterList").hide();
$("a.createSubCsEntity").hide();$("a.combineCs").show();$(".closeBtn").show();$(".moreBtn").show();$("#csFollowForm").find("input").attr("disabled",false);
$("#csFollowForm").find("select").attr("disabled",false);$("#csFollowForm").find("textarea").attr("disabled",false);$("select[name=suffix]").attr("disabled",false);
$("#csFollowForm").find(".selectEmployee").show();$(".chooseCsForCombine").show();$("#customer2Id").attr("disabled",false);$("input[name=chooseCs]").attr("disabled",false);
$("#sendMessageModalLabel").find("#smsTpl").attr("disabled",false);$("#sendMessageModalLabel").find("[name=sendContent]").attr("disabled",false);},_initWxchat:function(a){console.log(weixinUseType);
if(weixinUseType=="android"){this._initANdroidchatBtn(a);}else{this._initWebchatBtn(a);}},_initWebchat:function(){var b=this;var a=$("[name='csCode']").val();
var e=$("[name='csName']").val();var d=$("[name='id']").val();var c=CsEntityEdit._CONS_.GET_BY_CSCODE_URL;FormUtils.loadData(c+"?csCode="+a,function(g){if(g&&g.userName){var f={csCode:a,csName:e,employeeWeiXin:g.employeeWeixin,csId:d,userName:g.userName,headImgUrl:g.headImgUrl,hasInline:g.status==1?true:false,wxLabel:g.label,nickNameHashCode:g.nickNameHashCode};
$(".jt-chat-div-for-change").attr("id","jt-chat-"+g.userName.substring(1,g.userName.length));b.layerIndex=layer.open({type:1,title:"聊天，员工微信--"+g.employeeNickName+":"+g.employeeWeixin,shade:false,area:["722px","488px"],scrollbar:false,content:$(".weiXinChatPane"),success:function(h,i){$(".jt-wx-btn-div").hide();
$(".main-show").hide();$(".main-hide").show();$(".main-hide").addClass("one-to-one").css({width:"100%"});b.weiXinChatForm.csInfo=f;b.weiXinChatForm.record.page=1;
b.weiXinChatForm.initChat(false);},yes:function(i,h){}});}else{DialogUtils.error("错误","客户未关联或者系统关注微信未登录");}});},_initWebchatBtn:function(c){var a=$("[name='csCode']").val();
var b=CsEntityEdit._CONS_.GET_BY_CSCODE_URL;if(c.relatedWeixin=="n"){return;}FormUtils.loadData(b+"?csCode="+a,function(d){if(d&&d.userName&&c.permissionType&&("self"==c.permissionType||"mysub"==c.permissionType)){if(d.status==1){$(".weixinChatBtn").addClass("jt-fm-green");
}else{$(".weixinChatBtn").removeClass("jt-fm-green");}$(".weixinChatBtn").show();}else{$(".weixinChatBtn").hide();if(c.relatedWeixin=="y"&&ResUtils.canShow("csEntity.button.bindWx")){$(".bindWx").show();
}else{$(".bindWx").hide();}}self._weixinChatBtn($(".weixinChatBtn"));});},_weixinChatBtn:function(d){var b=this;var c=$(d).parent(".jt-pb-layer");if(c.length>0){var a=0;
c.children("button").each(function(f,g){if($(this).is(":visible")){a++;}});if(a==0){c.parent().removeClass("jt-params-bar").removeClass("jt-params-2bar").removeClass("jt-params-3bar");
}else{if(a==1){c.parent().removeClass("jt-params-2bar").removeClass("jt-params-3bar");}else{if(a>1){c.parent().addClass("jt-params-"+a+"bar");}}}}},_initANdroidchat:function(){var b=this;
var a=$("[name='csCode']").val();var e=$("[name='csName']").val();var d=$("[name='id']").val();var c=CsEntityEdit._CONS_.GET_BY_ANDROID_CSCODE_URL;FormUtils.loadData(c+"?csCode="+a,function(g){if(g&&g.userName){var f={csCode:a,csName:e,csId:d,userName:g.userName,headImgUrl:g.userAvatarSmall,hasInline:g.status==2?true:false,wxLabel:g.label,employeeAlias:g.employeeAlias,nickName:g.conRemark,alias:g.alias,};
$(".jt-chat-div-for-change").attr("id","jt-chat-"+g.userName);b.layerIndex=layer.open({type:1,title:"我与<span style='color: #750d18;''> "+g.employeeNickName+"("+g.employeeWeixin+")"+" </span>的聊天窗口",shade:false,area:["722px","488px"],scrollbar:false,content:$(".weiXinChatPane"),success:function(h,i){$(".jt-wx-btn-div").hide();
$(".main-show").hide();$(".main-hide").show();$(".main-hide").addClass("one-to-one").css({width:"100%"});b.weiXinChatForm.csInfo=f;b.weiXinChatForm.record.page=1;
b.weiXinChatForm.initChat(false);$(".m-message").height($(".main-hide").height()-$("#send-msg-div").height()-40);},yes:function(i,h){}});}else{DialogUtils.error("错误","客户未关联或者系统关注微信未登录");
}});},_initANdroidchatBtn:function(d){var b=this;var a=$("[name='csCode']").val();var c=CsEntityEdit._CONS_.GET_BY_ANDROID_CSCODE_URL;if(d.relatedWeixin=="n"){return;
}FormUtils.loadData(c+"?csCode="+a,function(e){if(e&&e.userName&&d.permissionType&&("self"==d.permissionType||"mysub"==d.permissionType)){if(e.status==2){$(".weixinChatBtn").addClass("jt-fm-green");
}else{$(".weixinChatBtn").removeClass("jt-fm-green");}$(".weixinChatBtn").show();b._weixinChatBtn($(".weixinChatBtn"));b.weiXinChatForm.init();}else{$(".weixinChatBtn").hide();
b._weixinChatBtn($(".weixinChatBtn"));}});},_addWeixinFriend:function(a,d){var e=$("#addEmployeeAlias").val();if(!e||e==""||e==null){DialogUtils.error("错误","请选择员工微信员工微信");
return;}if(!a||a==""||a==null){DialogUtils.error("错误","手机号不能为空");return;}var f=$("#addRemark").val();var b=$("#addSendWords").val();var c=CsEntityEdit._CONS_.ADD_BY_PHONE_URL;
FormUtils.submit(c,{employeeAlias:e,phone:a,remark:f,sendWords:b},function(g){if(g.success){layer.close(d);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");
});},_loadOrderList:function(b){var a=CsEntityEdit._CONS_.FIND_THREE_DAYS_ORDER_URL+"?csId="+b;FormUtils.loadData(a,function(e){if(e&&e.length>0){var f=new StringBuffer();
f.append("<tr class='active'><th>订单编号</th><th>订单金额</th><th>状态</th><th>下单工号</th><th>创建时间</th></tr>");for(var d=0;d<e.length;d++){var c=null;if(e[d].status=="awaiting_pay"){c="等待支付";
}else{if(e[d].status=="awaiting_post"){c="待提交";}else{if(e[d].status=="awaiting_comfirm"){c="待审核";}else{if(e[d].status=="comfirm"){c="待发货";}else{if(e[d].status=="shipping"){c="已发货";
}else{if(e[d].status=="complete"){c="已签收";}else{if(e[d].status=="close"){c="订单作废";}else{if(e[d].status=="close_reject"){c="拒收";}else{if(e[d].status=="close_lost"){c="包裹丢失";
}}}}}}}}}f.append("<tr><td width='130'>"+"<a href='#' class='mySoTab' csNameVal='"+e[d].csName+"'  value='"+e[d].soNo+"'>"+e[d].soNo+"</a></td>"+"<td width='130'>"+parseFloat(e[d].totalAmount).toFixed(2)+"</td>"+"<td width='130'>"+c+"</td>"+"<td width='130'>"+e[d].aid+"</td>");
if(e[d].status=="awaiting_post"){$("#threeDayOrderTab tr").find("th").eq(4).text("下单时间");f.append("<td width='130'>"+e[d].placeTime+"</td></tr>");}else{f.append("<td width='200'>"+e[d].createTime+"</td></tr>");
}}$("#threeDayOrderTab").empty().append(f.toString());}});},_placeGeneralOrderMethod:function(e,a){var c=$(CsEntityEdit._CONS_.FORM_ID).find("[name=id]").val();
var d=$("input[name='name']").val();var b=CsEntityEdit._CONS_.ORDER_PLACE_URL+"?isAdd=true&csId="+$(CsEntityEdit._CONS_.FORM_ID).find("[name=id]").val()+"&isPoint=false"+"&type="+type;
if(outNum){b=b+"&outNum="+outNum;}JTTabUtils.addOrRefreshTab(b,"客户["+d+"]下订单");},_placePointsOrderMethod:function(d,a){var b=$(CsEntityEdit._CONS_.FORM_ID).find("[name=id]").val();
var c=$("input[name='name']").val();if(c.length>4){c="*"+c.substring(c.length-3,c.length);}JTTabUtils.addOrRefreshTab(CsEntityEdit._CONS_.ORDER_PLACE_URL+"?isAdd=true&isPoint=true&csId="+b+"&type="+type,"客户["+c+"]下积分订单");
}};