$(function(){var a=new WeixinFriends();a.init();});function WeixinFriends(){this.hadInit=false;this.wxCode="";this.status="";this.isMultiple=isMultiple;
this.type="web";this.isRelated="y";this.hiddenAlias=false;}WeixinFriends._CONS_={LIST_DATA_URL:ctx+"/gl/cs/weiXinFriends/findByEmployeeWx.htm",LIST_ANDROID_DATA_URL:ctx+"/crm/android/listData.htm",GRID:"#entryWxCodeGrid",PAGER:"#entryWxCodePager"};
WeixinFriends.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._hideNotGrantBtn();this._bindEventHander();if(employeeWeixin&&employeeWeixin!=""){this.wxCode=employeeWeixin;
}else{this.wxCode=$(".activeWxCode").attr("wxCode");}if(status&&status!=""){this.status=status;}if(type&&type!=""){this.type=type;}this._initJqgrid(a);
this._initWxlabel();}},_hideNotGrantBtn:function(){if(!ResUtils.canShow("android.button.viewWx")){this.hiddenAlias=true;}},_initWxlabel:function(){var a=this;
var b=ctx+"/gl/cate/cate/getOptions.htm?typeKey=system&pKey=weixinLabel";FormUtils.loadData(b,function(c){if(c.length>0){var e=new StringBuffer();e.append("<option value=''>请选择</button>");
for(var d=0;d<c.length;d++){e.append("<option value='"+c[d].value+"'>"+c[d].value+"</button>");}$(".wx-msg-target").empty().append(e.toString());a.msgTagDatas=c;
}});},_bindEventHander:function(){var a=this;$(document).on("click",".list-group-item",function(){$(".list-group-item").removeClass("active");$(this).addClass("active");
var b=$(this).attr("wxCode");a.wxCode=b;var d=$(this).attr("relate-flag");a.isRelated=d==1?"y":"";var c=$("#weixinFriendsSearchForm").serialize()+"&isRelated="+a.isRelated+"&employeeWeixin="+a.wxCode;
a.reloadJqgrid(c);});$(document).on("click",".weixinFriendsSearch",function(){var b=$(this).closest("form").serialize()+"&isRelated="+a.isRelated+"&employeeWeixin="+a.wxCode;
a.reloadJqgrid(b);});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(WeixinFriends._CONS_.GRID,a);},_initJqgrid:function(c){var a=this;if(c==null||typeof c==undefined){c={};
}var b=WeixinFriends._CONS_.LIST_DATA_URL+"?sord=asc&sidx=wx.remark_py_";if(a.type=="android"){b=WeixinFriends._CONS_.LIST_ANDROID_DATA_URL+"?sord=asc&sidx=wx.create_time_&Q__S__EQ__wx.new_type_=friend"+"&hiddenAlias="+this.hiddenAlias;
c.employeeWeixin=a.wxCode;c.isRelated=a.isRelated;$(WeixinFriends._CONS_.GRID).JTJqgrid({url:b,pager:WeixinFriends._CONS_.PAGER,postData:c,colNames:["id","userName","friendCode","employeeAlias","备注","类型","员工微信号","状态","标签","微信标签"],colModel:[{name:"id",index:"id_",width:80,hidden:true},{name:"userName",index:"user_name_",width:80,hidden:true},{name:"employeeAlias",index:"employee_alias_",width:80,hidden:true},{name:"friendCode",index:"friend_code_",width:80,hidden:true},{name:"conRemark",index:"con_remark_",width:80},{name:"type",index:"type_",width:80,formatter:function(d){if(d==2){return"群";
}else{return"好友";}}},{name:"employeeWeixin",index:"employee.alias_",width:80},{name:"status",index:"employee.status_",width:40,formatter:function(d,e,f){if(d==2){return"在线";
}else{return"离线";}}},{name:"label",index:"label_",width:80},{name:"wxLabel",index:"wx_label_",width:80}],beforeSelectRow:function(d){if(a.isMultiple!=1){$(WeixinFriends._CONS_.GRID).jqGrid("resetSelection");
a._lastRowId=d;}return true;},onSelectAll:function(e,d){if(a.isMultiple!=1){$(WeixinFriends._CONS_.GRID).jqGrid("resetSelection");$(WeixinFriends._CONS_.GRID).jqGrid("setSelection",a._lastRowId,true);
}else{}},});}else{c.employeeWeixin=a.wxCode;c["Q__N__EQ__wx.status_"]=a.status;$(WeixinFriends._CONS_.GRID).JTJqgrid({url:b,pager:WeixinFriends._CONS_.PAGER,postData:c,colNames:["id","userName","friendCode","昵称","备注"],colModel:[{name:"id",index:"id_",width:80,hidden:true},{name:"userName",index:"user_name_",width:80,hidden:true},{name:"friendCode",index:"friend_code_",width:80,hidden:true},{name:"nickName",index:"nick_name_",width:80},{name:"remark",index:"remark_",width:80,},],beforeSelectRow:function(d){if(a.isMultiple!=1){$(WeixinFriends._CONS_.GRID).jqGrid("resetSelection");
a._lastRowId=d;}return true;},onSelectAll:function(e,d){if(a.isMultiple!=1){$(WeixinFriends._CONS_.GRID).jqGrid("resetSelection");$(WeixinFriends._CONS_.GRID).jqGrid("setSelection",a._lastRowId,true);
}else{}},});}}};