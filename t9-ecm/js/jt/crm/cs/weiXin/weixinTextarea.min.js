function WeixinTextarea(){this.hadInit=false;this.container="";this.focus=false;this.browser={};}WeixinTextarea._CONS_={};WeixinTextarea.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;
this.container=a.container;this._getBrowser();this._bindEventHander();this._initTextArea();}},_bindEventHander:function(){var a=this;$(document).on("focus",a.container,function(b){a.focus=true;
$(a.container).removeClass("flag");});$(document).on("blur",a.container,function(b){a.focus=false;});$(document).on("paste",a.container,function(d){var c=undefined;
var f="";if(window.clipboardData&&window.clipboardData.getData){c=window.clipboardData.getData("Text");}else{c=d.originalEvent.clipboardData.getData("Text");
}if(c){if(c.indexOf("/UploadedFile/bucket/temp/")!=-1){if(c.indexOf(".jpg")!=-1||c.indexOf(".gif")!=-1||c.indexOf(".bmp")!=-1||c.indexOf(".jpeg")!=-1||c.indexOf(".png")!=-1){f="<img style='width:55px;height:66px;' type-value='1' src='"+ctx+c+"' class='jt-lager-img'>";
}else{if(c.indexOf(".mp4")!=-1||c.indexOf(".MP4")!=-1){var b=c.split(";");f="<img src='"+ImageUtils.getFileCoverUrl(b[0])+"' type-value='8'  file-path='"+b[0]+"' file-name='"+(b.length>1?b[1]:"")+"' file-size='"+(b.length>2?b[2]:"")+"'>";
}else{if(c.indexOf(".txt")!=-1||c.indexOf(".zip")!=-1||c.indexOf(".doc")!=-1||c.indexOf(".docx")!=-1||c.indexOf(".pdf")!=-1||c.indexOf(".ppt")!=-1||c.indexOf(".css")!=-1||c.indexOf(".htm")!=-1||c.indexOf(".html")!=-1||c.indexOf(".js")!=-1||c.indexOf(".log")!=-1||c.indexOf(".swf")!=-1||c.indexOf(".rar")!=-1){var b=c.split(";");
f="<img src='"+ImageUtils.getFileCoverUrl(b[0])+"' type-value='7'  file-path='"+b[0]+"' file-name='"+(b.length>1?b[1]:"")+"' file-size='"+(b.length>2?b[2]:"")+"'>";
}}}$(a.container).append(f);return false;}else{a.add(c);return false;}}});$(document).on("keydown",a.container,function(f){var i=f||window.event;var k=i.keyCode||i.charCode;
var b,g,l,j,c,m,h,d;if(k==13&&i.ctrlKey){if(i.preventDefault){i.preventDefault();}else{i.returnValue=false;}if(window.getSelection){if(a.focus===false){return false;
}l=document.createElement("br");b=window.getSelection();g=b.rangeCount>0?b.getRangeAt(0):null;if(g===null){return false;}g.deleteContents();c=b.focusNode;
m=false;while(c.parentNode!=document.documentElement){if(c===this){m=true;break;}else{c=c.parentNode;}}if(m){if(a.browser.chrome||a.browser.safari||a.browser.firefox){h=g.cloneRange();
h.selectNodeContents(this);h.setEnd(g.endContainer,g.endOffset);d=h.toString().length;if(d==this.textContent.length&&this.querySelectorAll(a.container+" br[type='_moz']").length==0){j=l.cloneNode();
j.setAttribute("type","_moz");g.insertNode(j);}}g.insertNode(l);}if(document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("Range","2.0")){h=document.createRange();
h.selectNodeContents(this);h.setStart(g.endContainer,g.endOffset);h.setEnd(g.endContainer,g.endOffset);b.removeAllRanges();b.addRange(h);}}else{g=document.selection.createRange();
if(g===null){return false;}g.collapse(false);g.pasteHTML("<br>");g.select();}}else{if(k==13){if(i.preventDefault){i.preventDefault();}else{i.returnValue=false;
}}}});},_initTextArea:function(){},add:function(a){this._insertHTML(a);},_removeClass:function(){$(this.container).removeClass("flag");},_insertHTML:function(b){var g=$(this.container)[0];
var f,a;if($(g).hasClass("flag")){$(g).html(g.innerHTML+b);return;}if(window.getSelection){f=window.getSelection();if(f.getRangeAt&&f.rangeCount){a=f.getRangeAt(0);
a.deleteContents();var c=document.createElement("div");c.innerHTML=b;var h=document.createDocumentFragment(),e,d;while((e=c.firstChild)){d=h.appendChild(e);
}a.insertNode(h);if(d){a=a.cloneRange();a.setStartAfter(d);a.collapse(true);f.removeAllRanges();f.addRange(a);}}}else{if(document.selection&&document.selection.type!="Control"){$(g).focus();
ierange=document.selection.createRange();ierange.pasteHTML(b);$(g).focus();}}},getValue:function(){var g=[];var c=$(this.container).html();if(c.length>0){if(c.indexOf("<img")!=-1){while(c.length>0){if(c.indexOf("<img")!=-1){if(c.indexOf("<img")!=0){var b=c.substring(0,c.indexOf("<img"));
var e={};e.contentType=0;e.content=this._replaceBr(b);g.push(e);c=c.substring(c.indexOf("<img"),c.length);}else{var d=c.substring(c.indexOf("<img"),c.indexOf(">")+1);
c=c.substring(c.indexOf(">")+1,c.length);var e={};var a=$(d);e.contentType=a.attr("type-value");var f=a.attr("src");if(e.contentType=="7"||e.contentType=="8"){e.fileName=a.attr("file-name");
e.fileSize=a.attr("file-size");e.content=a.attr("file-path");}else{e.content=f.substring(ctx.length,f.length);}g.push(e);}}else{var e={};e.contentType=0;
e.content=this._replaceBr(c);g.push(e);c="";}}}else{var e={};e.contentType=0;e.content=this._replaceBr(c);g.push(e);}}return g;},_replaceBr:function(a){a=a.replaceAll("<br>","\r\n").replaceAll('<br type="_moz">',"").replaceAll("&nbsp;"," ");
return this._removeHtml(a);},_removeHtml:function(a){a=a.replace(/<\/?[^>]*>/g,"");return a;},_getBrowser:function(){if(navigator.userAgent.indexOf("MSIE")>0){this.browser.name="MSIE";
this.browser.ie=true;}else{if(navigator.userAgent.indexOf("Firefox")>0){this.browser.name="Firefox";this.browser.firefox=true;}else{if(navigator.userAgent.indexOf("Chrome")>0){this.browser.name="Chrome";
this.browser.chrome=true;}else{if(navigator.userAgent.indexOf("Safari")>0){this.browser.name="Safari";this.browser.safari=true;}else{if(navigator.userAgent.indexOf("Opera")>=0){this.browser.name="Opera";
this.browser.opera=true;}else{this.browser.name="unknow";}}}}}}};