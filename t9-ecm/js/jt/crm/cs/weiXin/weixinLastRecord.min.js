$(function(){});function WeiXinLastRecord(){this.hadInit=false;this.weixinType=weixinType;this.employeeId="";this.groupId="";this.today=false;this.hiddenAlias=false;
this.employeeData={rows:100,page:1,records:0,total:0,searchParam:""};this.friendData={rows:100,page:1,records:0,total:0,searchParam:"",status:true};this.recordData={rows:100,page:1,records:0,total:0};
this.employeeAlias="";this.headImgUrl="";}WeiXinLastRecord._CONS_={LIST_DATA_URL:ctx+"/crm/cs/weiXinRecord/listData.htm?Q__S__EQ__weixin_type_=web&needAid=y&needGroupKey=y&hasGrant="+ResUtils.canShow("androidRecord.button.viewPhone"),LIST_ANDROID_DATA_URL:ctx+"/crm/cs/weiXinRecord/listData.htm?Q__S__EQ__weixin_type_=android&needAid=y&needGroupKey=y&hasGrant="+ResUtils.canShow("androidRecord.button.viewPhone"),FIND_EMPLOYEE_WEIXIN:ctx+"/gl/ou/employeeWeiXin/findByTypeAndEmployee.htm",FIND_FRIEND_LIST:ctx+"/crm/android/listData.htm?sord=desc&sidx=ext.last_reply_time_&Q__S__EQ__wx.new_type_=friend&hasGrant="+ResUtils.canShow("androidRecord.button.viewPhone"),UPDATE_MSG_TARGET_URL:ctx+"/crm/cs/weiXinRecord/updateMsgTarget.htm",DELETE_URL:ctx+"/crm/cs/weiXinRecord/delete.htm",EXPORT_DATA_URL:ctx+"/crm/cs/weiXinRecord/exportData.htm?Q__S__EQ__weixin_type_=android&needAid=y&needGroupKey=y"};
WeiXinLastRecord.prototype={init:function(b){var a=this;if(!this.hadInit){this.hadInit=true;this._hideNotGrantBtn();this.initOrganizationTree();this._bindEventHander();
this._initWxlabel($("#wx-msg-target_"));this._initlabel($("#wx-label_"));CateUtils.getOptions([{typeKey:"system",pKey:"sensitiveWord",container:"sensitiveValue_"}]);
}},chatLayer:function(){var a=this;a.chatLayer=layer.open({type:1,btn:[],title:false,shade:0,closeBtn:0,zIndex:100,scrollbar:false,skin:"chat-to-layer",move:".chat-layer-move",offset:a.getChatLayerOffset(),area:a.getChatLayerArea(),content:$("#chat-list"),resizing:function(b){if($(b).width()<450){layer.style(a.chatLayer,{width:"450px"});
}if($(b).height()<280){layer.style(a.chatLayer,{height:"280px"});}},moveEnd:function(b){if($(".current-sign").length>0){a.reTips({obj:$(".current-sign")});
}},success:function(b,c){}});},getChatLayerArea:function(){var b=this;var a=$("body").height();return[Math.ceil($(".rows-chat-head").outerWidth())+"px",Math.ceil(a-$(".rows-chat-head").offset().top-$(".rows-chat-head").outerHeight()-10)+"px"];
},getChatLayerOffset:function(){var a=this;return[Math.ceil($(".rows-chat-list").offset().top)+"px",Math.ceil($(".rows-chat-list").offset().left)+"px"];
},resizeChatArea:function(){var c=this;if(!c.chatLayer){return false;}var b=c.getChatLayerArea();var a=c.getChatLayerOffset();console.log(b);console.log(a);
layer.style(c.chatLayer,{width:b[0],height:b[1]});$(".chat-to-layer").css({left:a[1],top:a[0]});},_hideNotGrantBtn:function(){if(!ResUtils.canShow("weiXinRecord.button.delete")){}if(!ResUtils.canShow("androidRecord.view.alias")){this.hiddenAlias=true;
}},_dealStyle:function(){var b=this;var a=$("body").height();a=a-$(".nav-tabs").outerHeight()-5*2;tempHight=a;a=tempHight-($(".rows-title").outerHeight()+$(".rows-search").outerHeight()+1*2+3);
if($(".current-sign").length>0){b.reTips({obj:$(".current-sign")});}},_initWxlabel:function(c){var a=this;var b=ctx+"/gl/cate/cate/getOptions.htm?typeKey=system&pKey=wxMsgTag";
FormUtils.loadData(b,function(d){if(d.length>0){var f=new StringBuffer();f.append("<option value=''>请选择</option>");for(var e=0;e<d.length;e++){f.append("<option value='"+d[e].value+"'>"+d[e].value+"</option>");
}$(c).empty().append(f.toString());}});},_initlabel:function(c){var a=this;var b=ctx+"/gl/cate/cate/getOptions.htm?typeKey=system&pKey=weixinLabel";FormUtils.loadData(b,function(d){if(d.length>0){var f=new StringBuffer();
f.append("<option value=''>请选择</button>");for(var e=0;e<d.length;e++){f.append("<option value='"+d[e].value+"'>"+d[e].value+"</button>");}$(c).empty().append(f.toString());
}});},emptyList:function(c,b){var a=b;if(!b){a="frown-o";}return'<div class="user-alias-empty"><i class="fa fa-'+a+'"></i>&nbsp;'+c+"</div>";},loadList:function(){return'<div class="user-alias-empty"><i class="fa fa-spinner fa-spin"></i>&nbsp;加载中...</div>';
},initOrganizationTree:function(c){var a=this;var b={async:{enable:true,url:ctx+"/gl/ou/group/findVisiableEmployeeTreeForWx.htm",contentType:"application/json",dataType:"json",type:"get",autoParam:["id"],dataFilter:function(e,d,f){return f;
},},data:{simpleData:{enable:true,idKey:"id",pIdKey:"parentId"}},callback:{onClick:function(d,f,e){if(e.type=="group"){a.groupId=e.id;a.employeeId="";}else{a.employeeId=e.id;
a.groupId="";}a.reChatList();$("#user-alias-list").empty().append(a.emptyList("请选择一个员工微信...","hand-o-left"));$("#friends-toolbar .total-record").empty().append("0");
$("#record-toolbar .total-record").empty().append("0");a._loadEmployeeWeixin();a.employeeAlias=null;},onAsyncSuccess:function(g,i,h,j){var f=$.fn.zTree.getZTreeObj("organizationTree2");
if(h==null){var f=$.fn.zTree.getZTreeObj("organizationTree2");var d=f.getNodes();if(d&&d.length){var e=d[0];f.expandNode(e,true,false,false);f.selectNode(e);
f.setting.callback.onClick(null,e.id,e);}}}},view:{selectedMulti:false,fontCss:function(e,d){return(!!d.highlight)?{color:"#A60000","font-weight":"bold"}:{color:"#333","font-weight":"normal"};
}}};$.fn.zTree.init($("#organizationTree2"),b);},_loadEmployeeWeixin:function(){var a=this;$("#employee-alias-list").empty().append(a.loadList());FormUtils.loadData(WeiXinLastRecord._CONS_.FIND_EMPLOYEE_WEIXIN+"?type="+weixinType+"&searchParam="+a.employeeData.searchParam+"&employeeId="+a.employeeId+"&groupId="+a.groupId,function(c){$(".rows-title").eq(1).find("span").find("font").eq(1).empty().html(c.length);
var d=new StringBuffer();if(c.length>0){for(var b=0;b<c.length;b++){if(weixinType=="android"){d.append("<li title='"+c[b].nickName+"("+c[b].alias+")' class='employee-alias-li' employee-alias='"+c[b].userName+"'>").append("<img onerror='onImageError();' class='avatar'  src='"+ImageUtils.getTrueUrl(c[b].headImg)+"'>").append("<div class='nickName'>"+c[b].nickName+"</div>").append("<div class='wxCount'>共&nbsp;<span>"+c[b].wxCount+"<span>&nbsp;个</div>");
d.append("</li>");}else{d.append("<li title='"+c[b].nickName+"("+c[b].weixin+")' class='employee-alias-li' employee-alias='"+c[b].weixin+"'>").append("<span class='nickName'>"+c[b].nickName+"</span>");
d.append("</li>");}}}else{d.append(a.emptyList("没有绑定的微信号..."));}$("#employee-alias-list").empty().append(d.toString());a._dealStyle();});},_loadFriends:function(c,d){var a=this;
if(c){$("#user-alias-list").empty();}$("#user-alias-list").append(a.loadList());a.friendData.status=false;var b=WeiXinLastRecord._CONS_.FIND_FRIEND_LIST+"&employeeWeixin="+a.employeeAlias+"&hiddenAlias="+a.hiddenAlias+"&rows="+a.friendData.rows+"&page="+a.friendData.page;
if(d){b+="&"+d;}FormUtils.loadData(b,function(e){a.friendData.status=true;var g=e.rows;a.friendData.total=e.total;a.friendData.records=e.records;$(".friends-msg-num").empty().html(e.records);
var h=new StringBuffer();if(g.length>0){for(var f=0;f<g.length;f++){h.append("<li title='"+g[f].conRemark+"("+g[f].alias+")' class='user-alias-li' user-name='"+g[f].userName+"'>").append("<img onerror='onImageError();' class='avatar'  src='"+ImageUtils.getTrueUrl(g[f].userAvatarSmall)+"'>").append("<span class='nickName'>"+g[f].conRemark+"</span>");
if(!a.hiddenAlias){h.append("<span class='jt-weixin-info' data-conRemark='"+g[f].conRemark+"' data-alias='"+g[f].alias+"'>[微]</span>");}h.append("<span class='lastChat'>"+WeiXinUtil.changeTypeToCN(g[f])+"</span>").append("</li>");
}}else{h.append(a.emptyList("该微信号没有客户..."));}$("#user-alias-list").find(".user-alias-empty").remove();$("#user-alias-list").append(h.toString());});},_loadRecord:function(c,d){var a=this;
if(c){a.reChatList(true);}a.recordData.status=false;a.lastHistoryTime="";var b=WeiXinLastRecord._CONS_.LIST_ANDROID_DATA_URL+"&Q__S__EQ__employee_alias_="+a.employeeAlias+"&userName="+a.userName+"&rows="+a.recordData.rows+"&page="+a.recordData.page+"&sord=desc&sidx=create_time_";
if(d){b+="&"+d;}FormUtils.loadData(b,function(e){var h=$("#chat-list").find("ul").height();a.recordData.status=true;var g=e.rows;a.recordData.total=e.total;
a.recordData.records=e.records;$(".chat-record-num").empty().text(e.records);var j=new StringBuffer();for(var f=g.length-1;f>=0;f--){j.append(a._getChartLi(g[f]));
}$("#chat-list").find("ul").prepend(j.toString());if(c){$("#chat-list").scrollTop($(".m-message")[0].scrollHeight);}else{h=$("#chat-list").find("ul").height()-h;
$("#chat-list").scrollTop(h);}});},_getHistoryLi:function(c){var e=new StringBuffer();var d=false;if(this.lastHistoryTime==""){this.lastHistoryTime=DateUtils.format(new Date(c.createTime),"yyyy-MM-dd");
d=true;}else{var a=DateUtils.format(new Date(c.createTime),"yyyy-MM-dd");if(this.lastHistoryTime!=a){this.lastHistoryTime=a;d=true;}}var b=DateUtils.getDateDiff(c.createTime,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","hour");
var e=new StringBuffer();if(d){e.append("<p class='time'><span>"+DateUtils.format(new Date(c.createTime),"yyyy-MM-dd")+"</span></p>");}e.append("<div id='history-"+c.id+"' >");
if(c.type=="out"){e.append("<p style='color:#1ab394'>"+(c.employeeAid+":"+c.employeeName)+"  "+DateUtils.format(new Date(c.createTime),"HH:mm"));}else{e.append("<p style='color:#0035ff'>"+(c.nickName)+"  "+DateUtils.format(new Date(c.createTime),"HH:mm"));
}e.append("</p>").append("<p class='history-text "+(this._getSpacialColor(c))+"'>"+this._getMsgType(c)).append(WeiXinUtil.getIsRevoke(c)).append("</p>").append("</div>");
return e.toString();},_getChartLi:function(c){if(c.contentType==5){return"";}var d=false;if(this.lastHistoryTime==""){this.lastHistoryTime=c.createTime;
d=true;}else{var e=DateUtils.getDateDiff(this.lastHistoryTime,c.createTime,"minute");if(Math.abs(e)>=3){this.lastHistoryTime=c.createTime;d=true;}}var b=DateUtils.getDateDiff(c.createTime,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","hour");
var f=new StringBuffer();f.append("<li id='"+c.id+"' >");if(d){if(Math.abs(b)<24){f.append("<p class='time'><span>"+DateUtils.format(new Date(c.createTime),"HH:mm")+"</span></p>");
}else{f.append("<p class='time'><span>"+DateUtils.format(new Date(c.createTime),"yyyy-MM-dd HH:mm")+"</span></p>");}}f.append("<div class='main "+(c.type=="out"?"self":"")+(c.status&&c.status==1?" remove'":"")+"'>");
f.append("<span type='checkbox' style='display:none;' value='"+c.id+"' createTime='"+c.createTime+"' class='glyphicon glyphicon-star wx-set-star "+(c.type=="out"?"wx-set-star-right ":"wx-set-star-left ")+(c.isSign=="y"?" wx-set-star-checked":"")+"'></span>");
if(c.type=="out"){f.append("<div class='msg-employee-info'>"+c.employeeAid+":"+c.employeeName+"</div>");}f.append("<img class='avatar' width='30' height='30' src='"+this._getHeadImgUrl(c)+"' />");
f.append(this._isGroupMessage(c));f.append("<div class='text "+(this._getSpacialColor(c))+(c.contentType==0?"weixin-pure-text":"")+"'>"+this._getMsgType(c)+"</div>"+WeiXinUtil.getIsRevoke(c));
if(c.contentType==2||c.contentType=="2"){if(c.content&&c.content.indexOf("UploadedFile")!=-1){var a=ResUtils.canShow("androidRecord.button.translateVoice");
if(a){if(c.voiceTranslateResult){f.append('<div class="text text-spacial" style="float:left;margin-left:15px; background:none;" ><div class="translateToWord4New"  createTime="'+c.createTime+'"   idVal="'+c.id+'" title="'+c.voiceTranslateResult+'" style="">！</div></div>');
}else{f.append('<div class="text text-spacial" style="float:left;margin-left:15px;background:none;"><div class="translateToWord4New"  createTime="'+c.createTime+'"    idVal="'+c.id+'" title="点击？翻译" style="">？</div></div>');
}}else{if(c.voiceTranslateResult){f.append('<div class="text text-spacial" style="float:left;margin-left:15px;background:none;"><div class="translateToWord4New"  createTime="'+c.createTime+'"    idVal="'+c.id+'" title="'+c.voiceTranslateResult+'" style="">！</div></div>');
}}}}f.append("<div class='chat-sign "+(c.msgTarget?"chat-signing":"")+"'><i class='fa fa-tag'></i><font class='sign-content'>"+c.msgTarget+"</font></div>");
f.append("</div></li>");return f.toString();},_getHeadImgUrl:function(b){var a="";if(b.type=="in"){a=b.headPic!=null&&b.headPic!=""?b.headPic:this.headImgUrl;
}else{a=b.employeeHeadPic?b.employeeHeadPic:currentUserProfile;if(a==""){a="/img/jt/logos/t9.png";}}return ImageUtils.getTrueUrl(a);},_isGroupMessage:function(a){if(a.userName.indexOf("@chatroom")!=-1&&a.type=="in"){return"<div style='color: #8b9290;font-size: 14px;'>"+a.nickName+"</div>";
}else{return"";}},_getMsgType:function(d,b){if(d.contentType==0||d.contentType=="0"){return WeiXinUtil.replaceFace(d.content);}else{if(d.contentType==1||d.contentType=="1"){var c=d.content.split(";");
if(c.length>1){return"<img style='width:120px;' src-value='"+d.content+"' class='jt-lager-img' src='"+ImageUtils.getTrueUrl(c[0])+"' big-src='"+ImageUtils.getTrueUrl(c[1])+"'>";
}else{return"<img style='width:120px;' src-value='"+d.content+"' class='jt-lager-img' src='"+ImageUtils.getTrueUrl(d.content)+"' big-src='"+ImageUtils.getTrueUrl(d.content)+"'>";
}}else{if(d.contentType==2||d.contentType=="2"){if(d.content&&d.content.indexOf("UploadedFile")!=-1){var a="<div class='text text-spacial' >"+WeiXinUtil.getAudioSpan(d,false,false)+"</div>";
return a;}else{return d.content;}}else{if(d.contentType==4||d.contentType=="4"){return"<img style='max-width:80px;height:80px;margin:5px;' src-value='"+d.content+"' class='msg-image'  src='"+ImageUtils.getTrueUrl(d.content)+"' big-src='"+ImageUtils.getTrueUrl(d.content)+"'>";
}else{if(d.contentType==5||d.contentType=="5"){return WeiXinUtil.getNewFriendMsg2(d);}else{if(d.contentType==7||d.contentType=="7"){return WeiXinUtil.getFileMsg(d);
}else{if(d.contentType==8){return WeiXinUtil.getVideoMsg(d);}else{if(d.contentType==10){return WeiXinUtil.getNameCard(d);}else{if(d.contentType==12){return WeiXinUtil.getTransfer(d);
}else{if(b&&this.history.contentSearchParam!=""){return d.content.replaceAll(this.history.contentSearchParam,"<span style='background-color:yellow;'>"+this.history.contentSearchParam+"</span>");
}else{return d.content;}}}}}}}}}}},_getSpacialColor:function(a){if(a.contentType==7||a.contentType==4||a.contentType==1||a.contentType==2||a.contentType==9||a.contentType==8){return"text-spacial";
}else{return"";}},friendsFormExpand:function(){var a=$(".friends-search-former");if(a.is(".expand")){return false;}a.stop().animate({height:"300px"},"fast","swing").addClass("expand");
},friendsFormClose:function(){var a=$(".friends-search-former");if(!a.is(".expand")){return false;}a.stop().animate({height:"38px"},"fast","swing").removeClass("expand");
},_bindEventHander:function(){var b=this;$(document).on("click",".jt-ozt-search",function(f){b._searchNode();b._callNumber();});$(document).on("click",".jt-ewx-search",function(f){var g=$("#employeeAliasInput").val();
b.employeeData.searchParam=g;b._loadEmployeeWeixin();});$("#lastRecordTabLi a").on("shown.bs.tab",function(f){b._dealStyle();});$("#oldWebRecordTabLi a").on("shown.bs.tab",function(h){var f=$("#webWeiXinOldRecordGrid").closest(".ui-jqgrid"),j=$("#webWeiXinOldRecordGrid").closest(".jt-grid-panel"),g=j.height()-80;
if(f.is(":visible")&&j.length>0){g=j.height()-f.find(".ui-jqgrid-hdiv").outerHeight()-2;var i=f.find(".ui-jqgrid-pager");if(i.length>0){g-=i.outerHeight();
}}$("#webWeiXinOldRecordGrid").jqGrid("setGridHeight",g);});$("#newWebRecordTabLi a").on("shown.bs.tab",function(f){});$(document).on("click",".translateToWord4New",function(i){console.log("===click translate");
i.preventDefault();i.stopPropagation();var h=$(this);var k=h.attr("title");if(k!="点击？翻译"){return;}if($(this).attr("hasClick")){DialogUtils.warn(msgCode.WARN_MSG,"请勿重复点击翻译!");
return;}$(this).attr("hasClick",true);var f="xunfei";var g=$(this).attr("idVal");var l=$(this).attr("createTime");var j={voiceId:g,platform:f,createTime:l};
FormUtils.submit(ctx+"/crm/android/voiceTranslate2Word.htm",j,function(m){if(m.success){DialogUtils.success(msgCode.INFO,m.msg);if(m.msg!="已提交到后台任务"){h.attr("title",m.msg);
h.text("！");h.css("cursor","copy");}}else{DialogUtils.error(msgCode.FAIL_MSG,m.msg);}},null,false);});$(document).on("click",".employee-alias-li",function(){$(".employee-alias-li").removeClass("on");
$(this).addClass("on");var h=$(this).attr("employee-alias");b.employeeAlias=h;b.reChatList();var g="Q__D__BW__ext.last_reply_time_="+$("#friendsSearchForm").find(".startDate").val()+"&Q__D__BW__ext.last_reply_time_"+$("#friendsSearchForm").find(".endDate").val();
if($(".add-today").is(".add-today-on")){var f=(new Date()).currentDate();g+="&Q__D__BW__ext.pass_time_="+f+" 00:00:00"+"&Q__D__BW__ext.pass_time_="+f+" 23:59:59";
}b.friendData.page=1;b._loadFriends(true,g);});$(document).on("click",".user-alias-li",function(){$(".user-alias-li").removeClass("on");$(this).addClass("on");
var g=$(this).attr("user-name");b.userName=g;b.reChatList(true);b.recordData.page=1;b.headImgUrl=$(this).find("img").attr("src");var f="startDate="+$("#friendsSearchForm").find(".startDate").val()+"&endDate="+$("#friendsSearchForm").find(".endDate").val();
b._loadRecord(true,f);$(".chat-hide-del-btn").trigger("click");});$("#employeeAliasInput").on("keypress",function(f){if(f.keyCode=="13"){var g=$("#employeeAliasInput").val();
b.employeeData.searchParam=g;b._loadEmployeeWeixin();}});$(".firends-search-nickname").on("keypress",function(f){if(f.keyCode=="13"){$(this).next().trigger("click");
b.friendsFormClose();}});$(".firends-search-nickname").on("focus",function(){b.friendsFormExpand();});$("body").on("click",function(f){if($(".friends-search-former").is(".expand")&&!$(f.target).is(".friends-search-former,.friends-search-former *")){b.friendsFormClose();
}});$(".friendsAliasSearch").on("click",function(){if(!b.employeeAlias){DialogUtils.warning("臣妾做不到","请先选择一个员工微信号...");return false;}b.reChatList();b.friendsFormClose();
var f=$("#friendsSearchForm").closest("form").serialize();b.friendData.page=1;b._loadFriends(true,f);});$(".friendsAliasEmpty").on("click",function(){$("#friendsSearchForm").find("input").val("");
$("#wx-label_ option[value='']").removeAttr("selected");$("#wx-label_ option[value='']").attr("selected","selected");});$(".add-today").on("click",function(){if(!b.employeeAlias){DialogUtils.warning("臣妾做不到","请先选择一个员工微信号...");
return false;}b.reChatList();var g="Q__D__BW__ext.last_reply_time_="+$("#friendsSearchForm").find(".startDate").val()+"&Q__D__BW__ext.last_reply_time_"+$("#friendsSearchForm").find(".endDate").val();
if($(this).is(".add-today-on")){$(this).removeClass("add-today-on");}else{var f=(new Date()).currentDate();g+="&Q__D__BW__ext.pass_time_="+f+" 00:00:00"+"&Q__D__BW__ext.pass_time_="+f+" 23:59:59";
$(this).addClass("add-today-on");}b.friendData.page=1;b._loadFriends(true,g);});$(document).on("click",".chat-search-btn",function(){b.reChatList();var f=$("#chat-content-search").closest("form").serialize();
f+="&startDate="+$("#friendsSearchForm").find(".startDate").val()+"&endDate="+$("#friendsSearchForm").find(".endDate").val();b.recordData.page=1;b._loadRecord(true,f);
});$(document).on("click","#clearSearchBtn",function(){$("#chat-content-search").find("select option:first").prop("selected","selected");$("#sensitiveValue_ option[value='']").removeAttr("selected");
$("#sensitiveValue_ option[value='']").attr("selected","selected");$("#contentType option[value='']").removeAttr("selected");$("#contentType option[value='']").attr("selected","selected");
$("#wx-msg-target_ option[value='']").removeAttr("selected");$("#wx-msg-target_ option[value='']").attr("selected","selected");});$(document).on("click",".chat-outprint-btn",function(){var g="";
var f="";f=WeiXinLastRecord._CONS_.EXPORT_DATA_URL+"&hasGrant="+ResUtils.canShow("androidRecord.button.viewPhone")+"&Q__S__EQ__employee_alias_="+b.employeeAlias+"&userName="+b.userName+"&startDate="+$("#friendsSearchForm").find(".startDate").val()+"&endDate="+$("#friendsSearchForm").find(".endDate").val()+"&rows="+b.recordData.rows+"&page="+b.recordData.page+"&sord=desc&sidx=create_time_";
DialogUtils.confirmWithOptions({title:"是否确认导出微信聊天记录",text:"",confirmButtonText:"确认",yesFunc:function(){window.location.href=f;}});});$(".jt-organization-entry > .jt-form-select").on("click",function(f){if($(".jt-organization").is(":visible")){return false;
}$(".jt-organization").css({"position":"absolute","opacity":0,"left":"-200px"}).show();$(".jt-employee").css({"position":"absolute","height":"calc(100% - 7px)","z-index":4,"box-shadow":"5px 0px 8px 0px #ccc","background-color":"#fff","padding":"7px","padding-left":0});
$(".jt-employee").stop().animate({"left":"+=200px"},"150");$(".jt-organization").stop().animate({"opacity":1,"left":"+=200px"},"250");});$(".jt-employee-entry > .jt-form-select").on("click",function(f){$(".jt-organization").css({"opacity":0,"left":"-450px"}).show();
$(".jt-employee").css({"opacity":0,"z-index":4,"left":"-250px"}).show();$(".jt-employee").stop().animate({"opacity":1,"left":"+=450px"},"250");$(".jt-organization").stop().animate({"opacity":1,"left":"+=450px"},"500");
});$("body").on("click",function(f){if(!$(f.target).is(".jt-employee-entry,.jt-employee-entry *,.jt-organization,.jt-organization *,.jt-employee,.jt-employee *")){if($(".jt-employee-entry").is(":visible")){$(".jt-employee").stop().animate({"opacity":0,"left":"-=450px"},"500",function(){$(this).hide().removeAttr("style");
});$(".jt-organization").stop().animate({"opacity":0,"left":"-=450px"},"250",function(){$(this).hide().removeAttr("style");});}else{if($(".jt-organization-entry").is(":visible")){$(".jt-organization").stop().animate({"opacity":0,"left":"-=200px"},"150",function(){$(this).hide().removeAttr("style");
});$(".jt-employee").stop().animate({"left":"-=200px"},"250",function(){$(this).hide().removeAttr("style");});}}}});function e(f,h,g){$(f).css({"position":"absolute","opacity":0,"left":"-"+h+"px"}).show().stop().animate({"opacity":1,"left":"+="+h+"px"},"fast");
}function d(g,h,f){$(g).stop().animate({"z-index":4,"left":"+="+h+"px"},"fast",function(){if(f){f();}});}function c(g,h,f){$(g).stop().animate({"z-index":4,"left":"-="+h+"px"},"fast",function(){if(f){f();
}});}function a(f){$(f).css({"position":"absolute","opacity":0,"left":"-0px"});}$(document).on("click",".chat-sign",function(){var f=this;if($(this).is(".current-sign")){return false;
}b.reTips({obj:f});$(".current-sign").removeClass("current-sign");$(this).addClass("current-sign");});$("#chat-list,body").scroll(function(){if($(".current-sign").length==0){return false;
}var h=$("#chat-list").offset().top,f=$(".current-sign").offset().top,g=h-f;if(b.tips){if(g<=0&&Math.abs(g)<=$("#chat-list").height()){b.reTips({obj:$(".current-sign")});
}else{$(".current-sign").removeClass("current-sign");layer.close(b.temp);b.temp=null;b.tips=null;}}});$(document).on("click",".msg-target-box li",function(i){var k=$(".current-sign").parent().find("span").eq(0).attr("value");
var j=$(".current-sign").parent().find("span").eq(0).attr("createtime");var g=$(this).attr("data-val");var h=[];var f=[];h.push(k);f.push(j);b._updateMsgTarget(h,f,g);
if(!$(this).is(".reset-sign")){$(".current-sign").find(".sign-content").text($(this).text()).end().addClass("chat-signing").removeClass("current-sign");
}else{$(".current-sign").find(".sign-content").empty().end().removeClass("chat-signing").removeClass("current-sign");}layer.close(b.temp);b.temp=null;b.tips=null;
});$(".rows-chat-list").on("click",function(f){if($(f.target).is(".fa-tag")&&$(f.target).parent().is(".current-sign")){return false;}else{if($(f.target).is(".chat-sign")&&$(f.target).is(".current-sign")){return false;
}}if(b.tips){$(".current-sign").removeClass("current-sign");layer.close(b.temp);b.temp=null;b.tips=null;}});$("#organizationTreeSearch2").on("keyup",function(f){if(f.keyCode==13){b._searchNode(f);
b._callNumber();}});$("#clickUp2").on("click",function(){b._clickUp();});$("#clickDown2").on("click",function(){b._clickDown();});$(".rows-friends-list").scroll(function(){var f=$(this)[0].scrollHeight-$(this).height()-$(this).scrollTop();
if(f<10&&b.friendData.status&&b.friendData.page<b.friendData.total){b.friendData.page=b.friendData.page+1;b._loadFriends(false);}});$("#chat-list").scroll(function(){var f=$(this).scrollTop();
if(f<10&&b.recordData.status&&b.recordData.page<b.recordData.total){b.recordData.page=b.recordData.page+1;b._loadRecord(false);}});$(document).on("mouseenter",".jt-weixin-info",function(g){$("#jt-weixin-info-div").empty().append("昵称："+$(this).attr("data-conRemark")+"<br /> 微信："+$(this).attr("data-alias"));
var f=$(this).offset().left;var h=$(this).offset().top+5-$("body").height()*0.025;if(h+150>$(document).height()){h=$(document).height()-150;}$("#jt-weixin-info-div").css({"top":h,"left":f});
$("#jt-weixin-info-div").stop().show("fast");});$(document).on("mouseleave",".jt-weixin-info",function(g){var f=$(this).offset().left;var h=$(this).offset().top+5-$("body").height()*0.025;
if(h+150>$(document).height()){h=$(document).height()-150;}$("#jt-weixin-info-div").css({"top":h,"left":f});$("#jt-weixin-info-div").stop().hide("fast");
});$("#jt-weixin-info-div").hover(function(f){$("#jt-weixin-info-div").stop(true,true).show();},function(f){$("#jt-weixin-info-div").stop().hide("fast");
});$(window).on("resize",function(){b._dealStyle();});$(document).on("click",".chat-record-bar",function(f){if($(this).find("i").is(".fa-caret-up")){$(".rows-chat-list").css({"height":"calc(100% - 38px)","margin-top":0});
$(".rows-chat-form").stop().slideUp(200);$(this).find("i").removeClass("fa-caret-up").addClass("fa-caret-down");}else{if($(this).find("i").is(".fa-caret-down")){$(".rows-chat-form").stop().slideDown(200);
$(this).find("i").removeClass("fa-caret-down").addClass("fa-caret-up");$(".rows-chat-list").css({"height":"calc(100% - 135px)","margin-top":"97px"});}}});
},resizeSearch:function(){var a=this;},_delete:function(a){var b=this;DialogUtils.confirm(function(){FormUtils.del(WeiXinLastRecord._CONS_.DELETE_URL,JSON.stringify(a),function(c){if(c.success){DialogUtils.success(msgCode.INFO,msgCode.DELETE_MSG);
$.each(a,function(d){var e=a[d].id;$("#"+e).find(".main").remove();});}else{DialogUtils.error(msgCode.ERROR,c.msg);}});});},reTips:function(b){var a=this;
var c="<div class='overflow-box'><ul class='msg-target-box'>";$.each($("#wx-msg-target_").find("option"),function(f,g){if($(this).text()!="请选择"){c+="<li  data-val='"+$(this).attr("value")+"'>"+$(this).attr("value")+"</li>";
}else{c+="<li class='reset-sign' data-val=''>取消标签</li>";}});c+="</ul></div>";a.temp=layer.tips(c,b.obj,{tips:[($(b.obj).parent().is(".self")?4:2),"#78BA32"],time:0,skin:"wx-record-tips",area:["100px","auto"],scrollbar:false,success:function(e,f){a.tips=e[0];
}});if(a.temp){var d=$(window).height()-a.tips.offsetTop-a.tips.clientHeight;if(d<0){a.temp=layer.tips(c,b.obj,{tips:[1,"#78BA32"],time:0,area:["100px","auto"],scrollbar:false,success:function(e,f){a.tips=e[0];
}});}}},reChatList:function(b){var a=this;$("#chat-list").find("ul").empty();if(!b){$(".chat-record-num").empty().text(0);}if(a.tips){layer.close(a.temp);
a.tips=null;a.temp=null;}},_updateMsgTarget:function(d,a,c){var b=WeiXinLastRecord._CONS_.UPDATE_MSG_TARGET_URL;FormUtils.submit(b,{"idArr":d,"createTimeArr":a,"msgTarget":c},function(e){if(e.success){DialogUtils.success(msgCode.INFO,"修改标签成功");
}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);}},null,true);},_searchNode:function(d){var a=$.fn.zTree.getZTreeObj("organizationTree2");var c=$.trim($("#organizationTreeSearch2").val());
var b="name";if(this.lastValue===c){return;}this.lastValue=c;this._updateNodes(false,this.nodeList);if(c!=""){this.nodeList=a.getNodesByParamFuzzy(b,c);
this._updateNodes(true,this.nodeList);}else{this.nodeList=[];}},_updateNodes:function(b,d){var c=$.fn.zTree.getZTreeObj("organizationTree2");if(d){for(var e=0,a=d.length;
e<a;e++){d[e].highlight=b;if(b){c.expandNode(d[e].getParentNode(),true,false,false);}c.updateNode(d[e]);}}},_clickUp:function(){var a=$.fn.zTree.getZTreeObj("organizationTree2");
if(this.nodeList.length==0){DialogUtils.error(msgCode.FAIL_MSG,"没有搜索结果！");return;}else{if(this.clickCount==1){DialogUtils.error(msgCode.FAIL_MSG,"您已位于第一条记录上！");
return;}else{this.clickCount--;a.selectNode(this.nodeList[this.clickCount-1],false);}}document.getElementById("number2").innerHTML="["+this.clickCount+"/"+this.nodeList.length+"]";
},_clickDown:function clickDown(){var a=$.fn.zTree.getZTreeObj("organizationTree2");if(this.nodeList.length==0){DialogUtils.error(msgCode.FAIL_MSG,"没有搜索结果！");
return;}else{if(this.nodeList.length==this.clickCount){DialogUtils.error(msgCode.FAIL_MSG,"您已位于最后一条记录上！");return;}else{a.selectNode(this.nodeList[this.clickCount],false);
this.clickCount++;}}document.getElementById("number2").innerHTML="["+this.clickCount+"/"+this.nodeList.length+"]";},_callNumber:function(){var a=$.fn.zTree.getZTreeObj("organizationTree2");
if(this.nodeList.length){a.selectNode(this.nodeList[0],false);this.clickCount=1;document.getElementById("number2").innerHTML="["+this.clickCount+"/"+this.nodeList.length+"]";
}else{if(this.nodeList.length==0){document.getElementById("number2").innerHTML="[0/0]";a.cancelSelectedNode();}}if($.trim($("#organizationTreeSearch2").val())==""){document.getElementById("number2").innerHTML="";
a.cancelSelectedNode();}},};