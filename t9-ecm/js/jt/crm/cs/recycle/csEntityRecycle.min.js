$(function(){var a=new CsEntity();a.init();});function CsEntity(){this.isFormDataChange=false;this.hasInitJqgrid=false;this.titleCates=null;this.csEmployee=new CsEmployee(this);
this.rfmtSearch=new RfmtSearch();this.selectedJqgrid=new Array();if(window.localStorage.getItem("simpleShowDesc")==null){this.simpleShowDesc=false;}else{this.simpleShowDesc=window.localStorage.getItem("simpleShowDesc");
}this.addressServiceSearch=new AddressService("addrContainerSearch");var a=["首次交易状态跟进时间","部门","员工","员工微信"];if(!isWineIndustyPage){a.push("用途");a.push("口感");
}this.formFrontConfig=new FormConfig({"formId":"csEntitySearchForm",title:"客户回收查询配置",isHidden:true,forceParam:a,"endLess":[],modular:"csEntitySearchList"});
this.sortColumn="";this.sortorder="";}CsEntity._CONS_={LIST_DATA_URL:ctx+"/crm/cs/csEntity/listData.htm",BATCH_DELETE_URL:ctx+"/crm/cs/csEntity/batchDelete.htm",FIND_EMPLOYEE_WEIXIN:ctx+"/gl/ou/employeeWeiXin/findByTypeAndEmployee.htm",BATCH_RECYCLE_URL:ctx+"/crm/cs/csEntity/batchRecycle.htm",GRID:"#csEntityGrid",PAGER:"#csEntityPager",};
CsEntity.prototype={init:function(){this._bindEventHander();this._initJqgrid();this.csEmployee.init();this._initSearch();this.addressServiceSearch.init({isSelect:"y",isNotRequired:true},function(){});
this._prodSearch();this._listShipName();this._initEmployeeWeixin();this.formFrontConfig.init();$(".selectpicker").selectpicker({language:"zh_CN",dropupAuto:false,size:10});
this._locateToGlHelp();},_locateToGlHelp:function(){glHelpUtil.init("glHelp.csEntity.csEntityRecycle");},_listShipName:function(){var a="ssssss";FormUtils.loadData(ctx+"/ec/ship/shipCompany/allActiveCompany.htm",function(c){if(c&&c.length>0){var d=new StringBuffer();
d.append("<option value=''>请选择</option>");for(var b=0;b<c.length;b++){d.append("<option value='"+c[b].id+"'>"+c[b].name+"</option>");}$("#firstShipName").empty().append(d.toString()).select2().trigger("change");
}});},_prodSearch:function(i){$(".searchProd").bsSuggest("destroy");var j=this;var b=$(".searchProd").width()+"px";var c="entity";var h="n";var d="n";var g="prodEntity-csEntity";
var e=window.sessionStorage.getItem(g);if(e){var f=JSON.parse(e);j._prodSearchSuggest(f);}else{var a=ctx+"/ec/product/prodEntity/search.htm?prodType="+c+"&hasStock="+h+"&storeId="+"&limitProdCate="+d+"&keyword=";
FormUtils.loadData(a,function(k){window.sessionStorage.setItem(g,JSON.stringify(k));j._prodSearchSuggest(k);});}},_prodSearchSuggest:function(a){var b=this;
var e=b._getContainer("searchProd");if(!e){return false;}var d=a.value;if(d&&d.length>0){var f=new StringBuffer();for(var c=0;c<d.length;c++){f.append("<option value='"+d[c].prodName+"'>"+d[c].prodName+"</option>");
}e.empty().append(f.toString());}if(e&&e.is(".selectpicker")){e.selectpicker("refresh");}},_initSearch:function(){CateUtils.getOptions([{typeKey:"system",pKey:"CsInterestType",container:"interestSearch",emptyOption:"noInterests"},{typeKey:"system",pKey:"CsBizTypes",container:"bizTypeSearch",emptyOption:"noBizTypes"},{typeKey:"system",pKey:"CsFollowType",container:"followSearch"},{typeKey:"system",pKey:"CsGenderType",container:"genderSearch"},{typeKey:"system",pKey:"CsEntryType",container:"entrySearch"},{typeKey:"system",pKey:"income",container:"incomeSearch"},{typeKey:"system",pKey:"taste",container:"tasteSearch"},{typeKey:"system",pKey:"winePurpose",container:"purposeeSearch"}]);
this._initInterestsSelect();this._initBizTypeSelect();this._buildLevelOption();this._buildEavSearchCondition();ChannelUtils.getOptions({container:"srcSearch",caption:"全部",emptyOptions:"null"});
},_initInterestsSelect:function(){var a=this;a.isInitInterests=true;a.interestsTimer=setInterval(function(){if(a.isInitInterests){$("#interestSearch").selectpicker("refresh");
$("#interestSearch").selectpicker("val",[]);clearInterval(a.interestsTimer);a.interestsTimer=null;}},250);},_initBizTypeSelect:function(){var a=this;a.isInitBizType=true;
a.bizTypeTimer=setInterval(function(){if(a.isInitBizType){$("#bizTypeSearch").selectpicker("refresh");$("#bizTypeSearch").selectpicker("val",[]);clearInterval(a.bizTypeTimer);
a.bizTypeTimer=null;}},250);},_initEmployeeWeixin:function(c,b){var a=this;FormUtils.loadData(CsEntity._CONS_.FIND_EMPLOYEE_WEIXIN+"?employeeId=&groupId=&type=android",function(e){var f=new StringBuffer();
f.append("<option value=''>请选择</option>");for(var d=0;d<e.length;d++){f.append("<option value='"+e[d].userName+"'>"+e[d].alias+"</option>");}$("#employee-wx-select").empty().append(f.toString());
$("#employee-wx-select").select2();});},_hideNotGrantBtn:function(){if(!ResUtils.canShow("csEntityRecycle.button.delete")){$(".batchDelete").hide();}if(!ResUtils.canShow("csEntityRecycle.button.recycle")){$(".batchRecycle").hide();
}},_bindEventHander:function(){var a=this;$(".list_wrapper").on("click",".csEntitySearch",function(){a.rfmtSearch.dealTip();var b=CsEntityUtils.getSearchParams(a.rfmtSearch);
a.selectedJqgrid=new Array();a.reloadJqgrid(b);});$("body").on("click",".csEntityEdit",function(){ConfigUtils.findByKey("csEntity.removeHeight",function(c){if(c.success){$("#csEntityForm .heightWeightDiv").hide();
}});var b=$(this).attr("idVal");if(!b){if(!a.selectedJqgrid||a.selectedJqgrid.length==0){DialogUtils.error("错误","请选择要更新的记录");return;}if(a.selectedJqgrid.length>1){DialogUtils.error("错误","不能同时编辑多条记录");
return;}b=a.selectedJqgrid[0];}a._edit(b);});$("body").on("click",".csEntityEditTmp",function(){var b=$(this).attr("attr-id");a._edit(b);});$("#csEntitySearchForm").on("keypress",function(b){if(b.keyCode=="13"){$(".csEntitySearch").eq(0).trigger("click");
}});$("button.clearCsEntitySearchFormBtn").on("click",function(){FormUtils.clear("csEntitySearchForm");$("#csTagSearch").chosen("destroy").chosen();$("#eavSearch").chosen("destroy").chosen();
if(a._getContainer("searchProd")){a._getContainer("searchProd").selectpicker("refresh");}if(a._getContainer("srcSearch")){a._getContainer("srcSearch").selectpicker("refresh");
}if(a._getContainer("interestSearch")){a._getContainer("interestSearch").selectpicker("refresh");}if(a._getContainer("bizTypeSearch")){a._getContainer("bizTypeSearch").selectpicker("refresh");
}});$(document).on("click",".newSearch",function(){var b="turnNew=y";a.selectedJqgrid=new Array();a.reloadJqgrid(b);});$(document).on("click",".notFollowSearch",function(){var b=DateUtils.getBeforeDate(7);
var c="hightFollowTime="+b+"&includeNotFollow=true";a.selectedJqgrid=new Array();a.reloadJqgrid(c);});$(document).on("click",".birthdaySearch",function(){var b="csCare=birthday";
a.selectedJqgrid=new Array();a.reloadJqgrid(b);});$(document).on("click",".buyWeekSearch",function(){var b="csCare=buyWeek";a.selectedJqgrid=new Array();
a.reloadJqgrid(b);});$(document).on("click",".buyMonthSearch",function(){var b="csCare=buyMonth";a.selectedJqgrid=new Array();a.reloadJqgrid(b);});$(document).on("click",".toDayRegisterPlace",function(){var b=new Date();
var c="lowRegisterTime="+b.currentDate()+" 00:00:00";c+="&hightRegisterTime="+b.currentDate()+" 23:59:59";c+="&toDayRegisterPlace=toDayRegisterPlace";a.selectedJqgrid=new Array();
a.reloadJqgrid(c);});$(document).on("click",".toDayRegister",function(){var b=new Date();var c="lowRegisterTime="+b.currentDate()+" 00:00:00";c+="&hightRegisterTime="+b.currentDate()+" 23:59:59";
a.selectedJqgrid=new Array();a.reloadJqgrid(c);});$("#seniorSearch").on("click",function(){if($(this).text().indexOf("展开")!=-1){$("#seniorSearchDiv").slideDown("fast",function(){});
$(this).empty().append('收起<span class="fa fa-sort-up"></span>');$("#eavSearch").chosen("destroy").chosen();var b={module:systemTagUtil._CONS_.CS_MODULE,type:systemTagUtil._CONS_.CS_TYPE,container:"csTagSearch",selectType:"multiple"};
systemTagUtil._buildCsTag("",b);}else{$(this).empty().append('展开<span class="fa fa-sort-down"></span>');$("#seniorSearchDiv").slideUp("fast");}a.rfmtSearch.dealTip();
});$("#seniorSearch2").on("click",function(){$("#seniorSearch").empty().append('展开<span class="fa fa-sort-down"></span>');$("#seniorSearchDiv").slideUp("fast");
a.rfmtSearch.dealTip();});$(document).on("change",".numberInput",function(){if($(this).val()>=0){}else{$(this).val(0);}});$(document).on("change"," .csDesc",function(){var b=$(this)[0].checked;
if(b){a.simpleShowDesc=true;window.localStorage.setItem("simpleShowDesc",true);$(this).parents(".jqGrid_wrapper").find(".tooltip-desc").show();$(this).parents(".jqGrid_wrapper").find(".desc-detail").hide();
}else{a.simpleShowDesc=false;window.localStorage.setItem("simpleShowDesc",false);$(this).parents(".jqGrid_wrapper").find(".tooltip-desc").hide();$(this).parents(".jqGrid_wrapper").find(".desc-detail").show();
}});$("body").on("click",".prevBtn",function(){a._toList();});$("body").on("click",".batchRecycle",function(){var b=$(CsEntity._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b){DialogUtils.confirmWithOptions({title:"确认要回收选中的客户资料吗？",text:"",confirmButtonText:"确认",yesFunc:function(){a._batchRecycle(b);}});}else{DialogUtils.error(msgCode.ERROR,"请选择要删除的记录");
}});$("body").on("click",".batchDelete",function(){var b=$(CsEntity._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b){DialogUtils.confirmWithOptions({title:"确认要删除选中的客户资料吗？",text:"",confirmButtonText:"确认",yesFunc:function(){a._batchDelete(b);
}});}else{DialogUtils.error(msgCode.ERROR,"请选择要删除的记录");}});},reloadJqgrid:function(a){window.localStorage.setItem("csentity_need_clear_selectedJqgrid","true");
JTJqgridUtils.reloadJqgrid(CsEntity._CONS_.GRID,a);},_initJqgrid:function(){var a=this;var c=CsEntity._CONS_.LIST_DATA_URL+"?1=1";if(recycleCs){c+="&recycleCs="+recycleCs;
}var f=false;if("finance"==versionType){f=true;}var e=$(window).width();var h=true;var d=window.localStorage.getItem(CsEntity._CONS_.GRID+"HideItems");
var g=null;console.log(d);if(d!=null){g=d.split(",");}else{var b=ctx+"/crm/cs/csEntity/getHideTblHead.htm"+"?gridId="+CsEntity._CONS_.GRID;FormUtils.loadData(b,function(i){if(i&&i.length>0){g=i;
}});}ConfigUtils.findByKey("csEntity.limit.wineIndustry",function(j){if(j.success){h=false;$(".wineIndustryDiv").show();}var i=true;if(ResUtils.canShow("csEntity.button.csListShowSrc")){i=false;
}ConfigUtils.findByKey("csEntity.hiddenConsumeField",function(n){var l=false;if(n.success){l=true;}var m={RScore:RScore,FScore:FScore};var k=[{modelName:"code",name:"code",index:"entity.code_",width:100,isBase:"true",formatter:function(o,p,r){if(r.footData){$(".ui-jqgrid-title").css({"width":"100%"});
var q="<div style='float:left'>"+r.code+"</div>"+"<div style='float:right;position:relative;'>"+"</div>";$(CsEntity._CONS_.GRID).jqGrid("setCaption",q);
return r.code;}else{var s=new StringBuffer();s.append('<div class="nameClass">');if(r.turnNew=="y"){s.append("<span style='color:red'>新</span>");}if(r.isSub=="y"){s.append("<span style='color:red;white-space:pre'> 从</span>");
}s.append(r.code);s.append("</div>");return s.toString();}}},{modelName:"_name",name:"_name",index:"entity._name_",width:100,formatter:function(o,p,q){return"<a class='csEntityEditTmp' attr-id='"+q.id+"'>"+q.name+"</a>";
}},{modelName:"name",name:"name",index:"entity.name_",hidden:true},{name:"pureCode",hidden:true,formatter:function(o,p,q){return q.code;}},{modelName:"isOrderSo",name:"isOrderSo",width:50,index:"entity.is_order_so_",formatter:function(o,p,r){var q=r.isOrderSo;
if(q=="y"){return"是";}else{return"<font style='color:red;'>否</font>";}}},{modelName:"gender",name:"gender",index:"entity.gender_",width:35,isBase:"true"},{modelName:"care",name:"care",index:"care",isBase:"true",width:50,sortable:false,formatter:function(o,w,p){var r=new StringBuffer();
var u=new Date();var s=DateUtils.format(u,"yyyy-MM-dd")+" 00:00:00";var t="";if(p.birthday.length<9||p.birthday.length==5){t=u.getFullYear()+p.birthday+" 00:00:00";
}else{t=u.getFullYear()+"-"+p.birthday.substring(5,p.birthday.length)+" 00:00:00";}var q=DateUtils.getDateDiff(s,t,"day");if(q<=7&&q>=0){var v=ctx+"/img/jt/cake2.png";
if(q==0){r.append("<div title='今天生日' style='background-image:url(/t9-ecm/img/jt/cake2.png);width:20px; height:20px;float:left;'></div>");}else{r.append("<div title='"+t.substring(5,10)+"生日, 还差"+q+"天' style='background-image:url(/t9-ecm/img/jt/cake2.png);width:20px; height:20px;float:left;'></div>");
}}if(p.lastCompleteTime){if(DateUtils.getDateDiff(p.lastCompleteTime,s,"day")>7&&DateUtils.getDateDiff(p.lastCompleteTime,s,"day")<28){r.append("<div title='购买满7天' style='background-image:url(/t9-ecm/img/jt/7.png);width:20px; height:20px;float:left;'></div>");
}if(DateUtils.getDateDiff(p.lastCompleteTime,s,"day")>=28){r.append("<div title='购买满28天' style='background-image:url(/t9-ecm/img/jt/28.png);width:20px; height:20px;float:left;'></div>");
}}return r.toString();}},{modelName:"bizType",name:"bizType",index:"entity.biz_type_",width:70,sortable:true,isBase:"true",},{modelName:versionType&&versionType=="finance"?"isTurnover":"hasDeal",name:versionType&&versionType=="finance"?"isTurnover":"hasDeal",index:versionType&&versionType=="finance"?"entity.is_turnover_":"entity.so_total_",width:35,sortable:true,isBase:"true",formatter:function(o,p,r){var q="<div  style='background-image:url(/t9-ecm/img/jt/queren.png);width:20px; height:20px;float:left;'></div><i class='fa' style='margin-right:3px;'></i>";
if(versionType&&versionType=="finance"){if(o&&o=="y"){return q;}else{return"";}}else{if(r.soTotal&&r.soTotal>0){return q;}else{return"";}}}},{modelName:"soComplete",name:"soComplete",index:"entity.so_complete_",width:35,isBase:"true"},{modelName:"soTotal",name:"soTotal",index:"entity.so_total_",width:70,hidden:l,isBase:"true",formatter:function(o,p,q){return q.soTotal;
}},{modelName:"jdPoint",name:"jdPoint",index:"entity.jd_point_",hidden:h,width:60,sortable:true},{modelName:"youzanPoint",name:"youzanPoint",index:"entity.youzan_point_",hidden:h,width:60,sortable:true},{modelName:"interests",name:"interests",index:"entity.interests_",width:80,sortable:true},{modelName:"productName",name:"productName",index:"entity.product_name_",width:80,sortable:true,isBase:"true"},{modelName:"srcNames",name:"srcNames",index:"entity.srcs_",width:80,sortable:true,hidden:i,isBase:"true"},{modelName:"relatedWeixin",name:"relatedWeixin",index:"entity.related_weixin_",width:80,sortable:true,formatter:function(o,p,r){var q="<div  style='background-image:url(/t9-ecm/img/jt/queren.png);width:20px; height:20px;float:left;'></div><i class='fa' style='margin-right:3px;'></i>";
if(o=="y"){return q;}else{return"";}}},{modelName:"prName",name:"prName",index:"entity.pr_name_",width:120,sortable:true,formatter:function(o,q,r){var s=new StringBuffer();
if(r.prName){s.append(r.prName);}if(r.ciName){s.append(",").append(r.ciName);}var p=s.toString();if(p){p=p.replace("省","");p=p.replace("市","");p=p.replace("自治区","");
p=p.replace("自治州","");}return p;}},{modelName:"lastFollowTime",name:"lastFollowTime",index:"entity.last_follow_time_",width:82,isBase:"true",formatter:function(o){var p=new StringBuffer();
if(o&&0==DateUtils.getDateDiff(o,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){p.append("今天 ").append(DateUtils.mini3Time(o));}else{if(o&&1==DateUtils.getDateDiff(o,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){p.append("昨天 ").append(DateUtils.mini3Time(o));
}else{p.append(DateUtils.mini2Time(o));}}return p.toString();}},{modelName:"follow",name:"follow",index:"entity.follow_",width:70,isBase:"true"},{modelName:"lastFollowContent",name:"lastFollowContent",index:"entity.last_follow_content_",sortable:false,width:100,formatter:function(o){var p="";
if(o!=""&&o!=null){p='<span  style="color:#1ab394;'+(a.simpleShowDesc=="true"?"":"display:none")+'" class="tooltip-desc jt-grid-tip fa fa-bell"   data-value="'+o+'"></span>';
p+='<span style="'+(a.simpleShowDesc=="true"?"display:none":"")+'" class="desc-detail">'+o+"</span>";}return p;}},{modelName:"desc",name:"desc",index:"entity.desc_",width:100,isBase:"true",formatter:function(p){var o="";
if(p!=""&&p!=null){o='<span  style="color:#1ab394;'+(a.simpleShowDesc=="true"?"":"display:none")+'" class="tooltip-desc jt-grid-tip fa fa-bell" data-toggle="tooltip"  data-value="'+p+'"></span>';
o+='<span style="'+(a.simpleShowDesc=="true"?"display:none":"")+'" class="desc-detail">'+p+"</span>";}return o;}},{modelName:"turnTime",name:"turnTime",index:"entity.turn_time_",width:82,formatter:function(o){var p=new StringBuffer();
if(o&&0==DateUtils.getDateDiff(o,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){p.append("今天 ").append(DateUtils.mini3Time(o));}else{if(o&&1==DateUtils.getDateDiff(o,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){p.append("昨天 ").append(DateUtils.mini3Time(o));
}else{p.append(DateUtils.mini2Time(o));}}return p.toString();}},{modelName:"lastCompleteTime",name:"lastCompleteTime",index:"entity.last_complete_time_",width:82,formatter:function(o){var p=new StringBuffer();
if(o&&0==DateUtils.getDateDiff(o,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){p.append("今天 ").append(DateUtils.mini3Time(o));}else{if(o&&1==DateUtils.getDateDiff(o,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){p.append("昨天 ").append(DateUtils.mini3Time(o));
}else{p.append(DateUtils.mini2Time(o));}}return p.toString();}},{modelName:"employeeName",name:"employeeName",index:"entity.employee_id_",width:100,formatter:function(o,p,q){if(q.employeeAid){return q.employeeAid+":"+q.employeeName;
}return q.employeeAid;}},{modelName:"groupName",name:"groupName",index:"entity.group_Id_",width:70},{modelName:"createTime",name:"createTime",index:"entity.create_time_",width:82,isBase:"true",formatter:function(o){var p=new StringBuffer();
if(o&&0==DateUtils.getDateDiff(o,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){p.append("今天 ").append(DateUtils.mini3Time(o));}else{if(o&&1==DateUtils.getDateDiff(o,DateUtils.format(new Date(),"yyyy-MM-dd")+" 23:59:59","day")){p.append("昨天 ").append(DateUtils.mini3Time(o));
}else{p.append(DateUtils.mini2Time(o));}}return p.toString();}},{modelName:"phone",name:"phone",index:"entity.phone",hidden:true,width:60},{modelName:"subPhone",name:"subPhone",index:"entity.subPhone",hidden:true,width:60}];
if(g){$.each(k,function(o,p){if($.inArray(this.modelName,g)!=-1){this.hidden=true;}});}$(CsEntity._CONS_.GRID).JTJqgrid({url:c,pager:CsEntity._CONS_.PAGER,postData:m,width:"100%",autowidth:true,colNames:["客户编号","姓名","客户名称(隐藏)","客户编号(隐藏)","约单","性别","关怀","分类","成交","N次","消费(元)","京享值","有赞积分","意向","产品意向","渠道","微信","地区","最新跟进","跟进标签","跟进内容","备注","转单时间","最新签收","工号","部门","注册时间","手机号","从属客户手机号码"],colModel:k,simplify:{entry:[{sName:"精简显示",sClass:"csDesc",sCheck:a.simpleShowDesc=="true"}],must:["客户编号","姓名"],base:["操作","性别","关怀","分类","成交","N次","消费(元)","产品意向","渠道","最新跟进","跟进标签","备注"],other:["约单","京享值","有赞积分","意向","微信","地区","跟进内容","转单时间","最新签收"]},footerrow:true,userDataOnFooter:true,loadComplete:function(){if("true"==window.localStorage.getItem("csentity_need_clear_selectedJqgrid")){a.selectedJqgrid=new Array();
window.localStorage.removeItem("csentity_need_clear_selectedJqgrid");}for(var p=0;p<a.selectedJqgrid.length;p++){$(CsEntity._CONS_.GRID).jqGrid("setSelection",a.selectedJqgrid[p]);
}if($(CsEntity._CONS_.GRID).jqGrid("getGridParam","records")<1000){$("#endExportNum").val($(CsEntity._CONS_.GRID).jqGrid("getGridParam","records"));}else{$("#endExportNum").val(1000);
}a._hideNotGrantBtn();var o=$(CsEntity._CONS_.GRID).getGridParam("width");$(CsEntity._CONS_.GRID).setGridWidth(o);$(window).resize();},gridComplete:function(){var o=$(CsEntity._CONS_.GRID).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow");
o.find('td[aria-describedby*="rn"],td[aria-describedby*="cb"],td[aria-describedby*="care"],td[aria-describedby*="srcNames"],td[aria-describedby*="relatedWeixin"],td[aria-describedby*="name"],td[aria-describedby*="gender"],td[aria-describedby*="bizType"],td[aria-describedby*="winePurpose"],td[aria-describedby*="taste"],td[aria-describedby*="hasDeal"],td[aria-describedby*="soRepeatBuy"],td[aria-describedby*="soTotal"],td[aria-describedby*="interests"],td[aria-describedby*="productName"],td[aria-describedby*="follow"],td[aria-describedby*="turnTime"],td[aria-describedby*="lastCompleteTime"],td[aria-describedby*="employeeName"],td[aria-describedby*="levelName"],td[aria-describedby*="lastFollowTime"],td[aria-describedby*="canPlaceSo"],td[aria-describedby*="soComplete"],td[aria-describedby*="jdPoint"],td[aria-describedby*="prName"],td[aria-describedby*="desc"],td[aria-describedby*="groupName"],td[aria-describedby*="createTime"]').hide();
o.find('td[aria-describedby*="csEntityGrid_code"]').show();o.hide();},onSelectAll:function(q,o){if(q&&q.length>0){for(var p=0;p<q.length;p++){if(o){if(a.selectedJqgrid.indexOf(q[p])==-1){a.selectedJqgrid.push(q[p]);
}}else{a.selectedJqgrid.remove(q[p]);}}}},onSelectRow:function(p,o){if(o){if(a.selectedJqgrid.indexOf(p)==-1){a.selectedJqgrid.push(p);}}else{a.selectedJqgrid.remove(p);
}},ondblClickRow:function(o){if(o){a._edit(o);}},onSortCol:function(p,q,o){a.sortColumn=p;a.sortorder=o;}});});});},_edit:function(c,a){var b="客户["+$(CsEntity._CONS_.GRID).jqGrid("getRowData",c).name+"]";
if(ResUtils.canShow("csEntity.button.edit")){JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/toEdit.htm?type=detail&csId="+c,b);}},_toList:function(){$(".list_wrapper").show();
$(".form_wrapper").hide();$(".excel_wrapper").hide();},_buildLevelOption:function(){FormUtils.loadData(ctx+"/crm/point/levelDef/findActived.htm",function(b){if(b&&b.length>0){var c=new StringBuffer();
for(var a=0;a<b.length;a++){c.append("<option value='"+b[a].level+"'>"+b[a].name+"</option>");}$("#levelSearch").append(c.toString());}});},_buildEavSearchCondition:function(){var a=this;
FormUtils.loadData(ctx+"/crm/cs/csEntity/getEavSetPo.htm",function(e){if(e&&e.eavAttrPos&&e.eavAttrPos.length>0){var d=e.eavAttrPos;var f=new StringBuffer();
f.append("<option value=''>请选择</option>");for(var c=0;c<d.length;c++){f.append("<optgroup label='"+d[c].name+"'>");if(d[c].eavAttrOptPos&&d[c].eavAttrOptPos.length>0){for(var b=0;
b<d[c].eavAttrOptPos.length;b++){f.append("<option value='"+d[c].eavAttrOptPos[b].value+"'>"+d[c].eavAttrOptPos[b].label+"</option>");}}f.append("</optgroup>");
}$("#eavSearch").empty().append(f.toString());}});},_getContainer:function(b){var a=this;var c=false;if(b){c=$("#"+b);if(c.length==0){c=$("select."+b);
if(c.length==0){c=$("select[name='"+b+"']");if(c.length==0){return false;}}}}return c;},_batchRecycle:function(b){var a=CsEntity._CONS_.BATCH_RECYCLE_URL;
FormUtils.submit(a,{"ids":b},function(c){if(c.success){DialogUtils.success(msgCode.INFO,"客户资料回收成功");$(".csEntitySearch").trigger("click");}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);
}});},_batchDelete:function(b){var a=CsEntity._CONS_.BATCH_DELETE_URL;FormUtils.submit(a,{"ids":b},function(c){if(c.success){DialogUtils.success(msgCode.INFO,"客户资料删除成功");
$(".csEntitySearch").trigger("click");}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}});},};function parentCMD(){$(".csEntitySearch").trigger("click");
}