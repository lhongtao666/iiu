function CsAccount(){this.hadInit=false;}CsAccount._CONS_={EDIT_URL:ctx+"/crm/cs/csAccount/edit.htm",DETAIL_URL:ctx+"/crm/cs/csAccount/detail.htm",DELETE_URL:ctx+"/crm/cs/csAccount/delete.htm",SAVE_ADD_URL:ctx+"/crm/cs/csAccount/saveAdd.htm",SAVE_EDIT_URL:ctx+"/crm/cs/csAccount/saveEdit.htm",LIST_DATA_URL:ctx+"/crm/cs/csEntity/findAccountByCsId.htm",EDIT_FORM_ID:"csAccountForm",GRID:"#csAccountGrid",PAGER:"#csAccountPager",GRID_ID:"csAccountGrid",PAGER_ID:"csAccountPager"};
CsAccount.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;}this._initTable(a);},clear:function(c){var a=this;function b(){a._showListWrapper();
a.isFormDataChange=false;a.isEdit=false;$(".form_wrapper .saveBtn").show();FormUtils.clear(CsAccount._CONS_.EDIT_FORM_ID);FormUtils.enableForm(CsAccount._CONS_.EDIT_FORM_ID);
if(c){a.reloadJqgrid();}}if(a.isEdit&&a.isFormDataChange){DialogUtils.warning(function(){b();});}else{b();}},_add:function(){this._showFormWrapper();},_edit:function(a){this._showFormWrapper();
this.edit=true;this._loadData(a);},_detail:function(a){this._showFormWrapper();this._loadData(a);$(".form_wrapper .saveBtn").hide();FormUtils.disableForm(CsAccount._CONS_.EDIT_FORM_ID);
},_loadData:function(b){var a=this;FormUtils.loadData(CsAccount._CONS_.EDIT_URL+"?id="+b,function(c){$("input[name=id]").val(c.id);$("input[name=csId]").val(c.csId);
$("input[name=accountType]").val(c.accountType);$("input[name=account]").val(c.account);$("input[name=comment]").val(c.comment);$("input[name=createTime]").val(c.createTime);
$("input[name=updateTime]").val(c.updateTime);});},_save:function(){var b=this;var c=$("#id").val();var a=null;if(c!=null&&c!=""){a=CsAccount._CONS_.SAVE_EDIT_URL;
}else{a=CsAccount._CONS_.SAVE_ADD_URL;}if($("#csAccountForm").valid()){ButtonUtils.disableBtn("saveBtn");FormUtils.submitByFormId(a,CsAccount._CONS_.EDIT_FORM_ID,function(d){ButtonUtils.enableBtn("saveBtn");
if(d.success){if(d.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);}else{if(d.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
}}b.isEdit=false;b.clear(true);}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);}},function(){ButtonUtils.enableBtn("saveBtn");DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}},_delete:function(b){var a=this;DialogUtils.confirm(function(){FormUtils.del(CsAccount._CONS_.DELETE_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,msgCode.DELETE_MSG);
a.reloadJqgrid();}else{DialogUtils.error(msgCode.ERROR,c.msg);}});});},_bindEventHander:function(){var a=this;$(document).on("click",".prevBtn",function(){a.clear(false);
});$(document).on("click",".saveBtn",function(){a._save();});$("#"+CsAccount._CONS_.EDIT_FORM_ID).on("change","input",function(){if(a.isEdit){a.isFormDataChange=true;
}});$("#"+CsAccount._CONS_.EDIT_FORM_ID).on("change","select",function(){if(a.isEdit){a.isFormDataChange=true;}});$("#"+CsAccount._CONS_.EDIT_FORM_ID).on("change","textarea",function(){if(a.isEdit){a.isFormDataChange=true;
}});$(".list_wrapper").on("click",".csAccountSearch",function(){var b=$(this).closest("form").serialize();a.reloadJqgrid(b);});$(".toolbar-panel").on("keypress","form",function(b){if(b.keyCode=="13"){var c=$(this).closest("form").serialize();
a.reloadJqgrid(c);return false;}});$("body").on("click",".csAccountAdd",function(){a._add();});$("body").on("click",".csAccountEdit",function(){a.isEdit=true;
var b=$(this).attr("idVal");if(!b){b=$(CsAccount._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);
return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);return;}}}a._edit(b);});$("body").on("click",".csAccountDel",function(){var b=$(this).attr("idVal");
if(!b){b=$(CsAccount._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_DELETE);
return;}}a._delete(b);});$("body").on("click",".csAccountDetail",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(CsAccount._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_DETAIL);return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.error,msgCode.ERROR_DETAIL_MUL_RECORD);
return;}}}a._detail(b);});},_bindFormValidation:function(){var a={rules:{},messages:{}};FormUtils.bindFormValidation(CsAccount._CONS_.EDIT_FORM_ID,a);},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(CsAccount._CONS_.GRID,a);
},_getManagerBtns:function(){var a=[];if(ResUtils.canShow("csAccount.button.delete")){a.push({lable:msgCode.DELETE_BTN_TEXT,btnClasses:"btn btn-danger csAccountDel",iconClasses:"fa fa-remove"});
}if(ResUtils.canShow("csAccount.button.edit")){a.push({lable:msgCode.EDIT_BTN_TEXT,btnClasses:"btn btn-primary csAccountEdit",iconClasses:"fa fa-edit"});
}if(ResUtils.canShow("csAccount.button.detail")){a.push({lable:msgCode.DETAIL_BTN_TEXT,btnClasses:"btn btn-primary csAccountDetail",iconClasses:"fa fa-detail"});
}return a;},_initJqgrid:function(a){if(a==null||typeof a==undefined){a={};}$("#csAccountGridDiv").empty().append('<table id="'+CsAccount._CONS_.GRID_ID+'"></table>                <div id="'+CsAccount._CONS_.PAGER_ID+'"></div>');
$(CsAccount._CONS_.GRID).jqGrid({datatype:"json",url:ctx+"/crm/cs/csEntity/searchAccount.htm?Q__S__EQ__cs_id_="+a.csId,height:200,width:$("."+a.widthWId).width(),shrinkToFit:true,rowNum:10,mtype:"POST",viewrecords:false,multiselect:false,rownumbers:true,pager:CsAccount._CONS_.PAGER,colNames:["账户类型","账号","描述"],colModel:[{name:"accountType",index:"account_type_",width:150,formatter:function(b,d,e){var c=e.accountType;
if(e.accountType=="alipay"){c="支付宝";}else{if(e.accountType=="weixin"){c="微信支付";}else{if(e.accountType=="bank"){c="银行转账";}}}return c;}},{name:"account",index:"account_",width:200},{name:"comment",index:"comment_",width:200}],gridComplete:function(){var b=$(CsAccount._CONS_.GRID).jqGrid("getGridParam","records");
if(b<=0){if($(CsAccount._CONS_.GRID).parent().find(".norecords").html()==null){$(CsAccount._CONS_.GRID).parent().append('<div class="norecords">没有符合数据！</div>');
$(CsAccount._CONS_.GRID).parent().find(".norecords").show();}else{$(CsAccount._CONS_.GRID).parent().find(".norecords").show();}}else{$(CsAccount._CONS_.GRID).parent().find(".norecords").hide();
}},});$(window).bind("resize",function(){var b;if(a.widthWId){b=$("."+a.widthWId).width();}else{b=$(".jqGrid_wrapper").width();}$(CsAccount._CONS_.GRID).setGridWidth(b);
});},_initTable:function(c){var a=this;$("#csAccountDiv").empty().append("<table class='table table-striped table-bordered' id='csAccountTable'><thead><tr><th>账户类型</th><th>账号</th><th>描述</th></tr></thead></table>");
var b=CsAccount._CONS_.LIST_DATA_URL+"?csId="+c.csId;$("#csAccountTable").DataTable({ajax:{url:b},columns:[{data:"accountType",render:function(g,f,e){var d=g;
if(g=="alipay"){d="支付宝";}else{if(g=="weixin"){d="微信支付";}else{if(g=="bank"){d="银行转账";}}}return d;},width:"30%"},{data:"account",width:"30%"},{data:"comment",width:"40%"}],rowId:"id",lengthMenu:[[5,10],[5,10]],paging:true,pagingType:"simple",lengthChange:false,autoWidth:false,ordering:true,order:[[0,"desc"]]});
}};