function CsFinanceTurnover(){this.hadInit=false;this.params=null;}CsFinanceTurnover._CONS_={SAVE_ADD_URL:ctx+"/crm/finance/financeTurnover/saveAdd.htm"};
CsFinanceTurnover.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._bindFormValidation();this.params=a;}this._initTable(a);
},_bindEventHander:function(){var a=this;$(document).on("click","#addTurnoverBtn",function(){ButtonUtils.disableBtn("addTurnoverBtn");layer.close(a.layerIndex);
a.layerIndex=layer.open({type:1,title:"成交记录",shade:false,btn:["保存","关闭"],area:["550px","350px"],offset:"10%",content:$(".csFinanceTurnoverAdd"),scrollbar:true,success:function(c,d){ButtonUtils.enableBtn("addTurnoverBtn");
a._initForm();},yes:function(d,c){if(!$("#csFinanceTurnoverAdd").valid()){return;}a._save();}});});var b=$("#csFinanceTurnoverAdd");b.on("click",".selectPlacerId",function(){var c=0;
if(ResUtils.canShow("employeeSelector.button.cs")){c:1;}var e={isShowAllGroup:c,grantType:"/cs/",isMultiple:1,isOnlySelfGroup:1,callBack:function(f){if(f!=null||f.length>0){b.find("input[name=placerShow]").val(f[0].aid+"："+f[0].name);
b.find("input[name=placerId]").val(f[0].id);b.find("input[name=placerAid]").val(f[0].aid);b.find("input[name=placerName]").val(f[0].name);}}};var d=new EmployeesSelect();
d.init(e);});},_initForm:function(){FormUtils.clear("csFinanceTurnoverAdd");var a=$("#csFinanceTurnoverAdd");a.find("input[name=placerShow]").val(currentUserAid+"："+currentUserName);
a.find("input[name=placerId]").val(currentUserId);a.find("input[name=placerAid]").val(currentUserAid);a.find("input[name=placerName]").val(currentUserName);
a.find("input[name=csId]").val(this.params.csId);},_initTable:function(d){var a=this;var c=false;$("#csTurnoverDiv").empty().append("<table class='table table-bordered table-stripped' id='csTurnoverTable'>"+"<thead>"+"<tr>"+"<th width='4%'></th><th width='8%'>订单编号</th>"+"<th width='8%'>产品</th>"+"<th width='8%'>金额</th>"+"<th width='8%'>下单人</th>"+"<th width='9%'>开户时间</th>"+"<th width='9%'>到期时间</th></tr>"+"</thead></table>");
var b=ctx+"/crm/finance/financeTurnover/findByCsId.htm?csId="+d.csId;$("#csTurnoverTable").DataTable({ajax:{url:b},columns:[{data:"lineNum"},{data:"soNo"},{data:"prodName"},{data:"amount"},{data:"placerName"},{data:"startTime",render:function(h,g,f){var e="<span title='"+h+"'>"+DateUtils.miniTime(h)+"</span>";
return e;}},{data:"endTime",render:function(h,g,f){var e="<span title='"+h+"'>"+DateUtils.miniTime(h)+"</span>";return e;}}],rowId:"id",lengthMenu:[[20],],fnRowCallback:function(h,g,f,e){if(f==0){addd=0;
}addd+=parseFloat(g["amount"]);$("#totalAmountsum").html(addd.toFixed(2)+"(元)");return h;},paging:true,pagingType:"simple",searching:false,lengthChange:false,autoWidth:false,ordering:false,});
},_save:function(){var b=this;var a=CsFinanceTurnover._CONS_.SAVE_ADD_URL;FormUtils.submitByFormId(a,"csFinanceTurnoverAdd",function(c){if(c.success){DialogUtils.success(msgCode.INFO,c.msg);
}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}layer.close(b.layerIndex);b._initTable(b.params);},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});},_bindFormValidation:function(){var a={rules:{"soNo":{required:true},"amount":{required:true,},"prodName":{required:true,},"startTime":{required:true,},"endTime":{required:true,},}};
FormUtils.bindFormValidation("csFinanceTurnoverAdd",a);},};