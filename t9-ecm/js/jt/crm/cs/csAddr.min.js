function CsAddr(){this.csType="";this.employeeId="";this.permissionType="";this.hasFlash=false;}CsAddr.prototype={init:function(){this._bindEventHander();
},_bindEventHander:function(){var a=this;$(document).on("click",".addAddr",function(){var c=new ShopAddrOpt();var b=$("input[name=id]").val();c.init({csId:b,callBack:function(f){$(".noConformData").empty();
$(".addrli").hide();var e=[];e.push(f);$(".addrDiv").append(a.fillAddr(a,e));$(".addrDivBtn").empty();for(var d=0;d<e.length;d++){a.loadArea(e[d],"addressContainer"+e[d].id);
}$(".addrDiv li").last().show();if($(".addrDiv li").length>1){$(".showAddrList").show();}else{$(".showAddrList").hide();}}});});$(document).on("click",".showMapWeather",function(){var c=$(this).attr("idVal");
var d=$(this).parents("li").find("select[name=city_]").val();var b=$(this).parents("li").find("select[name=city_]").find('option[value="'+d+'"]').text();
FormUtils.submit(ctx+"/crm/cs/csEntity/addr/loadMapInfo.htm",{addrId:c},function(e){if(e.status=="200"){DialogUtils.error("提示",e.message);}else{JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/mapWeatherForm.htm?cityName="+b+"&longitude="+e.result.locationPo.lng+"&latitude="+e.result.locationPo.lat,"地图|天气");
}});});$(document).on("click",".edit-addr",function(){$(this).hide();$(this).next().show();var h=$(this).attr("idVal");var g=$(this).parents("li");g.find("input,select").removeAttr("disabled");
var f=g.find("select[name=country_]").val();var b=g.find("select[name=province_]").val();var e=g.find("select[name=city_]").val();var d=g.find("select[name=area_]").val();
var c=g.find("select[name=town_]").val();this.addressService=new AddressService("addressContainer"+h);this.addressService.init({country:f,province:b,city:e,area:d,town:c,isSelect:"y",isNotRequired:true,disabled:false});
}),$(document).on("change",".addrMobile",function(){$(this).next().val($(this).val());});$(document).on("change",".csAddrDetail",function(){$(this).next().val($(this).val());
});$(document).on("click",".save-addr",function(){var e=$(this).attr("idVal");var k=$(this);var l=$(this).parents("li");var h="id="+e;h+="&csId="+$("input[name=id]").val();
var b=l.find("input[name=addrName]").val();var n=l.find("input[name=addr]");var f=l.find("select[name=province_]").val();var o=l.find("select[name=province_]").find('option[value="'+f+'"]').text();
var i=l.find("select[name=city_]").val();var q=l.find("select[name=city_]").find('option[value="'+i+'"]').text();var d=l.find("select[name=area_]").val();
var j=l.find("select[name='area_']").find("option[value='"+d+"']").text();var m=l.find("select[name=town_]").val();var p=l.find("select[name='town_']").find("option[value='"+m+"']").text();
var c=l.find("input[name=mobile]");var g=l.find("select[name=isDefault]").val();if(b){h+="&name="+b;}else{DialogUtils.error("提示","请填写联系人");return;}if(n.val()){h+="&addr="+n.val();
}else{DialogUtils.error("提示","请填写地址");return;}if(f){h+="&prRid="+f;h+="&prName="+o;}else{DialogUtils.error("提示","请填写省市区");return;}if(i){h+="&ciRid="+i;
h+="&ciName="+q;}else{DialogUtils.error("提示","请填写省市区");return;}if(c.val()){h+="&mobile="+c.val();}else{DialogUtils.error("提示","请填写手机号码");return;}if(d){h+="&arRid="+d;
h+="&arName="+j;}if(m){h+="&toRid="+m;h+="&toName="+p;}h+="&isDefault="+g;FormUtils.submit(ctx+"/crm/cs/csEntity/addr/partyAddrEditSave.htm",h,function(s){if(s.success){var r={csId:s.partyAddrPo.partyId,csType:a.csType,employeeId:a.employeeId,permissionType:a.permissionType,};
a.loadData(r);k.hide();k.prev().show();}else{DialogUtils.error("失败",s.msg);}},function(){DialogUtils.error("错误","后台异常，请稍后重试");});});$(document).on("click",".addrli",function(d){var c=d||window.event;
var b=c.target||c.srcElement;if(b.tagName.toLowerCase()=="button"){return;}$("input[name='soShipPos[0].addrId']").val($(this).attr("value"));$(".addrli").hide();
$(this).show();});$(document).on("click",".showAddrList",function(){$(".addrli").show();});$(document).on("click",".remove-addr",function(){var c=$(this).attr("idval");
var b=$("input[name=id]").val();DialogUtils.confirm(function(){if(c){FormUtils.submit(CsEntityEdit._CONS_.DEL_ADDR_URL,{id:c},function(e){if(e.success){var d={csId:b,csType:a.csType,employeeId:a.employeeId,permissionType:a.permissionType,};
a.loadData(d);}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);}});}});});},loadArea:function(d,b){var a=this;var c=new StringBuffer();c.append("<div class='col-sm-12'>");
c.append("<div class='col-sm-10 container' style='padding-left:0px !important;'>");c.append("<div class='col-sm-3' style='padding-left:0px !important;'>");
c.append("<select class='form-control' name='province_' disabled='disabled'>");if(d.prRid){c.append("<option selected='selected' value='"+d.prRid+"'>"+d.prName+"</option>");
}else{c.append("<option selected='selected' value=''>请选择</option>");}c.append("</select>");c.append("</div>");if(d.ciRid){c.append("<div class='col-sm-3' style='padding-left:0px !important;'>");
c.append("<select class='form-control' name='city_' disabled='disabled'>");c.append("<option selected='selected' value='"+d.ciRid+"'>"+d.ciName+"</option>");
c.append("</select>");c.append("</div>");}if(d.arRid){c.append("<div class='col-sm-3' style='padding-left:0px !important;'>");c.append("<select class='form-control' name='area_' disabled='disabled'>");
c.append("<option selected='selected' value='"+d.arRid+"'>"+d.arName+"</option>");c.append("</select>");c.append("</div>");}if(d.toRid){c.append("<div class='col-sm-3' style='padding-left:0px !important;'>");
c.append("<select class='form-control' name='town_' disabled='disabled'>");c.append("<option selected='selected' value='"+d.toRid+"'>"+d.toName+"</option>");
c.append("</select>");c.append("</div>");}c.append("</div>");c.append("</div>");$("#"+b).empty().append(c.toString());},loadData:function(b){var a=this;
a.csType=b.csType;a.employeeId=b.employeeId;a.permissionType=b.permissionType;FormUtils.loadData(CsEntityEdit._CONS_.EDIT_INFO_URL+"?party_id_="+b.csId,function(d){$(".addrDiv").empty();
if(d&&d.length>0){$(".addrDiv").append(a.fillAddr(d));for(var c=0;c<d.length;c++){a.loadArea(d[c],"addressContainer"+d[c].id);}a.showTheHideAddr(d);if($(".addrDiv li").length>1){$(".showAddrList").show();
}else{$(".showAddrList").hide();}}else{$(".addrDiv").append("<div class='noConformData' style='color:red;'>没有符合数据！</div>");$(".addrDivBtn").empty().append(a.buildAddBtn());
$(".showAddrList").hide();}if(b.fn&&typeof b.fn==="function"){b.fn();}},function(){},true);},buildAddBtn:function(){var a=new StringBuffer();a.append("<div class='form-group' style='margin-top: 2px;'>");
a.append("<div class='col-sm-4 pull-right'>");a.append("<button type='button' class='jt-form-select addAddr'>添加</button>");a.append("</div>");a.append("</div>");
return a.toString();},fillAddr:function(c){var a=this;var d=new StringBuffer();for(var b=0;b<c.length;b++){if(c[b].isSnapshot=="n"){d.append("<li class='addrli' id='"+c[b].id+"'"+"style='border:1px solid #CCC;list-style-type:none;position:relative;margin-top:2px;");
if((c[b].isDefault=="y"||(c.length==1&&c[b].isDefault=="n"))){$("input[name=addrId]").val(c[b].id);d.append("'>");}else{d.append("display:none;' idval=''>");
}d.append("<div class='form-group'>");d.append("<div class='col-sm-4'>");d.append("<label class='col-sm-4 control-label'>联系人</label>");d.append("<div class='col-sm-8'>");
d.append("<input type='text' name='addrName' disabled='disabled' class='form-control' validateType='default' value='"+c[b].name+"'>");d.append("</div>");
d.append("</div>");d.append("<div class='col-sm-5'>");d.append("<label class='col-sm-4 control-label'>联系方式</label>");d.append("<div class='col-sm-8'>");
d.append("<input type='text' name='addrMobile' disabled='disabled' class='form-control addrMobile' validateType='default' value='"+c[b].mobile+"'>");d.append("<input type='hidden' name='mobile' value='"+c[b].maskMobile+"'>");
d.append("</div>");d.append("</div>");d.append("<div class='col-sm-3'><label class='col-sm-4 control-label'>默认</label>");d.append("<div class='col-sm-6'>");
d.append("<select class='form-control' name='isDefault' validatetype='default' disabled='disabled'>");if(c[b].isDefault=="y"){d.append("<option value='y' selected='selected'>是</option>");
d.append("<option value='n'>否</option>");}else{d.append("<option value='y'>是</option>");d.append("<option value='n' selected='selected'>否</option>");}d.append("</select>");
d.append("</div>");d.append("</div>");d.append("</div>");d.append("<div class='form-group'>");d.append("<div class='col-sm-11'>");d.append("<label class='col-sm-1 control-label' style='margin-left:13px;'>地区</label>");
d.append("<div class='col-sm-10' id='addressContainer"+c[b].id+"'></div>");d.append("</div>");d.append("</div>");d.append("<div class='form-group'>");d.append("<div class='col-sm-8'>");
d.append("<label class='col-sm-2 control-label'>地址</label>");d.append("<div class='col-sm-10'>");if(this.csType){if("self"==this.csType||(this.permissionType&&"self"==this.permissionType)){if(ResUtils.canShow("csEntity.button.viewAddrBtn")){d.append("<input type='text' name='addr' disabled='disabled' class='form-control csAddrDetail' validateType='default' value='"+c[b].addr+"'>");
}else{d.append("<input type='text' name='addr' disabled='disabled' class='form-control csAddrDetail' validateType='default' value='"+MaskPhoneNum.maskAddr(c[b].addr)+"'>");
}}else{if("mysub"==this.csType||(this.permissionType&&"mysub"==this.permissionType)){if(ResUtils.canShow("csEntity.button.viewAddrBtnSub")){d.append("<input type='text' name='addr' disabled='disabled' class='form-control csAddrDetail' validateType='default' value='"+c[b].addr+"'>");
}else{d.append("<input type='text' name='addr' disabled='disabled' class='form-control csAddrDetail' validateType='default' value='"+MaskPhoneNum.maskAddr(c[b].addr)+"'>");
}}else{if("task"==this.csType){if(ResUtils.canShow("csEntity.button.viewAddrBtnTask")){d.append("<input type='text' name='addr' disabled='disabled' class='form-control csAddrDetail' validateType='default' value='"+c[b].addr+"'>");
}else{d.append("<input type='text' name='addr' disabled='disabled' class='form-control csAddrDetail' validateType='default' value='"+MaskPhoneNum.maskAddr(c[b].addr)+"'>");
}}else{if("callRecord"==this.csType){if(ResUtils.canShow("csEntity.button.viewAddrBtnCallRecord")){d.append("<input type='text' name='addr' disabled='disabled' class='form-control csAddrDetail' validateType='default' value='"+c[b].addr+"'>");
}else{d.append("<input type='text' name='addr' disabled='disabled' class='form-control csAddrDetail' validateType='default' value='"+MaskPhoneNum.maskAddr(c[b].addr)+"'>");
}}else{if(ResUtils.canShow("csEntity.button.viewAddrBtnSearch")){d.append("<input type='text' name='addr' disabled='disabled' class='form-control csAddrDetail' validateType='default' value='"+c[b].addr+"'>");
}else{d.append("<input type='text' name='addr' disabled='disabled' class='form-control csAddrDetail' validateType='default' value='"+MaskPhoneNum.maskAddr(c[b].addr)+"'>");
}}}}}}d.append("<input type='hidden' name='maskAddr' value='"+c[b].maskAddr+"'>");d.append("</div>");d.append("</div>");d.append("</div>");d.append("</div>");
d.append("<div class='form-group'>");d.append("<div class='col-sm-1'>");d.append("</div>");d.append("<div class='col-sm-6'>");d.append("<button type='button' class='btn btn-sm btn-outline btn-primary showMapWeather'  idVal='"+c[b].id+"'>地图|天气</button>");
d.append("</div>");d.append("<div class='col-sm-5'>");d.append("<button type='button' class='btn btn-sm btn-outline btn-primary edit-addr' idVal='"+c[b].id+"'>编辑</button>");
d.append("<button type='button' class='btn btn-sm btn-outline btn-primary save-addr' style='display:none;' idVal='"+c[b].id+"'>保存</button>");d.append("&nbsp;<button type='button' class='btn btn-sm btn-outline btn-primary addAddr'>添加</button>");
d.append("&nbsp;<button type='button' class='btn btn-sm btn-outline btn-primary showAddrList'>更多地址</button>&nbsp;");if(this.csType){if("self"==this.csType||(this.permissionType&&"self"==this.permissionType)){if(ResUtils.canShow("csEntity.button.deleteAddrBtn")){d.append("<button type='button' class='btn btn-sm btn-outline btn-danger remove-addr' idval='"+c[b].id+"'>删除</button>");
}}else{if("mysub"==this.csType||(this.permissionType&&"mysub"==this.permissionType)){if(ResUtils.canShow("csEntity.button.deleteAddrBtnSub")){d.append("<button type='button' class='btn btn-sm btn-outline btn-danger remove-addr' idval='"+c[b].id+"'>删除</button>");
}}else{if("task"==this.csType&&ResUtils.canShow("csEntity.button.deleteAddrBtnTask")){d.append("<button type='button' class='btn btn-sm btn-outline btn-danger remove-addr' idval='"+c[b].id+"'>删除</button>");
}else{if("callRecord"==this.csType&&ResUtils.canShow("csEntity.button.deleteAddrBtnCallRecord")){d.append("<button type='button' class='btn btn-sm btn-outline btn-danger remove-addr' idval='"+c[b].id+"'>删除</button>");
}else{if(ResUtils.canShow("csEntity.button.deleteAddrBtnSearch")){d.append("<button type='button' class='btn btn-sm btn-outline btn-danger remove-addr' idval='"+c[b].id+"'>删除</button>");
}}}}}}d.append("</div>");d.append("</div>");d.append("</li>");}}return d.toString();},showTheHideAddr:function(a){if($(".addrDiv").find("li[idval]").length==a.length){$(".addrDiv").find(".addrli").eq(0).show();
}}};