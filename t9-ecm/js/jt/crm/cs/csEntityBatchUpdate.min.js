function CsEntityBatchUpdate(){this.hadInit=false;this.params=null;this.searchParam=null;this.count=null;}CsEntityBatchUpdate._CONS_={CSENTITY_BATCH_UPDATE:ctx+"/crm/cs/csEntity/csBatchUpdate.htm",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",FORM:"#csBatchUpdateForm",};
CsEntityBatchUpdate.prototype={init:function(b){var a=this;if(!this.hadInit){this.hadInit=true;this._bindEventHanlder();if(b.isSea){$(".batchUpdateAidTr").hide();
}this.searchParam=b.searchParam;this.count=b.count;this._csEntityBatchUpdate();}},_csEntityBatchUpdate:function(){var a=this;$("#batchUpdateModalLabel").html("批量修改&emsp;<span>您正在对<font style='color:red;'>【"+a.count+"个】</font>客户进行批量修改操作。<font style='color:red;'>提示：只有勾选才有效</font><span>");
a._loadData();$("#batchUpdateContainer").modal("show");},_bindEventHanlder:function(){var a=this;$("#batchUpdateCancel").off("click").on("click",function(){FormUtils.clear(CsEntityBatchUpdate._CONS_.FORM);
$("#systemTagSelect").chosen("destroy");$(".columnCheckBox").prop("checked",false);});$("#batchUpdateSave").off("click").on("click",function(){if($("input[name=batchUpdateName]").val()&&!$("#checkName").is(":checked")){DialogUtils.error(msgCode.ERROR,"请勾选客户姓名");
return;}if($("input[name=batchUpdateDesc]").val()&&!$("#checkDesc").is(":checked")){DialogUtils.error(msgCode.ERROR,"请勾选客户备注");return;}if($("select[name=employeeIdSearch]").val()&&!$("#checkAid").is(":checked")){DialogUtils.error(msgCode.ERROR,"请勾选归属工号");
return;}if($("#batchUpdateBizType").val()&&!$("#checkBizType").is(":checked")){DialogUtils.error(msgCode.ERROR,"请勾选客户分类");return;}if($(".batchUpdateSrcVal").val()&&!$("#checkSrc").is(":checked")){DialogUtils.error(msgCode.ERROR,"请勾选渠道来源");
return;}if($("#batchUpdateInterest").val()&&!$("#checkInterest").is(":checked")){DialogUtils.error(msgCode.ERROR,"请勾选客户意向");return;}if($("#batchUpdateTag").val()&&!$("#checkTag").is(":checked")){DialogUtils.error(msgCode.ERROR,"请勾选客户标签");
return;}if($("#batchUpdateEntry").val()&&!$("#checkEntry").is(":checked")){DialogUtils.error(msgCode.ERROR,"请勾选进线方式");return;}if($("#batchUpdateProd").val()&&!$("#checkProductName").is(":checked")){DialogUtils.error(msgCode.ERROR,"请勾选产品意向");
return;}DialogUtils.confirmWithOptions({title:"确定批量修改当前选择记录？",text:"",confirmButtonText:"确定",yesFunc:function(){a._batchUpdate(a.searchParam,a.count);$("#batchUpdateContainer").modal("hide");
$(".columnCheckBox").prop("checked",false);$("#batchUpdateTag").chosen("destroy");FormUtils.clear("csEntitySearchForm");FormUtils.clear(CsEntityBatchUpdate._CONS_.FORM);
$("#csEntitySearchForm").find(".csEntitySearch").trigger("click");}});});},_batchUpdate:function(f,g){f.count=g;var i=$("input[name=batchUpdateName]").val();
if($("#checkName").is(":checked")&&i){f.nameType=$("#nameType").val();f.newName=i;}var c=$("input[name=batchUpdateDesc]").val();if($("#checkDesc").is(":checked")&&c){f.descType=$("#descType").val();
f.newDesc=c;}var e=$("select[name=employeeIdSearch]").val();if($("#checkAid").is(":checked")&&e){f.newId=e;}var a=$("#batchUpdateBizType").val();if($("#checkBizType").is(":checked")){if(a){f.newBizType=a;
}else{f.newBizType="isNull";}}var j=$(".batchUpdateSrcVal").val();if($("#checkSrc").is(":checked")){if(j){f.newSrcs=j;}else{f.newSrcs="isNull";}}var h=$("#batchUpdateInterest").val();
if($("#checkInterest").is(":checked")){if(h){f.newInterest=h;}else{f.newInterest="isNull";}}var k=$("#batchUpdateTag").val();if($("#checkTag").is(":checked")){if(k){f.newTag=k;
}else{f.newTag="isNull";}}var b=$("#batchUpdateEntry").val();if($("#checkEntry").is(":checked")){if(b){f.newEntry=b;}else{f.newEntry="isNull";}}var d=$("#batchUpdateProd").val();
if($("#checkProductName").is(":checked")){if(d){f.newProd=d;}else{f.newProd="isNull";}}FormUtils.submit(CsEntityBatchUpdate._CONS_.CSENTITY_BATCH_UPDATE,f,function(l){if(l.success){DialogUtils.success(msgCode.INFO,"批量修改成功");
}else{DialogUtils.error(msgCode.ERROR,"批量修改失败");}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},_loadData:function(){var a=this;CateUtils.getOptions({typeKey:"system",pKey:"CsBizTypes",container:"batchUpdateBizType"});
CateUtils.getOptions({typeKey:"system",pKey:"CsInterestType",container:"batchUpdateInterest"});CateUtils.getOptions({typeKey:"system",pKey:"CsEntryType",container:"batchUpdateEntry"});
systemTagUtil._buildCsTag(null,{module:systemTagUtil._CONS_.CS_MODULE,type:systemTagUtil._CONS_.CS_TYPE,container:"batchUpdateTag",selectType:"multiple"});
a._buildEmployeeOption();a._channelSearch();a._prodSearch();},_prodSearch:function(h){$("#batchUpdateProd").bsSuggest("destroy");var i=this;var b="entity";
var g="n";var c="n";var f="prodEntity-csEntity";var d=window.sessionStorage.getItem(f);if(d){var e=JSON.parse(d);i._prodSearchSuggest(e);}else{var a=ctx+"/ec/product/prodEntity/search.htm?prodType="+b+"&hasStock="+g+"&storeId="+"&limitProdCate="+c+"&keyword=";
FormUtils.loadData(a,function(j){window.sessionStorage.setItem(f,JSON.stringify(j));i._prodSearchSuggest(j);});}},_prodSearchSuggest:function(c){var a=this;
a.searchProds=c.value;var b=$("#batchUpdateProd").width()+"px";$("#batchUpdateProd").bsSuggest({effectiveFields:["prodName"],searchFields:["prodName","skuCode"],effectiveFieldsAlias:{prodName:"产品名字"},showBtn:false,idField:"skuId",keyField:"skuCode",showBtn:false,twoWayMatch:false,ignorecase:true,allowNoKeyword:true,multiWord:false,autoSelect:false,delayUntilKeyup:false,data:c,getDataMethod:"data",processData:function(d){return d;
},listStyle:{"padding-top":0,"max-height":"500px","max-width":b,"overflow":"auto","width":"auto","transition":"0.3s","-webkit-transition":"0.3s","-moz-transition":"0.3s","-o-transition":"0.3s"}}).on("onDataRequestSuccess",function(f,d){a.searchProds=d.value;
}).on("onSetSelectValue",function(g,d){for(var f=0;f<a.searchProds.length;f++){if(a.searchProds[f].skuId==d.id){a.currentProd=a.searchProds[f];break;}}$("#batchUpdateProd").val(a.currentProd.prodName);
}).on("onUnsetSelectValue",function(d){a.currentProd={};});},_channelSearch:function(){$("#batchUpdateSrc").bsSuggest("destroy");var a=this;var b=$("#batchUpdateSrc").width()+"px";
$("#batchUpdateSrc").bsSuggest({url:ctx+"/ec/media/mediaChannel/search.htm",effectiveFields:["name"],searchFields:["name"],effectiveFieldsAlias:{name:"渠道名称"},showBtn:false,idField:"id",keyField:"name",showBtn:false,twoWayMatch:false,ignorecase:true,allowNoKeyword:true,multiWord:false,autoSelect:false,delayUntilKeyup:false,getDataMethod:"firstByUrl",processData:function(c){a.searchChannels=c.value;
return c;},listStyle:{"padding-top":0,"max-height":"500px","max-width":b,"overflow":"auto","width":"auto","transition":"0.3s","-webkit-transition":"0.3s","-moz-transition":"0.3s","-o-transition":"0.3s"}}).on("onDataRequestSuccess",function(d,c){a.searchChannels=c.value;
}).on("onSetSelectValue",function(f,d){for(var c=0;c<a.searchChannels.length;c++){if(a.searchChannels[c].id==d.id){a.currentChannel=a.searchChannels[c];
break;}}$(".batchUpdateSrcVal").val(a.currentChannel.id);$("#batchUpdateSrc").val(a.currentChannel.name);}).on("onUnsetSelectValue",function(c){a.currentChannel={};
});},_buildEmployeeOption:function(){var a=CsEntityBatchUpdate._CONS_.EMPLOYEE_LIST_URL+"?groupId=&type=dept_manager";FormUtils.loadData(a,function(c){$("select[name=employeeIdSearch]").empty();
if(c&&c.length>0){var d=new StringBuffer();d.append("<option value=''>请选择</option>");for(var b=0;b<c.length;b++){d.append("<option value='"+c[b].id+"'>"+c[b].aid+":"+c[b].name+"</option>");
}$("select[name=employeeIdSearch]").append(d.toString()).select2();}},null,true);},};