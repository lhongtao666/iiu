$(function(){var a=new CsComplain();a.init();});function CsComplain(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.csComplainFollow=new CsComplainFollow();
this.csComplainAdd=new CsComplainAdd();this.selectedJqgrid=new Array();this.canDeleteFollow=false;}CsComplain._CONS_={EDIT_URL:ctx+"/crm/cs/csComplain/edit.htm",SAVE_ADD_URL:ctx+"/crm/cs/csComplain/saveAdd.htm",SAVE_EDIT_URL:ctx+"/crm/cs/csComplain/saveEdit.htm",LIST_DATA_URL:ctx+"/crm/cs/csComplain/listData.htm",EDIT_FORM_ID:"csComplainForm",GRID:"#csComplainGrid",PAGER:"#csComplainPager",FIND_ALL_EMPLOYEE:ctx+"/crm/ou/employee/listEmployees.htm",FIND_ORDER:ctx+"/ec/salesorder/soEntity/findOrderByCsId.htm",FIND_ORDER_ITEM:ctx+"/ec/salesorder/soEntity/findSoItem.htm",APPLY_DELAY_URL:ctx+"/crm/cs/csComplain/applyDelay.htm",LIST_PP_DATA_URL:ctx+"/crm/cs/csEntity/findByNameOrCode.htm",ARRANGE_FOLLOW_URL:ctx+"/crm/cs/csComplain/arrangeFollow.htm",REJRCT_DELAY_URL:ctx+"/crm/cs/csComplain/rejectDelay.htm",COMFIRM_DELAY_URL:ctx+"/crm/cs/csComplain/comfirmDelay.htm",DELET_FOLLOW_URL:ctx+"/crm/cs/csComplain/delteFollow.htm",DELET_URL:ctx+"/crm/cs/csComplain/delete.htm",EXPORT_URL:ctx+"/crm/cs/csComplain/export.htm",CHECK_CS_URL:ctx+"/crm/cs/csComplain/checkCs.htm",};
CsComplain.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindFormValidation();this._bindEventHander();this._initJqgrid();this._hideNotGrantBtn();
this._initInputAndOption();this.fillAllEmployees();}this._locateToGlHelp();},_locateToGlHelp:function(){if(type=="self"){var a="glHelp.csEntity.myComplain";
}if(type=="all"){var a="glHelp.csEntity.csComplain";}glHelpUtil.init(a);},_hideNotGrantBtn:function(){if(!ResUtils.canShow("csComplain.button.add")){$(".csComplainAdd").hide();
}if(!ResUtils.canShow("csComplain.button.delete")){$(".csComplainDel").hide();}if(!ResUtils.canShow("csComplain.button.edit")){$(".csComplainEdit").hide();
}if(!ResUtils.canShow("csComplain.button.rejectDelay")){$(".rejectDelay").hide();}if(!ResUtils.canShow("csComplain.button.comfirmDelay")){$(".comfirmDelay").hide();
}if(!ResUtils.canShow("csComplain.button.follow")){$(".csComplainFollow").hide();}if(!ResUtils.canShow("csComplain.button.applyDelay")){$(".batchApplyDealy").hide();
}if(!ResUtils.canShow("csComplain.button.export")){$(".csComplainExport").hide();}if(!ResUtils.canShow("myCsComplain.button.export")){$(".myCsComplainExport").hide();
}if(ResUtils.canShow("csComplain.button.deleteFollow")){this.canDeleteFollow=true;}},clear:function(c){var a=this;function b(){a._showListWrapper();a.isFormDataChange=false;
a.isEdit=false;$(".form_wrapper .saveBtn").show();FormUtils.clear(CsComplain._CONS_.EDIT_FORM_ID);if(c){a.reloadJqgrid();}}if(a.isEdit&&a.isFormDataChange){DialogUtils.warning(function(){b();
});}else{b();}},_showListWrapper:function(){$(".list_wrapper").show();$(".form_wrapper").hide();},_showFormWrapper:function(){$(".list_wrapper").hide();
$(".form_wrapper").show();},_add:function(){this._showFormWrapper();$(".saveBtn").hide();$(".saveAddBtn").show();$("#applyDelayDiv").hide();$("#complainFollowListDiv").hide();
$("[name=csCode]").attr("readonly",false);$("[name=soId]").attr("disabled",false).empty();$("[name=status]").attr("disabled",false);$("select[name=complainId]").select2();
$("select[name=followId]").attr("disabled",false).select2();$("select[name=skuIds]").empty().chosen("destroy");},_edit:function(a){$(".saveBtn").show();
$(".saveAddBtn").hide();this._showFormWrapper();this.edit=true;$("[name=csCode]").attr("readonly",true);$("[name=soId]").attr("disabled",true);$("[name=status]").attr("disabled",true);
$("#complainFollowListDiv").show();this._loadData(a);},_loadData:function(b){var a=this;FormUtils.loadData(CsComplain._CONS_.EDIT_URL+"?id="+b,function(c){a._fillForm(c);
a._fillFollowList(c);a._fillDelayDetail(c);if("self"==type){a._handleForSelf();}else{if("list"){a._handleForList();}}});},_save:function(){var b=this;if($("#csComplainForm").valid()){var a=CsComplain._CONS_.SAVE_EDIT_URL;
ButtonUtils.disableBtn("saveBtn");var c=$("#csComplainForm").serialize()+"&"+$("#applyDelayForm").serialize();FormUtils.submit(a,c,function(d){ButtonUtils.enableBtn("saveBtn");
if(d.success){if(d.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);}else{if(d.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
}}b.isEdit=false;b.clear(true);}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);}},function(){ButtonUtils.enableBtn("saveBtn");DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}},_bindEventHander:function(){$("body").on("click",".deleteComplainFollow",function(){var b=$(this).attr("attr-id");a._deleteFollow(b,this);});var a=this;
$(document).on("click",".prevBtn",function(){a.clear(false);});$(document).on("click",".saveBtn",function(){a._save();});$(document).on("click",".saveAddBtn",function(){a._saveAdd();
});$(document).on("click",".applyDelay",function(){var b=$("input[name=id]").val();a.openAddDelayReasonView(b);});$("#"+CsComplain._CONS_.EDIT_FORM_ID).on("change","input",function(){if(a.isEdit){a.isFormDataChange=true;
}});$("#"+CsComplain._CONS_.EDIT_FORM_ID).on("change","select",function(){if(a.isEdit){a.isFormDataChange=true;}});$("#"+CsComplain._CONS_.EDIT_FORM_ID).on("change","textarea",function(){if(a.isEdit){a.isFormDataChange=true;
}});$(".list_wrapper").on("click",".csComplainSearch",function(){var b=$(this).closest("form").serialize();a.reloadJqgrid(b);});$(".toolbar-panel").on("keypress","form",function(b){if(b.keyCode=="13"){var c=$(this).closest("form").serialize();
a.reloadJqgrid(c);return false;}});$("body").on("click",".csComplainDel",function(){var b=$(this).attr("idVal");if(!b){if(!a.selectedJqgrid||a.selectedJqgrid.length==0){DialogUtils.error("错误","请选择要删除的记录");
return;}b=a.selectedJqgrid;}a._delete(b);});$("body").on("click",".csComplainAdd",function(){a._add();});$("body").on("change","input[name='csCode']",function(){a._checkCsAndOrder($(this).val());
});$("[name=soId]").on("change",function(){$("#skuIdsDiv").empty().append("<select multiple data-placeholder='请选择' class='chosen-select form-control' name='skuIds' ></select>");
if($(this).val()){a.csComplainAdd.findSoItem($(this).val());}else{$("select[name=skuIds]").chosen("destroy");$("select[name=skuIds]").chosen();}});$("body").on("click",".csComplainEdit",function(){a.isEdit=true;
var b=$(this).attr("idVal");if(!b){if(!a.selectedJqgrid||a.selectedJqgrid.length==0){DialogUtils.error("错误","请选择要更新的记录");return;}if(a.selectedJqgrid.length>1){DialogUtils.error("错误","不能同时编辑多条记录");
return;}b=a.selectedJqgrid[0];}a._edit(b);});$("body").on("click",".csComplainFollow",function(){var b=$(this).attr("idVal");if(!b){if(!a.selectedJqgrid||a.selectedJqgrid.length==0){DialogUtils.error("错误","请选择要安排跟进的投诉");
return;}b=a.selectedJqgrid.toString();}a.openArrangeFollowView(b);});$("body").on("click",".rejectDelay",function(){var b=$(this).attr("idVal");if(!b){if(!a.selectedJqgrid||a.selectedJqgrid.length==0){DialogUtils.error("错误","请选择要拒绝的延期申请");
return;}for(var c=0;c<a.selectedJqgrid.length;c++){var d=$("#csComplainGrid").jqGrid("getRowData",a.selectedJqgrid[c]);if(d.delayStatus!="awaiting_comfirm"){DialogUtils.error("错误","只能对待审核状态的记录进行拒绝操作");
return;}}b=a.selectedJqgrid.toString();}else{var d=$("#csComplainGrid").jqGrid("getRowData",b);if(d.delayStatus!="awaiting_comfirm"){DialogUtils.error("错误","只能对待审核状态的记录进行拒绝操作");
return;}}a.openDelayReasonView(b);});$("body").on("click",".comfirmDelay",function(){var b=$(this).attr("idVal");if(!b){if(!a.selectedJqgrid||a.selectedJqgrid.length==0){DialogUtils.error("错误","请选择要批准的延期申请");
return;}for(var c=0;c<a.selectedJqgrid.length;c++){var d=$("#csComplainGrid").jqGrid("getRowData",a.selectedJqgrid[c]);if(d.delayStatus!="awaiting_comfirm"){DialogUtils.error("错误","只能对待审核状态的记录进行批准操作");
return;}}b=a.selectedJqgrid.toString();}else{var d=$("#csComplainGrid").jqGrid("getRowData",b);if(d.delayStatus!="awaiting_comfirm"){DialogUtils.error("错误","只能对待审核状态的记录进行批准操作");
return;}}a.comfirmDelay(b);});$("body").on("click",".batchApplyDealy",function(){var b=$(this).attr("idVal");if(!b){if(!a.selectedJqgrid||a.selectedJqgrid.length==0){DialogUtils.error("错误","请选择要申请延期的记录");
return;}for(var c=0;c<a.selectedJqgrid.length;c++){var d=$("#csComplainGrid").jqGrid("getRowData",a.selectedJqgrid[c]);if(d.delayStatus!=""){DialogUtils.error("错误","已经申请过延期的记录不能重复申请");
return;}if(d.remainHour>24){DialogUtils.error("错误","只能对剩余时间少于24小时的记录进行延期申请");return;}}b=a.selectedJqgrid.toString();}else{var d=$("#csComplainGrid").jqGrid("getRowData",b);
if(d.delayStatus!=""){DialogUtils.error("错误","已经申请过延期的记录不能重复申请");return;}if(d.remainHour>24){DialogUtils.error("错误","只能对剩余时间少于24小时的记录进行延期申请");return;}}a.openAddDelayReasonView(b,function(){a.reloadJqgrid();
});});$("body").on("click",".csTab",function(){var c=$(this).text();var b=$(this).attr("value");if(c.length>4){c="*"+c.substring(c.length-3,c.length);}JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/detail.htm"+"?csId="+b,"客户["+c+"]明细");
});$(document).on("click",".csComplainExport",function(){var c=$(this).closest("form").serialize();var b=CsComplain._CONS_.EXPORT_URL+"?"+c;b+="&type="+type+"&followId="+currentUserId+"&isShowMoreTarget="+isShowMoreTarget;
DialogUtils.success(msgCode.SUCCESS,"正在导出....");FormUtils.loadData(b,function(d){},function(){},true);});$(document).on("click",".myCsComplainExport",function(){var c=$(this).closest("form").serialize();
var b=CsComplain._CONS_.EXPORT_URL+"?"+c;b+="&type="+type+"&followId="+currentUserId+"&isShowMoreTarget="+isShowMoreTarget;DialogUtils.success(msgCode.SUCCESS,"正在导出....");
FormUtils.loadData(b,function(d){},function(){},true);});},_checkCsAndOrder:function(c){var b=this;var d=/^\d*$/;if(d.test(c)){var a=CsComplain._CONS_.CHECK_CS_URL;
FormUtils.submit(a,{csCode:c},function(f){if(f.success){var e=JSON.parse(f.msg);b.csComplainAdd.findOrders(e.id);$("input[name='csId']").val(e.id);}else{DialogUtils.error(msgCode.ERROR,f.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}else{DialogUtils.error(msgCode.ERROR,"客户编码格式不正确");}},_saveAdd:function(){var c=this;
if($("#csComplainForm").valid()){var a=CsComplainAdd._CONS_.SAVE_ADD_URL;var e=$("#csComplainForm").serialize();var b=$("#csComplainType option:selected").attr("firstCateId");
var d=$("#csComplainType option:selected").val();if(b){e=e+"&firstType="+b;}if(d==b){e=e+"&isFirstType=true";}else{e=e+"&isFirstType=false";}ButtonUtils.disableBtn("saveAddBtn");
FormUtils.submit(a,e,function(f){ButtonUtils.enableBtn("saveAddBtn");if(f.success){DialogUtils.success("提示","保存投诉成功");c.clear(true);}else{DialogUtils.error("失败","保存投诉失败，请稍后重试");
}},function(){ButtonUtils.enableBtn("saveAddBtn");DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}},_delete:function(b){var a=this;DialogUtils.confirm(function(){FormUtils.submit(CsComplain._CONS_.DELET_URL,{ids:b},function(c){if(c.success){DialogUtils.success(msgCode.INFO,"删除成功");
a.clear(true);}else{DialogUtils.error(msgCode.ERROR,"删除失败");}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});},_deleteFollow:function(c,b){var a=this;
DialogUtils.confirm(function(){FormUtils.submit(CsComplain._CONS_.DELET_FOLLOW_URL,{id:c},function(d){if(d.success){DialogUtils.success(msgCode.INFO,"删除成功");
$(b).parents("tr").remove();}else{DialogUtils.error(msgCode.ERROR,"删除失败");}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});},_bindFormValidation:function(){var a={rules:{"type":{required:true,},"soId":{required:true,},"skuIds":{required:true,},"complainId":{required:true,},}};
FormUtils.bindFormValidation("csComplainForm",a);},reloadJqgrid:function(b){var a=this;a.selectedJqgrid=new Array();JTJqgridUtils.reloadJqgrid(CsComplain._CONS_.GRID,b);
},_getManagerBtns:function(){var a=[];if("all"==type&&ResUtils.canShow("csComplain.button.edit")){a.push({lable:"编辑",btnClasses:"btn btn-primary csComplainEdit",iconClasses:"fa fa-edit"});
}if("all"==type&&ResUtils.canShow("csComplain.button.follow")){a.push({lable:"安排跟进",btnClasses:"btn btn-primary csComplainFollow",iconClasses:"fa fa-edit"});
}if("all"==type&&ResUtils.canShow("csComplain.button.comfirmDelay")){a.push({lable:"通过延期申请",btnClasses:"btn btn-primary comfirmDelay",iconClasses:"fa fa-edit"});
}if("all"==type&&ResUtils.canShow("csComplain.button.rejectDelay")){a.push({lable:"拒绝延期申请",btnClasses:"btn btn-primary rejectDelay",iconClasses:"fa fa-edit"});
}if("self"==type&&ResUtils.canShow("csComplain.button.edit")){a.push({lable:"跟进",btnClasses:"btn btn-primary csComplainEdit",iconClasses:"fa fa-edit"});
}if("self"==type&&ResUtils.canShow("csComplain.button.applyDelay")){a.push({lable:"申请延期",btnClasses:"btn btn-primary batchApplyDealy",iconClasses:"fa fa-edit"});
}return a;},_initJqgrid:function(){var a=this;$(CsComplain._CONS_.GRID).JTJqgrid({url:CsComplain._CONS_.LIST_DATA_URL+"?type="+type+"&followId="+currentUserId+"&isShowMoreTarget="+isShowMoreTarget,pager:CsComplain._CONS_.PAGER,autoScroll:true,shrinkToFit:false,colNames:["csId","客户","投诉类型","投诉订单","投诉产品","投诉工号","跟进工号","提交时间","处理时间","处理结果","状态","状态（隐藏）","剩余时间","剩余时间（隐藏）","延期状态(隐藏)","延期状态","操作"],colModel:[{name:"csId",index:"cs_id_",width:100,hidden:true},{name:"csName",index:"cs_id_",width:80,formatter:function(b,c,d){return"<a href='#' class='csTab' value='"+d.csId+"'>"+b+"</a>";
}},{name:"type",index:"type_",width:150,formatter:function(b,c,d){if(d.type){return d.typeName;}else{return d.firstTypeName;}}},{name:"soNo",index:"so_id_",width:100},{name:"skuNames",index:"sku_ids_",width:180},{name:"complainAid",index:"complain_id_",width:80,formatter:function(b,c,d){if(d.complainAid){return d.complainAid+":"+d.complainName;
}return d.complainAid;}},{name:"followAid",index:"follow_id_",width:80,formatter:function(b,c,d){if(d.followAid){return d.followAid+":"+d.followName;}return d.followAid;
}},{name:"createTime",index:"create_time_",width:100,formatter:function(b){return DateUtils.miniTime(b);}},{name:"completeTime",index:"complete_time_",width:100,formatter:function(b){return DateUtils.miniTime(b);
}},{name:"dealResult",index:"deal_result_",width:80},{name:"statusShow",index:"status_",width:80,formatter:function(b,d,e){var c=e.status;if(c=="new"){c="新增";
}else{if(c=="follow"){c="跟进中";}else{if(c=="complete"){c="完成";}}}return c;}},{name:"status",index:"status_",hidden:true},{name:"remainHourShow",index:"complete_time_",width:80,formatter:function(b,c,e){var d=e.remainHour;
if(d<0){d=0;}if(d<=24){d="<span style='color:red'>"+d+"</span>";}return d+"小时";}},{name:"remainHour",index:"deal_result_",hidden:true},{name:"delayStatus",index:"deal_result_",hidden:true},{name:"delayStatusShow",index:"delay_status_",width:60,formatter:function(b,d,e){var c=e.delayStatus;
if(c=="awaiting_comfirm"){c="待审核";}else{if(c=="comfirm"){c="审核通过";}else{if(c=="reject"){c="否决";}}}return c;}},{name:"__manage",width:60,classes:"rowOps",sortable:false,align:"center",formatter:"manage",title:"操作",formatoptions:this._getManagerBtns()}],loadComplete:function(){for(var b=0;
b<a.selectedJqgrid.length;b++){$(CsComplain._CONS_.GRID).jqGrid("setSelection",a.selectedJqgrid[b]);}},onSelectAll:function(d,b){if(d&&d.length>0){for(var c=0;
c<d.length;c++){if(b){if(a.selectedJqgrid.indexOf(d[c])==-1){a.selectedJqgrid.push(d[c]);}}else{a.selectedJqgrid.remove(d[c]);}}}},onSelectRow:function(c,b){if(b){if(a.selectedJqgrid.indexOf(c)==-1){a.selectedJqgrid.push(c);
}}else{a.selectedJqgrid.remove(c);}}});},fillAllEmployees:function(){var a=this;$.ajax({type:"GET",url:CsComplain._CONS_.FIND_ALL_EMPLOYEE+"?type=all",contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(g){if(g&&g.length>0){var j=new StringBuffer();
j.append("<option value=''>请选择</option>");for(var f=0;f<g.length;f++){j.append("<option value='"+g[f].id+"'>"+g[f].aid+":"+g[f].name+"</option>");}var e=new StringBuffer();
e.append('<select name="complainId" class="form-control " >');e.append(j.toString());e.append("</select>");$("#complainId").empty().append($(e.toString()));
var h=new StringBuffer();h.append('<select name="followId" class="form-control " >');h.append(j.toString());h.append("</select>");$("#followId").empty().append($(h.toString()));
var d=new StringBuffer();d.append('<select name="Q__S__EQ__complain.complain_id_" class="form-control " >');d.append(j.toString());d.append("</select>");
$("#complainSearch").empty().append($(d.toString())).find("select").select2();var b=new StringBuffer();b.append('<select name="Q__S__EQ__complain.follow_id_" class="form-control " >');
b.append(j.toString());b.append("</select>");$("#followSearch").empty().append($(b.toString())).find("select").select2();var c=new StringBuffer();c.append('<select name="arrangeFollow" class="form-control" style="width:100%" >');
c.append(j.toString());c.append("</select>");$("#arrangeFollow").empty().append($(c.toString())).find("select").select2();}}});},fillOrders:function(e,d,b){var a=this;
if(e&&e.length>0){var f=new StringBuffer();f.append("<option value=''>请选择</option>");for(var c=0;c<e.length;c++){if(e[c].id==d){f.append("<option value='"+e[c].id+"' selected>"+e[c].soNo+"</option>");
a.fillSkuIds(e[c].soItemPos,b);}else{f.append("<option value='"+e[c].id+"'>"+e[c].soNo+"</option>");}}$("[name=soId]").empty().append(f.toString());}},fillSkuIds:function(d,b){var a=this;
if(d&&d.length>0){var e=new StringBuffer();for(var c=0;c<d.length;c++){if(b.indexOf(d[c].skuId)!=-1){e.append("<option value='"+d[c].skuId+"' selected>"+d[c].prodName+"</option>");
}else{e.append("<option value='"+d[c].skuId+"'>"+d[c].prodName+"</option>");}}$("#skuIdsDiv").empty().append("<select multiple data-placeholder='请选择' class='chosen-select form-control' name='skuIds' ></select>");
$("[name=skuIds]").empty().append(e.toString());$("select[name=skuIds]").chosen("destroy");$("select[name=skuIds]").chosen();}},applyDelay:function(a,c,d){var b=this;
$.ajax({type:"GET",url:CsComplain._CONS_.APPLY_DELAY_URL+"?delayReason="+c+"&complainIds="+a,contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(e){if(e&&e.success){DialogUtils.success(msgCode.INFO,"申请延期成功");
b.clear(false);layer.close(b.layerIndex);if(typeof d==="function"){d();}}}});},openAddDelayReasonView:function(b,c){var a=this;a.layerIndex=layer.open({type:1,title:"填写延期理由",shadeClose:false,btn:["提交","关闭"],area:["500px","300px"],scrollbar:false,content:$(".applyDelayReasonAddDiv"),yes:function(e,d){var f=$("#applyDelayReasonAddForm").find("[name=delayReason]").val();
if(f){a.applyDelay(b,f,c);}else{DialogUtils.error(msgCode.FAIL_MSG,"请先填写延期理由");}}});},_fillForm:function(b){var a=this;$("[name=id]").val(b.id);$("[name=complainId]").val(b.complainId);
$("[name=csCode]").val(b.csCode+":"+b.csName);$("[name=soId]").val(b.soId);$("[name=followId]").val(b.followId);if(b.type!=""){$("[name=type]").val(b.type);
}else{console.log(b.firstType);$("[name=type]").val(b.firstType);}$("#csComplainForm").find("[name=desc]").val(b.desc);$("[name=dealResult]").val(b.dealResult);
$("[name=csId]").val(b.csId);$("[name=status]").val(b.status);$("[name=completeTime]").val(b.completeTime);$("[name=isPromptly]").val(b.isPromptly);$("[name=createBy]").val(b.createBy);
$("[name=createTime]").val(b.createTime);$("[name=updateBy]").val(b.updateBy);$("[name=updateTime]").val(b.updateTime);a.fillOrders(b.soEntityPos,b.soId,b.skuIds);
$("select[name=complainId]").select2();$("select[name=followId]").select2();},_fillFollowList:function(b){var a=this;a.csComplainFollow.init({"complainId":b.id,canDelete:a.canDeleteFollow});
},_fillDelayDetail:function(b){var a=this;if(b.delayStatus){$("#applyDelayDiv").show();$(".applyDelay").hide();$("[name=delayStatus]").val(b.delayStatus);
$("[name=rejectReason]").val(b.rejectReason);$("[name=delayReason]").val(b.delayReason);}else{$("#applyDelayDiv").hide();if("self"==type){$(".applyDelay").show();
}$("[name=delayStatus]").val("");$("[name=rejectReason]").val("");$("[name=delayReason]").val("");}},_handleForSelf:function(){$("[name=dealResult]").attr("disabled",false);
$("[name=delayStatus]").attr("disabled",true);$("[name=rejectReason]").attr("readonly",true);$("#applyDelayDiv").find("[name=delayReason]").attr("readonly",true);
},_handleForList:function(){if("complete"==$("[name=status]").val()){$("[name=followId]").attr("disabled",true);$("[name=delayStatus]").attr("disabled",true);
$("[name=rejectReason]").attr("readonly",true);$("#applyDelayDiv").find("[name=delayReason]").attr("readonly",true);}else{$("[name=followId]").attr("disabled",false);
$("[name=delayStatus]").attr("disabled",false);$("[name=rejectReason]").attr("readonly",false);$("#applyDelayDiv").find("[name=delayReason]").attr("readonly",false);
}$("[name=dealResult]").attr("disabled",false);},openArrangeFollowView:function(b){var a=this;a.layerIndex=layer.open({type:1,title:"选择跟进员工",shadeClose:false,btn:["提交","关闭"],area:["500px","300px"],scrollbar:false,content:$(".arrangeFollowDiv"),yes:function(d,c){var e=$("#arrangeFollowForm").find("[name=arrangeFollow]").val();
if(e){a.arrangeFollow(e,b);}else{DialogUtils.error(msgCode.FAIL_MSG,"请选择跟进员工");}}});},openDelayReasonView:function(b){var a=this;a.layerIndex=layer.open({type:1,title:"填写拒绝理由",shadeClose:false,btn:["提交","关闭"],area:["500px","300px"],scrollbar:false,content:$(".rejectDelayReasonDiv"),yes:function(d,c){var e=$("#rejectDelayForm").find("[name=rejectReason]").val();
if(e){a.rejectDelay(e,b);}else{DialogUtils.error(msgCode.FAIL_MSG,"请先填写拒绝理由");}}});},arrangeFollow:function(c,b){var a=this;$.ajax({type:"GET",url:CsComplain._CONS_.ARRANGE_FOLLOW_URL+"?followId="+c+"&complainIds="+b,contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(d){if(d&&d.success){DialogUtils.success(msgCode.INFO,"安排跟进成功");
$("#arrangeFollowForm").find("[name=arrangeFollow]").val("");a.reloadJqgrid();layer.close(a.layerIndex);}}});},rejectDelay:function(c,b){var a=this;$.ajax({type:"GET",url:CsComplain._CONS_.REJRCT_DELAY_URL+"?complainIds="+b+"&rejectReason="+c,contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(d){if(d&&d.success){DialogUtils.success(msgCode.INFO,"拒绝延期申请成功");
$("#rejectDelayForm").find("[name=rejectReason]").val("");a.reloadJqgrid();layer.close(a.layerIndex);}}});},comfirmDelay:function(b){var a=this;$.ajax({type:"GET",url:CsComplain._CONS_.COMFIRM_DELAY_URL+"?complainIds="+b,contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(c){if(c&&c.success){DialogUtils.success(msgCode.INFO,"批准延期申请成功");
a.reloadJqgrid();}}});},_initInputAndOption:function(){CateUtils.getOptions({typeKey:"system",pKey:"ComplainDealResult",container:"dealResult"});ComplainTypeOption.getTypeOption(function(a){$("#typeSearch").append(a);
$("#csComplainType").append(a);});if("self"==type){$(".applyDelay").show();}else{$(".applyDelay").hide();}}};