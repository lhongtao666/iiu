var CsEntityUtils={init:function(){this._initBirthdaySelect();this._initChannelSelect();this._initCateOptSelect();this._bindEventHanlder();},_bindEventHanlder:function(){var a=this;
$(".closeBtn").on("click",function(){JTTabUtils.closeTab($(window.top.document).find(".page-tabs-content").find(".active").attr("data-id"));});$("#birthYear").on("change",function(){var c=(new Date()).getFullYear();
var b=parseInt(c)-parseInt($(this).val());$("#age").val(b);});$("#age").on("blur",function(){var c=$(this).val();if(c){var b=parseInt((new Date()).getFullYear())-parseInt(c);
$("#birthYear").val(b);}else{$("#birthYear").val("");}});},_initBirthdaySelect:function(){var a=new Date();var e="1920";var d=a.getFullYear();var g=new StringBuffer();
for(var b=d;b>=e;b--){g.append("<option value='"+b+"'>");g.append(b);g.append("</option>");}$("#birthYear").append(g.toString());var c=new StringBuffer();
for(var b=1;b<=12;b++){if(b<10){b="0"+b;}c.append("<option value='"+b+"'>");c.append(b);c.append("</option>");}$("#birthMonth").append(c.toString());var f=new StringBuffer();
for(var b=1;b<=31;b++){if(b<10){b="0"+b;}f.append("<option value='"+b+"'>");f.append(b);f.append("</option>");}$("#birthDay").append(f.toString());},_initChannelSelect:function(d){var a=this;
var b="mediaChannel-findActived";var e=window.sessionStorage.getItem(b);if(e){var c=JSON.parse(e);a._buildChannelSelect(c,d);}else{FormUtils.loadData(ctx+"/ec/media/mediaChannel/findActived.htm",function(f){window.sessionStorage.setItem(b,JSON.stringify(f));
a._buildChannelSelect(f,d);});}},_buildChannelSelect:function(c,b){if(c&&c.length>0){if(!b&&isDefaultLast&&"y"==isDefaultLast){var d=window.localStorage.getItem("CREATE_CS_SRC_"+currentUserId);
b=d;}var e=new StringBuffer();e.append("<option value=''>请选择</option>");for(var a=0;a<c.length;a++){e.append("<option value='"+c[a].id+"'>"+c[a].name+"</option>");
}$("#srcs").empty().append(e.toString());if(b){$("#srcs").val(b);}this.isInitChannelSelect=true;}},_initInterestsSelect:function(b){var a=this;CateUtils.getOptions([{typeKey:"system",pKey:"CsInterestType",container:"interests",fn:function(c){var g=new StringBuffer();
for(var e=0;e<c.length;e++){var f=c[e].value;var d=c[e].name;g.append("<option value='"+f+"'>"+d+"</option>");}$("#interests").empty().append(g.toString());
a.isInitInterests=true;}}]);},maskPhoneNum:function(a){var b=new StringBuffer();if(a){return PhoneEncryptUtils.encryptPhone(a);}return b.toString();},refreshListTab:function(){if(type=="self"){JTTabUtils.refreshTab(ctx+"/crm/cs/csEntity/list.htm");
}else{if(type=="search"){JTTabUtils.refreshTab(ctx+"/crm/cs/csEntity/searchList.htm");}else{if(type=="mysub"){JTTabUtils.refreshTab(ctx+"/crm/cs/csEntity/subList.htm");
}}}},_initCateOptSelect:function(){CateUtils.getOptions([{typeKey:"system",pKey:"CsBizTypes",container:"bizType"},{typeKey:"system",pKey:"CsEntryType",container:"entry"},{typeKey:"system",pKey:"vocationType",container:"vocation"},{typeKey:"system",pKey:"income",container:"income"},{typeKey:"system",pKey:"maritalStatus",container:"maritalStatus"},{typeKey:"system",pKey:"winePurpose",container:"winePurpose"},{typeKey:"system",pKey:"taste",container:"taste"}]);
this._initInterestsSelect(null);},getSearchParams:function(h){var k=this;var d=$("#csEntitySearchForm").serialize()+h.getRfmtParam();var e=$("select[name=freeHourOption]").val();
var c=$("select[name=freeMinuteOption]").val();if(e){if(!c){$("select[name=freeMinuteOption]").val("00");}}if(c){if(!e){$("select[name=freeHourOption]").val("00");
}}var j=$("#interestSearch option:selected").length;if(j!=0){d=k._bulidInterests(d,j);}var b=$("#belongEmployeeSearch option:selected").length;if(b!=0){d=k._bulidEmps(d,b);
}var a=$("#searchProd option:selected").length;if(a!=0){d=k._bulidProds(d,a);}var g=$("#csTagSearch option:selected").length;if(g!=0){d=k._bulidCsTag(d,g);
}var i=$("#eavSearch option:selected").length;if(i!=0){d=k._bulidEav(d,i);}var f=$("#srcSearch option:selected").length;if(f){d=k._bulidSrcs(d,f);}return d;
},_bulidInterests:function(c,b){var a=this;var d=new StringBuffer();$("#interestSearch option:selected").each(function(e){d.append($(this).val());if(e==b-1){return false;
}else{d.append(",");}});c=c+"&interests="+d.toString();return c;},_bulidEmps:function(c,b){var a=this;var d=new StringBuffer();$("#belongEmployeeSearch option:selected").each(function(e){d.append($(this).val());
if(e==b-1){return false;}else{d.append(",");}});c=c+"&belongEmployee="+d.toString();return c;},_bulidProds:function(c,b){var a=this;var d=new StringBuffer();
$("#searchProd option:selected").each(function(e){d.append($(this).val());if(e==b-1){return false;}else{d.append(",");}});c=c+"&productName="+d.toString();
return c;},_bulidCsTag:function(c,b){var a=this;var d=new StringBuffer();$("#csTagSearch option:selected").each(function(e){d.append($(this).val());if(e==b-1){return false;
}else{d.append(",");}});c=c+"&csTagSearch="+d.toString();return c;},_bulidEav:function(c,b){var a=this;var d=new StringBuffer();$("#eavSearch option:selected").each(function(e){d.append($(this).val());
if(e==b-1){return false;}else{d.append(",");}});c=c+"&eavSearch="+d.toString();return c;},_bulidSrcs:function(c,b){var a=this;var d=new StringBuffer();
$("#srcSearch option:selected").each(function(e){d.append($(this).val());if(e==b-1){return false;}else{d.append(",");}});c=c+"&srcSearch="+d.toString();
return c;},getSearchParamToObj:function(f){var e={};f=decodeURIComponent(f,true);var a=f.split("&");if(a.length){for(var b=0;b<a.length;b++){var d=a[b].split("=");
if(d.length==2){if(e.hasOwnProperty(d[0])){if(jQuery.type(e[d[0]])=="string"){var c=[];c.push(e[d[0]]);d[1]=d[1].replaceAll("\\+"," ");c.push(d[1]);e[d[0]]=c;
}else{if(jQuery.type(e[d[0]])=="array"){d[1]=d[1].replaceAll("\\+"," ");e[d[0]].push(d[1]);}}}else{d[1]=d[1].replaceAll("\\+"," ");e[d[0]]=d[1];}}else{if(d.length>2){e[d[0]]=a[b].substring(a[b].indexOf("=")+1).replaceAll("\\+"," ");
}}}}return e;}};