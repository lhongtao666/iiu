$(function(){var a=new CsEntitySearch();a.init();});function CsEntitySearch(){}CsEntitySearch._CONS_={FIRST_LIST_DATA_URL:ctx+"/crm/cs/csEntity/firstListData.htm",LIST_DATA_URL:ctx+"/crm/cs/csEntity/listSearchData.htm",GRID:"#csEntitySearchGrid",PAGER:"#csEntitySearchPager",};
CsEntitySearch.prototype={init:function(a){this._bindEventHander();this._initJqgrid(a);this._locateToGlHelp();},_locateToGlHelp:function(){var a="glHelp.csEntity.queryCs";
glHelpUtil.init(a);},_bindEventHander:function(){var a=this;$("body").on("click",".csEntityEdit",function(){var b=$(this).attr("attr-id");var c=$(this).attr("attr-myCs");
a._edit(b,"",c);});$(document).on("click",".csEntitySearch",function(){var b=$(this).closest("form").serialize();a.selectedJqgrid=new Array();a.reloadJqgrid(b);
});$("#csEntitySearchForm").on("keypress",function(b){if(b.keyCode=="13"){$(".csEntitySearch").eq(0).trigger("click");return false;}});},_edit:function(d,a,b){if(ResUtils.canShow("csEntity.button.editSearch")){if(b!="false"){var c="客户["+$(CsEntitySearch._CONS_.GRID).jqGrid("getRowData",d).name+"]";
JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/toEdit.htm?type=search&csId="+d,c);}}},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(CsEntitySearch._CONS_.GRID,a);
},_initJqgrid:function(b){var a=this;$(CsEntitySearch._CONS_.GRID).JTJqgrid({url:CsEntitySearch._CONS_.LIST_DATA_URL,pager:CsEntitySearch._CONS_.PAGER,postData:{isFirst:"true"},width:"100%",autowidth:true,colNames:["客户编号","姓名","姓名(隐藏)","性别","等级","成交","复购","消费","意向","渠道","地区","最新跟进","跟进标签","备注","转单时间","最新签收","工号","注册时间"],colModel:[{name:"code",index:"entity.code_",width:115,formatter:function(c,d,e){var f=new StringBuffer();
f.append("<div class='nameClass'>");if(e.turnNew=="y"){f.append("<span style='color:red'>新</span>&nbsp;");}if(e.isSub=="y"){f.append("<span style='color:red'> 从</span>");
}f.append(e.code);f.append("</div>");return f.toString();}},{name:"csName",index:"entity.csName_",width:65,formatter:function(c,d,e){return"<a class='csEntityEdit' attr-id='"+e.id+"' attr-myCs='"+e.isPositionCs+"'>"+e.name+"</a>";
}},{name:"name",index:"entity.name_",hidden:true},{name:"gender",index:"entity.gender_",width:35,formatter:function(c,d,e){return e.gender;}},{name:"bizType",index:"entity.biz_type_",width:70,formatter:function(c,d,e){return e.bizType;
}},{name:"hasDeal",index:"entity.so_total_",width:35,formatter:function(c,d,f){var e="<p style='color:red;'>√</p>";if(f.soComplete&&f.soComplete>0){return e;
}else{return"";}}},{name:"soRepeatBuy",index:"so_repeat_buy_",width:35},{name:"soTotal",index:"entity.so_total_",width:70,formatter:function(c,d,e){return e.soTotal+"元";
}},{name:"interests",index:"entity.interests_",width:90},{name:"srcNames",index:"entity.srcs_",width:50,sortable:false},{name:"prName",width:80,sortable:false,formatter:function(c,e,f){var g=new StringBuffer();
if(f.prName){g.append(f.prName);}if(f.ciName){g.append(",").append(f.ciName);}var d=g.toString();if(d){d=d.replace("省","");d=d.replace("市","");d=d.replace("自治区","");
d=d.replace("自治州","");}return d;}},{name:"lastFollowTime",index:"entity.last_follow_time_",width:100,formatter:function(c){var d=new StringBuffer();if(c&&0==DateUtils.getDateDiff(c,DateUtils.format(new Date(),"yyyy-MM-dd HH:mm:ss"),"day")){d.append("<span style='color:red;'>√</span>");
}if(c&&c.length>16){d.append(c.substring(5,16));}else{d.append(c);}return d.toString();}},{name:"follow",index:"entity.follow_",width:120},{name:"desc",index:"entity.desc_",width:40,formatter:function(d){var c="";
if(d!=""&&d!=null){c='<span  style="color:#1ab394;" class="fa fa-bell" data-toggle="tooltip"  data-placement="right" title="'+d+'"></span>';}return c;}},{name:"turnTime",index:"entity.turn_time_",width:105,formatter:function(c){return DateUtils.mini2Time(c);
}},{name:"lastCompleteTime",index:"entity.last_complete_time_",width:90,formatter:function(c){return DateUtils.mini2Time(c);}},{name:"employeeName",index:"entity.employee_id_",width:100,formatter:function(c,d,e){if(e.employeeAid){return e.employeeAid+":"+e.employeeName;
}return e.employeeAid;}},{name:"createTime",index:"entity.create_time_",width:90,formatter:function(c){return DateUtils.mini2Time(c);}}],loadComplete:function(){$("[data-toggle='tooltip']").tooltip();
var c=$(CsEntitySearch._CONS_.GRID).getGridParam("width");$(CsEntitySearch._CONS_.GRID).setGridWidth(c);}});},};