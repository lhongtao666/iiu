$(function(){var a=new Questionnaire();a.init();});function Questionnaire(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.isDetail=false;
}Questionnaire._CONS_={EDIT_URL:ctx+"/cs/questionnaire/questionnaire/edit.htm",DETAIL_URL:ctx+"/cs/questionnaire/questionnaire/detail.htm",DELETE_URL:ctx+"/cs/questionnaire/questionnaire/delete.htm",SAVE_ADD_URL:ctx+"/cs/questionnaire/questionnaire/saveAdd.htm",SAVE_EDIT_URL:ctx+"/cs/questionnaire/questionnaire/saveEdit.htm",LIST_DATA_URL:ctx+"/cs/questionnaire/questionnaire/listData.htm",EXPORT_URL:ctx+"/cs/questionnaire/questionnaireResult/export.htm",IS_REPLYED_URL:ctx+"/cs/questionnaire/questionnaireResult/isReplyed.htm",LINK_SUB_QUE_URL:ctx+"/cs/questionnaire/questionnaireItem/linkSubQue.htm",EDIT_FORM_ID:"questionnaireForm",GRID:"#questionnaireGrid",PAGER:"#questionnairePager"};
Questionnaire.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._bindFormValidation();this._initJqgrid(a);this._hideNotGrantBtn();
new Switchery(document.querySelector(".js-switch"),{size:"small"});}},_hideNotGrantBtn:function(){if(!ResUtils.canShow("questionnaire.button.add")){$(".questionnaireAdd").hide();
}},clear:function(c){var a=this;function b(){a._showListWrapper();a.isFormDataChange=false;a.isEdit=false;$(".form_wrapper .saveBtn").show();$("#queItrmBody").empty();
$("#linkQueItrmBody").empty();$("#addQueIterm").show();FormUtils.clear(Questionnaire._CONS_.EDIT_FORM_ID);FormUtils.enableForm(Questionnaire._CONS_.EDIT_FORM_ID);
if(c){a.reloadJqgrid();}}if(a.isEdit&&a.isFormDataChange){DialogUtils.warning(function(){b();});}else{b();}},_showListWrapper:function(){$(".list_wrapper").show();
$(".form_wrapper").hide();},_showFormWrapper:function(){$(".list_wrapper").hide();$(".form_wrapper").show();},_add:function(){this._showFormWrapper();},_edit:function(a){this._showFormWrapper();
this.edit=true;this.isDetail=false;this._loadData(a,false);},_detail:function(a){this._showFormWrapper();this.isDetail=true;this._loadData(a,true);$(".form_wrapper .saveBtn").hide();
$("#addQueIterm").hide();FormUtils.disableForm(Questionnaire._CONS_.EDIT_FORM_ID);},_loadData:function(c,b){var a=this;FormUtils.loadData(Questionnaire._CONS_.EDIT_URL+"?id="+c,function(e){$("input[name=id]").val(e.id);
$("input[name=name]").val(e.name);$("input[name=resultCount]").val(e.resultCount);$("input[name=createBy]").val(e.createBy);$("input[name=createTime]").val(e.createTime);
$("input[name=updateBy]").val(e.updateBy);$("input[name=updateTime]").val(e.updateTime);var f=new StringBuffer();f.append("<input type='checkbox'"+(e.status=="actived"?"checked":"")+" class='js-switch'>");
$("#queStatus").empty().append(f.toString());new Switchery(document.querySelector(".js-switch"),{size:"small"});var d=e.questionnaireItemPos;if(d&&d.length>0){a._loadItemTr(d,b);
}});},_loadLinkQueData:function(e,a,d){var b=this;var c=Questionnaire._CONS_.LINK_SUB_QUE_URL+"?linkSubQueId="+e;FormUtils.loadData(c,function(f){if(f&&f.length>0){b._loadLinkSubItemTr(f,b.isDetail);
$("#linkOption").val(a);}});},_save:function(){var d=this;var h=$("#id").val();var a=null;if(h!=null&&h!=""){a=Questionnaire._CONS_.SAVE_EDIT_URL;}else{a=Questionnaire._CONS_.SAVE_ADD_URL;
}if($("#questionnaireForm").valid()&&$("#queItrmForm").valid()){var c=$("#queItrmForm");if(d._validQuetionName(c)){DialogUtils.error("提示","存在问题数据，请检查。");
return false;}if(d._validItem(c)){DialogUtils.error("提示","存在选项值为空数据，请检查。");return false;}ButtonUtils.disableBtn("saveBtn");var e=[];var b=$("#queItrmBody").find("tr");
var g={};if(b&&b.length>0){b.each(function(){var i={};var n=$(this).find(".itermType option:selected").val();var m=$(this).find(".isRequired option:selected").val();
i.order=$(this).find(".number").text();i.question=$(this).find(".questionName").val();i.type=n;i.createBy=$(this).find(".number").attr("createBy");i.createTime=$(this).find(".number").attr("createTime");
i.isRequired=m;i.qnId=$("#questionnaireForm").find("input[name=id]").val();i.id=$(this).find(".number").attr("idVal");var l="";if(n=="single"||n=="multi"){var j="";
var k=$(this).find(".selectItem").length;$(this).find(".selectItem").each(function(o){if(o==k-1){j=j+$(this).val();}else{j=j+$(this).val()+"|";}var p=$(this).closest(".items").find(".linkQue").html();
l=l+$(this).attr("linkQueValue");});i.options=j;}i.linkOption=JSON.stringify(l);e.push(i);});}var f={id:$("#questionnaireForm").find("input[name=id]").val(),name:$("#questionnaireForm").find("input[name=name]").val(),status:$(".js-switch").is(":checked")?"actived":"inactive",resultCount:$("#questionnaireForm").find("input[name=resultCount]").val(),createBy:$("#questionnaireForm").find("input[name=createBy]").val(),createTime:$("#questionnaireForm").find("input[name=createTime]").val(),itemPos:JSON.stringify(e)};
FormUtils.submit(a,f,function(i){ButtonUtils.enableBtn("saveBtn");if(i.success){if(i.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);
}else{if(i.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);}}d.isEdit=false;d.clear(true);}else{DialogUtils.error(msgCode.FAIL_MSG,i.msg);
}},function(){ButtonUtils.enableBtn("saveBtn");DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}},_delete:function(b){var a=this;DialogUtils.confirm(function(){FormUtils.del(Questionnaire._CONS_.DELETE_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,msgCode.DELETE_MSG);
a.reloadJqgrid();}else{DialogUtils.error(msgCode.ERROR,c.msg);}});});},_bindEventHander:function(){var a=this;$(document).on("click",".prevBtn",function(){a.clear(false);
});$(document).on("click",".saveBtn",function(){a._save();});$(document).on("click",".questionnaireSearch",function(){var b=$(this).closest("form").serialize();
a.reloadJqgrid(b);});$("#questionnaireSearchForm").on("keypress",function(b){if(b.keyCode=="13"){$(".questionnaireSearch").trigger("click");}});$(document).on("click","#addQueIterm",function(){a._bulidItem();
});$(document).on("click","#addLinkQueIterm",function(){a._bulidLinkQueItem(null,false);});$(document).on("click",".questionActive,.questionForbid",function(){var c=$(this).attr("idVal");
var b=$(this).attr("status");DialogUtils.confirmWithOptions({title:"确认执行更改操作？",text:"更改状态",confirmButtonText:"确认",yesFunc:function(){FormUtils.submit(ctx+"/cs/questionnaire/questionnaire/updateStatus.htm",{"id":c,"status":b},function(d){if(d.success){DialogUtils.success(msgCode.SUCCESS,"操作成功");
var e=$("#questionnaireSearchForm").closest("form").serialize();a.reloadJqgrid(e);}},function(){DialogUtils.error(msgCode.ERROR,"发送异常");});}});});$("body").on("click",".questionnaireAdd",function(){a._add();
});$("body").on("click",".questionEdit",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(Questionnaire._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);
return;}}}var c=Questionnaire._CONS_.IS_REPLYED_URL;FormUtils.submit(c,{"id":b},function(d){if(d.success){DialogUtils.error(msgCode.ERROR,d.msg);}else{a._edit(b);
}});});$("body").on("click",".questionDelete",function(){var b=$(this).attr("idVal");if(!b){if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_DELETE);
return;}}a._delete(b);});$("body").on("click",".questionDetail",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_DETAIL);
return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.error,msgCode.ERROR_DETAIL_MUL_RECORD);return;}}}a._detail(b);});$(document).on("change",".itermType",function(){var b=$(this).find("option:selected").val();
if(b=="single"||b=="multi"){if($(this).is(".subItermType")){b="linkQue";}a._buildType(b,$(this));}else{$(this).parent().next().next().empty();}});$(document).on("click",".addList",function(){var c=new StringBuffer();
if($(this).is(".addLinkQue")){c.append("<div class='col-sm-12 items' style='margin-top:3px'><div class='col-sm-10'><textarea style='height:30px;' linkQueValue='' class='form-control selectItem'></textarea></div>");
c.append("<div class='col-sm-1'><i class='fa fa-plus-square addList  addCut addLinkQue'></i></div>");c.append("<div class='col-sm-1'><i class='fa fa-minus-square subList addCut'></i></div></div>");
}else{var b=parseInt($(this).closest(".items").find(".selectItem").attr("order"))+1;c.append("<div class='col-sm-12 items' style='margin-top:3px'><div class='col-sm-9'><textarea style='height:30px;' order='"+b+"' linkQueValue='' class='form-control selectItem'></textarea></div>");
c.append("<div class='col-sm-1'><button type='button' class='jt-btn-safe linkQue'>关</button></div>");c.append("<div class='col-sm-1'><i class='fa fa-plus-square addList addCut'></i></div>");
c.append("<div class='col-sm-1'><i class='fa fa-minus-square subList addCut'></i></div></div>");}$(this).closest(".optionList").append(c.toString());});
$(document).on("click",".subList",function(){var b=$(this).closest(".items");a.reItemNext(b);$(this).closest(".items").remove();});$(document).on("click",".delIterm",function(){var b=$(this);
var c=$(this).closest("tr");DialogUtils.confirmWithOptions({title:"确认移除？",confirmButtonText:"确认",yesFunc:function(){a.reNext(c);c.remove();}});});$(document).on("click",".questionExport",function(){var b=$(this);
b.attr("disabled","disabled");var c=$(this).attr("idVal");FormUtils.submit(Questionnaire._CONS_.EXPORT_URL,{"id":c},function(d){b.removeAttr("disabled");
if(d.success){DialogUtils.success(msgCode.INFO,d.msg+"成功");}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});$(document).on("click",".linkQue",function(){var f=$(this).parent().prev().find(".selectItem").val();if(f){var g=$(this).html();var d=$(this).closest("tr").find(".number").text();
var b=$(this).closest(".items").find(".selectItem").attr("order");var c=d+"-"+b;$(this).parent().prev().find(".selectItem").attr("linkQueId",c);if(g=="已"){var e=$(this).attr("linkSubId");
$("#linkQueModal").modal("show");a._loadLinkQueData(e,c,f);}else{DialogUtils.confirmWithOptions({title:"给该问答关联子题？",text:"",confirmButtonText:"确认",yesFunc:function(){a._buildLinkQue(c);
}});}}else{DialogUtils.error("提示","该选项没有值。");}});$(document).on("click",".addLinkQueItrm",function(){var b=$("#linkQueItrmForm");if(a._validQuetionName(b)){DialogUtils.error("提示","存在问题或选项为空的数据，请检查。");
return false;}if(a._validItem(b)){DialogUtils.error("提示","存在选项值为空的数据，请检查。");return false;}a._bulidLinkQueData();});$(document).on("change",".selectItem",function(){var b=$(this);
var d=b.closest(".items").siblings().find(".selectItem");var c=b.val();if(b.val()){b.removeClass("repeatItem");d.each(function(){if(c==$(this).val()){$(this).addClass("repeatItem");
DialogUtils.error("提示","该问题选项已存在，不能相同");b.focus();return;}else{$(this).removeClass("repeatItem");}});}});$(document).on("change",".questionName",function(){if($(this).val()){$(this).removeClass("repeatItem");
}});$(document).on("click",".prevLinkQueBtn",function(){$("#linkQueModal").modal("hide");});},_bulidLinkQueData:function(){var e=this;var b=$("#linkOption").val();
var d=$("#linkQueItrmBody").find("tr");var f=[];if(d&&d.length>0){d.each(function(){var g={};var k=$(this).find(".itermType option:selected").val();var j=$(this).find(".isRequired option:selected").val();
g.question=$(this).find(".questionName").val();g.type=k;g.createBy=$(this).find(".number").attr("createBy");g.createTime=$(this).find(".number").attr("createTime");
g.isRequired=j;g.qnId=$("#questionnaireForm").find("input[name=id]").val();g.id=$(this).find(".number").attr("idVal");g.linkOption=$("#linkOption").val();
if(k=="single"||k=="multi"){var h="";var i=$(this).find(".selectItem").length;$(this).find(".selectItem").each(function(l){if(l==i-1){h=h+$(this).val();
}else{h=h+$(this).val()+"|";}});g.options=h;}f.push(g);});}var a=JSON.stringify(f);var c=$("#queItrmBody").find(".selectItem");c.each(function(){if(b==$(this).attr("linkQueId")){if(f&&f.length>0){$(this).parent().next().find(".linkQue").html("已");
$(this).parent().next().find(".linkQue").attr("class","jt-btn-error linkQue");$(this).attr("linkQueValue",a);}else{$(this).parent().next().find(".linkQue").html("关");
$(this).parent().next().find(".linkQue").attr("class","jt-btn-safe linkQue");$(this).attr("linkQueValue","");}}});$("#linkQueModal").modal("hide");},_buildLinkQue:function(a){var b=this;
$("#linkQueModal").modal("show");$("#linkQueItrmBody").empty();b._bulidLinkQueItem(a,true);},reNext:function(b){var a=this;var d=b.next();if(d.length==0){return false;
}else{var c=parseInt(d.find(".number").text());d.find(".number").text(c-1);a.reNext(d);}},reItemNext:function(b){var a=this;var d=b.next();if(d.length==0){return false;
}else{var c=parseInt(d.find(".selectItem").attr("order"));d.find(".selectItem").attr("order",c-1);a.reItemNext(d);}},_loadLinkSubItemTr:function(e,b){var a=this;
var g=new StringBuffer();for(var d=0;d<e.length;d++){g.append("<tr>");g.append("<td style='width: 35%;'><input  name='questionName' validateType='default' class='form-control questionName' style='width:98%' value='"+e[d].question+"'></td>");
g.append("<td style='width: 10%;'><select class='form-control itermType subItermType'>");g.append("<option value='single'"+(e[d].type=="single"?"selected":"")+">单选题</option>"+"<option value='multi'"+(e[d].type=="multi"?"selected":"")+">多选题</option>"+"<option value='bool' "+(e[d].type=="bool"?"selected":"")+">是非题</option>"+"<option value='common'"+(e[d].type=="common"?"selected":"")+">问答题</option>");
g.append("</select></td>");g.append("<td style='width:5%'>");g.append("<select class='form-control isRequired'>");g.append("<option value='y'"+(e[d].isRequired=="y"?"selected":"")+">是</option>");
g.append("<option value='n'"+((e[d].isRequired==""||e[d].isRequired=="n")?"selected":"")+">否</option>");g.append("</select></td>");if(e[d].type=="multi"||e[d].type=="single"){g.append("<td style='width: 45%;' class='optionsType'>");
if(e[d].options){var f=e[d].options.split("|");g.append("<div class='optionList'>");for(var c=0;c<f.length;c++){if(b){g.append("<div class='col-sm-12 items' style='margin-top:3px'><textarea style='height:30px;'  linkQueValue=''  class='form-control selectItem' value='"+f[c]+"'>"+f[c]+"</textarea></div>");
}else{g.append("<div class='col-sm-12 items' style='margin-top:3px'><div class='col-sm-10'><textarea style='height:30px;' linkQueValue='' class='form-control selectItem' value='"+f[c]+"'>"+f[c]+"</textarea></div>");
g.append("<div class='col-sm-1'><i class='fa fa-plus-square addList addCut'></i></div>");g.append("<div class='col-sm-1'><i class='fa fa-minus-square subList addCut'></i></div></div>");
}}g.append("</div>");}g.append("</td>");}else{g.append("<td style='width: 45%;' class='optionsType'></td>");}if(!b){g.append("<td style='width: 5%;'><button  type='button' class='jt-btn-error delIterm '>移除</button></td>");
}g.append("</tr>");}$("#linkQueItrmBody").empty().append(g.toString());if(b){$("#linkQueItrmBody").find("input,select,textarea").attr("disabled","disabled");
$("#linkQueItrmTr").find(".operate").hide();$(".modalMiss").hide();$(".addLinkQueItrm").hide();$("#addLinkQueIterm").hide();$(".prevLinkQueBtn").show();
}else{$(".modalMiss").show();$(".addLinkQueItrm").show();$("#addLinkQueIterm").show();$(".prevLinkQueBtn").hide();}},_loadItemTr:function(q,b){var o=this;
var h=new StringBuffer();for(var f=0;f<q.length;f++){h.append("<tr>");h.append("<td style='width: 5%;' createTime='"+q[f].createTime+"' createBy='"+q[f].createBy+"' class='number' idVal='"+q[f].id+"'>"+q[f].order+"</td>");
h.append("<td style='width: 30%;'><input  name='questionName' validateType='default' class='form-control questionName' style='width:98%' value='"+q[f].question+"'></td>");
h.append("<td style='width: 10%;'><select class='form-control itermType'>");h.append("<option value='single'"+(q[f].type=="single"?"selected":"")+">单选题</option>"+"<option value='multi'"+(q[f].type=="multi"?"selected":"")+">多选题</option>"+"<option value='bool' "+(q[f].type=="bool"?"selected":"")+">是非题</option>"+"<option value='common'"+(q[f].type=="common"?"selected":"")+">问答题</option>");
h.append("</select></td>");h.append("<td style='width:5%'>");h.append("<select class='form-control isRequired'>");h.append("<option value='y'"+(q[f].isRequired=="y"?"selected":"")+">是</option>");
h.append("<option value='n'"+((q[f].isRequired==""||q[f].isRequired=="n")?"selected":"")+">否</option>");h.append("</select></td>");if(q[f].type=="multi"||q[f].type=="single"){h.append("<td style='width: 45%;' class='optionsType'>");
if(q[f].options){var g=q[f].options.split("|");var n=q[f].linkSubQue.split("|");h.append("<div class='optionList'>");for(var e=0;e<g.length;e++){var m=false;
var a="";var c=parseInt(e)+1;for(var d=0;d<n.length;d++){var l=n[d].split("-");if(l[0]==c){m=true;a=a+l[1]+",";}}if(b){if(m){h.append("<div class='col-sm-12 items' style='margin-top:3px'><div class='col-sm-11'><textarea style='height:30px;' order='"+c+"' linkQueValue=''  class='form-control selectItem' value='"+g[e]+"'>"+g[e]+"</textarea></div>");
h.append("<div class='col-sm-1'><button type='button' linkSubId='"+a+"' class='jt-btn-error linkQue'>已</button></div></div>");}else{h.append("<div class='col-sm-12 items' style='margin-top:3px'><div class='col-sm-11'><textarea style='height:30px;'  linkQueValue=''  class='form-control selectItem' value='"+g[e]+"'>"+g[e]+"</textarea></div></div>");
}}else{var p="";if(m&&a){var l=q[f].order+"-"+c;p=o._getLinkQueValue(a,l);}h.append("<div class='col-sm-12 items' style='margin-top:3px'><div class='col-sm-9'><textarea style='height:30px;' linkQueValue='"+p+"' order='"+c+"' class='form-control selectItem' value='"+g[e]+"'>"+g[e]+"</textarea></div>");
if(m){h.append("<div class='col-sm-1'><button type='button' linkSubId='"+a+"' class='jt-btn-error linkQue'>已</button></div>");}else{h.append("<div class='col-sm-1'><button type='button' class='jt-btn-safe linkQue'>关</button></div>");
}h.append("<div class='col-sm-1'><i class='fa fa-plus-square addList addCut'></i></div>");h.append("<div class='col-sm-1'><i class='fa fa-minus-square subList addCut'></i></div></div>");
}}h.append("</div>");}h.append("</td>");}else{h.append("<td style='width: 45%;' class='optionsType'></td>");}if(!b){h.append("<td style='width: 5%;'><button  type='button' class='jt-btn-error delIterm '>移除</button></td>");
}h.append("</tr>");}$("#queItrmBody").empty().append(h.toString());if(b){$("#queItrmBody").find("input,select,textarea").attr("disabled","disabled");$("#queItrmTr").find(".operate").hide();
}else{$("#queItrmTr").find(".operate").show();}},_getLinkQueValue:function(e,d){var b=this;var c=Questionnaire._CONS_.LINK_SUB_QUE_URL+"?linkSubQueId="+e+"&linkOption="+d;
var a="";$.ajax({url:c,async:false,success:function(f){if(f&&f.length>0){a=f;}}});return a;},_bulidLinkQueItem:function(a,c){var b=this;var d=new StringBuffer();
d.append("<tr>");d.append("<td style='width: 35%;'><input  name='questionName' validateType='default' class='form-control questionName' style='width:98%'></td>");
d.append("<td style='width: 10%;'><select class='form-control itermType subItermType'>");d.append("<option value='single'>单选题</option><option value='multi'>多选题</option><option value='bool'>是非题</option><option value='common'>问答题</option>");
d.append("</select></td>");d.append("<td style='width: 5%;'><select class='form-control isRequired'><option value='n' check>否</option><option value='y'>是</option></select></td>");
d.append("<td style='width: 45%;' class='optionsType'>"+b._buildType("linkQue",null)+"</td>");d.append("<td style='width: 5%;' ><button  type='button' class='jt-btn-error delIterm  operate''>移除</button></td>");
d.append("</tr>");$("#linkQueItrmBody").append(d.toString());if(c){$("#linkOption").val(a);}},_bulidItem:function(){var a=this;var c=new StringBuffer();
var b=Number($("#queItrmBody").children("tr:last-child").find(".number").text());if(b){b=b+1;}else{b=1;}c.append("<tr>");c.append("<td style='width: 5%;' class='number'>"+b+"</td>");
c.append("<td style='width: 30%;'><input  name='questionName' validateType='default' class='form-control questionName' style='width:98%'></td>");c.append("<td style='width: 10%;'><select class='form-control itermType'>");
c.append("<option value='single'>单选题</option><option value='multi'>多选题</option><option value='bool'>是非题</option><option value='common'>问答题</option>");c.append("</select></td>");
c.append("<td style='width: 5%;'><select class='form-control isRequired'><option value='n' check>否</option><option value='y'>是</option></select></td>");
c.append("<td style='width: 45%;' class='optionsType'>"+a._buildType()+"</td>");c.append("<td style='width: 5%;'><button  type='button' class='jt-btn-error delIterm  operate''>移除</button></td>");
c.append("</tr>");$("#queItrmBody").append(c.toString());},_buildType:function(c,b){var a=this;var d=new StringBuffer();d.append("<div class='optionList'>");
d.append("<div class='col-sm-12 items'>");if("linkQue"==c){d.append("<div class='col-sm-10'><textarea style='height:30px;' linkQueValue=''  class='form-control selectItem'></textarea></div>");
d.append("<div class='col-sm-1'><i class='fa fa-plus-square addList addCut addLinkQue'></i></div>");d.append("</div></div>");}else{d.append("<div class='col-sm-9'><textarea style='height:30px;' order='1' linkQueValue='' class='form-control selectItem'></textarea></div>");
d.append("<div class='col-sm-1'><button type='button' class='jt-btn-safe linkQue'>关</button></div>");d.append("<div class='col-sm-1'><i class='fa fa-plus-square addList addCut'></i></div>");
d.append("</div></div>");}if(b){b.parent().next().next().empty().append(d.toString());}else{return d.toString();}},_validItem:function(c){var b=this;var d=c.find(".optionsType");
var a=0;d.each(function(){var e=$(this).find(".selectItem");e.each(function(f){if($(this).val()){}else{a++;$(this).addClass("repeatItem");}});});if(a>0){return true;
}return false;},_validQuetionName:function(b){var a=this;var d=b.find(".questionName");var c=0;d.each(function(){if($(this).val()){}else{$(this).addClass("repeatItem");
c++;}});if(c>0){return true;}return false;},_bindFormValidation:function(){var a={rules:{"name":{required:true}},messages:{}};FormUtils.bindFormValidation(Questionnaire._CONS_.EDIT_FORM_ID,a);
},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(Questionnaire._CONS_.GRID,a);},_getManagerBtns:function(){var a=[];if(ResUtils.canShow("questionnaire.button.delete")){a.push({lable:msgCode.DELETE_BTN_TEXT,btnClasses:"questionnaireDel",iconClasses:"fa fa-remove"});
}if(ResUtils.canShow("questionnaire.button.edit")){a.push({lable:msgCode.EDIT_BTN_TEXT,btnClasses:"questionnaireEdit",iconClasses:"fa fa-edit"});}if(ResUtils.canShow("questionnaire.button.detail")){a.push({lable:msgCode.DETAIL_BTN_TEXT,btnClasses:"questionnaireDetail",iconClasses:"fa fa-list"});
}return a;},_initJqgrid:function(b){if(b==null||typeof b==undefined){b={};}ResUtils.canShow;var a=true;if(ResUtils.canShow("questionDelete.button")||ResUtils.canShow("questionExport.button")||ResUtils.canShow("questionForbid.button")||ResUtils.canShow("questionActive.button")||ResUtils.canShow("questionEdit.button")){a=false;
}$(Questionnaire._CONS_.GRID).JTJqgrid({url:Questionnaire._CONS_.LIST_DATA_URL,pager:Questionnaire._CONS_.PAGER,postData:b,multiselect:false,colNames:["名称","状态","答卷数量","创建者","创建时间","操作"],colModel:[{name:"name",index:"name_",width:120},{name:"status",index:"status_",width:120,formatter:function(d,e,f){var c="禁用";
if(f.status=="actived"){c="激活";}return c;}},{name:"resultCount",index:"result_count_",width:120},{name:"createName",index:"createName",width:120},{name:"createTime",index:"create_time_",width:120},{name:"manage",width:150,hidden:a,formatter:function(c,d,e){var f=new StringBuffer();
if(ResUtils.canShow("questionEdit.button")){f.append("<button type='button' idVal='"+e.id+"'  class='jt-btn-safe questionEdit'>"+"编辑"+"</button>");}if(ResUtils.canShow("questionDetail.button")){f.append("<button type='button' idVal='"+e.id+"'  class='jt-btn-safe questionDetail'>"+"明細"+"</button>");
}if(ResUtils.canShow("questionExport.button")){f.append("<button type='button' idVal='"+e.id+"' class='jt-btn-safe questionExport'>"+"导出"+"</button>");
}if(ResUtils.canShow("questionActive.button")&&"inactive"==e.status){f.append("<button type='button' status='inactive' idVal='"+e.id+"' class='jt-btn-safe questionActive'>"+"激活"+"</button>");
}if(ResUtils.canShow("questionForbid.button")&&"actived"==e.status){f.append("<button type='button' status='actived' idVal='"+e.id+"' class='jt-btn-error questionForbid'>"+"禁用"+"</button>");
}if(ResUtils.canShow("questionDelete.button")){f.append("<button type='button' idVal='"+e.id+"' class='jt-btn-error questionDelete'>"+"删除"+"</button>");
}return f.toString();}}]});}};