function CsEmployee(a){this.caller=a;this.gridId="#csEntityGrid";this.formId="#csEntitySearchForm";this.isSea="n";}CsEmployee._CONS_={SHOW_MORE:ctx+"/crm/cs/csEntity/showMoreTarget.htm",};
CsEmployee.prototype={init:function(a,c,b){if(a){this.gridId=a;}if(c){this.formId=c;}if(b){this.isSea=b;}this._bindEventHandler();},_bindEventHandler:function(){var a=this;
$(document).on("click",".changRelEmployee",function(){a._changeEmployee($("#csEntityForm").find("[name=id]").val());});$(document).on("click",".changRelEmployeeForAdd",function(){a._changeEmployee($("#csEntityForm").find("[name=id]").val());
});$("body").on("click",".csEntityEmployee",function(){var c=$(this).attr("idVal");if(c){var b=new CsAssign([c],"csEntity");b.init();}else{c=$(a.gridId).jqGrid("getGridParam","selarrrow");
ConfigUtils.findByKey("csEntity.assignCsMaxVal",function(e){if(e.msg!=0&&e.msg<c.length){DialogUtils.error(msgCode.ERROR,"单次最多分配"+e.msg+"个客户");return false;
}else{if(c&&c.length){var d=new CsAssign(c,"csEntity");d.init();}else{DialogUtils.confirmWithOptions({title:"使用查询结果[不支持一键查询]进行分配,确定吗?",text:"",confirmButtonText:"确定",yesFunc:function(){var g=CsEntityUtils.getSearchParams(a.caller.rfmtSearch);
g=CsEntityUtils.getSearchParamToObj(g);g.type=type||a.caller.type;if(e.msg!=0){g.limitCount=e.msg;}if(a.isSea=="y"){g["is_sea_"]="y";}var f=$(a.caller.grid).jqGrid("getGridParam","records");
FormUtils.submit(ctx+"/crm/cs/csEntity/listCsIds.htm",g,function(i){var h=new CsAssign(i,"csEntity",null,e.msg);h.init();});},noFunc:function(){DialogUtils.error(msgCode.ERROR,"请选择要分配的客户");
},});}}});}});},_getSearchParam:function(){var f=$(this.formId).serialize();var e={};f=decodeURIComponent(f,true);var a=f.split("&");if(a.length){for(var b=0;
b<a.length;b++){var d=a[b].split("=");if(d.length==2){if(e.hasOwnProperty(d[0])){if(jQuery.type(e[d[0]])=="string"){var c=[];c.push(e[d[0]]);d[1]=d[1].replaceAll("\\+"," ");
c.push(d[1]);e[d[0]]=c;}else{if(jQuery.type(e[d[0]])=="array"){d[1]=d[1].replaceAll("\\+"," ");e[d[0]].push(d[1]);}}}else{d[1]=d[1].replaceAll("\\+"," ");
e[d[0]]=d[1];}}else{if(d.length>2){e[d[0]]=a[b].substring(a[b].indexOf("=")+1).replaceAll("\\+"," ");}}}}return e;},_changeEmployee:function(d,a){var b=0;
if(ResUtils.canShow("employeeSelector.button.cs")){b:1;}var e={isShowAllGroup:b,grantType:"/cs/",isMultiple:0,mode:0,isSale:1,isOnlySelfGroup:1,type:"positionContext",callBack:function(g){if(g!=null){if(g.length>0){$("input[name=employeeId]").val(g[0].id);
$("input[name=employeeShow]").val(g[0].aid+"："+g[0].name);if(!a){var f=[];f.push({employeeId:g[0].id,csEntityIds:d});FormUtils.submit(ctx+"/crm/cs/csEntity/saveAssign.htm",{resultJson:JSON.stringify(f),csType:"csEntity"},function(h){if(h.success){DialogUtils.success("提示",h.msg);
}else{DialogUtils.error("失败",h.msg);}});}}}}};var c=new EmployeesSelect();c.init(e);},};