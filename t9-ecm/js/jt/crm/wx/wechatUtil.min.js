var WechatUtil={getRecentLi:function(b,e){if(b.openId==""||b.openId==null){return"";}var d=b.openId;if($("#"+d).length>0){return"";}var c=new StringBuffer();
var a=this.isOvertime(b);c.append("<li class='recent "+(a?"overtime":"")+"' id='"+d+"' ").append(" data-nickname='"+b.nickName+"'").append(" data-id='"+b.id+"'").append(" data-tagids='"+b.tagIds+"'").append(" data-openid='"+b.openId+"'>").append("<div class='jt-head-pic-div'>").append("<img onerror='onImageError();' class='avatar' src-val='"+b.headImgUrl+"' src='"+b.headImgUrl+"'>");
if(e){c.append("<span class='badge badge-danger pull-right msg-not-read' data-notread='1'>1</span>");}else{c.append(this._getNotReadData(b));}c.append("</div>");
c.append("<p class='name'> <span class='name-span' >"+b.nickName+"</span>"+this.getOverTime(a)+"<br><small class='last-content'>"+this.getContent(b)+"</small><small class='draft-content'></small></p>");
c.append("</li>");return c.toString();},isOvertime:function(d){var c=false;var b=DateUtils.format(new Date());var a=DateUtils.getDateDiff(d.lastCommunicationTime,b);
if(a>3600*48){c=true;}return c;},getOverTime:function(a){if(a){return"<span class='is-overtime'>[超]</span>";}else{return"";}},addWechatNotRead:function(c,b){var a=0;
if($("#"+b).find(".msg-not-read").length>0){a=parseInt($("#"+b).find(".msg-not-read").attr("data-notread"));}$("#"+b).find(".msg-not-read").remove();a=a+c;
var d=a;if(d>99){d=99;}if(d>0){$("#"+b).append("<span class='badge badge-danger pull-right msg-not-read' data-notread='"+a+"'>"+d+"</span>");}},getContent:function(b){var c=b.lastReplyType?b.lastReplyType:b.contentType;
if(c=="text"){var a=b.lastReplyContent?b.lastReplyContent:b.content;return a;}else{if(c=="image"){return"[图片]";}else{if(c=="voice"){return"[语音]";}else{if(c=="video"){return"[视频]";
}else{return"";}}}}},removeNotRead:function(a){FormUtils.submit(ctx+"/crm/wx/wechatRecord/clearUnread.htm",{openId:a},function(b){},function(){},true);
},_getNotReadData:function(b){var a=b.unreadCount;if(a>0){var c=a;if(c>99){c=99;}return"<span class='badge badge-danger pull-right msg-not-read' data-notread='"+a+"'>"+c+"</span>";
}else{return"";}},_getHeadImgUrl:function(b){var a="";if(b.type=="in"){a=b.headImgUrl!=null&&b.headImgUrl!=""?b.headImgUrl:"";}else{a=b.employeeHeadImg?b.employeeHeadImg:"";
if(a==""){a="/img/jt/logos/t9.png";}}if(a&&a.indexOf("http://")==-1&&a.indexOf(ctx)==-1){a=ctx+a;}return a;},_getMsgType:function(b){if(b.contentType=="text"){return WeiXinUtil.replaceFace(b.content);
}else{if(b.contentType=="image"){var a=b.content.split(";");if(a.length>1){return"<img style='width:120px;' src-value='"+b.content+"' class='jt-lager-img' src='"+ImageUtils.getTrueUrl(a[0])+"' big-src='"+ImageUtils.getTrueUrl(a[1])+"'>";
}else{return"<img style='width:120px;' src-value='"+b.content+"' class='jt-lager-img' src='"+ImageUtils.getTrueUrl(b.content)+"' big-src='"+ImageUtils.getTrueUrl(b.content)+"'>";
}}else{if(b.contentType=="voice"){if(b.content&&b.content.indexOf("UploadedFile")!=-1){return WeiXinUtil.getAudioSpan(b);}else{return b.content;}}else{if(b.contentType=="video"){return WeiXinUtil.getVideoMsg(b);
}}}}},};