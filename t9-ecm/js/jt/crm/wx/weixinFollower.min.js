$(function(){var a=new WeixinFollower();a.init();});function WeixinFollower(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}WeixinFollower._CONS_={LIST_DATA_URL:ctx+"/crm/wx/weixinFollower/listData.htm",SYNC_FOLLOWER_URL:ctx+"/crm/wx/weixinFollower/syncFollower.htm",EDIT_FORM_ID:"weixinFollowerForm",GRID:"#weixinFollowerGrid",PAGER:"#weixinFollowerPager"};
WeixinFollower.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindFormValidation();this._bindEventHander();this._initJqgrid(a);this._hideNotGrantBtn();
}},_hideNotGrantBtn:function(){},clear:function(c){var a=this;function b(){a._showListWrapper();a.isFormDataChange=false;a.isEdit=false;$(".form_wrapper .saveBtn").show();
FormUtils.clear(WeixinFollower._CONS_.EDIT_FORM_ID);FormUtils.enableForm(WeixinFollower._CONS_.EDIT_FORM_ID);if(c){a.reloadJqgrid();}}if(a.isEdit&&a.isFormDataChange){DialogUtils.warning(function(){b();
});}else{b();}},_showListWrapper:function(){$(".list_wrapper").show();$(".form_wrapper").hide();},_showFormWrapper:function(){$(".list_wrapper").hide();
$(".form_wrapper").show();},_add:function(){this._showFormWrapper();},_edit:function(a){this._showFormWrapper();this.edit=true;this._loadData(a);},_detail:function(a){this._showFormWrapper();
this._loadData(a);$(".form_wrapper .saveBtn").hide();FormUtils.disableForm(WeixinFollower._CONS_.EDIT_FORM_ID);},_loadData:function(b){var a=this;FormUtils.loadData(WeixinFollower._CONS_.EDIT_URL+"?id="+b,function(c){$("input[name=id]").val(c.id);
$("input[name=openId]").val(c.openId);$("input[name=subscribe]").val(c.subscribe);$("input[name=nickName]").val(c.nickName);$("input[name=sex]").val(c.sex);
$("input[name=city]").val(c.city);$("input[name=country]").val(c.country);$("input[name=province]").val(c.province);$("input[name=language]").val(c.language);
$("input[name=headImgUrl]").val(c.headImgUrl);$("input[name=subscribeTime]").val(c.subscribeTime);$("input[name=unionId]").val(c.unionId);$("input[name=remark]").val(c.remark);
$("input[name=groupId]").val(c.groupId);});},_syncFollower:function(){var a=WeixinFollower._CONS_.SYNC_FOLLOWER_URL;FormUtils.submit(a,{},function(b){if(b.success){$(".weixinFollowerSearch").trigger("click");
}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},_bindEventHander:function(){var a=this;
$(".weixinFollowerSearch").on("click",function(){var b=$(this).closest("form").serialize();a.reloadJqgrid(b);});$("#weixinFollowerSearchForm").on("keypress",function(b){if(b.keyCode=="13"){$(".weixinFollowerSearch").trigger("click");
return false;}});$(".weixinSyncFollower").on("click",function(){a._syncFollower();});},_bindFormValidation:function(){var a={rules:{},messages:{}};FormUtils.bindFormValidation(WeixinFollower._CONS_.EDIT_FORM_ID,a);
},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(WeixinFollower._CONS_.GRID,a);},_getManagerBtns:function(){var a=[];if(ResUtils.canShow("weixinFollower.button.delete")){a.push({lable:msgCode.DELETE_BTN_TEXT,btnClasses:"weixinFollowerDel",iconClasses:"fa fa-remove"});
}if(ResUtils.canShow("weixinFollower.button.edit")){a.push({lable:msgCode.EDIT_BTN_TEXT,btnClasses:"weixinFollowerEdit",iconClasses:"fa fa-edit"});}if(ResUtils.canShow("weixinFollower.button.detail")){a.push({lable:msgCode.DETAIL_BTN_TEXT,btnClasses:"weixinFollowerDetail",iconClasses:"fa fa-list"});
}return a;},_initJqgrid:function(a){if(a==null||typeof a==undefined){a={};}$(WeixinFollower._CONS_.GRID).JTJqgrid({url:WeixinFollower._CONS_.LIST_DATA_URL,pager:WeixinFollower._CONS_.PAGER,postData:a,colNames:["关注公众号唯一标识","头像","昵称","性别","国家","省份","城市","订阅情况","关注时间","备注","操作"],colModel:[{name:"openId",index:"open_id_",width:120,hidden:true},{name:"headImgUrl",index:"head_img_url_",width:120,formatter:function(b){if(b!=null&&b!=""){return'<img style="display: inline; height:35px;" src="'+b+'">';
}else{return"";}}},{name:"nickName",index:"nick_name_",width:120},{name:"sex",index:"sex_",width:60,formatter:function(b){if(b==1){return"男";}else{if(b==2){return"女";
}else{return"未知";}}}},{name:"country",index:"country_",width:70},{name:"province",index:"province_",width:70},{name:"city",index:"city_",width:70},{name:"subscribe",index:"subscribe_",width:80,formatter:function(b){if(b==0){return"退订";
}else{return"订阅";}}},{name:"subscribeTime",index:"subscribe_time_",width:120},{name:"remark",index:"remark_",width:120},{name:"__manage",width:40,classes:"rowOps",sortable:false,align:"center",formatter:"manage",formatoptions:this._getManagerBtns()}]});
}};