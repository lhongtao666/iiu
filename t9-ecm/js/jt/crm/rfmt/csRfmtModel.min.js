function CsRfmtModel(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.csId="";}CsRfmtModel._CONS_={GET_CS_MODEL_URL:ctx+"/crm/rfmt/rfmtModel/getCsRfmtModelPo.htm",FIND_CS_MODEL_HISTORY:ctx+"/crm/rfmt/rfmtModel/findCsRfmtModelPos.htm",};
CsRfmtModel.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this.csId=a;}},_dealStyle:function(){var a=this;if(a.csRfmtModelHistoryData){a.loadCsRfmtModelHistory(a.csRfmtModelHistoryData);
}},_bindEventHander:function(){var a=this;$("#showMoreRfmt").on("click",function(){$(".csEntityEav").trigger("click");$(".csEntityEav").tab("show");$(".jt-cs-tab").find(".tab-pane").removeClass("active").removeClass("in");
$(".cs-right-navs").find(".tab-pane").removeClass("active").removeClass("in");$("#csEntityEav").addClass("active").addClass("in");$("#csInfoRfmtLi").tab("show");
$("#csInfoRfmtTab").addClass("active").addClass("in");$("#csInfoRfmtLi").trigger("click");});$("#csInfoRfmtLi").on("click",function(){if(a.watchTab){return false;
}a.watchTab=setInterval(function(){a.counterTab+=250;if($("#csInfoRfmtTab").is(":visible")||a.counterTab>=5000){a.findCsRfmtModelHistory(csId);clearInterval(a.watchTab);
delete a.watchTab;delete a.counterTab;}},250);});$(window).on("resize",function(){a._dealStyle();});$(document).on("mouseenter","#csInfoRfmtTab .helper",function(i){var b=$(this).offset().left+7.5,j=$(this).offset().top+7.5,h={},g=$(window).width(),d=$(window).height(),f=(b+450)>g,c=(j+150)>d;
if(f){h={"bottom":d-j,"right":g-b,"left":"auto","top":"auto"};}else{if(!f&&c){h={"bottom":d-j,"left":b,"right":"auto","top":"auto"};}else{if(!f&&!c){h={"top":j-75,"left":b,"right":"auto","bottom":"auto"};
}}}$("#rfmt-helper").css(h);$("#rfmt-helper").stop().show("fast");});$(document).on("mouseleave","#csInfoRfmtTab .helper",function(b){$("#rfmt-helper").stop().hide("fast");
});$("#rfmt-helper").hover(function(b){$("#rfmt-helper").stop(true,true).show();},function(b){$("#rfmt-helper").stop().hide("fast");});$(document).on("mouseenter","#cs-rfmt-show",function(b){$("#csRfmtSimple").stop().show("fast");
});$(document).on("mouseleave","#cs-rfmt-show",function(b){if(!$("#cs-rfmt-show").hasClass("on")){$("#csRfmtSimple").stop().hide("fast");}});$("#csRfmtSimple").hover(function(b){$("#csRfmtSimple").stop(true,true).show();
},function(b){if(!$("#cs-rfmt-show").hasClass("on")){$("#csRfmtSimple").stop().hide("fast");}});$(document).on("click","#cs-rfmt-show",function(b){if($(this).hasClass("on")){$(this).removeClass("on");
}else{$(this).addClass("on");}});},getCsRfmtModel:function(b){var a=this;FormUtils.loadData(CsRfmtModel._CONS_.GET_CS_MODEL_URL+"?csId="+b,function(d){if(d){$(".rfmtRate").empty().append(parseInt(d.rate*100));
$(".rfmt").empty().append(d.rfmt);$(".rfmtType").empty().append(d.rfmtType);$(".rfmtSuggest").empty().append(d.rfmtSuggest);$("#rfmt-r").empty().append(d.data.R);
$("#rfmt-f").empty().append(d.data.F);$("#rfmt-m").empty().append(d.data.M);$("#rfmt-t").empty().append(d.data.T);var c=[];c[0]=d.RScore;c[1]=d.FScore;
c[2]=d.MScore;c[3]=d.TScore;a._initRadar(c);}});},findCsRfmtModelHistory:function(b){var a=this;FormUtils.loadData(CsRfmtModel._CONS_.FIND_CS_MODEL_HISTORY+"?csId="+b,function(c){if(c){a.csRfmtModelHistoryData=c;
a.loadCsRfmtModelHistory(c);}});},loadCsRfmtModelHistory:function(d){var k=this;var f=[];var h=[];var e=[];var a=[];var g=[];var b=0;for(var c=d.length-1;
c>=0;c--){f[b]=d[c].month;h[b]=d[c].RScore;e[b]=d[c].FScore;a[b]=d[c].MScore;g[b]=d[c].TScore;b++;}k._initQUxian(f,h,e,a,g);},_initRadar:function(c){var a=echarts.init(document.getElementById("rfmtChart"));
var b={title:{text:""},tooltip:{},radar:{name:{textStyle:{color:"#555",backgroundColor:"#999",borderRadius:3,padding:[3,5]}},indicator:[{name:"R",max:5},{name:"F",max:5},{name:"M",max:5},{name:"T",max:5}]},series:[{type:"radar",itemStyle:{normal:{color:"#1ab394"}},data:[{value:c,name:"价值模型"}]}]};
a.setOption(b);},_initQUxian:function(d,a,b,c,f){var e=echarts.init(document.getElementById("rfmtLineChart"));option={title:{text:"客户RFMT趋势",subtext:"",textStyle:{fontSize:14,fontWeight:"500",color:"#009688"}},tooltip:{trigger:"axis"},legend:{data:["R","F","M","T"]},toolbox:{show:true,feature:{mark:{show:true},dataView:{show:true,readOnly:false},magicType:{show:true,type:["line","bar"]},restore:{show:true},saveAsImage:{show:true}}},calculable:true,xAxis:[{type:"category",boundaryGap:false,data:d}],yAxis:[{type:"value",axisLabel:{formatter:"{value}"}}],grid:{left:66,right:50,bottom:50,top:50},series:[{name:"R",type:"line",data:a,},{name:"F",type:"line",data:b},{name:"M",type:"line",data:c},{name:"T",type:"line",data:f}]};
e.setOption(option);}};