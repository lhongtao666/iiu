$(function(){var a=new RfmtReport();a.init();});function RfmtReport(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.type="self";
}RfmtReport.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._initReport();this._locateToGlHelp();}},_locateToGlHelp:function(){glHelpUtil.init("glHelp.rfmt.rfmtReport");
},_initReport:function(){var a=this;FormUtils.loadData(ctx+"/crm/rfmt/rfmtModel/findRfmtReport.htm?type="+a.type,function(b){a._initCountReport(b);a._initAvgReport(b);
a._initTotalReport(b);});},_initCountReport:function(d){var h=r_config.split(",");var l=f_config.split(",");var g=new StringBuffer();g.append("<tr>");g.append("<td>").append("RFM model").append("</td>");
g.append("<td>").append("F = 0").append("<br />").append("(未成交)").append("</td>");for(var e=0;e<=l.length;e++){g.append("<td>");g.append("F = ").append(e+1).append("<br />");
if(e==0){g.append("(购买次数&lt;=").append(l[e]).append(")");}else{if(e==l.length){g.append("(购买次数&gt;").append(l[e-1]).append(")");}else{g.append("(").append(l[e-1]).append("&lt;购买次数").append("&lt;=").append(l[e]).append(")");
}}g.append("</td>");}g.append("<td>").append("行合计").append("</td>");var a=this.toMap(d);var m=this.getTotalCount(d);m=(m==0?1:m);var k=[0,0,0,0,0,0];for(var e=0;
e<=h.length;e++){g.append("<tr>").append("<td>");g.append("R = ").append(5-e).append("<br />");if(e==0){g.append("(").append(h[e]).append("天内有交易)").append("</td>");
}else{if(e==h.length){g.append("(").append(h[e-1]).append("天前有交易)");}else{g.append("(").append(h[e-1]).append("-").append(h[e]).append("天内有交易)").append("</td>");
}}g.append("<td>").append("-").append("</td>");var f=0;for(var c=1;c<=5;c++){var b=a[(5-e)+"-"+c];if(!b){b={count:0};}g.append("<td class='rfmt-td' data-r='"+(5-e)+"' data-f='"+c+"'>").append(b.count).append("人").append("<br />").append(((b.count*100)/m).toFixed(2)).append("%").append("</td>");
f=f+b.count;k[c]=k[c]+b.count;}g.append("<td class='rfmt-td' data-r='"+(5-e)+"' data-f='1,2,3,4,5'>").append(f).append("人").append("<br />").append(((f*100)/m).toFixed(2)).append("%").append("</td>");
g.append("</tr>");}g.append("<tr>");g.append("<td>").append("R = 0").append("<br />").append("(未成交)").append("</td>");var b=a["0-0"];if(!b){b={count:0};
}g.append("<td class='rfmt-td' data-r='0' data-f='0'>").append(b.count).append("人").append("<br />").append(((b.count*100)/m).toFixed(2)).append("%").append("</td>");
for(var c=1;c<=5;c++){g.append("<td>").append("-").append("</td>");}k[0]=b.count;g.append("<td class='rfmt-td' data-r='0' data-f='0'>").append(b.count).append("人").append("<br />").append(((b.count*100)/m).toFixed(2)).append("%").append("</td>");
g.append("</tr>");g.append("<tr>");g.append("<td>").append("列合计").append("</td>");var f=0;for(var c=0;c<k.length;c++){g.append("<td class='rfmt-td' data-r='"+(c==0?"0":"1,2,3,4,5")+"' data-f='"+c+"'>").append(k[c]).append("人").append("<br />").append(((k[c]*100)/m).toFixed(2)).append("%").append("</td>");
f=f+k[c];}g.append("<td class='rfmt-td'>").append(f).append("人").append("<br />").append(((f*100)/m).toFixed(2)).append("%").append("</td>");g.append("</tr>");
$("#rfmt-cs-count").empty().append(g.toString());},toMap:function(b){var c={};for(var a=0;a<b.length;a++){c[b[a].RScore+"-"+b[a].FScore]=b[a];}return c;
},getTotalCount:function(c){var b=0;for(var a=0;a<c.length;a++){b=b+c[a].count;}return b;},getTotalMonetary:function(c){var b=0;for(var a=0;a<c.length;
a++){b=b+(c[a].count==0?0:c[a].sumMonetary/c[a].count);}return b;},getTotalSum:function(c){var b=0;for(var a=0;a<c.length;a++){b=b+c[a].sumTotal;}return b;
},_initAvgReport:function(d){var h=r_config.split(",");var l=f_config.split(",");var g=new StringBuffer();g.append("<tr>");g.append("<td>").append("RFM model").append("</td>");
g.append("<td>").append("F = 0").append("<br />").append("(未成交)").append("</td>");for(var e=0;e<=l.length;e++){g.append("<td>");g.append("F = ").append(e+1).append("<br />");
if(e==0){g.append("(购买次数&lt;=").append(l[e]).append(")");}else{if(e==l.length){g.append("(购买次数&gt;").append(l[e-1]).append(")");}else{g.append("(").append(l[e-1]).append("&lt;购买次数").append("&lt;=").append(l[e]).append(")");
}}g.append("</td>");}g.append("<td>").append("行合计").append("</td>");var a=this.toMap(d);var m=this.getTotalMonetary(d);m=(m==0?1:m);var k=[0,0,0,0,0,0];
for(var e=0;e<=h.length;e++){g.append("<tr>").append("<td>");g.append("R = ").append(5-e).append("<br />");if(e==0){g.append("(").append(h[e]).append("天内有交易)").append("</td>");
}else{if(e==h.length){g.append("(").append(h[e-1]).append("天前有交易)");}else{g.append("(").append(h[e-1]).append("-").append(h[e]).append("天内有交易)").append("</td>");
}}g.append("<td>").append("-").append("</td>");var f=0;for(var c=1;c<=5;c++){var b=a[(5-e)+"-"+c];if(!b){b={count:0};}g.append("<td class='rfmt-td' data-r='"+(5-e)+"' data-f='"+c+"'>").append((b.count==0?0:b.sumMonetary/b.count).toFixed(2)).append("元").append("<br />").append((((b.count==0?0:b.sumMonetary/b.count)*100)/m).toFixed(2)).append("%").append("</td>");
f=f+(b.count==0?0:b.sumMonetary/b.count);k[c]=k[c]+(b.count==0?0:b.sumMonetary/b.count);}g.append("<td class='rfmt-td' data-r='"+(5-e)+"' data-f='1,2,3,4,5'>").append(f.toFixed(2)).append("元").append("<br />").append(((f*100)/m).toFixed(2)).append("%").append("</td>");
g.append("</tr>");}g.append("<tr>");g.append("<td>").append("R = 0").append("<br />").append("(未成交)").append("</td>");var b=a["0-0"];if(!b){b={count:0};
}g.append("<td class='rfmt-td' data-r='0' data-f='0'>").append(b.count==0?0:b.sumMonetary/b.count).append("元").append("<br />").append(0).append("%").append("</td>");
for(var c=1;c<=5;c++){g.append("<td>").append("-").append("</td>");}k[0]=0;g.append("<td class='rfmt-td' data-r='0' data-f='0'>").append(0).append("元").append("<br />").append(0).append("%").append("</td>");
g.append("</tr>");g.append("<tr>");g.append("<td>").append("列合计").append("</td>");var f=0;for(var c=0;c<k.length;c++){g.append("<td class='rfmt-td' data-r='"+(c==0?"0":"1,2,3,4,5")+"' data-f='"+c+"'>").append(k[c].toFixed(2)).append("元").append("<br />").append(((k[c]*100)/m).toFixed(2)).append("%").append("</td>");
f=f+k[c];}g.append("<td class='rfmt-td'>").append(f.toFixed(2)).append("元").append("<br />").append(((f*100)/m).toFixed(2)).append("%").append("</td>");
g.append("</tr>");$("#rfmt-cs-monetary").empty().append(g.toString());},_initTotalReport:function(d){var h=r_config.split(",");var l=f_config.split(",");
var g=new StringBuffer();g.append("<tr>");g.append("<td>").append("RFM model").append("</td>");g.append("<td>").append("F = 0").append("<br />").append("(未成交)").append("</td>");
for(var e=0;e<=l.length;e++){g.append("<td>");g.append("F = ").append(e+1).append("<br />");if(e==0){g.append("(购买次数&lt;=").append(l[e]).append(")");}else{if(e==l.length){g.append("(购买次数&gt;").append(l[e-1]).append(")");
}else{g.append("(").append(l[e-1]).append("&lt;购买次数").append("&lt;=").append(l[e]).append(")");}}g.append("</td>");}g.append("<td>").append("行合计").append("</td>");
var a=this.toMap(d);var m=this.getTotalSum(d);m=(m==0?1:m);var k=[0,0,0,0,0,0];for(var e=0;e<=h.length;e++){g.append("<tr>").append("<td>");g.append("R = ").append(5-e).append("<br />");
if(e==0){g.append("(").append(h[e]).append("天内有交易)").append("</td>");}else{if(e==h.length){g.append("(").append(h[e-1]).append("天前有交易)");}else{g.append("(").append(h[e-1]).append("-").append(h[e]).append("天内有交易)").append("</td>");
}}g.append("<td>").append("-").append("</td>");var f=0;for(var c=1;c<=5;c++){var b=a[(5-e)+"-"+c];if(!b){b={sumTotal:0};}g.append("<td class='rfmt-td' data-r='"+(5-e)+"' data-f='"+c+"'>").append(b.sumTotal.toFixed(2)).append("元").append("<br />").append(((b.sumTotal*100)/m).toFixed(2)).append("%").append("</td>");
f=f+b.sumTotal;k[c]=k[c]+b.sumTotal;}g.append("<td class='rfmt-td' data-r='"+(5-e)+"' data-f='1,2,3,4,5'>").append(f.toFixed(2)).append("元").append("<br />").append(((f*100)/m).toFixed(2)).append("%").append("</td>");
g.append("</tr>");}g.append("<tr>");g.append("<td>").append("R = 0").append("<br />").append("(未成交)").append("</td>");var b=a["0-0"];if(!b){b={sumTotal:0};
}g.append("<td class='rfmt-td' data-r='0' data-f='0'>").append(b.sumTotal.toFixed(2)).append("元").append("<br />").append(((b.sumTotal*100)/m).toFixed(2)).append("%").append("</td>");
for(var c=1;c<=5;c++){g.append("<td>").append("-").append("</td>");}k[0]=b.sumTotal;g.append("<td class='rfmt-td' data-r='0' data-f='0'>").append(b.sumTotal.toFixed(2)).append("元").append("<br />").append(((b.sumTotal*100)/m).toFixed(2)).append("%").append("</td>");
g.append("</tr>");g.append("<tr>");g.append("<td>").append("列合计").append("</td>");var f=0;for(var c=0;c<k.length;c++){g.append("<td class='rfmt-td' data-r='"+(c==0?"0":"1,2,3,4,5")+"' data-f='"+c+"'>").append(k[c].toFixed(2)).append("元").append("<br />").append(((k[c]*100)/m).toFixed(2)).append("%").append("</td>");
f=f+k[c];}g.append("<td class='rfmt-td'>").append(f.toFixed(2)).append("元").append("<br />").append(((f*100)/m).toFixed(2)).append("%").append("</td>");
g.append("</tr>");$("#rfmt-cs-total").empty().append(g.toString());},_bindEventHander:function(){var a=this;$(document).on("click",".rfmt-td",function(){if(a.type=="self"){JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/list.htm?r_score="+($(this).attr("data-r")?$(this).attr("data-r"):"")+"&f_score="+($(this).attr("data-f")?$(this).attr("data-f"):""),"我的客户");
}else{JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/subList.htm?r_score="+($(this).attr("data-r")?$(this).attr("data-r"):"")+"&f_score="+($(this).attr("data-f")?$(this).attr("data-f"):""),"下属客户");
}});$(".select-type").on("click",function(){$(".select-type").removeClass("on");$(this).addClass("on");var b=$(this).attr("data-type");if(b!=a.type){a.type=b;
a._initReport();}});}};