$(function(){var a=new RfmtSearch();a.init();});function RfmtSearch(){this.hadInit=false;this.isEdit=false;this.showTipSetTimeout=null;}RfmtSearch.prototype={init:function(){if(!isUseRfmt=="true"){return;
}if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._dealStyle();this._initRfmtConfig();this._initRfmtRf();this._initRfmtMt();}},selectRfmt:function(){var b=[];
var d=[];if(RScore&&RScore!=""&&RScore!=null){b=RScore.split(",");}if(FScore&&FScore!=""&&FScore!=null){d=FScore.split(",");}if(b.length>0){for(var c=0;
c<b.length;c++){if(d.length>0){for(var a=0;a<d.length;a++){$("#rfmt-rf-container").find(".rfmt-div[data-r='"+b[c]+"'][data-f='"+d[a]+"']").addClass("on");
}}else{$("#rfmt-rf-container").find(".rfmt-div[data-r='"+b[c]+"']").addClass("on");}}}else{for(var a=0;a<d.length;a++){$("#rfmt-rf-container").find(".rfmt-div[data-f='"+d[a]+"']").addClass("on");
}}if(RScore=="0"&&FScore=="0"){$("#rfmt-config-container").val("未消费未成交");}this.selectOutBtn();},selectOutBtn:function(){if($("#rfmt-rf-container").find(".rfmt-div.on").length>0||$("#rfmt-mt-container").find(".rfmt-div.on").length>0||!($("#rfmt-config-container").val()==null||$("#rfmt-config-container").val()=="")){$(".csEntityRfmt").addClass("on");
}else{$(".csEntityRfmt").removeClass("on");}},dealTip:function(){var a=this;if($(".csEntityRfmt").hasClass("on")){$(".csRfmtTip").slideDown("fast");if(a.showTipSetTimeout!=null){clearTimeout(a.showTipSetTimeout);
}a.showTipSetTimeout=setTimeout(function(){$(".csRfmtTip").slideUp("fast");a.showTipSetTimeout=null;},5000);}else{$(".csRfmtTip").slideUp("fast");}},getRfmtParam:function(){var q={};
var a="";var v={};var j="";var s={};var l="";var o={};var n="";var d=$("#rfmt-rf-container").find(".rfmt-div.on");var c=$("#rfmt-mt-container").find(".rfmt-div.on");
for(var u=0;u<d.length;u++){var e=$(d[u]).attr("data-r");if(!q[e]){q[e]=1;a=a+e+",";}var p=$(d[u]).attr("data-f");if(!v[p]){v[p]=1;j=j+p+",";}}for(var u=0;
u<c.length;u++){var k=$(c[u]).attr("data-m");if(!s[k]){s[k]=1;l=l+k+",";}var b=$(c[u]).attr("data-t");if(!o[b]){o[b]=1;n=n+b+",";}}var g=$("#start-rfmt").val();
var w=$("#end-rfmt").val();var h="&RScore="+a.substring(0,a.length-1)+"&FScore="+j.substring(0,j.length-1)+"&MScore="+l.substring(0,l.length-1)+"&TScore="+n.substring(0,n.length-1)+"&startRfmt="+g+"&endRfmt="+w;
return h;},_initRfmtConfig:function(){FormUtils.loadData(ctx+"/crm/rfmt/rfmtConfig/listData.htm?rows=100&page=1",function(b){var c=new StringBuffer();c.append("<option value='' >请选择</option>");
for(var a=0;a<b.rows.length;a++){c.append("<option").append(" value='"+b.rows[a].name+"'").append(">"+b.rows[a].name+"</option>");}$("#rfmt-config-container").empty().append(c.toString());
});},_initRfmtRf:function(){var a=this;FormUtils.loadData(ctx+"/crm/rfmt/rfmtRflevel/listData.htm?rows=100&page=1",function(c){var d=new StringBuffer();
for(var b=1;b<c.rows.length;b++){d.append("<div class='rfmt-div' data-r='"+c.rows[b].RScore+"' data-f='"+c.rows[b].FScore+"' data-type='"+c.rows[b].type+"'>").append("R").append(c.rows[b].RScore).append("F").append(c.rows[b].FScore).append("<br />").append(c.rows[b].rf).append("</div>");
}d.append("<div class='rfmt-div' data-r='"+c.rows[0].RScore+"' data-f='"+c.rows[0].FScore+"' data-type='"+c.rows[0].type+"'>").append("R").append(c.rows[0].RScore).append("F").append(c.rows[0].FScore).append("<br />").append(c.rows[0].rf).append("</div>");
$("#rfmt-rf-container").empty().append(d.toString());a.selectRfmt();});},_initRfmtMt:function(){FormUtils.loadData(ctx+"/crm/rfmt/rfmtMtlevel/listData.htm?rows=100&page=1",function(b){var c=new StringBuffer();
for(var a=1;a<b.rows.length;a++){c.append("<div class='rfmt-div' data-m='"+b.rows[a].MScore+"' data-t='"+b.rows[a].TScore+"' data-type='"+b.rows[a].type+"'>").append("M").append(b.rows[a].MScore).append("T").append(b.rows[a].TScore).append("<br />").append(b.rows[a].mt).append("</div>");
}c.append("<div class='rfmt-div' data-m='"+b.rows[0].MScore+"' data-t='"+b.rows[0].TScore+"' data-type='"+b.rows[0].type+"'>").append("M").append(b.rows[0].MScore).append("T").append(b.rows[0].TScore).append("<br />").append(b.rows[0].mt).append("</div>");
$("#rfmt-mt-container").empty().append(c.toString());});},_dealStyle:function(){},_bindEventHander:function(){var a=this;$(".csEntityRfmt").on("click",function(){$("#rfmtSearchForm").slideDown("fast");
});$("#close-rfmt").on("click",function(){$("#rfmtSearchForm").slideUp("fast");});$("#rfmt-config-container").on("change",function(){$("#rfmt-rf-container").find(".rfmt-div").removeClass("on");
$("#rfmt-mt-container").find(".rfmt-div").removeClass("on");var c=$(this).val();var b=[];if(c.length<=4){b[0]=c.substring(0,2);b[1]=c.substring(2,4);}else{b[0]=c.substring(0,3);
b[1]=c.substring(3,c.length);}$("#rfmt-rf-container").find(".rfmt-div[data-type='"+b[1]+"']").addClass("on");$("#rfmt-mt-container").find(".rfmt-div[data-type='"+b[0]+"']").addClass("on");
a.selectOutBtn();});$(document).on("click",".rfmt-div",function(){if($(this).hasClass("on")){$(this).removeClass("on");}else{$(this).addClass("on");}a.selectOutBtn();
});$("#rfmt-search-clear").on("click",function(){$("#rfmt-rf-container").find(".rfmt-div").removeClass("on");$("#rfmt-mt-container").find(".rfmt-div").removeClass("on");
$("#start-rfmt").val("");$("#end-rfmt").val("");$("#rfmt-config-container").val("");a.selectOutBtn();});$("#rfmt-search-btn").on("click",function(){$(".csEntitySearch").trigger("click");
});}};