$(function(){var a=new RpCti();a.init();});function RpCti(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}RpCti._CONS_={EDIT_URL:ctx+"/ec/rp/rpCti/edit.htm",TO_DETAIL_URL:ctx+"/ec/rp/rpCti/toDetail.htm",FIND_SUM_DATA_URL:ctx+"/ec/rp/rpCti/findSum.htm",EDIT_FORM_ID:"rpCtiForm",GRID:"#rpCtiGrid",PAGER:"#rpCtiPager",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",};
RpCti.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._initJqgrid(a);this._buildEmployeeOption("");}},_bindEventHander:function(){var a=this;
$("#rpCtiSearch").on("click",function(){var b=$(this).closest("form").serialize();a.reloadJqgrid(b);});$("#rpCtiSearchForm").on("keypress",function(b){if(b.keyCode=="13"){$(".rpCtiSearch").trigger("click");
}});$("body").on("click",".rpCtiDetail",function(){var f=$(this).attr("employeeName");var d=$(this).attr("employeeId");var b=$("[name=startDate]").val();
var e=$("[name=endDate]").val();var c=RpCti._CONS_.TO_DETAIL_URL+"?employeeId="+d+"&startDate="+b+"&endDate="+e;JTTabUtils.addOrRefreshTab(c,f+"每天通话统计");
});$("#belongOgnName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"belongOgnName",nolimit:true,positionType:"all",fn:function(c){$("input[name=belongOgn]").val(c);
a._buildEmployeeOption(c);}};GroupUtils.selectGroupTreeBox(b);});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(RpCti._CONS_.GRID,a);},_getManagerBtns:function(){var a=[];
a.push({lable:msgCode.DETAIL_BTN_TEXT,btnClasses:"rpCtiDetail",iconClasses:"fa fa-list"});return a;},_initJqgrid:function(a){if(a==null||typeof a==undefined){a={};
}$(RpCti._CONS_.GRID).JTJqgrid({url:RpCti._CONS_.FIND_SUM_DATA_URL+"?type=sum",pager:RpCti._CONS_.PAGER,postData:a,colNames:["部门","员工","通话时长(秒)","呼出总数","有效通话总数","操作"],colModel:[{name:"groupName",index:"group_name_",width:120},{name:"name",index:"name_",width:120,formatter:function(b,c,d){return d.aid+":"+d.name;
}},{name:"callTime",index:"call_time_",width:120},{name:"callCount",index:"call_count_",width:120},{name:"validCount",index:"valid_count_",width:120},{name:"id",index:"id_",width:120,sortable:false,formatter:function(b,c,d){return"<button type='button' class='btn btn-sm btn-outline btn-primary rpCtiDetail' employeeId='"+d.employeeId+"' employeeName='"+d.name+"'>查看明细</button>";
}}]});},_buildEmployeeOption:function(b){var a=RpCti._CONS_.EMPLOYEE_LIST_URL+"?groupId="+b+"&type=dept_manager";FormUtils.loadData(a,function(d){$("#belongEmployeeSearch").empty();
if(d&&d.length>0){var e=new StringBuffer();e.append("<option value=''>请选择</option>");for(var c=0;c<d.length;c++){e.append("<option value='"+d[c].id+"'>"+d[c].aid+":"+d[c].name+"</option>");
}$("#belongEmployeeSearch").append(e.toString()).select2();}},null,true);},};