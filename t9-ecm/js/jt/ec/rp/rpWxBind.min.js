$(function(){var a=new RpWxBind();a.init();});function RpWxBind(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}RpWxBind._CONS_={LIST_DATA_URL:ctx+"/ec/rp/rpWxBind/listData.htm",EXPORT_URL:ctx+"/ec/rp/rpWxBind/exportReport.htm",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",EDIT_FORM_ID:"rpWxBindForm",GRID:"#rpWxBindGrid",PAGER:"#rpWxBindPager"};
RpWxBind.prototype={init:function(b){if(!this.hadInit){this.hadInit=true;var a=this;$("#beginDate").val(new Date().currentDate()+" 00:00:00");$("#endDate").val(new Date().currentDate()+" 23:59:59");
this._bindEventHander();this._initJqgrid(a._getParam());this._buildEmployeeSelect();}},_buildEmployeeSelect:function(a){$.ajax({type:"GET",url:ctx+"/crm/ou/employee/listEmployees.htm"+"?groupId="+(a?a:""),contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(c){if(c&&c.length>0){var d=new StringBuffer();
d.append("<option value=''>请选择</option>");for(var b=0;b<c.length;b++){d.append("<option value='"+c[b].id+"'>"+c[b].aid+":"+c[b].name+"</option>");}$("#belongEmployee").empty().append(d.toString()).select2();
}}});},_getParam:function(){var a={beginTime:$("input[name='beginDate']").val(),endTime:$("input[name='endDate']").val(),type:$("select[name='type']").val(),belongEmployee:$("select[name='belongEmployee']").val(),belongOgn:$("input[name='belongOgn']").val()};
return a;},_bindEventHander:function(){var a=this;$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
FormUtils.loadData(RpWxBind._CONS_.EMPLOYEE_LIST_URL+"?groupId="+c+"&type=statistics,dept_manager",function(e){var f=new StringBuffer();f.append('<option value="">请选择</option>');
for(var d=0;d<e.length;d++){f.append("<option value='"+e[d].id+"'>"+e[d].aid+":"+e[d].name+"</option>");}$("#belongEmployee").empty().append(f.toString());
});}};GroupUtils.selectGroupTreeBox(b);});$(".report-content").on("click",".exportExcel",function(){ButtonUtils.disableBtn("exportExcel");FormUtils.submit(RpWxBind._CONS_.EXPORT_URL,a._getParam(),function(b){ButtonUtils.enableBtn("exportExcel");
if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});$("#rpWxBindSearch").on("click",function(){a.reloadJqgrid(a._getParam());});$("#rpWxBindSearchForm").on("keypress",function(b){if(b.keyCode=="13"){$(".rpWxBindSearch").trigger("click");
}});$(document).on("click",".toCsEntityEdit",function(){var b=$(this).attr("value");JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.DETAIL_CS_PAGE_URL+"?csId="+b,"客户明细");
});$(document).on("click","#clearSearchBtn",function(){FormUtils.clear("rpWxBindSearchForm");});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(RpWxBind._CONS_.GRID,a);
},_initJqgrid:function(a){if(a==null||typeof a==undefined){a={};}$(RpWxBind._CONS_.GRID).JTJqgrid({url:RpWxBind._CONS_.LIST_DATA_URL,pager:RpWxBind._CONS_.PAGER,postData:a,footerrow:true,colNames:["关联的客户","好友微信昵称","员工微信号","员工工号 / 姓名","类型","是否成单","绑定时间"],colModel:[{name:"csCode",index:"cs_code_",width:120,formatter:function(b,c,d){var e=new StringBuffer();
e.append("<a class='toCsEntityEdit' style='font-weight:bold;' value='"+d.csId+"' >").append(d.csCode);if(d.csName){e.append(":").append(d.csName);}e.append("</a>");
return e.toString();}},{name:"nickName",index:"nick_name_",width:120},{name:"empWx",index:"emp_wx_",width:120},{name:"aidAndName",index:"emp_wx_",width:120},{name:"typeStr",index:"type_",width:120},{name:"existSoStr",index:"exist_so_",width:120},{name:"createTime",index:"create_time_",width:120,formatter:function(b){return DateUtils.mini2Time(b);
}}],});}};