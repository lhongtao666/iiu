$(function(){var a=new ProdSale();a.init();});function ProdSale(){this.hadInit=false;this.isEdit=false;this.sortColumn="";this.sortorder="";}ProdSale._CONS_={LIST_DATA_URL:ctx+"/ec/rp/reportProfit/listProdSaleData.htm",EXPORT_URL:ctx+"/ec/rp/reportProfit/exportProdSale.htm",GRID:"#prodSaleGrid",PAGER:"#prodSalePager"};
ProdSale.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();ReportDateUtil.initDate(".report-content");$("#timeTypeSearch").change();
a._initJqgrid();}},_bindEventHander:function(){var a=this;$("#searchBtn").on("click",function(){a.reloadJqgrid(a.toPostParam());});$("body").on("click",".relativeSoItem",function(){var d=$(this).attr("soNos");
var b=$(this).attr("sku-id");var c="/ec/rp/reportProfit/toRelativeSoItem.htm?soNos="+d+"&skuId="+b;JTTabUtils.addOrRefreshTab(ctx+c,"关联订单商品");});$("#groupName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",nolimit:true,positionType:"statistics,dept_manager",fn:function(c){$("input[name=belongOgn]").val(c);
}};GroupUtils.selectGroupTreeBox(b);});$(".exportExcel").on("click",function(){ButtonUtils.disableBtn("exportExcel");FormUtils.submit(ProdSale._CONS_.EXPORT_URL,a.toPostParam()+"&sidx="+a.sortColumn+"&sord="+a.sortorder,function(b){ButtonUtils.enableBtn("exportExcel");
if(b.success){DialogUtils.success(msgCode.INFO,b.msg+"成功");}else{DialogUtils.error(msgCode.FAIL_MSG,b.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});},_initJqgrid:function(){var b={};var a=this;b.Q__D__BW__oper_time_=ReportDateUtil.getDateTimeRangeStr();b.timeType="oper";$(ProdSale._CONS_.GRID).JTJqgrid({url:ProdSale._CONS_.LIST_DATA_URL,postData:b,multiselect:false,footerrow:true,rowNum:-1,colNames:["商品名称","|","下单数(hide)","下单数","商品数","商品金额","|","审单数(hide)","审单数","商品数","商品金额","通过率","|","发货单数(hide)","发货单数","商品数","商品金额","|","签收单数(hide)","签收单数","商品数","商品金额","妥投率","|","拒收单数(hide)","拒收单数","商品数","商品金额"],colModel:[{name:"prodName",width:90,sortable:false},{name:"",width:10,sortable:false},{name:"soCountOfPlace",width:60,sortable:false,hidedlg:true,hidden:true},{name:"soCountOfPlace",width:60,sortable:false,formatter:function(c,d,e){return"<a href='#' title='查看关联订单' class='relativeSoItem' sku-id='"+e.skuId+"' soNos='"+e.soNoOfPlace+"'>"+e.soCountOfPlace+"</a>";
}},{name:"prodCountOfPlace",width:60,sortable:false},{name:"prodSumOfPlace",width:60,sortable:false},{name:"",width:10,sortable:false},{name:"soCountOfConfirm",width:60,sortable:false,hidedlg:true,hidden:true},{name:"soCountOfConfirm",width:60,sortable:false,formatter:function(c,d,e){return"<a href='#' title='查看关联订单' class='relativeSoItem' sku-id='"+e.skuId+"' soNos='"+e.soNoOfConfirm+"'>"+c+"</a>";
}},{name:"prodCountOfConfirm",width:60,sortable:false},{name:"prodSumOfConfirm",width:60,sortable:false},{name:"confirmRate",width:60,sortable:false},{name:"",width:10,sortable:false},{name:"soCountOfShip",width:60,sortable:false,hidedlg:true,hidden:true},{name:"soCountOfShip",width:60,sortable:false,formatter:function(c,d,e){return"<a href='#' title='查看关联订单' class='relativeSoItem' sku-id='"+e.skuId+"' soNos='"+e.soNoOfShip+"'>"+c+"</a>";
}},{name:"prodCountOfShip",width:60,sortable:false},{name:"prodSumOfShip",width:60,sortable:false},{name:"",width:10,sortable:false},{name:"soCountOfComplete",width:60,sortable:false,hidedlg:true,hidden:true},{name:"soCountOfComplete",width:60,sortable:false,formatter:function(c,d,e){return"<a href='#' title='查看关联订单' class='relativeSoItem' sku-id='"+e.skuId+"' soNos='"+e.soNoOfComplete+"'>"+c+"</a>";
}},{name:"prodCountOfComplete",width:60,sortable:false},{name:"prodSumOfComplete",width:60,sortable:false},{name:"tuoTouRate",width:60,sortable:false},{name:"",width:10,sortable:false},{name:"soCountOfReject",width:60,sortable:false,hidedlg:true,hidden:true},{name:"soCountOfReject",width:60,sortable:false,formatter:function(c,d,e){return"<a href='#' title='查看关联订单' class='relativeSoItem' sku-id='"+e.skuId+"' soNos='"+e.soNoOfReject+"'>"+c+"</a>";
}},{name:"prodCountOfReject",width:60,sortable:false},{name:"prodSumOfReject",width:60,sortable:false}],gridComplete:function(){var r=$(ProdSale._CONS_.GRID).jqGrid("getGridParam","records");
var e=$(ProdSale._CONS_.GRID).jqGrid("getCol","soCountOfPlace",true,"sum");var m=$(ProdSale._CONS_.GRID).jqGrid("getCol","prodCountOfPlace",true,"sum");
var t=$(ProdSale._CONS_.GRID).jqGrid("getCol","prodSumOfPlace",true,"sum");var j=$(ProdSale._CONS_.GRID).jqGrid("getCol","soCountOfConfirm",true,"sum");
var o=$(ProdSale._CONS_.GRID).jqGrid("getCol","prodCountOfConfirm",true,"sum");var d=$(ProdSale._CONS_.GRID).jqGrid("getCol","prodSumOfConfirm",true,"sum");
var l=$(ProdSale._CONS_.GRID).jqGrid("getCol","soCountOfShip",true,"sum");var q=$(ProdSale._CONS_.GRID).jqGrid("getCol","prodCountOfShip",true,"sum");var f=$(ProdSale._CONS_.GRID).jqGrid("getCol","prodSumOfShip",true,"sum");
var s=$(ProdSale._CONS_.GRID).jqGrid("getCol","soCountOfComplete",true,"sum");var i=$(ProdSale._CONS_.GRID).jqGrid("getCol","prodCountOfComplete",true,"sum");
var g=$(ProdSale._CONS_.GRID).jqGrid("getCol","prodSumOfComplete",true,"sum");var k=$(ProdSale._CONS_.GRID).jqGrid("getCol","soCountOfReject",true,"sum");
var h=$(ProdSale._CONS_.GRID).jqGrid("getCol","prodCountOfReject",true,"sum");var n=$(ProdSale._CONS_.GRID).jqGrid("getCol","prodSumOfReject",true,"sum");
var c="0.00%";var p="0.00%";if(t!=0){c=((d/t)*100).toFixed(2)+"%";}if(f!=0){p=((g/f)*100).toFixed(2)+"%";}$(ProdSale._CONS_.GRID).jqGrid("footerData","set",{"prodName":"总计:<span style='color:red'>"+r+"</span>条","soCountOfPlace":"<span style='color:red;'>"+e+"</span>","prodCountOfPlace":"<span style='color:red;'>"+m+"</span>","prodSumOfPlace":"<span style='color:red;'>"+t+"</span>","soCountOfConfirm":"<span style='color:red;'>"+j+"</span>","prodCountOfConfirm":"<span style='color:red;'>"+o+"</span>","prodSumOfConfirm":"<span style='color:red;'>"+d+"</span>","soCountOfShip":"<span style='color:red;'>"+l+"</span>","prodCountOfShip":"<span style='color:red;'>"+q+"</span>","soCountOfShip":"<span style='color:red;'>"+l+"</span>","prodSumOfShip":"<span style='color:red;'>"+f+"</span>","soCountOfComplete":"<span style='color:red;'>"+s+"</span>","prodCountOfComplete":"<span style='color:red;'>"+i+"</span>","prodSumOfComplete":"<span style='color:red;'>"+g+"</span>","soCountOfReject":"<span style='color:red;'>"+k+"</span>","prodCountOfReject":"<span style='color:red;'>"+h+"</span>","prodSumOfReject":"<span style='color:red;'>"+n+"</span>","confirmRate":"<span style='color:red;'>"+c+"</span>","tuoTouRate":"<span style='color:red;'>"+p+"</span>"});
}});$(ProdSale._CONS_.GRID).jqGrid("setGroupHeaders",{useColSpanStyle:false,groupHeaders:[{startColumnName:"prodCountOfPlace",numberOfColumns:1,titleText:"下单"},{startColumnName:"prodCountOfConfirm",numberOfColumns:2,titleText:"审单"},{startColumnName:"prodCountOfShip",numberOfColumns:1,titleText:"发货"},{startColumnName:"prodCountOfComplete",numberOfColumns:2,titleText:"签收"},{startColumnName:"prodCountOfReject",numberOfColumns:1,titleText:"拒收"}]});
},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(ProdSale._CONS_.GRID,a);},toPostParam:function(){var a=$("#prodSaleSearchForm").serialize();if($(".timeType").val()=="oper"){a+="&Q__D__BW__oper_time_="+ReportDateUtil.getDateTimeRangeStr();
a+="&timeType=oper";}else{a+="&Q__D__BW__place_time_="+ReportDateUtil.getDateTimeRangeStr();a+="&timeType=place";}return a;}};