$(function(){var a=new RpCtiValid();a.init();});function RpCtiValid(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}RpCtiValid._CONS_={EXPORT_URL:ctx+"/gl/cti/tRKSheetRecord/validRecordExport.htm",TO_VALID_DETAIL_URL:ctx+"/gl/cti/tRKSheetRecord/toValidDetail.htm",FIND_VALID_DATA_URL:ctx+"/gl/cti/tRKSheetRecord/listValidRecordRp.htm",EDIT_FORM_ID:"rpCtiValidForm",GRID:"#rpCtiValidGrid",PAGER:"#rpCtiValidPager",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",};
RpCtiValid.prototype={init:function(d){if(!this.hadInit){this.hadInit=true;var a=new Date();var c=DateUtils.format(a,"yyyy-MM-dd");var b=c+" 00:00:00";
var e=c+" 23:59:59";$(".minCreateTime").val(b);$(".maxCreateTime").val(e);this._bindEventHander();this._initJqgrid(d);this._initEmployeeSelect("");}},_bindEventHander:function(){var a=this;
$("#rpCtiSearch").on("click",function(){var b=$(this).closest("form").serialize();a.reloadJqgrid(b);});$("#rpCtiSearchForm").on("keypress",function(b){if(b.keyCode=="13"){$(".rpCtiSearch").trigger("click");
}});$("body").on("click",".rpCtiDetail",function(){var g=$(this).attr("csName");var f=$(this).attr("employeeName");var e=$(this).attr("agentId");var b=$("[name=startDate]").val();
var d=$("[name=endDate]").val();var c=RpCtiValid._CONS_.TO_VALID_DETAIL_URL+"?agentId="+e+"&startDate="+b+"&endDate="+d;JTTabUtils.addOrRefreshTab(c,"["+f+"]有效通话统计");
});$("#belongOgnName").on("click",function(){var b={isMultiple:0,selectedGroupId:$("input[name='belongOgn']").val(),container:"belongOgnName",nolimit:true,positionType:"all",fn:function(c){$("input[name=belongOgn]").val(c);
a._initEmployeeSelect(c);}};GroupUtils.selectGroupTreeBox(b);});$(".exportExcel").on("click",function(){ButtonUtils.disableBtn("exportExcel");var b=$(this).closest("form").serialize();
FormUtils.submit(RpCtiValid._CONS_.EXPORT_URL,b,function(c){ButtonUtils.enableBtn("exportExcel");if(c.success){DialogUtils.success(msgCode.INFO,c.msg+"成功");
}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(RpCtiValid._CONS_.GRID,a);
},_getManagerBtns:function(){var a=[];a.push({lable:msgCode.DETAIL_BTN_TEXT,btnClasses:"rpCtiDetail",iconClasses:"fa fa-list"});return a;},_initJqgrid:function(a){if(a==null||typeof a==undefined){a="startDate="+$(".minCreateTime").val()+" &endDate="+$(".maxCreateTime").val();
}$(RpCtiValid._CONS_.GRID).JTJqgrid({url:RpCtiValid._CONS_.FIND_VALID_DATA_URL+"?type=sum",pager:RpCtiValid._CONS_.PAGER,postData:a,footerrow:true,colNames:["部门","员工","通话时长","每日达标数","有效通话次数","有效通话天数"],colModel:[{name:"groupName",index:"groupName",width:120},{name:"employeeName",index:"employeeName",width:120,formatter:function(b,c,d){return d.employeeAid+":"+d.employeeName;
}},{name:"totalCallTimeStr",index:"totalCallTimeStr",width:120,formatter:function(b,c,d){if(d.totalCallTimeStr!=""&&d.totalCallTimeStr!=null){return d.totalCallTimeStr;
}else{return"0秒";}}},{name:"percentCount",index:"percentCount",width:120,formatter:function(b,c,d){return d.percentCount+"/"+d.workDays;}},{name:"validCallCount",index:"validCallCount",width:120,formatter:function(b,c,d){return"<a class='rpCtiDetail' agentId='"+d.employeeAid+"' employeeName='"+d.employeeName+"'>"+d.validCallCount+"</a>";
}},{name:"validCallDays",index:"validCallDays",width:120}]});},_initEmployeeSelect:function(b){var a=RpCtiValid._CONS_.EMPLOYEE_LIST_URL+"?groupId="+b+"&type=dept_manager";
FormUtils.loadData(a,function(d){$("#agentIdSearch").empty();if(d&&d.length>0){var e=new StringBuffer();e.append("<option value=''>请选择</option>");for(var c=0;
c<d.length;c++){e.append("<option value='"+d[c].id+"'>"+d[c].aid+":"+d[c].name+"</option>");}$("#agentIdSearch").append(e.toString()).select2();}},null,true);
},};