function StStockBill(a){if(a.type=="in"){if(a.status=="draft"){this.grid=StStockBill._CONS_.GRID_IN_DRAFT;this.pager=StStockBill._CONS_.PAGER_IN_DRAFT;
}else{this.grid=StStockBill._CONS_.GRID_IN;this.pager=StStockBill._CONS_.PAGER_IN;}}else{if(a.type==="out"){if(a.status=="draft"){this.grid=StStockBill._CONS_.GRID_OUT_DRAFT;
this.pager=StStockBill._CONS_.PAGER_OUT_DRAFT;}else{this.grid=StStockBill._CONS_.GRID_OUT;this.pager=StStockBill._CONS_.PAGER_OUT;}}}this.type=a.type;this.ststus=a.status;
}StStockBill._CONS_={GRID_IN:"#stStockBillBuyGrid",PAGER_IN:"#stStockBillBuyPager",GRID_IN_DRAFT:"#stStockBillBuyDraftGrid",PAGER_IN_DRAFT:"#stStockBillBuyDraftPager",GRID_OUT:"#stStockBillOutGrid",PAGER_OUT:"#stStockBillOutPager",GRID_OUT_DRAFT:"#stStockBillOutDraftGrid",PAGER_OUT_DRAFT:"#stStockBillOutDraftPager",};
StStockBill.prototype={init:function(a){this._initJqgrid(a);this._bindEventHandler();},_bindEventHandler:function(){var a=this;$(window).bind("resize",function(){a._resizeJqgridWidth();
});$("body").on("click",".showBillDetail",function(){if(a.type=="in"){a._showInDetail();}else{if(a=="out"){a._showOutDetail();}}});},reloadJqgrid:function(f){var e={};
if(f&&jQuery.type(f)=="string"){f=decodeURIComponent(f,true);var b=f.split("&");if(b.length){for(var c=0;c<b.length;c++){var d=b[c].split("=");if(d.length==2&&d[1]){e[d[0]]=d[1];
}else{e[d[0]]=d[1];}}}}else{e=f;}var a=$(this.grid).jqGrid("getGridParam","postData");$.extend(a,e);$(this.grid).jqGrid("setGridParam",{datatype:"json",search:true}).trigger("reloadGrid",[{page:1}]);
},_showInDetail:function(){},_showOutDetail:function(){},_resizeJqgridWidth:function(){var a=0;a=$("#stockContainer").width()-20-22;if(a<0){a=$(".list_wrapper").find(".panel-heading").width();
}$(this.grid).jqGrid("setGridWidth",a);},_getManagerBtns:function(){var a=[];a.push({lable:"明细",btnClasses:"btn btn-primary showBillDetail",iconClasses:"fa fa-edit"});
return a;},_initJqgrid:function(e){var b=this;$.jgrid.defaults.styleUI="Bootstrap";var a="执行时间";if(e){if(e.type==="in"){a="入库日期";}else{if(e.type==="out"){a="出库日期";
}}}var d=["序号","名称","单据号码","经手人",a,"业务类型","仓库","备注","类型","创建时间"];var c=[{name:"id",index:"id_",width:120,hidden:true},{name:"name",index:"name_",width:120},{name:"code",index:"code_",width:120},{name:"operName",index:"oper_id_",width:100,sortable:false},{name:"operTime",index:"oper_time_",width:120},{name:"subType",index:"sub_type_",width:120,sortable:false,formatter:function(i,f,h){var g=h.type;
if(g=="reject_in"||i=="reject_in"){return"拒收入库";}else{if(g=="sale"||i=="sale"){return"销售出库";}else{if(g=="allocate_in"||i=="allocate_in"){return"调库入库";}else{if(g=="allocate_out"||i=="allocate_out"){return"调库出库";
}else{if(g=="manual_out"||i=="manual_out"){return"人工出库";}else{if(g=="in"||i=="buy"){return"采购入库";}else{return i;}}}}}}}},{name:"storeName",index:"store_id_",width:120,hidden:true},{name:"comment",index:"comment_",width:120,sortable:false},{name:"type",index:"type_",width:120,sortable:false,hidden:true},{name:"createTime",index:"create_time_",width:120,formatter:function(f){return DateUtils.miniTime(f);
}},];if(b.ststus=="draft"){d=d.concat(["操作"]);c=c.concat([{name:"oprate",width:90,formatter:function(h,f,g){return"<button type='button'  id-value='"+g.id+"' type-value='"+g.type+"' class='btn btn-sm btn-outline btn-primary showBillDetail'>明细</button>";
}}]);}else{d=d.concat(["操作"]);c=c.concat([{name:"oprate",width:90,formatter:function(j,g,i){var h=i.type;var f="";if(h=="manual_out"||h=="allocate_out"||h=="allocate_in"||h=="in"){f="<button type='button' id-value='"+i.id+"' type-value='"+h+"' class='btn btn-sm btn-outline btn-primary exportBill'>导出单据</button>";
}return f;}}]);}$(this.grid).jqGrid({datatype:"local",url:ctx+"/ec/stock/stStock/listStockBillData.htm",height:350,autowidth:true,shrinkToFit:true,rowNum:20,postData:e,mtype:"POST",viewrecords:true,multiselect:false,rowList:[10,20,30],pager:this.pager,hidegrid:false,rownumbers:true,colNames:d,colModel:c,loadComplete:function(){b._resizeJqgridWidth();
}});}};