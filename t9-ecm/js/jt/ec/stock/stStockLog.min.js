function StStockLog(){this.isManyStore=isManyStore?isManyStore:"y";}StStockLog._CONS_={BILL_DATA_URL:ctx+"/ec/stock/stBill/listWithItemData.htm",GRID:"#stStockLogGrid",PAGER:"#stStockLogPager"};
StStockLog.prototype={init:function(a){this._initJqgrid(a);this._bindEventHandler();},_bindEventHandler:function(){var a=this;$(window).bind("resize",function(){a._resizeJqgridWidth();
});$(document).on("click",".tabDetail",function(){var b="";var e=$(this).attr("bill-id");var c=$(this).attr("bill-code");var d=$(this).attr("bill-type");
switch(d){case"in":b="采购入库";break;case"out":b="销售出库";break;case"check_in":b="盘盈";break;case"check_out":b="盘亏";break;case"reject_in":b="拒收入库";break;case"allocate_out":b="调拨出库";
break;case"allocate_in":b="调拨入库";break;case"manual_out":b="人工出库";break;}layer.open({type:1,title:"单据【"+c+"】明细",btn:"关闭",maxmin:false,shadeClose:true,area:["50%","30%"],content:'<div class="col-sm-12 jqGrid_wrapper"><table id="billBuyTab" class="table"></table></div>',success:function(f,g){a._loadBillList(e,b);
$(".layui-layer-title").css({"background-color":"#1caf9a !important",color:"#fff !important"});}});});},reloadJqgrid:function(f){var e={};if(f&&jQuery.type(f)=="string"){f=decodeURIComponent(f,true);
var b=f.split("&");if(b.length){for(var c=0;c<b.length;c++){var d=b[c].split("=");if(d.length==2&&d[1]){e[d[0]]=d[1];}else{e[d[0]]=d[1];}}}}else{e=f;}var a=$(StStockLog._CONS_.GRID).jqGrid("getGridParam","postData");
$.extend(a,e);$(StStockLog._CONS_.GRID).jqGrid("setGridParam",{datatype:"json",search:true}).trigger("reloadGrid",[{page:1}]);},_resizeJqgridWidth:function(){var a=0;
a=$("#stockContainer").width()-20-22;if(a<0){a=$(".list_wrapper").find(".panel-heading").width();}$(StStockLog._CONS_.GRID).jqGrid("setGridWidth",a);},_initJqgrid:function(c){var b=false;
if("n"==this.isManyStore){b=true;}var a=this;$.jgrid.defaults.styleUI="Bootstrap";$(StStockLog._CONS_.GRID).jqGrid({datatype:"local",url:ctx+"/ec/stock/stStock/listStockLogData.htm",height:350,autowidth:true,shrinkToFit:true,rowNum:20,postData:c,mtype:"POST",viewrecords:true,multiselect:false,rowList:[10,20,30],pager:StStockLog._CONS_.PAGER,hidegrid:false,rownumbers:true,colNames:["序号","sku编号","仓库","关联订单号","单据编号","业务类型","剩余数量","变更数量","创建时间"],colModel:[{name:"skuCode",index:"skuCode",width:120,hidden:true},{name:"skuCode",index:"skuCode",width:120},{name:"storeName",index:"store_id_",hidden:b,width:120},{name:"soNo",width:120},{name:"billCode",index:"bill_id_",width:120,formatter:function(d,e,f){if(f.billCode!=""&&f.billCode!=null){return"<a href='#' class='tabDetail' bill-id='"+f.billId+"' bill-code='"+f.billCode+"' bill-type='"+f.type+"'>"+f.billCode+"</a>";
}else{return"";}}},{name:"type",index:"type_",width:120,sortable:false,formatter:function(d){switch(d){case"in":return"<span>采购入库</span>";case"out":return"<span>销售出库</span>";
case"check_in":return"<span>盘盈</span>";case"check_out":return"<span>盘亏</span>";case"reject_in":return"<span>拒收入库</span>";case"allocate_out":return"<span>调拨出库</span>";
case"allocate_in":return"<span>调拨入库</span>";case"manual_out":return"<span>人工出库</span>";}}},{name:"total",index:"total_",width:120,sortable:false,formatter:function(d,e,g){var f=0;
if(g.type=="check_out"||g.type=="out"||g.type=="allocate_out"||g.type=="manual_out"){f=d-g.qty;}else{if(g.type=="in"||g.type=="check_in"||g.type=="reject_in"||g.type=="allocate_in"){f=d+g.qty;
}}f=f<0?0:f;return f;}},{name:"qty",index:"qty_",width:120,sortable:false},{name:"createTime",index:"create_time_",width:120,sortable:true,formatter:function(d){return DateUtils.miniTime(d);
}},],loadComplete:function(){a._resizeJqgridWidth();}});},_loadBillList:function(c,a){var b=StStockLog._CONS_.BILL_DATA_URL+"?Q__S__EQ__bill.id_="+c+"&rows=-1";
FormUtils.loadData(b,function(f){if(f){var g=new StringBuffer();g.append("<tr class='active'><th>sku编码</th><th>产品名称</th><th>"+a+"数量</th><th>价格</th><th>仓库</th><th>关联订单号</th><th>时间</th></tr>");
var e=f.rows;for(var d=0;d<e.length;d++){g.append("<tr id="+e[d].id+">").append("<td>").append(e[d].skuCode).append("</td>").append("<td>").append(e[d].prodName).append("</td>").append("<td>").append(e[d].qty).append("</td>").append("<td>").append(e[d].price).append("</td>").append("<td>").append(e[d].storeName).append("</td>").append("<td>").append(e[d].soNos).append("</td>").append("<td>").append(DateUtils.miniTime(e[d].createTime)).append("</td>").append("</tr>");
}$("#billBuyTab").empty().append(g.toString());}});}};