$(function(){var a=new StStockOut();a.init();});function StStockOut(){this.hadInit=false;this.seniorSearch=new SeniorSearch();}StStockOut._CONS_={LIST_DATA_URL:ctx+"/ec/stock/stStock/out/listData.htm",EXPORT_URL:ctx+"/ec/stock/stStock/out/export.htm",GRID:"#stStockOutGrid",PAGER:"#stStockOutPager",};
StStockOut.prototype={init:function(b){if(!this.hadInit){this.hadInit=true;this._hideNotGrantBtn();this._bindEventHander();StoreUtils.loadStores("","storeIdSearch");
this.seniorSearch.init();var a=new Date();$("#endTimeSearch").val(DateUtils.format(a,"yyyy-MM-dd"));$("#startTimeSearch").val(DateUtils.format(a,"yyyy-MM-dd"));
this._initJqgrid({"Q__D__BW__slog.create_time_":$("#startTimeSearch").val()+","+$("#endTimeSearch").val()});this._locateToGlHelp();}},_locateToGlHelp:function(){var a="glHelp.stock.stockOut";
glHelpUtil.init(a);},_hideNotGrantBtn:function(){if(!ResUtils.canShow("stStockOut.button.export")){$(".stStockExport").hide();}},_bindEventHander:function(){var a=this;
$(".stStockOutSearch").on("click",function(){var b=$(this).closest("form").serialize();a.reloadJqgrid(b);});$("#stStockOutSearchForm").on("keypress",function(b){if(b.keyCode=="13"){$(".stStockOutSearch").trigger("click");
}});$(".stStockExport").on("click",function(){var c=$("#stStockOutSearchForm").serialize();var b=$(StStockOut._CONS_.GRID).jqGrid("getGridParam","selarrrow");
c+="&Q__S__IN__slog.id_="+b+"&Q__S__LLK__slog.type_=out";FormUtils.submit(StStockOut._CONS_.EXPORT_URL,c,function(d){DialogUtils.success(msgCode.SUCCESS,"正在导出...");
},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);},true);});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(StStockOut._CONS_.GRID,a);
},_initJqgrid:function(a){if(a==null||typeof a==undefined){a={};}$(StStockOut._CONS_.GRID).JTJqgrid({url:StStockOut._CONS_.LIST_DATA_URL+"?Q__S__LLK__slog.type_=out",pager:StStockOut._CONS_.PAGER,postData:a,colNames:["产品名称","sku编码","仓库","类型","数量","剩余数量","时间"],colModel:[{name:"prodName",index:"prod.name_",width:120},{name:"skuCode",index:"sku.code_",width:100},{name:"storeName",index:"store.name_",width:100},{name:"type",index:"slog.type_",width:80,formatter:function(b){if("out"==b){return"销售出库";
}else{if("check_out"==b){return"盘亏";}else{if("allocate_out"==b){return"调库出库";}else{if("manual_out"==b){return"人工出库";}else{return b;}}}}}},{name:"qty",index:"slog.qty_",width:80,},{name:"total",index:"slog.total_",width:80,formatter:function(b,c,e){var d=b-e.qty;
d=d<0?0:d;return d;}},{name:"createTime",index:"stlog.create_time_",width:100,formatter:function(b){return DateUtils.miniTime(b);}}],});}};