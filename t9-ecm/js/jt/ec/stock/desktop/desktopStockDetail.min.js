$(function(){function a(){this.hadInit=false;this.isEdit=false;this.intervalId=null;this.timeOutId=null;}a._CONS_={INDEX_URL:ctx+"/ec/stock/stStock/getDetailStock.htm",CHART_DIV:"stockTrend",};
a.prototype={init:function(e){var d=this;if(!d.hadInit){d.hadInit=true;d._bindEventHander();StoreUtils.loadStores("","storeIdDetailContainer");var c={Q__S__EQ__sku_id_:"1",Q__S__EQ__store_id_:"1",week:0};
d._getData(c);}},createReport:function(e){var d=this;var c=new Report();c.data=e.detilCountVo;c.setLegend(true,["出库","入库"],null);c.legend.formatter=function(f){if(f=="出库"){return f+"("+e.totalOutCount+"/"+e.unit+")";
}else{if(f=="入库"){return f+"("+e.totalInCount+"/"+e.unit+")";}}};c.setToolboxShow(false,false);c.tooltip.trigger="axis";c.tooltip.formatter=function(k,j,m){var h=k[0].name;
for(var g=0,f=k.length;g<f;g++){h+="<br/>"+k[g].seriesName+" : "+k[g].value;}return h;};c.initSeries([{type:"line",colName:"outCount",legendName:"出库"},{type:"line",colName:"inCount",legendName:"入库"}],"weekStr");
c.setXAxisInfo("日期",{show:true,onZero:true,lineStyle:{color:"#C1C1C1",width:2,type:"solid"}});c.setYAxisInfo("数量",{show:true,onZero:true,lineStyle:{color:"#C1C1C1",width:2,type:"solid"}});
c._initChart(a._CONS_.CHART_DIV);},_bindEventHander:function(){var c=this;$(".stockTrendSearchFrom").on("focus","#searchDetailProd",function(){var d=$(".stockTrendSearchFrom select[name=storeId]").val();
if(d==null||d==""){DialogUtils.error(msgCode.WARING,"请先选择仓库");}});$(".stockTrendSearchFrom").on("change","select[name=storeId]",function(){c._prodSearch($(".stockTrendSearchFrom select[name=storeId]").val());
$("#searchDetailProd").val("");$("#prodSkuId").val("");return true;});$(".stockTrendSearchFrom").on("click",".searchBtn",function(){var f=$("#prodSkuId").val();
var e=$(".stockTrendSearchFrom select[name=storeId]").val();var g=$("#week").val();var h=$("#week").find("option:selected").text();if(e==null||e==""){DialogUtils.error(msgCode.WARING,"请先选择仓库");
}else{if(f==null||f==""){DialogUtils.error(msgCode.WARING,"请选择产品");}else{var d={Q__S__EQ__sku_id_:f,Q__S__EQ__store_id_:e,week:g};$(".titleName").empty().append($(".stockTrendSearchFrom select[name=storeId]").find("option:selected").text()+" ["+$("#prodName").val()+"] "+h+" 库存变化趋势");
c._getData(d);}}});},_getData:function(c){var d=this;$.ajax({type:"GET",url:a._CONS_.INDEX_URL,data:c,contentType:"application/json",dataType:"json",success:function(e){d.createReport(e);
},error:function(e){DialogUtils.error("错误",e);}});},_prodSearch:function(c){var d=this;$("#searchDetailProd").bsSuggest("destroy");if(c==null||c==""){return;
}var f=$("#searchDetailProd").width()+"px";if($("#searchDetailProd").width()<=500){f=($(".itemDiv").width()*5/6)+"px";}var e="entity";$("#searchDetailProd").bsSuggest({url:ctx+"/ec/product/prodEntity/searchAll.htm?prodType="+e+"&hasStock=n"+"&storeId="+c+"&limitProdCate=n"+"&keyword=",effectiveFields:["prodName","skuCode"],searchFields:["prodName","skuCode"],effectiveFieldsAlias:{prodName:"商品名字",skuCode:"sku编码"},showBtn:false,idField:"skuId",keyField:"skuCode",autoSelect:false,getDataMethod:"url",listStyle:{"padding-top":0,"max-height":"200px","max-width":f,"overflow":"auto","width":"auto","transition":"0.3s","-webkit-transition":"0.3s","-moz-transition":"0.3s","-o-transition":"0.3s"}}).on("onDataRequestSuccess",function(h,g){d.searchProds=g.value;
}).on("onSetSelectValue",function(j,g){for(var h=0;h<d.searchProds.length;h++){if(d.searchProds[h].skuId==g.id){d.currentProd=d.searchProds[h];break;}}d._setProdValue(d.currentProd);
$(".titleName").empty().append($(".stockTrendSearchFrom select[name=storeId]").find("option:selected").text()+" ["+$("#prodName").val()+"]库存变化趋势");$(this).val("");
});},_setProdValue:function(c){$("#prodSkuId").val(c.skuId);$("#prodName").val(c.prodName);}};var b=new a();b.init();});