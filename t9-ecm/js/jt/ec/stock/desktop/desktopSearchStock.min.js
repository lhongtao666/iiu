$(function(){function a(){this.hadInit=false;this._bindEventHander();}a._CONS_={GET_PROD:ctx+"/ec/stock/stStock/getStock.htm",};a.prototype={init:function(c){if(!this.hadInit){this.hadInit=true;
StoreUtils.loadStores("","storeIdContainer");}},_bindEventHander:function(){var c=this;$("#selectSkuBtn").on("click",function(){if($(".desktopSearchStock select[name=storeId]").val()==""||$(".desktopSearchStock select[name=storeId]").val()==null){DialogUtils.error(msgCode.WARING,"请先选择仓库");
return false;}var d="product";c.hadClose=false;SelectProdService.selectSku({storeId:$(".desktopSearchStock select[name=storeId]").val(),isMultiple:1,type:d,canSale:"y",hasStock:$("#hasStock").is(":checked")?"y":"n",fn:function(e){c._setProdValue(e);
}});});$(".desktopSearchStock").on("focus","#searchProd",function(){var d=$(".desktopSearchStock select[name=storeId]").val();if(d==null||d==""){DialogUtils.error(msgCode.WARING,"请先选择仓库");
}});$(".desktopSearchStock").on("change","select[name=storeId]",function(){c._prodSearch($(".desktopSearchStock select[name=storeId]").val());$("#searchProd").val("");
c._clearData();return true;});},_prodSearch:function(c){var d=this;$("#searchProd").bsSuggest("destroy");if(c==null||c==""){return;}var f=$("#searchProd").width()+"px";
if($("#searchProd").width()<=500){f=($(".itemDiv").width()*5/6)+"px";}var e="entity";$("#searchProd").bsSuggest({url:ctx+"/ec/product/prodEntity/searchAll.htm?prodType="+e+"&hasStock=n"+"&storeId="+c+"&limitProdCate=n"+"&keyword=",effectiveFields:["prodName","skuCode"],searchFields:["prodName","skuCode"],effectiveFieldsAlias:{prodName:"商品名字",skuCode:"sku编码"},showBtn:false,idField:"skuId",keyField:"skuCode",autoSelect:false,getDataMethod:"url",listStyle:{"padding-top":0,"max-height":"200px","max-width":f,"overflow":"auto","width":"auto","transition":"0.3s","-webkit-transition":"0.3s","-moz-transition":"0.3s","-o-transition":"0.3s"}}).on("onDataRequestSuccess",function(h,g){d.searchProds=g.value;
}).on("onSetSelectValue",function(j,g){for(var h=0;h<d.searchProds.length;h++){if(d.searchProds[h].skuId==g.id){d.currentProd=d.searchProds[h];break;}}d._setProdValue(d.currentProd);
$(this).val("");});},_setProdValue:function(d){var c=$("select[name=storeId]").val();FormUtils.loadData(a._CONS_.GET_PROD+"?skuId="+d.skuId+"&storeId="+c,function(e){if(e){$(".prod-name").empty().append(d.prodName);
$(".prod-total").empty().append(e.total);$(".sku-code").empty().append(d.skuCode);$(".prod-canSale").empty().append(e.total-e.lockQty-e.badQty-e.savedQty);
$(".lock-qty").empty().append(e.lockQty);$(".bad-qty").empty().append(e.badQty);$(".save-qty").empty().append(e.savedQty);$(".caculate-day").empty().append(e.salesDays);
$(".suport-day").empty().append(e.salesSupport);$(".avg-value").empty().append(e.salesAvg);}});},_clearData:function(){$(".prod-name").empty();$(".prod-total").empty();
$(".prod-code").empty();$(".sku-code").empty();$(".prod-canSale").empty();$(".lock-qty").empty();$(".bad-qty").empty();$(".save-qty").empty();$(".caculate-day").empty();
$(".suport-day").empty();$(".avg-value").empty();}};var b=new a();b.init();});