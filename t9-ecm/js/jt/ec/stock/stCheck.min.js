$(function(){var a=new StCheck();a.init();});function StCheck(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.canSubmit=true;this.isManyStore=isManyStore?isManyStore:"y";
}StCheck._CONS_={EDIT_URL:ctx+"/ec/stock/stCheck/edit.htm",DETAIL_URL:ctx+"/ec/stock/stCheck/detail.htm",DELETE_URL:ctx+"/ec/stock/stCheck/delete.htm",SAVE_ADD_URL:ctx+"/ec/stock/stCheck/saveAdd.htm",SAVE_EDIT_URL:ctx+"/ec/stock/stCheck/saveEdit.htm",LIST_DATA_URL:ctx+"/ec/stock/stCheck/listData.htm",CONFIRM_URL:ctx+"/ec/stock/stCheck/confirm.htm",BACK_CONFIRM_URL:ctx+"/ec/stock/stCheck/backConfirm.htm",TO_CONFIRM_URL:ctx+"/ec/stock/stCheck/toConfirm.htm",IVALIDE_URL:ctx+"/ec/stock/stCheck/invalid.htm",DONE_URL:ctx+"/ec/stock/stCheck/done.htm",EXPORT_URL:ctx+"/ec/stock/stCheck/exportCheck.htm",EDIT_FORM_ID:"stCheckForm",GRID:"#stCheckGrid",PAGER:"#stCheckPager"};
StCheck.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindFormValidation();this._bindEventHander();this._initJqgrid(a);this._hideNotGrantBtn();
this.onSelectRow();StoreUtils.loadStores("","storeIdSearchContainer");}},_hideNotGrantBtn:function(){if(!ResUtils.canShow("stCheck.button.detail")){$(".stCheckDetail").hide();
}if(!ResUtils.canShow("stCheck.button.edit")){$(".stCheckEdit").hide();}if(!ResUtils.canShow("stCheck.button.add")){$(".stCheckAdd1").hide();$(".stCheckAdd2").hide();
}if(!ResUtils.canShow("stCheck.button.delete")){$(".stCheckDel").hide();}if(!ResUtils.canShow("stCheck.button.done")){$(".stCheckDone").hide();}if(!ResUtils.canShow("stCheck.button.export")){$(".stCheckExport").hide();
}},_createStFormAndTable:function(){this.formId="_"+new Date().getTime();var a=new StringBuffer();a.append("<form id='"+this.formId+"'>");a.append("<table class='table table-striped table-bordered'>");
a.append("<thead>");a.append("<tr>");a.append("<th width='5%' style='display:none' class='checkresult'>结果</th>");a.append("<th width='12%'>名称</th>");a.append("<th width='8%'>sku</th>");
a.append("<th width='5%'>单位</th>");a.append("<th width='8%'>预期数量(良品)</th>");a.append("<th width='8%'>预期数量(不良品)</th>");a.append("<th width='8%' class='canHide'>实盘数量（好）<span style='color: red;'>*</span></th>");
a.append("<th width='8%' class='canHide'>损坏数量（坏）<span style='color: red;'>*</span></th>");a.append("<th width='5%'>删除</th>");a.append("</tr>");a.append("</thead>");
a.append("<tbody id='productContainer'>");a.append("</tbody>");a.append("</table>");a.append("</form>");$("#stCheckContainer").empty().append(a.toString());
},clear:function(c){var a=this;function b(){a._showListWrapper();a.isFormDataChange=false;a.isEdit=false;$(".saveBtn").show();$(".toConfirmBtn").show();
$(".confirmBtn").show();$(".backConfirmBtn").show();$(".doneBtn").show();$("#storeIdContainer").removeAttr("disabled");ButtonUtils.enableBtn("selectProdBtn");
$(".confirmTimeContainer").hide();$("input[name='operName']").val("");$(".onlyShowDetail").show();FormUtils.clear(a.formId);FormUtils.clear(StCheck._CONS_.EDIT_FORM_ID);
FormUtils.enableForm(StCheck._CONS_.EDIT_FORM_ID);$("#productContainer").empty();if(c){$(".stCheckSearch").trigger("click");}a.onSelectRow();}if(a.isEdit&&a.isFormDataChange){DialogUtils.warning(function(){b();
});}else{b();}},_showListWrapper:function(){$(".list_wrapper").show();$(".form_wrapper").hide();},_showFormWrapper:function(){$(".list_wrapper").hide();
$(".form_wrapper").show();},_add:function(){this._createStFormAndTable();this._showFormWrapper();StoreUtils.loadStores("","storeIdContainer");$("input[name='operName']").val(currentUserName);
$(".toConfirmBtn").hide();$(".confirmBtn").hide();$(".backConfirmBtn").hide();$(".onlyShowDetail").hide();$(".doneBtn").hide();},_edit:function(c,a){this._createStFormAndTable();
this._showFormWrapper();this.edit=true;var b=false;if(a=="edit"){$(".confirmBtn").hide();$(".toConfirmBtn").hide();$(".backConfirmBtn").hide();$(".doneBtn").hide();
}else{if(a=="awaiting_confirm"){b=true;$(".confirmBtn").hide();$(".saveBtn").hide();$(".backConfirmBtn").hide();$(".doneBtn").hide();}else{if(a=="confirm"){$(".saveBtn").hide();
$(".toConfirmBtn").hide();$(".doneBtn").hide();b=true;}else{if(a=="done"){$(".saveBtn").hide();$(".toConfirmBtn").hide();$(".backConfirmBtn").hide();$(".confirmBtn").hide();
}}}}this._loadData(c,b);},_detail:function(a){this._createStFormAndTable();this._showFormWrapper();this._loadData(a,true);$(".saveBtn").hide();$(".toConfirmBtn").hide();
$(".backConfirmBtn").hide();$(".confirmBtn").hide();$(".doneBtn").hide();},_createStCheckItem:function(h,d){if(h&&h.length){var l=new StringBuffer();var o={rules:{}};
var g=$("#productContainer tr");for(var e=0;e<h.length;e++){var n=false;if(g&&g.length>0){for(var c=0;c<g.length;c++){if($(g[c]).attr("skuIdVal")==h[e].skuId){n=true;
break;}}}if(n){continue;}var f="_"+Math.random()*9+"_read_count";var a="_"+Math.random()*9+"_bad_count";var m=h[e].unit?h[e].unit:"";o.rules[f]={required:true,digits:true};
o.rules[a]={required:true,digits:true};l.append("<tr skuIdVal='"+h[e].skuId+"'>");if(d=="done"){var k="";if(parseInt(h[e].totalQty)==parseInt(h[e].checkQty)){k="<i title='正常' class='glyphicon glyphicon-ok' style='color:#1ab394;padding-left:10px;'></i>";
}else{if(parseInt(h[e].totalQty)>parseInt(h[e].checkQty)){k="<i title='盘亏' class='glyphicon glyphicon-arrow-down' style='color:#ef6776;padding-left:10px;'></i>";
}else{k="<i title='盘盈' class='glyphicon glyphicon-arrow-up' style='color:#23c6c8;5px;padding-left:10px;'></i>";}}l.append("<td> "+k+"</td>");}else{l.append("<td style='display:none;'><i></i></td>");
}var b=h[e].badQty;if(d){b=h[e].totalBadQty;}l.append("<td title='"+h[e].prodName+"'>"+(h[e].prodName.length<=12?h[e].prodName:(h[e].prodName.substring(0,10)+"..."))+"</td>").append("<td>"+h[e].skuCode+"</td>").append("<td>"+m+"</td>");
l.append("<td>"+(h[e].wholeQty?h[e].wholeQty:h[e].totalQty)+"</td>");l.append("<td>"+b+"</td>");l.append("<td><input type='number' required name='"+f+"' class='form-control' validateType='default' value='"+parseInt(h[e].checkQty?h[e].checkQty:0)+"'></td>").append("<td><input type='number' required name='"+a+"' class='form-control' validateType='default' value='"+parseInt(h[e].badQty?h[e].badQty:0)+"'></td>");
l.append("<td ><button class='btn btn-outline btn-sm btn-danger checkItemDelBtn  ' type='button'>删除</button></td>");l.append("</tr>");}$("#productContainer").append(l.toString());
FormUtils.bindFormValidation(this.formId,o);}},_loadData:function(d,b){var a=this;var c=b?StCheck._CONS_.DETAIL_URL:StCheck._CONS_.EDIT_URL;FormUtils.loadData(c+"?id="+d,function(e){$("input[name=id]").val(e.id);
$("input[name=name]").val(e.name);$("input[name=storeId]").val(e.storeId);$("input[name=operId]").val(e.operId);$("input[name=operName]").val(e.operName);
$("textarea[name=comment]").val(e.comment);$("input[name=status]").val(e.status);$("input[name=prodType]").val(e.prodType);$("input[name=planTime]").val(e.planTime.substring(0,10));
$("input[name=checkTime]").val(e.checkTime);$("input[name=code]").val(e.code);$("input[name=createBy]").val(e.createBy);$("input[name=createTime]").val(e.createTime);
$("input[name=updateBy]").val(e.updateBy);$("input[name=updateTime]").val(e.updateTime);StoreUtils.loadStores(e.storeId,"storeIdContainer");if(e.status=="done"){$(".checkresult").show();
}else{$(".checkresult").hide();}a._createStCheckItem(e.checkItemVoList,e.status);if(e.status=="done"||b){$(".checkItemDelBtn").attr("disabled","disabled");
ButtonUtils.disableBtn("selectProdBtn");FormUtils.disableForm(StCheck._CONS_.EDIT_FORM_ID);$("#productContainer").find(":input").attr("disabled","disabled");
}if(e.status=="done"){$(".confirmTimeContainer").show();}});},_save:function(){var d=this;var f=$("#id").val();var b=null;if(f!=null&&f!=""){b=StCheck._CONS_.SAVE_EDIT_URL;
}else{b=StCheck._CONS_.SAVE_ADD_URL;}$("#storeIdContainer").removeAttr("disabled","disabled");if($("#stCheckForm").valid()){ButtonUtils.disableBtn("saveBtn");
var e=$("#"+StCheck._CONS_.EDIT_FORM_ID).serialize();var a=[];var c=false;$("#productContainer").find("tr").each(function(){var g={};g.skuId=$(this).attr("skuIdVal");
g.checkQty=$(this).find("td:eq(6) input").val();g.badQty=$(this).find("td:eq(7) input").val();g.comment=$(this).find("td:eq(10) input").val();a.push(g);
});if(c){ButtonUtils.enableBtn("saveBtn");return;}e+="&checkItemJson="+JSON.stringify(a);FormUtils.submit(b,e,function(g){ButtonUtils.enableBtn("saveBtn");
if(g.success){if(g.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);}else{if(g.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
}}d.isEdit=false;d.clear(true);}else{DialogUtils.error(msgCode.FAIL_MSG,g.msg);}},function(){ButtonUtils.enableBtn("saveBtn");DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}},_saveStock:function(e){var d=this;var f=$("#id").val();var b=StCheck._CONS_.DONE_URL;if($("#stCheckForm").valid()&&$("#"+d.formId).valid()){ButtonUtils.disableBtn("doneBtn");
var a=[];var c=false;$("#productContainer").find("tr").each(function(){var g={};g.skuId=$(this).attr("skuIdVal");g.checkQty=$(this).find("td:eq(6) input").val();
g.badQty=$(this).find("td:eq(7) input").val();a.push(g);});if(c){ButtonUtils.enableBtn("doneBtn");return;}FormUtils.submit(b,{id:f,checkItemJson:JSON.stringify(a)},function(g){ButtonUtils.enableBtn("doneBtn");
if(g.success){if(g.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);}else{if(g.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
}}d.isEdit=false;d.clear(true);}else{DialogUtils.error(msgCode.FAIL_MSG,g.msg);}},function(){ButtonUtils.enableBtn("doneBtn");DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}},_delete:function(b){var a=this;DialogUtils.confirm(function(){FormUtils.del(StCheck._CONS_.DELETE_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,msgCode.DELETE_MSG);
$(".stCheckSearch").trigger("click");a.onSelectRow();}else{DialogUtils.error(msgCode.ERROR,c.msg);}});});},_saveNoItem:function(a,c){if(this.canSubmit){var b=this;
b.canSubmit=false;var d="";if(c==null||c==""){d=$("#stCheckForm input[name=id]").val();}else{d=c;}if(d==null||d==""){DialogUtils.error(msgCode.FAIL_MSG,"id为空！");
b.canSubmit=true;return;}FormUtils.submit(a,{id:d},function(e){b.canSubmit=true;if(e.success){DialogUtils.success(msgCode.INFO,e.msg);b.isEdit=false;b.clear(true);
}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);b.canSubmit=true;});}},_toConfirm:function(){var a=StCheck._CONS_.TO_CONFIRM_URL;
this._saveNoItem(a);},_confirm:function(){var a=StCheck._CONS_.CONFIRM_URL;this._saveNoItem(a);},_backConfirm:function(b){var a=StCheck._CONS_.BACK_CONFIRM_URL;
this._saveNoItem(a);},_invalid:function(b){var a=StCheck._CONS_.IVALIDE_URL;this._saveNoItem(a,b);},_done:function(){this._saveStock();},_bindEventHander:function(){var a=this;
$(document).on("click",".checkItemDelBtn",function(){$(this).parents("tr").remove();});$("#selectProdBtn").on("click",function(){var b=$("#storeIdContainer").val();
if(!b){DialogUtils.error(msgCode.ERROR,"请选择仓库");return;}SelectProdService.selectSku({storeId:$("#storeIdContainer").val(),isMultiple:1,canSale:"y",type:a.prodType,fn:function(c){a._createStCheckItem(c);
$("#storeIdContainer").attr("disabled","disabled");}});});$(document).on("click",".prevBtn",function(){a.clear(false);});$(document).on("click",".saveBtn",function(){if(!$("#productContainer").find("tr").length){DialogUtils.error(msgCode.ERROR,"请选择商品");
return;}a._save();});$(document).on("click",".toConfirmBtn",function(){DialogUtils.confirmWithOptions({title:"确定提交审核吗？",text:"",confirmButtonText:"确定",yesFunc:function(){a._toConfirm();
}});});$(document).on("click",".confirmBtn",function(){DialogUtils.confirmWithOptions({title:"确定审核通过吗？",text:"",confirmButtonText:"确定",yesFunc:function(){a._confirm();
}});});$(document).on("click",".backConfirmBtn",function(){DialogUtils.confirmWithOptions({title:"确定驳回审核吗？",text:"",confirmButtonText:"驳回",yesFunc:function(){a._backConfirm();
}});});$(document).on("click",".doneBtn",function(){DialogUtils.confirmWithOptions({title:"确定完成盘点吗？",text:"",confirmButtonText:"完成",yesFunc:function(){a._done();
}});});$(document).on("mouseover","td[aria-describedby='stCheckGrid_name']",function(){var b=$(this);var c=b.find(".name_value").attr("title");b.attr("title",c);
});$("#"+StCheck._CONS_.EDIT_FORM_ID).on("change","input",function(){if(a.isEdit){a.isFormDataChange=true;}});$("#"+StCheck._CONS_.EDIT_FORM_ID).on("change","select",function(){if(a.isEdit){a.isFormDataChange=true;
}});$("#"+StCheck._CONS_.EDIT_FORM_ID).on("change","textarea",function(){if(a.isEdit){a.isFormDataChange=true;}});$(".list_wrapper").on("click",".stCheckSearch",function(){var b=$(this).closest("form").serialize();
a.reloadJqgrid(b);});$("#stCheckSearchForm").on("keypress",function(b){if(b.keyCode=="13"){$(".stCheckSearch").trigger("click");}});$("body").on("click",".stCheckAdd1",function(){a.prodType="product";
$("input[name='prodType']").val(a.prodType);a._add();});$("body").on("click",".stCheckAdd2",function(){a.prodType="point";$("input[name='prodType']").val(a.prodType);
a._add();});$("body").on("click",".stCheckEdit",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(StCheck._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);
return;}}}a._edit(b,"edit");});$("body").on("click",".stCheckToConfirm",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(StCheck._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);
return;}}}a._edit(b,"awaiting_confirm");});$("body").on("click",".stCheckConfirm",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(StCheck._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,"不能同时选择多条数据");
return;}}}a._edit(b,"confirm");});$("body").on("click",".stCheckExport",function(){var c=$(this).attr("idVal");if(!c){c=$(StCheck._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(c==null||c.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);return;}else{if(c&&c.length>1){DialogUtils.error(msgCode.ERROR,"不能同时选择多条数据");
return;}}}var d=$("#"+c).find("td:eq(2)").attr("title");var b=StCheck._CONS_.EXPORT_URL;FormUtils.submit(b,"id="+c,function(e){if(e.success){DialogUtils.success(msgCode.INFO,"成功");
JTTabUtils.addOrRefreshTab(ctx+e.msg+"?pw=42385A79697676502F512F33454F58333337794472513D3D","盘点单["+d+"]信息");}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});$("body").on("click",".stCheckDone",function(){a.isEdit=true;var b=$(this).attr("idVal");
if(!b){b=$(StCheck._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);
return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,"不能同时选择多条数据");return;}}}a._edit(b,"done");});$("body").on("click",".stCheckInvalid",function(){a.isEdit=true;
var b=$(this).attr("idVal");if(!b){b=$(StCheck._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.error,"请选择记录");
return;}}DialogUtils.confirmWithOptions({title:"确定作废所选记录吗？",text:"作废后不可更改！",confirmButtonText:"作废",yesFunc:function(){a._invalid(b);}});});$("body").on("click",".stCheckDel",function(){var b=$(this).attr("idVal");
if(!b){b=$(StCheck._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_DELETE);
return;}}a._delete(b);});$("body").on("click",".stCheckDetail",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(StCheck._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_DETAIL);return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.error,msgCode.ERROR_DETAIL_MUL_RECORD);
return;}}}a._detail(b);});$(document).on("click",".showDetail",function(){var b=$(this).parents("tr").attr("id");a._detail(b);});$("body").on("click",".resetBtn",function(){var b=$(this).parents("form").attr("id");
FormUtils.clear("#"+b);});},_bindFormValidation:function(){var a={rules:{name:{required:true},storeId:{required:true},planTime:{required:true}},messages:{}};
FormUtils.bindFormValidation(StCheck._CONS_.EDIT_FORM_ID,a);},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(StCheck._CONS_.GRID,a);},_getManagerBtns:function(){var a=[];
if(ResUtils.canShow("stCheck.button.edit")){a.push({switchCol:{colName:"status",colVals:["draft",],colLables:[["编辑"]],btnClasses:[["btn btn-primary stCheckEdit"]],iconClasses:[["fa fa-edit"]]}});
}if(ResUtils.canShow("stCheck.button.done")){a.push({switchCol:{colName:"status",colVals:["draft"],colLables:[["完成"]],btnClasses:[["btn btn-primary stCheckDone"]],iconClasses:[["fa fa-edit"]]}});
}if(ResUtils.canShow("stCheck.button.detail")){a.push({lable:msgCode.DETAIL_BTN_TEXT,btnClasses:"btn btn-primary stCheckDetail",iconClasses:"fa fa-list"});
}if(ResUtils.canShow("stCheck.button.delete")){a.push({switchCol:{colName:"status",colVals:["draft","awaiting_confirm","invalid","confirm"],colLables:[["删除"],["删除"],["删除"],["删除"]],btnClasses:[["btn btn-danger stCheckDel"],["btn btn-danger stCheckDel"],["btn btn-danger stCheckDel"],["btn btn-danger stCheckDel"]],iconClasses:[["fa fa-remove"],["fa fa-remove"],["fa fa-remove"],["fa fa-remove"]]}});
}if(ResUtils.canShow("stCheck.button.export")){a.push({lable:"导出单据",btnClasses:"btn btn-primary stCheckExport",iconClasses:"fa fa-list"});}return a;},onSelectRow:function(e,a){var b=$(StCheck._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){$(".stCheckDone").attr("disabled",true);$(".stCheckDel").attr("disabled",true);$(".stCheckEdit").attr("disabled",true);$(".stCheckDetail").attr("disabled",true);
$(".stCheckExport").attr("disabled",true);}else{if(b.length==1){var f=$(StCheck._CONS_.GRID).jqGrid("getRowData",b);if(f.status=="draft"){$(".stCheckDel").attr("disabled",false);
$(".stCheckDone").attr("disabled",false);$(".stCheckEdit").attr("disabled",false);}else{if(f.status=="done"){$(".stCheckExport").attr("disabled",false);
}}$(".stCheckDetail").attr("disabled",false);}else{$(".stCheckDetail").attr("disabled",true);$(".stCheckEdit").attr("disabled",true);$(".stCheckDone").attr("disabled",true);
$(".stCheckExport").attr("disabled",true);var a=$(StCheck._CONS_.GRID).jqGrid("getRowData",b[0]).status;for(var d=1;d<b.length;d++){var c=$(StCheck._CONS_.GRID).jqGrid("getRowData",b[d]).status;
if(a!=c){$(".stCheckDel").attr("disabled",true);return;}}if(a=="draft"){$(".stCheckDel").attr("disabled",false);}}}},_initJqgrid:function(d){var a=this;
if(d==null||typeof d==undefined){d={};}var c=new Date();c.setMonth(c.getMonth()-1);c=c.currentDate()+" 00:00:00";$("#startTimeSearch").val(c);d.Q__D__BW__create_time_=c;
var b=false;if("n"==a.isManyStore){b=true;}$(StCheck._CONS_.GRID).JTJqgrid({url:StCheck._CONS_.LIST_DATA_URL,pager:StCheck._CONS_.PAGER,postData:d,colNames:["单据","名称","仓库","经手人","状态","状态","产品类型","计划日期","盘点时间","创建时间","操作"],colModel:[{name:"code",index:"code_",width:150,formatter:function(f,g,h){var e=h.result;
if(e=="common"){return"<i title='正常' class='glyphicon glyphicon-ok' style='color:#1ab394;'></i><a href='#' class='showDetail'>"+f+"</a>";}else{if(e=="both"){return"<i title='既有盘亏又有盘盈' class='fa fa-long-arrow-down' style='color:#ef6776;'></i><i title='既有盘亏又有盘盈' class='fa fa-long-arrow-up' style='color:#23c6c8;padding-right:1px;'></i><a href='#' class='showDetail'>"+f+"</a>";
}else{if(e=="increase"){return"<i title='盘盈' class='glyphicon glyphicon-arrow-up' style='color:#23c6c8;'></i><a href='#' class='showDetail'>"+f+"</a>";
}else{if(e=="decrease"){return"<i title='盘亏' class='glyphicon glyphicon-arrow-down' style='color:#ef6776;'></i><a href='#' class='showDetail'>"+f+"</a>";
}else{return"<i style=''></i><a href='#' class='showDetail'>&nbsp;&nbsp;&nbsp;&nbsp;"+f+"</a>";}}}}}},{name:"name",index:"name_",width:120,formatter:function(e){var f='<lable class ="name_value" title="'+e+'">';
if(e&&e.length>9){return f+e.substring(0,7)+"..."+"</lable>";}else{return e;}}},{name:"storeName",index:"store_id_",width:120,hidden:b},{name:"operName",index:"oper_id_",width:80,sortable:false},{name:"status",index:"status_",width:80,sortable:false,formatter:function(e){if(e=="awaiting_confirm"){return"待审核";
}else{if(e=="confirm"){return"<span class='text text text-info'>已审核</span>";}else{if(e=="draft"){return"草稿";}else{if(e=="done"){return"<span class='text text-success'>完成</span>";
}else{if(e=="invalid"){return"<span class='text text-danger'>作废</span>";}else{return"";}}}}}}},{name:"status",index:"status_",width:120,hidden:true},{name:"prodType",index:"prod_type_",width:80,formatter:function(e){if(e=="product"){return"普通产品";
}else{return"积分产品";}}},{name:"planTime",index:"plan_time_",width:100,formatter:function(e){return DateUtils.miniTime(e);}},{name:"checkTime",index:"check_time_",width:100,classes:"autoHideCol",formatter:function(e){return DateUtils.miniTime(e);
}},{name:"createTime",index:"create_time_",width:100,classes:"autoHideCol",formatter:function(e){return DateUtils.miniTime(e);}},{name:"__manage",width:60,classes:"rowOps",sortable:false,align:"center",formatter:"manage",formatoptions:this._getManagerBtns()}],onSelectRow:function(f,e){a.onSelectRow(f,e);
},});}};