function OrderPack(){this.isManyStore=isManyStore?isManyStore:"y";}OrderPack.prototype={init:function(b){var a=this;a._bindEventHander();if(a.isManyStore=="n"){$(".hiddenWhenOneStore").hide();
}},_bindEventHander:function(){var a=this;$(document).on("click",".packedBtn",function(){a._packing();});$(document).on("click",".prevBtn",function(){a._clear();
});$(document).on("click",".exportBtn",function(){var d=$("#packingBillForm input[name=id]").val();var c=$("#packingBillForm input[name=name]").val();var b=ctx+"/ec/salesorder/soEntity/exportPack.htm";
FormUtils.submit(b,"packId="+d,function(e){if(e.success){DialogUtils.success(msgCode.INFO,"成功");JTTabUtils.addOrRefreshTab(ctx+e.msg+"?pw=42385A79697676502F512F33454F58333337794472513D3D","备货单["+c+"]信息");
}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});},_clear:function(){this._showListWrapper();
ButtonUtils.enableBtn("packedBtn");$(".soEntitySearch").click();},_showListWrapper:function(){$(".deliver_wrapper").hide();$(".list_wrapper").show();$(".form_wrapper").hide();
$(".ship_wrapper").hide();$(".soDeliverToolBtn").hide();$(".soStockToolBtn").hide();$(".pack_wrapper").hide();$(".deliver_wrapper").hide();$("select[name='soShipPos[0].scCode']").attr("disabled",true);
$("input[name='soShipPos[0].scTrackingNo']").attr("disabled",true);},_packing:function(){var b=this;var c=$("#packedBillForm input[name='id']").val();var a=ctx+"/ec/stock/packingBill/packing.htm";
FormUtils.submit(a,{id:c},function(d){if(d.success){DialogUtils.success(msgCode.INFO,d.msg);ButtonUtils.disableBtn("packedBtn");}else{DialogUtils.error(msgCode.ERROR,"打包失败");
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},_showPack:function(){$(".pack_wrapper").hide();$(".packedform_wrapper").show();},loadData:function(c){$("#packedProductContainer").empty();
var b=this;var a=ctx+"/ec/stock/packingBill/packDataForOrder.htm";FormUtils.loadData(a+"?soId="+c,function(d){$("#packedBillForm input[name='id']").val(d.id);
$("#packedBillForm input[name='name']").val(d.name);$("#packedBillForm input[name='code']").val(d.code);$("#packedBillForm textarea[name='comment']").val(d.comment);
$("#packedBillForm input[name='operId']").val(d.operId);$("#packedBillForm input[name='operName']").val(d.operName);$("#packedBillForm input[name='operTime']").val(d.operTime);
$("#packedBillForm input[name='createBy']").val(d.createBy);$("#packedBillForm input[name='createTime']").val(d.createTime);$("#packedBillForm select[name='type'").val(d.type);
$("#packedBillForm input[name='soNos'").val(d.soNos);StoreUtils.loadStores(d.storeId,"packedStoreIdContainer");$("#packedStoreIdContainer").attr("disabled","disabled");
if(d.status!="awaiting_confirm"){ButtonUtils.disableBtn("packedBtn");}else{ButtonUtils.enableBtn("packedBtn");}if(d.stBillItemVoList){b._createBillItems(d.stBillItemVoList,"packedProductContainer");
}$("#packedProductContainer :input").attr("disabled","disabled");$("#packedBillForm :input").attr("disabled","disabled");});},loadPackData:function(c){$("#packingProductContainer").empty();
var b=this;var a=ctx+"/ec/stock/packingBill/detail.htm";FormUtils.loadData(a+"?id="+c,function(d){$("#packingBillForm input[name='id']").val(d.id);$("#packingBillForm input[name='name']").val(d.name);
$("#packingBillForm input[name='code']").val(d.code);$("#packingBillForm textarea[name='comment']").val(d.comment);$("#packingBillForm input[name='operId']").val(d.operId);
$("#packingBillForm input[name='operName']").val(d.operName);$("#packingBillForm input[name='operTime']").val(d.operTime);$("#packingBillForm input[name='companyId']").val(d.companyId);
$("#packingBillForm input[name='createBy']").val(d.createBy);$("#packingBillForm input[name='createTime']").val(d.createTime);$("#packingBillForm select[name='type'").val(d.type);
$("#packingBillForm input[name='soIds']").val(d.soIds);$("#packingBillForm input[name='status']").val(d.status);$("#packingBillForm input[name='soNos'").val(d.soNos);
StoreUtils.loadStores(d.storeId,"packingStoreIdContainer");$("#packingStoreIdContainer").attr("disabled","disabled");$(".operTimeContainer label").text("出库日期");
if(d.stBillItemVoList){b._createBillItems(d.stBillItemVoList,"packingProductContainer");}$("#packingProductContainer :input").attr("disabled","disabled");
});},_createBillItems:function(k,a){if(!k){return;}var h=$("#"+a+" tr");var l=new StringBuffer();for(var d=0;d<k.length;d++){var n=false;if(h&&h.length>0){for(var c=0;
c<h.length;c++){if($(h[c]).attr("skuIdVal")==k[d].skuId){n=true;break;}}}if(n){continue;}var o=1;var g=0;var e=k[d].position?k[d].position:"";var f=k[d].comment?k[d].comment:"";
var m=k[d].unit?k[d].unit:"";var b=k[d].totalQty?k[d].totalQty:"";if(k[d].qty){o=k[d].qty;}l.append("<tr prodIdVal='"+k[d].prodId+"' skuIdVal='"+k[d].skuId+"'>").append("<td  title='"+k[d].prodName+"'>"+(k[d].prodName.length<=15?k[d].prodName:(k[d].prodName.substring(0,13)+"..."))+"</td>").append("<td>"+k[d].skuCode+"</td>").append("<td>"+m+"</td>");
l.append("<td><input class='form-control prodQty' value='"+parseInt(o)+"' placeholder='数量'></td>");l.append("<td><input class='form-control' readonly='readonly' value='"+e+"' placeholder='所在仓位'></td>");
l.append("<td><input class='form-control' value='"+f+"' placeholder='备注信息'></td>").append("</tr>");}$("#"+a).append(l.toString());}};