loadBillData={loadData:function(d){var b=isManyStore?isManyStore:"y";if(b=="n"){$(".hiddenWhenOneStore").hide();}var a=this;var c=new StringBuffer();c.append(" <tr>"+"<th width='12%'>名称</th>"+"<th width='12%'>sku编号</th>"+"<th width='5%'>单位</th>").append("<th style='display:none'>总数量</th>").append("<th>入库数量</th>").append("<th>项目类型</th>").append("<th width='5%'>仓位</th><th width='18%'>备注</th><th width='6%'>操作</th></tr>");
$("#rejectProductHeaderContainer").empty().append(c.toString());FormUtils.loadData(ctx+"/ec/stock/rejectBill/getBillBySoId.htm?soId="+d,function(e){$("#rejectBillForm input[name='id']").val(e.id);
$("#rejectBillForm input[name='name']").val(e.name);$("#rejectBillForm input[name='code']").val(e.code);$("#rejectBillForm textarea[name='comment']").val(e.comment);
$("#rejectBillForm nput[name='operId']").val(e.operId);$("#rejectBillForm input[name='operTime']").val(e.operTime);$("#rejectBillForm input[name='createBy']").val(e.createBy);
$("#rejectBillForm input[name='createTime']").val(e.createTime);$("#rejectBillForm select[name='type']").val(e.type);$("#rejectBillForm select[name='status']").val(e.status);
$("#rejectBillForm input[name='soNos']").val(e.soNos);$("#rejectBillForm input[name='operName']").val(e.operName);StoreUtils.loadStores(e.storeId,"rejectStoreIdContainer");
if(e.stBillItemVoList){a.createBillItems(e.stBillItemVoList,false);}if(true){$("#rejectProductContainer").find(":input").attr("disabled","disabled");$("#rejectBillForm").find(":input").attr("disabled","disabled");
}});},createBillItems:function(e,j,b){if(!e){return;}var k=new StringBuffer();var h=new StringBuffer();var a=0;var c=0;var l=[];for(var d=0;d<e.length;
d++){var f=e[d].type?e[d].type:"";if(f=="bad"){l.push(e[d]);}}for(var d=0;d<e.length;d++){var f=e[d].type?e[d].type:"";if(f!="bad"){h.append(this._appendtable(e[d],l,j));
}}for(var d=0;d<l.length;d++){var g=[];h.append(this._appendtable(l[d],g,j));}if(b&&b!=""){$(b).empty().append(h.toString());}else{$("#rejectProductContainer").empty().append(h.toString());
}this._updateTotal();},_appendtable:function(m,n,h){var g=new StringBuffer();var k=0;var l=1;var d=m.position?m.position:"";var e=m.comment?m.comment:"";
var j=m.unit?m.unit:"";var a=m.totalQty?m.totalQty:"";if(m.qty){l=m.qty;}k+=parseInt(l);g.append("<tr prodIdVal='"+m.prodId+"' skuIdVal='"+m.skuId+"' soIdVal='"+m.soId+"'>").append("<td width='12%' title='"+m.prodName+"'>"+(m.prodName.length<=15?m.prodName:(m.prodName.substring(0,13)+"..."))+"</td>").append("<td width='12%'>"+m.skuCode+"</td>").append("<td width='5%'>"+j+"</td>").append("<td style='display:none'>"+parseInt(l)+"</td>").append("<td width='10%'><input class='form-control prodQty' readOnly='readOnly' value='"+parseInt(l)+"' placeholder='数量'>");
var f=-1;for(var c=0;c<n.length;c++){var b=n[c];if(m.prodId==b.prodId&&m.prodName==b.prodName&&m.skuCode==b.skuCode){g.append("<input class='form-control badQty'  value='"+parseInt(b.qty)+"' placeholder='不良品数量'>");
f=c;}}g.append("</td>").append("<td width='10%'><select class='form-control itemType' placeholder='项目类型'>");if(m.type=="bad"){g.append("<option value='common'>良品</option>").append("<option value='bad'  selected='selected'>不良品</option>");
}else{g.append("<option value='common' selected='selected'>良品</option>").append("<option value='bad'>不良品</option>");}g.append("</select>");for(var c=0;
c<n.length;c++){var b=n[c];if(m.prodId==b.prodId&&m.prodName==b.prodName&&m.skuCode==b.skuCode){g.append("<select class='form-control itemType' placeholder='项目类型'>").append("<option value='common' >良品</option>").append("<option value='bad' selected='selected'>不良品</option>").append("</select>");
}}if(f>=0){n.splice(f,1);}g.append("</td>").append("<td width='10%'>"+d+"</td>").append("<td width='18%'><input class='form-control' value='"+e+"' placeholder='备注信息'></td>");
if(parseInt(l)>1&&f<0&&h){g.append("<td width='5%'><button class='btn btn-outline btn-sm btn-danger checkItemDelBtn' type='button'>拆分</button></td>");}else{g.append("<td>&nbsp;</td>");
}g.append("</tr>");return g;},_updateTotal:function(){var a=Number(0);$("#rejectProductContainer").find(".prodQty").each(function(){a+=Number($(this).val());
});$("#rejectProductContainer").find(".badQty").each(function(){a+=Number($(this).val());});$("#totalCountContainer").text(a);$("#rejectProductFooterContainer").empty().append("<tr><td>合计</td>"+"<td colspan='2'>&nbsp;</td>"+"<td>总数量:<strong id='totalCountContainer'>"+a+"</strong></td>"+"<td colspan='6'>&nbsp;</td><tr>");
}};