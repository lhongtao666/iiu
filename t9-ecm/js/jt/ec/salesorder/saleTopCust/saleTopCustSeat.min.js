$(function(){function b(){this.hadInit=false;this.isEdit=false;this.intervalId=null;this.$container=$("div[srcVal='/ec/salesorder/soEntity/saleTopCust/seatList.htm']");
}b._CONS_={DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detail.htm",};b.prototype={init:function(d){var c=this;if(!c.hadInit){c.hadInit=true;c._bindEventHander();
c._getData("this");}},_bindEventHander:function(){var c=this;c.$container.on("click",".thisButton",function(){c.$container.find(".thisButton").attr("disabled",true);
c.$container.find(".preButton").attr("disabled",false);c.$container.find(".allButton").attr("disabled",false);c._getData("this");});c.$container.on("click",".preButton",function(){c.$container.find(".preButton").attr("disabled",true);
c.$container.find(".thisButton").attr("disabled",false);c.$container.find(".allButton").attr("disabled",false);c._getData("pre");});c.$container.on("click",".allButton",function(){c.$container.find(".allButton").attr("disabled",true);
c.$container.find(".thisButton").attr("disabled",false);c.$container.find(".preButton").attr("disabled",false);c._getData("all");});c.$container.on("click",".csTab",function(){var d=$(this).attr("value");
var f=$(this).attr("valueCsName");var e=$(this).attr("valueCsId");if(f.length>4){f="*"+f.substring(f.length-3,f.length);}JTTabUtils.addOrRefreshTab(b._CONS_.DETAIL_CS_PAGE_URL+"?csId="+e,"客户["+f+"]明细");
});},_getData:function(i){var e=this;var d=new Date();var h="";if(i=="this"){h+="Q__D__BW__cs.last_confirm_time_="+DateUtils.format(DateUtils.getMonthFirst(d.getFullYear(),d.getMonth()+1),"yyyy-MM-dd HH:mm:ss")+","+DateUtils.format(DateUtils.getMonthLast(d.getFullYear(),d.getMonth()+1),"yyyy-MM-dd HH:mm:ss");
h+="&confirmTime="+DateUtils.format(DateUtils.getMonthFirst(d.getFullYear(),d.getMonth()+1),"yyyy-MM-dd HH:mm:ss")+","+DateUtils.format(DateUtils.getMonthLast(d.getFullYear(),d.getMonth()+1),"yyyy-MM-dd HH:mm:ss");
}else{if(i=="pre"){var g=DateUtils.format(DateUtils.getCurrentMonthFirst(DateUtils.getBeforeMonth(1)),DateUtils._CONS_.DEFAULT_DATE_PATTERN);var c=DateUtils.format(DateUtils.getCurrentMonthLast(DateUtils.getBeforeMonth(1)),DateUtils._CONS_.DEFAULT_DATE_PATTERN);
h+="Q__D__BW__cs.last_confirm_time_="+g+" 00:00:00,"+c+" 23:59:59";h+="&confirmTime="+g+" 00:00:00,"+c+" 23:59:59";}}e.$container.find("#saleTopCustDiv").empty().append("<table class='table table-bordered table-stripped' id='saleTopCustTable'>"+"<thead>"+"<tr>"+"<th style='border-right:2px solid #f2f2f2;border-bottom:1px solid #f2f2f2'>客户姓名</th><th>编号</th><th>消费金额</th>"+"<th>订单数</th>"+"</tr></thead></table>");
var f=ctx+"/crm/cs/csEntity/saleTopCustSeat.htm?"+h+"&isHome=y&Q__N__GT__cs.so_total_="+0;$("#saleTopCustTable").DataTable({ajax:{url:f},columns:[{data:"name"},{data:"code",render:function(l,k,j){return"<a href='#'  class='csTab' value='"+j.code+"' valueCsId = '"+j.id+"' valueCsName = '"+j.name+"'>"+j.code+"</a>";
}},{data:"csTotal"},{data:"csOrder"},],rowId:"id",lengthMenu:[[3],],paging:true,searching:false,pagingType:"simple",lengthChange:false,autoWidth:false,order:[2,"desc"],});
}};var a=new b();a.init();});