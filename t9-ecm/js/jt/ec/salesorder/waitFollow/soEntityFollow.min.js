$(function(){function b(){this.hadInit=false;}b._CONS_={LIST_DATA_URL:ctx+"/ec/salesorder/soEntity/listData.htm",DETAIL_PAGE_URL:ctx+"/ec/salesorder/soEntity/detail.htm",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detail.htm"};
b.prototype={init:function(d){if(!this.hadInit){this.hadInit=true;if(empType=="self"){$(".titleName").html("我需跟进的订单");}else{$(".titleName").html("我的部门需跟进的订单");
}this._bindEventHander();this._initTable();var c=this;setInterval(function(){c._initTable();},60*60000);}},_getAllStatusStr:function(){var d=new StringBuffer();
$("select[id=status] option").each(function(){d.append($(this).val()).append(",");});var c=d.toString();return c.substring(0,c.length-1);},_bindEventHander:function(){var c=this;
$("body").on("click",".soTab",function(){var e=$(this).attr("value");var d=$(this).attr("value");if(d.length>4){e="*"+d.substring(d.length-3,d.length);
}JTTabUtils.addOrRefreshTab(b._CONS_.DETAIL_PAGE_URL+"?soNo="+d,"订单["+e+"]明细");});$("body").on("click",".csTab",function(){var e=$(this).text();var d=$(this).attr("value");
if(e.length>4){e="*"+e.substring(e.length-3,e.length);}JTTabUtils.addOrRefreshTab(b._CONS_.DETAIL_CS_PAGE_URL+"?csId="+d,"客户["+e+"]明细");});},_initTable:function(){var c=b._CONS_.LIST_DATA_URL+"?rows=10&empType="+empType;
c+="&Q__S__IN__entity.status_=awaiting_post,awaiting_pay,awaiting_comfirm,comfirm,packing,deliver,shipping";FormUtils.loadData(c,function(j){var l=j.rows;
if(l&&l.length){var m=new StringBuffer();for(var h=0;h<l.length;h++){m.append("<tr>");var e=l[h].soNo&&"<a href='#'  class='soTab' value='"+l[h].soNo+"' >"+l[h].soNo+"</a>";
m.append("<td>"+e+"</td>");var o=l[h].csName&&"<a href='#'  class='csTab' value='"+l[h].csId+"' >"+l[h].csName+"</a>";m.append("<td>"+o+"</td>");var k="";
var k=l[h].soType;if(l[h].soType=="common"){k="普通订单";}else{if(l[h].soType=="change"){k="换货单";}else{if(l[h].soType=="repeat"){k="重发单";}else{if(l[h].soType=="point"){k="积分订单";
}}}}m.append("<td>"+k+"</td>");var g="";if(l[h].status=="awaiting_post"){g="待提交";}else{if(l[h].status=="awaiting_comfirm"){g="待审核";}else{if(l[h].status=="comfirm"){g="已审核";
}else{if(l[h].status=="awaiting_pay"){g="待支付";}else{if(l[h].status=="comfirm"){g="待发货";}else{if(l[h].status=="shipping"){g="已发货";}else{if(l[h].status=="complete"){g="已签收";
}else{if(l[h].status=="close"){g="已关闭";}else{if(l[h].status=="close_reject"){g="订单拒收";}else{if(l[h].status=="close_lost"){g="包裹丢失";}}}}}}}}}}m.append("<td>"+g+"</td>");
var f="";if(l[h].cashType=="pay"){f="款到发货";}else{if(l[h].cashType=="pay_sub"){f="支付订金";}else{if(l[h].cashType=="green"){f="绿色通道";}else{if(l[h].cashType=="cod"){f="货到付款";
}else{if(l[h].cashType=="free"){f="免费已付";}}}}}m.append("<td>"+f+"</td>");var d="";var n="元";if(l[h].soType=="point"){n="积分";}m.append("<td>"+l[h].totalAmount+n+"</td>");
m.append("<td>");if(l[h].placeTime==null||l[h].placeTime==""){m.append("无");}else{m.append(l[h].placeTime);}m.append("</td>");m.append("</tr>");}$("#waitFollowContainer").empty().append(m.toString());
}IframeUtils.resizeHeight($(parent.document).find('iframe[srcVal*="/ec/salesorder/soEntity/waitFollow/list.htm"]'),$(".panel.panel-default").height());
});}};var a=new b();a.init();});