$(function(){var a=new SoEntityStockList();a.init();});function SoEntityStockList(){this.hadInit=false;this.waitPack=new WaitPack();this.waitAllocate=new WaitAllocate();
this.waitDeliver=new WaitDeliver();this.delayShip=new DelayShip();this.delivered=new Delivered();this.sweepDeliver=new SweepDeliver();this.canShowScTrankNo=(ResUtils.canShow("soDeliver.button.showScTrackNo")?"can":"cannot");
}SoEntityStockList._CONS_={LIST_PP_DATA_URL:ctx+"/crm/cs/csEntity/findByNameOrCode.htm",CACHE_IN_REDIS_URL:ctx+"/ec/salesorder/soEntity/sendSms.htm",};
SoEntityStockList.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();ShipCompanyUtils.getOptions({container:"scCodeQry",caption:"全部",callBack:function(){$(".scCodeQry").chosen("destroy").chosen();
}});this.waitDeliver.init({gridRecordsSpan:".waitDeliverRecords",canShowScTrankNo:this.canShowScTrankNo,soEntityShipModel:soEntityShipModel});this.waitAllocate.init({canShowScTrankNo:this.canShowScTrankNo,soEntityShipModel:soEntityShipModel});
this.waitPack.init({canShowScTrankNo:this.canShowScTrankNo,soEntityShipModel:soEntityShipModel});this.sweepDeliver.init();ShipCompanyUtils.getOptions({container:"scCode",caption:"全部"});
StoreUtils.loadData({container:"storeIdSearchContainer2",isSale:false});StoreUtils.loadData({container:"storeIdSearchContainer",isSale:false});this._prodSearch();
CateUtils.getOptions({typeKey:"system",pKey:"CsInterestType",container:"interests"});CateUtils.findCatePos({typeKey:"soEntity",pKey:"soType",container:"soTypeQry",caption:"noSoType",});
this._locateToGlHelp();}},_locateToGlHelp:function(){var a="glHelp.stock.shipping";glHelpUtil.init(a);},_prodSearch:function(a){$(".searchProd").bsSuggest("destroy");
var b=this;var e=$(".searchProd").width()+"px";var c="entity";var f="n";var d="n";$(".searchProd").bsSuggest({url:ctx+"/ec/product/prodEntity/search.htm?prodType="+c+"&hasStock="+f+"&storeId="+"&limitProdCate="+d+"&keyword=",effectiveFields:["prodName"],searchFields:["prodName","skuCode"],effectiveFieldsAlias:{prodName:"产品名字"},showBtn:false,idField:"skuId",keyField:"skuId",showBtn:false,twoWayMatch:false,ignorecase:true,allowNoKeyword:true,multiWord:false,autoSelect:false,delayUntilKeyup:false,getDataMethod:"firstByUrl",processData:function(g){b.searchProds=g.value;
return g;},listStyle:{"padding-top":0,"max-height":"500px","max-width":e,"overflow":"auto","width":"auto","transition":"0.3s","-webkit-transition":"0.3s","-moz-transition":"0.3s","-o-transition":"0.3s"}}).on("onDataRequestSuccess",function(h,g){b.searchProds=g.value;
}).on("onSetSelectValue",function(j,g){for(var h=0;h<b.searchProds.length;h++){if(b.searchProds[h].skuId==g.id){b.currentProd=b.searchProds[h];break;}}$(".searchProd").val(b.currentProd.prodName);
$(".skuSearch").val(b.currentProd.skuId);}).on("onUnsetSelectValue",function(g){b.currentProd={};});},_bindEventHander:function(){var a=this;$("#belongOgnPlacer").on("click",function(){var b={isMultiple:0,selectedGroupId:$("#belongOgnPlacerHide").val(),container:"belongOgnPlacer",nolimit:true,positionType:"order_print,dept_manager",fn:function(c){$("#belongOgnPlacerHide").val(c);
SoEntityUtils.buildEmployeeOption(c,"placerSearch","order_print,dept_manager");}};GroupUtils.selectGroupTreeBox(b);});$("#belongOgnNameAllocate").on("click",function(){var b={isMultiple:1,selectedGroupId:$("#belongOgnAllocate").val(),container:"belongOgnNameAllocate",nolimit:true,positionType:"order_print,dept_manager",fn:function(c){$("#belongOgnAllocate").val(c);
SoEntityUtils.buildEmployeeOption(c,"belongEmployeeAllocateSearch","order_print,dept_manager");}};GroupUtils.selectGroupTreeBox(b);});$("#belongOgnNameWaitPack").on("click",function(){var b={isMultiple:1,selectedGroupId:$("#belongOgnWaitPack").val(),container:"belongOgnNameWaitPack",nolimit:true,positionType:"order_print,dept_manager",fn:function(c){$("#belongOgnWaitPack").val(c);
SoEntityUtils.buildEmployeeOption(c,"belongEmployeeWaitPackSearch","order_print,dept_manager");}};GroupUtils.selectGroupTreeBox(b);});$("#belongOgnNamePack").on("click",function(){var b={isMultiple:1,selectedGroupId:$("#belongOgnPack").val(),container:"belongOgnNamePack",nolimit:true,positionType:"order_print,dept_manager",fn:function(c){$("#belongOgnPack").val(c);
SoEntityUtils.buildEmployeeOption(c,"belongEmployeePackSearch","order_print,dept_manager");}};GroupUtils.selectGroupTreeBox(b);});$("#belongOgnNameDelivered").on("click",function(){var b={isMultiple:1,selectedGroupId:$("#belongOgnDelivered").val(),container:"belongOgnNameDelivered",nolimit:true,positionType:"order_print,dept_manager",fn:function(c){$("#belongOgnDelivered").val(c);
SoEntityUtils.buildEmployeeOption(c,"belongEmployeeDeliveredSearch","order_print,dept_manager");}};GroupUtils.selectGroupTreeBox(b);});$("#belongOgnName").on("click",function(){var b={isMultiple:1,selectedGroupId:$("input[name='belongOgn']").val(),container:"belongOgnName",nolimit:true,positionType:"order_print",fn:function(c){$("input[name=belongOgn]").val(c);
SoEntityUtils.buildEmployeeOption(c,"belongEmployeePackSearch","order_print,dept_manager");}};GroupUtils.selectGroupTreeBox(b);});$("#belongOgnNameDelayShip").on("click",function(){var b={isMultiple:1,selectedGroupId:$("#belongOgnDelayShip").val(),container:"belongOgnNameDelayShip",nolimit:true,positionType:"order_print",fn:function(c){$("#belongOgnDelayShip").val(c);
SoEntityUtils.buildEmployeeOption(c,"belongEmployeeDelayShipSearch","order_print,dept_manager");}};GroupUtils.selectGroupTreeBox(b);});$("body").on("click",".tabli",function(){$(".searchProd").val("");
$(".skuSearch").val("");if($(this).attr("id")=="soWaitDeliverTabLi"){a.waitDeliver.init({gridRecordsSpan:".waitDeliverRecords",canShowScTrankNo:a.canShowScTrankNo});
}else{if($(this).attr("id")=="soWaitPackTabLi"){a.waitPack.init({canShowScTrankNo:a.canShowScTrankNo});}else{if($(this).attr("id")=="soWaitAllocateTabLi"){a.waitAllocate.init({canShowScTrankNo:a.canShowScTrankNo});
}else{if($(this).attr("id")=="soWaitBackTabLi"){a.stockReject.init({gridRecordsSpan:".waitBackRecords",canShowScTrankNo:a.canShowScTrankNo});}else{if($(this).attr("id")=="soDeliveredTabLi"){a.delivered.init({canShowScTrankNo:a.canShowScTrankNo});
}else{if($(this).attr("id")=="soDelayShipTabLi"){a.delayShip.init({canShowScTrankNo:a.canShowScTrankNo});}else{if($(this).attr("id")=="soBackedTabLi"){a.stockRejected.init({canShowScTrankNo:a.canShowScTrankNo});
}}}}}}}$(this).parents(".dropdown").children("a").eq(0).empty().append($(this).text()+'<b class="caret"></b>');});$("body").on("click",".soEntityReload",function(){if($("#tabSoWaitDeliver").hasClass("active")){a.waitDeliver.resSearchGrid();
}else{if($("#tabSoWaitBack").hasClass("active")){a.stockReject.resSearchGrid();}}});$(".showSearch").on("click",function(){$(this).parent().parent().parent().find(".hideSearchParam").show();
$(this).parent().parent().parent().find(".hideSearch").show();$(this).hide();$(this).closest("form").find(".chosen-select").chosen("destroy").chosen();
});$(".hideSearch").on("click",function(){$(this).parent().parent().parent().find(".hideSearchParam").hide();$(this).parent().parent().parent().find(".showSearch").show();
$(this).hide();});$("body").on("click",".csTab",function(){var c=$(this).text();var b=$(this).attr("value");if(c.length>5){c="*"+c.substring(c.length-4,c.length);
}JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.DETAIL_CS_PAGE_URL+"?csId="+b,"客户["+c+"]");});$("body").on("click",".resetBtn",function(){var b=$(this).parents("form").attr("id");
$("#"+b).find("input[id=soNoSearch]").val("");FormUtils.clear("#"+b);$("#"+b).find(".search-choice").remove();});$("body").on("change",".sendSms",function(){var c=$(this)[0].checked;
$(".sendSms").each(function(){$(this)[0].checked=c;});var b=SoEntityStockList._CONS_.CACHE_IN_REDIS_URL;FormUtils.submit(b,{employeeId:currentUserId,sendSms:c?"y":"n"},function(d){});
});}};