var FinanceAccountSelect={initSelect:function(c,b,a){$.ajax({type:"GET",url:ctx+"/ec/finance/financeAcount/listPo.htm",contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(f){if(f!=null&&f!=""){var d=document.getElementById(c);
d.options.length=0;for(var e=0;e<f.length;e++){d.options.add(new Option(f[e].account+"("+f[e].name+")",f[e].account));if(f[e].account==b){d.options[d.options.length-1].selected="selected";
}}}if(a){a();}},error:function(d){alert(d);}});},initSelectActived:function(c,b,a){$.ajax({type:"GET",url:ctx+"/ec/finance/financeAcount/listPo.htm?Q__S__EQ__status_=actived",contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(e){if(e!=null&&e!=""){var f=new StringBuffer();
f.append("<option value=''>请选择</option>");for(var d=0;d<e.length;d++){f.append("<option attr-type='"+e[d].accountType+"' value='"+e[d].account+"'");if(e[d].account==b){f.append("selected=selected");
}f.append(">"+e[d].account+"（"+e[d].name+"）"+"</option>");}$("#"+c).empty().append(f.toString());}if(a){a();}},error:function(d){alert(d);}});},initSelectType:function(c,b){var a=ctx+"/ec/finance/financeAcount/listPo.htm?Q__S__EQ__status_=actived";
if(c.accountType){a+="&Q__S__EQ__account_type_="+c.accountType;}$.ajax({type:"GET",url:a,contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(f){var d=document.getElementById(c.selectId);
d.options.length=0;if(f!=null&&f!=""){for(var e=0;e<f.length;e++){d.options.add(new Option(f[e].account+"("+f[e].name+")",f[e].account));if(f[e].account==c.selectedValue){d.options[d.options.length-1].selected="selected";
}}}if(b){b();}},error:function(d){alert(d);}});},initSelectIsUsed:function(c,b,a){$.ajax({type:"GET",url:ctx+"/ec/finance/financeAcount/listPo.htm",contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(f){if(f!=null&&f!=""){var d=document.getElementById(c);
d.options.length=0;for(var e=0;e<f.length;e++){if(f[e].isUsed=="y"){d.options.add(new Option(f[e].name,f[e].account));if(f[e].account==b){d.options[d.options.length-1].selected="selected";
}}}}if(a){a();}},error:function(d){alert(d);}});}};function AddressService(a){this.container=a;this.isHideCountry=false;}AddressService._CONS_={CATE_TYPE_KEY:"AddressCateType",ROOT_KEY:"AddressCateType-root"};
AddressService.prototype={init:function(b,a){if(!b||!b.isNotRequired){$("#"+this.container).empty().append("<div class='col-sm-12'><label class='control-label col-sm-2'>所在地<span style='color:red;'>*</span></label><div class='col-sm-10 container' style='padding-left:0px !important;'></div></div>");
}else{if(b.isSelect&&b.isSelect=="y"){$("#"+this.container).empty().append("<div class='col-sm-12'><div class='col-sm-10 container' style='padding-left:0px !important;'></div></div>");
}else{if(b.rowFit&&b.rowFit=="y"){$("#"+this.container).empty().append("<label class='control-label col-sm-1'>所在地</label><div class='col-sm-11 container' style='padding-left:0px !important;'></div>");
}else{$("#"+this.container).empty().append("<label class='control-label col-sm-1'>所在地</label><div class='col-sm-6 container'></div></div>");}}}this.params=b;
this._bindEventHandler();if(b.isHideCountry){self.isHideCountry=b.isHideCountry;this._loadProvinces("ChinaCityCateType-root");}else{this._loadCountrys();
}if(a&&typeof(a)=="function"){a();}},getAddress:function(){var e=$("#"+this.container).find('select[name="country_"]').val();var a=$("#"+this.container).find('select[name="province_"]').val();
var d=$("#"+this.container).find('select[name="city_"]').val();var c=$("#"+this.container).find('select[name="area_"]').val();var b=$("#"+this.container).find("select[name='town_']").val();
return{country:e,countryName:$("#"+this.container).find('select[name="country_"]').find('option[value="'+e+'"]').text(),province:a,provinceName:$("#"+this.container).find('select[name="province_"]').find('option[value="'+a+'"]').text(),city:d,cityName:$("#"+this.container).find('select[name="city_"]').find('option[value="'+d+'"]').text(),area:c,areaName:$("#"+this.container).find('select[name="area_"]').find('option[value="'+c+'"]').text(),town:b,townName:b?$("#"+this.container).find("select[name='town_']").find("option[value='"+b+"']").text():"",};
},isValid:function(b){var a=true;$("#"+this.container).find("select").each(function(){var c=$(this).attr("name");var e=$(this).val();if(!e&&c!="town_"){a=false;
var d="";switch(c){case"country_":d="请选择国家";break;case"province_":d="请选择省份";break;case"city_":d="请选择城市";break;case"area_":d="请选择区县";break;}DialogUtils.error(msgCode.ERROR,d,b);
return false;}});return a;},_loadCountrys:function(){this._loadCates(AddressService._CONS_.ROOT_KEY,"country_");},_loadProvinces:function(a){this._loadCates(a,"province_");
},_loadCitys:function(a){this._loadCates(a,"city_");},_loadAreas:function(a){this._loadCates(a,"area_");},_loadTowns:function(a){this._loadCates(a,"town_");
},_loadCates:function(c,d){var a=this;var b=ctx+"/gl/cate/cate/getCateByCateTypeAndParentId.htm";b+="?cateType="+AddressService._CONS_.CATE_TYPE_KEY+"&parentKey="+c;
FormUtils.loadData(b,function(h){if(h.success){if(h.msg!=null&&h.msg!=""){var j=new StringBuffer();var g=JSON.parse(h.msg);if(g&&g.length>0){j.append("<div class='col-sm-2' style='padding-left:0px !important;'>");
j.append("<select class='form-control' name='"+d+"'>");j.append("<option value=''>请选择</option>");for(var e=0;e<g.length;e++){var f="";if(a.params){switch(d){case"country_":if(g[e].value==a.params.country){f="selected='selected'";
}break;case"province_":if(g[e].value==a.params.province){f="selected='selected'";}break;case"city_":if(g[e].value==a.params.city){f="selected='selected'";
}break;case"area_":if(g[e].value==a.params.area){f="selected='selected'";}break;case"town_":if(g[e].value==a.params.town){f="selected='selected'";}break;
}}j.append("<option "+f+" idValue='"+g[e].id+"' value='"+g[e].value+"'>"+g[e].name+"</option>");}j.append("</select>");j.append("</div>");$("#"+a.container).find(".container").append(j.toString());
if(a.params&&a.params.disabled){$("#"+a.container).find(".container").find("select").attr("disabled","disabled");}if(a.params){switch(d){case"country_":if(a.params.country&&!a.isHideCountry){a._loadProvinces(a.params.country);
}break;case"province_":if(a.params.province){a._loadCitys(a.params.province);}break;case"city_":if(a.params.city){a._loadAreas(a.params.city);}break;case"area_":if(a.params.area){a._loadTowns(a.params.area);
}break;}}}}}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},_bindEventHandler:function(){var a=this;$("#"+this.container).off("change",'select[name="country_"]');
$("#"+this.container).off("change",'select[name="province_"]');$("#"+this.container).off("change",'select[name="city_"]');$("#"+this.container).off("change","select[name='area_']");
$("#"+this.container).find("select[name='area_']").off("change");$("#"+this.container).on("change",'select[name="country_"]',function(){a.params=null;var b=$(this).val();
if(b){$(this).parent().nextAll().remove();a._loadProvinces(b);}else{$("#"+a.container).find("select[name=province_]").empty().append("<option value=''>请选择</option>");
$("#"+a.container).find("select[name=city_]").empty().append("<option value=''>请选择</option>");$("#"+a.container).find("select[name=area_]").empty().append("<option value=''>请选择</option>");
}$.log("change");});$("#"+this.container).on("change",'select[name="province_"]',function(){a.params=null;var b=$(this).val();if(b){$(this).parent().nextAll().remove();
a._loadCitys(b);}else{$("#"+a.container).find("select[name=city_]").empty().append("<option value=''>请选择</option>");$("#"+a.container).find("select[name=area_]").empty().append("<option value=''>请选择</option>");
}$.log("change");});$("#"+this.container).on("change",'select[name="city_"]',function(){a.params=null;var b=$(this).val();if(b){$(this).parent().nextAll().remove();
a._loadAreas(b);}else{$("#"+a.container).find("select[name=area_]").empty().append("<option value=''>请选择</option>");}$.log("change");});$("#"+this.container).on("change","select[name='area_']",function(){a.params=null;
var b=$(this).val();if(b){$(this).parent().nextAll().remove();a._loadTowns(b);}else{$("#"+a.container).find("select[name='town_']").empty().append("<option value=''>请选择</option>");
}$.log("change");});}};function SoEntityExport(){this.hadInit=false;this.params="";}SoEntityExport._CONS_={EXPORT_ASYNCHRO:ctx+"/ec/salesorder/soEntity/exportAsynchronous.htm",EXPORT_PACK_URL:ctx+"/ec/salesorder/soEntity/exportPack.htm",EXPORT_EXCEL_URL:ctx+"/ec/salesorder/soEntity/exportSoEntityModule.htm",EXPORT_PRODUCT_EXCEL_URL:ctx+"/ec/salesorder/soEntity/exportSoProduct.htm",EXPORT_EMPPROD_EXCEL_URL:ctx+"/ec/salesorder/soEntity/exportEmpProduct.htm",EXPORT_EMPSOPROD_EXCEL_URL:ctx+"/ec/salesorder/soEntity/exportEmpSoProduct.htm",EXPORT_EDIANBAO_EXCEL_URL:ctx+"/ec/salesorder/soEntity/exportEDianBao.htm",EXPORT_YANWEN_EXCEL_URL:ctx+"/ec/salesorder/soEntity/exportYwSoShip.htm",ISRECPHONE:false};
SoEntityExport.prototype={init:function(a){this.params=a;if(!this.params.selectIds){this.params.selectIds="";}this.openExportLayer();if(!this.hadInit){this._bindEventHander();
}this.hadInit=true;ConfigUtils.findByKey("soEntity.isReceivePhone",function(b){if(b.success){SoEntityExport._CONS_.ISRECPHONE=true;}});},_bindEventHander:function(){$("#selectAll").on("change",function(){var c=$(this)[0].checked;
var b=$("#columnContainer").find(".columnCheckBox");for(var a=0;a<b.length;a++){b[a].checked=c;}});},openExportLayer:function(){var a=this;a.layerIndex=layer.open({type:1,title:"订单导出",maxmin:false,move:false,scrollbar:false,shadeClose:false,btn:["导出","取消"],area:["70%","70%"],content:$(".soEntityExportPane"),success:function(b,c){a._initData();
},yes:function(d,f){var i=$("input[name='startCount'").val();var c=$("input[name='endCount'").val();var b=parseInt($("input[name='maxCount'").val());if(b<1){DialogUtils.error(msgCode.FAIL_MSG,"导出数量不能小于1");
return false;}if(c==""||c==null||i==""||i==null){DialogUtils.error(msgCode.FAIL_MSG,"导出数量不能小于1");return false;}c=parseInt(c);i=parseInt(i);if(i>c||c>b||i>b||c<0||i<0){DialogUtils.error(msgCode.FAIL_MSG,"请填写正确的订单数量。最大值不能大于"+b);
return false;}if(c-i>100000){DialogUtils.error(msgCode.FAIL_MSG,"一次导出订单不能超过100000条，请分批导出！");return false;}var j=a._exportParams(i,c);var e=$("input[name='exportType']:checked").val();
if(!j&&!e=="soAndProd"){DialogUtils.error(msgCode.FAIL_MSG,"请选择要导出的字段");return false;}DialogUtils.success(msgCode.SUCCESS,"正在导出....");layer.close(a.layerIndex);
var k=$("input[name='fileType']:checked").val();if(e=="soAndProd"){FormUtils.submit(SoEntityExport._CONS_.EXPORT_PRODUCT_EXCEL_URL,a.params.params+j+"&selectIds="+a.params.selectIds,function(l){},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
},true);}else{if(e=="csAndProd"||e=="empAndProd"){FormUtils.submit(SoEntityExport._CONS_.EXPORT_EMPPROD_EXCEL_URL,a.params.params+j+"&selectIds="+a.params.selectIds+"&exportType="+e,function(l){},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
},true);}else{if(e=="csAndSoProd"||e=="empAndSoProd"){FormUtils.submit(SoEntityExport._CONS_.EXPORT_EMPSOPROD_EXCEL_URL,a.params.params+j+"&selectIds="+a.params.selectIds+"&exportType="+e,function(l){},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
},true);}else{if(k=="edianbaoExcel"){FormUtils.submit(SoEntityExport._CONS_.EXPORT_EDIANBAO_EXCEL_URL,a.params.params+j+"&selectIds="+a.params.selectIds+"&exportType="+e,function(l){},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
},true);}else{if(k=="yanwenShipExcel"){FormUtils.submit(SoEntityExport._CONS_.EXPORT_YANWEN_EXCEL_URL,a.params.params+j+"&selectIds="+a.params.selectIds+"&exportType="+e,function(l){},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
},true);}else{if(k=="module"){window.location.href=SoEntityExport._CONS_.EXPORT_EXCEL_URL+"?"+a.params.params+j+"&selectIds="+a.params.selectIds;return;
}else{var h=SoEntityExport._CONS_.EXPORT_ASYNCHRO;var g=a.params.requestQueryParams?("?"+a.params.requestQueryParams):"";h=h+g;FormUtils.submit(h,a.params.params+j+"&selectIds="+a.params.selectIds,function(l){if(!l.success){DialogUtils.error(msgCode.ERROR,l.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);},true);}}}}}}window.top.showTimming(c-i);},cancel:function(){}});},_initData:function(){$("input[name='exportType']")[0].checked=true;
$("input[name='fileType']")[0].checked=true;this._initColoms();this._initCount();},_initColoms:function(){var a=[];var b=LocalStorageUtils.get("SO_EXPORT_COLUMNS_"+currentUserId);
if(b){a=b.split(",");}excelUtil.findExportColByModule("soEntity",true,function(d){var e=new StringBuffer();if(d&&d.length>0){for(var c=0;c<d.length;c++){if(d[c].devCode=="tranPhone"||d[c].devCode=="recPhone"){if(!SoEntityExport._CONS_.ISRECPHONE){continue;
}}e.append("<div class='checkbox checkbox-success checkbox-inline'>");if($.inArray(d[c].devCode,a)!=-1){e.append("<input type='checkbox' checked class='columnCheckBox' name='exportColumn' id="+d[c].id+" value='"+d[c].devCode+"'><label for='"+d[c].id+"'>"+d[c].name+"</label>");
}else{e.append("<input type='checkbox' class='columnCheckBox' name='exportColumn' id="+d[c].id+" value='"+d[c].devCode+"'><label for='"+d[c].id+"'>"+d[c].name+"</label>");
}e.append("</div>");}}$("#columnContainer").empty().append(e.toString());});},_initCount:function(){var b=this.params;var a=b.toatolCount;if(b.selectIds&&b.selectIds.length>0){a=b.selectIds.length;
}$("input[name='startCount'").val(1);$("input[name='endCount'").val(a);$("input[name='maxCount'").val(a);},_exportParams:function(d,g){var c="";var e=$("#columnContainer").find(".columnCheckBox");
var f=[];$(e).each(function(){if($(this).is(":checked")){f.push($(this).val());}});if(f.length<=0){return false;}var b=$("input[name='exportType']:checked").val();
var a=$("input[name='fileType']:checked").val();c="&columns="+f+"&startCount="+d+"&pageSize="+(g-d+1)+"&exportType="+b+"&fileType="+a;LocalStorageUtils.set("SO_EXPORT_COLUMNS_"+currentUserId,f.toString());
return c;},exportPack:function(a){var b=$(a).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error("错误","请选择要导出备货信息的订单");return null;
}FormUtils.submit(SoEntityExport._CONS_.EXPORT_PACK_URL,"soId="+b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,"成功");window.location=ctx+c.msg+"?pw=42385A79697676502F512F33454F58333337794472513D3D";
}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}};var excelUtil={toGenExcel:function(a,b,c){JTTabUtils.addOrRefreshTab(ctx+"/gl/mc/moduleColumn/toGenExcel.htm?module="+a+"&moduleText="+c,b);
},importExcel:function(a){if(a.isCreateSub){JTTabUtils.addOrRefreshTab(ctx+"/gl/mc/moduleColumn/importExcel.htm?importUrl="+a.importUrl+"&isCreateSub="+a.isCreateSub,a.tabTitle);
}else{JTTabUtils.addOrRefreshTab(ctx+"/gl/mc/moduleColumn/importExcel.htm?importUrl="+a.importUrl,a.tabTitle);}},findExportColByModule:function(c,b,d){var a=ctx+"/gl/mc/moduleColumn/findByModule.htm?module="+c;
if(b){a=ctx+"/gl/mc/moduleColumn/findGrantCol.htm?module="+c;}FormUtils.loadData(a,function(e){if(d){d(e);}});}};var SoEntityUtils={formatStatus:function(e){var b="";
var a=e.status;var d=e.delayConfirmTime;var c=e.delayShipTime;if(a=="awaiting_pay"){b="待支付";}else{if(a=="awaiting_post"){b="待提交";}else{if(a=="awaiting_comfirm"){if(d!=null){b="待审核"+"<span style='color:red;font-size: 8px;'>[延审]</span>";
}else{b="待审核";}}else{if(a=="comfirm"){if(c!=null){b="待发货"+"<span style='color:red;font-size: 8px;'>[延发]</span>";}else{b="待发货";}}else{if(a=="shipping"){b="已发货";
}else{if(a=="complete"){b="已签收";}else{if(a=="close"){b="已作废";}else{if(a=="close_reject"){b="已拒收";}else{if(a=="close_lost"){b="已丢失";}}}}}}}}}return b;},formatCashType:function(b){var a="";
if(b=="pay"){a="款到发货";}else{if(b=="pay_sub"){a="支付订金";}else{if(b=="green"){a="绿色通道";}else{if(b=="green_by"){a="绿色通道订金";}else{if(b=="cod"){a="货到付款";}else{if(b=="free"){a="免费已付";
}else{if(b=="point"){a="积分付款";}}}}}}}return a;},formatPayType:function(b){var a="";if(b=="alipay"){a="支付宝";}else{if(b=="weixin"){a="微信支付";}else{if(b=="weixinhongbao"){a="微信红包";
}else{if(b=="bank"){a="银行转账";}else{if(b=="cash"){a="现金支付";}else{if(b=="point"){a="积分支付";}}}}}}return a;},getTurnBackStr:function(b,a){var c="";switch(b){case"awaiting_post":if(!(a==null||a==""||a=="awaiting_post")){c="&nbsp;<span style='color:red'>撤</span>";
}break;case"awaiting_comfirm":if(!(a=="awaiting_post"||a=="awaiting_comfirm")){c="&nbsp;<span style='color:red'>撤</span>";}break;case"comfirm":if(!(a=="awaiting_post"||a=="awaiting_comfirm"||a=="awaiting_pay"||a=="comfirm")){c="&nbsp;<span style='color:red'>撤</span>";
}break;}return c;},confirm:function(b,a){window.localStorage.setItem("comfirm_"+currentUserId,b.toString());JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.SO_TO_COMFIRM_URL+"?soId="+b[0],"订单["+a+"审核");
},toDeliver:function(a){window.localStorage.setItem("deliver_"+currentUserId,JSON.stringify(a));ConfigUtils.findByKey("soEntity.isEditSaveSo",function(b){if(b.success&&ResUtils.canShow("soEntity.button.saveSoComfirmBtn")){JTTabUtils.addOrRefreshTab(ctx+"/ec/salesorder/soEntity/waitToDeliver.htm?soId="+a[0].id,"订单["+a[0].soNo+"发货");
}else{JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.SO_TO_DELIVER_URL+"?soId="+a[0].id,"订单["+a[0].soNo+"发货");}});},backDeliver:function(b,a){DialogUtils.confirmWithOptions({title:"确定撤销发货吗？",text:"",confirmButtonText:"确认",yesFunc:function(){var c=SoEntityUtils._CONS_.BACK_DELIVER_URL;
FormUtils.submit(c,{ids:b},function(d){if(d.success){DialogUtils.success(msgCode.INFO,"撤销发货成功");if(a&&typeof(a)=="function"){a();}}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}});},confirmBatch:function(d,c,b){var a=SoEntityUtils._CONS_.COMFIRM_BATCH_URL;FormUtils.submit(a,{ids:d,isRepeatAudit:c,operComment:b,isBatch:"y"},function(e){if(e.success){DialogUtils.success(msgCode.INFO,e.msg);
}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);}$(".sowait_wrapper").find(".soEntitySearch").click();$(".so_delay_wrapper").find(".soEntitySearch").click();
},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},buildEmployeeOption:function(b,c,d){var a=d?d:"dept_manager";$.ajax({type:"GET",url:ctx+"/crm/ou/employee/listEmployees.htm?groupId="+b+"&type="+a,contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(f){if(f&&f.length>0){var g=new StringBuffer();
g.append("<option value=''>请选择</option>");for(var e=0;e<f.length;e++){g.append("<option value='"+f[e].id+"'>"+f[e].aid+":"+f[e].name+"</option>");}if(c){$("#"+c).empty().append(g.toString());
}else{$("#belongEmployeeSearch").empty().append(g.toString());}}}});},trunDownOrderLayer:function(d,c,b){var a=this;layer.open({type:1,title:"订单驳回",maxmin:false,move:false,scrollbar:false,shadeClose:false,btn:["确定","取消"],area:["600px","450px"],content:$(".soEntityTurnDownPane"),success:function(e,f){var h=new StringBuffer();
for(var g=0;g<c.length;g++){if(g!=0){h.append("，");}h.append("<span style='line-height:30px;'>"+c[g]+"</span>");}$("#trunDownSaveReForm").find(".soNoDiv").empty().append(h.toString());
$("#trunDownSaveReForm").find("#soIds").val(d.toString());(function(){var i=this;$("#trunDownSaveReFormComment").bsSuggest("destroy");$("#trunDownSaveReFormComment").bsSuggest({url:ctx+"/gl/cate/cate/getOptions.htm?typeKey=system&pKey=NotApprovedType",effectiveFields:["name"],searchFields:["name"],effectiveFieldsAlias:{name:"驳回备注"},showBtn:false,inputWarnColor:"",showHeader:false,idField:"id",keyField:"name",getDataMethod:"url",processData:function(l){var k,j,m={value:[]};
if(!l||l.records===0){return false;}j=l.length;for(k=0;k<j;k++){m.value.push({id:l[k].id,name:l[k].name});}return m;}});})();},yes:function(g,e){var f=$("#trunDownSaveReForm").find("input[name=trunDownSaveReFormComment]").val();
if(!f){DialogUtils.error("","请选择驳回原因");}else{FormUtils.submit(SoEntityUtils._CONS_.TURN_DOWN_URL,"soIds="+$("#trunDownSaveReForm").find("#soIds").val()+"&comment="+$("input[name=trunDownSaveReFormComment]").val(),function(h){if(h.success){DialogUtils.success(msgCode.INFO,h.msg);
$(".soEntitySearch").click();layer.close(g);if(b&&typeof b==="function"){b();}}else{DialogUtils.error(msgCode.FAIL_MSG,h.msg);layer.close(g);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}},cancel:function(){FormUtils.clear("trunDownSaveReForm");}});},closeOrderLayer:function(d,c,b){var a=this;layer.open({type:1,title:"订单作废确认",maxmin:false,move:false,scrollbar:false,shadeClose:false,btn:["确定","取消"],area:["600px","450px"],content:$(".soEntityClosePane"),success:function(e,g){var j=new StringBuffer();
for(var h=0;h<c.length;h++){if(h!=0){j.append("，");}j.append("<span style='line-height:30px;'>"+c[h]+"</span>");}$("#closeSaveReForm").find(".soNoDiv").empty().append(j.toString());
$("#closeSaveReForm").find("#soIds").val(d.toString());var f={rules:{closeSaveReFormComment:{required:true,maxlength:["512"],}}};FormUtils.bindFormValidation("closeSaveReForm",f);
},yes:function(f,e){if($("#closeSaveReForm").valid()){FormUtils.submit(SoEntityUtils._CONS_.CLOSE_URL,"soIds="+$("#closeSaveReForm").find("#soIds").val()+"&comment="+$("textarea[name=closeSaveReFormComment]").val()+"&isNeddValid=y",function(g){if(g.success){DialogUtils.success(msgCode.INFO,g.msg);
if(b&&typeof b==="function"){b();}$(".soEntitySearch").click();layer.close(f);}else{DialogUtils.error(msgCode.FAIL_MSG,g.msg);layer.close(f);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}},cancel:function(){FormUtils.clear("closeSaveReForm");}});},submit:function(b,a,c){JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.SO_PLACE_URL+"?soId="+b+"&type=self","订单["+a+"]提交");
},deleteSoEntity:function(b){var a=this;DialogUtils.confirm(function(){FormUtils.del(SoEntityUtils._CONS_.DELETE_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,"删除成功");
$(".end_wrapper").find(".soEntitySearch").click();}else{DialogUtils.error(msgCode.ERROR,c.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});},lock:function(c,d,a){var b=this;FormUtils.submit(SoEntityUtils._CONS_.LOCK_URL,"soIds="+c,function(e){if(e.success){$("#soEntityForm").find("[name=isLock]").val("y");
DialogUtils.success(msgCode.INFO,e.msg);if(d){b.reloadJqgrid(d,selectedId);}if(typeof(a)=="function"){a();}}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},unLock:function(c,d,a){var b=this;FormUtils.submit(SoEntityUtils._CONS_.UNLOCK_URL,"soIds="+c,function(e){if(e.success){$("#soEntityForm").find("[name=isLock]").val("n");
DialogUtils.success(msgCode.INFO,e.msg);if(d){b.reloadJqgrid(d,selectedId);}if(typeof(a)=="function"){a();}}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},initDetail:function(a){var b=this;$(".csName").attr("readonly",true);$(".changeAddr").hide();
$(".addAddr").hide();$("#prod-price-type").hide();$("#hasStock").parent().hide();$("#searchProd").parents(".form-group").hide();$(".prodPrice").attr("readonly",true);
$(".soItemCount").attr("readonly",true);$("select[name=storeId]").attr("disabled",true);$(".delSoItem").hide();$("select[id=scCode]").attr("disabled",true);
$("select[name=cashType]").attr("disabled",true);$("select[name=isCloudWarehourse]").attr("disabled",true);$("select[name=payType]").attr("disabled",true);
$("select[name=soType]").attr("disabled",true);$("input[name=shippingAmount]").attr("readonly",true);$("input[name=subAmount]").attr("readonly",true);$("input[name=totalAmount]").attr("readonly",true);
$("input[name=waitPayAmount]").attr("readonly",true);$("#selectEmpBtn").hide();$(".soProfitPercent").attr("readonly",true);$(".delSoProfit").hide();$("select[name=isFast]").attr("disabled",true);
$("select[name=billType]").attr("disabled",true);$("input[name=billAmount]").attr("readonly",true);$("textarea[name=billTitle]").attr("readonly",true);
$("textarea[name=billContent]").attr("readonly",true);$("textarea[name=comment]").attr("readonly",true);$("select[name=account]").attr("disabled",true);
$("input[name=shipFollow]").attr("readonly",true);$(".othersDiv").find("#delayConfirmTime").attr("readonly",true);$(".updateSoFollow").hide();if(a&&a.length>0){$(".uploadImage").hide();
$("#imageContainer").empty().append(ImageUtils.createImageDivStr(a,null,true,true,true));var c=b.buildImages(a);$(".downLoadFile").find("img").ImageEnlarge({isNotShowImage:true,imageGroup:c});
}if($("input[name=status]").val()!="shipping"&&$("input[name=status]").val()!="close_lost"){$(".uploadImage").hide();}if($("select[name=cashType]").val()=="cod"||$("select[name=cashType]").val()=="free"||$("select[name=cashType]").val()=="point"){$(".financeAttachDiv").hide();
}ConfigUtils.findByKey("soEntity.isReceivePhone",function(d){if(d.success){$("#receivePhoneDiv").show();$("input[name=tranPhone]").attr("readonly",true);
$("input[name=recPhone]").attr("readonly",true);}else{$("#receivePhoneDiv").hide();}});$(".cashSettingDiv").hide();if($("input[name=cashCode]").val()){$(".cashSettingInfoDiv").show();
}},buildImages:function(b){var a=[];for(var c=0;c<b.length;c++){var d={href:ctx+b[c].path,title:(c+1)+" / "+b.length};a.push(d);}return a;}};SoEntityUtils._CONS_={LIST_URL:ctx+"/ec/salesorder/soEntity/listData.htm",DETAIL_PAGE_URL:ctx+"/ec/salesorder/soEntity/detail.htm",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detail.htm",SO_TO_COMFIRM_URL:ctx+"/ec/salesorder/soEntity/toComfirm.htm",SO_TO_DELIVER_URL:ctx+"/ec/salesorder/soEntity/toDeliver.htm",BACK_DELIVER_URL:ctx+"/ec/salesorder/soEntity/backDeliver.htm",COMFIRM_BATCH_URL:ctx+"/ec/salesorder/soEntity/comfirm.htm",TURN_DOWN_URL:ctx+"/ec/salesorder/soEntity/turndown.htm",DELETE_URL:ctx+"/ec/salesorder/soEntity/delete.htm",CLOSE_URL:ctx+"/ec/salesorder/soEntity/close.htm",LOCK_URL:ctx+"/ec/salesorder/soEntity/lockSo.htm",UNLOCK_URL:ctx+"/ec/salesorder/soEntity/unLockSo.htm",SO_PLACE_URL:ctx+"/ec/salesorder/soEntity/place.htm",FOLLOW_PAGE:ctx+"/ec/salesorder/soEntity/toFollow.htm",EXCHANGEORBACK_URL:ctx+"/ec/salesorder/soEntity/exchange.htm",BATCHRECEIVED_URL:ctx+"/ec/salesorder/soEntity/batchReceived.htm",BACKRECEIVED_URL:ctx+"/ec/salesorder/soEntity/backReceived.htm",STOCK_MANY_URL:ctx+"/ec/salesorder/soEntity/stockForMany.htm",BACK_COMPLETE_URL:ctx+"/ec/salesorder/soEntity/backComplete.htm",REVISIT_PAGE_URL:ctx+"/ec/salesorder/soEntity/toRevisit.htm",IMPORT_EXCEL_URL:ctx+"/ec/salesorder/soEntity/importSoStatus.htm",FOLLOW:function(a,b){window.localStorage.setItem("follow_so_ids_"+currentUserId,a.toString());
window.localStorage.setItem("follow_so_nos_"+currentUserId,b.toString());JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.FOLLOW_PAGE+"?soId="+a[0]+"&soNo="+b[0],"订单["+b[0]+"]跟进");
}};var StoreUtils={loadStores:function(f,a,e,c){var b=this;var d={selectedStore:f,container:a,isSale:e,notShowStore:c};b.loadData(d);},loadData:function(e){var b=this;
var a=ctx+"/ec/stock/stStore/listStores.htm";var d=e.isSale;if(d){a+="?isSale=y";}var c=window.sessionStorage.getItem("loacalstores"+(d?"isSale":""));if(c&&c!=null&&c!=""){b._apendData(e,JSON.parse(c));
}else{FormUtils.loadData(a,function(f){window.sessionStorage.setItem("loacalstores"+(d?"isSale":""),JSON.stringify(f));b._apendData(e,f);});}},_apendData:function(d,j){var k=d.callBackFunc?d.callBackFunc:null;
var f=d.selectedStore?d.selectedStore:null;var a=d.container;var g=d.notShowStore?d.notShowStore:null;var b=isManyStore?isManyStore:"y";var h=new StringBuffer();
if(b=="y"){h.append("<option value=''>请选择仓库</option>");}for(var e=0;e<j.length;e++){if(g&&j[e].id==g){continue;}if(b=="n"){if(j[e].isDefault=="y"){h.append("<option selected='selected' value='"+j[e].id+"'>"+j[e].name+"</option>");
}}else{if(j[e].id==f){h.append("<option selected='selected' value='"+j[e].id+"'>"+j[e].name+"</option>");}else{h.append("<option value='"+j[e].id+"'>"+j[e].name+"</option>");
}}}var c=$("#"+a);if(!c.length){c=$("."+a);}c.empty().append(h.toString());if(b=="n"){c.trigger("change");}if(k&&typeof(k)=="function"){k(j);}},loadSimpleStores:function(a){return StoreUtils.loadStores("",a.container);
}};var MaskPhoneNum={getMaskPhoneNum:function(a){if(a){if(a.length>=11){return a.substring(0,3)+"******"+a.substring(9,a.length);}else{if(a.length>6&&a.length<11){return a.substring(0,1)+"******"+a.substring(7,a.length);
}else{if(a.length>3&&a.length<=6){return a.substring(0,1)+"***"+a.substring(4,a.length);}}}}return"";},maskEmail:function(a){var c=new StringBuffer();if(a){var b=a.indexOf("@");
if(b>2){c.append(a.substring(0,b-2)).append("**").append(a.substring(b));}else{if(b>=1){c.append(a.substring(0,b-1)).append("*").append(a.substring(b));
}}}return c.toString();},maskAddr:function(b){var a=new StringBuffer();if(b){if(b.length>25){b=b.replace(b.substring(7,15),"*****");}else{if(10<b.length<=25){b=b.replace(b.substring(6,13),"*****");
}else{if(0<b.length<=10){b=b.replace(b.substring(5,6),"****");}}}}return b;},maskDesc:function(a){if(a){a=a.replace(" ","");a=a.trim().replaceAll("\\d{11}","***********");
}return a;}};var ShipCompanyUtils={getOptions:function(c){var b=this;var a=window.sessionStorage.getItem("loacalShipCompany");if(a&&a!=null&&a!=""){b._appendData(c,JSON.parse(a));
}else{FormUtils.loadData(ctx+"/ec/ship/shipCompany/allActiveCompany.htm",function(d){window.sessionStorage.setItem("loacalShipCompany",JSON.stringify(d));
b._appendData(c,d);});}},_appendData:function(c,a){var f;if(c.container){f=$("#"+c.container);if(f.length==0){f=$("select."+c.container);if(f.length==0){f=$("select[name='"+c.container+"']");
if(f.length==0){return false;}}}}var g=new StringBuffer();if(c.caption){g.append("<option value=''>").append(c.caption).append("</option>");}if(a&&a.length>0){if(c.fn){c.fn(a);
}else{var g=new StringBuffer();if(c.caption){g.append("<option value=''>").append(c.caption).append("</option>");}for(var d=0;d<a.length;d++){var e=a[d].id;
var b=a[d].name;if(c.selectedOption&&c.selectedOption==e){g.append("<option value='").append(e).append("' hotVar='").append(a[d].isHot).append("' selected='selected'>").append(b).append("</option>");
}else{g.append("<option value='").append(e).append("' hotVar='").append(a[d].isHot).append("'>").append(b).append("</option>");}}f.empty().append(g.toString());
}}if(c.callBack&&typeof c.callBack=="function"){c.callBack();}}};var GroupUtils={loadGroupOptions:function(a){a.url=ctx+"/gl/ou/group/listData.htm";if(!a.positionType){a.url=a.url+"?type=dept_manager";
}a.key="id";a.keyName="name";a.caption="请选择部门";return OptionsBaseUtils.getOptions(a);},selectGroupTreeBox:function(a){var b={selectedIds:jQuery.isArray(a.selectedGroupId)?a.selectedGroupId.toString():a.selectedGroupId,container:a.container,treeId:"menuContentForGroup"+a.container.split(" ")[0],isMultiple:a.isMultiple,otherParam:{selectedGroupId:a.selectedGroupId},url:ctx+"/gl/ou/group/listData.htm",fn:a.fn,isSale:a.isSale,positionType:a.positionType,hideSale:a.hideSale?a.hideSale:false,isSmsConfigHtml:a.isSmsConfigHtml,isReDisabled:a.isReDisabled?a.isReDisabled:false};
if(a.isEqWidth){b.isEqWidth=true;}if(a.isAutoHeight){b.isAutoHeight=true;}if(!b.positionType){b.url=b.url+"?type=dept_manager";}else{b.url=b.url+"?type="+b.positionType;
}if(a.isSale){b.url=b.url+"?type="+b.positionType+"&isSale=y";}if(a.agentId){b.url=b.url+"&agentId="+a.agentId;}b.dataFilter=function(f,c,g){if(g&&g.length){for(var e=0;
e<g.length;e++){var d=g[e];if(d.isSale=="y"&&!b.hideSale){d.name=d.name+"【销】";d.font={"color":"red"};}}}if(a.dataFilter){return a.dataFilter(f,c,g);}else{return g;
}};CateUtils.selectTreeBox(b);},selectGroup:function(c){var e=c.selectedGroupId?c.selectedGroupId:"";var d=c.hasOwnProperty("isMultiple")&&c.isMultiple;
var a=this;var b=ctx+"/gl/ou/group/listData.htm";if(!c.positionType){b+="?type=dept_manager";}if(jQuery.isArray(e)){e=e.toString();}layer.open({type:1,title:"选择部门",shadeClose:false,btn:["确定","关闭"],area:["70%","70%"],scrollbar:false,maxmin:false,content:'<ul id="organizationSelTree" class="ztree" style="width:260px; overflow:auto;"></ul>',success:function(f,i){var g=this;
var j={async:{enable:true,url:b,contentType:"application/json",dataType:"json",type:"get",autoParam:["id"],otherParam:{selectedGroupId:e},dataFilter:function(n,k,o){if(o&&o.length){for(var m=0;
m<o.length;m++){var l=o[m];if(l.isSale=="y"){l.name=l.name+"【销】";l.font={"color":"red"};}}}return o;},},data:{simpleData:{enable:true,idKey:"id",pIdKey:"parentId"}},check:{enable:true,chkStyle:d?"checkbox":"radio",chkboxType:{"Y":"s","N":"s"},radioType:"all"},callback:{onClick:function h(l,o,n){var m=n.getCheckStatus().checked;
var k=$.fn.zTree.getZTreeObj("organizationSelTree");k.checkNode(n,!m,false);},onAsyncSuccess:function(m,o,n,p){var l=$.fn.zTree.getZTreeObj("organizationSelTree");
if(!n){var k=l.getNodes()[0];l.expandNode(k,true,false,true);}}}};$.fn.zTree.init($("#organizationSelTree"),j);},yes:function(j,g){var h=$.fn.zTree.getZTreeObj("organizationSelTree");
var f=h.getCheckedNodes(true);var l=[];for(var k=0;k<f.length;k++){var m={id:f[k].id,name:f[k].name};l.push(m);}if(c.fn){c.fn(l);}layer.close(j);}});}};
var SelectProdService={selectSku:function(o){var n=o&&o.storeId;var f=o.isMultiple;var k=o.type;var m=o.hasStock;var e=o.canSale;var b=o.hideCanSale;var j=o.isSale;
var d=o.limitProdCate;var i=o.priceType;var h=o.userId;var l=o.showNotOnSale;var g=o.filterSeries;var c=o.agentId;if(!m){m="n";}if(!k){k="product";}if(!n){n="";
}if(!b){b="n";}if(!d){d="n";}if(!j){j="n";}if(!i){i="";}if(!e){e="n";}if(!l){l="n";}if(!c){c="";}var a=ctx+"/ec/product/prodEntity/selectSku.htm?";a+="storeId="+n;
a+="&isMultiple="+f;a+="&type="+k;a+="&hasStock="+m;a+="&hideCanSale="+b;a+="&limitProdCate="+d;a+="&priceType="+i;a+="&canSale="+e;a+="&isSale="+j;a+="&userId="+h;
a+="&showNotOnSale="+l;a+="&filterSeries="+g;a+="&agentId="+c;layer.open({type:2,title:"选择商品",maxmin:true,shadeClose:true,btn:["确定","取消"],area:["95%","95%"],scrollbar:false,maxmin:false,content:a,yes:function(q,p){var s=layer.getChildFrame("body",q);
var r=$("#selectedRowData",s).val();if(r&&r.length){layer.close(q);if(o.fn){o.fn(JSON.parse(r));}}else{DialogUtils.error("警告","请选择商品！或者点击取消",s);}},end:function(){if(o.end){o.end();
}}});},selectProd:function(a){var b=a.isMultiple;layer.open({type:2,title:"选择商品",shadeClose:true,btn:["确定","取消"],area:["80%","80%"],scrollbar:false,content:ctx+"/ec/product/prodEntity/selectProd.htm?isMultiple="+b,yes:function(e,c){var j=layer.getChildFrame("body",e);
var d=$("#prodEntityGrid",j).jqGrid("getGridParam","selarrrow");if(d){var h=[];for(var f=0;f<d.length;f++){var g=$("#prodEntityGrid",j).jqGrid("getRowData",d[f]);
g.prodId=d[f];g.prodName=g.name;h.push(g);}layer.close(e);if(a.fn){a.fn(h);}}}});}};var ChannelUtils={getOptions:function(b){var a=this;var c=window.sessionStorage.getItem("loacalChannel");
if(c&&c!=null&&c!=""){a._apendData(b,JSON.parse(c));}else{FormUtils.loadData(ctx+"/ec/media/mediaChannel/findActived.htm",function(d){window.sessionStorage.setItem("loacalChannel",JSON.stringify(d));
a._apendData(b,d);var e=a.getContainer(b);if(e&&e.is(".selectpicker")){e.selectpicker("refresh");}});}},_apendData:function(a,c){var d=this.getContainer(a);
if(!d){return false;}var e=new StringBuffer();if(a.type=="noChannelId"){e.append("<option value='' style='color:red;'>").append("无渠道").append("</option>");
}if(a.caption){e.append("<option value=''>").append(a.caption).append("</option>");}if(a.emptyOptions){e.append("<option value='"+a.emptyOptions+"' style='color:red;'>").append("无渠道").append("</option>");
}if(c&&c.length>0){for(var b=0;b<c.length;b++){e.append("<option value='"+c[b].id+"'>"+c[b].name+"</option>");}d.empty().append(e.toString());}},getContainer:function(a){var b=false;
if(a.container){b=$("#"+a.container);if(b.length==0){b=$("select."+a.container);if(b.length==0){b=$("select[name='"+a.container+"']");if(b.length==0){return false;
}}}}return b;}};function ListUtil(a){if(!a){return false;}this.gridId=a.grid.attr("id");this.grid=a.grid;this.key=a.options.simplify.key?a.options.simplify.key:"configer";
if(typeof a.options.simplify!="object"){console.log("精简配置参数错误！");return false;}this.entry=a.options.simplify.entry?a.options.simplify.entry:null;this.base=a.options.simplify.base?a.options.simplify.base:null;
this.other=a.options.simplify.other?a.options.simplify.other:null;this.must=a.options.simplify.must?a.options.simplify.must:null;this.colModel=a.options.colModel;
this.colNames=a.options.colNames;this.current=null;}ListUtil._CONS_={GET_GRID_CONFIGER:ctx+"/gl/formText/findByKey.htm",SAVE_GRID_CONFIGER:ctx+"/gl/formText/updateByKey.htm",ADD_GRID_CONFIGER:ctx+"/gl/formText/saveAdd.htm"};
ListUtil.prototype={init:function(){this.loadBars();this._bindEventHandler();},loadBars:function(){var a=this;var b=a.grid.closest(".ui-jqgrid").find(".ui-jqgrid-titlebar");
if(b.find(".grid-lowpixel-bar").length==0){var c='<div class="grid-lowpixel-bar">精简&nbsp;<i class="fa fa-navicon"></i><div class="grid-extra-bar" data-id="#'+a.gridId+'">';
if(a.entry&&a.entry.length>0){$.each(a.entry,function(d,f){c+='<div><input type="checkbox" class="jt-middle-check '+this.sClass+'" '+(this.sCheck?"checked":"")+"/>"+this.sName+"</div>";
});}c+='<div><button type="button" class="jt-form-select '+a.gridId+'-grid-simplify"><i class="fa fa-cog"></i>&nbsp;编辑表头</button></div>';c+="</div>";b.append(c);
}if(b.is(":hidden")){b.show();}},getSysConfig:function(){var a=this;var c=null;$.ajax({type:"POST",url:ListUtil._CONS_.GET_GRID_CONFIGER+"?key="+(a.gridId+".grid."+a.key),async:false,dataType:"json",success:function(d){if(d.msg){c=d;
}}});if(c){var b=JSON.parse(c.msg);if(typeof b=="object"){a.current=b;a.configId=c.msgCode;}}},readConfig:function(){var a=this;var b=window.localStorage.getItem(a.gridId+".grid"+a.key);
if(b){a.current=b.split(",");}else{a.getSysConfig();}a.getCurrentParams();return a.current;},isHidden:function(b){var a=this;if(!a.current){return true;
}if($.inArray(b,a.current)!=-1){return false;}else{return true;}},getCurrentParams:function(){var c=this;var e=c.colModel;var g=c.colNames;var b=[];for(var f=0;
f<g.length;f++){if(e[f].hidden){continue;}var d=e[f].name,a=c.isHidden(d);b.push({"name":g[f],"key":d,"check":a});}c.vp=b;},getMutexParams:function(e,d){var a=this;
var f=[];for(var c=0;c<d.length;c++){for(var b=0;b<e.length;b++){if(e[b].key==d[c].key){break;}if(e.length==(b+1)){f.push(d[c]);}}}return f;},getHalfByName:function(a){var b=this;
var e=[];for(var d=0;d<a.length;d++){for(var c=0;c<b.vp.length;c++){if(b.vp[c].name==a[d]){e.push(b.vp[c]);break;}if(b.vp.length==(c+1)){console.log("无法识别的字段： "+a[d]);
}}}return e;},examConfig:function(){var b=this;var h=[];var a=[];var f=[];var g=[];var e={};if(b.must&&b.must.length>0){for(var c=0;c<b.vp.length;c++){if($.inArray(b.vp[c].name,b.must)==-1){h.push(b.vp[c]);
}else{a.push(b.vp[c]);}}e.must=a;}else{h=b.vp;}if(!b.base&&!b.other){e.all=h;}else{if(b.base&&b.other){if(b.base.length==0&&b.other.length==0){e.all=h;
}else{if(b.base.length>0&&b.other.length==0){e.base=b.getHalfByName(b.base);e.other=b.getMutexParams(e.base,h);}else{if(b.base.length==0&&b.other.length>0){e.other=b.getHalfByName(b.other);
e.base=b.getMutexParams(e.other,h);}else{if(b.base.length>0&&b.other.length>0){e.base=b.getHalfByName(b.base);if(b.must&&b.must.length>0){e.other=b.getMutexParams(e.base,h);
}else{e.other=b.getHalfByName(b.other);var d=b.getMutexParams(e.base,h);d=b.getMutexParams(e.other,d);if(d.length>0){e.must=d;}}}else{if(!b.base||!b.other){if(b.base&&!b.other){if(b.base.length==0){e.all=h;
}else{e.base=b.getHalfByName(b.base);e.other=b.getMutexParams(e.base,h);}}else{if(!b.base&&b.other){if(b.other.length==0){e.all=h;}else{e.other=b.getHalfByName(b.other);
e.base=b.getMutexParams(e.other,h);}}}}}}}}}}return e;},initContent:function(){var a=this;var c=a.examConfig();var b="<div class='grid-config-layer "+a.gridId+"-config-layer'>";
if(c.must){b+=a.getSortItems(c.must,"固有字段",true);}if(c.all){b+=a.getSortItems(c.all,"其他字段");}else{b+=a.getSortItems(c.base,"常用字段");b+=a.getSortItems(c.other,"其他字段");
}b+="</div>";return b;},getSortItems:function(a,h,d){var c=this;var f="";var g="";var e="";var b=true;if(h=="常用字段"){g="jt-gc-item jt-sort-base";}if(h=="其他字段"){g="jt-gc-item jt-sort-other";
}if(a.length>0){$.each(a,function(j,k){f+="<div class='col-sm-3'><input type='checkbox' "+(d?"disabled":"")+" class='jt-gc-check "+g+"' value='"+this.key+"' "+(this.check?"checked":"")+">"+this.name+"</div>";
if(!this.check&&b){b=false;}});}else{return"";}if(h=="常用字段"){e="<input type='checkbox' class='jt-gc-check jt-allcheck-base' "+(b?"checked":"")+">";}if(h=="其他字段"){e="<input type='checkbox' class='jt-gc-check jt-allcheck-other' "+(b?"checked":"")+">";
}if(h){f="<div class='col-sm-12 grid-config-title'>"+e+h+"</div>"+f;}return f;},_bindEventHandler:function(){var a=this;$(document).on("click","."+a.gridId+"-grid-simplify",function(b){if(!a.layerIndex){a.initLayer();
}});$(document).on("click",".jt-allcheck-base",function(b){if($(this).is(":checked")){$(this).closest(".grid-config-layer").find(".jt-sort-base").prop("checked",true);
}else{$(this).closest(".grid-config-layer").find(".jt-sort-base").removeAttr("checked");}});$(document).on("click",".jt-allcheck-other",function(b){if($(this).is(":checked")){$(this).closest(".grid-config-layer").find(".jt-sort-other").prop("checked",true);
}else{$(this).closest(".grid-config-layer").find(".jt-sort-other").removeAttr("checked");}});$(document).on("click",".jt-gc-item",function(d){if($(this).is(":checked")){if($(this).is(".jt-sort-base")){if($(".jt-sort-base:not(:checked)").length==0){$(this).closest(".grid-config-layer").find(".jt-allcheck-base").prop("checked",true);
}}else{if($(this).is(".jt-sort-other")){if($(".jt-sort-other:not(:checked)").length==0){$(this).closest(".grid-config-layer").find(".jt-allcheck-other").prop("checked",true);
}}}}else{if($(this).is(".jt-sort-base")){var c=$(this).closest(".grid-config-layer").find(".jt-allcheck-base");if(c.is(":checked")){c.removeAttr("checked");
}}else{if($(this).is(".jt-sort-other")){var b=$(this).closest(".grid-config-layer").find(".jt-allcheck-other");if(b.is(":checked")){b.removeAttr("checked");
}}}}});},getCurrentConfig:function(){var a=this;var b=[];$("."+a.gridId+"-config-layer").find(".jt-gc-item").each(function(c,d){if(!$(this).is(":checked")){b.push($(this).val());
}});return b;},saveLocalConfig:function(){var a=this;var b=a.getCurrentConfig();window.localStorage.setItem(a.gridId+".grid."+a.key,b);a.current=b;a.doCinfiger();
},saveSysConfig:function(){var a=this;var d=a.getCurrentConfig();var b=ListUtil._CONS_.ADD_GRID_CONFIGER;var c={key:(a.gridId+".grid."+a.key),content:JSON.stringify(d)};
if(a.configId){b=ListUtil._CONS_.SAVE_GRID_CONFIGER;c.id=a.configId;}FormUtils.submit(b,c,function(e){if(e.success){window.localStorage.removeItem(a.gridId+".grid."+a.key);
a.current=d;a.doCinfiger();if(!a.configId){a.configId=e.msgCode;}DialogUtils.success("提示","配置已保存！");}});},doCinfiger:function(){var b=this;var a=b.grid.closest(".ui-jqgrid ").width();
for(var c=0;c<b.vp.length;c++){if($.inArray(b.vp[c].key,b.current)!=-1){if(b.vp[c].check){b.grid.setGridParam().hideCol(b.vp[c].key);b.vp[c].check=false;
}}else{if(!b.vp[c].check){b.grid.setGridParam().showCol(b.vp[c].key);b.vp[c].check=true;}}}b.grid.setGridWidth(a);},initLayer:function(a){var b=this;b.layerIndex=layer.open({type:1,title:"编辑表头",shade:false,btn:["保存","取消","保存为全局"],offset:"10%",area:["700px","auto"],content:b.initContent(),scrollbar:false,skin:"jt-grid-configer",moveOut:true,success:function(c,d){b.layerIndex=null;
},yes:function(d,c){b.saveLocalConfig();layer.close(b.layerIndex);b.layerIndex=null;},btn2:function(d,c){b.layerIndex=null;},btn3:function(d,c){b.saveSysConfig();
b.layerIndex=null;},cancel:function(){b.layerIndex=null;}});},inits:function(){var a=this;$(document).on("click",".jt-grid-simplify",function(){var d=$(this).closest(".grid-extra-bar").attr("data-id");
var e=$(d).jqGrid("getGridParam","colModel");var i=$(d).jqGrid("getGridParam","colNames");var c=$(d).jqGrid("getGridParam","postData");var b=["关闭"];var h=false;
var g=false;if("#performanceForEmpReportGrid"==d||"#profitForGroupReportGrid"==d){h=true;}else{if("#csEntityGrid"==d){if(ResUtils.canShow("csEntity.editTblHead.button")){h=true;
if(ResUtils.canShow("csEntity.defaultTblHead.button")){g=true;}}else{if(ResUtils.canShow("csEntity.defaultTblHead.button")){g=true;}}}else{if(ResUtils.canShow("soEntity.button.editTblHead")){h=true;
if(ResUtils.canShow("soEntity.button.defaluTblHead")){g=true;}}else{if(ResUtils.canShow("soEntity.button.defaluTblHead")){g=true;}}}}if(h){var f="demo-class";
b=["确定","关闭"];if(g){b=["保存","取消","保存为全局"];a.layerIndex=layer.open({type:1,title:"编辑表头",shade:false,btn:b,area:["51%","53%"],content:$(".listTitleEditDiv"),scrollbar:false,skin:f,success:function(r,q){var m=window.localStorage.getItem(d+"defaultHideItems");
var p=new Array();if(m!=null){p=m.split(",");}var o="";var k="";$("#layListTitle").empty();for(var n=2;n<e.length;n++){if(p.indexOf(e[n].name)==-1){var t='<div class="col-sm-3">'+'<div class="checkbox checkbox-success checkbox-inline">'+'<input type="checkbox" class="columnCheckBox" name="listTitleCheck" value="'+e[n].name+'">'+'<label for="648c21b860f84870822946ac25f06f08">'+i[n]+"</label>"+"</div>"+"</div>";
if(e[n].isBase){k+=t;}else{o+=t;}}}if(k){o="<div class='basic-items-title'>常用字段</div>"+k+"<div  class='other-items-title'>其他字段</div>"+o;}$("#layListTitle").append(o);
var l=window.localStorage.getItem(d+"ShowItems");if(l!=null){var s=l.split(",");for(var n=0;n<s.length;n++){$("input[name='listTitleCheck'][value='"+s[n]+"']").prop("checked",true);
}}else{var j=ctx+"/ec/salesorder/soEntity/getDefaultTblHead.htm";if("#csEntityGrid"==d){j=ctx+"/crm/cs/csEntity/getDefaultTblHead.htm";}FormUtils.loadData(j+"?gridId="+d,function(v){if(v&&v.length>0){for(var u=0;
u<v.length;u++){$("input[name='listTitleCheck'][value='"+v[u]+"']").prop("checked",true);}}else{$("input[name='listTitleCheck']").prop("checked",true);
}});}},yes:function(l,k){var n=new Array();var j=new Array();window.localStorage.removeItem(d+"HideItems");window.localStorage.removeItem(d+"ShowItems");
$("input:checkbox[name=listTitleCheck]:not(:checked)").each(function(){n.push($(this).val());});$("input:checkbox[name=listTitleCheck]:checked").each(function(){j.push($(this).val());
});window.localStorage.setItem(d+"HideItems",n);window.localStorage.setItem(d+"ShowItems",j);layer.close(a.layerIndex);var m=$(d).closest(".ui-jqgrid ").width();
$(n).each(function(o){$(d).setGridParam().hideCol(n[o]);});$(j).each(function(o){$(d).setGridParam().showCol(j[o]);});$(d).setGridWidth(m);},btn3:function(m,k){var j=new Array();
var n=new Array();$("input:checkbox[name=listTitleCheck]:checked").each(function(){j.push($(this).val());});$("input:checkbox[name=listTitleCheck]:not(:checked)").each(function(){n.push($(this).val());
});var l=ctx+"/ec/salesorder/soEntity/defaultTblHead.htm";if("#csEntityGrid"==d){l=ctx+"/crm/cs/csEntity/defaultTblHead.htm";}FormUtils.submit(l,{showData:j,hideData:n,gridId:d},function(o){if(o.success){DialogUtils.success("提示","设置成功");
layer.close(a.layerIndex);}else{DialogUtils.errer("错误","后台异常");}});},cancel:function(){layer.close(a.layerIndex);},on:function(k,j){layer.close(a.layerIndex);
}});}else{a.layerIndex=layer.open({type:1,title:"编辑表头",shade:false,btn:b,area:["51%","53%"],content:$(".listTitleEditDiv"),scrollbar:false,success:function(p,o){var l=window.localStorage.getItem(d+"defaultHideItems");
var n=new Array();if(l!=null){n=l.split(",");}var r='<div class="col-sm-3"><div class="checkbox checkbox-success checkbox-inline"><input type="checkbox" class="columnCheckBox" name="allCheck" value="0"><label for="allCheck">全选</label></div></div>';
$("#layListTitle").empty();for(var m=2;m<e.length;m++){if(n.indexOf(e[m].name)==-1){r+='<div class="col-sm-3">'+'<div class="checkbox checkbox-success checkbox-inline">'+'<input type="checkbox" class="columnCheckBox" name="listTitleCheck" value="'+e[m].name+'">'+'<label for="648c21b860f84870822946ac25f06f08">'+i[m]+"</label>"+"</div>"+"</div>";
}}$("#layListTitle").append(r);var k=window.localStorage.getItem(d+"ShowItems");if(k!=null){var q=k.split(",");for(var m=0;m<q.length;m++){$("input[name='listTitleCheck'][value='"+q[m]+"']").prop("checked",true);
}}else{var j=ctx+"/ec/salesorder/soEntity/getDefaultTblHead.htm";if("#csEntityGrid"==d){j=ctx+"/crm/cs/csEntity/getDefaultTblHead.htm";}FormUtils.loadData(j+"?gridId="+d,function(t){if(t&&t.length>0){for(var s=0;
s<t.length;s++){$("input[name='listTitleCheck'][value='"+t[s]+"']").prop("checked",true);}}else{$("input[name='listTitleCheck']").prop("checked",true);
}});}},yes:function(l,k){var n=new Array();var j=new Array();window.localStorage.removeItem(d+"HideItems");window.localStorage.removeItem(d+"ShowItems");
$("input:checkbox[name=listTitleCheck]:not(:checked)").each(function(){n.push($(this).val());});$("input:checkbox[name=listTitleCheck]:checked").each(function(){j.push($(this).val());
});window.localStorage.setItem(d+"HideItems",n);window.localStorage.setItem(d+"ShowItems",j);layer.close(a.layerIndex);var m=$(d).closest(".ui-jqgrid ").width();
$(n).each(function(o){$(d).setGridParam().hideCol(n[o]);});$(j).each(function(o){$(d).setGridParam().showCol(j[o]);});$(d).setGridWidth(m);},on:function(k,j){layer.close(a.layerIndex);
},cancel:function(){layer.close(a.layerIndex);}});}}else{if(g){b=["设置为客户列表默认","关闭"];a.layerIndex=layer.open({type:1,title:"编辑表头",shade:false,btn:b,area:["51%","53%"],content:$(".listTitleEditDiv"),scrollbar:false,success:function(p,o){var l=window.localStorage.getItem(d+"defaultHideItems");
var n=new Array();if(l!=null){n=l.split(",");}var r='<div class="col-sm-3"><div class="checkbox checkbox-success checkbox-inline"><input type="checkbox" class="columnCheckBox" name="allCheck" value="0"><label for="allCheck">全选</label></div></div>';
$("#layListTitle").empty();for(var m=2;m<e.length;m++){if(n.indexOf(e[m].name)==-1){r+='<div class="col-sm-3">'+'<div class="checkbox checkbox-success checkbox-inline">'+'<input type="checkbox" class="columnCheckBox" name="listTitleCheck" value="'+e[m].name+'">'+'<label for="648c21b860f84870822946ac25f06f08">'+i[m]+"</label>"+"</div>"+"</div>";
}}$("#layListTitle").append(r);var k=window.localStorage.getItem(d+"ShowItems");if(k!=null){var q=k.split(",");for(var m=0;m<q.length;m++){$("input[name='listTitleCheck'][value='"+q[m]+"']").prop("checked",true);
}}else{var j=ctx+"/ec/salesorder/soEntity/getDefaultTblHead.htm";if("#csEntityGrid"==d){j=ctx+"/crm/cs/csEntity/getDefaultTblHead.htm";}FormUtils.loadData(j+"?gridId="+d,function(t){if(t&&t.length>0){for(var s=0;
s<t.length;s++){$("input[name='listTitleCheck'][value='"+t[s]+"']").prop("checked",true);}}else{$("input[name='listTitleCheck']").prop("checked",true);
}});}},yes:function(m,k){var j=new Array();var n=new Array();$("input:checkbox[name=listTitleCheck]:checked").each(function(){j.push($(this).val());});
$("input:checkbox[name=listTitleCheck]:not(:checked)").each(function(){n.push($(this).val());});var l=ctx+"/ec/salesorder/soEntity/defaultTblHead.htm";
if("#csEntityGrid"==d){l=ctx+"/crm/cs/csEntity/defaultTblHead.htm";}FormUtils.submit(l,{showData:j,hideData:n,gridId:d},function(o){if(o.success){DialogUtils.success("提示","设置成功");
layer.close(a.layerIndex);}else{DialogUtils.errer("错误","后台异常");}});},on:function(k,j){layer.close(a.layerIndex);},cancel:function(){layer.close(a.layerIndex);
}});}else{a.layerIndex=layer.open({type:1,title:"编辑表头",shade:false,btn:b,area:["51%","53%"],content:$(".listTitleEditDiv"),scrollbar:false,success:function(p,o){var l=window.localStorage.getItem(d+"defaultHideItems");
var n=new Array();if(l!=null){n=l.split(",");}var r='<div class="col-sm-3"><div class="checkbox checkbox-success checkbox-inline"><input type="checkbox" class="columnCheckBox" name="allCheck" value="0"><label for="allCheck">全选</label></div></div>';
$("#layListTitle").empty();for(var m=2;m<e.length;m++){if(n.indexOf(e[m].name)==-1){r+='<div class="col-sm-3">'+'<div class="checkbox checkbox-success checkbox-inline">'+'<input type="checkbox" class="columnCheckBox" name="listTitleCheck" value="'+e[m].name+'">'+'<label for="648c21b860f84870822946ac25f06f08">'+i[m]+"</label>"+"</div>"+"</div>";
}}$("#layListTitle").append(r);var k=window.localStorage.getItem(d+"ShowItems");if(k!=null){var q=k.split(",");for(var m=0;m<q.length;m++){$("input[name='listTitleCheck'][value='"+q[m]+"']").prop("checked",true);
}}else{var j=ctx+"/ec/salesorder/soEntity/getDefaultTblHead.htm";if("#csEntityGrid"==d){j=ctx+"/crm/cs/csEntity/getDefaultTblHead.htm";}FormUtils.loadData(j+"?gridId="+d,function(t){if(t&&t.length>0){for(var s=0;
s<t.length;s++){$("input[name='listTitleCheck'][value='"+t[s]+"']").prop("checked",true);}}else{$("input[name='listTitleCheck']").prop("checked",true);
}});}},on:function(k,j){layer.close(a.layerIndex);},cancel:function(){layer.close(a.layerIndex);}});}}});}};function SoEntity(a){this.grid="#"+a.grid;this.pager="#"+a.pager;
this.hasInitJqgrid=false;this.getManagerBtns=a.getManagerBtns?a.getManagerBtns:function(){return[];};this.status=a.status;this.otherParam=a.otherParam;
this.bindEventHandler=a.bindEventHandler?a.bindEventHandler:function(){};this.tabContainer="#"+a.tabContainer;this.bizType=a.bizType?a.bizType:"";this.canShowScTrankNo=a.canShowScTrankNo;
this.simpleShowLastFollow=a.simpleShowLastFollow,this.simpleShowComment=a.simpleShowComment,this.simpleShowProduct=a.simpleShowProduct,this.simpleShowProductSum=(simpleShowProductSum=="n"?false:true);
this.isUseReturnBack=(isUseReturnBack=="n"?false:true);this.showOriginSo=a.showOriginSo;this.isInbound=a.isInbound,this.isReceived=a.isReceived,this.soTypeCatePos=null;
this.isInit=false;this.isSearch=false;this.allBaseType=a.allBaseType;}SoEntity._CONS_={};SoEntity.prototype={init:function(){if(!this.isInit){this.isInit=true;
this._initData();this._initJqgrid();this._bindEventHandler();this._locateToGlHelp();}},_locateToGlHelp:function(){var a=this;if(a.bizType=="placer"){if(a.pager=="#soEntityMgrPager"){var b="glHelp.soEntity.selectOrder";
}else{var b="glHelp.soEntity.mySoEntity";}}else{if(a.bizType=="belong"){var b="glHelp.soEntity.soFollow";}else{if(a.bizType=="revisit"){var b="glHelp.soEntity.soRevisit";
}else{if(a.bizType=="after"){var b="glHelp.soEntity.soReject";}else{var b="lHelp.soEntity.soAudit";}}}}glHelpUtil.init(b);},_initData:function(){CateUtils.findCatePos({typeKey:"soEntity",pKey:"soType",fn:function(a){soTypeCatePos=a;
},});},_bilidSoStatusSearch:function(d,a,b){var c=new StringBuffer();$(a.tabContainer).find(".soStatusSearch option:selected").each(function(e){c.append($(this).val());
if(e==b-1){return false;}else{c.append(",");}});d=d+"&soStatusSearch="+c.toString();return d;},_bilidScCodeQrySearch:function(c,a,b){var d=new StringBuffer();
$(a.tabContainer).find(".scCodeQry option:selected").each(function(e){d.append($(this).val());if(e==b-1){return false;}else{d.append(",");}});c=c+"&scCodeQry="+d.toString();
return c;},_bilidSrcQrySearch:function(d,b,c){var a=new StringBuffer();$(b.tabContainer).find(".srcQry option:selected").each(function(e){a.append($(this).val());
if(e==c-1){return false;}else{a.append(",");}});d=d+"&srcQry="+a.toString();return d;},_bilidCashTypeSearch:function(d,a,c){var b=new StringBuffer();$(a.tabContainer).find(".cashType option:selected").each(function(e){b.append($(this).val());
if(e==c-1){return false;}else{b.append(",");}});d=d+"&cashType="+b.toString();return d;},_bilidPayTypeSearch:function(d,a,c){var b=new StringBuffer();$(a.tabContainer).find(".payType option:selected").each(function(e){b.append($(this).val());
if(e==c-1){return false;}else{b.append(",");}});d=d+"&payType="+b.toString();return d;},_fillBackExchangeOrderInfo:function(a,c,b){var d={csId:a,employeeId:c,csType:type,permissionType:b,showThirdSoNo:showThirdSoNo};
this.csOrder.init(d);},_bindEventHandler:function(){var a=this;this.bindEventHandler();var b=new SoEntityRefreshTool();b.init({callBackFunc:function(){$("#tabSoReject").find(".soEntitySearch").click();
$(".soEntitySearchForm").find(".soEntitySearch").click();}});$(".soEntityReload").on("click",function(){$(this).parents(".tab-pane").find(".soEntitySearch").trigger("click");
});$(document).on("change",a.tabContainer+" #skuSearch",function(){var c=$(a.tabContainer).find("input[id=skuSearch]").val();if(c==""){$(a.tabContainer).find("input[id=skuSearch]").attr("skuId","");
}});$(document).on("change",a.tabContainer+" .lastFollow",function(){var c=$(this)[0].checked;if(c){a.simpleShowLastFollow=true;$(this).parents(".jqGrid_wrapper").find(".tooltip-follow").show();
$(this).parents(".jqGrid_wrapper").find(".lastFollow-detail").hide();window.localStorage.removeItem(a.grid.substring(1)+"Config");}else{a.simpleShowLastFollow=false;
$(this).parents(".jqGrid_wrapper").find(".tooltip-follow").hide();$(this).parents(".jqGrid_wrapper").find(".lastFollow-detail").show();window.localStorage.setItem(a.grid.substring(1)+"Config","n");
}});$(document).on("change",a.tabContainer+" .orderDesc",function(){var c=$(this)[0].checked;if(c){a.simpleShowComment=true;$(this).parents(".jqGrid_wrapper").find(".tooltip-comment").show();
$(this).parents(".jqGrid_wrapper").find(".comment-detail").hide();}else{a.simpleShowComment=false;$(this).parents(".jqGrid_wrapper").find(".tooltip-comment").hide();
$(this).parents(".jqGrid_wrapper").find(".comment-detail").show();}});$(document).on("change",a.tabContainer+" .productShow",function(){var c=$(this)[0].checked;
if(c){a.simpleShowProduct=true;$(this).parents(".jqGrid_wrapper").find(".tooltip-product").show();$(this).parents(".jqGrid_wrapper").find(".product-detail").hide();
}else{a.simpleShowProduct=false;$(this).parents(".jqGrid_wrapper").find(".tooltip-product").hide();$(this).parents(".jqGrid_wrapper").find(".product-detail").show();
}});$(document).on("change",a.tabContainer+" .productShowSum",function(){var c=$(this)[0].checked;if(c){a.simpleShowProductSum=true;var d=$(a.grid).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow").hide();
$(window).resize();}else{a.simpleShowProductSum=false;var d=$(a.grid).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow").show();$(window).resize();
}});$(a.tabContainer).on("click",".soEntityDelete",function(){var c=$(a.grid).jqGrid("getGridParam","selarrrow");if(!c||c.length<=0){DialogUtils.error("提示","请选择要删除的订单");
return false;}SoEntityUtils.deleteSoEntity(c);});$(a.tabContainer).on("click",".exportSoEntityInfo",function(){var g=a._getParams()+"&"+$(a.tabContainer).find(".soEntitySearchForm").closest("form").serialize();
if($(a.tabContainer).find("input[name='skuKeyQry']").val()!=""&&$(a.tabContainer).find("input[name='skuKeyQry']").attr("skuId")!=""){g=g+"&skuId="+$(a.tabContainer).find("input[name='skuKeyQry']").attr("skuId");
}var i=$(a.tabContainer).find(".soStatusSearch option:selected").length;if(i!=0){g=a._bilidSoStatusSearch(g,a,i);}var f=$(a.tabContainer).find(".scCodeQry option:selected").length;
if(f!=0){g=a._bilidScCodeQrySearch(g,a,f);}var e=$(a.tabContainer).find(".srcQry option:selected").length;if(e!=0){g=a._bilidSrcQrySearch(g,a,e);}var k=$(a.tabContainer).find(".cashType option:selected").length;
if(k!=0){g=a._bilidCashTypeSearch(g,a,k);}var j=$(a.tabContainer).find(".payType option:selected").length;if(j!=0){g=a._bilidPayTypeSearch(g,a,j);}var d=$(a.grid).jqGrid("getGridParam","records");
var h=$(a.grid).jqGrid("getGridParam","selarrrow");var c=new SoEntityExport();c.init({params:g,selectIds:h,toatolCount:d});});$(a.tabContainer).on("click",".soEntitySearch",function(){if(!$(a.tabContainer).find("input[name='Q__D__BW__entity.place_time_']").val()&&!$(a.tabContainer).find("input[name='Q__D__BW__entity.confirm_time_']").val()&&!$(a.tabContainer).find("input[name='Q__D__BW__entity.ship_time_']").val()&&!$(a.tabContainer).find("input[name='Q__D__BW__entity.complete_time_']").val()&&!$(a.tabContainer).find("input[name='Q__D__BW__entity.reject_time_']").val()&&!$(a.tabContainer).find("input[name='csCreateBeginTimeQry']").val()&&!$(a.tabContainer).find("input[name='Q__D__BW__entity.received_time_']").val()&&!$(a.tabContainer).find("input[name='Q__D__BW__entity.inbound_time_']").val()&&!$(a.tabContainer).find("input[name='Q__D__BW__entity.close_time_']").val()){DialogUtils.error("错误","请填写开始时间");
return;}var h=$(this).closest("form").serialize();if($(a.tabContainer).find("input[name='skuKeyQry']").val()!=""&&$(a.tabContainer).find("input[name='skuKeyQry']").attr("skuId")!=""){h=h+"&skuId="+$(a.tabContainer).find("input[name='skuKeyQry']").attr("skuId");
}var d=$(a.tabContainer).find(".soStatusSearch option:selected").length;if(d!=0){h=a._bilidSoStatusSearch(h,a,d);}var c=$(a.tabContainer).find(".scCodeQry option:selected").length;
if(c!=0){h=a._bilidScCodeQrySearch(h,a,c);}var e=$(a.tabContainer).find(".srcQry option:selected").length;if(e!=0){h=a._bilidSrcQrySearch(h,a,e);}var g=$(a.tabContainer).find(".cashType option:selected").length;
if(g!=0){h=a._bilidCashTypeSearch(h,a,g);}var f=$(a.tabContainer).find(".payType option:selected").length;if(f!=0){h=a._bilidPayTypeSearch(h,a,f);}a.reloadJqgrid(h);
});$(a.tabContainer).on("click",".soEntityClearSearch",function(){$(a.tabContainer).find("input[id=soNoSearch]").val("");$(a.tabContainer).find("input[name=skuKeyQry]").val("");
$(a.tabContainer).find("input[name=skuKeyQry]").attr("skuId","");$(a.tabContainer).find("select[name='belongEmployee']").val("").select2();FormUtils.clear($(a.tabContainer).find("form"));
$(a.tabContainer).find(".search-choice").remove();});$(a.tabContainer).on("keypress","form",function(c){if(c.keyCode=="13"){$(a.tabContainer).find(".soEntitySearch").click();
}});$(a.tabContainer).on("click",".showSearch",function(){$(this).closest("form").find(".hideSearchParam").show();$(this).closest("form").find(".hideSearch").show();
$(this).hide();$(this).closest("form").find(".chosen-select").chosen("destroy").chosen();if($("#soCompleteTabLi").hasClass("active")){$("#csPhoneDiv").show();
}else{$("#csPhoneDiv").hide();}});$(a.tabContainer).on("click",".hideSearch",function(){$(this).closest("form").find(".hideSearchParam").hide();$(this).closest("form").find(".showSearch").show();
$(this).hide();});$(a.tabContainer).on("click",".soTab",function(){var s=$(this).attr("csNameVal");var g=$(this).attr("value");var d=$(this).attr("idVal");
var r=$(this).attr("soType");var j=$(this).attr("cashType");var f=$(this).attr("isDetail");var m=$(this).attr("status");var e=(a.canModifyProfit&&m!="complete"&&m!="close_lost"&&m!="close_reject"&&m!="close")?"can":"cannot";
var h=(a.canShowScTrankNo)?a.canShowScTrankNo:"";if(("#soEntitySubmitGrid"==a.grid||m=="awaiting_post")&&ResUtils.canShow("soEntitySubmit.url")){SoEntityUtils.submit(d,g,r);
}else{if(("#soEntityComfirmGrid"==a.grid||m=="awaiting_comfirm")&&ResUtils.canShow("soEntityComfirm.url")){var k=[];var c=$(a.grid).getRowData();var q=false;
if(c&&c.length>0){for(var o=0;o<c.length;o++){if(c[o].id==d){q=true;}if(q){k.push(c[o].id);}}}SoEntityUtils.confirm(k,g,r);}else{if(("#soEntityShippedGrid"==a.grid||m=="shipping")&&ResUtils.canShow("soEntity.url")){var k=[];
var l=[];var c=$(a.grid).getRowData();var q=false;if(c&&c.length>0){for(var o=0;o<c.length;o++){if(c[o].id==d){q=true;}if(q){k.push(c[o].id);l.push(c[o].soNo);
}}}window.localStorage.setItem("follow_so_ids_"+currentUserId,k.toString());window.localStorage.setItem("follow_so_nos_"+currentUserId,l.toString());JTTabUtils.addOrRefreshTab(ctx+"/ec/salesorder/soEntity/toFollow.htm"+"?soId="+k[0]+"&soNo="+l[0],"订单["+l[0]+"]跟进");
}else{if("#soEntityWaitRevisitGrid"==a.grid){JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.REVISIT_PAGE_URL+"?soId="+d,"【"+g+"】回访");}else{if("#soEntityRevisitedGrid"==a.grid&&ResUtils.canShow("soRevisit.button.modify")){JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.REVISIT_PAGE_URL+"?soId="+d,"【"+g+"】回访");
}else{if("comfirm"==m&&ResUtils.canShow("soEntityStock.url  ")){var p=[];var c=$(a.grid).getRowData();var q=false;if(c&&c.length>0){for(var o=0;o<c.length;
o++){if(c[o].id==d){q=true;}if(q){var n={id:c[o].id,soNo:c[o].soNo};p.push(n);}}}SoEntityUtils.toDeliver(p);}else{var l=[];var t=[];var c=$(a.grid).getRowData();
var q=false;if(c&&c.length>0){for(var o=0;o<c.length;o++){if(c[o].id==d){q=true;}if(q){l.push(c[o].soNo);t.push(c[o].csName);}}}window.localStorage.setItem("detail_so_soNos"+currentUserId,l.toString());
window.localStorage.setItem("detail_cs_names"+currentUserId,t.toString());window.localStorage.setItem("detail_canModifyProfit"+currentUserId,e);window.localStorage.setItem("detail_canShowScTrankNo"+currentUserId,h);
JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.DETAIL_PAGE_URL+"?soNo="+g+"&canModifyProfit="+e+"&canShowScTrankNo="+a.canShowScTrankNo,g+"的订单明细");}}}}}}});
$(a.tabContainer).on("click",".csTab",function(){var d=$(this).text();var c=$(this).attr("value");if(d.length>4){d="*"+d.substring(d.length-3,d.length);
}JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.DETAIL_CS_PAGE_URL+"?csId="+c,"客户["+d+"]明细");});$(a.tabContainer).on("click",".soFinanceBillTab",function(){if(ResUtils.canShow("soEntity.button.financeBillDetail")){var d=$(this).attr("noValue");
var c=$(this).attr("value");if(d.length>4){d="*"+d.substring(d.length-3,d.length);}JTTabUtils.addOrRefreshTab(ctx+"/ec/finance/financeBill/showList.htm"+"?soId="+c,"订单["+d+"]财务");
}});$(a.tabContainer).on("click",".skuSearchImg",function(){SelectProdService.selectSku({isMultiple:0,hideCanSale:"y",fn:function(c){for(var d=0;d<c.length;
d++){$(a.tabContainer).find("input[id=skuSearch]").val(c[d].skuCode);$(a.tabContainer).find("input[id=skuSearch]").attr("skuId",c[d].skuId);}}});});$(a.tabContainer).on("click",".soEntityClose",function(){var c=$(a.grid).jqGrid("getGridParam","selarrrow");
if(c==null||c.length==0){DialogUtils.error("错误","请选择要处理的订单");return;}var f=new Array();for(var d=0;d<c.length;d++){var e=$(a.grid).jqGrid("getRowData",c[d]);
f.push(e["soNo"]);}SoEntityUtils.closeOrderLayer(c,f);});$(a.tabContainer).on("click",".soEntityTrunDown",function(){var c=$(a.grid).jqGrid("getGridParam","selarrrow");
if(c==null||c.length==0){DialogUtils.error("错误","请选择要处理的订单");return;}var f=new Array();for(var d=0;d<c.length;d++){var e=$(a.grid).jqGrid("getRowData",c[d]);
f.push(e["soNo"]);}SoEntityUtils.trunDownOrderLayer(c,f);});$(a.tabContainer).on("click",".soEntityBackComplete",function(){var c=$(a.grid).jqGrid("getGridParam","selarrrow");
if(c==null||c.length==0){DialogUtils.error("错误","请选择要处理的订单");return;}DialogUtils.confirmWithOptions({title:"确定撤销发货结果吗？",text:"",confirmButtonText:"确认",yesFunc:function(){a._backComplete(c);
}});});$(a.tabContainer).on("click",".deliverBack",function(){var d=$(a.grid).jqGrid("getGridParam","selarrrow");if(d.length>1){DialogUtils.error("错误","不能同时驳回多个订单");
return false;}var c=$(a.grid).jqGrid("getRowData",d);if(c.status!="shipping"){DialogUtils.error("错误","必须已发货状态才可撤销");return false;}SoEntityUtils.backDeliver(d,function(){var e=[];
var f={id:d,soNo:c.soNo};e.push(f);SoEntityUtils.toDeliver(e);});});$(document).on("click","#servicePhoneBtn",function(d){var c=$(this).attr("masknum");
if(c&&c!=""){if(c.startsWith("020")){c=c.substring(3);}window.top.jtCtiService.dialout("9"+c);}else{DialogUtils.error(msgCode.ERROR,"没有此快递公司的客服电话");return;
}});},_backComplete:function(b){var a=this;FormUtils.submit(SoEntityUtils._CONS_.BACK_COMPLETE_URL,"ids="+b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,c.msg);
$(a.tabContainer).find(".soEntitySearch").click();}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});},reloadJqgrid:function(a,b){JTJqgridUtils.reloadJqgrid(this.grid,a);if(b){this.selectedId=b;}else{this.selectedId=null;}},_getParams:function(){var a=this;
var b="";if(a.status&&a.status.indexOf(",")!=-1){b="Q__S__IN__entity.status_="+a.status;}else{if(a.status==null||a.status==""){b="1=1";}else{b="Q__S__EQ__entity.status_="+a.status;
}}if(a.otherParam&&a.otherParam!=""){b=b+"&"+a.otherParam;}b=b+"&bizType="+a.bizType;b=b+"&canShowScTrankNo="+a.canShowScTrankNo;if(this.isReceived){b+="&Q__S__EQ__entity.is_received_="+a.isReceived;
}if(this.isInbound){b+="&Q__S__EQ__entity.is_inbound_="+a.isInbound;}if(a.grid=="#soEntityDelayComfirmGrid"){b+="&Q__S__EQ__entity.is_delay_="+"y";}else{if(a.grid=="#soEntityComfirmGrid"){b+="&Q__S__EQ__entity.is_delay_="+"n";
}}if(a.allBaseType&&(a.grid=="#soEntityBackOrExchangeGrid"||a.grid=="#soEntityCompleteGrid")){b+="&allBaseType="+a.allBaseType;}return b;},_initJqgrid:function(){var k=this;
var h=k.status;var j=true;var b=true;var e=false;var c=true;var l=true;if(h=="complete"){j=false;}if(typeof(isFollowHide)=="undefined"){c=true;}else{if("y"==isFollowHide){c=false;
}}if(this.grid=="#soEntityShippedGrid"||this.grid=="#soEntityRepeatGrid"||this.grid=="#soEntityCompleteGrid"||this.grid=="#soEntityLostGrid"||this.grid=="#soEntityRejectGrid"||this.grid=="#soEntityMgrGrid"||this.grid=="#soEntityMyAllGrid"){b=false;
}ConfigUtils.findByKey("soEntityPlace.isOpendPlatformSelect",function(m){if(m.success){if(k.grid=="#soEntityComfirmGrid"){l=false;}}});var d=new Date();
$(".minPlaceTime").val(d.currentDate()+" 00:00:00");var a=null;if(k.grid==="#soEntityComfirmedGrid"){a={"Q__D__BW__entity.confirm_time_":d.currentDate()+" 00:00:00"};
}else{a={"Q__D__BW__entity.create_time_":d.currentDate()+" 00:00:00"};}var g=window.localStorage.getItem(k.grid+"HideItems");var i=null;console.log(g);
if(g!=null){i=g.split(",");}else{var f=ctx+"/ec/salesorder/soEntity/getHideTblHead.htm"+"?gridId="+k.grid;FormUtils.loadData(f,function(m){if(m&&m.length>0){i=m;
}});}ConfigUtils.findByKey("soEntity.isNotFirstSearch",function(n){var m=false;ConfigUtils.findByKey("soEntity.isShowExport",function(o){if(o.success){m=true;
$(".isExportDiv").show();}});ConfigUtils.findByKey("soEntity.trends.payedAndUnpayed",function(p){var o=false;if(p.success){o=true;}ConfigUtils.findByKey("soEntity.isReceivePhone",function(r){var q=false;
if(!r.success){q=true;}ConfigUtils.findByKey("soEntity.placeTimeToMonth",function(u){if(u.success){if(k.grid==="#soEntityComfirmedGrid"){a={"Q__D__BW__entity.confirm_time_":DateUtils.getBeforeMonth(1)+" 00:00:00"};
}else{a={"Q__D__BW__entity.place_time_":DateUtils.getBeforeMonth(1)+" 00:00:00"};}$(".minPlaceTime").val(DateUtils.getBeforeMonth(1)+" 00:00:00");}if("#soEntityMgrGrid"===k.grid&&n.success){a={"isSearch":"n"};
$(".minPlaceTime").val("");}var t=true;if(ResUtils.canShow("mySoEntity.button.soListShowSrc")){t=false;}var s=[{name:"id",width:130,index:"entity.id_",hidedlg:true,hidden:true},{name:"baseType",width:130,index:"entity.base_type_",hidedlg:true,hidden:true},{name:"soNo",width:80,index:"entity.so_no_",hidedlg:true,hidden:true},{name:"soNoShow",width:130,isBase:"true",index:"entity.so_no_",formatter:function(v,w,y){if(y.footData){$(".ui-jqgrid-title").css({"width":"100%"});
$(k.grid).jqGrid("setCaption","<div style='float:left'>"+y.soNoShow+"</div>"+"<div style='float:right;position:relative;'>"+"</div>");var z=new StringBuffer();
z.append("<span id='itemPoSum'");z.append("<span>商品数量合计 :</span>");if(y.itemPoSum&&y.itemPoSum.length>0){for(var x=0;x<y.itemPoSum.length;x++){z.append("&nbsp;<span>"+y.itemPoSum[x].prodName+"<font color=red>"+"("+y.itemPoSum[x].count+")"+"</font></span>");
}}else{z.append("&nbsp;<span style='color:red'>0个</span>");}z.append("</span>");return z.toString();}else{if(y.soNo!=null&&y.soNo!=""){var z=new StringBuffer();
z.append("<a href='#'style='font-weight:bold;' class='soTab' status='"+y.status+"' csNameVal='"+y.csName+"' idVal='"+y.id+"' soType='"+y.soType+"' cashType='"+y.cashType+"' value='"+y.soNo+"' >"+y.soNo+"</a>");
z.append(SoEntityUtils.getTurnBackStr(y.status,y.preStatus));if(y.isLock=="y"){z.append("&nbsp;<span style='color:red'>冻</span>");}if(y.baseType){if(y.baseType=="back"){z.append("&nbsp;<span style='color:blue'>(退)</span>");
}else{if(y.baseType=="back_before_exchange"){z.append("&nbsp;<span style='color:blue'>(退换)</span>");}else{if(y.baseType=="exchange"){z.append("&nbsp;<span style='color:blue'>(换)</span>");
}}}}if(y.soType=="soSupplementary"){z.append("&nbsp;<span style='color:blue'>(补)</span>");}if(y.backExchangeCount){z.append("&nbsp;<span style='color:red'>["+y.backExchangeCount+"退换]</span>");
}if(y.cashCode){z.append("&nbsp;<span style='color:blue'>券</span>");}return z.toString();}}}},{name:"originSoId",sortable:false,hidden:"y"!=k.showOriginSo,formatter:function(w,x,z){if(z.baseType=="back"){var v="<a title='"+z.originSoNo+"' href='#' class='soTab' value='"+z.originSoNo+"' csIdVal='"+z.csId+"'>"+z.originSoNo+"(原)</a>";
return v;}else{if(z.baseType=="back_before_exchange"){var v="<a title='"+z.originSoNo+"' href='#' class='soTab' value='"+z.originSoNo+"' csIdVal='"+z.csId+"'>"+z.originSoNo+"(原)</a>";
if(z.linkSoNo){var y="<a title='"+z.linkSoNo+"' href='#' class='soTab' value='"+z.linkSoNo+"' csIdVal='"+z.csId+"'>"+z.linkSoNo+"(换)</a>";return v+" ，"+y;
}else{var y="";return v;}}else{if(z.baseType=="exchange"){var v="<a title='"+z.originSoNo+"' href='#' class='soTab' value='"+z.originSoNo+"' csIdVal='"+z.csId+"'>"+z.originSoNo+"(退换)</a>";
var y="<a title='"+z.linkSoNo+"' href='#' class='soTab' value='"+z.linkSoNo+"' csIdVal='"+z.csId+"'>"+z.linkSoNo+"(原)</a>";return v+"，"+y;}else{if(!z.baseType||z.baseType=="common"){console.log(z.linkSoIdAndType4Common);
}}}}return"";}},{name:"isCloudWarehourse",hidedlg:l,hidden:l,width:100,index:"entity.is_cloud_warehouse_",formatter:function(v,w,x){if(x.isCloudWarehourse==1){return"云仓订单";
}else{return"系统订单";}}},{name:"operName",width:80,index:"",hidedlg:c,hidden:c,formatter:function(v,w,x){var y=new StringBuffer();y.append('<button class="jt-btn-opt soEntityShipQryBtn" style="font-weight:bold;" idVal = "'+x.id+'" scTrackingNo ="'+x.scTrackingNo+'" shipName="'+x.shipName+'" >物</button>');
return y.toString();}},{name:"csNameShow",width:80,isBase:"true",index:"cs_name_",formatter:function(v,w,x){if(x.csCode&&!k.hideCsName){return"<a href='#' style='font-weight:bold;' class='csTab' value='"+x.csId+"' >"+x.csName+"<br>"+x.csCode+"</a>";
}if($(window).width()<1024){return x.csName+"<br>"+x.csCode;}else{return x.csName+":"+x.csCode;}}},{name:"csName",hidedlg:true,hidden:true},{name:"soType",hidedlg:true,hidden:true},{name:"soTypeName",width:50,isBase:"true",index:"entity.so_type_",formatter:function(v,y,z){if(!z.soType){return"--";
}var w='<span style="color:red;">[类型被删除]</span>';for(var x=0;x<soTypeCatePos.length;x++){if(z.soType&&z.soType==soTypeCatePos[x].key){w=soTypeCatePos[x].name;
break;}}return w;}},{name:"status",hidedlg:true,hidden:true},{name:"statusShow",index:"entity.status_",width:75,isBase:"true",formatter:function(v,w,x){if(x.backStatus=="awaiting"&&x.status=="close_reject"){return SoEntityUtils.formatStatus(x.status)+"(需退回)";
}else{if(x.backStatus=="none"&&x.status=="close_reject"){return SoEntityUtils.formatStatus(x.status)+"(无需退回)";}else{if(x.isReceived=="y"){return SoEntityUtils.formatStatus(x.status)+"(已回款)";
}else{if(x.isInbound=="y"){return SoEntityUtils.formatStatus(x.status)+"(已退库)";}else{if(x.auditCount==1){return SoEntityUtils.formatStatus(x)+"(初审)";}else{return SoEntityUtils.formatStatus(x);
}}}}}}},{name:"delayConfirmTime",width:90,index:"entity.delay_confirm_time_",hidden:k.grid=="#soEntityDelayComfirmGrid"?false:true,formatter:function(w){var v="<span title='"+w+"'>"+DateUtils.mini4Time(w)+"</span>";
return v;}},{name:"is_received_",width:35,index:"entity.is_received_",hidden:!k.isUseReturnBack,formatter:function(v,x,y){var w="否";if(y.isReceived=="y"){w="<span style='color:red;'>是</span>";
}return w;}},{name:"is_inbound_",width:35,index:"entity.is_inbound_",hidden:!k.isUseReturnBack,formatter:function(v,x,y){var w="否";if(y.isInbound=="y"){w="<span style='color:red;'>是</span>";
}return w;}},{name:"isFast",width:35,index:"entity.is_fast_",formatter:function(v,x,y){var w="否";if(y.isFast=="y"){w="<span style='color:red;'>是</span>";
}return w;}},{name:"shipResult",width:60,hidedlg:k.hideShipResult,hidden:k.hideShipResult,index:"entity.status_",isBase:"true",formatter:function(w,y,z){var x="未发货";
var v=z.status;if(v=="close_lost"){x="已丢失";}else{if(v=="close_reject"){x="拒收";}else{if(v=="complete"){x="已签收";}else{if(v=="shipping"){x="已发货";}else{if(v=="unbound"){x="退货中";
}}}}}return x;}},{name:"isMain",width:120,hidedlg:true,hidden:true},{name:"pid",width:120,hidedlg:true,hidden:true},{name:"greenId",width:150,hidedlg:true,hidden:true},{name:"relId",width:150,hidedlg:true,hidden:true},{name:"greenNo",width:130,hidedlg:true,hidden:true,index:"green.so_no_",formatter:function(v,w,x){if(x.greenNo!=null&&x.greenNo!=""){return"<a href='#' class='soTab' value='"+x.greenNo+"' >"+x.greenNo+"</a>";
}return x.greenNo;}},{name:"relNo",width:130,hidedlg:true,hidden:true,index:"rel.so_no_",formatter:function(v,w,x){if(x.relNo!=null&&x.relNo!=""){return"<a href='#'  class='soTab' value='"+x.relNo+"' >"+x.relNo+"</a>";
}return x.relNo;}},{name:"cashType",hidedlg:true,hidden:true},{name:"cashTypeName",width:70,index:"entity.cash_type_",isBase:"true",formatter:function(v,w,x){return SoEntityUtils.formatCashType(x.cashType);
}},{name:"shipName",index:"entity.ship_name_",isBase:"true",width:70},{name:"scTrackingNo",width:100,hidden:b,isBase:"true",index:"entity.sc_tracking_no_"},{name:"fromType",width:120,hidedlg:true,hidden:true},{name:"prodQty",width:90,index:"entity.prod_qty_",hidedlg:true,hidden:true},{name:"serviceQty",width:120,hidedlg:true,hidden:true},{name:"giftQty",width:120,hidedlg:true,hidden:true},{name:"prodAmount",width:90,index:"entity.prod_amount_",hidedlg:true,hidden:true},{name:"shippingAmount",width:60,hidedlg:true,hidden:true},{name:"shippingActual",width:120,hidedlg:true,hidden:true},{name:"billType",width:90,hidedlg:true,hidden:true},{name:"billTitle",width:120,hidedlg:true,hidden:true},{name:"billContent",width:120,hidedlg:true,hidden:true},{name:"billAmount",width:80,hidedlg:true,hidden:true},{name:"otherAmount",width:80,hidedlg:true,hidden:true},{name:"otherComment",width:120,hidedlg:true,hidden:true},{name:"totalAmount",width:70,index:"entity.total_amount_",isBase:"true",formatter:function(v,w,x){if(window.localStorage.getItem("ts_money_reduce")=="true"){return parseFloat(x.totalAmount/10).toFixed(2);
}else{return parseFloat(x.totalAmount).toFixed(2);}}},{name:"discountAmount",width:120,hidedlg:true,hidden:true},{name:"mainAmount",width:120,hidedlg:true,hidden:true},{name:"payType",width:120,hidedlg:true,hidden:true,formatter:function(v,w,x){return SoEntityUtils.formatPayType(x.payType);
}},{name:"subAmount",width:60,index:"entity.sub_amount_",isBase:"true",formatter:function(v,w,x){if(window.localStorage.getItem("ts_money_reduce")=="true"){return parseFloat(x.subAmount/10).toFixed(2);
}else{return parseFloat(x.subAmount).toFixed(2);}}},{name:"payableAmount",width:60,sortable:false,isBase:"true",formatter:function(v,w,x){if(o){if(window.localStorage.getItem("ts_money_reduce")=="true"){if(x.status=="complete"){return"0.00";
}else{if(x.status=="awaiting_comfirm"||x.status=="awaiting_pay"){return parseFloat(x.totalAmount/10).toFixed(2);}else{if(x.status=="shipping"&&(x.cashType=="pay_sub"||x.cashType=="cod")){return parseFloat((x.totalAmount-x.subAmount)/10).toFixed(2);
}else{return parseFloat(x.proxyAmount/10).toFixed(2);}}}}else{if(x.status=="complete"){return"0.00";}else{if(x.status=="awaiting_comfirm"||x.status=="awaiting_pay"){return parseFloat(x.totalAmount).toFixed(2);
}else{if(x.status=="shipping"&&(x.cashType=="pay_sub"||x.cashType=="cod")){return parseFloat(x.totalAmount-x.subAmount).toFixed(2);}else{return parseFloat(x.proxyAmount).toFixed(2);
}}}}}else{if(window.localStorage.getItem("ts_money_reduce")=="true"){return parseFloat(x.proxyAmount/10).toFixed(2);}else{return parseFloat(x.proxyAmount).toFixed(2);
}}}},{name:"placerName",width:90,index:"entity.placer_id_",isBase:"true",formatter:function(v,w,x){if(x.placerAid){return x.placerAid+"<br>"+v;}return"";
}},{name:"payedAmount",width:60,hidedlg:true,hidden:true},{name:"refundApply",width:80,hidedlg:true,hidden:true},{name:"billCount",hidedlg:true,hidden:true,width:70,index:"entity.bill_count_",formatter:function(v,w,x){if(x.billCount!=null&&x.billCount!=0){return"<a href='#' class='soFinanceBillTab' value='"+x.id+"' noValue='"+x.soNo+"'  style='color:black;'>"+x.billCount+"(查看)</a>";
}return x.billCount;}},{name:"isLock",width:60,hidedlg:true,hidden:true},{name:"lockId",width:100,hidedlg:true,hidden:true},{name:"lockName",width:100,index:"lockParty.name_",hidden:true},{name:"isForce",width:120,hidedlg:true,hidden:true},{name:"payStatus",width:120,hidedlg:true,hidden:true},{name:"isSettle",width:120,hidedlg:true,hidden:true},{name:"payTime",width:120,hidedlg:true,hidden:true},{name:"closeTime",width:120,hidedlg:true,hidden:true},{name:"csId",width:120,hidedlg:true,hidden:true},{name:"placerId",width:120,hidedlg:true,hidden:true},{name:"prodNames",width:120,sortable:false,isBase:"true",formatter:function(v){var w='<span  style="color:#1ab394;'+(k.simpleShowProduct?"":"display:none")+'" class="tooltip-product jt-grid-tip fa fa-bell"  data-value="'+v+'"></span>';
w+='<span style="'+(k.simpleShowProduct?"display:none":"")+'" class="product-detail">'+v+"</span>";return w;}},{name:"lastFollow",width:120,sortable:false,isBase:"true",formatter:function(v){var w='<span  style="color:#1ab394;'+(k.simpleShowLastFollow?"":"display:none")+'" class="tooltip-follow jt-grid-tip fa fa-bell" data-value="'+v+'"></span>';
w+='<span style="'+(k.simpleShowLastFollow?"display:none":"")+'" class="lastFollow-detail">'+v+"</span>";return w;}},{name:"afterSaleType",width:70,index:"entity.after_sale_type_",hidden:j,formatter:function(v,w,x){if(x.afterSaleType=="back"){return"退货";
}else{if(x.afterSaleType=="exchange"){return"换货";}else{if(x.afterSaleType=="reject"){return"拒收";}else{return"";}}}}},{name:"placerAid",width:120,hidedlg:true,hidden:true},{name:"thirdStoreName",width:70,index:"entity.third_store_name_"},{name:"channelName",width:70,index:"entity.channel_name_",hidden:t},{name:"profitsStr",width:90,sortable:false,isBase:"true",formatter:function(v){if(v.indexOf("_")>-1){if(v.indexOf("*")>-1){var w=v.substring(v.indexOf("_"),v.indexOf(":"));
v=v.replace(w,"[已删除]");w=v.substring(v.indexOf("_"),v.lastIndexOf(":"));v=v.replace(w,"[已删除]");}else{var w=v.substring(v.indexOf("_"),v.length);v=v.replace(w,"[已删除]");
}}return v;}},{name:"placeTime",width:90,index:"entity.place_time_",isBase:"true",formatter:function(v){return DateUtils.mini2Time(v);}},{name:"confirmTime",width:90,index:"entity.confirm_time_",hidden:k.grid=="#soEntityComfirmedGrid"||k.grid=="#soEntityMgrGrid"?false:true,formatter:function(w){var v="<span title='"+w+"'>"+DateUtils.mini2Time(w)+"</span>";
return v;}},{name:"shipTime",width:90,hidden:k.grid=="#soEntityShippedGrid"||k.grid=="#soEntityMgrGrid"?false:true,index:"entity.ship_time_",formatter:function(w){var v="<span title='"+w+"'>"+DateUtils.mini2Time(w)+"</span>";
return v;}},{name:"completeTime",width:90,hidden:k.grid=="#soEntityCompleteGrid"||k.grid=="#soEntityMgrGrid"?false:true,index:"entity.complete_time_",formatter:function(w){var v="<span title='"+w+"'>"+DateUtils.mini2Time(w)+"</span>";
return v;}},{name:"rejectTime",width:90,hidden:k.grid=="#soEntityRejectGrid"||k.grid=="#soEntityMgrGrid"?false:true,index:"entity.reject_time_",formatter:function(w){var v="<span title='"+w+"'>"+DateUtils.mini2Time(w)+"</span>";
return v;}},{name:"closeTime",width:90,hidden:k.grid=="#soEntityEndGrid"?false:true,index:"entity.close_time_",formatter:function(w){var v="<span title='"+w+"'>"+DateUtils.mini2Time(w)+"</span>";
return v;}},{name:"comment",width:120,index:"entity.comment_",isBase:"true",hidden:e,formatter:function(y,v,x){var w="";if(y!=""&&y!=null){w='<span  style="color:#1ab394;'+(k.simpleShowComment?"":"display:none")+'" class="tooltip-comment jt-grid-tip fa fa-bell" data-value="'+y+'"></span>';
w+='<span style="'+(k.simpleShowComment?"display:none":"")+'" class="comment-detail">'+y+"</span>";}return w;}},{name:"createBy",width:120,hidedlg:true,hidden:true},{name:"createTime",width:120,hidedlg:true,hidden:true,index:"entity.create_time_"},{name:"updateBy",width:120,hidedlg:true,hidden:true},{name:"updateTime",index:"entity.update_time_",width:90,hidedlg:true,hidden:true,formatter:function(v){return DateUtils.mini2Time(v);
}},{name:"isDetail",hidedlg:true,hidden:true,formatter:function(){return k.bizType=="placer"?"y":"n";}},{name:"tranPhone",hidedlg:true,hidden:q},{name:"recPhone",hidedlg:true,hidden:q},{name:"__manage",width:60,classes:"rowOps",sortable:false,align:"center",formatter:"manage",formatoptions:k.getManagerBtns()}];
if(i){$.each(s,function(v,w){if($.inArray(this.name,i)!=-1){this.hidden=true;}});}$(k.grid).JTJqgrid({url:SoEntityUtils._CONS_.LIST_URL+"?"+k._getParams(),pager:k.pager,postData:a,autoScroll:true,colNames:["id","基础类型(隐藏)","订单编号(隐藏)","订单编号","关联订单","平台订单","操作","客户","客户(隐藏)","订单类型key","类型","订单状态key","订单状态","延审时间","回款","退库","加急","发货结果","是否主订单.","父订单 ID","关联绿色订单 ID","关联订单 ID","关联绿色订单","关联订单","货款方式key","货款方式","快递公司","快递单号","来源类型","产品总数量","服务总数量","赠品总数量","产品金额","运费","金额 - 实际运费（冗余，用于统计成本）","发票类型","发票抬头","发票说明","发票金额","其它费用","其它费用说明","总金额","总折扣金额","金额 - 主订单客单金额","支付方式","订金","待收","下单人","已收","退款金额","财务单","是否锁定(隐藏)","锁定人ID","锁定人","是否强制干预订单状态","状态 - 支付状态。unpaid=未支付；partial=部分支付；paid_off=已支付","是否已物流结算（COD）","支付完成时间","订单结束时间。订单状态到达终止状态（包括已取消、已完成、已退款等）时的时间。","客户 ID","下单员 ID","订单商品","最新跟进","售后处理","下单人工号","店铺名称","渠道","业绩分成","下单时间","审核时间","发货时间","签收时间","拒收时间","作废时间","订单备注","下单者ID","创建时间","更新者","更新时间","是否我的订单","成交手机编号","收款手机编号","操作"],colModel:s,simplify:{entry:[{sName:"最新跟进",sClass:"lastFollow",sCheck:(k.simpleShowLastFollow?true:false)},{sName:"订单备注",sClass:"orderDesc",sCheck:(k.simpleShowComment?true:false)},{sName:"订单商品",sClass:"productShow",sCheck:(k.simpleShowProduct?true:false)},{sName:"商品合计",sClass:"productShowSum",sCheck:(k.simpleShowProductSum?true:false)}],base:["订单编号","客户","类型","订单状态","发货结果","货款方式","快递公司","快递单号","总金额","订金","待收","下单人","订单商品","最新跟进","业绩分成","下单时间","订单备注"],other:["回款","退库","加急","店铺名称","渠道"]},footerrow:true,userDataOnFooter:true,loadComplete:function(){if(k.bizType!="placer"){$("a.soTab").attr("isDetail","true");
}var y=window.localStorage.getItem(k.grid+"HideItems");var w=window.localStorage.getItem(k.grid+"ShowItems");var v=$(k.grid).getGridParam("width");if(y!=null){var z=y.split(",");
for(var x=0;x<z.length;x++){$(k.grid).setGridParam().hideCol(z[x]);}}$(k.grid).setGridWidth(v);if(w!=null){var z=w.split(",");for(var x=0;x<z.length;x++){$(k.grid).setGridParam().showCol(z[x]);
}}$(window).resize();},gridComplete:function(){if(k.selectedId!=null){if(k.selectedId.length==1){$(k.grid).jqGrid("setSelection",k.selectedId,true);}else{for(var z=0;
z<k.selectedId.length;z++){$(k.grid).jqGrid("setSelection",k.selectedId[z],true);}}}if(!k.hasInitJqgrid){var w=$(k.grid).jqGrid("getGridParam","colModel");
var v=new Array();for(var x=2;x<w.length;x++){if(w[x].hidden&&$.inArray(w[x].name,i)==-1){v.push(w[x].name);}}window.localStorage.setItem(k.grid+"defaultHideItems",v);
k.hasInitJqgrid=true;}var y=$(k.grid).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow");y.find("td").css({"font-weight":400,"width":500});
y.find("td").hide();y.find('td[aria-describedby*="_soNoShow"]').show();if(k.simpleShowProductSum){y.hide();}else{y.show();}},onSelectAll:function(w,v){if(w&&w.length>0){if(typeof(k.onSelectRow)=="function"){k.onSelectRow(w,v,k.otherOperFlag);
}}},onSelectRow:function(w,v){if(typeof(k.onSelectRow)=="function"){k.onSelectRow(w,v,k.otherOperFlag);}},ondblClickRow:function(x){return false;if(x){if(k.ondblClickRow&&typeof k.ondblClickRow==="function"){k.ondblClickRow(x);
}else{var y=$(k.grid).jqGrid("getRowData",x);var A=y["csName"];var w=y["soNo"];var v=SoEntityUtils._CONS_.DETAIL_PAGE_URL+"?soNo="+w;var z=A+"的订单明细";JTTabUtils.addOrRefreshTab(v,z);
}}}});});});});});},};function parentCMD(){$(".soEntitySearch").trigger("click");}$(function(){StoreUtils.loadStores("","storeIdContainer");StoreUtils.loadStores("","storeIdPack");
var a=new SoEntitySelectList();a.init();});function SoEntitySelectList(){this.simpleShowLastFollow=(simpleShowLastFollow=="n"?false:true);this.simpleShowComment=(simpleShowComment=="n"?false:true);
this.hadInit=false,self=this;this.soEntitySearch=new SoEntity({pager:"soEntityMgrPager",grid:"soEntityMgrGrid",tabContainer:"soEntityContainer",status:"",bizType:"placer",simpleShowLastFollow:this.simpleShowLastFollow,simpleShowComment:this.simpleShowComment,canShowScTrankNo:ResUtils.canShow("soSearch.button.showScTrackNo")?"can":"cannot",bindEventHandler:function(){self._bindEventHander();
}});ConfigUtils.findByKey("soEntity.isShowExport",function(a){if(a.success){new FormConfig({"formId":$(".soSelectSearchForm"),title:"订单查询配置",isHidden:true,"endLess":[],modular:"soSelectSearchList"}).init();
}else{new FormConfig({"formId":$(".soSelectSearchForm"),title:"订单查询配置",isHidden:true,forceParam:["是否导出"],"endLess":[],modular:"soSelectSearchList"}).init();
}});}SoEntitySelectList._CONS_={SAVE_EDIT_URL:ctx+"/ec/salesorder/soEntity/saveEdit.htm",SUBMIT_URL:ctx+"/ec/salesorder/soEntity/submit.htm",EDIT_FORM_ID:"soEntityForm",GRID:"#soEntityMgrGrid",PAGER:"#soEntityMgrPager",};
SoEntitySelectList.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._initSearch();this.soEntitySearch.init();this._buildEmployeeSelect();
this._hideNotGrantBtn();}},_initSearch:function(){CateUtils.getOptions([{typeKey:"system",pKey:"CsInterestType",container:"interestsQry"},{typeKey:"system",pKey:"soFollowStatus",container:"followQry"},{typeKey:"system",pKey:"CsEntryType",container:"entryQry"},{typeKey:"system",pKey:"CsInterestType",container:"soInterestQry"},{typeKey:"system",pKey:"soEntityStoreName",container:"storeNameSearch"},{typeKey:"system",pKey:"CsGenderType",container:"genderSearch"}]);
CateUtils.findCatePos({typeKey:"soEntity",pKey:"soType",container:"soTypeQry"});ConfigUtils.findByKey("system.isBanDelayConfirm",function(d){if(d.success){$("#isDelayConfirm").hide();
}else{$("#isDelayConfirm").show();}});StoreUtils.loadData({container:"storeSearch",isSale:false});ShipCompanyUtils.getOptions({container:"scCodeQry",caption:"全部"});
ChannelUtils.getOptions({container:"srcQry",caption:"全部"});ChannelUtils.getOptions({container:"soSrcQry",caption:"全部"});var a=new Date();var b=a.currentDate()+" 00:00:00";
var c=new Date().currentDate()+" 23:59:59";$(".minPlaceTime").val(b);$(".maxPlaceTime").val(c);this.addressServiceSearch=new AddressService("addrContainerSearch");
this.addressServiceSearch.init({isSelect:"y",isNotRequired:true},function(){});},_hideNotGrantBtn:function(){if(!ResUtils.canShow("soEntitySearch.button.exportShip")){$(".exportSoEntityInfo").hide();
}},_bindEventHander:function(){var a=this;$("#groupName").on("click",function(){var b={isMultiple:1,selectedGroupId:$("input[name='belongOgn']").val(),container:"groupName",fn:function(c){$("input[name=belongOgn]").val(c);
a._buildEmployeeSelect(c);}};GroupUtils.selectGroupTreeBox(b);});$(".selectPlacer").on("click",function(){var b={isMultiple:1,selectedGroupId:$("input[name='belongOgnPlacer']").val(),container:"selectPlacer",fn:function(c){$("input[name=belongOgnPlacer]").val(c);
a._buildEmployeeSelect(c);}};GroupUtils.selectGroupTreeBox(b);});},_buildEmployeeSelect:function(a){$.ajax({type:"GET",url:ctx+"/crm/ou/employee/listEmployees.htm"+"?groupId="+(a?a:""),contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(c){if(c&&c.length>0){var d=new StringBuffer();
d.append("<option value=''>请选择</option>");for(var b=0;b<c.length;b++){d.append("<option value='"+c[b].id+"'>"+c[b].aid+":"+c[b].name+"</option>");}$("#belongEmployeeSearch").empty().append(d.toString()).select2();
$("#planMan").empty().append(d.toString()).select2();}}});},};var glHelpUtil={init:function(a){this._createGlHelpTag();this._bindEventHandler(a);},_createGlHelpTag:function(){var a=new StringBuffer();
a.append("<a style='margin-left:10px' title='帮助'><img src='/t9-ecm/img/jt/help.png'></a>");$("#glHelpContainer").empty().append(a.toString());},_bindEventHandler:function(a){$(document).on("click","#glHelpContainer",function(){FormUtils.loadData(ctx+"/gl/km/glHelp/findGlHelpData.htm"+"?cateKey="+a,function(b){JTTabUtils.addOrRefreshTab(b.url,"<"+b.name+"> "+"帮助文档");
});});},};function FormConfig(a){if(!a){a={};}this.title=a.title?a.title:"表单字段配置";if(a.formId){if(typeof a.formId=="string"){this.formId=$("#"+a.formId);
}else{if(typeof a.formId=="object"){this.formId=a.formId;}}}else{console.log("无法识别的表单对象！");this.isError=true;return false;}if(a.entry){if(typeof a.entry=="string"){this.entry=$("#"+a.entry);
}else{if(typeof a.entry=="object"){this.entry=a.entry;}}}else{this.entry=$(".jt-form-config");console.log("找不到指定配置的入口，组件默认点击类：jt-form-config！");}if(a.modular){this.modular=a.modular;
}else{console.log("参数modualer为空，请指定模块唯一标识符！");this.isError=true;return false;}this.endLess=a.endLess?a.endLess:[];this.forceParam=a.forceParam?a.forceParam:[];
this.isHidden=a.isHidden?a.isHidden:false;this.marker=null;this.sysMarker=null;this.isInit=false;this.sysMarkerId=null;}FormConfig._CONS_={GET_FORM_MARKER:ctx+"/gl/formText/findByKey.htm",SAVE_FORM_MARKER:ctx+"/gl/formText/updateByKey.htm",ADD_FORM_MARKER:ctx+"/gl/formText/saveAdd.htm"};
FormConfig.prototype={init:function(){var a=this;if(a.isError){return false;}$(a.entry).addClass("jt-"+a.modular+"-config");a.getFormParams();a.getBasicParams();
a.getSysMarker();a.bindEvent();},bindEvent:function(){var a=this;$(document).on("click",".jt-"+a.modular+"-config",function(b){a.loadFormConfigLayer(a.marker);
});$(document).on("click","#jt-form-config-list > div",function(c){var d=$(this).find("input[type='checkbox']");if(!$(c.target).is(".form-config-check")){d.trigger("click");
}if($(this).is(".jt-form-allcheck")){$(".form-config-check").each(function(f,g){if(!$(this).is("[disabled]")){$(this).prop("checked",d.prop("checked"));
if(d.prop("checked")){$("."+$(this).attr("name")).removeClass("jt-form-leftA");}else{$("."+$(this).attr("name")).addClass("jt-form-leftA");}}});}else{if(!$(this).is(".jt-form-endless")){if(d.prop("checked")){$("."+d.attr("name")).removeClass("jt-form-leftA");
var b=true;$(".form-config-check").each(function(f,g){if(!$(this).prop("checked")&&$(this).attr("name")!="allCheck"){b=false;}});if(b){$(".jt-form-allcheck").find(".form-config-check").prop("checked",true);
}}else{$("."+d.attr("name")).addClass("jt-form-leftA");$(".jt-form-allcheck").find(".form-config-check").prop("checked",false);}}}});},loadFormConfigLayer:function(d){var m=this;
var g="<div class='panel-default jt-form-config-layer' style='display:none;'>"+"<div class='panel-body'>"+"<form class='form-horizontal'>"+"<div class='form-group' id='jt-form-config-list'>"+"</div>"+"</form>"+"</div>"+"</div>";
if($("#jt-form-config-list").length==0){$("body").append(g);}var f="";var a="";for(var e=0;e<d.length;e++){var j=$.inArray(d[e].name.replace(/\s*/g,""),m.endLess);
var b=null;if(m.basicParam){b=$.inArray(d[e].name.replace(/\s*/g,""),m.basicParam);}var l="col-sm-3";if(d[e].key=="allCheck"){continue;}var c='<div class="'+l+((j!=-1)?" jt-form-endless":"")+((d[e].key=="allCheck")?" jt-form-allcheck":"")+'">'+'<div class="checkbox checkbox-success checkbox-inline">'+'<input type="checkbox" class="form-config-check" '+((j!=-1)?'disabled="disabled"':"")+' name="'+d[e].key+'" '+(d[e].isCheck?'checked="true"':"")+">"+'<label for="'+d[e].key+'">'+d[e].name+"</label>"+"</div>"+"</div>";
if(m.basicParam&&(b!=-1)){a+=c;}else{f+=c;}}if(a){f="<div class='basic-items-title'>常用字段</div>"+a+"<div  class='other-items-title'>其他字段</div>"+f;}$("#jt-form-config-list").empty().append(f);
var k="demo-class";if(ResUtils.canShow("form.button.config")){k+=" sys-form-config";}var h=$(window).width()/3;if(h<500){h=500+"px";}else{h="33.33%";}layer.open({type:1,title:m.title,shade:false,btn:["保存","取消","保存为全局"],offset:"10%",area:[h,"auto"],skin:k,content:$(".jt-form-config-layer"),scrollbar:false,success:function(i,n){},yes:function(n,i){m.marker=m.getMarker();
window.localStorage.removeItem(m.modular+"FormItems");window.localStorage.setItem(m.modular+"FormItems",JSON.stringify(m.marker));layer.close(n);},btn3:function(n,i){if(ResUtils.canShow("form.button.config")){m.saveSysMarker();
}else{DialogUtils.error("您无权修改系统配置项！");}},btn2:function(n,i){m.reMarker();},cancel:function(){m.reMarker();}});},getFormParams:function(){var c=this;var b=c.formId;
var a=[];var d=window.localStorage.getItem(c.modular+"FormItems");if(d){c.marker=JSON.parse(d);c.doMarker();c.isInit=true;}else{if(b.length!=1){console.log("传入的表单对象不存在或不唯一!");
}else{b.find(".jt-form-group").children().each(function(f,g){var h=$(this).children("label").text().replace(/\s*/g,"");if($.inArray(h,c.forceParam)>=0){return true;
}if(c.isHidden){a.push({"key":("marker"+f),"name":h,"isCheck":true});}else{if($(this).is(":visible")){a.push({"key":("marker"+f),"name":h,"isCheck":true});
}}});a.push({"key":"allCheck","name":"全选","isCheck":true});}c.marker=a;}},getBasicParams:function(){var c=this;var b=c.formId;var a=[];b.find(".jt-form-group").children().each(function(d,f){var g=$(this).children("label").text().replace(/\s*/g,"");
if($(this).is(".jt-basic-param")){a.push(g);}});if(a.length>0){c.basicParam=a;}},doMarker:function(){var a=this;if(a.marker){a.examMarker();$.each(a.marker,function(b,d){var c=this;
a.formId.find(".jt-form-group").children().each(function(f,g){var h=$(this).children("label").text().replace(/\s*/g,"");if($.inArray(h,a.forceParam)>=0){return true;
}if(h==c.name){$(this).addClass(c.key);if(!c.isCheck&&!$(this).is(".jt-form-leftA")){$(this).addClass("jt-form-leftA");}return false;}});});a.formId.find(".jt-form-group").animate({"opacity":1},"fast");
}},reMarker:function(b){var a=this;var c=a.marker;if(b){c=b;}$.each(c,function(f,h){var g=this;var d=a.formId.find(".jt-form-group").find("."+g.key);if(g.isCheck&&d.is(".jt-form-leftA")){d.removeClass("jt-form-leftA");
}else{if(!g.isCheck&&!d.is(".jt-form-leftA")){d.addClass("jt-form-leftA");}}});},getMarker:function(){var b=this;var a=[];$(".form-config-check").each(function(c,d){a.push({"key":$(this).attr("name"),"name":$(this).next().text().replace(/\s*/g,""),"isCheck":$(this).prop("checked")});
});return a;},getSysMarker:function(){var a=this;FormUtils.loadData(FormConfig._CONS_.GET_FORM_MARKER+"?key="+this.modular,function(b){if(b.msg){var c=JSON.parse(b.msg);
if(typeof c=="object"){a.sysMarker=c;a.sysMarkerId=b.msgCode;if(!a.isInit&&a.sysMarker){a.marker=a.sysMarker;}}}if(!a.isInit){a.doMarker();a.isInit=true;
}},false);},saveSysMarker:function(){var a=this;var d=a.getMarker();var b=FormConfig._CONS_.ADD_FORM_MARKER;var c={key:a.modular,content:JSON.stringify(d)};
if(a.sysMarkerId){b=FormConfig._CONS_.SAVE_FORM_MARKER;c.id=a.sysMarkerId;}FormUtils.submit(b,c,function(e){if(e.success){window.localStorage.removeItem(a.modular+"FormItems");
window.localStorage.setItem(a.modular+"FormItems",JSON.stringify(d));a.sysMarker=d;a.marker=d;if(!a.sysMarkerId){a.sysMarkerId=e.msgCode;}DialogUtils.success("提示","系统表单字段配置项保存成功！");
}});},examMarker:function(){var b=this;var c=[];var a=null;b.formId.find(".jt-form-group").children().each(function(d,f){var g=$(this).children("label").text().replace(/\s*/g,"");
if($.inArray(g,b.forceParam)>=0){return true;}if(b.isHidden){c.push({"key":("marker"+d),"name":g,"isCheck":true});}else{if($(this).is(":visible")){c.push({"key":("marker"+d),"name":g,"isCheck":true});
}}});if(b.marker&&c.length!=b.marker.length){c.push({"key":"allCheck","name":"全选","isCheck":true});$.each(b.marker,function(d,g){var f=this;$.each(c,function(h,e){if(this.name==f.name){c[h].isCheck=f.isCheck;
return false;}});});b.marker=c;}}};