$(function(){function b(){this.hadInit=false;this.intervalId=null;}b._CONS_={LIST_DATA_URL:ctx+"/ec/salesorder/soEntity/listData.htm",DETAIL_PAGE_URL:ctx+"/ec/salesorder/soEntity/detail.htm",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detail.htm",};
b.prototype={init:function(d){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._initTable();var c=this;c.intervalId=setInterval(function(){c._initTable();
},30*60000);}},_bindEventHander:function(){var c=this;$("body").on("click",".soTab",function(){var e=$(this).attr("value");var d=$(this).attr("value");
if(d.length>4){e="*"+d.substring(d.length-3,d.length);}JTTabUtils.addOrRefreshTab(b._CONS_.DETAIL_PAGE_URL+"?soNo="+d,"订单["+e+"]明细");});$("body").on("click",".csTab",function(){var e=$(this).text();
var d=$(this).attr("value");if(e.length>4){e="*"+e.substring(e.length-3,e.length);}JTTabUtils.addOrRefreshTab(b._CONS_.DETAIL_CS_PAGE_URL+"?csId="+d,"客户["+e+"]明细");
});$(document).on("click",".checkMore",function(){JTTabUtils.addOrRefreshTab(ctx+"/ec/salesorder/soEntity/stock/list.htm","订单发货");});},_initTable:function(d){var c=b._CONS_.LIST_DATA_URL+"?positionType=order_print,dept_manager&refundStatusIsNull=y&sidx=create_time_&sord=desc&rows=8&Q__S__EQ__entity.status_=comfirm";
FormUtils.loadData(c,function(g){var k=g.rows;if(k&&k.length){var j=new StringBuffer();for(var f=0;f<k.length;f++){j.append("<tr>");j.append("<td>"+"<a href='#'  class='soTab' value='"+k[f].soNo+"' >"+k[f].soNo+"</a>"+"</td>");
var h=k[f].csName&&"<a href='#'  class='csTab' value='"+k[f].csId+"' >"+k[f].csName+"</a>";j.append("<td>"+h+"</td>");var e="";if(k[f].soType=="common"){e="普通订单";
}else{if(k[f].soType=="change"){e="换货单";}else{if(k[f].soType=="repeat"){e="重发单";}else{if(k[f].soType=="point"){e="积分订单";}}}}j.append("<td>"+e+"</td>");
e="";if(k[f].cashType=="pay"){e="款到发货";}else{if(k[f].cashType=="pay_sub"){e="支付订金";}else{if(k[f].cashType=="green"){e="绿色通道";}else{if(k[f].cashType=="green_by"){e="由绿色通道订单支付订金";
}else{if(k[f].cashType=="cod"){e="货到付款";}else{if(k[f].cashType=="free"){e="免费已付";}}}}}}j.append("<td>"+e+"</td>");j.append("<td>"+k[f].proxyAmount+"</td>");
j.append("<td>"+k[f].placeTime+"</td>");j.append("</tr>");}j.append("<tr>");j.append("<td colspan='7' align='right'><a  href='javascript:void(0);' class='checkMore' style='cursor: pointer;' >查看更多</a></td>");
j.append("<tr>");$("#stockOutContainer").empty().append(j.toString());}IframeUtils.resizeHeight($(parent.document).find('iframe[srcVal="/ec/salesorder/soEntity/desktop/outList.htm"]'),$(".panel.panel-default").height());
});}};var a=new b();a.init();});