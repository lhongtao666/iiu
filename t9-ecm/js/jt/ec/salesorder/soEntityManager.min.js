function SoEntityManager(){this.simpleShowLastFollow=(simpleShowLastFollow=="n"?false:true);this.simpleShowComment=(simpleShowComment=="n"?false:true);
this.simpleShowProduct=(simpleShowProduct=="n"?false:true);this.isUseReturnBack=(isUseReturnBack=="n"?false:true);}SoEntityManager.prototype={_initSearch:function(){new FormConfig({"formId":$("#tabSoAll").find(".soEntitySearchForm"),entry:$("#tabSoAll").find(".jt-form-config"),title:"我的订单查询配置",isHidden:true,forceParam:["客户号码"],"endLess":[],modular:"mySoEntitySearchList"}).init();
this.soEntitySearch=new SoEntity({pager:"soEntityMyAllPager",grid:"soEntityMyAllGrid",tabContainer:"tabSoAll",status:"",bizType:bizType,simpleShowLastFollow:this.simpleShowLastFollow,simpleShowComment:this.simpleShowComment,simpleShowProduct:this.simpleShowProduct,canShowScTrankNo:ResUtils.canShow("mySoEntity.button.showScTrackNo")?"can":"cannot",bindEventHandler:function(){$(".copySctrankNo").zclip({path:ctx+"/js/plugins/zclip/ZeroClipboard.swf",copy:function(){return self._getScTrankNo();
},beforeCopy:function(){},afterCopy:function(){}});}});},_getSelId:function(a,b){if(!b){b=$("#"+a).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error("错误","请选择要修改的订单");
return null;}if(b.length>1){DialogUtils.error("错误","不能同时修改多个订单");return null;}}return b;},_initSoEntitySubmit:function(){var a="soEntitySubmitGrid";var b=this;
this.soEntitySubmit=new SoEntity({grid:a,pager:"soEntitySubmitPager",tabContainer:"tabSoWaitSubmit",status:"awaiting_post",bizType:bizType,simpleShowLastFollow:this.simpleShowLastFollow,simpleShowComment:this.simpleShowComment,simpleShowProduct:this.simpleShowProduct,bindEventHandler:function(){$("body").on("click",".soEntityEdit",function(){var f=b._getSelId(a,$(this).attr("idVal"));
if(f==null){return;}var e=$("#"+a).jqGrid("getRowData",f);var c=e["soNo"];if(c.length>4){c="*"+c.substring(c.length-3,c.length);}var d=e["soType"];SoEntityUtils.submit(f,c,d);
});}});},_initConfirm:function(){var a=this;this.soEntityConfirm=new SoEntity({pager:"soEntityComfirmPager",grid:"soEntityComfirmGrid",tabContainer:"tabSoWaitComfirm",status:"awaiting_comfirm",bizType:bizType,simpleShowLastFollow:this.simpleShowLastFollow,simpleShowComment:this.simpleShowComment,simpleShowProduct:this.simpleShowProduct,bindEventHandler:function(){$("body").on("click",".soEntityComfirm",function(){var b=$(this).attr("idVal");
if(!b){b=$("#soEntityComfirmGrid").jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error("错误","请选择要审核的订单");return null;}}else{b=[b];
}var e=$("#soEntityComfirmGrid").jqGrid("getRowData",b[0]);var c=e["soNo"];var d=e["soType"];SoEntityUtils.confirm(b,c,d);});$(".soComfirmToolBtn").on("click",".lockSoBtn",function(){SoEntityUtils.lock($("#soEntityForm").find("[name=id]").val());
});$("body").on("click",".soEntityComfirmBatch",function(){var b=$("#soEntityComfirmGrid").jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error("错误","请选择要审核的订单");
return null;}DialogUtils.confirmWithOptions({title:"您确定要审核通过选中订单吗？",text:"",confirmButtonText:"确定",yesFunc:function(){a._comfirmBatch(b);}});});}});},_initPay:function(){var a="soEntityPayGrid";
var b=this;this.soEntityPay=new SoEntity({pager:"soEntityPayPager",grid:a,tabContainer:"tabSoWaitPay",status:"awaiting_pay",bizType:bizType,simpleShowLastFollow:this.simpleShowLastFollow,simpleShowComment:this.simpleShowComment,simpleShowProduct:this.simpleShowProduct,bindEventHandler:function(){$("body").on("click",".soEntityPay",function(){var d=b._getSelId(a,$(this).attr("idVal"));
if(d==null){return;}var c=$(SoEntityPay._CONS_.GRID).jqGrid("getRowData",d);if(c["soType"]=="change"){DialogUtils.error(msgCode.INFO,"换货订单财务处理请到财务管理收/付款单里面进行!");
return;}b._show(d);});$(".soPayToolBtn").on("click",".paidSoBtn",function(){b._submit($("#id").val(),$("input[name=csAccount]").val());});$(".soPayToolBtn").on("click",".lockSoBtn",function(){SoEntityUtils.lock($("#id").val());
});$(".soPayToolBtn").on("click",".trunSoBtn",function(){if($("#"+SoEntityBase._CONS_.EDIT_FORM_ID).valid()){DialogUtils.confirmWithOptions({title:"确定驳回订单吗",text:"驳回",confirmButtonText:"驳回",yesFunc:function(){b.soEntityBase.turnDownPre($("#id").val(),$("input[name=operComment]").val(),"trunSoBtn",function(){ButtonUtils.enableBtn("trunSoBtn");
b.clear(true);});}});}});}});},_initStock:function(){var a="soEntityStockGrid";var b=this;this.soEntityStock=new SoEntity({pager:"soEntityStockPager",grid:"soEntityStockGrid",tabContainer:"tabSoWaitPack",status:"comfirm",bizType:bizType,simpleShowLastFollow:this.simpleShowLastFollow,simpleShowComment:this.simpleShowComment,simpleShowProduct:this.simpleShowProduct,bindEventHandler:function(){}});
},_initShipped:function(){var a="soEntityShippedGrid";var b=this;var c="";new FormConfig({"formId":$("#tabSoShipped").find(".soEntitySearchForm"),entry:$("#tabSoShipped").find(".jt-form-config"),title:"订单已发货查询配置",isHidden:true,forceParam:["订单状态","仓库"],"endLess":[],modular:"mySoShippedSearchList"}).init();
if(bizType=="placer"){$(".soEntityShippedEdit").hide();$(".wait_end_wrapper").find(".exportSoEntityInfo").hide();$(".deliverBack").hide();$(".batchShipQryBtn").hide();
$(".batchShipQryBtn").hide();c=ResUtils.canShow("mySoEntity.button.showScTrackNo")?"can":"cannot";}else{if(bizType=="belong"){c=ResUtils.canShow("soFollow.button.showScTrackNo")?"can":"cannot";
}}this.soEntityShipped=new SoEntity({pager:"soEntityShippedPager",grid:a,tabContainer:"tabSoShipped",status:"shipping",bizType:bizType,simpleShowLastFollow:this.simpleShowLastFollow,simpleShowComment:this.simpleShowComment,canShowScTrankNo:c,bindEventHandler:function(){$("body").on("click",".soEntityShippedEdit",function(){var d=$(this).attr("idVal");
if(!d){d=$("#soEntityShippedGrid").jqGrid("getGridParam","selarrrow");if(d==null||d.length==0){DialogUtils.error("错误","请选择要跟进的订单");return null;}}else{d=[d];
}if($.isArray(d)){var g=[];for(var e=0;e<d.length;e++){var f=$("#soEntityShippedGrid").jqGrid("getRowData",d[e]);g.push(f.soNo);}SoEntityUtils._CONS_.FOLLOW(d,g);
}else{var f=$("#soEntityShippedGrid").jqGrid("getRowData",d);SoEntityUtils._CONS_.FOLLOW([d],[f.soNo]);}});$(".shipped_wrapper").on("change","select[id=shippedShipResult]",function(){if($(this).val()=="complete"||$(this).val()==""){$(".backStatusDiv").hide();
$(".rejectDiv").hide();$(".breakAmt").hide();}else{if($(this).val()=="close_lost"){$(".backStatusDiv").hide();$(".rejectDiv").hide();$(".breakAmt").show();
}else{if($(this).val()=="close_reject"){$(".backStatusDiv").show();$(".rejectDiv").show();$(".breakAmt").hide();CateUtils.getOptions({typeKey:"system",pKey:"shipRejectType",container:"rejectType"});
}}}});$(".shipped_wrapper").on("change","select[id=backBreakType]",function(){if($(this).val()=="break"){$(".breakAmt").show();}else{$("input[id=backBreakAmount]").val("0");
$("input[id=backBreakAmount]").focus();$("input[id=backBreakAmount]").blur();$(".breakAmt").hide();}});$(".shipped_wrapper").on("change","select[id=rejectTypeOne]",function(){if($(this).val()=="ship"){CateUtils.getOptions({typeKey:"system",pKey:"shipRejectType",container:"rejectType"});
}else{if($(this).val()=="cs"){CateUtils.getOptions({typeKey:"system",pKey:"csRejectType",container:"rejectType"});}else{if($(this).val()=="emp"){CateUtils.getOptions({typeKey:"system",pKey:"empRejectType",container:"rejectType"});
}else{if($(this).val()=="turn"){CateUtils.getOptions({typeKey:"system",pKey:"turnRejectType",container:"rejectType"});}}}}});$("body").on("click",".soEntityBackEdit",function(){var d=b._getSelId(a,$(this).attr("idVal"));
if(d==null){return;}b._backInfo(d);});$(".soShippedToolBtn").on("click",".saveShippedBtn",function(){var d=$("#shippedShipResult").val();if(!d){DialogUtils.error(msgCode.ERROR,"请选择发货结果");
return;}DialogUtils.confirmWithOptions({title:"您确认要保存发货结果吗？",text:"",confirmButtonText:"确认",yesFunc:function(){b._save();}});});$("body").on("click",".updateSoFollow",function(){b.soEntityBase.updateFollow();
});$("body").on("click",".soNoLink",function(){var d=$(this).attr("attr-soNo");b.loadSoDetail(d);});$("body").on("click",".preSoBtn",function(){var d="订单["+b.preSoNo+"]跟进";
var f=SoEntityUtils._CONS_.FOLLOW_PAGE+"?id="+id+"&soNo="+soNo;var e=SoEntityUtils._CONS_.FOLLOW_PAGE+"?id="+b.preSoId+"&soNo="+b.preSoNo;JTTabUtils.resetTab(f,e,d);
window.location.href=SoEntityUtils._CONS_.FOLLOW_PAGE+"?id="+b.preSoId+"&soNo="+b.preSoNo;});$("body").on("click",".nextSoBtn",function(){var d="订单["+b.nextSoNo+"]跟进";
var f=SoEntityUtils._CONS_.FOLLOW_PAGE+"?id="+id+"&soNo="+soNo;var e=SoEntityUtils._CONS_.FOLLOW_PAGE+"?id="+b.nextSoId+"&soNo="+b.nextSoNo;JTTabUtils.resetTab(f,e,d);
window.location.href=SoEntityUtils._CONS_.FOLLOW_PAGE+"?id="+b.nextSoId+"&soNo="+b.nextSoNo;});$("body").on("click",".changeEmployee",function(){b._changeEmployee();
});$("body").on("click",".batchShipQryBtn",function(){var d=$("#soEntityShippedGrid").jqGrid("getGridParam","selarrrow");if(!d||d.length<=0){d=$("#soEntityShippedGrid").jqGrid("getDataIDs");
}JTTabUtils.addOrRefreshTab(ctx+"/ec/salesorder/soEntity/shipQry/list.htm?ids="+d,"批量查物流");});$("body").on("click",".importSoStatus",function(){var d={"importUrl":SoEntityUtils._CONS_.IMPORT_EXCEL_URL,"tabTitle":"导入订单状态excel数据"};
excelUtil.importExcel(d);});}});},_initComplete:function(){var a=this;var c="";var b="";if(bizType=="placer"){b=ResUtils.canShow("mySoEntity.button.showScTrackNo")?"can":"cannot";
}else{if(bizType=="belong"){c="n";b=ResUtils.canShow("soFollow.button.showScTrackNo")?"can":"cannot";}}this.soEntityComplete=new SoEntity({pager:"soEntityCompletePager",grid:"soEntityCompleteGrid",tabContainer:"tabSoComplete",status:"complete",bizType:bizType,isReceived:c,simpleShowLastFollow:this.simpleShowLastFollow,simpleShowComment:this.simpleShowComment,simpleShowProduct:this.simpleShowProduct,canShowScTrankNo:b,allBaseType:"none",bindEventHandler:function(){$("body").on("click",".soEntityExchangeOrBack",function(){var d=$("#soEntityCompleteGrid").jqGrid("getGridParam","selarrrow");
if(d==null||d.length==0){DialogUtils.error("错误","请选择要处理的订单");return;}if(d.length>1){DialogUtils.error("错误","不能同时处理多个订单");return null;}var f=$("#soEntityCompleteGrid").jqGrid("getRowData",d);
if(f["cashType"]=="green"){DialogUtils.error("错误","绿色通道的订单不可以退换货");return;}var e=f.baseType;if("back"==e||"back_before_exchange"==e||"exchange"==e){DialogUtils.error("退换货订单无法再进行退换货!");
return;}JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.EXCHANGEORBACK_URL+"?id="+d,"退换货");});$("body").on("click",".soEntityBatchReceived",function(){var d=$("#soEntityCompleteGrid").jqGrid("getGridParam","selarrrow");
if(d==null||d.length==0){DialogUtils.error("错误","请选择要处理的订单");return;}FormUtils.submit(SoEntityUtils._CONS_.BATCHRECEIVED_URL,{ids:d},function(e){ButtonUtils.enableBtn("soEntityBatchReceived");
if(e.success){if(e.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);}else{if(e.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
}}$("#tabSoComplete").find(".soEntitySearch").click();}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);}},function(){ButtonUtils.enableBtn("soEntityBatchReceived");
DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});$("body").on("click",".importSoStatus",function(){var d={"importUrl":SoEntityUtils._CONS_.IMPORT_EXCEL_URL,"tabTitle":"导入订单状态excel数据"};
excelUtil.importExcel(d);});$("#tabSoComplete").on("click",".csEntityBatchSendSms",function(){var d=$("#soEntityCompleteGrid").jqGrid("getGridParam","selarrrow");
var k=[];if(d&&d.length>0){for(var h=0;h<d.length;h++){var j=$("#soEntityCompleteGrid").jqGrid("getRowData",d[h]);var f=j["csId"];k.push(f);}var g=new SendMessage();
var e={csIds:k};g.openBatchSendMessageView(e);}else{DialogUtils.error(msgCode.ERROR,"请选择要发短信的订单");}});}});},_initReceived:function(){var a="soEntityReceivedGrid";
var b=this;var c="";if(bizType=="belong"){c=ResUtils.canShow("soFollow.button.showScTrackNo")?"can":"cannot";}this.soEntityReceived=new SoEntity({pager:"soEntityReceivedPager",grid:a,tabContainer:"tabSoReceived",status:"complete",bizType:bizType,isReceived:"y",simpleShowLastFollow:this.simpleShowLastFollow,simpleShowComment:this.simpleShowComment,canShowScTrankNo:c,bindEventHandler:function(){$("body").on("click",".soEntityBackReceived",function(){var d=$("#soEntityReceivedGrid").jqGrid("getGridParam","selarrrow");
if(d==null||d.length==0){DialogUtils.error("错误","请选择要处理的订单");return;}FormUtils.submit(SoEntityUtils._CONS_.BACKRECEIVED_URL,{ids:d},function(e){ButtonUtils.enableBtn("soEntityBatchReceived");
if(e.success){if(e.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);}else{if(e.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
}}$("#tabSoReceived").find(".soEntitySearch").click();}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);}},function(){ButtonUtils.enableBtn("soEntityBatchReceived");
DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});});}});},_initReject:function(){var a="soEntityRejectGrid";var b=this;var c="";var d="";new FormConfig({"formId":$("#tabSoReject").find(".soEntitySearchForm"),entry:$("#tabSoReject").find(".jt-form-config"),title:"订单拒收查询配置",isHidden:true,forceParam:[],"endLess":[],modular:"mySoRejectSearchList"}).init();
if(bizType=="placer"){c=ResUtils.canShow("mySoEntity.button.showScTrackNo")?"can":"cannot";}else{if(bizType=="belong"){d="n";c=ResUtils.canShow("soFollow.button.showScTrackNo")?"can":"cannot";
}else{if(bizType=="after"){c=ResUtils.canShow("after.button.showScTrackNo")?"can":"cannot";}}}this.soEntityReject=new SoEntity({pager:"soEntityRejectPager",grid:a,tabContainer:"tabSoReject",status:"close_reject",bizType:bizType,isInbound:d,simpleShowLastFollow:this.simpleShowLastFollow,simpleShowComment:this.simpleShowComment,simpleShowProduct:this.simpleShowProduct,canShowScTrankNo:c,bindEventHandler:function(){$("body").on("click",".soEntityRefundEdit",function(){var e=b._getSelId(a,$(this).attr("idVal"));
if(e==null){return;}b._save(e);});$("body").on("click",".soEntityBatchInbound",function(){var f=$(this).attr("idVal");if(!f){f=$("#"+a).jqGrid("getGridParam","selarrrow");
if(f==null||f.length==0){DialogUtils.error("错误","请选择要修改的订单");return null;}}if(f==null){return;}var e=SoEntityUtils._CONS_.STOCK_MANY_URL;DialogUtils.confirmWithOptions({title:"确定批量入库吗？",text:"",confirmButtonText:"确定",yesFunc:function(){FormUtils.submit(e,"ids="+f,function(g){if(g.success){DialogUtils.success(msgCode.SUCCESS,"操作成功！");
$("#tabSoReject").find(".soEntitySearch").click();}else{DialogUtils.error(msgCode.FAIL_MSG,g.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}});});$("body").on("click",".importSoStatus",function(){var e={"importUrl":SoEntityUtils._CONS_.IMPORT_EXCEL_URL,"tabTitle":"导入订单状态excel数据"};excelUtil.importExcel(e);
});$("#tabSoReject").on("click",".csEntityBatchSendSms",function(){var e=$("#soEntityRejectGrid").jqGrid("getGridParam","selarrrow");var l=[];if(e&&e.length>0){for(var j=0;
j<e.length;j++){var k=$("#soEntityRejectGrid").jqGrid("getRowData",e[j]);var g=k["csId"];l.push(g);}var h=new SendMessage();var f={csIds:l};h.openBatchSendMessageView(f);
}else{DialogUtils.error(msgCode.ERROR,"请选择要发短信的订单");}});}});},_initInbound:function(){var a="soEntityInboundGrid";var b=this;var c="";if(bizType=="belong"){c=ResUtils.canShow("soFollow.button.showScTrackNo")?"can":"cannot";
}this.soEntityInbound=new SoEntity({pager:"soEntityInboundPager",grid:a,tabContainer:"tabSoInbound",status:"close_reject",bizType:bizType,isInbound:"y",simpleShowLastFollow:this.simpleShowLastFollow,simpleShowComment:this.simpleShowComment,canShowScTrankNo:c,bindEventHandler:function(){}});
},_initLost:function(){var a="soEntityLostGrid";var b=this;var c="";if(bizType=="placer"){c=ResUtils.canShow("mySoEntity.button.showScTrackNo")?"can":"cannot";
}else{if(bizType=="belong"){c=ResUtils.canShow("soFollow.button.showScTrackNo")?"can":"cannot";}else{if(bizType=="after"){c=ResUtils.canShow("after.button.showScTrackNo")?"can":"cannot";
}}}this.soEntityLost=new SoEntity({pager:"soEntityLostPager",grid:a,tabContainer:"tabSoLost",status:"close_lost",bizType:bizType,simpleShowLastFollow:this.simpleShowLastFollow,simpleShowComment:this.simpleShowComment,simpleShowProduct:this.simpleShowProduct,canShowScTrankNo:c,bindEventHandler:function(){$("body").on("click",".soEntityRefundEdit",function(){var d=b._getSelId(a,$(this).attr("idVal"));
if(d==null){return;}b._save(d);});}});$("#tabSoLost").on("click",".csEntityBatchSendSms",function(){var d=$("#soEntityLostGrid").jqGrid("getGridParam","selarrrow");
var k=[];if(d&&d.length>0){for(var h=0;h<d.length;h++){var j=$("#soEntityLostGrid").jqGrid("getRowData",d[h]);var f=j["csId"];k.push(f);}var g=new SendMessage();
var e={csIds:k};g.openBatchSendMessageView(e);}else{DialogUtils.error(msgCode.ERROR,"请选择要发短信的订单");}});},_initClose:function(){var a=this;$(".end_wrapper").find(".exportSoEntityInfo").show();
var b="";if(bizType=="placer"){b=ResUtils.canShow("mySoEntity.button.showScTrackNo")?"can":"cannot";}else{if(bizType=="after"){b=ResUtils.canShow("after.button.showScTrackNo")?"can":"cannot";
}}this.soEntityClose=new SoEntity({pager:"soEntityEndPager",grid:"soEntityEndGrid",tabContainer:"tabSoEnd",status:"close",bizType:bizType,simpleShowLastFollow:this.simpleShowLastFollow,simpleShowComment:this.simpleShowComment,simpleShowProduct:this.simpleShowProduct,canShowScTrankNo:b,bindEventHandler:function(){}});
},_initWaitRevisit:function(){var a=this;new FormConfig({"formId":$("#tabSoWaitRevisit").find(".soEntitySearchForm"),entry:$("#tabSoWaitRevisit").find(".jt-form-config"),title:"订单待回访查询配置",isHidden:true,forceParam:[],"endLess":[],modular:"mySoWaitRevisitSearchList"}).init();
this.soEntityWaitRevisit=new SoEntity({pager:"soEntityWaitRevisitPager",grid:"soEntityWaitRevisitGrid",tabContainer:"tabSoWaitRevisit",status:"close_reject,complete",otherParam:"Q__S__EQ__is_revisit_=n",bizType:bizType,simpleShowLastFollow:this.simpleShowLastFollow,simpleShowComment:this.simpleShowComment,bindEventHandler:function(){$("body").on("click",".soEntityRevisit",function(){var c=a._getSelId("soEntityWaitRevisitGrid",$(this).attr("idVal"));
if(c==null){return;}var b=$("#soEntityWaitRevisitGrid").jqGrid("getRowData",c);JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.REVISIT_PAGE_URL+"?soId="+c,"【"+b.soNo+"】回访");
});}});},_initRevisited:function(){var a=this;new FormConfig({"formId":$("#tabSoRevisited").find(".soEntitySearchForm"),entry:$("#tabSoRevisited").find(".jt-form-config"),title:"订单待回访查询配置",isHidden:true,forceParam:[],"endLess":[],modular:"mySoRevisiteSearchList"}).init();
this.soEntityRevisited=new SoEntity({pager:"soEntityRevisitedPager",grid:"soEntityRevisitedGrid",tabContainer:"tabSoRevisited",status:"close_reject,complete",otherParam:"Q__S__EQ__is_revisit_=y",bizType:bizType,simpleShowLastFollow:this.simpleShowLastFollow,simpleShowComment:this.simpleShowComment,bindEventHandler:function(){$("body").on("click",".soEntityRevisitModify",function(){var c=a._getSelId("soEntityRevisitedGrid",$(this).attr("idVal"));
if(c==null){return;}var b=$("#soEntityRevisitedGrid").jqGrid("getRowData",c);JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.REVISIT_PAGE_URL+"?soId="+c,"【"+b.soNo+"】回访");
});}});},_initBackOrExchange:function(){var a="soEntityBackOrExchangeGrid";var b=this;var c="";if(bizType=="belong"){c=ResUtils.canShow("soFollow.button.showScTrackNo")?"can":"cannot";
}this.soEntityBackOrExchange=new SoEntity({pager:"soEntityBackOrExchangePager",grid:a,tabContainer:"tabSoBackOrExchange",status:"",bizType:bizType,allBaseType:"backAndExchange",simpleShowLastFollow:this.simpleShowLastFollow,simpleShowComment:this.simpleShowComment,canShowScTrankNo:c,showOriginSo:"y",baseTypeIsBackOrExchange:"y",bindEventHandler:function(){}});
},init:function(){if(bizType==="placer"){$("#soWaitRevisitTabLi").remove();$("#tabSoWaitRevisit").remove();$("#soRevisitedTabLi").remove();$("#tabSoRevisited").remove();
$(".so-my").show();$("#soReceivedTabLi").show();$("#soInboundTabLi").show();this._initSearch();this._initSoEntitySubmit();this._initConfirm();this._initPay();
this._initStock();this._initShipped();this._initComplete();this._initReject();this._initLost();this._initClose();this._initReceived();this._initInbound();
this.soEntitySearch.init();this._initBackOrExchange();}else{if(bizType==="belong"){$("#soWaitRevisitTabLi").remove();$("#tabSoWaitRevisit").remove();$("#soRevisitedTabLi").remove();
$("#tabSoRevisited").remove();$("#soShippedTabLi").prevAll().remove();$("#tabSoShipped").prevAll().remove();$("#soEndTabLi").remove();$("#tabSoEnd").remove();
$("#soShippedTabLi").addClass("active");$("#tabSoShipped").addClass("active");$(".so-follow").show();this._initShipped();this._initComplete();this._initReject();
this._initLost();this._initReceived();this._initInbound();this.soEntityShipped.init();this._initBackOrExchange();}else{if(bizType==="after"){$("#soRejectTabLi").prevAll().remove();
$("#tabSoReject").prevAll().remove();$("#soRejectTabLi").addClass("active");$("#tabSoReject").addClass("active");$(".so-reject").show();this._initReject();
this._initLost();this._initClose();this.soEntityReject.init();$("#backOrExchangeTabLi").remove();}else{if(bizType==="revisit"){$("#soWaitRevisitTabLi").prevAll().remove();
$("#tabSoWaitRevisit").prevAll().remove();$("#soWaitRevisitTabLi").addClass("active");$("#tabSoWaitRevisit").addClass("active");$(".so-revisit").show();
this._initWaitRevisit();this._initRevisited();this.soEntityWaitRevisit.init();$("#backOrExchangeTabLi").remove();}}}}this._initEmployeeSelect();this._initPlacerEmployeeSelect();
this._hideNotGrantBtn();ShipCompanyUtils.getOptions({container:"scCodeQry",caption:"全部"});ChannelUtils.getOptions({container:"srcQry",caption:"全部"});ChannelUtils.getOptions({container:"soSrcQry",caption:"全部"});
CashSettingUtils.getOptions({container:"cashSearch",caption:"全部"});StoreUtils.loadData({container:"storeSearch",isSale:false});CateUtils.getOptions([{typeKey:"system",pKey:"CsInterestType",container:"interestsQry"},{typeKey:"system",pKey:"CsInterestType",container:"soInterestQry"},{typeKey:"system",pKey:"soFollowStatus",container:"followQry"},{typeKey:"system",pKey:"soEntityStoreName",container:"storeNameSearch"}]);
CateUtils.findCatePos({typeKey:"soEntity",pKey:"soType",container:"soTypeQry"});this._bindEventHandler();if(!this.isUseReturnBack){$("#soReceivedTabLi").remove();
$("#soInboundTabLi").remove();$(".soEntityBatchReceived").remove();$(".soEntityBatchInbound").remove();}},_hideNotGrantBtn:function(){if(!ResUtils.canShow("soFollow.button.follow")){$(".soEntityShippedEdit").hide();
}if(!ResUtils.canShow("soFollow.button.backDeliver")){$(".deliverBack").hide();}if(!ResUtils.canShow("soEntity.button.submit")){$(".soEntityEdit").hide();
}if(!ResUtils.canShow("soEntity.button.close")){$(".soEntityClose").hide();}if(!ResUtils.canShow("soEntity.button.turndown")){$(".soEntityTrunDown").hide();
}if(!ResUtils.canShow("mySoEntity.button.exportShip")&&!ResUtils.canShow("soFollow.button.exportDeliver")){$(".exportSoEntityInfo").hide();}if(!ResUtils.canShow("soEntity.button.exchangeOrBack")&&!ResUtils.canShow("soFollow.button.exchangeOrBack")){$(".soEntityExchangeOrBack").hide();
}if(bizType==="placer"||!ResUtils.canShow("soFollow.button.batchReceived")){$(".soEntityBatchReceived").hide();}if(!ResUtils.canShow("soFollow.button.batchSms")){$(".csEntityBatchSendSms").hide();
}if(bizType==="placer"||!ResUtils.canShow("soFollow.button.backReceived")){$(".soEntityBackReceived").hide();}if(bizType==="placer"||bizType==="after"||!ResUtils.canShow("soFollow.button.batchInbound")){$(".soEntityBatchInbound").hide();
}if(bizType==="placer"||!ResUtils.canShow("soFollow.button.importSoStatus")){$(".importSoStatus").hide();}if(bizType==="placer"||(!ResUtils.canShow("soFollow.button.backComplete")&&!ResUtils.canShow("soEntityReject.button.backComplete"))){$(".soEntityBackComplete").hide();
}if(!ResUtils.canShow("soEntity.button.delete")&&!ResUtils.canShow("soEntityReject.button.delete")&&!ResUtils.canShow("soFollow.button.delete")){$(".soEntityDelete").hide();
}if(!ResUtils.canShow("soRevisit.button.revisit")){$(".soEntityRevisit").hide();}if(!ResUtils.canShow("soRevisit.button.modify")){$(".soEntityRevisitModify").hide();
}if(!ResUtils.canShow("soDeliver.button.batchShipQry")){$(".batchShipQryBtn").hide();}},_initEmployeeSelect:function(b,a){FormUtils.loadData(ctx+"/crm/ou/employee/listEmployees.htm"+"?groupId="+b+"",function(d){if(a){$("#belongEmployee"+a).empty();
}else{$(".belongEmployee").empty();}var e=new StringBuffer();e.append('<select class="form-control " name="belongEmployee" style="width: 100%;">');e.append('<option value="">请选择</option>');
if(d&&d.length>0){for(var c=0;c<d.length;c++){e.append("<option value='"+d[c].id+"'>"+d[c].aid+":"+d[c].name+"</option>");}}e.append("</select>");if(a){$("#belongEmployee"+a).append($(e.toString())).find("select").select2();
}else{$(".belongEmployee").append($(e.toString())).find("select").select2();}},null,true);},_initPlacerEmployeeSelect:function(b,a){FormUtils.loadData(ctx+"/crm/ou/employee/listEmployees.htm"+"?groupId="+b+"",function(d){if(a){$("#placerSearch"+a).empty();
}else{$(".placerSearch").empty();}var e=new StringBuffer();e.append('<select class="form-control " name="limitPlacerStr" style="width: 100%;">');e.append('<option value="">请选择</option>');
if(d&&d.length>0){for(var c=0;c<d.length;c++){e.append("<option value='"+d[c].id+"'>"+d[c].aid+":"+d[c].name+"</option>");}}e.append("</select>");if(a){$("#placerSearch"+a).append($(e.toString())).find("select").select2();
}else{$(".placerSearch").append($(e.toString())).find("select").select2();}},null,true);},_bindEventHandler:function(){var a=this;$(".selectPlacer").on("click",function(){var c=$(this).attr("id");
c=c.substring(c.indexOf("-"));var b={isMultiple:1,selectedGroupId:$("#belongOgnPlacerHide"+c).val(),container:"belongOgnPlacer"+c,nolimit:true,positionType:"order_print,dept_manager",fn:function(d){$("#belongOgnPlacerHide"+c).val(d);
a._initPlacerEmployeeSelect(d,c);}};GroupUtils.selectGroupTreeBox(b);});$(".selectBelongOgn").on("click",function(){var b=$(this).attr("id");b=b.substring(b.indexOf("-"));
GroupUtils.selectGroupTreeBox({isMultiple:1,selectedGroupId:$("#belongOgn"+b).val(),container:"belongOgnName"+b,fn:function(c){$("#belongOgn"+b).val(c);
a._initEmployeeSelect(c,b);}});});$(".tabs-container").on("click",".tabli",function(){var b=$(this).attr("id");switch(b){case"soAllTabLi":if(!a.soEntitySearch.isInit){a.soEntitySearch.init();
}break;case"soWaitSubmitTabLi":if(!a.soEntitySubmit.isInit){a.soEntitySubmit.init();new FormConfig({"formId":$("#tabSoWaitSubmit").find(".soEntitySearchForm"),entry:$("#tabSoWaitSubmit").find(".jt-form-config"),title:"订单待提交查询配置",isHidden:true,forceParam:["订单状态","仓库"],"endLess":[],modular:"mySoWaitSubmitSearchList"}).init();
}break;case"soWaitComfirmTabLi":if(!a.soEntityConfirm.isInit){a.soEntityConfirm.init();new FormConfig({"formId":$("#tabSoWaitComfirm").find(".soEntitySearchForm"),entry:$("#tabSoWaitComfirm").find(".jt-form-config"),title:"订单待审核查询配置",isHidden:true,forceParam:["订单状态","仓库"],"endLess":[],modular:"mySoWaitComfirmSearchList"}).init();
}break;case"soWaitPayTabLi":if(!a.soEntityPay.isInit){a.soEntityPay.init();new FormConfig({"formId":$("#tabSoWaitPay").find(".soEntitySearchForm"),entry:$("#tabSoWaitPay").find(".jt-form-config"),title:"订单待收款查询配置",isHidden:true,forceParam:["订单状态","仓库"],"endLess":[],modular:"mySoWaitPaySearchList"}).init();
}break;case"soWaitPackTabLi":if(!a.soEntityStock.isInit){a.soEntityStock.init();new FormConfig({"formId":$("#tabSoWaitPack").find(".soEntitySearchForm"),entry:$("#tabSoWaitPack").find(".jt-form-config"),title:"订单待发货查询配置",isHidden:true,forceParam:["订单状态","仓库"],"endLess":[],modular:"mySoWaitPackSearchList"}).init();
}break;case"soShippedTabLi":if(!a.soEntityShipped.isInit){a.soEntityShipped.init();}break;case"soCompleteTabLi":if(!a.soEntityComplete.isInit){a.soEntityComplete.init();
new FormConfig({"formId":$("#tabSoComplete").find(".soEntitySearchForm"),entry:$("#tabSoComplete").find(".jt-form-config"),title:"订单已签收查询配置",isHidden:true,forceParam:["订单状态","仓库"],"endLess":[],modular:"mySoCompleteSearchList"}).init();
}break;case"soReceivedTabLi":if(!a.soEntityReceived.isInit){a.soEntityReceived.init();new FormConfig({"formId":$("#tabSoReceived").find(".soEntitySearchForm"),entry:$("#tabSoReceived").find(".jt-form-config"),title:"订单已回款查询配置",isHidden:true,forceParam:[],"endLess":[],modular:"mySoReceivedSearchList"}).init();
}break;case"soRejectTabLi":if(!a.soEntityReject.isInit){a.soEntityReject.init();}break;case"soInboundTabLi":if(!a.soEntityInbound.isInit){a.soEntityInbound.init();
new FormConfig({"formId":$("#tabSoInbound").find(".soEntitySearchForm"),entry:$("#tabSoInbound").find(".jt-form-config"),title:"订单已退库查询配置",isHidden:true,forceParam:[],"endLess":[],modular:"mySoInboundSearchList"}).init();
}break;case"backOrExchangeTabLi":if(!a.soEntityBackOrExchange.isInit){a.soEntityBackOrExchange.init();new FormConfig({"formId":$("#tabSoBackOrExchange").find(".soEntitySearchForm"),entry:$("#tabSoBackOrExchange").find(".jt-form-config"),title:"订单退换货查询配置",isHidden:true,forceParam:[],"endLess":[],modular:"mySoBackOrExchangeSearchList"}).init();
}break;case"soLostTabLi":if(!a.soEntityLost.isInit){a.soEntityLost.init();new FormConfig({"formId":$("#tabSoLost").find(".soEntitySearchForm"),entry:$("#tabSoLost").find(".jt-form-config"),title:"订单丢失查询配置",isHidden:true,forceParam:["订单状态","仓库"],"endLess":[],modular:"mySoLostSearchList"}).init();
}break;case"soEndTabLi":if(!a.soEntityClose.isInit){a.soEntityClose.init();new FormConfig({"formId":$("#tabSoEnd").find(".soEntitySearchForm"),entry:$("#tabSoEnd").find(".jt-form-config"),title:"订单关闭查询配置",isHidden:true,forceParam:[],"endLess":[],modular:"mySoEndSearchList"}).init();
}break;case"soWaitRevisitTabLi":if(!a.soEntityWaitRevisit.isInit){a.soEntityWaitRevisit.init();}break;case"soRevisitedTabLi":if(!a.soEntityRevisited.isInit){a.soEntityRevisited.init();
}break;}});},};$(function(){var a=new SoEntityManager();a.init();});