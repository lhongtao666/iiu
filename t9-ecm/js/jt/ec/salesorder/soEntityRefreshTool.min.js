function SoEntityRefreshTool(){this.hadInit=false;this.intervalId=null;this.parentElem=null;this.callBackFunc=null;}SoEntityRefreshTool.prototype={init:function(b){if(!this.hadInit){this.hadInit=true;
this._initParam(b);this._bindEventHandler();var a=this.parentElem==null?$(SoEntityRefreshTool._CONS_.REFRESH_BUTTON_CLASS).first():$(this.parentElem).find(SoEntityRefreshTool._CONS_.REFRESH_BUTTON_CLASS).first();
a.attr("disabled",true);this._intervalRefresh(parseInt(a.attr("val")),a.attr(SoEntityRefreshTool._CONS_.REFRESH_ATTR_TIME_TYPE));}},_initParam:function(a){if(a){if(a.refreshBtnParent){this.parentElem=a.refreshBtnParent;
}if(a.callBackFunc){this.callBackFunc=a.callBackFunc;}else{throw new Error("callBack参数不能为空");}}},_bindEventHandler:function(){var a=this;$(a.parentElem!=null?a.parentElem:"body").on("click",SoEntityRefreshTool._CONS_.REFRESH_BUTTON_CLASS,function(){var b=parseInt($(this).attr("val"));
if(b==20160807){a.refreshEdit(a,$(this).offset().top+40,$(this).offset().left);return;}if(a.parentElem==null){$(SoEntityRefreshTool._CONS_.REFRESH_BUTTON_CLASS).attr("disabled",false);
}else{$(this.parentElem).find(SoEntityRefreshTool._CONS_.REFRESH_BUTTON_CLASS).attr("disabled",false);}$(this).attr("disabled",true);a._intervalRefresh(b,$(this).attr(SoEntityRefreshTool._CONS_.REFRESH_ATTR_TIME_TYPE));
});},intervalRefresh:function(){var a=this.parentElem==null?$(SoEntityRefreshTool._CONS_.REFRESH_SHOW_CLASS):$(this.parentElem).find(SoEntityRefreshTool._CONS_.REFRESH_SHOW_CLASS).first();
this._intervalRefresh(parseInt(a.attr("val")),a.attr("timeType"));},_intervalRefresh:function(b,d){if(this.intervalId!=null){clearInterval(this.intervalId);
this.intervalId=null;}var c=this.parentElem==null?$(SoEntityRefreshTool._CONS_.REFRESH_SHOW_CLASS):$(this.parentElem).find(SoEntityRefreshTool._CONS_.REFRESH_SHOW_CLASS).first();
c.attr("val",b);c.attr(SoEntityRefreshTool._CONS_.REFRESH_ATTR_TIME_TYPE,d);var a=d=="m"?60:d=="s"?1:3600;if(b!=0){c.html(b+(d=="m"?"分钟":d=="s"?"秒":"小时"));
this.intervalId=setInterval(this.callBackFunc,b*a*1000);}else{c.html("不刷新");}},refreshEdit:function(c,b){var a=this;layer.open({type:1,title:["定义自动刷新时间","color:#1ab394;font-size: 13px;"],maxmin:false,closeBtn:false,shadeClose:false,btn:["确定","取消"],area:["300px","170px"],offset:[c+"px",b+"px"],scrollbar:false,content:SoEntityRefreshTool._CONS_.REFRESH_EDIT_LAYER_CONTENT,success:function(){var d={rules:{refreshInt:{required:true,digits:true,min:1}}};
FormUtils.bindFormValidation("refreshTimeForm",d);},yes:function(e,d){if($("#refreshTimeForm").valid()){a._intervalRefresh(parseInt($("input[name=refreshInt]").val()),$("select[name=refreshTimeType]").val());
if(a.parentElem==null){$(SoEntityRefreshTool._CONS_.REFRESH_BUTTON_CLASS).attr("disabled",false);}else{$(a.parentElem).find(SoEntityRefreshTool._CONS_.REFRESH_BUTTON_CLASS).attr("disabled",false);
}layer.close(e);}},no:function(){FormUtils.clear("refreshTimeForm");}});},};SoEntityRefreshTool._CONS_={REFRESH_BUTTON_CLASS:".refreshTime",REFRESH_ATTR_TIME_TYPE:"timeType",REFRESH_SHOW_CLASS:".refreshName",REFRESH_EDIT_LAYER_CONTENT:"<form id='refreshTimeForm' class='form-horizontal' >			<div class='col-sm-12 ' style='padding:5px 5px 43px 5px;border: 1px solid #e7e7e7;'>			<div class='col-sm-8'>			<input type='text'  placeholder='请输入正整数' id='refreshInt' name='refreshInt' class='form-control' validateType='default'>			</div>			<div class='col-sm-4'>			<select  name='refreshTimeType' class='form-control'>			<option value='s'>秒</option>			<option value='m' selected>分钟</option>			<option value='h'>小时</option>			</select>			</div>			</div>			</form>"};
