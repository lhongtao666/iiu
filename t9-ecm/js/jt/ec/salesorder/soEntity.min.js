function SoEntity(a){this.grid="#"+a.grid;this.pager="#"+a.pager;this.hasInitJqgrid=false;this.getManagerBtns=a.getManagerBtns?a.getManagerBtns:function(){return[];
};this.status=a.status;this.otherParam=a.otherParam;this.bindEventHandler=a.bindEventHandler?a.bindEventHandler:function(){};this.tabContainer="#"+a.tabContainer;
this.bizType=a.bizType?a.bizType:"";this.canShowScTrankNo=a.canShowScTrankNo;this.simpleShowLastFollow=a.simpleShowLastFollow,this.simpleShowComment=a.simpleShowComment,this.simpleShowProduct=a.simpleShowProduct,this.simpleShowProductSum=(simpleShowProductSum=="n"?false:true);
this.isUseReturnBack=(isUseReturnBack=="n"?false:true);this.showOriginSo=a.showOriginSo;this.isInbound=a.isInbound,this.isReceived=a.isReceived,this.soTypeCatePos=null;
this.isInit=false;this.isSearch=false;this.allBaseType=a.allBaseType;}SoEntity._CONS_={};SoEntity.prototype={init:function(){if(!this.isInit){this.isInit=true;
this._initData();this._initJqgrid();this._bindEventHandler();this._locateToGlHelp();}},_locateToGlHelp:function(){var a=this;if(a.bizType=="placer"){if(a.pager=="#soEntityMgrPager"){var b="glHelp.soEntity.selectOrder";
}else{var b="glHelp.soEntity.mySoEntity";}}else{if(a.bizType=="belong"){var b="glHelp.soEntity.soFollow";}else{if(a.bizType=="revisit"){var b="glHelp.soEntity.soRevisit";
}else{if(a.bizType=="after"){var b="glHelp.soEntity.soReject";}else{var b="lHelp.soEntity.soAudit";}}}}glHelpUtil.init(b);},_initData:function(){CateUtils.findCatePos({typeKey:"soEntity",pKey:"soType",fn:function(a){soTypeCatePos=a;
},});},_bilidSoStatusSearch:function(d,a,b){var c=new StringBuffer();$(a.tabContainer).find(".soStatusSearch option:selected").each(function(e){c.append($(this).val());
if(e==b-1){return false;}else{c.append(",");}});d=d+"&soStatusSearch="+c.toString();return d;},_bilidScCodeQrySearch:function(c,a,b){var d=new StringBuffer();
$(a.tabContainer).find(".scCodeQry option:selected").each(function(e){d.append($(this).val());if(e==b-1){return false;}else{d.append(",");}});c=c+"&scCodeQry="+d.toString();
return c;},_bilidSrcQrySearch:function(d,b,c){var a=new StringBuffer();$(b.tabContainer).find(".srcQry option:selected").each(function(e){a.append($(this).val());
if(e==c-1){return false;}else{a.append(",");}});d=d+"&srcQry="+a.toString();return d;},_bilidCashTypeSearch:function(d,a,c){var b=new StringBuffer();$(a.tabContainer).find(".cashType option:selected").each(function(e){b.append($(this).val());
if(e==c-1){return false;}else{b.append(",");}});d=d+"&cashType="+b.toString();return d;},_bilidPayTypeSearch:function(d,a,c){var b=new StringBuffer();$(a.tabContainer).find(".payType option:selected").each(function(e){b.append($(this).val());
if(e==c-1){return false;}else{b.append(",");}});d=d+"&payType="+b.toString();return d;},_fillBackExchangeOrderInfo:function(a,c,b){var d={csId:a,employeeId:c,csType:type,permissionType:b,showThirdSoNo:showThirdSoNo};
this.csOrder.init(d);},_bindEventHandler:function(){var a=this;this.bindEventHandler();var b=new SoEntityRefreshTool();b.init({callBackFunc:function(){$("#tabSoReject").find(".soEntitySearch").click();
$(".soEntitySearchForm").find(".soEntitySearch").click();}});$(".soEntityReload").on("click",function(){$(this).parents(".tab-pane").find(".soEntitySearch").trigger("click");
});$(document).on("change",a.tabContainer+" #skuSearch",function(){var c=$(a.tabContainer).find("input[id=skuSearch]").val();if(c==""){$(a.tabContainer).find("input[id=skuSearch]").attr("skuId","");
}});$(document).on("change",a.tabContainer+" .lastFollow",function(){var c=$(this)[0].checked;if(c){a.simpleShowLastFollow=true;$(this).parents(".jqGrid_wrapper").find(".tooltip-follow").show();
$(this).parents(".jqGrid_wrapper").find(".lastFollow-detail").hide();window.localStorage.removeItem(a.grid.substring(1)+"Config");}else{a.simpleShowLastFollow=false;
$(this).parents(".jqGrid_wrapper").find(".tooltip-follow").hide();$(this).parents(".jqGrid_wrapper").find(".lastFollow-detail").show();window.localStorage.setItem(a.grid.substring(1)+"Config","n");
}});$(document).on("change",a.tabContainer+" .orderDesc",function(){var c=$(this)[0].checked;if(c){a.simpleShowComment=true;$(this).parents(".jqGrid_wrapper").find(".tooltip-comment").show();
$(this).parents(".jqGrid_wrapper").find(".comment-detail").hide();}else{a.simpleShowComment=false;$(this).parents(".jqGrid_wrapper").find(".tooltip-comment").hide();
$(this).parents(".jqGrid_wrapper").find(".comment-detail").show();}});$(document).on("change",a.tabContainer+" .productShow",function(){var c=$(this)[0].checked;
if(c){a.simpleShowProduct=true;$(this).parents(".jqGrid_wrapper").find(".tooltip-product").show();$(this).parents(".jqGrid_wrapper").find(".product-detail").hide();
}else{a.simpleShowProduct=false;$(this).parents(".jqGrid_wrapper").find(".tooltip-product").hide();$(this).parents(".jqGrid_wrapper").find(".product-detail").show();
}});$(document).on("change",a.tabContainer+" .productShowSum",function(){var c=$(this)[0].checked;if(c){a.simpleShowProductSum=true;var d=$(a.grid).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow").hide();
$(window).resize();}else{a.simpleShowProductSum=false;var d=$(a.grid).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow").show();$(window).resize();
}});$(a.tabContainer).on("click",".soEntityDelete",function(){var c=$(a.grid).jqGrid("getGridParam","selarrrow");if(!c||c.length<=0){DialogUtils.error("提示","请选择要删除的订单");
return false;}SoEntityUtils.deleteSoEntity(c);});$(a.tabContainer).on("click",".exportSoEntityInfo",function(){var g=a._getParams()+"&"+$(a.tabContainer).find(".soEntitySearchForm").closest("form").serialize();
if($(a.tabContainer).find("input[name='skuKeyQry']").val()!=""&&$(a.tabContainer).find("input[name='skuKeyQry']").attr("skuId")!=""){g=g+"&skuId="+$(a.tabContainer).find("input[name='skuKeyQry']").attr("skuId");
}var i=$(a.tabContainer).find(".soStatusSearch option:selected").length;if(i!=0){g=a._bilidSoStatusSearch(g,a,i);}var f=$(a.tabContainer).find(".scCodeQry option:selected").length;
if(f!=0){g=a._bilidScCodeQrySearch(g,a,f);}var e=$(a.tabContainer).find(".srcQry option:selected").length;if(e!=0){g=a._bilidSrcQrySearch(g,a,e);}var k=$(a.tabContainer).find(".cashType option:selected").length;
if(k!=0){g=a._bilidCashTypeSearch(g,a,k);}var j=$(a.tabContainer).find(".payType option:selected").length;if(j!=0){g=a._bilidPayTypeSearch(g,a,j);}var d=$(a.grid).jqGrid("getGridParam","records");
var h=$(a.grid).jqGrid("getGridParam","selarrrow");var c=new SoEntityExport();c.init({params:g,selectIds:h,toatolCount:d});});$(a.tabContainer).on("click",".soEntitySearch",function(){if(!$(a.tabContainer).find("input[name='Q__D__BW__entity.place_time_']").val()&&!$(a.tabContainer).find("input[name='Q__D__BW__entity.confirm_time_']").val()&&!$(a.tabContainer).find("input[name='Q__D__BW__entity.ship_time_']").val()&&!$(a.tabContainer).find("input[name='Q__D__BW__entity.complete_time_']").val()&&!$(a.tabContainer).find("input[name='Q__D__BW__entity.reject_time_']").val()&&!$(a.tabContainer).find("input[name='csCreateBeginTimeQry']").val()&&!$(a.tabContainer).find("input[name='Q__D__BW__entity.received_time_']").val()&&!$(a.tabContainer).find("input[name='Q__D__BW__entity.inbound_time_']").val()&&!$(a.tabContainer).find("input[name='Q__D__BW__entity.close_time_']").val()){DialogUtils.error("错误","请填写开始时间");
return;}var h=$(this).closest("form").serialize();if($(a.tabContainer).find("input[name='skuKeyQry']").val()!=""&&$(a.tabContainer).find("input[name='skuKeyQry']").attr("skuId")!=""){h=h+"&skuId="+$(a.tabContainer).find("input[name='skuKeyQry']").attr("skuId");
}var d=$(a.tabContainer).find(".soStatusSearch option:selected").length;if(d!=0){h=a._bilidSoStatusSearch(h,a,d);}var c=$(a.tabContainer).find(".scCodeQry option:selected").length;
if(c!=0){h=a._bilidScCodeQrySearch(h,a,c);}var e=$(a.tabContainer).find(".srcQry option:selected").length;if(e!=0){h=a._bilidSrcQrySearch(h,a,e);}var g=$(a.tabContainer).find(".cashType option:selected").length;
if(g!=0){h=a._bilidCashTypeSearch(h,a,g);}var f=$(a.tabContainer).find(".payType option:selected").length;if(f!=0){h=a._bilidPayTypeSearch(h,a,f);}a.reloadJqgrid(h);
});$(a.tabContainer).on("click",".soEntityClearSearch",function(){$(a.tabContainer).find("input[id=soNoSearch]").val("");$(a.tabContainer).find("input[name=skuKeyQry]").val("");
$(a.tabContainer).find("input[name=skuKeyQry]").attr("skuId","");$(a.tabContainer).find("select[name='belongEmployee']").val("").select2();FormUtils.clear($(a.tabContainer).find("form"));
$(a.tabContainer).find(".search-choice").remove();});$(a.tabContainer).on("keypress","form",function(c){if(c.keyCode=="13"){$(a.tabContainer).find(".soEntitySearch").click();
}});$(a.tabContainer).on("click",".showSearch",function(){$(this).closest("form").find(".hideSearchParam").show();$(this).closest("form").find(".hideSearch").show();
$(this).hide();$(this).closest("form").find(".chosen-select").chosen("destroy").chosen();if($("#soCompleteTabLi").hasClass("active")){$("#csPhoneDiv").show();
}else{$("#csPhoneDiv").hide();}});$(a.tabContainer).on("click",".hideSearch",function(){$(this).closest("form").find(".hideSearchParam").hide();$(this).closest("form").find(".showSearch").show();
$(this).hide();});$(a.tabContainer).on("click",".soTab",function(){var s=$(this).attr("csNameVal");var g=$(this).attr("value");var d=$(this).attr("idVal");
var r=$(this).attr("soType");var j=$(this).attr("cashType");var f=$(this).attr("isDetail");var m=$(this).attr("status");var e=(a.canModifyProfit&&m!="complete"&&m!="close_lost"&&m!="close_reject"&&m!="close")?"can":"cannot";
var h=(a.canShowScTrankNo)?a.canShowScTrankNo:"";if(("#soEntitySubmitGrid"==a.grid||m=="awaiting_post")&&ResUtils.canShow("soEntitySubmit.url")){SoEntityUtils.submit(d,g,r);
}else{if(("#soEntityComfirmGrid"==a.grid||m=="awaiting_comfirm")&&ResUtils.canShow("soEntityComfirm.url")){var k=[];var c=$(a.grid).getRowData();var q=false;
if(c&&c.length>0){for(var o=0;o<c.length;o++){if(c[o].id==d){q=true;}if(q){k.push(c[o].id);}}}SoEntityUtils.confirm(k,g,r);}else{if(("#soEntityShippedGrid"==a.grid||m=="shipping")&&ResUtils.canShow("soEntity.url")){var k=[];
var l=[];var c=$(a.grid).getRowData();var q=false;if(c&&c.length>0){for(var o=0;o<c.length;o++){if(c[o].id==d){q=true;}if(q){k.push(c[o].id);l.push(c[o].soNo);
}}}window.localStorage.setItem("follow_so_ids_"+currentUserId,k.toString());window.localStorage.setItem("follow_so_nos_"+currentUserId,l.toString());JTTabUtils.addOrRefreshTab(ctx+"/ec/salesorder/soEntity/toFollow.htm"+"?soId="+k[0]+"&soNo="+l[0],"订单["+l[0]+"]跟进");
}else{if("#soEntityWaitRevisitGrid"==a.grid){JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.REVISIT_PAGE_URL+"?soId="+d,"【"+g+"】回访");}else{if("#soEntityRevisitedGrid"==a.grid&&ResUtils.canShow("soRevisit.button.modify")){JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.REVISIT_PAGE_URL+"?soId="+d,"【"+g+"】回访");
}else{if("comfirm"==m&&ResUtils.canShow("soEntityStock.url  ")){var p=[];var c=$(a.grid).getRowData();var q=false;if(c&&c.length>0){for(var o=0;o<c.length;
o++){if(c[o].id==d){q=true;}if(q){var n={id:c[o].id,soNo:c[o].soNo};p.push(n);}}}SoEntityUtils.toDeliver(p);}else{var l=[];var t=[];var c=$(a.grid).getRowData();
var q=false;if(c&&c.length>0){for(var o=0;o<c.length;o++){if(c[o].id==d){q=true;}if(q){l.push(c[o].soNo);t.push(c[o].csName);}}}window.localStorage.setItem("detail_so_soNos"+currentUserId,l.toString());
window.localStorage.setItem("detail_cs_names"+currentUserId,t.toString());window.localStorage.setItem("detail_canModifyProfit"+currentUserId,e);window.localStorage.setItem("detail_canShowScTrankNo"+currentUserId,h);
JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.DETAIL_PAGE_URL+"?soNo="+g+"&canModifyProfit="+e+"&canShowScTrankNo="+a.canShowScTrankNo,g+"的订单明细");}}}}}}});
$(a.tabContainer).on("click",".csTab",function(){var d=$(this).text();var c=$(this).attr("value");if(d.length>4){d="*"+d.substring(d.length-3,d.length);
}JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.DETAIL_CS_PAGE_URL+"?csId="+c,"客户["+d+"]明细");});$(a.tabContainer).on("click",".soFinanceBillTab",function(){if(ResUtils.canShow("soEntity.button.financeBillDetail")){var d=$(this).attr("noValue");
var c=$(this).attr("value");if(d.length>4){d="*"+d.substring(d.length-3,d.length);}JTTabUtils.addOrRefreshTab(ctx+"/ec/finance/financeBill/showList.htm"+"?soId="+c,"订单["+d+"]财务");
}});$(a.tabContainer).on("click",".skuSearchImg",function(){SelectProdService.selectSku({isMultiple:0,hideCanSale:"y",fn:function(c){for(var d=0;d<c.length;
d++){$(a.tabContainer).find("input[id=skuSearch]").val(c[d].skuCode);$(a.tabContainer).find("input[id=skuSearch]").attr("skuId",c[d].skuId);}}});});$(a.tabContainer).on("click",".soEntityClose",function(){var c=$(a.grid).jqGrid("getGridParam","selarrrow");
if(c==null||c.length==0){DialogUtils.error("错误","请选择要处理的订单");return;}var f=new Array();for(var d=0;d<c.length;d++){var e=$(a.grid).jqGrid("getRowData",c[d]);
f.push(e["soNo"]);}SoEntityUtils.closeOrderLayer(c,f);});$(a.tabContainer).on("click",".soEntityTrunDown",function(){var c=$(a.grid).jqGrid("getGridParam","selarrrow");
if(c==null||c.length==0){DialogUtils.error("错误","请选择要处理的订单");return;}var f=new Array();for(var d=0;d<c.length;d++){var e=$(a.grid).jqGrid("getRowData",c[d]);
f.push(e["soNo"]);}SoEntityUtils.trunDownOrderLayer(c,f);});$(a.tabContainer).on("click",".soEntityBackComplete",function(){var c=$(a.grid).jqGrid("getGridParam","selarrrow");
if(c==null||c.length==0){DialogUtils.error("错误","请选择要处理的订单");return;}DialogUtils.confirmWithOptions({title:"确定撤销发货结果吗？",text:"",confirmButtonText:"确认",yesFunc:function(){a._backComplete(c);
}});});$(a.tabContainer).on("click",".deliverBack",function(){var d=$(a.grid).jqGrid("getGridParam","selarrrow");if(d.length>1){DialogUtils.error("错误","不能同时驳回多个订单");
return false;}var c=$(a.grid).jqGrid("getRowData",d);if(c.status!="shipping"){DialogUtils.error("错误","必须已发货状态才可撤销");return false;}SoEntityUtils.backDeliver(d,function(){var e=[];
var f={id:d,soNo:c.soNo};e.push(f);SoEntityUtils.toDeliver(e);});});$(document).on("click","#servicePhoneBtn",function(d){var c=$(this).attr("masknum");
if(c&&c!=""){if(c.startsWith("020")){c=c.substring(3);}window.top.jtCtiService.dialout("9"+c);}else{DialogUtils.error(msgCode.ERROR,"没有此快递公司的客服电话");return;
}});},_backComplete:function(b){var a=this;FormUtils.submit(SoEntityUtils._CONS_.BACK_COMPLETE_URL,"ids="+b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,c.msg);
$(a.tabContainer).find(".soEntitySearch").click();}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});},reloadJqgrid:function(a,b){JTJqgridUtils.reloadJqgrid(this.grid,a);if(b){this.selectedId=b;}else{this.selectedId=null;}},_getParams:function(){var a=this;
var b="";if(a.status&&a.status.indexOf(",")!=-1){b="Q__S__IN__entity.status_="+a.status;}else{if(a.status==null||a.status==""){b="1=1";}else{b="Q__S__EQ__entity.status_="+a.status;
}}if(a.otherParam&&a.otherParam!=""){b=b+"&"+a.otherParam;}b=b+"&bizType="+a.bizType;b=b+"&canShowScTrankNo="+a.canShowScTrankNo;if(this.isReceived){b+="&Q__S__EQ__entity.is_received_="+a.isReceived;
}if(this.isInbound){b+="&Q__S__EQ__entity.is_inbound_="+a.isInbound;}if(a.grid=="#soEntityDelayComfirmGrid"){b+="&Q__S__EQ__entity.is_delay_="+"y";}else{if(a.grid=="#soEntityComfirmGrid"){b+="&Q__S__EQ__entity.is_delay_="+"n";
}}if(a.allBaseType&&(a.grid=="#soEntityBackOrExchangeGrid"||a.grid=="#soEntityCompleteGrid")){b+="&allBaseType="+a.allBaseType;}return b;},_initJqgrid:function(){var k=this;
var h=k.status;var j=true;var b=true;var e=false;var c=true;var l=true;if(h=="complete"){j=false;}if(typeof(isFollowHide)=="undefined"){c=true;}else{if("y"==isFollowHide){c=false;
}}if(this.grid=="#soEntityShippedGrid"||this.grid=="#soEntityRepeatGrid"||this.grid=="#soEntityCompleteGrid"||this.grid=="#soEntityLostGrid"||this.grid=="#soEntityRejectGrid"||this.grid=="#soEntityMgrGrid"||this.grid=="#soEntityMyAllGrid"){b=false;
}ConfigUtils.findByKey("soEntityPlace.isOpendPlatformSelect",function(m){if(m.success){if(k.grid=="#soEntityComfirmGrid"){l=false;}}});var d=new Date();
$(".minPlaceTime").val(d.currentDate()+" 00:00:00");var a=null;if(k.grid==="#soEntityComfirmedGrid"){a={"Q__D__BW__entity.confirm_time_":d.currentDate()+" 00:00:00"};
}else{a={"Q__D__BW__entity.create_time_":d.currentDate()+" 00:00:00"};}var g=window.localStorage.getItem(k.grid+"HideItems");var i=null;console.log(g);
if(g!=null){i=g.split(",");}else{var f=ctx+"/ec/salesorder/soEntity/getHideTblHead.htm"+"?gridId="+k.grid;FormUtils.loadData(f,function(m){if(m&&m.length>0){i=m;
}});}ConfigUtils.findByKey("soEntity.isNotFirstSearch",function(n){var m=false;ConfigUtils.findByKey("soEntity.isShowExport",function(o){if(o.success){m=true;
$(".isExportDiv").show();}});ConfigUtils.findByKey("soEntity.trends.payedAndUnpayed",function(p){var o=false;if(p.success){o=true;}ConfigUtils.findByKey("soEntity.isReceivePhone",function(r){var q=false;
if(!r.success){q=true;}ConfigUtils.findByKey("soEntity.placeTimeToMonth",function(u){if(u.success){if(k.grid==="#soEntityComfirmedGrid"){a={"Q__D__BW__entity.confirm_time_":DateUtils.getBeforeMonth(1)+" 00:00:00"};
}else{a={"Q__D__BW__entity.place_time_":DateUtils.getBeforeMonth(1)+" 00:00:00"};}$(".minPlaceTime").val(DateUtils.getBeforeMonth(1)+" 00:00:00");}if("#soEntityMgrGrid"===k.grid&&n.success){a={"isSearch":"n"};
$(".minPlaceTime").val("");}var t=true;if(ResUtils.canShow("mySoEntity.button.soListShowSrc")){t=false;}var s=[{name:"id",width:130,index:"entity.id_",hidedlg:true,hidden:true},{name:"baseType",width:130,index:"entity.base_type_",hidedlg:true,hidden:true},{name:"soNo",width:80,index:"entity.so_no_",hidedlg:true,hidden:true},{name:"soNoShow",width:130,isBase:"true",index:"entity.so_no_",formatter:function(v,w,y){if(y.footData){$(".ui-jqgrid-title").css({"width":"100%"});
$(k.grid).jqGrid("setCaption","<div style='float:left'>"+y.soNoShow+"</div>"+"<div style='float:right;position:relative;'>"+"</div>");var z=new StringBuffer();
z.append("<span id='itemPoSum'");z.append("<span>商品数量合计 :</span>");if(y.itemPoSum&&y.itemPoSum.length>0){for(var x=0;x<y.itemPoSum.length;x++){z.append("&nbsp;<span>"+y.itemPoSum[x].prodName+"<font color=red>"+"("+y.itemPoSum[x].count+")"+"</font></span>");
}}else{z.append("&nbsp;<span style='color:red'>0个</span>");}z.append("</span>");return z.toString();}else{if(y.soNo!=null&&y.soNo!=""){var z=new StringBuffer();
z.append("<a href='#'style='font-weight:bold;' class='soTab' status='"+y.status+"' csNameVal='"+y.csName+"' idVal='"+y.id+"' soType='"+y.soType+"' cashType='"+y.cashType+"' value='"+y.soNo+"' >"+y.soNo+"</a>");
z.append(SoEntityUtils.getTurnBackStr(y.status,y.preStatus));if(y.isLock=="y"){z.append("&nbsp;<span style='color:red'>冻</span>");}if(y.baseType){if(y.baseType=="back"){z.append("&nbsp;<span style='color:blue'>(退)</span>");
}else{if(y.baseType=="back_before_exchange"){z.append("&nbsp;<span style='color:blue'>(退换)</span>");}else{if(y.baseType=="exchange"){z.append("&nbsp;<span style='color:blue'>(换)</span>");
}}}}if(y.soType=="soSupplementary"){z.append("&nbsp;<span style='color:blue'>(补)</span>");}if(y.backExchangeCount){z.append("&nbsp;<span style='color:red'>["+y.backExchangeCount+"退换]</span>");
}if(y.cashCode){z.append("&nbsp;<span style='color:blue'>券</span>");}return z.toString();}}}},{name:"originSoId",sortable:false,hidden:"y"!=k.showOriginSo,formatter:function(w,x,z){if(z.baseType=="back"){var v="<a title='"+z.originSoNo+"' href='#' class='soTab' value='"+z.originSoNo+"' csIdVal='"+z.csId+"'>"+z.originSoNo+"(原)</a>";
return v;}else{if(z.baseType=="back_before_exchange"){var v="<a title='"+z.originSoNo+"' href='#' class='soTab' value='"+z.originSoNo+"' csIdVal='"+z.csId+"'>"+z.originSoNo+"(原)</a>";
if(z.linkSoNo){var y="<a title='"+z.linkSoNo+"' href='#' class='soTab' value='"+z.linkSoNo+"' csIdVal='"+z.csId+"'>"+z.linkSoNo+"(换)</a>";return v+" ，"+y;
}else{var y="";return v;}}else{if(z.baseType=="exchange"){var v="<a title='"+z.originSoNo+"' href='#' class='soTab' value='"+z.originSoNo+"' csIdVal='"+z.csId+"'>"+z.originSoNo+"(退换)</a>";
var y="<a title='"+z.linkSoNo+"' href='#' class='soTab' value='"+z.linkSoNo+"' csIdVal='"+z.csId+"'>"+z.linkSoNo+"(原)</a>";return v+"，"+y;}else{if(!z.baseType||z.baseType=="common"){console.log(z.linkSoIdAndType4Common);
}}}}return"";}},{name:"isCloudWarehourse",hidedlg:l,hidden:l,width:100,index:"entity.is_cloud_warehouse_",formatter:function(v,w,x){if(x.isCloudWarehourse==1){return"云仓订单";
}else{return"系统订单";}}},{name:"operName",width:80,index:"",hidedlg:c,hidden:c,formatter:function(v,w,x){var y=new StringBuffer();y.append('<button class="jt-btn-opt soEntityShipQryBtn" style="font-weight:bold;" idVal = "'+x.id+'" scTrackingNo ="'+x.scTrackingNo+'" shipName="'+x.shipName+'" >物</button>');
return y.toString();}},{name:"csNameShow",width:80,isBase:"true",index:"cs_name_",formatter:function(v,w,x){if(x.csCode&&!k.hideCsName){return"<a href='#' style='font-weight:bold;' class='csTab' value='"+x.csId+"' >"+x.csName+"<br>"+x.csCode+"</a>";
}if($(window).width()<1024){return x.csName+"<br>"+x.csCode;}else{return x.csName+":"+x.csCode;}}},{name:"csName",hidedlg:true,hidden:true},{name:"soType",hidedlg:true,hidden:true},{name:"soTypeName",width:50,isBase:"true",index:"entity.so_type_",formatter:function(v,y,z){if(!z.soType){return"--";
}var w='<span style="color:red;">[类型被删除]</span>';for(var x=0;x<soTypeCatePos.length;x++){if(z.soType&&z.soType==soTypeCatePos[x].key){w=soTypeCatePos[x].name;
break;}}return w;}},{name:"status",hidedlg:true,hidden:true},{name:"statusShow",index:"entity.status_",width:75,isBase:"true",formatter:function(v,w,x){if(x.backStatus=="awaiting"&&x.status=="close_reject"){return SoEntityUtils.formatStatus(x.status)+"(需退回)";
}else{if(x.backStatus=="none"&&x.status=="close_reject"){return SoEntityUtils.formatStatus(x.status)+"(无需退回)";}else{if(x.isReceived=="y"){return SoEntityUtils.formatStatus(x.status)+"(已回款)";
}else{if(x.isInbound=="y"){return SoEntityUtils.formatStatus(x.status)+"(已退库)";}else{if(x.auditCount==1){return SoEntityUtils.formatStatus(x)+"(初审)";}else{return SoEntityUtils.formatStatus(x);
}}}}}}},{name:"delayConfirmTime",width:90,index:"entity.delay_confirm_time_",hidden:k.grid=="#soEntityDelayComfirmGrid"?false:true,formatter:function(w){var v="<span title='"+w+"'>"+DateUtils.mini4Time(w)+"</span>";
return v;}},{name:"is_received_",width:35,index:"entity.is_received_",hidden:!k.isUseReturnBack,formatter:function(v,x,y){var w="否";if(y.isReceived=="y"){w="<span style='color:red;'>是</span>";
}return w;}},{name:"is_inbound_",width:35,index:"entity.is_inbound_",hidden:!k.isUseReturnBack,formatter:function(v,x,y){var w="否";if(y.isInbound=="y"){w="<span style='color:red;'>是</span>";
}return w;}},{name:"isFast",width:35,index:"entity.is_fast_",formatter:function(v,x,y){var w="否";if(y.isFast=="y"){w="<span style='color:red;'>是</span>";
}return w;}},{name:"shipResult",width:60,hidedlg:k.hideShipResult,hidden:k.hideShipResult,index:"entity.status_",isBase:"true",formatter:function(w,y,z){var x="未发货";
var v=z.status;if(v=="close_lost"){x="已丢失";}else{if(v=="close_reject"){x="拒收";}else{if(v=="complete"){x="已签收";}else{if(v=="shipping"){x="已发货";}else{if(v=="unbound"){x="退货中";
}}}}}return x;}},{name:"isMain",width:120,hidedlg:true,hidden:true},{name:"pid",width:120,hidedlg:true,hidden:true},{name:"greenId",width:150,hidedlg:true,hidden:true},{name:"relId",width:150,hidedlg:true,hidden:true},{name:"greenNo",width:130,hidedlg:true,hidden:true,index:"green.so_no_",formatter:function(v,w,x){if(x.greenNo!=null&&x.greenNo!=""){return"<a href='#' class='soTab' value='"+x.greenNo+"' >"+x.greenNo+"</a>";
}return x.greenNo;}},{name:"relNo",width:130,hidedlg:true,hidden:true,index:"rel.so_no_",formatter:function(v,w,x){if(x.relNo!=null&&x.relNo!=""){return"<a href='#'  class='soTab' value='"+x.relNo+"' >"+x.relNo+"</a>";
}return x.relNo;}},{name:"cashType",hidedlg:true,hidden:true},{name:"cashTypeName",width:70,index:"entity.cash_type_",isBase:"true",formatter:function(v,w,x){return SoEntityUtils.formatCashType(x.cashType);
}},{name:"shipName",index:"entity.ship_name_",isBase:"true",width:70},{name:"scTrackingNo",width:100,hidden:b,isBase:"true",index:"entity.sc_tracking_no_"},{name:"fromType",width:120,hidedlg:true,hidden:true},{name:"prodQty",width:90,index:"entity.prod_qty_",hidedlg:true,hidden:true},{name:"serviceQty",width:120,hidedlg:true,hidden:true},{name:"giftQty",width:120,hidedlg:true,hidden:true},{name:"prodAmount",width:90,index:"entity.prod_amount_",hidedlg:true,hidden:true},{name:"shippingAmount",width:60,hidedlg:true,hidden:true},{name:"shippingActual",width:120,hidedlg:true,hidden:true},{name:"billType",width:90,hidedlg:true,hidden:true},{name:"billTitle",width:120,hidedlg:true,hidden:true},{name:"billContent",width:120,hidedlg:true,hidden:true},{name:"billAmount",width:80,hidedlg:true,hidden:true},{name:"otherAmount",width:80,hidedlg:true,hidden:true},{name:"otherComment",width:120,hidedlg:true,hidden:true},{name:"totalAmount",width:70,index:"entity.total_amount_",isBase:"true",formatter:function(v,w,x){if(window.localStorage.getItem("ts_money_reduce")=="true"){return parseFloat(x.totalAmount/10).toFixed(2);
}else{return parseFloat(x.totalAmount).toFixed(2);}}},{name:"discountAmount",width:120,hidedlg:true,hidden:true},{name:"mainAmount",width:120,hidedlg:true,hidden:true},{name:"payType",width:120,hidedlg:true,hidden:true,formatter:function(v,w,x){return SoEntityUtils.formatPayType(x.payType);
}},{name:"subAmount",width:60,index:"entity.sub_amount_",isBase:"true",formatter:function(v,w,x){if(window.localStorage.getItem("ts_money_reduce")=="true"){return parseFloat(x.subAmount/10).toFixed(2);
}else{return parseFloat(x.subAmount).toFixed(2);}}},{name:"payableAmount",width:60,sortable:false,isBase:"true",formatter:function(v,w,x){if(o){if(window.localStorage.getItem("ts_money_reduce")=="true"){if(x.status=="complete"){return"0.00";
}else{if(x.status=="awaiting_comfirm"||x.status=="awaiting_pay"){return parseFloat(x.totalAmount/10).toFixed(2);}else{if(x.status=="shipping"&&(x.cashType=="pay_sub"||x.cashType=="cod")){return parseFloat((x.totalAmount-x.subAmount)/10).toFixed(2);
}else{return parseFloat(x.proxyAmount/10).toFixed(2);}}}}else{if(x.status=="complete"){return"0.00";}else{if(x.status=="awaiting_comfirm"||x.status=="awaiting_pay"){return parseFloat(x.totalAmount).toFixed(2);
}else{if(x.status=="shipping"&&(x.cashType=="pay_sub"||x.cashType=="cod")){return parseFloat(x.totalAmount-x.subAmount).toFixed(2);}else{return parseFloat(x.proxyAmount).toFixed(2);
}}}}}else{if(window.localStorage.getItem("ts_money_reduce")=="true"){return parseFloat(x.proxyAmount/10).toFixed(2);}else{return parseFloat(x.proxyAmount).toFixed(2);
}}}},{name:"placerName",width:90,index:"entity.placer_id_",isBase:"true",formatter:function(v,w,x){if(x.placerAid){return x.placerAid+"<br>"+v;}return"";
}},{name:"payedAmount",width:60,hidedlg:true,hidden:true},{name:"refundApply",width:80,hidedlg:true,hidden:true},{name:"billCount",hidedlg:true,hidden:true,width:70,index:"entity.bill_count_",formatter:function(v,w,x){if(x.billCount!=null&&x.billCount!=0){return"<a href='#' class='soFinanceBillTab' value='"+x.id+"' noValue='"+x.soNo+"'  style='color:black;'>"+x.billCount+"(查看)</a>";
}return x.billCount;}},{name:"isLock",width:60,hidedlg:true,hidden:true},{name:"lockId",width:100,hidedlg:true,hidden:true},{name:"lockName",width:100,index:"lockParty.name_",hidden:true},{name:"isForce",width:120,hidedlg:true,hidden:true},{name:"payStatus",width:120,hidedlg:true,hidden:true},{name:"isSettle",width:120,hidedlg:true,hidden:true},{name:"payTime",width:120,hidedlg:true,hidden:true},{name:"closeTime",width:120,hidedlg:true,hidden:true},{name:"csId",width:120,hidedlg:true,hidden:true},{name:"placerId",width:120,hidedlg:true,hidden:true},{name:"prodNames",width:120,sortable:false,isBase:"true",formatter:function(v){var w='<span  style="color:#1ab394;'+(k.simpleShowProduct?"":"display:none")+'" class="tooltip-product jt-grid-tip fa fa-bell"  data-value="'+v+'"></span>';
w+='<span style="'+(k.simpleShowProduct?"display:none":"")+'" class="product-detail">'+v+"</span>";return w;}},{name:"lastFollow",width:120,sortable:false,isBase:"true",formatter:function(v){var w='<span  style="color:#1ab394;'+(k.simpleShowLastFollow?"":"display:none")+'" class="tooltip-follow jt-grid-tip fa fa-bell" data-value="'+v+'"></span>';
w+='<span style="'+(k.simpleShowLastFollow?"display:none":"")+'" class="lastFollow-detail">'+v+"</span>";return w;}},{name:"afterSaleType",width:70,index:"entity.after_sale_type_",hidden:j,formatter:function(v,w,x){if(x.afterSaleType=="back"){return"退货";
}else{if(x.afterSaleType=="exchange"){return"换货";}else{if(x.afterSaleType=="reject"){return"拒收";}else{return"";}}}}},{name:"placerAid",width:120,hidedlg:true,hidden:true},{name:"thirdStoreName",width:70,index:"entity.third_store_name_"},{name:"channelName",width:70,index:"entity.channel_name_",hidden:t},{name:"profitsStr",width:90,sortable:false,isBase:"true",formatter:function(v){if(v.indexOf("_")>-1){if(v.indexOf("*")>-1){var w=v.substring(v.indexOf("_"),v.indexOf(":"));
v=v.replace(w,"[已删除]");w=v.substring(v.indexOf("_"),v.lastIndexOf(":"));v=v.replace(w,"[已删除]");}else{var w=v.substring(v.indexOf("_"),v.length);v=v.replace(w,"[已删除]");
}}return v;}},{name:"placeTime",width:90,index:"entity.place_time_",isBase:"true",formatter:function(v){return DateUtils.mini2Time(v);}},{name:"confirmTime",width:90,index:"entity.confirm_time_",hidden:k.grid=="#soEntityComfirmedGrid"||k.grid=="#soEntityMgrGrid"?false:true,formatter:function(w){var v="<span title='"+w+"'>"+DateUtils.mini2Time(w)+"</span>";
return v;}},{name:"shipTime",width:90,hidden:k.grid=="#soEntityShippedGrid"||k.grid=="#soEntityMgrGrid"?false:true,index:"entity.ship_time_",formatter:function(w){var v="<span title='"+w+"'>"+DateUtils.mini2Time(w)+"</span>";
return v;}},{name:"completeTime",width:90,hidden:k.grid=="#soEntityCompleteGrid"||k.grid=="#soEntityMgrGrid"?false:true,index:"entity.complete_time_",formatter:function(w){var v="<span title='"+w+"'>"+DateUtils.mini2Time(w)+"</span>";
return v;}},{name:"rejectTime",width:90,hidden:k.grid=="#soEntityRejectGrid"||k.grid=="#soEntityMgrGrid"?false:true,index:"entity.reject_time_",formatter:function(w){var v="<span title='"+w+"'>"+DateUtils.mini2Time(w)+"</span>";
return v;}},{name:"closeTime",width:90,hidden:k.grid=="#soEntityEndGrid"?false:true,index:"entity.close_time_",formatter:function(w){var v="<span title='"+w+"'>"+DateUtils.mini2Time(w)+"</span>";
return v;}},{name:"comment",width:120,index:"entity.comment_",isBase:"true",hidden:e,formatter:function(y,v,x){var w="";if(y!=""&&y!=null){w='<span  style="color:#1ab394;'+(k.simpleShowComment?"":"display:none")+'" class="tooltip-comment jt-grid-tip fa fa-bell" data-value="'+y+'"></span>';
w+='<span style="'+(k.simpleShowComment?"display:none":"")+'" class="comment-detail">'+y+"</span>";}return w;}},{name:"createBy",width:120,hidedlg:true,hidden:true},{name:"createTime",width:120,hidedlg:true,hidden:true,index:"entity.create_time_"},{name:"updateBy",width:120,hidedlg:true,hidden:true},{name:"updateTime",index:"entity.update_time_",width:90,hidedlg:true,hidden:true,formatter:function(v){return DateUtils.mini2Time(v);
}},{name:"isDetail",hidedlg:true,hidden:true,formatter:function(){return k.bizType=="placer"?"y":"n";}},{name:"tranPhone",hidedlg:true,hidden:q},{name:"recPhone",hidedlg:true,hidden:q},{name:"__manage",width:60,classes:"rowOps",sortable:false,align:"center",formatter:"manage",formatoptions:k.getManagerBtns()}];
if(i){$.each(s,function(v,w){if($.inArray(this.name,i)!=-1){this.hidden=true;}});}$(k.grid).JTJqgrid({url:SoEntityUtils._CONS_.LIST_URL+"?"+k._getParams(),pager:k.pager,postData:a,autoScroll:true,colNames:["id","基础类型(隐藏)","订单编号(隐藏)","订单编号","关联订单","平台订单","操作","客户","客户(隐藏)","订单类型key","类型","订单状态key","订单状态","延审时间","回款","退库","加急","发货结果","是否主订单.","父订单 ID","关联绿色订单 ID","关联订单 ID","关联绿色订单","关联订单","货款方式key","货款方式","快递公司","快递单号","来源类型","产品总数量","服务总数量","赠品总数量","产品金额","运费","金额 - 实际运费（冗余，用于统计成本）","发票类型","发票抬头","发票说明","发票金额","其它费用","其它费用说明","总金额","总折扣金额","金额 - 主订单客单金额","支付方式","订金","待收","下单人","已收","退款金额","财务单","是否锁定(隐藏)","锁定人ID","锁定人","是否强制干预订单状态","状态 - 支付状态。unpaid=未支付；partial=部分支付；paid_off=已支付","是否已物流结算（COD）","支付完成时间","订单结束时间。订单状态到达终止状态（包括已取消、已完成、已退款等）时的时间。","客户 ID","下单员 ID","订单商品","最新跟进","售后处理","下单人工号","店铺名称","渠道","业绩分成","下单时间","审核时间","发货时间","签收时间","拒收时间","作废时间","订单备注","下单者ID","创建时间","更新者","更新时间","是否我的订单","成交手机编号","收款手机编号","操作"],colModel:s,simplify:{entry:[{sName:"最新跟进",sClass:"lastFollow",sCheck:(k.simpleShowLastFollow?true:false)},{sName:"订单备注",sClass:"orderDesc",sCheck:(k.simpleShowComment?true:false)},{sName:"订单商品",sClass:"productShow",sCheck:(k.simpleShowProduct?true:false)},{sName:"商品合计",sClass:"productShowSum",sCheck:(k.simpleShowProductSum?true:false)}],base:["订单编号","客户","类型","订单状态","发货结果","货款方式","快递公司","快递单号","总金额","订金","待收","下单人","订单商品","最新跟进","业绩分成","下单时间","订单备注"],other:["回款","退库","加急","店铺名称","渠道"]},footerrow:true,userDataOnFooter:true,loadComplete:function(){if(k.bizType!="placer"){$("a.soTab").attr("isDetail","true");
}var y=window.localStorage.getItem(k.grid+"HideItems");var w=window.localStorage.getItem(k.grid+"ShowItems");var v=$(k.grid).getGridParam("width");if(y!=null){var z=y.split(",");
for(var x=0;x<z.length;x++){$(k.grid).setGridParam().hideCol(z[x]);}}$(k.grid).setGridWidth(v);if(w!=null){var z=w.split(",");for(var x=0;x<z.length;x++){$(k.grid).setGridParam().showCol(z[x]);
}}$(window).resize();},gridComplete:function(){if(k.selectedId!=null){if(k.selectedId.length==1){$(k.grid).jqGrid("setSelection",k.selectedId,true);}else{for(var z=0;
z<k.selectedId.length;z++){$(k.grid).jqGrid("setSelection",k.selectedId[z],true);}}}if(!k.hasInitJqgrid){var w=$(k.grid).jqGrid("getGridParam","colModel");
var v=new Array();for(var x=2;x<w.length;x++){if(w[x].hidden&&$.inArray(w[x].name,i)==-1){v.push(w[x].name);}}window.localStorage.setItem(k.grid+"defaultHideItems",v);
k.hasInitJqgrid=true;}var y=$(k.grid).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow");y.find("td").css({"font-weight":400,"width":500});
y.find("td").hide();y.find('td[aria-describedby*="_soNoShow"]').show();if(k.simpleShowProductSum){y.hide();}else{y.show();}},onSelectAll:function(w,v){if(w&&w.length>0){if(typeof(k.onSelectRow)=="function"){k.onSelectRow(w,v,k.otherOperFlag);
}}},onSelectRow:function(w,v){if(typeof(k.onSelectRow)=="function"){k.onSelectRow(w,v,k.otherOperFlag);}},ondblClickRow:function(x){return false;if(x){if(k.ondblClickRow&&typeof k.ondblClickRow==="function"){k.ondblClickRow(x);
}else{var y=$(k.grid).jqGrid("getRowData",x);var A=y["csName"];var w=y["soNo"];var v=SoEntityUtils._CONS_.DETAIL_PAGE_URL+"?soNo="+w;var z=A+"的订单明细";JTTabUtils.addOrRefreshTab(v,z);
}}}});});});});});},};function parentCMD(){$(".soEntitySearch").trigger("click");}