$(function(){var a=new SoEntityRevisit();a.init();});function SoEntityRevisit(){this.hadInit=false;}SoEntityRevisit._CONS_={REVISIT_URL:ctx+"/ec/salesorder/soEntity/revisit.htm",REVISIT_MODIFY_URL:ctx+"/ec/salesorder/soEntity/revisitModify.htm",};
SoEntityRevisit.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._loadRevisitContent();this._bindFormValidation();
this._setRevisitTime();this._showButton();}},_bindEventHander:function(){var a=this;$("body").on("click",".revisitBtn",function(){if($("#revisitForm").valid()){a._doRevisit();
}});},_showButton:function(){var a=$("input[name='isRevisit']").val();if(a=="y"){if(ResUtils.canShow("soRevisit.button.modify")){$(".revisitBtn").show();
}else{$(".revisitBtn").remove();$("#revisitForm").find(":input").attr("disabled","disabled");}}else{if(ResUtils.canShow("soRevisit.button.revisit")){$(".revisitBtn").show();
}}},_setRevisitTime:function(){if(!$("input[name='revisitTime']").val()||$("input[name='revisitTime']").val()==""){$("input[name='revisitTime']").val(DateUtils.format(new Date(),"yyyy-MM-dd HH:mm:ss"));
}},_doRevisit:function(){var b=this;var a=SoEntityRevisit._CONS_.REVISIT_URL;var c={soId:$("input[name='soId']").val(),revisitContent:$("input[name='revisitContent']").val(),revisitTime:$("input[name='revisitTime']").val()};
FormUtils.submit(a,c,function(d){if(d.success){DialogUtils.success(msgCode.INFO,"回访成功");$(".revisitBtn").attr("disabled","disabled");$("#revisitForm").find(":input").attr("disabled","disabled");
}else{DialogUtils.error(msgCode.ERROR,d.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},_loadRevisitContent:function(){var a=this;
$("#revisitContent").bsSuggest({url:ctx+"/gl/cate/cate/getOptions.htm?typeKey=system&pKey=revisitContent",effectiveFields:["name"],searchFields:["name"],effectiveFieldsAlias:{name:"回访内容"},showBtn:false,inputWarnColor:"",showHeader:false,idField:"id",keyField:"name",getDataMethod:"url",processData:function(d){var c,b,e={value:[]};
if(!d||d.records===0){return false;}b=d.length;for(c=0;c<b;c++){e.value.push({id:d[c].id,name:d[c].name});}return e;}});},_bindFormValidation:function(){var a={rules:{revisitContent:{required:true},revisitTime:{required:true}},messages:{}};
FormUtils.bindFormValidation("revisitForm",a);},};