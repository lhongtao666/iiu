function SoEntityExport(){this.hadInit=false;this.params="";}SoEntityExport._CONS_={EXPORT_ASYNCHRO:ctx+"/ec/salesorder/soEntity/exportAsynchronous.htm",EXPORT_PACK_URL:ctx+"/ec/salesorder/soEntity/exportPack.htm",EXPORT_EXCEL_URL:ctx+"/ec/salesorder/soEntity/exportSoEntityModule.htm",EXPORT_PRODUCT_EXCEL_URL:ctx+"/ec/salesorder/soEntity/exportSoProduct.htm",EXPORT_EMPPROD_EXCEL_URL:ctx+"/ec/salesorder/soEntity/exportEmpProduct.htm",EXPORT_EMPSOPROD_EXCEL_URL:ctx+"/ec/salesorder/soEntity/exportEmpSoProduct.htm",EXPORT_EDIANBAO_EXCEL_URL:ctx+"/ec/salesorder/soEntity/exportEDianBao.htm",EXPORT_YANWEN_EXCEL_URL:ctx+"/ec/salesorder/soEntity/exportYwSoShip.htm",ISRECPHONE:false};
SoEntityExport.prototype={init:function(a){this.params=a;if(!this.params.selectIds){this.params.selectIds="";}this.openExportLayer();if(!this.hadInit){this._bindEventHander();
}this.hadInit=true;ConfigUtils.findByKey("soEntity.isReceivePhone",function(b){if(b.success){SoEntityExport._CONS_.ISRECPHONE=true;}});},_bindEventHander:function(){$("#selectAll").on("change",function(){var c=$(this)[0].checked;
var b=$("#columnContainer").find(".columnCheckBox");for(var a=0;a<b.length;a++){b[a].checked=c;}});},openExportLayer:function(){var a=this;a.layerIndex=layer.open({type:1,title:"订单导出",maxmin:false,move:false,scrollbar:false,shadeClose:false,btn:["导出","取消"],area:["70%","70%"],content:$(".soEntityExportPane"),success:function(b,c){a._initData();
},yes:function(d,f){var i=$("input[name='startCount'").val();var c=$("input[name='endCount'").val();var b=parseInt($("input[name='maxCount'").val());if(b<1){DialogUtils.error(msgCode.FAIL_MSG,"导出数量不能小于1");
return false;}if(c==""||c==null||i==""||i==null){DialogUtils.error(msgCode.FAIL_MSG,"导出数量不能小于1");return false;}c=parseInt(c);i=parseInt(i);if(i>c||c>b||i>b||c<0||i<0){DialogUtils.error(msgCode.FAIL_MSG,"请填写正确的订单数量。最大值不能大于"+b);
return false;}if(c-i>100000){DialogUtils.error(msgCode.FAIL_MSG,"一次导出订单不能超过100000条，请分批导出！");return false;}var j=a._exportParams(i,c);var e=$("input[name='exportType']:checked").val();
if(!j&&!e=="soAndProd"){DialogUtils.error(msgCode.FAIL_MSG,"请选择要导出的字段");return false;}DialogUtils.success(msgCode.SUCCESS,"正在导出....");layer.close(a.layerIndex);
var k=$("input[name='fileType']:checked").val();if(e=="soAndProd"){FormUtils.submit(SoEntityExport._CONS_.EXPORT_PRODUCT_EXCEL_URL,a.params.params+j+"&selectIds="+a.params.selectIds,function(l){},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
},true);}else{if(e=="csAndProd"||e=="empAndProd"){FormUtils.submit(SoEntityExport._CONS_.EXPORT_EMPPROD_EXCEL_URL,a.params.params+j+"&selectIds="+a.params.selectIds+"&exportType="+e,function(l){},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
},true);}else{if(e=="csAndSoProd"||e=="empAndSoProd"){FormUtils.submit(SoEntityExport._CONS_.EXPORT_EMPSOPROD_EXCEL_URL,a.params.params+j+"&selectIds="+a.params.selectIds+"&exportType="+e,function(l){},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
},true);}else{if(k=="edianbaoExcel"){FormUtils.submit(SoEntityExport._CONS_.EXPORT_EDIANBAO_EXCEL_URL,a.params.params+j+"&selectIds="+a.params.selectIds+"&exportType="+e,function(l){},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
},true);}else{if(k=="yanwenShipExcel"){FormUtils.submit(SoEntityExport._CONS_.EXPORT_YANWEN_EXCEL_URL,a.params.params+j+"&selectIds="+a.params.selectIds+"&exportType="+e,function(l){},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
},true);}else{if(k=="module"){window.location.href=SoEntityExport._CONS_.EXPORT_EXCEL_URL+"?"+a.params.params+j+"&selectIds="+a.params.selectIds;return;
}else{var h=SoEntityExport._CONS_.EXPORT_ASYNCHRO;var g=a.params.requestQueryParams?("?"+a.params.requestQueryParams):"";h=h+g;FormUtils.submit(h,a.params.params+j+"&selectIds="+a.params.selectIds,function(l){if(!l.success){DialogUtils.error(msgCode.ERROR,l.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);},true);}}}}}}window.top.showTimming(c-i);},cancel:function(){}});},_initData:function(){$("input[name='exportType']")[0].checked=true;
$("input[name='fileType']")[0].checked=true;this._initColoms();this._initCount();},_initColoms:function(){var a=[];var b=LocalStorageUtils.get("SO_EXPORT_COLUMNS_"+currentUserId);
if(b){a=b.split(",");}excelUtil.findExportColByModule("soEntity",true,function(d){var e=new StringBuffer();if(d&&d.length>0){for(var c=0;c<d.length;c++){if(d[c].devCode=="tranPhone"||d[c].devCode=="recPhone"){if(!SoEntityExport._CONS_.ISRECPHONE){continue;
}}e.append("<div class='checkbox checkbox-success checkbox-inline'>");if($.inArray(d[c].devCode,a)!=-1){e.append("<input type='checkbox' checked class='columnCheckBox' name='exportColumn' id="+d[c].id+" value='"+d[c].devCode+"'><label for='"+d[c].id+"'>"+d[c].name+"</label>");
}else{e.append("<input type='checkbox' class='columnCheckBox' name='exportColumn' id="+d[c].id+" value='"+d[c].devCode+"'><label for='"+d[c].id+"'>"+d[c].name+"</label>");
}e.append("</div>");}}$("#columnContainer").empty().append(e.toString());});},_initCount:function(){var b=this.params;var a=b.toatolCount;if(b.selectIds&&b.selectIds.length>0){a=b.selectIds.length;
}$("input[name='startCount'").val(1);$("input[name='endCount'").val(a);$("input[name='maxCount'").val(a);},_exportParams:function(d,g){var c="";var e=$("#columnContainer").find(".columnCheckBox");
var f=[];$(e).each(function(){if($(this).is(":checked")){f.push($(this).val());}});if(f.length<=0){return false;}var b=$("input[name='exportType']:checked").val();
var a=$("input[name='fileType']:checked").val();c="&columns="+f+"&startCount="+d+"&pageSize="+(g-d+1)+"&exportType="+b+"&fileType="+a;LocalStorageUtils.set("SO_EXPORT_COLUMNS_"+currentUserId,f.toString());
return c;},exportPack:function(a){var b=$(a).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error("错误","请选择要导出备货信息的订单");return null;
}FormUtils.submit(SoEntityExport._CONS_.EXPORT_PACK_URL,"soId="+b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,"成功");window.location=ctx+c.msg+"?pw=42385A79697676502F512F33454F58333337794472513D3D";
}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}};