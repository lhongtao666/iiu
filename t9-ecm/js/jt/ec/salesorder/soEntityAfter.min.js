function SoEntityAfter(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}SoEntityAfter._CONS_={LIST_URL:ctx+"/ec/salesorder/soEntity/listData.htm",EXCHANGEORBACK_URL:ctx+"/ec/salesorder/soEntity/exchange.htm",DETAIL_PAGE_URL:ctx+"/ec/salesorder/soEntity/detail.htm",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detail.htm",EDIT_FORM_ID:"soEntityForm",GRID:"#soEntityAfterGrid",PAGER:"#soEntityAfterPager",};
SoEntityAfter.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._initJqgrid(a.searchParam);this._hideNotGrantBtn();
}},_hideNotGrantBtn:function(){},_exchangeOrBack:function(a){JTTabUtils.addOrRefreshTab(SoEntityAfter._CONS_.EXCHANGEORBACK_URL+"?id="+a+"&canShowScTrankNo="+self.canShowScTrankNo,"退换货");
},_bindEventHander:function(){var a=this;$("body").on("click",".soEntityExchangeOrBack",function(){var b=a._getSelId();if(b==null){return;}a._exchangeOrBack(b);
});$("body").on("click",".soEntitySearch",function(){var b=$(this).closest("form").serialize();a.reloadJqgrid(b);});$("body").on("keypress","form",function(b){if(b.keyCode=="13"){$(this).find(".soEntitySearch").click();
}});$("body").on("click",".soEntityDetail",function(){a.detail($(this).attr("idVal"));});$("body").on("click",".soTab",function(){var c=$(this).attr("value");
var b=$(this).attr("value");if(b.length>4){c="*"+b.substring(b.length-3,b.length);}JTTabUtils.addOrRefreshTab(SoEntityAfter._CONS_.DETAIL_PAGE_URL+"?soNo="+b,"订单["+c+"]明细");
});$(".list_wrapper").on("click",".csTab",function(){var c=$(this).text();var b=$(this).attr("value");if(c.length>4){c="*"+c.substring(c.length-3,c.length);
}JTTabUtils.addOrRefreshTab(SoEntityAfter._CONS_.DETAIL_CS_PAGE_URL+"?csId="+b,"客户["+c+"]明细");});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(SoEntityAfter._CONS_.GRID,a);
},_getSelId:function(a){if(!a){a=$(SoEntityAfter._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(a==null||a.length==0){DialogUtils.error("错误","请选择要处理的订单");
return null;}if(a.length>1){DialogUtils.error("错误","不能同时处理多个订单");return null;}}return a;},_getManagerBtns:function(){var a=[];return a;},_initJqgrid:function(b){var a=this;
if(b==null||typeof b==undefined){b={};}$(SoEntityAfter._CONS_.GRID).JTJqgrid({url:SoEntityAfter._CONS_.LIST_URL+"?Q__S__EQ__entity.status_=complete&Q__S__NEQ__entity.cash_type_=green"+b,pager:SoEntityAfter._CONS_.PAGER,postData:{},shrinkToFit:false,autoScroll:true,colNames:["订单编号","订单编号","关联订单","客户ID","客户","状态","状态","加急","快递公司","快递单号","订单金额","商品名称","代收款","下单人","最新跟进","下单时间","完成时间","更新时间","货款类型","操作"],colModel:[{name:"soNoShow",index:"so_no_",width:80,hidedlg:true,hidden:true,formatter:function(c,d,e){if(c&&c.length>0){return c;
}return e.soNo;}},{name:"soNo",index:"so_no_",width:120,formatter:function(c,d,e){if(e.footData){return e.soNo;}else{var g=new StringBuffer();var f="";
if(e.baseType=="back"){f="<a href='#' class='soTab' value='"+c+"' id-value='"+e.id+"' status-value='"+e.status+"'>"+c+"(退)</a>";}else{if(e.baseType=="back_before_exchange"){f="<a href='#' class='soTab' value='"+c+"' id-value='"+e.id+"' status-value='"+e.status+"'>"+c+"(退换)</a>";
}else{if(e.baseType=="exchange"){f="<a href='#' class='soTab' value='"+c+"' id-value='"+e.id+"' status-value='"+e.status+"'>"+c+"(换)</a>";}else{if(!e.baseType||e.baseType=="common"){if(e.backExchangeCount){f="<a href='#' class='soTab' value='"+c+"' id-value='"+e.id+"' status-value='"+e.status+"'>"+c+"<span style='color:red'>["+e.backExchangeCount+"退换]</span>"+"</a>";
}else{f="<a href='#' class='soTab' value='"+c+"' id-value='"+e.id+"' status-value='"+e.status+"'>"+c+"</a>";}}}}}g.append(f);return g.toString();}}},{name:"originSoId",index:"origin_so_id_",width:120,formatter:function(d,e,g){if(g.baseType=="back"){var c="<a title='"+g.originSoNo+"' href='#' class='soTab' value='"+g.originSoNo+"' csIdVal='"+g.csId+"'>"+g.originSoNo+"(原)</a>";
return c;}else{if(g.baseType=="back_before_exchange"){var c="<a title='"+g.originSoNo+"' href='#' class='soTab' value='"+g.originSoNo+"' csIdVal='"+g.csId+"'>"+g.originSoNo+"(原)</a>";
if(g.linkSoNo){var f="<a title='"+g.linkSoNo+"' href='#' class='soTab' value='"+g.linkSoNo+"' csIdVal='"+g.csId+"'>"+g.linkSoNo+"(换)</a>";return c+" ，"+f;
}else{var f="";return c;}}else{if(g.baseType=="exchange"){var c="<a title='"+g.originSoNo+"' href='#' class='soTab' value='"+g.originSoNo+"' csIdVal='"+g.csId+"'>"+g.originSoNo+"(退换)</a>";
var f="<a title='"+g.linkSoNo+"' href='#' class='soTab' value='"+g.linkSoNo+"' csIdVal='"+g.csId+"'>"+g.linkSoNo+"(原)</a>";return c+"，"+f;}else{if(!g.baseType||g.baseType=="common"){console.log(g.linkSoIdAndType4Common);
}}}}return"";}},{name:"csId",width:120,hidedlg:true,hidden:true},{name:"csName",sortable:false,width:100,formatter:function(c,e,f){var d=c+":"+f.csCode;
if($(window).width()<1024){d=c+"<br>"+f.csCode;}return"<a href='#' class='csTab'  title='"+d+"' value='"+f.csId+"''>"+d+"</a>";}},{name:"statusShow",index:"entity.status_",width:80,formatter:function(d,f,g){var c=g.status;
var e=c;if(c=="comfirm"){e="已审核";}else{if(c=="packing"){e="已备货";}else{if(c=="deliver"){e="待发货";}else{if(c=="shipping"){e="已发货";}else{if(c=="close_reject"){e="拒收";
}else{if(c=="close_repeat"){e="需重发";}else{if(c=="close_lost"){e="包裹丢失";}else{if(c=="complete"){e="已签收";}}}}}}}}return e;}},{name:"status",index:"status_",width:120,hidedlg:true,hidden:true},{name:"isFast",index:"entity.is_fast_",width:60,formatter:function(d){var c="否";
if(d=="y"){c="<span style='color:red;'>是</span>";}return c;}},{name:"shipName",index:"entity.ship_name_",width:100},{name:"scTrackingNo",index:"entity.sc_tracking_no_",width:120},{name:"totalAmount",width:70,index:"entity.total_amount_",formatter:"number"},{name:"prodNames",width:120,sortable:false,formatter:function(c){var d='<span class="product-detail">'+c+"</span>";
return d;}},{name:"proxyAmount",index:"entity.proxy_amount_",width:80,formatter:function(c){return parseFloat(c).toFixed(2);}},{name:"placerId",width:120,hidedlg:true,hidden:true},{name:"lastFollow",width:100,sortable:false},{name:"placeTime",width:110,index:"entity.place_time_",formatter:function(c){return DateUtils.miniTime(c);
}},{name:"completeTime",width:110,index:"entity.complete_time_",formatter:function(c){return DateUtils.miniTime(c);}},{name:"updateTime",width:110,index:"entity.update_time_",formatter:function(c){return DateUtils.miniTime(c);
}},{name:"cashType",width:120,hidedlg:true,hidden:true},{name:"__manage",width:40,classes:"rowOps",sortable:false,align:"center",formatter:"manage",formatoptions:this._getManagerBtns()}],footerrow:true,userDataOnFooter:true,loadComplete:function(){$(".deliveredRecords").empty().append($(SoEntityAfter._CONS_.GRID).jqGrid("getGridParam","records"));
},gridComplete:function(){var c=$(SoEntityAfter._CONS_.GRID).parents(".jqGrid_wrapper").find(".ui-jqgrid-sdiv").find("tr.footrow");c.find("td").hide();
c.find('td[aria-describedby*="_soNoShow"]').show();c.find("td").css({"font-weight":400});$(window).resize();}});},};