function SoCustomer(){this.hadInit=false;this.csName="";}SoCustomer._CONS_={EDIT_CS_NAME:ctx+"/crm/cs/csEntity/editCsName.htm",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detail.htm",GET_CS_MODEL_URL:ctx+"/crm/rfmt/rfmtModel/getCsRfmtModelPo.htm"};
SoCustomer.prototype={init:function(b){if(!this.hadInit){this.hadInit=true;var a=this;var c=$("input[name='status']").val();if(c&&ResUtils.canShow("soEntity.button.completeChangeEmp")){$(".changeEmployee").show();
}ConfigUtils.findByKey("system.version.name",function(d){if("旗舰版"==d.msg){a.initCsRfmt(b);}});this._bindEventHandler();}},_bindEventHandler:function(){var b=this;
var a=$("#csEntityDiv");a.on("click",".callPhone",function(){var c=a.find("[name=phoneSelect]").find("option:selected").val();CallerHelper.call(c,function(d){var e=d;
if(d.startsWith("020")){e=d.substring(3);}else{e=d;}window.top.jtCtiService.dialout("9"+e);});});a.on("click",".callPhoneAddZero",function(){var c=a.find("[name=phoneSelect]").find("option:selected").val();
var d=/^(((1[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{9})$/;CallerHelper.call(c,function(e){var f=e;if(e.startsWith("020")){f=e.substring(3);}else{f=e;}if(d.test(f)){window.top.jtCtiService.dialout("90"+f);
}else{window.top.jtCtiService.dialout("9"+f);}});});a.on("click",".sendMessage",function(){var d=a.find("[name=csId]").val();var g=a.find("[name=phoneSelect]").val();
var f=a.find("[name=phoneSelect]").find("option:selected").text();var e=new SendMessage();var c={csId:d,number:g,maskNum:f};e.openSendMessageView(c);});
a.on("change","[name=phoneSelect]",function(){var c=$(this).find("option:selected").attr("attr-type");a.find("[name=phoneType]").val(c);});a.on("click",".csName",function(){b.csName=$(this).val();
$(this).removeClass("validate_input_error");});a.on("blur",".csName",function(){if(ResUtils.canShow("soEntity.button.editCsName")){if($(this).val()){if(b.csName!=$(this).val()){b._editCsName();
}}else{$(this).addClass("validate_input_error");DialogUtils.error("提示","请填写客户名称");}}});a.on("click",".changeEmployee",function(){b._changeEmployee();});
$(document).on("click",".csCode",function(){var c=a.find("[name=csId]").val();JTTabUtils.addOrRefreshTab(SoCustomer._CONS_.DETAIL_CS_PAGE_URL+"?csId="+c,"客户明细");
});$(document).on("click","#servicePhoneBtn",function(d){var c=$(this).attr("masknum");if(c&&c!=""){if(c.startsWith("020")){c=c.substring(3);}window.top.jtCtiService.dialout("9"+c);
}else{DialogUtils.error(msgCode.ERROR,"没有此快递公司的客服电话");return;}});},_changeEmployee:function(){var b=this;var a=$("#csEntityDiv");var c=0;if(ResUtils.canShow("employeeSelector.button.cs")){c:1;
}var e={isShowAllGroup:c,grantType:"/cs/",isMultiple:0,mode:0,isSale:1,callBack:function(g){if(g!=null){if(g.length>0){var i=a.find("input[name=employeeAid]").val();
a.find("input[name=employeeId]").val(g[0].id);a.find("input[name=employeeAid]").val(g[0].aid);a.find("input[name=csBelong]").val(g[0].aid+"："+g[0].name);
var f=[];f.push({employeeId:g[0].id,csEntityIds:a.find("input[name=csId]").val()});var h={soId:$("input[name=id]").val(),comment:"签收转工号，从工号"+i+"转到工号"+g[0].aid};
FormUtils.submit(ctx+"/crm/cs/csEntity/saveAssign.htm",{resultJson:JSON.stringify(f),csType:"csEntity",soInfo:JSON.stringify(h)},function(j){if(j.success){DialogUtils.success("提示",j.msg);
}else{DialogUtils.error("失败",j.msg);}});}}}};var d=new EmployeesSelect();d.init(e);},_editCsName:function(){var a=$("#csEntityDiv");$.ajax({type:"GET",url:CsPhonePanel._CONS_.EDIT_CS_NAME+"?csId="+a.find("[name=csId]").val()+"&csName="+a.find(".csName").val(),contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(b){if(b.success){DialogUtils.success("成功","修改客户名字成功");
}}});},initCsRfmt:function(b){var a=this;var c=new StringBuffer();FormUtils.loadData(SoCustomer._CONS_.GET_CS_MODEL_URL+"?csId="+b,function(d){if(d){c.append("【客户价值："+parseInt(d.rate*100)+"。RFMT分类："+d.rfmt+"("+d.rfmtType+")。营销分类："+d.rfmtSuggest+"】");
$("#csInfoRfmt").empty().append(c.toString());}});}};