function ExchangeOrBackModal(){}ExchangeOrBackModal.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHanlder();FormUtils.bindFormValidation("backOrExchangeForm",{});
}this.options=a;$("#backForSoModalLabel").text("退货信息");if(a.backType=="exchange"){$("#backForSoModalLabel").text("换货信息");}this._initInput(a);$("#backForSoContainer").modal("show");
$("select[id=rejectTypeOne]").trigger("change");ShipCompanyUtils.getOptions({container:"shipCompany",caption:"全部"});},_initInput:function(b){var e=0;for(var d=0;
d<b.selectedArr.length;d++){var a=b.selectedArr[d];var c=a.actualPrice*a.count;e=e+c;}e=e.toFixed(2);$("[name=backAmount]").attr("max",e).val(e);$("[name=backWayType]").val(["normal"]);
},_bindEventHanlder:function(){var a=this;$("body").off("change","select[id=rejectTypeOne]").on("change","select[id=rejectTypeOne]",function(){if($(this).val()=="ship"){CateUtils.getOptions({typeKey:"system",pKey:"shipRejectType",container:"rejectType"});
}else{if($(this).val()=="cs"){CateUtils.getOptions({typeKey:"system",pKey:"csRejectType",container:"rejectType"});}else{if($(this).val()=="emp"){CateUtils.getOptions({typeKey:"system",pKey:"empRejectType",container:"rejectType"});
}else{if($(this).val()=="turn"){CateUtils.getOptions({typeKey:"system",pKey:"turnRejectType",container:"rejectType"});}}}}});$("body").off("click",".submitBackBtn").on("click",".submitBackBtn",function(){var e=$("#backOrExchangeForm").valid();
if(!e){return;}var d={};d.items=JSON.stringify(a.options.selectedArr);d.type="back";d.rejectTypeOne=$("[name=rejectTypeOne]").val();d.rejectType=$("[name=rejectType]").val();
d.rejectComment=$("[name=rejectComment]").val();d.soId=a.options.soId;d.backType=a.options.backType;d.backAmount=$("[name=backAmount]").val();d.backWayType=$("[name=backWayType]").val();
d.shipCompany=$("[name=shipCompany]").val();d.shipName=$("[name=shipCompany]").find("option:selected").text();d.scTrackingNo=$("[name=scTrackingNo]").val();
var c=a.options.successFn;var b=ctx+"/ec/salesorder/soEntity/back.htm";FormUtils.submit(b,d,function(f){if(f.success){DialogUtils.success(msgCode.SUCCESS,"操作成功！");
$("#backForSoContainer").modal("hide");if(c){c(f);}}else{DialogUtils.error(msgCode.FAIL_MSG,"操作失败");}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});},};