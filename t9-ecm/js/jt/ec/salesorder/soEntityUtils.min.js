var SoEntityUtils={formatStatus:function(e){var b="";var a=e.status;var d=e.delayConfirmTime;var c=e.delayShipTime;if(a=="awaiting_pay"){b="待支付";}else{if(a=="awaiting_post"){b="待提交";
}else{if(a=="awaiting_comfirm"){if(d!=null){b="待审核"+"<span style='color:red;font-size: 8px;'>[延审]</span>";}else{b="待审核";}}else{if(a=="comfirm"){if(c!=null){b="待发货"+"<span style='color:red;font-size: 8px;'>[延发]</span>";
}else{b="待发货";}}else{if(a=="shipping"){b="已发货";}else{if(a=="complete"){b="已签收";}else{if(a=="close"){b="已作废";}else{if(a=="close_reject"){b="已拒收";}else{if(a=="close_lost"){b="已丢失";
}}}}}}}}}return b;},formatCashType:function(b){var a="";if(b=="pay"){a="款到发货";}else{if(b=="pay_sub"){a="支付订金";}else{if(b=="green"){a="绿色通道";}else{if(b=="green_by"){a="绿色通道订金";
}else{if(b=="cod"){a="货到付款";}else{if(b=="free"){a="免费已付";}else{if(b=="point"){a="积分付款";}}}}}}}return a;},formatPayType:function(b){var a="";if(b=="alipay"){a="支付宝";
}else{if(b=="weixin"){a="微信支付";}else{if(b=="weixinhongbao"){a="微信红包";}else{if(b=="bank"){a="银行转账";}else{if(b=="cash"){a="现金支付";}else{if(b=="point"){a="积分支付";
}}}}}}return a;},getTurnBackStr:function(b,a){var c="";switch(b){case"awaiting_post":if(!(a==null||a==""||a=="awaiting_post")){c="&nbsp;<span style='color:red'>撤</span>";
}break;case"awaiting_comfirm":if(!(a=="awaiting_post"||a=="awaiting_comfirm")){c="&nbsp;<span style='color:red'>撤</span>";}break;case"comfirm":if(!(a=="awaiting_post"||a=="awaiting_comfirm"||a=="awaiting_pay"||a=="comfirm")){c="&nbsp;<span style='color:red'>撤</span>";
}break;}return c;},confirm:function(b,a){window.localStorage.setItem("comfirm_"+currentUserId,b.toString());JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.SO_TO_COMFIRM_URL+"?soId="+b[0],"订单["+a+"审核");
},toDeliver:function(a){window.localStorage.setItem("deliver_"+currentUserId,JSON.stringify(a));ConfigUtils.findByKey("soEntity.isEditSaveSo",function(b){if(b.success&&ResUtils.canShow("soEntity.button.saveSoComfirmBtn")){JTTabUtils.addOrRefreshTab(ctx+"/ec/salesorder/soEntity/waitToDeliver.htm?soId="+a[0].id,"订单["+a[0].soNo+"发货");
}else{JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.SO_TO_DELIVER_URL+"?soId="+a[0].id,"订单["+a[0].soNo+"发货");}});},backDeliver:function(b,a){DialogUtils.confirmWithOptions({title:"确定撤销发货吗？",text:"",confirmButtonText:"确认",yesFunc:function(){var c=SoEntityUtils._CONS_.BACK_DELIVER_URL;
FormUtils.submit(c,{ids:b},function(d){if(d.success){DialogUtils.success(msgCode.INFO,"撤销发货成功");if(a&&typeof(a)=="function"){a();}}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}});},confirmBatch:function(d,c,b){var a=SoEntityUtils._CONS_.COMFIRM_BATCH_URL;FormUtils.submit(a,{ids:d,isRepeatAudit:c,operComment:b,isBatch:"y"},function(e){if(e.success){DialogUtils.success(msgCode.INFO,e.msg);
}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);}$(".sowait_wrapper").find(".soEntitySearch").click();$(".so_delay_wrapper").find(".soEntitySearch").click();
},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},buildEmployeeOption:function(b,c,d){var a=d?d:"dept_manager";$.ajax({type:"GET",url:ctx+"/crm/ou/employee/listEmployees.htm?groupId="+b+"&type="+a,contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(f){if(f&&f.length>0){var g=new StringBuffer();
g.append("<option value=''>请选择</option>");for(var e=0;e<f.length;e++){g.append("<option value='"+f[e].id+"'>"+f[e].aid+":"+f[e].name+"</option>");}if(c){$("#"+c).empty().append(g.toString());
}else{$("#belongEmployeeSearch").empty().append(g.toString());}}}});},trunDownOrderLayer:function(d,c,b){var a=this;layer.open({type:1,title:"订单驳回",maxmin:false,move:false,scrollbar:false,shadeClose:false,btn:["确定","取消"],area:["600px","450px"],content:$(".soEntityTurnDownPane"),success:function(e,f){var h=new StringBuffer();
for(var g=0;g<c.length;g++){if(g!=0){h.append("，");}h.append("<span style='line-height:30px;'>"+c[g]+"</span>");}$("#trunDownSaveReForm").find(".soNoDiv").empty().append(h.toString());
$("#trunDownSaveReForm").find("#soIds").val(d.toString());(function(){var i=this;$("#trunDownSaveReFormComment").bsSuggest("destroy");$("#trunDownSaveReFormComment").bsSuggest({url:ctx+"/gl/cate/cate/getOptions.htm?typeKey=system&pKey=NotApprovedType",effectiveFields:["name"],searchFields:["name"],effectiveFieldsAlias:{name:"驳回备注"},showBtn:false,inputWarnColor:"",showHeader:false,idField:"id",keyField:"name",getDataMethod:"url",processData:function(l){var k,j,m={value:[]};
if(!l||l.records===0){return false;}j=l.length;for(k=0;k<j;k++){m.value.push({id:l[k].id,name:l[k].name});}return m;}});})();},yes:function(g,e){var f=$("#trunDownSaveReForm").find("input[name=trunDownSaveReFormComment]").val();
if(!f){DialogUtils.error("","请选择驳回原因");}else{FormUtils.submit(SoEntityUtils._CONS_.TURN_DOWN_URL,"soIds="+$("#trunDownSaveReForm").find("#soIds").val()+"&comment="+$("input[name=trunDownSaveReFormComment]").val(),function(h){if(h.success){DialogUtils.success(msgCode.INFO,h.msg);
$(".soEntitySearch").click();layer.close(g);if(b&&typeof b==="function"){b();}}else{DialogUtils.error(msgCode.FAIL_MSG,h.msg);layer.close(g);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}},cancel:function(){FormUtils.clear("trunDownSaveReForm");}});},closeOrderLayer:function(d,c,b){var a=this;layer.open({type:1,title:"订单作废确认",maxmin:false,move:false,scrollbar:false,shadeClose:false,btn:["确定","取消"],area:["600px","450px"],content:$(".soEntityClosePane"),success:function(e,g){var j=new StringBuffer();
for(var h=0;h<c.length;h++){if(h!=0){j.append("，");}j.append("<span style='line-height:30px;'>"+c[h]+"</span>");}$("#closeSaveReForm").find(".soNoDiv").empty().append(j.toString());
$("#closeSaveReForm").find("#soIds").val(d.toString());var f={rules:{closeSaveReFormComment:{required:true,maxlength:["512"],}}};FormUtils.bindFormValidation("closeSaveReForm",f);
},yes:function(f,e){if($("#closeSaveReForm").valid()){FormUtils.submit(SoEntityUtils._CONS_.CLOSE_URL,"soIds="+$("#closeSaveReForm").find("#soIds").val()+"&comment="+$("textarea[name=closeSaveReFormComment]").val()+"&isNeddValid=y",function(g){if(g.success){DialogUtils.success(msgCode.INFO,g.msg);
if(b&&typeof b==="function"){b();}$(".soEntitySearch").click();layer.close(f);}else{DialogUtils.error(msgCode.FAIL_MSG,g.msg);layer.close(f);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}},cancel:function(){FormUtils.clear("closeSaveReForm");}});},submit:function(b,a,c){JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.SO_PLACE_URL+"?soId="+b+"&type=self","订单["+a+"]提交");
},deleteSoEntity:function(b){var a=this;DialogUtils.confirm(function(){FormUtils.del(SoEntityUtils._CONS_.DELETE_URL,b,function(c){if(c.success){DialogUtils.success(msgCode.INFO,"删除成功");
$(".end_wrapper").find(".soEntitySearch").click();}else{DialogUtils.error(msgCode.ERROR,c.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});});},lock:function(c,d,a){var b=this;FormUtils.submit(SoEntityUtils._CONS_.LOCK_URL,"soIds="+c,function(e){if(e.success){$("#soEntityForm").find("[name=isLock]").val("y");
DialogUtils.success(msgCode.INFO,e.msg);if(d){b.reloadJqgrid(d,selectedId);}if(typeof(a)=="function"){a();}}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},unLock:function(c,d,a){var b=this;FormUtils.submit(SoEntityUtils._CONS_.UNLOCK_URL,"soIds="+c,function(e){if(e.success){$("#soEntityForm").find("[name=isLock]").val("n");
DialogUtils.success(msgCode.INFO,e.msg);if(d){b.reloadJqgrid(d,selectedId);}if(typeof(a)=="function"){a();}}else{DialogUtils.error(msgCode.FAIL_MSG,e.msg);
}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});},initDetail:function(a){var b=this;$(".csName").attr("readonly",true);$(".changeAddr").hide();
$(".addAddr").hide();$("#prod-price-type").hide();$("#hasStock").parent().hide();$("#searchProd").parents(".form-group").hide();$(".prodPrice").attr("readonly",true);
$(".soItemCount").attr("readonly",true);$("select[name=storeId]").attr("disabled",true);$(".delSoItem").hide();$("select[id=scCode]").attr("disabled",true);
$("select[name=cashType]").attr("disabled",true);$("select[name=isCloudWarehourse]").attr("disabled",true);$("select[name=payType]").attr("disabled",true);
$("select[name=soType]").attr("disabled",true);$("input[name=shippingAmount]").attr("readonly",true);$("input[name=subAmount]").attr("readonly",true);$("input[name=totalAmount]").attr("readonly",true);
$("input[name=waitPayAmount]").attr("readonly",true);$("#selectEmpBtn").hide();$(".soProfitPercent").attr("readonly",true);$(".delSoProfit").hide();$("select[name=isFast]").attr("disabled",true);
$("select[name=billType]").attr("disabled",true);$("input[name=billAmount]").attr("readonly",true);$("textarea[name=billTitle]").attr("readonly",true);
$("textarea[name=billContent]").attr("readonly",true);$("textarea[name=comment]").attr("readonly",true);$("select[name=account]").attr("disabled",true);
$("input[name=shipFollow]").attr("readonly",true);$(".othersDiv").find("#delayConfirmTime").attr("readonly",true);$(".updateSoFollow").hide();if(a&&a.length>0){$(".uploadImage").hide();
$("#imageContainer").empty().append(ImageUtils.createImageDivStr(a,null,true,true,true));var c=b.buildImages(a);$(".downLoadFile").find("img").ImageEnlarge({isNotShowImage:true,imageGroup:c});
}if($("input[name=status]").val()!="shipping"&&$("input[name=status]").val()!="close_lost"){$(".uploadImage").hide();}if($("select[name=cashType]").val()=="cod"||$("select[name=cashType]").val()=="free"||$("select[name=cashType]").val()=="point"){$(".financeAttachDiv").hide();
}ConfigUtils.findByKey("soEntity.isReceivePhone",function(d){if(d.success){$("#receivePhoneDiv").show();$("input[name=tranPhone]").attr("readonly",true);
$("input[name=recPhone]").attr("readonly",true);}else{$("#receivePhoneDiv").hide();}});$(".cashSettingDiv").hide();if($("input[name=cashCode]").val()){$(".cashSettingInfoDiv").show();
}},buildImages:function(b){var a=[];for(var c=0;c<b.length;c++){var d={href:ctx+b[c].path,title:(c+1)+" / "+b.length};a.push(d);}return a;}};SoEntityUtils._CONS_={LIST_URL:ctx+"/ec/salesorder/soEntity/listData.htm",DETAIL_PAGE_URL:ctx+"/ec/salesorder/soEntity/detail.htm",DETAIL_CS_PAGE_URL:ctx+"/crm/cs/csEntity/detail.htm",SO_TO_COMFIRM_URL:ctx+"/ec/salesorder/soEntity/toComfirm.htm",SO_TO_DELIVER_URL:ctx+"/ec/salesorder/soEntity/toDeliver.htm",BACK_DELIVER_URL:ctx+"/ec/salesorder/soEntity/backDeliver.htm",COMFIRM_BATCH_URL:ctx+"/ec/salesorder/soEntity/comfirm.htm",TURN_DOWN_URL:ctx+"/ec/salesorder/soEntity/turndown.htm",DELETE_URL:ctx+"/ec/salesorder/soEntity/delete.htm",CLOSE_URL:ctx+"/ec/salesorder/soEntity/close.htm",LOCK_URL:ctx+"/ec/salesorder/soEntity/lockSo.htm",UNLOCK_URL:ctx+"/ec/salesorder/soEntity/unLockSo.htm",SO_PLACE_URL:ctx+"/ec/salesorder/soEntity/place.htm",FOLLOW_PAGE:ctx+"/ec/salesorder/soEntity/toFollow.htm",EXCHANGEORBACK_URL:ctx+"/ec/salesorder/soEntity/exchange.htm",BATCHRECEIVED_URL:ctx+"/ec/salesorder/soEntity/batchReceived.htm",BACKRECEIVED_URL:ctx+"/ec/salesorder/soEntity/backReceived.htm",STOCK_MANY_URL:ctx+"/ec/salesorder/soEntity/stockForMany.htm",BACK_COMPLETE_URL:ctx+"/ec/salesorder/soEntity/backComplete.htm",REVISIT_PAGE_URL:ctx+"/ec/salesorder/soEntity/toRevisit.htm",IMPORT_EXCEL_URL:ctx+"/ec/salesorder/soEntity/importSoStatus.htm",FOLLOW:function(a,b){window.localStorage.setItem("follow_so_ids_"+currentUserId,a.toString());
window.localStorage.setItem("follow_so_nos_"+currentUserId,b.toString());JTTabUtils.addOrRefreshTab(SoEntityUtils._CONS_.FOLLOW_PAGE+"?soId="+a[0]+"&soNo="+b[0],"订单["+b[0]+"]跟进");
}};