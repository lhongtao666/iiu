$(function(){commomloading=layer.load();var a=new SoEntitySaveSuccess();a.init();});function SoEntitySaveSuccess(){this.hadInit=false;this.isEdit=false;
this.isFormDataChange=false;this.soItem=new SoItem();this.soLog=new SoLog();this.soProfit=new SoProfit();this.soEntityBase=new SoEntityBase();}SoEntitySaveSuccess._CONS_={SUBMIT_URL:ctx+"/ec/salesorder/soEntity/submit.htm",DETAIL_PAGE_URL:ctx+"/ec/salesorder/soEntity/detail.htm",};
SoEntitySaveSuccess.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;$(".shipScInfo").hide();$(".trunDSoBtn ").hide();$(".comfirmSoBtn").hide();
$(".repeatAuditSoBtn").hide();ShipCompanyUtils.getOptions({container:"scCodeInfo"});CateUtils.getOptions({typeKey:"system",pKey:"CsInterestType",container:"interests"});
FinanceAccountSelect.initSelect("cpAccount",null);this.loadData();this._bindEventHander();}layer.close(commomloading);},loadData:function(){StoreUtils.loadStores("","storeIdContainer");
$("select[id=interests]").attr("disabled",true);this.soEntityBase.loadSoData(this,SoEntityBase._CONS_.EDIT_INFO_URL+"?id="+soId,this.loadSelfData,function(b,a){$("a[name=relNo]").attr("value",a.soEntityPo.relNo);
$("a[name=relNo]").text(a.soEntityPo.relNo+"("+a.soEntityPo.relStatus+")");$("a[name=greenNo]").attr("value",a.soEntityPo.greenNo);$("a[name=greenNo]").text(a.soEntityPo.greenNo+"("+a.soEntityPo.greenStatus+")");
$("input[name=totalAmount]").attr("readonly","readonly");});},loadSelfData:function(a,b){$("input[name=cpAccountValue]").val($("select[name=cpAccount]").val());
if(b.soEntityPo.status=="awaiting_post"){$(".submitBtn").hide();$(".toEditPageBtn").show();if(b.soEntityPo.cashType=="cod"||b.soEntityPo.cashType=="free"){$(".cpAccount").hide();
}else{$(".cpAccount").show();}}else{$(".submitBtn").hide();$(".toEditPageBtn").hide();}if(b.soEntityPo.account!=null&&b.soEntityPo.account!=""){$("select[name=cpAccount]").val(b.soEntityPo.account);
}if(b.soEntityPo.soShipPos!=null&&b.soEntityPo.soShipPos.length>0){$("."+SoEntityBase._CONS_.SHIPPING_ADDRS_DIV).empty().append(a.soEntityBase.addAddrStrLine(a,b.soEntityPo.soShipPos[0].partyAddrPo,false));
}if(isPoint&&isPoint=="true"){a.soItem.isPoint=true;}a.soItem.init({isCanEdit:false,data:b.soEntityPo.soItemPos,otherFunc:a.soEntityBase.setAmount,widthElement:".itemDiv"});
a.soLog.init({data:b.soEntityPo.soLogPos});a.soProfit.init({data:b.soEntityPo.soProfitPos,orderCreateId:b.csEntityPo.employeeId,isCanEdit:false,widthElement:".soProfitWidth"});
},_bindEventHander:function(){var a=this;$(".form_wrapper").on("click",".toEditPageBtn",function(){if(!isPoint){isPoint="false";}location.href=SoEntityBase._CONS_.EDIT_PAGE_URL+"?isAdd=false&isPoint="+isPoint+"&id="+$("#id").val()+"&type="+$("input[name=placeType]").val();
});$(".form_wrapper").on("click",".submitBtn",function(){DialogUtils.confirmWithOptions({title:"确定提交订单吗",text:"提交订单",confirmButtonText:"提交",yesFunc:function(){ButtonUtils.disableBtn("submitBtn");
ButtonUtils.disableBtn("toEditPageBtn");var b=$("#id").val();FormUtils.submit(SoEntitySaveSuccess._CONS_.SUBMIT_URL,"id="+b+"&cpAccount="+$("select[name=cpAccount]").val(),function(c){ButtonUtils.enableBtn("submitBtn");
ButtonUtils.enableBtn("toEditPageBtn");if(c.success){DialogUtils.success(msgCode.INFO,c.msg+"成功");$(".submitBtn").hide();$(".toEditPageBtn").hide();$(".soEntityForm").hide();
}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},function(){ButtonUtils.enableBtn("submitBtn");ButtonUtils.enableBtn("toEditPageBtn");DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});}});});$(".form_wrapper").on("click",".toCustOrder",function(){var b=$("input[name=csName]").val();if(b.length>4){b="*"+b.substring(b.length-3,b.length);
}JTTabUtils.addOrRefreshTab(ctx+"/ec/salesorder/soEntity/list.htm?csId="+$("input[name=csId]").val(),"客户["+b+"]订单");});$(".cpAccount").on("change","select[name=cpAccount]",function(){$("input[name=cpAccountValue]").val($("select[name=cpAccount]").val());
});$("body").on("click",".soTab",function(){var c=$(this).attr("value");var b=$(this).attr("value");if(b.length>4){c="*"+b.substring(b.length-3,b.length);
}JTTabUtils.addOrRefreshTab(SoEntitySaveSuccess._CONS_.DETAIL_PAGE_URL+"?soNo="+b,"订单["+c+"]明细");});},};