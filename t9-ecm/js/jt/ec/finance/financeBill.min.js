$(function(){var a=new FinanceBill();a.init();});function FinanceBill(){this.hadInit=false;this.isEdit=false;this.financeBillWaitReceipt=new FinanceBillWaitReceipt();
this.financeBillWaitPay=new FinanceBillWaitPay();this.financeBillReceipted=new FinanceBillReceipted();this.financeBillPayed=new FinanceBillPayed();this.financeBillClosed=new FinanceBillClosed();
this.financeItem=new FinanceItem();this.financeBillAttach=new FinanceBillAttach();this.soEntityRefreshTool=new SoEntityRefreshTool();}FinanceBill._CONS_={SO_DETAIL_PAGE_URL:ctx+"/ec/salesorder/soEntity/detail.htm",RETURN_DETAIL_PAGE_URL:ctx+"/ec/ret/returnEntity/detail.htm",CHANGE_DETAIL_PAGE_URL:ctx+"/ec/ret/exchangeEntity/detail.htm",FIND_BY_SONO_URL:ctx+"/ec/salesorder/soEntity/findCsBySoNo.htm",FIND_BY_ENO_URL:ctx+"/ec/ret/exchangeEntity/findCsByEno.htm",FIND_BY_RNO_URL:ctx+"/ec/ret/returnEntity/findCsByRno.htm",EMPLOYEE_LIST_URL:ctx+"/crm/ou/employee/listEmployees.htm",};
FinanceBill.prototype={init:function(d){var a=this;if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._bindFormValidation();this._hideNotGrantBtn();
this.financeBillWaitReceipt.init();this.soEntityRefreshTool.init({callBackFunc:function(){a._reloadTabs();}});var b=new Date().currentDate()+" 00:00:00";
var c=new Date().currentDate()+" 23:59:59";$(".minPlaceTime").val(b);$(".maxPlaceTime").val(c);ShipCompanyUtils.getOptions({container:"scNameSearch1",caption:"全部"});
ShipCompanyUtils.getOptions({container:"scNameSearch2",caption:"全部"});this._locateToGlHelp();}},_locateToGlHelp:function(){var a="glHelp.finance.financeBill";
glHelpUtil.init(a);},_bindEventHander:function(){var a=this;$(document).on("click",".financeBillExport",function(){a._getActiveTab().financeBillBase._exportFinanceBillExcel();
});$(document).on("click",".prevBtn",function(){a._getActiveTab().financeBillBase.clear(false);});$(document).on("click",".saveBtn",function(){a._getActiveTab().financeBillBase._save();
});$(document).on("click",".completeBtn",function(){a._getActiveTab().financeBillBase._saveFinish();});$(document).on("click",".financeBillTrunDown",function(){var b=$(this).parent().parent().parent().parent().parent().next();
a._getActiveTab().financeBillBase._trunDownSingle(b);});$(document).on("click",".financeBatchComplete",function(){a._getActiveTab().financeBillBase._batchFinish();
});$("body").on("click",".financeBillAdd",function(){a._getActiveTab().financeBillBase.add();});$("body").on("click",".financeBillEdit",function(){var b=$(this).attr("idVal");
a._getActiveTab().financeBillBase.edit(b);});$("body").on("click",".financeBillDel",function(){var b=$(this).attr("idVal");a._getActiveTab().financeBillBase._delete(b);
});$("body").on("click",".financeBillDelete",function(){var b=$(this).attr("idVal");a._getActiveTab().financeBillBase._remove(b);});$("body").on("click",".financeBillDetail",function(){var b=$(this).attr("idVal");
a._getActiveTab().financeBillBase.detail(b);});$("body").on("click",".financeBillComplete",function(){var b=$(this).attr("idVal");a._getActiveTab().financeBillBase.finish(b);
});$("body").on("click",".soTab",function(){var d=$(this).attr("idVal");var b=$(this).attr("entityNoVal");var c=a._getActiveTab().financeBillBase.getFinanceRowData(d);
if(c.status=="processing"){a._getActiveTab().financeBillBase.finish(d,b);}else{a._getActiveTab().financeBillBase.detail(d);}});$("body").on("click",".tabli",function(){var b=a._getChoose($(this).attr("id"));
if(b){b.init();}});},_getActiveTab:function(){var a=null;if($("#waitReceiptTabLi").hasClass("active")){a=this.financeBillWaitReceipt;}else{if($("#waitPayTabLi").hasClass("active")){a=this.financeBillWaitPay;
}else{if($("#receiptedTabLi").hasClass("active")){a=this.financeBillReceipted;}else{if($("#payedTabLi").hasClass("active")){a=this.financeBillPayed;}else{if($("#closedTabLi").hasClass("active")){a=this.financeBillClosed;
}}}}}return a;},_getChoose:function(b){var a=null;if(b=="waitReceiptTabLi"){a=this.financeBillWaitReceipt;}else{if(b=="waitPayTabLi"){a=this.financeBillWaitPay;
}else{if(b=="receiptedTabLi"){a=this.financeBillReceipted;}else{if(b=="payedTabLi"){a=this.financeBillPayed;}else{if(b=="closedTabLi"){a=this.financeBillClosed;
}}}}}return a;},_bindFormValidation:function(){var a={rules:{title:{required:true,maxlength:["120"]},total:{required:true,number:true,min:0},entityNo:{maxlength:["64"]},payAccount:{required:true,maxlength:["250"]},receiptAccount:{required:true,maxlength:["250"]},summary:{maxlength:["1000"]},auditCommentEdit:{required:true,maxlength:["128"]},summaryShow:{required:true,maxlength:["128"]},amountShow:{required:true,number:true,min:0}},messages:{}};
FormUtils.bindFormValidation(FinanceBillBase._CONS_.EDIT_FORM_ID,a);},_hideNotGrantBtn:function(){if(!ResUtils.canShow("financeBill.button.exportFinanceBill")){$("button.financeBillExport").hide();
}if(!ResUtils.canShow("financeBill.button.detail")){$("button.financeBillDetail").hide();}if(!ResUtils.canShow("financeBill.button.add")){$("button.financeBillAdd").hide();
}if(!ResUtils.canShow("financeBill.button.edit")){$("button.financeBillEdit").hide();}if(!ResUtils.canShow("financeBill.button.remove")){$("button.financeBillDel").hide();
}if(!ResUtils.canShow("financeBill.button.complete")){$("button.financeBillComplete").hide();}if(!ResUtils.canShow("financeBill.button.batchComplete")){$("button.financeBatchComplete").hide();
}if(!ResUtils.canShow("financeBill.button.delete")){$("button.financeBillDelete").hide();}if(!ResUtils.canShow("financeBill.button.soEntityTrunDown")){$("button.soEntityTrunDown").hide();
$("button.financeBillTrunDown").hide();}if(!ResUtils.canShow("financeBill.button.exportSoProd")){$("button.exportSo").hide();}},_reloadTabs:function(){this.financeBillWaitReceipt.financeBillBase.resSearchGrid();
this.financeBillReceipted.financeBillBase.resSearchGrid();},};