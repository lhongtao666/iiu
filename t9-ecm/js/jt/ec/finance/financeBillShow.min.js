$(function(){var a=new FinanceBillShow();a.init();});function FinanceBillShow(){this.hadInit=false;this.financeItem=new FinanceItem();this.financeBillBase=new FinanceBillBase();
this.financeBillAttach=new FinanceBillAttach();}FinanceBillShow._CONS_={EDIT_URL:ctx+"/ec/finance/financeBill/edit.htm",DETAIL_URL:ctx+"/ec/finance/financeBill/detail.htm",LIST_DATA_URL:ctx+"/ec/finance/financeBill/listData.htm",EDIT_FORM_ID:"financeBillForm",GRID:"#financeBillGrid",PAGER:"#financeBillPager"};
FinanceBillShow.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._initJqgrid(a);$("select[name=entityType] option[value='salesorder']").remove();
$("select[name=entityType] option[value='returnentity']").remove();$("select[name=entityType] option[value='exchange']").remove();$("select[name=entityType]").append("<option value='salesorder'>订单</option>");
$("select[name=entityType]").append("<option value='returnentity'>退货单</option>");$("select[name=entityType]").append("<option value='exchange'>换货单</option>");
this.financeItem.init();this.financeBillAttach.init();}},clear:function(c){var a=this;function b(){a._showListWrapper();a.isFormDataChange=false;a.isEdit=false;
FormUtils.clear(FinanceBillShow._CONS_.EDIT_FORM_ID);FormUtils.enableForm(FinanceBillShow._CONS_.EDIT_FORM_ID);if(c){a.reloadJqgrid();}}if(a.isEdit&&a.isFormDataChange){DialogUtils.warning(function(){b();
});}else{b();}},_showListWrapper:function(){$(".list_wrapper").show();$(".form_wrapper").hide();},_showFormWrapper:function(){$(".list_wrapper").hide();
$(".form_wrapper").show();},_showDetail:function(){$(".addDiv").show();$(".processInfoDiv").show();$(".statusDiv").show();$(".auditInfoDiv").show();$(".auditCommnetDiv").hide();
$(".otherInfo").hide();$(".financeItemAdd").hide();$(".financeBillAttachAdd").hide();},_detail:function(a){this._showFormWrapper();this._showDetail();this.financeItem.isEdit=false;
this._loadData(a,false);FormUtils.disableForm(FinanceBillShow._CONS_.EDIT_FORM_ID);},_loadData:function(d,a){var b=this;var c=true;if(a==false){c=false;
}FormUtils.loadData(FinanceBillShow._CONS_.DETAIL_URL+"?id="+d,function(e){if("receipt"==e.type){$(".receiptAccountDiv").empty().append("<select name='receiptAccount'  id='receiptAccount' class='form-control' validateType='default' ></select>");
$(".payAccountDiv").empty().append("<input type='text' class='form-control' name='payAccount' "+"id='payAccount' validateType='default'>");}else{$(".receiptAccountDiv").empty().append("<input type='text' class='form-control' name='receiptAccount' "+"id='receiptAccount' validateType='default'>");
$(".payAccountDiv").empty().append("<select name='payAccount' id='payAccount' class='form-control' validateType='default' ></select>");FinanceAccountSelect.initSelect("payAccount",null);
}$("input[name=id]").val(e.id);$("select[name=type]").val(e.type);$("select[name=entityType]").val(e.entityType);$("input[name=entityType]").val(e.entityType);
$("input[name=entityNo]").val(e.entityNo);$("input[name=title]").val(e.title);$("input[name=payType]").val(e.payType);$("select[name=payType]").val(e.payType);
$("input[name=payAccount]").val(e.payAccount);$("input[name=receiptAccount]").val(e.receiptAccount);$("input[name=personId]").val(e.personId);$("input[name=orgId]").val(e.orgId);
$("input[name=personName]").val(e.personName);$("input[name=groupName]").val(e.groupName);$("input[name=status]").val(e.status);$("select[name=status]").val(e.status);
$("textarea[name=summary]").val(e.summary);$("input[name=total]").val(e.total);$("input[name=completeTime]").val(e.completeTime);$("input[name=auditTime]").val(e.auditTime);
$("input[name=auditorId]").val(e.auditorId);$("input[name=auditorName]").val(e.auditorName);$("textarea[name=auditComment]").val(e.auditComment);$("input[name=attachCount]").val(e.attachCount);
$("input[name=createTime]").val(e.createTime);$("input[name=updateTime]").val(e.updateTime);b.financeItem.reloadJqgrid({"Q__S__EQ__bill_id_":e.id});if(e.type!="receipt"&&e.type!=null){if(e.payAccount!=null&&e.payAccount!=""){FinanceAccountSelect.initSelect("payAccount",e.payAccount);
}}else{FinanceAccountSelect.initSelect("receiptAccount",e.receiptAccount);}b.financeBillAttach.showFiles(e.financeBillAttachPos,c);$("input[name=payAccount]").attr("disabled",true);
$("select[name=receiptAccount]").attr("disabled",true);$("select[name=payAccount]").attr("disabled",true);$("input[name=receiptAccount]").attr("disabled",true);
});},_bindEventHander:function(){var a=this;$(document).on("click",".prevBtn",function(){a.clear(false);});$("body").on("click",".financeBillDetail",function(){var b=$(this).attr("idVal");
if(!b){b=$(FinanceBillShow._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_DETAIL);
return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.error,msgCode.ERROR_DETAIL_MUL_RECORD);return;}}}a._detail(b);});$("body").on("dblclick",".financeBillDetail",function(){var b=$(this).attr("idVal");
if(!b){b=$(FinanceBillShow._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_DETAIL);
return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.error,msgCode.ERROR_DETAIL_MUL_RECORD);return;}}}a._detail(b);});},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(FinanceBillShow._CONS_.GRID,a);
},_getManagerBtns:function(){var a=[];a.push({lable:msgCode.DETAIL_BTN_TEXT,btnClasses:"btn btn-primary financeBillDetail",iconClasses:"fa fa-detail"});
return a;},_initJqgrid:function(c){var a=this;if(c==null||typeof c==undefined){c={};}var b=FinanceBillShow._CONS_.LIST_DATA_URL+"?soId="+soId;$(FinanceBillShow._CONS_.GRID).JTJqgrid({url:b,pager:FinanceBillShow._CONS_.PAGER,postData:c,colNames:["单据类型","关联类型","实体编码","标题","结算方式","付款账户","收款账户","经办人 ID","经办人","经办人所在部门 ID","经办人部门","状态","摘要","总金额","完成时间","审核说明","单据附件数量","创建时间","更新时间","操作"],colModel:[{name:"type",index:"type_",width:120,formatter:function(d,f,g){var e=g.type;
if(g.type=="receipt"){e="<span>收款单</span>";}else{if(g.type=="pay"){e="<span>付款单</span>";}else{if(g.type=="refund"){e="<span>退款单</span>";}}}return e;}},{name:"entityType",index:"entity_type_",width:120,width:120,formatter:function(d,f,g){var e=g.entityType;
if(g.entityType=="none"){e="<span>人工录入</span>";}else{if(g.entityType=="salesorder"){e="<span>订单</span>";}else{if(g.entityType=="contract"){e="<span>合同</span>";
}}}return e;}},{name:"entityNo",index:"entity_no_",width:120},{name:"title",index:"title_",width:120},{name:"payType",index:"pay_type_",width:120,formatter:function(d,f,g){var e=g.payType;
if(g.payType=="alipay"){e="支付宝";}else{if(g.payType=="weixin"){e="微信支付";}else{if(g.payType=="bank"){e="银行转账";}else{if(g.payType=="cash"){e="现金支付";}}}}return e;
}},{name:"payAccount",index:"pay_account_",width:120,hidedlg:true,hidden:true},{name:"receiptAccount",index:"receipt_account_",width:120,hidedlg:true,hidden:true},{name:"personId",index:"person_id_",width:120,hidedlg:true,hidden:true},{name:"personName",width:120,sortable:false},{name:"orgId",index:"org_id_",width:120,hidedlg:true,hidden:true},{name:"groupName",width:120,sortable:false},{name:"status",index:"status_",width:120,formatter:function(d,f,g){var e=g.status;
if(g.status=="processing"){e="<span>处理中</span>";}else{if(g.status=="cancel"){e="<span>取消</span>";}else{if(g.status=="done"){e="<span>处理完毕</span>";}else{if(g.status=="audit"){e="<span>已审核</span>";
}}}}return e;}},{name:"summary",index:"summary_",width:120,hidedlg:true,hidden:true},{name:"total",index:"total_",width:120},{name:"completeTime",index:"complete_time_",width:120},{name:"auditComment",index:"audit_comment_",width:120,hidedlg:true,hidden:true},{name:"attachCount",index:"attach_count_",width:120},{name:"createTime",index:"create_time_",width:120,hidedlg:true,hidden:true},{name:"updateTime",index:"update_time_",width:120},{name:"__manage",width:80,formatter:function(d,e,f){return"<button type='button' class='btn btn-sm btn-outline btn-primary financeBillDetail' idVal='"+f.id+"'><i class='fa fa-detail'>明细</i></button>";
}}],ondblClickRow:function(d){if(d){a._detail(d);}},});},};