function SoShipmentLayer(){this.hadInit=false;this.isEdit=false;}SoShipmentLayer._CONS_={EDIT_FROM_ID:"soShipBalanceEditForm",DETAIL_URL:ctx+"/ec/salesorder/soEntity/soShipmentDetail.htm",UPDATE_BALANCE_URL:ctx+"/ec/salesorder/soEntity/updateBalance.htm",REVOKE_BALANCE_URL:ctx+"/ec/salesorder/soEntity/revokeBalance.htm",UPDATE_AMOUNT_URL:ctx+"/ec/salesorder/soEntity/updateSoShipAmount.htm",};
SoShipmentLayer.prototype={init:function(a){this._bindEventHander();this._openBalanceDialog(a);this._bindFormValidation();},_openBalanceDialog:function(b){var a=this;
layer.open({type:1,title:"出货订单结算",maxmin:false,shadeClose:false,scrollbar:false,btn:["关闭"],area:["60%;","65%"],content:$("."+SoShipmentLayer._CONS_.EDIT_FROM_ID),success:function(c,d){FormUtils.clear("soShipBalanceForm");
a._loadData(b.id);},yes:function(d,c){$("#soShipBalanceForm").validate().resetForm();FormUtils.clear("soShipBalanceForm");if(b.callBack){b.callBack(true);
}layer.close(d);},cancel:function(c){if(b.callBack){b.callBack(true);}}});},_loadData:function(b){var a=this;FormUtils.loadData(SoShipmentLayer._CONS_.DETAIL_URL+"?id="+b,function(c){$("input[name=id]").val(c.id);
$(".soNo").text(c.soNo);if(c.cashType=="pay"){$(".cashType").text("款到发货");}else{if(c.cashType=="pay_sub"){$(".cashType").text("支付订金");}else{if(c.cashType=="cod"){$(".cashType").text("货到付款");
}else{if(c.cashType=="free"){$(".cashType").text("免费已付");}}}}if(c.status=="complete"){$(".status").text("已签收");}else{if(c.status=="close_reject"){$(".status").text("拒收");
}else{if(c.status=="close_lost"){$(".status").text("丢失");}else{if(c.status=="shipping"){$(".status").text("已发货");}}}}$(".totalAmount").text(c.totalAmount);
$(".shipTime").text(c.shipTime);$(".scName").text(c.scName);$(".scTrackingNo").text(c.scTrackingNo);$("input[name=actualAmount]").val(c.actualAmount);$("input[name=proxyAmount]").val(c.proxyedAmount);
$("input[name=counterAmount]").val(c.counteredAmount);$("input[name=breakAmount]").val(c.breakAmount);$("input[name=otherAmount]").val(c.otherAmount);$(".receiptTotal").text(c.receiptTotal);
$(".payTotal").text(c.payTotal);var d=c.receiptTotal-c.payTotal;if(d>0){$(".allTotal").text("收"+d+"元");}else{$(".allTotal").text("付"+(-d)+"元");}if(c.actualTime){$("input[name=actualAmount]").attr("disabled","disabled");
$("#actualRevokeBtn").show();$("#actualBalanceBtn").hide();}else{$("input[name=actualAmount]").removeAttr("disabled");$("#actualRevokeBtn").hide();$("#actualBalanceBtn").show();
}if(c.proxyTime){$("input[name=counterAmount]").attr("disabled","disabled");$("input[name=proxyAmount]").attr("disabled","disabled");$("#proxyRevokeBtn").show();
$("#proxyBalanceBtn").hide();}else{$("input[name=counterAmount]").removeAttr("disabled");$("input[name=proxyAmount]").removeAttr("disabled");$("#proxyRevokeBtn").hide();
$("#proxyBalanceBtn").show();}if(c.otherTime){$("input[name=breakAmount]").attr("disabled","disabled");$("input[name=otherAmount]").attr("disabled","disabled");
$("#breakRevokeBtn").show();$("#breakBlanceBtn").hide();}else{$("input[name=breakAmount]").removeAttr("disabled");$("input[name=otherAmount]").attr("disabled");
$("#breakRevokeBtn").hide();$("#breakBlanceBtn").show();}if(c.cashType=="pay_sub"||c.cashType=="cod"){if(c.status=="complete"){$("#proxyRevokeBtn").removeAttr("disabled");
$("#proxyBalanceBtn").removeAttr("disabled");$("#breakRevokeBtn").attr("disabled","disabled");$("#breakBlanceBtn").attr("disabled","disabled");$("input[name=breakAmount]").attr("disabled","disabled");
$("input[name=otherAmount]").attr("disabled","disabled");}else{if(c.status=="close_lost"||(c.status=="close_reject"&&c.breakType=="break")){$("#breakRevokeBtn").removeAttr("disabled");
$("#breakBlanceBtn").removeAttr("disabled");$("#proxyRevokeBtn").attr("disabled","disabled");$("#proxyBalanceBtn").attr("disabled","disabled");$("input[name=counterAmount]").attr("disabled","disabled");
$("input[name=proxyAmount]").attr("disabled","disabled");}else{if(c.status=="close_reject"&&c.breakType!="break"){$("#breakRevokeBtn").removeAttr("disabled");
$("#breakBlanceBtn").removeAttr("disabled");$("#proxyRevokeBtn").attr("disabled","disabled");$("#proxyBalanceBtn").attr("disabled","disabled");$("input[name=counterAmount]").attr("disabled","disabled");
$("input[name=proxyAmount]").attr("disabled","disabled");$("input[name=breakAmount]").attr("disabled","disabled");}else{if(c.status=="shipping"){$("input[name=breakAmount]").attr("disabled","disabled");
$("input[name=otherAmount]").attr("disabled","disabled");$("#breakBlanceBtn").attr("disabled","disabled");}}}}}else{if(c.status=="complete"){$("#proxyRevokeBtn").attr("disabled","disabled");
$("#proxyBalanceBtn").attr("disabled","disabled");$("#breakRevokeBtn").attr("disabled","disabled");$("#breakBlanceBtn").attr("disabled","disabled");$("input[name=breakAmount]").attr("disabled","disabled");
$("input[name=otherAmount]").attr("disabled","disabled");$("input[name=counterAmount]").attr("disabled","disabled");$("input[name=proxyAmount]").attr("disabled","disabled");
}else{if(c.status=="close_lost"||(c.status=="close_reject"&&c.breakType=="break")){$("#breakRevokeBtn").removeAttr("disabled");$("#breakBlanceBtn").removeAttr("disabled");
$("#proxyRevokeBtn").attr("disabled","disabled");$("#proxyBalanceBtn").attr("disabled","disabled");$("input[name=counterAmount]").attr("disabled","disabled");
$("input[name=proxyAmount]").attr("disabled","disabled");}else{if(c.status=="close_reject"&&c.breakType!="break"){$("#breakRevokeBtn").removeAttr("disabled");
$("#breakBlanceBtn").removeAttr("disabled");$("#proxyRevokeBtn").attr("disabled","disabled");$("#proxyBalanceBtn").attr("disabled","disabled");$("input[name=counterAmount]").attr("disabled","disabled");
$("input[name=breakAmount]").attr("disabled","disabled");}else{if(c.status=="shipping"){$("input[name=breakAmount]").attr("disabled","disabled");$("input[name=otherAmount]").attr("disabled","disabled");
$("#breakBlanceBtn").attr("disabled","disabled");}}}}}});},_bindFormValidation:function(){jQuery.validator.addMethod("isNumber",function(c,b){return this.optional(b)||/^[-\+]?\d+$/.test(c)||/^[-\+]?\d+(\.\d{1}|\.\d{2})?$/.test(c);
},"只能输入两位小数");var a={rules:{"actualAmount":{isNumber:true,max:99999999999999,min:0},"breakAmount":{isNumber:true,max:99999999999999,min:0},"counterAmount":{isNumber:true,max:99999999999999,min:0},"otherAmount":{isNumber:true,max:99999999999999,min:0},},messages:{}};
FormUtils.bindFormValidation("soShipBalanceForm",a);},_bindEventHander:function(){var a=this;$(document).on("click",".balance",function(){var b=$(this).attr("name");
var c=$("input[name=id]").val();$.ajax({type:"POST",url:SoShipmentLayer._CONS_.UPDATE_BALANCE_URL+"?type="+b+"&id="+c,contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(d){if(d.success){FormUtils.clear("soShipBalanceForm");
a._loadData(c);return;}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);}},error:function(d){DialogUtils.error(msgCode.FAIL_MSG,d.msg);}});});$(document).on("click",".revoke",function(){var b=$(this).attr("name");
var c=$("input[name=id]").val();$.ajax({type:"POST",url:SoShipmentLayer._CONS_.REVOKE_BALANCE_URL+"?type="+b+"&id="+c,contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(d){if(d.success){FormUtils.clear("soShipBalanceForm");
a._loadData(c);return;}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);}},error:function(d){DialogUtils.error(msgCode.FAIL_MSG,d.msg);}});});$(document).on("change",".otherAmount",function(){var b=$("input[name=id]").val();
$.ajax({type:"POST",url:SoShipmentLayer._CONS_.UPDATE_AMOUNT_URL+"?id="+b+"&amount="+$(this).val()+"&type=other",contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(c){if(c.success){a._loadData(b);
return;}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},error:function(c){DialogUtils.error(msgCode.FAIL_MSG,c.msg);}});});$(document).on("change",".actualAmount",function(){var b=$("input[name=id]").val();
$.ajax({type:"POST",url:SoShipmentLayer._CONS_.UPDATE_AMOUNT_URL+"?id="+b+"&amount="+$(this).val()+"&type=actual",contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(c){if(c.success){a._loadData(b);
return;}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},error:function(c){DialogUtils.error(msgCode.FAIL_MSG,c.msg);}});});$(document).on("change",".counterAmount",function(){var b=$("input[name=id]").val();
$.ajax({type:"POST",url:SoShipmentLayer._CONS_.UPDATE_AMOUNT_URL+"?id="+b+"&amount="+$(this).val()+"&type=counter",contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(c){if(c.success){a._loadData(b);
return;}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},error:function(c){DialogUtils.error(msgCode.FAIL_MSG,c.msg);}});});$(document).on("change",".proxyAmount",function(){var b=$("input[name=id]").val();
$.ajax({type:"POST",url:SoShipmentLayer._CONS_.UPDATE_AMOUNT_URL+"?id="+b+"&amount="+$(this).val()+"&type=proxy",contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(c){if(c.success){a._loadData(b);
return;}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},error:function(c){DialogUtils.error(msgCode.FAIL_MSG,c.msg);}});});$(document).on("change",".breakAmount",function(){var b=$("input[name=id]").val();
$.ajax({type:"POST",url:SoShipmentLayer._CONS_.UPDATE_AMOUNT_URL+"?id="+b+"&amount="+$(this).val()+"&type=breakAmount",contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(c){if(c.success){a._loadData(b);
return;}else{DialogUtils.error(msgCode.FAIL_MSG,c.msg);}},error:function(c){DialogUtils.error(msgCode.FAIL_MSG,c.msg);}});});}};