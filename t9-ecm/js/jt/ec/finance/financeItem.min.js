function FinanceItem(){this.hadInit=false;this.isEdit=true;this.financeItemRowid=0;}FinanceItem._CONS_={LIST_DATA_URL:ctx+"/ec/finance/financeBill/financeItemListData.htm",GRID:"#financeItemGrid",GRID_ID:"financeItemGrid",PAGER:"#financeItemPager",PAGER_ID:"financeItemPager",JSON_ID:"financeItemJSON",};
FinanceItem.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();a._initJqgrid(b);}},_bindEventHander:function(){var a=this;
$(".form_wrapper").on("click",".financeItemAdd",function(){CateUtils.selectCate({typeKey:"finance",pKey:"finance_accounts",isMultiple:1,fn:function(b){if(b&&b.length>0){for(var c=0;
c<b.length;c++){a.addFinanceItemRow({itemCode:b[c].key,itemName:b[c].name});}}},onAsyncSuccess:function(b,j,k,d){var c=$.fn.zTree.getZTreeObj(j).getNodes();
var e=$.fn.zTree.getZTreeObj(j);for(var h=0;h<c.length;h++){var f=c[h];if(k==null){f.nocheck=true;e.updateNode(f);e.expandNode(f,true,false,true,false);
}var l=f.children;for(var h=0;h<l.length;h++){var g=l[h];if(g.level==1){g.nocheck=true;e.updateNode(g);}}}}});});$(document).on("click",".delFinanceItem",function(){var b=$(this).val();
DialogUtils.confirmWithOptions({title:"您确定要删除该科目吗?",text:"删除后需要点击上面的保存按钮才会生效",confirmButtonText:"删除",yesFunc:function(){$(FinanceItem._CONS_.GRID).delRowData(b);
}});});$(document).on("change","input[name=amountShow]",function(){var c=$(this).parent().parent().attr("id");var b=$(this).val();$(FinanceItem._CONS_.GRID).setCell(c,"amount",b);
a.footerData();});$(document).on("change","input[name=summaryShow]",function(){var c=$(this).parent().parent().attr("id");var b=$(this).val();$(FinanceItem._CONS_.GRID).setCell(c,"summary",b);
});},_initJqgrid:function(b){var a=this;$.jgrid.defaults.styleUI="Bootstrap";$(FinanceItem._CONS_.GRID).jqGrid({datatype:"json",url:FinanceItem._CONS_.LIST_DATA_URL,height:350,autowidth:true,shrinkToFit:true,rowNum:20,mtype:"POST",viewrecords:true,multiselect:false,rowList:[10,20,30],rownumbers:true,colNames:["从属单据 ID","摘要","摘要","科目编号","科目名称","金额","金额","创建时间","更新时间","操作"],colModel:[{name:"billId",editable:false,width:120,hidedlg:true,hidden:true},{name:"summary",editable:false,width:320,hidedlg:true,hidden:true},{name:"summaryShow",editable:true,width:320},{name:"itemCode",editable:false,width:120},{name:"itemName",editable:false,width:120},{name:"amount",editable:false,width:120,hidedlg:true,hidden:true,align:"right",sorttype:"float",classes:"test",formatter:"number",summaryType:"sum"},{name:"amountShow",editable:true,width:120},{name:"createTime",editable:false,hidedlg:true,hidden:true,width:120},{name:"updateTime",editable:false,hidedlg:true,hidden:true,width:120},{name:"button",width:120}],footerrow:true,hidegrid:false,gridComplete:function(){var d=$(FinanceItem._CONS_.GRID).jqGrid("getDataIDs");
for(var c=0;c<d.length;c++){var e="";if(a.isEdit==true){e="<button  type='button'   class='btn btn-warning delFinanceItem'   style='margin: 0px 3px 0px 0px;'    value='"+d[c]+"' >删除</button>";
}$(FinanceItem._CONS_.GRID).jqGrid("setRowData",d[c],{button:e});if(d[c]!="total"){if(a.isEdit==true){$(FinanceItem._CONS_.GRID).editRow(d[c]);}else{$(FinanceItem._CONS_.GRID).jqGrid("saveRow",d[c],false);
$(FinanceItem._CONS_.GRID).jqGrid("setRowData",d[c],{isGridRowEdit:"N"});}}}a.footerData();}});},footerData:function(){var b=$(FinanceItem._CONS_.GRID).jqGrid("getCol","amount",true,"sum");
$(FinanceItem._CONS_.GRID).jqGrid("footerData","set",{summaryShow:"总计:",amountShow:b});var a=$(FinanceItem._CONS_.GRID).jqGrid("footerData","get");return a;
},getFooterData:function(){var a=$(FinanceItem._CONS_.GRID).jqGrid("footerData","get");return a;},addFinanceItemRow:function(b){b.amount=0;b.billId="";
b.summary="";b.amount="";var a=new Date().getTime();$(FinanceItem._CONS_.GRID).jqGrid("addRowData","tmpfinanceItem"+a,b,"last");},delFinanceItem:function(a){DialogUtils.onfirm(function(){JTSubGridUtils.delRows(FinanceItem._CONS_.GRID_ID,a);
});},financeItemGridData2Json:function(){var a=$(FinanceItem._CONS_.GRID);var b=new StringBuffer();b.append("[");var d=a.jqGrid("getDataIDs");for(var c=0;
c<d.length;c++){var e=a.jqGrid("getRowData",d[c]);if(e["isGridRowEdit"]=="Y"){alert("有参数尚未保存，请选择保存或者取消变更!");getElementById(d[c]).focus();return false;}b.append("{");
b.append("'billId':'").append(e["billId"]).append("',");b.append("'summary':'").append(e["summary"]).append("',");b.append("'itemCode':'").append(e["itemCode"]).append("',");
b.append("'itemName':'").append(e["itemName"]).append("',");b.append("'amount':'").append(e["amount"]).append("',");if(e["createTime"]!=""&&e["createTime"]!=null){b.append("'createTime':'").append(e["createTime"]).append("',");
}if(e["updateTime"]!=""&&e["updateTime"]!=null){b.append("'updateTime':'").append(e["updateTime"]).append("',");}if(!d[c].startsWith("tmpfinanceItem")){b.append("'id':'").append(d[c]).append("'");
}b.append("},");}var f=""+b;if(d.length>0){f=f.substring(0,f.length-1);}f=f+"]";return f;},validateFinanceItemGrid:function(b,a){var c=$("#financeItemForm").validate();
return true;},reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(FinanceItem._CONS_.GRID,a);},showButtonCol:function(){$(FinanceItem._CONS_.GRID).setGridParam().showCol("button").trigger("reloadGrid");
},hideButtonCol:function(){$(FinanceItem._CONS_.GRID).setGridParam().hideCol("button").trigger("reloadGrid");},};