function FinanceBillAttach(){this.hadInit=false;this.isEdit=false;this.financeBillAttachRowid=0;}FinanceBillAttach._CONS_={GRID:"#financeBillAttachGrid",GRID_ID:"financeBillAttachGrid",PAGER:"#financeBillAttachPager",PAGER_ID:"financeBillAttachPager",JSON_ID:"financeBillAttachJSON",};
FinanceBillAttach.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();}},_bindEventHander:function(){var a=this;$(".form_wrapper").on("click",".financeBillAttachAdd",function(){FileUtils.selectFile(1,function(b){if(b&&b.length>0){$(".financeBillAttachDiv").append(FileUtils.createFileDivStr(b));
}});});$(".financeBillAttachDiv").on("click",".deleteFile",function(){var c=$(this).parent().parent();var b={title:"确定删除《"+$(this).next().attr("nameVal")+"》吗？",text:"点击保存按钮后，该删除将不可恢复",yesFunc:function(){c.remove();
}};DialogUtils.confirmWithOptions(b);});},showFiles:function(b,a){$(".financeBillAttachDiv").empty();if(b&&b.length>0){$.log(JSON.stringify(b));$(".financeBillAttachDiv").empty().append(FileUtils.createFileDivStr(b));
}if(a==false){$(".deleteFile").hide();}},_initJqgrid:function(b){var a=this;$.jgrid.defaults.styleUI="Bootstrap";$(FinanceBillAttach._CONS_.GRID).jqGrid({datatype:"json",url:ctx+"/ec/finance/financeBill/financeBillAttachListData.htm",height:350,autowidth:true,shrinkToFit:true,rowNum:20,mtype:"POST",viewrecords:true,multiselect:true,rowList:[10,20,30],rownumbers:true,colNames:["文件名","存储路径","从属单据 ID","排序号","创建时间","操作"],colModel:[{name:"name",editable:true,width:120},{name:"path",editable:true,width:120},{name:"billId",editable:true,width:120},{name:"sort",editable:true,width:120},{name:"createTime",editable:true,hidedlg:true,hidden:true,width:120},{name:"button",width:120}],pager:FinanceBillAttach._CONS_.PAGER,hidegrid:false,gridComplete:function(){JTSubGridUtils.addRowButtons(FinanceBillAttach._CONS_.GRID_ID);
}});$(FinanceBillAttach._CONS_.GRID).jqGrid("navGrid",FinanceBillAttach._CONS_.PAGER,{add:true,addtitle:"添加",addfunc:a.addFinanceBillAttachRow,del:true,deltitle:"删除",delfunc:a.delFinanceBillAttach,refresh:false,search:false,edit:false});
},addFinanceBillAttachRow:function(){var a=new Date().getTime();JTSubGridUtils.addRow(FinanceBillAttach._CONS_.GRID_ID,"tmpfinanceBillAttach"+a);},delFinanceBillAttach:function(a){DialogUtils.confirm(function(){JTSubGridUtils.delRows(FinanceBillAttach._CONS_.GRID_ID,a);
});},financeBillAttachGridData2Json:function(){var f=$(FinanceBillAttach._CONS_.GRID);var a=new StringBuffer();a.append("[");var c=f.jqGrid("getDataIDs");
for(var b=0;b<c.length;b++){var d=f.jqGrid("getRowData",c[b]);if(d["isGridRowEdit"]=="Y"){alert("有参数尚未保存，请选择保存或者取消变更!");getElementById(c[b]).focus();return false;
}a.append("{");a.append("'name':'").append(d["name"]).append("',");a.append("'path':'").append(d["path"]).append("',");a.append("'billId':'").append(d["billId"]).append("',");
a.append("'sort':'").append(d["sort"]).append("',");a.append("'createTime':'").append(d["createTime"]).append("',");if(!c[b].startsWith("tmpfinanceBillAttach")){a.append("'id':'").append(c[b]).append("'");
}a.append("},");}var e=""+a;if(c.length>0){e=e.substring(0,e.length-1);}e=e+"]";$("#"+FinanceBillAttach._CONS_.JSON_ID).val(e);return true;},getFileList:function(){var a=new StringBuffer();
a.append("[");var b=0;$(".financeBillAttachDiv").find(".file-box").each(function(){var e=$(this).find(".file a").eq(0).attr("nameVal");var d=$(this).find(".file a").eq(0).attr("urlVal");
a.append("{");a.append("'name':'").append(e).append("',");a.append("'path':'").append(d).append("',");a.append("'billId':'").append().append("',");a.append("'sort':'").append().append("',");
a.append("'createTime':'").append().append("',");a.append("'id':'").append($(this).find(".file a").eq(0).attr("idVal")).append("'");a.append("},");b++;
});$("input[name=attachCount]").val(b);var c=""+a;if(c.length>1){c=c.substring(0,c.length-1);}c=c+"]";return c;},validateFinanceBillAttachGrid:function(b,a){var c=$("#financeBillAttachForm").validate();
return true;},reloadJqgrid:function(f){var e={};if(f&&jQuery.type(f)=="string"){f=decodeURIComponent(f,true);var b=f.split("&");if(b.length){for(var c=0;
c<b.length;c++){var d=b[c].split("=");if(d.length==2&&d[1]){e[d[0]]=d[1];}else{e[d[0]]=d[1];}}}}else{e=f;}var a=$(FinanceBillAttach._CONS_.GRID).jqGrid("getGridParam","postData");
$.extend(a,e);$(FinanceBillAttach._CONS_.GRID).jqGrid("setGridParam",{search:true}).trigger("reloadGrid",[{page:1}]);},};