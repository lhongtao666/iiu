$(function(){var a=new ReturnEntity();a.init();});function ReturnEntity(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;this.returnEntityBase=new ReturnEntityBase();
this.returnEntityComfirm=new ReturnEntityComfirm();this.returnEntityReceive=new ReturnEntityReceive();this.returnEntityRefund=new ReturnEntityRefund();
this.returnEntityRefunding=new ReturnEntityRefunding();this.returnEntityComplete=new ReturnEntityComplete();this.returnEntityReject=new ReturnEntityReject();
this.returnEntityNotReceive=new ReturnEntityNotReceive();this.returnLog=new ReturnLog();}ReturnEntity._CONS_={EDIT_URL:ctx+"/ec/ret/returnEntity/edit.htm",DETAIL_URL:ctx+"/ec/ret/returnEntity/detail.htm",DELETE_URL:ctx+"/ec/ret/returnEntity/delete.htm",SAVE_ADD_URL:ctx+"/ec/ret/returnEntity/saveAdd.htm",SAVE_EDIT_URL:ctx+"/ec/ret/returnEntity/saveEdit.htm",LIST_DATA_URL:ctx+"/ec/ret/returnEntity/listData.htm",GRID:"#returnEntityGrid",PAGER:"#returnEntityPager"};
ReturnEntity.prototype={init:function(a){if(!this.hadInit){retWidth=$(".wait_submit_wrapper").width();this.hadInit=true;this._hideNotGrantBtn();this._bindFormValidation();
this._bindEventHander();this._initInputAndOption();this.returnEntityComfirm.init();this.returnEntityReceive.init();this.returnEntityRefund.init();this.returnEntityRefunding.init();
this.returnEntityComplete.init();this.returnEntityReject.init();this.returnEntityNotReceive.init();this.returnEntityBase.countAllStatus();if("index"==fromType){this._initTabForReceive();
}}},_hideNotGrantBtn:function(){if(!ResUtils.canShow("returnEntity.button.comfirm")){$(".returnEntityComfirm").hide();}if(!ResUtils.canShow("returnEntity.button.comfirmEdit")){$(".comfirmEdit").hide();
}if(!ResUtils.canShow("returnEntity.button.comfirmDetail")){$(".comfirmDetail").hide();}if(!ResUtils.canShow("returnEntity.button.receive")){$(".returnEntityReceive").hide();
}if(!ResUtils.canShow("returnEntity.button.receiveEdit")){$(".receiveEdit").hide();}if(!ResUtils.canShow("returnEntity.button.receiveDetail")){$(".receiveDetail").hide();
}if(!ResUtils.canShow("returnEntity.button.refund")){$(".returnEntityRefund").hide();}if(!ResUtils.canShow("returnEntity.button.refundEdit")){$(".refundEdit").hide();
}if(!ResUtils.canShow("returnEntity.button.refundDetail")){$(".refundDetail").hide();}if(!ResUtils.canShow("returnEntity.button.refundingDetail")){$(".refundingDetail").hide();
}if(!ResUtils.canShow("returnEntity.button.completeDetail")){$(".completeDetail").hide();}if(!ResUtils.canShow("returnEntity.button.rejectDetail")){$(".rejectDetail").hide();
}if(!ResUtils.canShow("returnEntity.button.notReceiveDetail")){$(".notReceiveDetail").hide();}},_bindEventHander:function(){var a=this;$("#"+ReturnEntityBase._CONS_.APPLY_FORM_ID).on("change","input",function(){if(a.isEdit){a.isFormDataChange=true;
}});$("#"+ReturnEntityBase._CONS_.APPLY_FORM_ID).on("change","select",function(){if(a.isEdit){a.isFormDataChange=true;}});$("#"+ReturnEntityBase._CONS_.APPLY_FORM_ID).on("change","textarea",function(){if(a.isEdit){a.isFormDataChange=true;
}});$("#prevBtn").on("click",function(){a.initForm(true);});$("#save").on("click",function(){a.returnEntityBase._save("",function(){a.initForm(false);});
});$("#comfirm").on("click",function(){var b=$("#"+ReturnEntityBase._CONS_.APPLY_FORM_ID).find("[name=needReturn]").val();if(b=="N"){DialogUtils.error(msgCode.FAIL_MSG,"请确认等待退货跟是否需要回寄一致");
return;}a.returnEntityBase._save("comfirm",function(){a.initForm(false);});});$("#comfirm_direct").on("click",function(){var b=$("#"+ReturnEntityBase._CONS_.APPLY_FORM_ID).find("[name=needReturn]").val();
if(b=="Y"){DialogUtils.error(msgCode.FAIL_MSG,"请确认无需退货跟是否需要回寄一致");return;}a.returnEntityBase._save("comfirm_direct",function(){a.initForm(false);});});
$("#reject").on("click",function(){a.returnEntityBase._save("reject",function(){a.initForm(false);});});$("#receive").on("click",function(){a.returnEntityBase._save("receive",function(){a.initForm(false);
});});$("#not_receive").on("click",function(){a.returnEntityBase._save("not_receive",function(){a.initForm(false);});});$("#refund").on("click",function(){FormUtils.enableForm("refundAddForm");
$("#refundAddForm").find("[id=billStatusDiv]").hide();a.returnEntityBase.openEditDialog(true,function(){a.returnEntityBase._save("refund",function(){a.initForm(false);
},ReturnEntityRefund._CONS_.SAVE_ADD_URL);});});$("#viewBill").on("click",function(){FormUtils.disableForm("refundAddForm");$("#refundAddForm").find("[id=billStatusDiv]").show();
a.returnEntityBase.openEditDialog(false,null);});$("body").on("click",".returnEntityComfirm",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(ReturnEntityComfirm._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);
return;}}b=b[0];}a._initComfirmBtn();a.returnLog.init(b);a.returnEntityBase._edit(b);});$("body").on("click",".comfirmEdit",function(){a.isEdit=true;var b=$(this).attr("idVal");
if(!b){b=$(ReturnEntityComfirm._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);
return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);return;}}b=b[0];}a._initEditBtn();a.returnLog.init(b);a.returnEntityBase._edit(b);
});$("body").on("click",".comfirmDetail",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(ReturnEntityComfirm._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);
return;}}b=b[0];}a._initDetailBtn();a.returnLog.init(b);a.returnEntityBase._edit(b);});$("body").on("click",".returnEntityReceive",function(){a.isEdit=true;
var b=$(this).attr("idVal");if(!b){b=$(ReturnEntityReceive._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);
return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);return;}}b=b[0];}a._initReceiveBtn();a.returnLog.init(b);
a.returnEntityBase._edit(b);});$("body").on("click",".receiveEdit",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(ReturnEntityReceive._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);
return;}}b=b[0];}a._initEditBtn();a.returnLog.init(b);a.returnEntityBase._edit(b);});$("body").on("click",".receiveDetail",function(){a.isEdit=true;var b=$(this).attr("idVal");
if(!b){b=$(ReturnEntityReceive._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);
return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);return;}}b=b[0];}a._initDetailBtn();a.returnLog.init(b);a.returnEntityBase._edit(b);
});$("body").on("click",".returnEntityRefund",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(ReturnEntityRefund._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);
return;}}b=b[0];}a._initRefundBtn();a.returnLog.init(b);a.returnEntityBase._edit(b);});$("body").on("click",".refundEdit",function(){a.isEdit=true;var b=$(this).attr("idVal");
if(!b){b=$(ReturnEntityRefund._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);
return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);return;}}b=b[0];}a._initEditBtn();a.returnLog.init(b);a.returnEntityBase._edit(b);
});$("body").on("click",".refundDetail",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(ReturnEntityRefund._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);
return;}}b=b[0];}a._initDetailBtn();a.returnLog.init(b);a.returnEntityBase._edit(b);});$("body").on("click",".refundingDetail",function(){a.isEdit=true;
var b=$(this).attr("idVal");if(!b){b=$(ReturnEntityRefunding._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);
return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);return;}}b=b[0];}a._initDetailBtn();a.returnLog.init(b);a.returnEntityBase._edit(b);
});$("body").on("click",".completeDetail",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(ReturnEntityComplete._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);
return;}}b=b[0];}a._initDetailBtn();a.returnLog.init(b);a.returnEntityBase._edit(b);});$("body").on("click",".rejectDetail",function(){a.isEdit=true;var b=$(this).attr("idVal");
if(!b){b=$(ReturnEntityReject._CONS_.GRID).jqGrid("getGridParam","selarrrow");if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);
return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);return;}}b=b[0];}a._initDetailBtn();a.returnLog.init(b);a.returnEntityBase._edit(b);
});$("body").on("click",".notReceiveDetail",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(ReturnEntityNotReceive._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,msgCode.ERROR_NO_SELECT_EDIT);return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_EDIT_MUL_RECORD);
return;}}b=b[0];}a._initDetailBtn();a.returnLog.init(b);a.returnEntityBase._edit(b);});$(".list_wrapper").on("click",".listTabli",function(){var c=$(this).attr("attr-type");
var b=a._getActiveTab();if(c==b){return;}if("comfirm"==c){a.returnEntityComfirm.init();}if("receive"==c){a.returnEntityReceive.init();}if("refund"==c){a.returnEntityRefund.init();
}if("refunding"==c){a.returnEntityRefunding.init();}if("complete"==c){a.returnEntityComplete.init();}if("reject"==c){a.returnEntityReject.init();}if("notReceive"==c){a.returnEntityNotReceive.init();
}});$(document).on("click",".returnEntitySearch",function(){var c=$(this).closest("form").serialize();var b=a._getActiveTab();a.reloadJqgrid(b,c);});$("#"+ReturnEntityBase._CONS_.APPLY_FORM_ID).find("[name=needReturn]").on("click",function(){if($(this).val()=="N"){a.returnEntityBase.hideReturnInfo();
}else{a.returnEntityBase.showReturnInfo();}});},_bindFormValidation:function(){var a={rules:{skuCount:{required:true,number:true,min:1},shipAmount:{number:true,min:0},trackingNo:{maxlength:["128"]},reasonName:{required:true,maxlength:["1024"]},returnAddr:{maxlength:["512"]},comment:{maxlength:["1024"]}},messages:{}};
FormUtils.bindFormValidation(ReturnEntityBase._CONS_.APPLY_FORM_ID,a);},_getActiveTab:function(){var b=this;var a=$(".listTabli");var c="";$.each(a,function(d,e){if($(this).hasClass("active")){c=$(this).attr("attr-type");
}});return c;},_initComfirmBtn:function(){$("#saveDiv").hide();$("#comfirmDiv").show();$("#receiveDiv").hide();$("#refundDiv").hide();$("#viewBillDiv").hide();
ButtonUtils.enableBtn("comfirm");ButtonUtils.enableBtn("comfirm_direct");ButtonUtils.enableBtn("reject");ButtonUtils.enableBtn("prevBtn");$("#commentDiv").show();
},_initReceiveBtn:function(){$("#saveDiv").hide();$("#comfirmDiv").hide();$("#receiveDiv").show();$("#refundDiv").hide();$("#viewBillDiv").hide();ButtonUtils.enableBtn("receive");
ButtonUtils.enableBtn("not_receive");ButtonUtils.enableBtn("prevBtn");$("#commentDiv").show();},_initRefundBtn:function(){$("#saveDiv").hide();$("#comfirmDiv").hide();
$("#receiveDiv").hide();$("#refundDiv").show();$("#viewBillDiv").hide();$("#refundAddForm").find("[id=pointTip]").show();ButtonUtils.enableBtn("refund");
ButtonUtils.enableBtn("prevBtn");$("#commentDiv").show();},_initEditBtn:function(){$("#saveDiv").show();$("#comfirmDiv").hide();$("#receiveDiv").hide();
$("#refundDiv").hide();$("#viewBillDiv").hide();ButtonUtils.enableBtn("save");ButtonUtils.enableBtn("prevBtn");$("#commentDiv").show();},_initDetailBtn:function(){$("#saveDiv").hide();
$("#comfirmDiv").hide();$("#receiveDiv").hide();$("#refundDiv").hide();$("#commentDiv").hide();ButtonUtils.enableBtn("prevBtn");FormUtils.disableForm(ReturnEntityBase._CONS_.APPLY_FORM_ID);
$(".selectImageBtn").hide();},initForm:function(b){var a=this;if(!b){$(".returnEntitySearch").trigger("click");a.returnEntityBase.countAllStatus();}a.returnEntityBase.isFormDataChange=a.isFormDataChange;
a.returnEntityBase.clear(b);a.isFormDataChange=false;},reloadJqgrid:function(b,c){var a=this;if("comfirm"==b){a.returnEntityComfirm.init(c);}if("receive"==b){a.returnEntityReceive.init(c);
}if("refund"==b){a.returnEntityRefund.init(c);}if("refunding"==b){a.returnEntityRefunding.init(c);}if("complete"==b){a.returnEntityComplete.init(c);}if("reject"==b){a.returnEntityReject.init(c);
}if("notReceive"==b){a.returnEntityNotReceive.init(c);}},_initTabForReceive:function(){$("#comfirmTabLi").removeClass("active");$("#comfirmTab").removeClass("active");
$("#receiveTabLi").trigger("click").addClass("active");$("#receiveTab").addClass("active");},_initInputAndOption:function(){CateUtils.getOptions({typeKey:"system",pKey:"shipCode",container:"shipCompany"});
}};