function SoItemList(){this.hadInit=false;this.isEdit=false;this.isCanEdit=true;this.otherFunc=null;this.soItemRowid=0;}SoItemList._CONS_={LIST_TYPE:"list",ONE_TYPE:"one",GRID_DIV:"#soItemGridDiv",GR_LIST_DIV:"#soItemListGridDiv",GR_lIST_ID:"#soItemListGrid",GRID:"#soItemGrid",EDIT_GRID:"#editSoItemGrid",EXCHANGE_GRID:"#exchangeSoItemGrid"};
SoItemList.prototype={init:function(b){var a=this;if(b){a.calType=b.calType;if(!a.hadInit&&b.type==SoItemList._CONS_.LIST_TYPE){a.hadInit=true;a._bindEventHander();
}if(b.type==SoItemList._CONS_.LIST_TYPE){a._initListJqgrid(b);}else{if(b.type==SoItemList._CONS_.ONE_TYPE){a._initJqgrid(b);}}}},_bindEventHander:function(){var a=this;
},_initListJqgrid:function(e){var a=this;var d=[];if(e){if(typeof e.data!=undefined&&e.data!=null&&e.data.length){d=e.data;}}var c="元";if("point"==e.soType){c="积分";
}if(d!=null&&d.length>0){for(var b=0;b<d.length;b++){d[b].countShow=d[b].count;d[b].spDiscoutShow=d[b].spDiscout;d[b].spCommentShow=d[b].spComment;d[b].totalAmount=parseFloat(d[b].salesPrice)*parseInt(d[b].count)-parseFloat(d[b].spDiscout);
}}$.jgrid.defaults.styleUI="Bootstrap";$(SoItemList._CONS_.GR_lIST_ID).jqGrid({datatype:"jsonstring",caption:"产品列表",datastr:d,autowidth:true,height:"auto",shrinkToFit:true,multiselect:false,sortable:false,rownumbers:true,colNames:["产品图片","产品ID","产品SKU ID","产品SKU编码","已退货数量","审核不通过数量","产品名称","原价("+c+")","数量","折扣("+c+")","小计("+c+")","操作"],colModel:[{name:"prodPic",sortable:false,width:120,formatter:function(f,i,j){var h="<img style='display: inline; width:35px;' ";
if(j.prodPic=="总计:"){return j.prodPic;}else{if(j.prodPic!=""&&j.prodPic!=null){h=h+" urlval='"+j.prodPic+"' ";var g={url:j.prodPic,name:"",id:""};h=h+" src='"+ImageUtils.getUrl(g)+"' ";
}else{h=h+" src='"+ctx+"/img/jt/nophoto.png' ";h=h+" urlval='' ";}}h+=" >";return h;}},{name:"prodId",sortable:false,width:100,hidedlg:true,hidden:true},{name:"skuId",sortable:false,width:120,hidedlg:true,hidden:true},{name:"skuKey",sortable:false,width:120,hidedlg:true,hidden:true},{name:"returnCount",sortable:false,width:120,hidedlg:true,hidden:true},{name:"rejectReturnCount",sortable:false,width:120,hidedlg:true,hidden:true},{name:"prodName",sortable:false,width:200},{name:"salesPrice",sortable:false,width:120,align:"right",sorttype:"float",classes:"test",formatter:"number",summaryType:"sum"},{name:"countShow",sortable:false,align:"right",classes:"test",width:120},{name:"spDiscoutShow",sortable:false,width:120,align:"right",sorttype:"float",classes:"test",formatter:"number",summaryType:"sum"},{name:"totalAmount",sortable:false,width:120,align:"right",sorttype:"float",classes:"test",formatter:"number",summaryType:"sum"},{name:"button",sortable:false,align:"center",width:100,formatter:function(f,g,i){var h="";
if(i.countShow>(i.returnCount+i.exchangeCount)){h=h+"<button  type='button'   class='btn btn-sm btn-outline btn-primary toApply'   style='margin: 0px 3px 0px 0px;'    value='"+i.id+"' >申请</button>";
}if((a.calType==SoInfo._CONS_.RETURN_TYPE&&i.returnCount+i.rejectReturnCount>0)||(a.calType==SoInfo._CONS_.EXCHANGE_TYPE&&i.exchangeCount+i.rejectExchangeCount>0)){h=h+"<button  type='button' class='btn btn-sm btn-outline btn-primary applyRecords'   style='margin: 0px 3px 0px 0px;'    value='"+i.id+"' >查看</button>";
}if(h==""){if(a.calType==SoInfo._CONS_.RETURN_TYPE){h=h+"<span class='label label-primary'>已申请换货</span>";}else{h=h+"<span class='label label-primary'>已申请退货</span>";
}}return h;}}],footerrow:true,gridComplete:function(){var f=a.footerData();if(a.otherFunc!=null){a.otherFunc(f);}var h=$(SoItemList._CONS_.GR_lIST_ID).jqGrid("getDataIDs");
for(var g=0;g<h.length;g++){if(h[g]!="total"){$(SoItemList._CONS_.GR_lIST_ID).editRow(h[g]);}}},});},reloadListJqgrid:function(f){var e={};if(params&&jQuery.type(params)=="string"){params=decodeURIComponent(params,true);
var b=params.split("&");if(b.length){for(var c=0;c<b.length;c++){var d=b[c].split("=");if(d.length==2&&d[1]){e[d[0]]=d[1];}}}}else{e=params;}var a=$(SoItemList._CONS_.GR_lIST_ID).jqGrid("getGridParam","postData");
$.extend(a,{datastr:f});$(SoItemList._CONS_.GR_lIST_ID).jqGrid("setGridParam",{search:true}).trigger("reloadGrid",[{page:1}]);},footerData:function(){var c=$(SoItemList._CONS_.GR_lIST_ID).jqGrid("getCol","totalAmount",true,"sum");
var b=$(SoItemList._CONS_.GR_lIST_ID).jqGrid("getCol","count",true,"sum");$(SoItemList._CONS_.GR_lIST_ID).jqGrid("footerData","set",{prodPic:"总计:",countShow:b,totalAmount:c});
var a=$(SoItemList._CONS_.GR_lIST_ID).jqGrid("footerData","get");return a;},_initJqgrid:function(e){var a=this;var d=[];if(e){if(typeof e.data!=undefined&&e.data!=null&&e.data.length){d=e.data;
}}var c="元";if("point"==e.soType){c="积分";}if(d!=null&&d.length>0){for(var b=0;b<d.length;b++){d[b].countShow=d[b].count;d[b].spDiscoutShow=d[b].spDiscout;
d[b].spCommentShow=d[b].spComment;d[b].totalAmount=parseFloat(d[b].salesPrice)*parseInt(d[b].count)-parseFloat(d[b].spDiscout);}}$("#soItemDiv").empty().append("<table id='soItemGrid'></table>");
$.jgrid.defaults.styleUI="Bootstrap";$(SoItemList._CONS_.GRID).jqGrid({datatype:"jsonstring",datastr:d,width:$("#soItemDiv").width(),height:"auto",shrinkToFit:true,multiselect:false,sortable:false,rownumbers:true,colNames:["产品图片","产品ID","产品SKU ID","产品SKU编码","产品名称","原价("+c+")","数量",],colModel:[{name:"prodPic",sortable:false,width:100,formatter:function(f,i,j){var h="<img style='display: inline; width:35px;' ";
if(j.prodPic=="总计:"){return j.prodPic;}else{if(j.prodPic!=""&&j.prodPic!=null){h=h+" urlval='"+j.prodPic+"' ";var g={url:j.prodPic,name:"",id:""};h=h+" src='"+ImageUtils.getUrl(g)+"' ";
}else{h=h+" src='"+ctx+"/img/jt/nophoto.png' ";h=h+" urlval='' ";}}h+=" >";return h;}},{name:"prodId",sortable:false,width:120,hidedlg:true,hidden:true},{name:"skuId",sortable:false,width:120,hidedlg:true,hidden:true},{name:"skuKey",sortable:false,width:120,hidedlg:true,hidden:true},{name:"prodName",sortable:false,width:200},{name:"salesPrice",sortable:false,width:100,align:"right",sorttype:"float",classes:"test",formatter:"number",summaryType:"sum"},{name:"countShow",sortable:false,align:"right",classes:"test",width:120}],});
},genEditSoItemGrid:function(d){var a=this;var c=[];if(d){if(typeof d.data!=undefined&&d.data!=null&&d.data.length){c=d.data;}}var b="元";if("point"==d.soType){b="积分";
}$("#editSoItemGridDiv").empty().append("<table id='editSoItemGrid'></table>");$.jgrid.defaults.styleUI="Bootstrap";$(SoItemList._CONS_.EDIT_GRID).jqGrid({datatype:"jsonstring",datastr:c,width:800,height:"auto",shrinkToFit:true,multiselect:false,sortable:false,rownumbers:true,colNames:["产品图片","产品ID","产品SKU ID","产品SKU编码","产品名称","原价("+b+")","操作"],colModel:[{name:"prodPic",sortable:false,width:120,formatter:function(e,h,i){var g="<img style='display: inline; width:35px;' ";
if(i.prodPic=="总计:"){return i.prodPic;}else{if(i.prodPic!=""&&i.prodPic!=null){g=g+" urlval='"+i.prodPic+"' ";var f={url:i.prodPic,name:"",id:""};g=g+" src='"+ImageUtils.getUrl(f)+"' ";
}else{g=g+" src='"+ctx+"/img/jt/nophoto.png' ";g=g+" urlval='' ";}}g+=" >";return g;}},{name:"prodId",sortable:false,width:120,hidedlg:true,hidden:true},{name:"skuId",sortable:false,width:120,hidedlg:true,hidden:true},{name:"skuKey",sortable:false,width:120,hidedlg:true,hidden:true},{name:"prodName",sortable:false,width:200},{name:"salesPrice",sortable:false,width:100,align:"right",sorttype:"float",classes:"test",formatter:"number",summaryType:"sum"},{name:"button",sortable:false,align:"center",width:120,formatter:function(e,f,h){var g="<button  type='button'   class='btn btn-primary changeSku'   style='margin: 0px 2px 0px 0px;'    value='"+h.id+"' >更换</button>";
return g;}}],});},addSoItem2Grid:function(b){var a=this;$(SoItemList._CONS_.EDIT_GRID).empty();$(SoItemList._CONS_.EDIT_GRID).jqGrid("addRowData","tmpSoItem",b,"last");
},genExchangeSoItemGrid:function(d){var a=this;var c=[];if(d){if(typeof d.data!=undefined&&d.data!=null&&d.data.length){c=d.data;}}var b="元";if("point"==d.soType){b="积分";
}$("#exchangeSoItemGridDiv").empty().append("<table id='exchangeSoItemGrid'></table>");$.jgrid.defaults.styleUI="Bootstrap";$(SoItemList._CONS_.EXCHANGE_GRID).jqGrid({datatype:"jsonstring",datastr:c,width:800,height:"auto",shrinkToFit:true,multiselect:false,sortable:false,rownumbers:true,colNames:["产品图片","产品ID","产品SKU ID","产品SKU编码","产品名称","原价("+b+")"],colModel:[{name:"prodPic",sortable:false,width:150,formatter:function(e,h,i){var g="<img style='display: inline; width:35px;' ";
if(i.prodPic=="总计:"){return i.prodPic;}else{if(i.prodPic!=""&&i.prodPic!=null){g=g+" urlval='"+i.prodPic+"' ";var f={url:i.prodPic,name:"",id:""};g=g+" src='"+ImageUtils.getUrl(f)+"' ";
}else{g=g+" src='"+ctx+"/img/jt/nophoto.png' ";g=g+" urlval='' ";}}g+=" >";return g;}},{name:"prodId",sortable:false,width:120,hidedlg:true,hidden:true},{name:"skuId",sortable:false,width:120,hidedlg:true,hidden:true},{name:"skuKey",sortable:false,width:120,hidedlg:true,hidden:true},{name:"prodName",sortable:false,width:200},{name:"salesPrice",sortable:false,width:150,align:"right",sorttype:"float",classes:"test",formatter:"number",summaryType:"sum"}],});
}};