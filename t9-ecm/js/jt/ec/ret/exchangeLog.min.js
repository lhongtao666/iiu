function ExchangeLog(){this.hadInit=false;this.isEdit=false;this.exchangeLogRowid=0;}ExchangeLog._CONS_={SAVE_ADD_URL:ctx+"/ec/ret/exchangeEntity/logSaveAdd.htm",DIV_ID:"#exchangeLogDiv",GRID:"#exchangeLogGrid",GRID_ID:"exchangeLogGrid",PAGER:"#exchangeLogPager",PAGER_ID:"exchangeLogPager",JSON_ID:"exchangeLogJSON",};
ExchangeLog.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();}a.loadListData(b);},loadListData:function(b){var a=this;
FormUtils.loadData(ctx+"/ec/ret/exchangeEntity/exchangeLogListData.htm?Q__S__EQ__entity_id_="+b,function(c){a._initJqgrid({data:c});});},_bindEventHander:function(){var a=this;
$(".form_wrapper").on("click",".exchangeLogDetail",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(ExchangeLog._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,"请选择要查看的记录");return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,"只能选择一条要查看的记录");return;
}}}var c=$(ExchangeLog._CONS_.GRID).jqGrid("getRowData",b);$("#exchangeLogEditForm").find("[id=nameDiv]").show();$("#exchangeLogEditForm").find("[name=name]").val(c["name"]);
$("#exchangeLogEditForm").find("[name=comment]").val(c["comment"]).attr("disabled",true);$("#logEditType").val("detail");a._openEditDialog();});$(".form_wrapper").on("click",".exchangeLogAdd",function(){$("#exchangeLogEditForm").find("[id=nameDiv]").hide();
$("#exchangeLogEditForm").find("[name=comment]").val("").attr("disabled",false);$("#logEditType").val("add");a._openEditDialog();});},_initJqgrid:function(c){var a=this;
var b=[];if(c){b=c.data;}$(ExchangeLog._CONS_.DIV_ID).empty().append("<table id='"+ExchangeLog._CONS_.GRID_ID+"'></table><div id='"+ExchangeLog._CONS_.PAGER_ID+"'></div>");
$.jgrid.defaults.styleUI="Bootstrap";$(ExchangeLog._CONS_.GRID).jqGrid({datatype:"jsonstring",datastr:b,height:350,autowidth:true,shrinkToFit:true,rowNum:10,rownumbers:true,mtype:"POST",viewrecords:true,multiselect:true,colNames:["操作者姓名","源状态","目的状态","操作时间","备注说明","备注（隐藏）"],colModel:[{name:"name",width:120},{name:"srcStatus",width:100,formatter:function(d,f,g){var e=g.srcStatus;
if(g.srcStatus=="awaiting"){e="待审核";}else{if(g.srcStatus=="reject"){e="审核不通过";}else{if(g.srcStatus=="comfirm"){e="已审核(等待退货)";}else{if(g.srcStatus=="comfirm_direct"){e="已审核(无需退货)";
}else{if(g.srcStatus=="receive"){e="已收货";}else{if(g.srcStatus=="not_receive"){e="未收到";}else{if(g.srcStatus=="exchange"){e="换货中";}else{if(g.srcStatus=="complete"){e="已完成";
}else{if(g.srcStatus=="reject"){e="审核不通过";}}}}}}}}}return e;}},{name:"destStatus",width:100,formatter:function(d,f,g){var e=g.destStatus;if(g.destStatus=="awaiting"){e="待审核";
}else{if(g.destStatus=="reject"){e="审核不通过";}else{if(g.destStatus=="comfirm"){e="已审核(等待退货)";}else{if(g.destStatus=="comfirm_direct"){e="已审核(无需退货)";}else{if(g.destStatus=="receive"){e="已收货";
}else{if(g.destStatus=="not_receive"){e="未收到";}else{if(g.destStatus=="exchange"){e="换货中";}else{if(g.destStatus=="complete"){e="已完成";}else{if(g.destStatus=="reject"){e="审核不通过";
}}}}}}}}}return e;}},{name:"createTime",width:150},{name:"commentShow",width:300,formatter:function(d,e,f){var g=new StringBuffer();g.append("<div style='width:auto;overflow:hidden; white-space:nowrap; text-overflow:ellipsis'>");
g.append(f.comment);g.append("</div>");return g.toString();}},{name:"comment",width:200,hidden:true},],pager:ExchangeLog._CONS_.PAGER,hidegrid:false});
},reloadJqgrid:function(b){var a=this;$(ExchangeLog._CONS_.GRID).jqGrid("setGridParam",{postData:"Q__S__EQ__entity_id_="+b}).trigger("reloadGrid");},_openEditDialog:function(b){var a=this;
a.layerIndex=layer.open({type:1,title:"换货日志",shadeClose:false,btn:["确定","关闭"],area:["600px","450px"],content:$("#exchangeLogPage"),scrollbar:false,success:function(c,d){},yes:function(d,c){if($("#logEditType").val()=="add"){a._save();
}layer.close(a.layerIndex);}});},_save:function(){var b=this;var a=ExchangeLog._CONS_.SAVE_ADD_URL;var c=new StringBuffer();c.append("entityId="+$("#exchangeEntityForm").find("[name=id]").val());
c.append("&comment="+$("#exchangeLogEditForm").find("[name=comment]").val());FormUtils.submit(a,c.toString(),function(d){if(d.success){if(d.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);
}else{if(d.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);}}b.reloadJqgrid($("#exchangeEntityForm").find("[name=id]").val());
}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}};