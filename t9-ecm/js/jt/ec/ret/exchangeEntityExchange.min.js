function ExchangeEntityExchange(){this.hadInit=false;this.isEdit=false;this.exchangeEntityBase=new ExchangeEntityBase();this.exchangeEntityBase.hadInit=true;
}ExchangeEntityExchange._CONS_={SAVE_ADD_URL:ctx+"/ec/ret/exchangeEntity/exchangeSaveAdd.htm",GRID:"#exchangeEntityExchangeGrid",PAGER:"#exchangeEntityExchangePager",EXCHANGE_ADD_FORM:"exchangeAddForm"};
ExchangeEntityExchange.prototype={init:function(b){var a={grid:ExchangeEntityExchange._CONS_.GRID,pager:ExchangeEntityExchange._CONS_.PAGER,gridRecordsSpan:"#exchangeEntityExchangeGrid_record",listParams:"Q__S__IN__entity.status_=comfirm_direct,receive",widthElement:".wait_submit_wrapper",onSelectRow:this.onSelectRow,type:ExchangeEntityBase._CONS_.EXCHANGE_TAB_TYPE};
if(!this.hadInit){this.hadInit=true;this.exchangeEntityBase.init(a);this._bindEventHander();}else{this.reloadJqgrid(b);}},_bindEventHander:function(){var a=this;
var b=$("#"+ExchangeEntityExchange._CONS_.EXCHANGE_ADD_FORM);$(document).on("click",".changeSku",function(){if(b.find("[id=initStoreId]").val()==""||b.find("[id=initStoreId]").val()==null){DialogUtils.error(msgCode.WARING,"请先选择仓库");
return false;}SelectProdService.selectSku({storeId:b.find("[id=initStoreId]").val(),isMultiple:1,canSale:"y",hasStock:"y",fn:function(c){for(var d=0;d<c.length;
d++){a.exchangeEntityBase.soItemList.addSoItem2Grid({prodId:c[d].prodId,prodName:c[d].prodName,prodPic:c[d].imgUrl,skuId:c[d].skuId,skuKey:c[d].skuCode,isMain:"y",maindId:"",salesPrice:c[d].price});
}}});});$(document).on("change","[name=exAmount]",function(){if($(this).val()<0){$(this).val(0);}});$(document).on("change","[name=exCount]",function(){if($(this).val()<1){$(this).val(1);
}});$(document).on("click",".addrli",function(){$(".addrli").hide();$(this).show();});$(document).on("click",".showAddrList",function(){$(".addrli").show();
});$(document).on("click",".addAddr",function(){var c=new ShopAddrOpt();c.init({csId:$("input[name=csId]").val(),callBack:function(e){$(".addrli").hide();
var d=[];d.push(e);$(".addrDiv").append(a._addAddrStrLine(a,d));$(".addrDiv li:last-child").show();if($(".addrDiv li").length>1){$(".showAddrList").show();
}else{$(".showAddrList").hide();}}});});$(document).on("click",".edit-addr",function(){var f=new ShopAddrOpt();var e=$(this).parent().parent().prev();var c=$(this).parent().parent().next();
var d=$(this).parent().parent();f.init({addrId:$(this).parent().attr("id"),csId:$("input[name=csId]").val(),callBack:function(h){$(".addrli").hide();var g=[];
g.push(h);d.remove();if(e.length>0){e.after(a._addAddrStrLine(a,g));e.next().show();}else{if(c.length>0){c.before(a._addAddrStrLine(a,g));c.prev().show();
}else{$(".addrDiv").append(a._addAddrStrLine(a,g));$(".addrDiv li:last-child").show();}}}});});$(document).on("change","[name=financeType]",function(){var c=$(this).val();
if("noChange"==c){b.find("[name=exAmount]").val(0).attr("readonly",true);}else{if("pay"==c){b.find("[name=exAmount]").attr("readonly",false);b.find("[id=companyAccountDiv]").show();
b.find("[id=receiptAccountDiv]").hide();}else{if("refund"==c){b.find("[name=exAmount]").attr("readonly",false);b.find("[id=companyAccountDiv]").hide();
b.find("[id=receiptAccountDiv]").show();}}}});},reloadJqgrid:function(b){var a={grid:ExchangeEntityExchange._CONS_.GRID,pager:ExchangeEntityExchange._CONS_.PAGER,searchParam:b};
this.exchangeEntityBase.reloadJqgrid(a);},onSelectRow:function(b,a){selectedId=$(ExchangeEntityExchange._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(selectedId.length==1){if(ResUtils.canShow("exchangeEntity.button.exchange")){ButtonUtils.enableBtn("exchangeEntityExchange");}if(ResUtils.canShow("exchangeEntity.button.exchangeEdit")){ButtonUtils.enableBtn("exchangeEdit");
}if(ResUtils.canShow("exchangeEntity.button.exchangeDetail")){ButtonUtils.enableBtn("exchangeDetail");}}else{ButtonUtils.disableBtn("exchangeEdit");ButtonUtils.disableBtn("exchangeEntityExchange");
ButtonUtils.disableBtn("exchangeDetail");}},openEditDialog:function(b){var a=this;a.layerIndex=layer.open({type:1,title:"生成换货单",maxmin:true,shadeClose:false,btn:["确定","关闭"],area:["980px","580px"],content:$("#exchangePage"),success:function(c,d){},yes:function(d,c){if($("#"+ExchangeEntityExchange._CONS_.EXCHANGE_ADD_FORM).valid()){b();
layer.close(a.layerIndex);}}});},genAddrContainer:function(c,a){if(c&&c.length>0){var d=new StringBuffer();for(var b=0;b<c.length;b++){if(b==0){d.append("<li class='addrli col-sm-9' attr-id='").append(c[b].id).append("' style='list-style-type:none;position:relative;'>");
}else{d.append("<li class='addrli col-sm-9' attr-id='").append(c[b].id).append("' style='list-style-type:none; display:none;'>");}d.append("<div class='contact-box-line' id='").append(c[b].id).append("'>");
if(c[b].isSnapshot=="n"){d.append("<button type='button' class='glyphicon glyphicon-edit edit-addr' title='编辑地址' style='margin-right:38px;color:#18a689;'></button>");
}d.append(" <h3 style='margin-bottom:5px;'><strong>").append(c[b].name).append("</strong><span  style='font-size: 13px;'>&nbsp;").append("</span></h3>").append("<p  style='margin-bottom:5px;'><i class='fa fa-map-marker'></i>").append(c[b].prName).append(c[b].ciName).append(c[b].arName).append(ResUtils.canShow("soEntity.button.viewAddrBtn")?c[b].addr:MaskPhoneNum.maskAddr(c[b].addr)).append("&nbsp;&nbsp;").append(c[b].zipcode).append("</p>").append("<address style='margin-bottom:5px;'><strong><abbr title='Phone'>手机号码:</abbr> (+86)").append(MaskPhoneNum.getMaskPhoneNum(c[b].mobile)).append("</strong></address>").append(" <b style='background: transparent url(\"").append(ctx).append("/img/jt/selected-icon.png\") no-repeat scroll 0% 0%;'></b><div class='clearfix'></div></div></li>");
}$("#exchangeAddForm").find("[id=addrContainer]").append(d.toString());}},reInitAddForm:function(){var d=this;$("#exchangeAddForm").find("[name=exCount]").val(1);
$("#exchangeAddForm").find("[name=financeType]").val("pay");$("#exchangeAddForm").find("[name=exAmount]").val(0);$("#exchangeAddForm").find("[name=payType]").val("alipay");
$("#exchangeAddForm").find("[name=receiptAccount]").val("");var c=$("#exchangeAddForm").find("[id=initStoreId]").val();var e=JSON.parse($("#exchangeAddForm").find("[id=initSoItemJson]").val());
var b=$("#exchangeAddForm").find("[id=initAddrId]").val();var a=$("#exchangeAddForm .addrDetailLi");$.each(a,function(g,f){$(this).removeClass("contact-box-selected");
if($(this).attr("attr-id")==b){$(this).addClass("contact-box-selected");}});$("#exchangeAddForm").find("[id=storeIdContainer]").val(c);d.exchangeEntityBase.soItemList.addSoItem2Grid(e);
},fillInitData:function(a){$("#exchangeAddForm").find("[id=initSoItemJson]").val(JSON.stringify(a.soItemVos[0]));$("#exchangeAddForm").find("[id=initStoreId]").val(a.storeId);
$("#exchangeAddForm").find("[id=initAddrId]").val(a.soShipPos[0].addrId);},_addAddrStrLine:function(a,c){var d=new StringBuffer();for(var b=0;b<c.length;
b++){if(c[b].isSnapshot=="n"){d.append("<li class='addrli col-sm-9' attr-id='").append(c[b].id).append("' style='list-style-type:none;position:relative; ");
if((c[b].isDefault=="y"||c.length==1&&c[b].isDefault=="n")){$("input[name=addrId]").val(c[b].id);d.append("'>");}else{d.append("display:none;' idval=''>");
}d.append("<div class='contact-box-line");d.append("' id='").append(c[b].id).append("'>");d.append("<button type='button' class='glyphicon glyphicon-edit edit-addr' title='编辑地址' style='margin-right:38px;color:#18a689;'></button>");
d.append(" <h3 style='margin-bottom:5px;'><strong>").append(c[b].name).append("</strong><span  style='font-size: 13px;'>&nbsp;").append(c.title).append("</span></h3>").append("<p  style='margin-bottom:5px;'><i class='fa fa-map-marker'></i>").append(c[b].prName).append(c[b].ciName).append(c[b].arName).append(c[b].toName).append(ResUtils.canShow("soEntity.button.viewAddrBtn")?c[b].addr:MaskPhoneNum.maskAddr(c[b].addr)).append("<br/>").append(c[b].zipcode).append("</p>").append("<address style='margin-bottom:5px;'><strong><abbr title='Phone'>手机号码:</abbr> (+86)").append(c[b].mobile).append("</strong></address>").append(" <b style='background: transparent url(\"").append(ctx).append("/img/jt/selected-icon.png\") no-repeat scroll 0% 0%;'></b><div class='clearfix'></div></div></li>");
}}return d.toString();},};