function ReturnLog(){this.hadInit=false;this.isEdit=false;this.returnLogRowid=0;}ReturnLog._CONS_={SAVE_ADD_URL:ctx+"/ec/ret/returnEntity/logSaveAdd.htm",DIV_ID:"#returnLogDiv",GRID:"#returnLogGrid",GRID_ID:"returnLogGrid",PAGER:"#returnLogPager",PAGER_ID:"returnLogPager",JSON_ID:"returnLogJSON",};
ReturnLog.prototype={init:function(b){var a=this;if(!a.hadInit){a.hadInit=true;a._bindEventHander();}a.loadListData(b);},loadListData:function(b){var a=this;
FormUtils.loadData(ctx+"/ec/ret/returnEntity/returnLogListData.htm?Q__S__EQ__entity_id_="+b,function(c){a._initJqgrid({data:c});});},_bindEventHander:function(){var a=this;
$(".form_wrapper").on("click",".returnLogDetail",function(){a.isEdit=true;var b=$(this).attr("idVal");if(!b){b=$(ReturnLog._CONS_.GRID).jqGrid("getGridParam","selarrrow");
if(b==null||b.length==0){DialogUtils.error(msgCode.error,"请选择要查看的记录");return;}else{if(b&&b.length>1){DialogUtils.error(msgCode.ERROR,"只能查看一条记录");return;
}}}var c=$(ReturnLog._CONS_.GRID).jqGrid("getRowData",b);$("#returnLogEditForm").find("[id=nameDiv]").show();$("#returnLogEditForm").find("[name=name]").val(c["name"]);
$("#returnLogEditForm").find("[name=comment]").val(c["comment"]).attr("disabled",true);$("#logEditType").val("detail");a._openEditDialog();});$(".form_wrapper").on("click",".returnLogAdd",function(){$("#returnLogEditForm").find("[id=nameDiv]").hide();
$("#returnLogEditForm").find("[name=comment]").val("").attr("disabled",false);$("#logEditType").val("add");a._openEditDialog();});},_loadData:function(b){var a=this;
FormUtils.loadData(ReturnEntityBase._CONS_.EDIT_URL+"?id="+b,function(c){$("#id").val(c.id);$("#skuCount").val(c.skuCount);$("#needReturn").val(c.needReturn);
$("#returnAddr").val(c.returnAddr);$("#trackingNo").val(c.trackingNo);$("#shipAmount").val(c.shipAmount);$("#reasonName").val(c.reasonName);$("."+c.status).show();
a._showImages(c.returnImgPos);a.soItemList.init({data:c.soItemVos,type:SoItemList._CONS_.ONE_TYPE});});},_initJqgrid:function(c){var a=this;var b=[];if(c){b=c.data;
}$(ReturnLog._CONS_.DIV_ID).empty().append("<table id='"+ReturnLog._CONS_.GRID_ID+"'></table><div id='"+ReturnLog._CONS_.PAGER_ID+"''></div>");$.jgrid.defaults.styleUI="Bootstrap";
$(ReturnLog._CONS_.GRID).jqGrid({datatype:"jsonstring",datastr:b,height:350,autowidth:true,shrinkToFit:true,rowNum:10,mtype:"POST",viewrecords:true,multiselect:true,rownumbers:true,colNames:["操作者姓名","源状态","目的状态","操作时间","备注说明","备注（隐藏）"],colModel:[{name:"name",width:170},{name:"srcStatus",width:170,formatter:function(d,f,g){var e=g.srcStatus;
if(g.srcStatus=="awaiting"){e="待审核";}else{if(g.srcStatus=="reject"){e="审核不通过";}else{if(g.srcStatus=="comfirm"){e="已审核(等待退货)";}else{if(g.srcStatus=="comfirm_direct"){e="已审核(无需退货)";
}else{if(g.srcStatus=="receive"){e="已收货";}else{if(g.srcStatus=="not_receive"){e="未收到";}else{if(g.srcStatus=="refund"){e="退款中";}else{if(g.srcStatus=="complete"){e="已完成";
}else{if(g.srcStatus=="reject"){e="审核不通过";}}}}}}}}}return e;}},{name:"destStatus",width:170,formatter:function(d,f,g){var e=g.destStatus;if(g.destStatus=="awaiting"){e="待审核";
}else{if(g.destStatus=="reject"){e="审核不通过";}else{if(g.destStatus=="comfirm"){e="已审核(等待退货)";}else{if(g.destStatus=="comfirm_direct"){e="已审核(无需退货)";}else{if(g.destStatus=="receive"){e="已收货";
}else{if(g.destStatus=="not_receive"){e="未收到";}else{if(g.destStatus=="refund"){e="退款中";}else{if(g.destStatus=="complete"){e="已完成";}else{if(g.destStatus=="reject"){e="审核不通过";
}}}}}}}}}return e;}},{name:"createTime",width:200,formatter:function(d){return DateUtils.miniTime(d);}},{name:"commentShow",width:300,formatter:function(d,e,f){var g=new StringBuffer();
g.append("<div style='width:auto;overflow:hidden; white-space:nowrap; text-overflow:ellipsis'>");g.append(f.comment);g.append("</div>");return g.toString();
}},{name:"comment",width:200,hidden:true}],pager:ReturnLog._CONS_.PAGER,hidegrid:false});},reloadJqgrid:function(c){var b=this;var a=$(ReturnLog._CONS_.GRID).jqGrid("getGridParam","postData");
$.extend(a,{Q__S__EQ__entity_id_:c});$(ReturnLog._CONS_.GRID).jqGrid("setGridParam",{search:true}).trigger("reloadGrid",[{page:1}]);},_openEditDialog:function(b){var a=this;
a.layerIndex=layer.open({type:1,title:"退货备注日志",maxmin:false,shadeClose:false,btn:["确定","关闭"],area:["780px","480px"],content:$("#returnLogPage"),success:function(c,d){},yes:function(d,c){if($("#logEditType").val()=="add"){a._save();
}layer.close(a.layerIndex);}});},_save:function(){var b=this;var a=ReturnLog._CONS_.SAVE_ADD_URL;var c=new StringBuffer();c.append("entityId="+$("#returnApplyForm").find("[name=id]").val());
c.append("&comment="+$("#returnLogEditForm").find("[name=comment]").val());FormUtils.submit(a,c.toString(),function(d){if(d.success){if(d.msgCode==actionCode.CREATE){DialogUtils.success(msgCode.INFO,msgCode.CREATE_MSG);
}else{if(d.msgCode==actionCode.UPDATE){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);}}b.reloadJqgrid($("#returnApplyForm").find("[name=id]").val());
}else{DialogUtils.error(msgCode.FAIL_MSG,d.msg);}},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);});}};