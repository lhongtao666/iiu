$(function(){var a=new ProdStoreList();a.init();});function ProdStoreList(){this.hadInit=false;this.isEdit=false;this.isFormDataChange=false;}ProdStoreList._CONS_={LIST_DATA_URL:ctx+"/ec/stock/stStock/listProdStore.htm",GRID:"#prodStoreGrid",PAGER:"#prodStorePager"};
ProdStoreList.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._initJqgrid(a);}},loadData:function(a,b,c){$("#prodForm input[name=prodName]").val(a);
$("#prodForm input[name=skuCode]").val(b);$("#prodForm input[name=countStore]").val(c);},_initJqgrid:function(b){var a=this;if(b==null||typeof b==undefined){if(a.getQueryVariable("Q__S__EQ__prod_id_")){b="Q__S__EQ__prod_id_="+a.getQueryVariable("Q__S__EQ__prod_id_");
}}$(ProdStoreList._CONS_.GRID).JTJqgrid({url:ProdStoreList._CONS_.LIST_DATA_URL,pager:ProdStoreList._CONS_.PAGER,postData:b,footerrow:true,rownumbers:true,multiselect:false,autowidth:true,height:"100%",shrinkToFit:true,colNames:["仓库名","总数","锁定","预留","次品","库存预警","上次盘点时间","名称","sku编码"],colModel:[{name:"storeName",index:"prod.name_",sortable:false,formatter:function(c,d,e){if(e.storeName=="合计"){return"<span style='color:red;'>"+e.storeName+"</span>";
}return e.storeName;}},{name:"total",index:"stock.total_",sortable:false},{name:"lockQty",index:"stock.lock_qty_",sortable:false,},{name:"savedQty",index:"stock.saved_qty_",sortable:false,},{name:"badQty",index:"stock.bad_qty_",sortable:false,},{name:"alert",sortable:false,formatter:function(c,d,i){var h=i.total;
var f=i.badQty;var j=parseInt(i.alertMin);var g=parseInt(i.alertMax);var e=parseInt(h)-parseInt(f);if(e==0){return"<span style='font-weight: bold;color: #ED1C24;'>无货</span>";
}else{if(e<j){return"<span style='font-weight: bold;color: #FF7F27;'>缺货</span>";}else{if(e>g&&g!=0){return"<span style='font-weight: bold;color: #00B0F0;'>积压</span>";
}else{return"<span style='font-weight: bold;color: green;'>有货</span>";}}}}},{name:"lastQualityTime",sortable:false,index:"stock.last_quailty_time_",formatter:function(c){return DateUtils.miniTime(c);
}},{name:"prodName",index:"prodName",hidden:true},{name:"skuCode",index:"skuCode",hidden:true}],gridComplete:function(){var f=$(ProdStoreList._CONS_.GRID).jqGrid("getCol","total",true,"sum");
var e=$(ProdStoreList._CONS_.GRID).jqGrid("getCol","lockQty",true,"sum");var c=$(ProdStoreList._CONS_.GRID).jqGrid("getCol","savedQty",true,"sum");var d=$(ProdStoreList._CONS_.GRID).jqGrid("getCol","badQty",true,"sum");
$(ProdStoreList._CONS_.GRID).jqGrid("footerData","set",{storeName:"合计",total:f,lockQty:e,savedQty:c,badQty:d});},loadComplete:function(){var c="";var d="";
var g=$(ProdStoreList._CONS_.GRID).jqGrid("getRowData");var e=$(ProdStoreList._CONS_.GRID).jqGrid("getCol","total",true,"sum");var f=g[0];jQuery(f).each(function(){c=f.prodName;
d=f.skuCode;});$(ProdStoreList._CONS_.GRID).jqGrid("setLabel","rn","序号",{"text-align":"center","vertical-align":"middle","background-color":"#f5f5f5 !important"});
a.loadData(c,d,e);}});},getQueryVariable:function(a){var c=window.location.search.substring(1);var d=c.split("&");for(var b=0;b<d.length;b++){var e=d[b].split("=");
if(e[0]==a){return e[1];}}return"";}};