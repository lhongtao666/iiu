function ProdEntitySeries(a){this.container=a;}ProdEntitySeries._CONS_={LIST_PROD_ENTITY_SERIES_DATA:ctx+"/gl/prod/prodItem/findByProdId.htm",NORMAL_PROD_ENTITY_SERIES_FORM:"#normalProdEntitySeriesForm",SERIES_TPL:"#prodEntitySeriesTpl",};
ProdEntitySeries.prototype={init:function(a){if(!this.hadInit){this.hadInit=true;this._initHtml(this.container);this._bindFormValidation();this._bindEventHandler();
}$("[name=isSeries]").trigger("change");if(a){this.prodId=a.prodId;this.skuId=a.skuId;this.isSeries=a.isSeries;$("[name=isSeries]").attr("readonly",false).find("option").hide();
$("[name=isSeries]").attr("readonly",true).find("option[value='"+a.isSeries+"']").show();$("body").find(".addSeriesRow").hide();$("body").find(".plusBtn").hide();
$("body").find(".minusBtn").hide();$("body").find(".removeItemTr").hide();$("body").find(".thOprateBtn").hide();$("body").find(".inputItemCount").attr("readonly",true);
}else{$("[name=isSeries]").attr("readonly",false).find("option").show();$("body").find(".addSeriesRow").show();$("body").find(".plusBtn").show();$("body").find(".minusBtn").show();
$("body").find(".removeItemTr").show();$("body").find(".thOprateBtn").show();$("body").find(".inputItemCount").attr("readonly",false);}if(a&&a.prodId){this._loadData(this.prodId,this.isSeries);
$("[name=isSeries]").attr("readonly",false).find("option").hide();$("[name=isSeries]").attr("readonly",true).find("option[value='"+a.isSeries+"']").show();
$("body").find(".addSeriesRow").hide();$("body").find(".plusBtn").hide();$("body").find(".minusBtn").hide();$("body").find(".removeItemTr").hide();$("body").find(".thOprateBtn").hide();
$("body").find(".inputItemCount").attr("readonly",true);}else{$("[name=isSeries]").attr("readonly",false).find("option").show();$("body").find(".addSeriesRow").show();
$("body").find(".plusBtn").show();$("body").find(".minusBtn").show();$("body").find(".removeItemTr").show();$("body").find(".thOprateBtn").show();$("body").find(".inputItemCount").attr("readonly",false);
}},clear:function(){$(ProdEntitySeries._CONS_.NORMAL_PROD_ENTITY_SERIES_FORM).find("tbody").empty();$("[name=isSeries]").val(["n"]);$("[name=isSeries]").trigger("change");
},_loadData:function(c,b){var a=$(ProdEntitySeries._CONS_.NORMAL_PROD_ENTITY_SERIES_FORM).find("tbody").empty();if(c&&"y"==b){FormUtils.loadData(ProdEntitySeries._CONS_.LIST_PROD_ENTITY_SERIES_DATA+"?prodId="+c,function(d){if(d&&d.length){var f=d;
var e=$.templates(ProdEntitySeries._CONS_.SERIES_TPL).render(f);a.append(e);}},null,true);}},_initHtml:function(a){var b=$.templates("#prodEntitySeriesContainer").render();
$(a).append(b);},_bindFormValidation:function(){var a={rules:{},messages:{}};FormUtils.bindFormValidation("normalProdEntitySeriesForm",a);},isValid:function(){return true;
},getForm:function(){var b=[];$(ProdEntitySeries._CONS_.NORMAL_PROD_ENTITY_SERIES_FORM).find("tbody tr").each(function(){var g=$(this);var f=g.attr("prodId");
var c=g.attr("skuId");var i=g.attr("itemId");var e=g.attr("itemSku");var h=g.find(".itemCount").val();var d={prodId:f,skuId:c,itemId:i,itemSku:e,itemCount:h,};
b.push(d);});var a=JSON.stringify(b);return"prodItemPoJson="+a;},_bindEventHandler:function(){var a=this;$("body").on("click",".plusBtn",function(){var c=$(this).parents("tr").find(".itemCount");
var b=c.val()?parseInt(c.val()):0;c.val(b+1);});$("body").on("click",".minusBtn",function(){var c=$(this).parents("tr").find(".itemCount");var b=c.val()?parseInt(c.val()):0;
c.val(b-1);});$("body").on("click",".removeItemTr",function(){$(this).parents("tr").remove();});$("body").on("change","[name=isSeries]",function(){var b=$(this).val();
if("y"==b){$(ProdEntitySeries._CONS_.NORMAL_PROD_ENTITY_SERIES_FORM).show();}else{$(ProdEntitySeries._CONS_.NORMAL_PROD_ENTITY_SERIES_FORM).hide();}});
$("body").on("click",".addSeriesRow",function(){SelectProdService.selectSku({isMultiple:1,filterSeries:"y",fn:function(e){var d=[];var g=new Date().getTime();
for(var c=0;c<e.length;c++){var h=e[c];var b={id:g+10,prodId:a.prodId,skuId:a.skuId,itemId:h.prodId,itemSku:h.skuId,itemName:h.prodName,itemSkuCode:h.code,};
d.push(b);}var f=$.templates(ProdEntitySeries._CONS_.SERIES_TPL).render(d);$(ProdEntitySeries._CONS_.NORMAL_PROD_ENTITY_SERIES_FORM).find("tbody").append(f);
}});return false;});},};