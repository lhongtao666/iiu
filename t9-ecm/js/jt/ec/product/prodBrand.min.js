$(function(){var a=new ProdBrand();a.init();});function ProdBrand(){}ProdBrand._CONS_={GET_PROD_BRAND_DATA_URL:ctx+"/gl/cate/cate/getCateOptions.htm?typeKey=system&pKey=product_brand",DELETE_PROD_BRAND_URL:ctx+"/ec/product/prodBrand/delete.htm",SAVE_PROD_BRAND_URL:ctx+"/ec/product/prodBrand/saveEdit.htm",SAVE_ADD_PROD_BRAND_URL:ctx+"/ec/product/prodBrand/saveAdd.htm",LOAD_PROD_BRAND_BY_ID_URL:ctx+"/ec/product/prodBrand/edit.htm",};
ProdBrand.prototype={init:function(b){var a=this;if(!this.hadInit){this.hadInit=true;this._bindEventHander();this._hideNotGrantBtn();this._loadData();this._locateToGlHelp();
}},_locateToGlHelp:function(){var a="glHelp.prodEntity.prodEavAttr.brand";glHelpUtil.init(a);},_clearSessionStorage:function(){window.sessionStorage.removeItem("system-product_brand");
},_hideNotGrantBtn:function(){if(!ResUtils.canShow("prodBrand.button.addBrand")){$(".add-config").remove();}if(!ResUtils.canShow("prodBrand.button.deleteBrand")){$(".deleteConfigBtn ").remove();
}if(!ResUtils.canShow("prodBrand.button.editBrand")){$(".editConfigBtn").remove();}},_loadData:function(){var a=this;FormUtils.loadData(ProdBrand._CONS_.GET_PROD_BRAND_DATA_URL,function(b){a.cateId=b.cateId;
a._buildTbody(b.options);});},_buildTbody:function(e){var a=this;if(e&&e.length){var f=new StringBuffer();for(var b=0;b<e.length;b++){var c=e[b];var d=a._buildTr(c,(b+1));
f.append(d);}$("#tbody").empty().append(f.toString());$(".before-edit").show();$(".after-edit").hide();}},_buildTr:function(f,e,b){var a=this;var g=new StringBuffer();
g.append("<tr  cateId='"+a.cateId+"'>");g.append("<td>");g.append(parseInt(e));g.append("</td>");g.append("<td class='name'>");var d=f.name||"";g.append(d);
g.append("</td>");g.append("<td class='sort'>");var c=f.sort||0;g.append(c);g.append("</td>");g.append("<td>");if(b){g.append(a._getRadioBtn(f.status));
}else{g.append("<div class='before-edit'>"+(f.status=="actived"?"显示":"隐藏")+"</div><div class='after-edit'>"+a._getRadioBtn(f.status)+"</div>");}g.append("</td>");
g.append("<td>");g.append(a._createButton(f));g.append("</td>");g.append("</tr>");return g.toString();},_generateCode:function(){var a=function(){return(((1+Math.random())*65536)|0).toString(16).substring(1);
};return(a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a());},_getRadioBtn:function(a){var b=this;var d=new StringBuffer();var c="status"+b._generateCode();
if(a==="actived"){d.append('显示<input type="radio" name="'+c+'" checked="checked" value="actived">');d.append('&nbsp;&nbsp;隐藏<input type="radio" name="'+c+'" value="inactive">');
}else{d.append('显示<input type="radio" name="'+c+'" value="actived">');d.append('&nbsp;&nbsp;隐藏<input type="radio" name="'+c+'" checked="checked" value="inactive">');
}return d.toString();},_showNormalBtn:function(a){a.find(".editBtn").hide();a.find(".normalBtn").show();a.find(".before-edit").show();$(".after-edit").hide();
},_showEditBtn:function(a){a.find(".editBtn").show();a.find(".normalBtn").hide();},_bindEventHander:function(){var a=this;$("body").on("click",".deleteConfigBtn",function(b){var c=$(this).attr("idVal");
a._delete(c,$(this).parent().parent());b.stopPropagation();});$("body").on("keyup","[name=sort]",function(){var b=$(this).val().replace(/\D/g,"");$(this).val(b);
});$("body").on("afterpaste","[name=sort]",function(){var b=$(this).val().replace(/\D/g,"");$(this).val(b);});$("body").on("click",".add-config",function(){var b=$("body").find("tr:last").find("td").first().text()||0;
b=parseInt(b)+1;var g=a._buildTr({status:"actived"},b,true);var e=$(g);$("#tbody").append(e);var c=e.find(".name");var h=c.text();c.empty().append('<input name="name" class="form-control" placeholder="请输入品牌名称" validatetype="default" value="'+h+'">');
var d=e.find(".sort");var f=d.text();d.empty().append('<input name="sort" class="form-control" placeholder="请输入排序值" validatetype="default" value="'+f+'">');
e.find(".normalBtn").hide();e.find(".editBtn").show();});$("body").on("click",".prevConfigBtn",function(){var c=$(this).attr("idVal");if(c){var b=$(this).parents("tr");
FormUtils.loadData(ProdBrand._CONS_.LOAD_PROD_BRAND_BY_ID_URL+"?id="+c,function(d){b.find(".name").empty().append(d.name);b.find(":radio").val([d.status]);
b.find(".sort").empty().append(d.sort);a._showNormalBtn(b);});}else{$(this).parents("tr").remove();}});$("body").on("click",".saveConfigBtn",function(){var c=$(this).parents("tr");
var d={};var e=$(this).attr("idVal");var b=null;if(e){b=ProdBrand._CONS_.SAVE_PROD_BRAND_URL;d.id=e;}else{b=ProdBrand._CONS_.SAVE_ADD_PROD_BRAND_URL;}d.status=c.find(":radio:checked").val();
d.cateId=c.attr("cateId");d.name=c.find("[name=name]").val();d.sort=c.find("[name=sort]").val()||"0";d.createTime=c.attr("createTime");FormUtils.submit(b,d,function(f){if(f.success){var g=$.parseJSON(f.msg);
var h=a._buildTr(g,c.find("td:first").text());c.replaceWith(h);DialogUtils.success(msgCode.SUCCESS,"保存成功");a._clearSessionStorage();a._showNormalBtn(c);
}else{DialogUtils.error(msgCode.ERROR,"保存失败");return;}},null,false);});$("body").on("click",".editConfigBtn",function(){var d=$(this).parents("tr");var b=d.find(".name");
var f=b.text();b.empty().append('<input name="name" class="form-control" placeholder="请输入品牌名称" validatetype="default" value="'+f+'">');var c=d.find(".sort");
var e=c.text();c.empty().append('<input name="sort" class="form-control" placeholder="请输入排序值" validatetype="default" value="'+e+'">');d.find(".normalBtn").hide();
d.find(".editBtn").show();d.find(".before-edit").hide();d.find(".after-edit").show();});},_delete:function(c,b){var a=this;DialogUtils.confirm(function(){FormUtils.del(ProdBrand._CONS_.DELETE_PROD_BRAND_URL,c,function(d){if(d.success){if(d.msgCode==actionCode.DELETE){b.remove();
DialogUtils.success(actionCode.INFO,msgCode.DELETE_MSG);}}else{DialogUtils.error(actionCode.FAIL,msgCode.FAIL_MSG);}a._clearSessionStorage();a._loadData();
});});},_createButton:function(a){var c=new StringBuffer();var b=a.id||"";if(ResUtils.canShow("prodBrand.button.editBrand")){c.append("<button class='btn btn-sm btn-outline btn-primary editConfigBtn normalBtn' type='button' idVal='"+b+"' style>编辑</button>");
}c.append("<button class='btn btn-sm btn-outline btn-primary saveConfigBtn editBtn' type='button' idVal='"+b+"' style='display:none;'>保存</button>");c.append("&nbsp;&nbsp;<button class='btn btn-sm btn-outline btn-danger prevConfigBtn editBtn' type='button' idVal='"+b+"' style='display:none;'>取消</button>");
if(ResUtils.canShow("prodBrand.button.deleteBrand")){c.append("&nbsp;&nbsp;<button class='btn btn-sm btn-outline btn-danger deleteConfigBtn normalBtn' type='button' idVal='"+b+"' style>删除</button>");
}return c.toString();},};