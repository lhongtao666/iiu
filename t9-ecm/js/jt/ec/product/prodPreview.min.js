$(function(){var a=ProdPreview();a.init();});function ProdPreview(){if(this instanceof ProdPreview){this.prodEntityId=prodEntityId;this.commonEav=null;
this.album=null;}else{return new ProdPreview();}}ProdPreview._CONS_={LOAD_DATA_URL:ctx+"/ec/product/prodEntity/detailPreview.htm",LOAD_SALE_DATA_URL:ctx+"/ec/product/prodEntity/loadSkuSale.htm",LOAD_PROD_ENTITY_IMAGE_PRICE_URL:ctx+"/ec/product/prodEntity/switchSku.htm",COMMON_EAV_PARAM:{bizType:"common",entityType:"jt_prod_entity",entityTypeSelectId:"entityTypeSelect",containerId:"eavCommonContainer"},TAG_EAV_PARAM:{bizType:"tag",entityType:"cs",eavSetKey:"cs_tag",containerId:"tagContainer"},};
ProdPreview.prototype={init:function(){this._loadData();this.commonEav=new Eav(ProdPreview._CONS_.COMMON_EAV_PARAM);this.tagEav=new Eav(ProdPreview._CONS_.TAG_EAV_PARAM);
this._bindEventHanlder();new ConnectedCarousels().init();this._loadProdSkuSale();},_bindEventHanlder:function(){var a=this;$(".productSku").on("click",".skuBtn",function(){if($(this).hasClass("btn-default")){$(this).siblings("button").removeClass("btn-primary").addClass("btn-default");
$(this).removeClass("btn-default").addClass("btn-primary");var b="";$(".productSku").find(".chooseSku").each(function(){$(this).find(".skuBtn").each(function(){if($(this).hasClass("btn-primary")){b+=$(this).attr("valValue")+",";
return false;}});});$("input[name='selectedSkuId']").val($(this).attr("data-id"));b=b.substring(0,b.length-1);a._loadProdEntityBySku(b);a._loadProdSkuSale();
}});$(".refresh-stock-qty").on("click",function(){a._loadProdSkuSale();});},_loadProdEntityBySku:function(a){var b=this;FormUtils.loadData(ProdPreview._CONS_.LOAD_PROD_ENTITY_IMAGE_PRICE_URL+"?prodEntityId="+this.prodEntityId+"&skuJson="+a,function(d){var f=new StringBuffer();
var e=new StringBuffer();if(d.prodImgPoList&&d.prodImgPoList.length>0){for(var c=0;c<d.prodImgPoList.length;c++){e.append("<li><img src='"+ctx+d.prodImgPoList[c].path+"' alt='"+d.prodImgPoList[c].name+"' style='width: 100%'></li>");
f.append("<li><img src='"+ctx+d.prodImgPoList[c].path+"' width='50' height='50' alt='"+d.prodImgPoList[c].name+"'></li>");}}$("#prodImgContainer").empty().append(e.toString());
$("#prodNarrowImgContainer").empty().append(f.toString());$("#productPrice").empty().append("ï¿¥"+d.price);$("#skuSpec").empty().append(d.spec);new ConnectedCarousels().init();
$("#skuCodeContainer").text(d.skuCode);});},_loadData:function(){var a=this;FormUtils.loadData(ProdPreview._CONS_.LOAD_DATA_URL+"?id="+this.prodEntityId,function(c){a.commonEav.setEntityId(c.id);
a.commonEav.setEavSetKey(c.eavKeyMap.common);a.commonEav.renderEavTable("commonEavContainer");a.tagEav.setEntityId(c.id);a.tagEav.renderEavForm(function(){var d=$("#"+ProdPreview._CONS_.TAG_EAV_PARAM.containerId);
d.find("legend").remove();d.find("input").attr("disabled","disabled");});var b=c.prodFilePoList;if(b&&b.length){$("#fileContainer").empty().append(FileUtils.createFileDivStr(b,true));
}});},_loadProdSkuSale:function(){var a=$("input[name='selectedSkuId']").val();FormUtils.loadData(ProdPreview._CONS_.LOAD_SALE_DATA_URL+"?skuId="+a,function(b){$(".weekSale").empty().append(b.weekSale);
$(".totalSale").empty().append(b.totalSale);$(".monthSale").empty().append(b.monthSale);});}};