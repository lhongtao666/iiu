$(function(){var a=new SelectProd();a.initWrapper();});function SelectProd(){this.initJqgrid=false;}SelectProd._CONS_={LIST_DATA_URL:ctx+"/ec/product/prodEntity/listProdData.htm",GRID:"#prodEntityGrid",PAGER:"#prodEntityPager"};
SelectProd.prototype={initWrapper:function(){this._initProdCateTree();this._bindEventHandler();},_bindEventHandler:function(){var a=this;$("#prodEntitySearchContainer").on("keypress","form",function(b){if(b.keyCode=="13"){$(".prodEntitySearch").trigger("click");
}});$("#prodEntitySearchContainer").on("click",".prodEntitySearch",function(){var b={"Q__S__EQ__prod.cate_id_":a.cateId,storeId:storeId,"Q__S__LK__prod.name_":$("[name='Q__S__LK__prod.name_']").val(),"Q__S__LK__sku.code_":$("[name='Q__S__LK__sku.code_']").val(),};
a._reloadJqgrid(b);});},_initProdCateTree:function(){var a=this;var b={treeId:"prodEntityCateTree",cateTypeKey:"product_catalog",rootKey:"category",userId:"",contextMenu:{},saveFn:function(c){},onClick:function(c){a.cateId=c.id;
var e=c.id;if(!a.initJqgrid){a._initJqgrid(e);}else{var d={"Q__S__EQ__prod.cate_id_":e,storeId:storeId,};a._reloadJqgrid(d);}}};ZtreeUtils.init(b);},_reloadJqgrid:function(a){JTJqgridUtils.reloadJqgrid(SelectProd._CONS_.GRID,a);
},_initJqgrid:function(c){var b=this;this.initJqgrid=true;$.jgrid.defaults.styleUI="Bootstrap";var a=$(document).height()-$(".layui-layer-title").height()-$(".layui-layer-btn").height()-$("#prodEntitySearchContainer").height()-95;
$(SelectProd._CONS_.GRID).jqGrid({url:SelectProd._CONS_.LIST_DATA_URL,pager:SelectProd._CONS_.PAGER,datatype:"json",mtype:"post",autowidth:true,postData:{"Q__S__EQ__prod.cate_id_":c,storeId:storeId},shrinkToFix:true,multiselect:true,pagerpos:"center",rowNum:20,rowList:[10,20,50,100],viewrecords:true,hidegrid:false,colNames:["图片真实URL","图片","名称","款号","规格","分类","范围","类型","类型","价格","销售类型","创建时间","状态",],colModel:[{name:"realPath",hidden:true,formatter:function(e,d,f){return f.path;
}},{name:"path",sortable:false,width:38,formatter:function(e){var d="<img style='display: inline; height:35px;' ";d=d+" src='"+ImageUtils.getUrl({url:e,name:"",id:""})+"?dm=_mm' >";
return d;}},{name:"name",index:"prod.name_",width:260,formatter:function(e,d,f){return e;}},{name:"code",width:70,index:"sku.code_",sortable:false,formatter:function(h,e,j){var g=j.prodSkuPoList;
var d="";if(g&&g.length){var l=new StringBuffer();for(var f=0;f<g.length;f++){var k=g[f];l.append(k.code).append(",");}d=l.toString();d=d.substring(0,d.length-1);
}return d;}},{name:"prodSkuPoList",width:120,sortable:false,formatter:function(h,e,j){var g=j.prodSkuPoList;var d="";if(g&&g.length){var l=new StringBuffer();
for(var f=0;f<g.length;f++){var k=g[f];l.append(k.spec).append(",");}d=l.toString();if(d.length==g.length){d="";}else{d=d.substring(0,d.length-1);}}return d;
}},{name:"cate",width:80,sortable:true,index_:"prod.cate_id_",sortable:false,},{name:"saleRange",width:60,sortable:true,index_:"prod.sale_range_",formatter:function(d){if(d=="first"){return"一线";
}else{if(d=="second"){return"二线";}else{return"共用";}}},},{name:"type",index:"prod.type_",width:260,hidden:true},{name:"typeShow",width:60,sortable:false,formatter:function(d,e,f){switch(f.type){case"entity":return"普通";
break;case"sku_entity":return"多SKU";break;case"package":return"商品套餐";break;case"service":return"服务";break;case"pointNormal":return"普通积分";break;case"pointSku":return"多sku积分";
break;case"finance":return"金融产品";break;}}},{name:"priceType",sortable:false,width:80,index:"prod.price_type_",formatter:function(k,e,g){var l="";if(k=="common"){l="正价";
}else{if(k=="special"){l="特价";}else{if(k=="gift"){l="赠品";}else{if(k=="exchange"){l="换购";}else{if(k=="experience"){l="体验价";}else{l="";}}}}}var h=g.prodSkuPoList;
var d="";if(h&&h.length){var m=new StringBuffer();for(var f=0;f<h.length;f++){var j=h[f];m.append(j.price).append("，");}d=m.toString();d=d.substring(0,d.length-1);
}return l+"："+d;}},{name:"salesType",sortable:false,width:120,classes:"autoHideCol",formatter:function(d){switch(d){case"stock":return"<span>按库存销售</span>";
break;case"always":return"<span class='text text-info'>永远可售</span>";break;}}},{name:"createTime",index:"prod.create_time_",width:80,formatter:function(d){return DateUtils.mini2Time(d);
}},{name:"status",width:50,sortable:false,formatter:function(d){switch(d){case"on_sale":return"<span class='text-danger'>上架</span>";case"not_on_sale":return"<span class='text-primary'>下架</span>";
case"delete":return"<span class='text-primary'>已删除</span>";case"sold_out":return"<span class='text-warning'>售罄</span>";}}},],rowNum:20,sortable:true,height:a,hidegrid:false,onSelectRow:function(d){if(isMultiple==0){if(b.lastSelectedId){$(SelectProd._CONS_.GRID).jqGrid("setSelection",b.lastSelectedId,false);
}b.lastSelectedId=d;}}});}};