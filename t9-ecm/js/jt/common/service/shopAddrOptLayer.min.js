function ShopAddrOpt(){this.hadInit=false;this.isEdit=false;this.isExist=false;this.addressService=new AddressService(ShopAddrOpt._CONS_.ADDR_CONTAINER);
this.options={callBack:null,};}ShopAddrOpt._CONS_={ADDR_CONTAINER:"shopAddrOptForm_cateContainer",EDIT_FROM_ID:"partyAddrEdidddddtForm",EDIT_URL:ctx+"/crm/cs/csEntity/addr/addrEditForm.htm",SAVE_URL:ctx+"/crm/cs/csEntity/addr/partyAddrAdd.htm",LISTNUM_BYCSID:ctx+"/crm/cs/csEntity/findPhonesByCsIdNotRepeat.htm",};
ShopAddrOpt.prototype={init:function(a){this._bindEventHander();this._openShopAddrDialog(a);this._bindFormValidation();},_openShopAddrDialog:function(d){var b=$(window).width();
var c=["650px","300px"];if(b<1024){c=["450px","230px"];}var a=this;layer.open({type:1,title:"收货地址处理",maxmin:false,shadeClose:false,btn:["保存","关闭"],skin:"addr-skin",area:c,content:$("."+ShopAddrOpt._CONS_.EDIT_FROM_ID),success:function(e,f){FormUtils.clear("shopAddrOptForm");
$(".addrDetaileDescribe").text("");$("input[id=shopAddrOptForm_types]").val("shipping");$("input[id=shopAddrOptForm_isSnapshot]").val("n");a._loadData(d.csId,d.addrId,d.isCs);
},yes:function(h,g){var f=$("div.partyAddrEdidddddtForm");if($("#shopAddrOptForm").valid()&&a.addressService.isValid(f)){$("textarea[name=addr]").val($("#shopAddrOptForm_addr").val());
if($("#shopAddrOptForm_mobile").val()==0){$("input[name=mobile]").val($("#maskNumber").val());}else{$("input[name=mobile]").val($("#shopAddrOptForm_mobile").val());
}var e=a.addressService.getAddress();$("input[name=coRid]").val(e.country);$("input[name=coName]").val(e.countryName);$("input[name=prRid]").val(e.province);
$("input[name=prName]").val(e.provinceName);$("input[name=ciRid]").val(e.city);$("input[name=ciName]").val(e.cityName);$("input[name=arRid]").val(e.area);
$("input[name=arName]").val(e.areaName);$("input[name=toRid]").val(e.town);$("input[name=toName]").val(e.townName);if($("#shopAddrOptForm_mobile").val()==0){if(!$("#maskNumber").val()){$(".tip").text("号码不能为空！").show();
return;}if(a.isExist){return;}}var i=$("#shopAddrOptForm").serialize();FormUtils.submit(ShopAddrOpt._CONS_.SAVE_URL,i,function(j){if(j.success){if(d.callBack){d.callBack(j.partyAddrPo);
}layer.close(h);}else{DialogUtils.error("失败",j.msg,f);}},function(){DialogUtils.error("错误","后台异常，请稍后重试",f);});}},cancel:function(){$("#shopAddrOptForm").validate().resetForm();
FormUtils.clear("shopAddrOptForm");}});},_loadData:function(d,c,b){var a=this;FormUtils.loadData(ShopAddrOpt._CONS_.EDIT_URL+"?csId="+d+"&addrId="+c,function(h){if(c){$("#shopAddrOptForm_isDefault").val(h.isDefault);
}else{if(h.isHaveDefault=="y"){$("#shopAddrOptForm_isDefault").val("n");}else{$("#shopAddrOptForm_isDefault").val("y");}}$("#shopAddrOptForm_partyId").val(d);
h.types&&$("input[id=shopAddrOptForm_types]").val(h["types"]);h.isSnapshot&&$("input[id=shopAddrOptForm_isSnapshot]").val(h["isSnapshot"]);if(b){h.maskAddr&&$("input[id=shopAddrOptForm_addr]").val(ResUtils.canShow("csEntity.button.viewAddrBtn")?h["maskAddr"]:MaskPhoneNum.maskAddr(h["maskAddr"]));
}else{h.maskAddr&&$("input[id=shopAddrOptForm_addr]").val(ResUtils.canShow("soEntity.button.viewAddrBtn")?h["maskAddr"]:MaskPhoneNum.maskAddr(h["maskAddr"]));
}h.addr&&$("textarea[name=addr]").val(h["addr"]);h.zipcode&&$("input[id=shopAddrOptForm_zipcode]").val(h["zipcode"]);h.name&&$("input[id=shopAddrOptForm_name]").val(h["name"]);
h.mobile&&$("input[id=mobile]").val(h["mobile"]);h.position&&$("input[id=shopAddrOptForm_position]").val(h["position"]);h.fax&&$("input[id=shopAddrOptForm_fax]").val(h["fax"]);
h.maskEmail&&$("input[id=shopAddrOptForm_email]").val(h["maskEmail"]);h.email&&$("input[name=email]").val(h["email"]);h.im&&$("input[id=shopAddrOptForm_im]").val(h["im"]);
h.createBy&&$("input[id=shopAddrOptForm_createBy]").val(h["createBy"]);h.createTime&&$("input[id=shopAddrOptForm_createTime]").val(h["createTime"]);h.id&&$("input[id=shopAddrOptForm_id]").val(h["id"]);
if(h.maskMobile){$("#newNumberContainer").hide();$(".tip").hide();}else{$("#newNumberContainer").show();var f=$("#maskNumber");f.val("");}var g=new StringBuffer();
if(h.maskMobile){g.append("<option value="+h["mobile"]+" selected='selected'>"+h["maskMobile"]+"</option>");}if(h.csPhonePos&&h.csPhonePos.length){if(h.csPhonePos&&h.csPhonePos.length){for(var e=0;
e<h.csPhonePos.length;e++){g.append("<option value="+h.csPhonePos[e].number+">"+h.csPhonePos[e].maskPhone+"["+h.csPhonePos[e].type+"]</option>");}}}g.append("<option class='addNewNum' value='0'>添加新号码</option>");
$("#shopAddrOptForm_mobile").empty().append(g.toString());a.addressService.init({country:h["coRid"]?h["coRid"]:"ChinaCityCateType-root",province:h["prRid"],city:h["ciRid"],area:h["arRid"],town:h["toRid"],});
if($("#shopAddrOptForm_mobile").val()!=0){$("#newNumberContainer").hide();$(".tip").hide();}});},_bindFormValidation:function(){jQuery.validator.addMethod("isPhone",function(c,b){return this.optional(b)||/^(1+\d{10})$/.test(c);
},"手机号码格式错误");var a={rules:{maskAddr:{required:true,maxlength:["1024"]},zipcode:{maxlength:["20"],zipcode:true},fax:{maxlength:["20"]},im:{maxlength:["64"]},name:{required:true,maxlength:["64"]},email:{required:true},maskNumber:{isPhone:true,},position:{maxlength:["64"]}},messages:{}};
FormUtils.bindFormValidation("shopAddrOptForm",a);},_bindEventHander:function(){var a=this;$(document).on("change","#maskNumber",function(){$(".tip").hide();
});$("#shopAddrOptForm").off("click","#shopAddrOptForm_email").on("click","#shopAddrOptForm_email",function(){if($("#shopAddrOptForm_email").val().indexOf("*")>0){$("#shopAddrOptForm_email").val("");
}});$("#shopAddrOptForm_mobile").off("change").on("change",function(){if($(this).val()!=0){$("#newNumberContainer").hide();$(".tip").hide();}else{$("#newNumberContainer").show();
var b=$("#maskNumber");b.val("");}});$("#maskNumber").off("blur").on("blur",function(){var b=$(this).val();if(b&&b.length>=7&&(!a.phonePrefix||a.phonePrefix!=b.substring(0,7))){FormUtils.loadData(ctx+"/crm/cs/csPhoneArea/getArea.htm?phone="+b,function(e){if(e.success){a.phonePrefix=b.substring(0,7);
var d=JSON.parse(e.msg);a.addressService.init({country:"ChinaCityCateType-root",province:d.provinceCateKey,city:d.cityCateKey,area:"",});}});}var c=new CsPhone();
if(b){if(c._checkIsPhone(b)){c.findCsByPhone(b,function(e){if(e&&e.success){var f=JSON.parse(e.msg);var d="号码重复，客户["+f.code+"]已拥有该号码";$(".tip").text(d).show();
a.isExist=true;}else{$(".tip").hide();a.isExist=false;}});}}});$(document).on("change","select[name=country_],select[name=province_],select[name=city_],select[name=area_],select[name=town_]",function(){var b=$("div.partyAddrEdidddddtForm");
var c=b.find("select[name=country_] option:selected").text();if(b.find("select[name=province_]").val()){c+="-"+b.find("select[name=province_] option:selected").text();
}if(b.find("select[name=city_]").val()){c+="-"+b.find("select[name=city_] option:selected").text();}if(b.find("select[name=area_]").val()){c+="-"+b.find("select[name=area_] option:selected").text();
}if(b.find("select[name=town_]").val()){c+="-"+b.find("select[name=town_] option:selected").text();}b.find(".addrDetaileDescribe").text(c);});}};