$(function(){var a=new UploadImageUtil();a.init();});function UploadImageUtil(){this.userId=currentUserId;this.contentId="uploader";this.images=[];}UploadImageUtil._CONS_={SAVE_ADD_URL:ctx+"/gl/image/image/saveAdd.htm",UPLOAD_PARAMS:{"acceptTypes":"gif,jpg,jpeg,bmp,png","mimeTypes":"image/*","fileSingleSizeLimit":1*1024*1024*6,"fileNumLimit":10,"uploadUrl":ctx+"/crm/components/upload/ajax.htm?categoryDir=temp"}};
UploadImageUtil.prototype={init:function(b,a){if(b){this.contentId=b;}$("#"+this.contentId).hide();if(!a){this._bindEventHandler();}},_bindEventHandler:function(){var a=this;
$(".uploadImage").on("click",function(){a._bindWebuploader();});$("#imageContainer").on("mouseenter",".file-box",function(){if(a._status!="selecting"){$(this).addClass("animated "+"pulse");
}});$("#imageContainer").on("mouseleave",".file-box",function(){if(a._status!="selecting"){var b=$(this);window.setTimeout(function(){b.removeClass("animated "+"pulse");
},2000);}});if(a.contentId=="uploader"){$("#imageContainer").on("click",".showPhotoAlbum",function(){var b=new stringBuffer();b.append('<a class="fancybox" rel="gallery1" href="http://farm2.staticflickr.com/1669/23976340262_a5ca3859f6_b.jpg" title="Twilight Memories (doraartem)">');
b.append('<img src="http://farm2.staticflickr.com/1669/23976340262_a5ca3859f6_m.jpg" alt="" />');b.append("</a>");b.append('<a class="fancybox" rel="gallery1" href="http://farm2.staticflickr.com/1459/23610702803_83655c7c56_b.jpg" title="Electrical Power Lines and Pylons disappear over t.. (pautliubomir)">');
b.append('<img src="http://farm2.staticflickr.com/1459/23610702803_83655c7c56_m.jpg" alt="" />');b.append("</a>");b.append('<a class="fancybox" rel="gallery1" href="http://farm2.staticflickr.com/1617/24108587812_6c9825d0da_b.jpg" title="Morning Godafoss (Brads5)">');
b.append('	<img src="http://farm2.staticflickr.com/1617/24108587812_6c9825d0da_m.jpg" alt="" />');b.append("</a>");b.append('<a class="fancybox" rel="gallery1" href="http://farm4.staticflickr.com/3691/10185053775_701272da37_b.jpg" title="Vertical - Special Edition! (cedarsphoto)">');
b.append('<img src="http://farm4.staticflickr.com/3691/10185053775_701272da37_m.jpg" alt="" />');b.append("</a>");$("#imageContainer").append(b.toString());
$(".fancybox").fancybox({openEffect:"none",closeEffect:"none"});});}},_bindWebuploader:function(b,g){var c=this;if(!g){g=c.contentId;}if(b){$("#imageContainer").empty().append(ImageUtils.createImageDivStr(b,null,true,null,true));
}var d=0;function e(j,i){if(i.flag){var k={height:i.height,width:i.width,path:i.localPath,name:i.fileName,byteCount:i.byteCount,isWater:i.water,isZoom:i.zoom,saveType:"relative",cateId:c.albumId,sort:d++};
c.images=[];c.images.push(k);}}function a(i,j){alert("上传"+i.name+"失败，原因是"+j);}function f(){$("#imageContainer").append(ImageUtils.createImageDivStr(c.images,null,true,null,true));
$("#"+g).hide();}var h=new JTWebUploader({config:{"acceptTypes":"gif,jpg,jpeg,bmp,png","mimeTypes":".jpg,.jpeg,.png,.bmp,.gif","fileSingleSizeLimit":100*1024*1024*6,"fileNumLimit":10,"uploadUrl":ctx+"/crm/components/upload/ajax.htm?categoryDir=temp"},container:"uploader",caption:"支持所有格式的文件上传！单个文件不得超过100M，一次最多上传10个文件！",success:e,error:a,finish:f,auto:true});
h.init();setTimeout(function(){$("#filePicker").find(".webuploader-element-invisible").trigger("click");},1);},_buildImageJson:function(){var a=[];$("#imageContainer").find(".file-box").each(function(){var c=$(this).find(".file a").attr("nameVal");
c=c.replace(/[\-\_\,\!\|\~\`\(\)\#\$\%\^\&\*\{\}\:\;\"\L\<\>\?\[\]\@]/g,"");var b=$(this).find(".file a").attr("urlVal");var d={name:c,path:b};a.push(d);
});return a;},getOptions:function(b){var c=this;var a=window.sessionStorage.getItem("loacalCashPicture");if(a&&a!=null&&a!=""){c._apendData(b,JSON.parse(a));
}else{FormUtils.loadData(ctx+"/gl/image/image/listImageByKey.htm?key=cashPicture&typeKey=system",function(d){window.sessionStorage.setItem("loacalCashPicture",JSON.stringify(d));
c._apendData(b,d);});}},_apendData:function(a,c){var d;if(a){d=$("#"+a);if(d.length==0){d=$("select."+a);if(d.length==0){d=$("select[name='"+a+"']");if(d.length==0){return false;
}}}}var e=new StringBuffer();if(c&&c.length>0){e.append("<option value=''>请选择</option>");for(var b=0;b<c.length;b++){e.append("<option value='"+c[b].path+"'>"+c[b].name+"</option>");
}d.empty().append(e.toString());}}};