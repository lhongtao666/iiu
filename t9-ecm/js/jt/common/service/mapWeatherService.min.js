function MapWeatherService(){this.hadInit=false;this.options={callBack:null,};this.map=null;}MapWeatherService._CONS_={EDIT_FROM_ID:"addrMapWeatherForm",LOAD_WEATHER_URL:ctx+"/crm/cs/csEntity/addr/loadWeatherInfo.htm",};
MapWeatherService.prototype={init:function(a){this._openShopAddrDialog(a);this._bindEventHander();},_bindEventHander:function(){var a=this;$(document).on("click",".searchMap",function(){a.map.clearOverlays();
var b=$("#selectFun").val();if(b==1){a.searchMapByKeyWord();}else{if(b==2){a.searchMapByBus();}else{if(b==3){a.searchMapByDriving();}else{if(b==4){a.searchMapByWalking();
}}}}});$(document).on("change","#selectFun",function(){$("#keyWordSpan").addClass("hide");$("#roadSpan").addClass("hide");if($(this).val()==1){$("#keyWordSpan").removeClass("hide");
a.searchMapByKeyWord();}else{if($(this).val()==2||$(this).val()==3||$(this).val()==4){$("#roadSpan").removeClass("hide");}}});},_openShopAddrDialog:function(c){var b=$(window).width();
if(b<1024){$("#dituContent").attr("style","width:80%;height:250px;border:#ccc solid 1px;");$("#tianqiContent").attr("style","width:80%;");}var a=this;a._loadMap(c.longitude,c.latitude);
a._loadWeather(c.cityName);$("#cityName").text(c.cityName);},_loadMap:function(e,g){this.map=new BMap.Map("dituContent");var f=this.map;var b=new BMap.Point(e,g);
f.centerAndZoom(b,15);var c=new BMap.Marker(b);f.addOverlay(c);window.map=f;f.enableDragging();f.enableScrollWheelZoom();f.enableDoubleClickZoom();f.enableKeyboard();
var a=new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_LARGE});f.addControl(a);var d=new BMap.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_LEFT});
f.addControl(d);},_loadWeather:function(b){var a=this;FormUtils.submit(MapWeatherService._CONS_.LOAD_WEATHER_URL,{cityName:b},function(e){if(e.resultcode=="200"){$(".todayTemp").text(e.result.sk.temp);
$(".todayTempLog").text("℃");$(".todayWind").text(e.result.today.wind);$(".todayWeather").text(e.result.today.weather+" ");$(".todayTemperature").text(e.result.today.temperature);
$(".todayCity").text(b);var c=new Date();var f=new StringBuffer();for(var d=0;d<e.result.future.length;d++){f.append("<li class='col-sm-1' style='border:1px solid #dcdcdc;width:90px;list-style-type:none;").append("text-align:center;padding-left:0px;padding-right:0px;padding-top:8px;padding-bottom:8px;'>");
f.append("<div>");if(d==0){f.append("<p><span>今天</span></p>");}else{if(d==1){f.append("<p><span>明天</span></p>");}else{f.append("<p><span>"+e.result.future[d].week+"</span></p>");
}}f.append("<p><span>"+e.result.future[d].date.substring(4,6)+"月"+e.result.future[d].date.substring(6,8)+"日</span></p>");f.append("<p><span>"+e.result.future[d].weather+"</span></p>");
f.append("<p><span>"+e.result.future[d].temperature+"</span></p>");f.append("</div>");f.append("</li>");}$(".futrueWeatherUl").empty().append(f.toString());
}else{$("#tianqiContent").empty().append("<div style='color:red;'>查询不到该城市的天气</div>");}});},searchMapByKeyWord:function(){var a=this;var b=new BMap.LocalSearch(a.map,{renderOptions:{map:a.map,panel:"r-result"}});
var c=$("#keyWord").val();b.search(c);},searchMapByBus:function(){var d=this;var c=new BMap.TransitRoute(d.map,{renderOptions:{map:d.map,panel:"r-result"}});
var a=$("#beginWord").val();var b=$("#endWord").val();c.search(a,b);},searchMapByDriving:function(){var c=this;var d=new BMap.DrivingRoute(c.map,{renderOptions:{map:c.map,panel:"r-result",autoViewport:true}});
var a=$("#beginWord").val();var b=$("#endWord").val();d.search(a,b);},searchMapByWalking:function(){var d=this;var b=new BMap.WalkingRoute(d.map,{renderOptions:{map:d.map,panel:"r-result",autoViewport:true}});
var a=$("#beginWord").val();var c=$("#endWord").val();b.search(a,c);},};