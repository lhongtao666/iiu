function bindWebupload(w,t,g,b,o){var j=jQuery,q=j("#"+t);q.empty().html(createFileUploadDiv());var k=j('<ul class="filelist"></ul>').appendTo(q.find(".queueList")),x=q.find(".statusBar"),d=x.find(".info"),c=q.find(".uploadBtn"),i=q.find(".placeholder"),p=x.find(".progress").hide(),z=0,n=0,l=window.devicePixelRatio||1,m=110*l,a=110*l,h="pedding",A={},v=(function(){var B=document.createElement("p").style,C="transition" in B||"WebkitTransition" in B||"MozTransition" in B||"msTransition" in B||"OTransition" in B;
B=null;return C;})(),s;if(!WebUploader.Uploader.support()){alert("Web Uploader 不支持您的浏览器！如果你使用的是IE浏览器，请尝试升级 flash 播放器");throw new Error("WebUploader does not support the browser you are using.");
}s=WebUploader.create({pick:{id:"#filePicker",label:"点击选择文件"},dnd:"#uploader,#recordUploader .queueList",paste:document.body,accept:{title:"选择文件",extensions:w.acceptTypes,mimeTypes:w.mimeTypes},swf:"${ctx}/js/plugins/webuploader/Uploader.swf",disableGlobalDnd:true,chunked:true,server:w.uploadUrl,fileNumLimit:w.fileNumLimit,fileSingleSizeLimit:w.fileSingleSizeLimit});
s.addButton({id:"#filePicker2",label:"继续添加"});function u(G){var H=j('<li id="'+G.id+'">'+'<p class="title">'+G.name+"</p>"+'<p class="imgWrap"></p>'+'<p class="progress"><span></span></p>'+"</li>"),E=j('<div class="file-panel">'+'<span class="cancel">删除</span>'+'<span class="rotateRight">向右旋转</span>'+'<span class="rotateLeft">向左旋转</span></div>').appendTo(H),D=H.find("p.progress span"),C=H.find("p.imgWrap"),F=j('<p class="error"></p>'),B=function(I){switch(I){case"exceed_size":text="文件大小超出";
break;case"interrupt":text="上传暂停";break;default:text="上传失败，请重试";break;}F.text(text).appendTo(H);};if(G.getStatus()==="invalid"){B(G.statusText);}else{C.text("预览中");
s.makeThumb(G,function(J,K){if(J){C.text("不能预览");return;}var I=j('<img src="'+K+'">');C.empty().append(I);},m,a);A[G.id]=[G.size,0];G.rotation=0;}G.on("statuschange",function(J,I){if(I==="progress"){D.hide().width(0);
}else{if(I==="queued"){H.off("mouseenter mouseleave");E.remove();}}if(J==="error"||J==="invalid"){console.log(G.statusText);B(G.statusText);A[G.id][1]=1;
}else{if(J==="interrupt"){B("interrupt");}else{if(J==="queued"){A[G.id][1]=0;}else{if(J==="progress"){F.remove();D.css("display","block");}else{if(J==="complete"){H.append('<span class="success"></span>');
}}}}}H.removeClass("state-"+I).addClass("state-"+J);});H.on("mouseenter",function(){E.stop().animate({height:30});});H.on("mouseleave",function(){E.stop().animate({height:0});
});E.on("click","span",function(){var I=j(this).index(),J;switch(I){case 0:s.removeFile(G);return;case 1:G.rotation+=90;break;case 2:G.rotation-=90;break;
}if(v){J="rotate("+G.rotation+"deg)";C.css({"-webkit-transform":J,"-mos-transform":J,"-o-transform":J,"transform":J});}else{C.css("filter","progid:DXImageTransform.Microsoft.BasicImage(rotation="+(~~((G.rotation/90)%4+4)%4)+")");
}});H.appendTo(k);}function y(B){var C=j("#"+B.id);delete A[B.id];e();C.off().find(".file-panel").off().end().remove();}function e(){var B=0,E=0,C=p.children(),D;
j.each(A,function(G,F){E+=F[0];B+=F[0]*F[1];});D=E?B/E:0;C.eq(0).text(Math.round(D*100)+"%");C.eq(1).css("width",Math.round(D*100)+"%");f();}function f(){var C="",B;
if(h==="ready"){C="选中"+z+"张图片，共"+WebUploader.formatSize(n)+"。";}else{if(h==="confirm"){B=s.getStats();if(B.uploadFailNum){C="已成功上传"+B.successNum+"张照片至XX相册，"+B.uploadFailNum+'张照片上传失败，<a class="retry" href="#">重新上传</a>失败图片或<a class="ignore" href="#">忽略</a>';
}}else{B=s.getStats();C="共"+z+"张（"+WebUploader.formatSize(n)+"），已上传"+B.successNum+"张";if(B.uploadFailNum){C+="，失败"+B.uploadFailNum+"张";}}}d.html(C);}function r(D){var C,B;
if(D===h){return;}c.removeClass("state-"+h);c.addClass("state-"+D);h=D;switch(h){case"pedding":i.removeClass("element-invisible");k.parent().removeClass("filled");
k.hide();x.addClass("element-invisible");s.refresh();break;case"ready":i.addClass("element-invisible");j("#filePicker2").removeClass("element-invisible");
k.parent().addClass("filled");k.show();x.removeClass("element-invisible");s.refresh();break;case"uploading":j("#filePicker2").addClass("element-invisible");
p.show();c.text("暂停上传");break;case"paused":p.show();c.text("继续上传");break;case"confirm":p.hide();c.text("开始上传").addClass("disabled");j("#filePicker2").removeClass("element-invisible");
B=s.getStats();if(B.successNum&&!B.uploadFailNum){r("finish");return;}break;case"finish":B=s.getStats();j("#filePicker2").removeClass("element-invisible");
c.text("开始上传").addClass("disabled");if(B.successNum){}else{h="done";location.reload();}break;}f();}s.onUploadProgress=function(D,B){var E=j("#"+D.id),C=E.find(".progress span");
C.css("width",B*100+"%");A[D.id][1]=B;e();};s.onFileQueued=function(B){z++;n+=B.size;if(z===1){i.addClass("element-invisible");x.show();}u(B);r("ready");
e();};s.onFileDequeued=function(B){z--;n-=B.size;if(!z){r("pedding");}y(B);e();};s.onUploadSuccess=function(C,B){g(C,B);};s.onUploadError=function(B,C){if(b){b(B,C);
}};s.on("all",function(C){var B;switch(C){case"uploadFinished":r("confirm");if(o){o();}break;case"startUpload":r("uploading");break;case"stopUpload":r("paused");
break;}});s.onError=function(B){alert("Eroor: "+B);};c.on("click",function(){if(j(this).hasClass("disabled")){return false;}if(h==="ready"){s.upload();
}else{if(h==="paused"){s.upload();}else{if(h==="uploading"){s.stop();}}}});d.on("click",".retry",function(){s.retry();});d.on("click",".ignore",function(){alert("todo");
});c.addClass("state-"+h);e();}function createFileUploadDiv(){var a="<div class='queueList'>"+"<div id='dndArea' class='placeholder'>"+"<div id='filePicker'></div>"+"<p>或将文件拖到这里</p>"+"</div>"+"</div>"+"<div class='statusBar' style='display:none;'>"+"<span class='text'>0%</span><span class='percentage'></span>"+"<div class='info'></div>"+"<div class='btns'>"+"<div id='filePicker2'></div>"+"<div class='uploadBtn'>开始上传</div>"+"</div>"+"</div>";
return a;}