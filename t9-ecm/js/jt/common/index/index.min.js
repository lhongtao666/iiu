function JTIndex(){this.userPw=new UserPw();this.msg=new Msg();this.tab=new Tab();this.menu=new Menu();this.forcePw=new ForcePw();this.kmHome=new KmHome();
this.loginWeiXin=new WeiXinLogin();this.versionTipPanel=new VersionTipPanel();}var exportSetInterval=null;var exportLayerIndex=null;var exportTime=0;function showTimming(c){if(exportSetInterval!=null){clearInterval(exportSetInterval);
}var b=window.innerWidth;var e=document.getElementById("timming");e.value=0;var d="导出进度";var a=$("#export-timming-layer");if(window.websocketErrorCount){a=$("#export-timming-layer-websocket-error");
}exportLayerIndex=layer.open({type:1,title:d,skin:"export-timming-skin",offset:["84px",(b-215)+"px"],shade:0,area:["200px","200px"],content:a,success:function(f,g){var h=10000*3/(c&&c>1000?c:1000);
if(h<1){h=1;}exportSetInterval=setInterval(function(){if((e.value<100-h)&&e.value<95){e.value=e.value+h;}},1000);}});}function closeTimming(){if(exportSetInterval!=null){clearInterval(exportSetInterval);
exportSetInterval=null;}var b=document.getElementById("timming");if(b.value<95){b.value=95;}var a=setInterval(function(c){if(b.value!=100){b.value++;}else{layer.close(exportLayerIndex);
clearInterval(a);}},1000);}JTIndex._CONS_={};JTIndex.prototype={init:function(){if(currentUserForcePw=="y"){this.forcePw.init();return;}if(window.localStorage.getItem("openIndexCount")>=1){alert("您已经打开一个首页，无法同时打开多个首页");
window.location.href="about:blank";return;}window.localStorage.setItem("openIndexCount",1);this.loadProtectConfig();this.msg.init(this.loginWeiXin);this.userPw.init();
this.loginWeiXin.init();this.tab.init();this.menu.init();this.kmHome.init();LockTimer.start();console.log("==================="+lockTime);this._bindEventHandler();
this._resizeIframeHeight();this.versionTipPanel.init();this.versionTipPanel.initVersionTip();window.localStorage.setItem("csAccount",currentAccount);this._specificHide(currentUserId);
},_specificHide:function(a){FormUtils.submit(ctx+"/crm/ou/employee/currentPosition.htm?currentUserId="+a,a,function(b){if(b.success){$("#currentSaleStatus").show();
var c="background-color: "+b.msg;$(".mySaleStatusIcon").attr("style",c);}else{$("#currentSaleStatus").hide();}});},_bindEventHandler:function(){var a=this;
$(window).on("load resize",function(){a._resizeIframeHeight();});a.isEnterAEle=false;a.isEnterUlEle=false;$("#userAccountContainer").on("mouseenter",function(){if(!a.isEnterAEle&&!a.isEnterUlEle){$(this).css({backgroundColor:"#FFFFFF"});
$("#userAccountULContainer").stop(true).slideDown();}a.isEnterAEle=true;}).on("mouseleave",function(){if(!a.isEnterUlEle){$("#userAccountULContainer").stop(true).slideUp();
$(this).css({backgroundColor:""});}a.isEnterAEle=false;});$("#userAccountULContainer").on("mouseenter",function(){$("#userAccountContainer").css({backgroundColor:"#FFFFFF"});
$("#userAccountULContainer").stop(true).slideDown();a.isEnterUlEle=true;}).on("mouseleave",function(){if(!a.isEnterAEle){$("#userAccountULContainer").stop(true).slideUp();
$("#userAccountContainer").css({backgroundColor:""});}a.isEnterUlEle=false;});$("#otherContainer").on("mouseenter",function(){if(!a.isEnterAEle&&!a.isEnterUlEle){$(this).css({backgroundColor:"#FFFFFF"});
$("#otherULContainer").stop(true).slideDown();}a.isEnterAEle=true;}).on("mouseleave",function(){if(!a.isEnterUlEle){$("#otherULContainer").stop(true).slideUp();
$(this).css({backgroundColor:""});}a.isEnterAEle=false;});$("#otherULContainer").on("mouseenter",function(){$("#otherContainer").css({backgroundColor:"#FFFFFF"});
$("#otherULContainer").stop(true).slideDown();a.isEnterUlEle=true;}).on("mouseleave",function(){if(!a.isEnterAEle){$("#otherULContainer").stop(true).slideUp();
$("#otherContainer").css({backgroundColor:""});}a.isEnterUlEle=false;});$(document).on("click",".protectEyes",function(){a.protectEyeLayer();});$(document).on("click",".protect-li",function(){var d=$("body").attr("class").split(/\s+/);
for(var c=0;c<d.length;c++){if(d[c].indexOf("protect-skin")>=0){$("body").removeClass(d[c]);}}var b="protect-skin-"+$(this).attr("data-color");$("body").addClass(b);
$(".protect-li").removeClass("active");$(this).addClass("active");window.localStorage.setItem("protectSkin",b);});},_resizeIframeHeight:function(){},protectEyeLayer:function(){var a=this;
a.protectEyes=layer.open({type:1,closeBtn:1,title:"灯光",offset:"15%",skin:"protect-eye-layer",content:$(".protect-eye-config"),scrollbar:false,shade:0,resize:false});
},loadProtectConfig:function(){var a=this;var b=window.localStorage.getItem("protectSkin");if(b){$("body").addClass(b);$(".protect-li").removeClass("active");
$(".protect-li[data-color='"+b.slice(b.lastIndexOf("-")+1)+"']").addClass("active");}}};function DataScreen(a){if(!a){a={};}this.title=a.title?a.title:"排行榜数据大屏";
this.screenId=null;this.full=false;this.min=false;this.vRate=16/9;this.hasInit=false;this.cpy={desc:true,refresh:2,interval:null,descInterval:null};this.dpm={desc:true,refresh:2,interval:null,descInterval:null,dpmId:null,dpmName:null,descDpmId:null,descDpmName:null};
this.skin=a.skin?a.skin:"";this.selectDpm=null;this.selectDpmDesc=null;this.counter={asc:10,desc:10};}DataScreen._CONS_={};DataScreen.prototype={init:function(){var a=this;
ConfigUtils.findByKey("newIndex.asc.sum",function(b){$(".ascTop").html(b.msg);a.counter.asc=b.msg;});ConfigUtils.findByKey("newIndex.desc.sum",function(b){$(".descTop").html(b.msg);
a.counter.desc=b.msg;});a.initScreen();a.loadCpyRank();a.rankInterval("cpy");if(a.cpy.desc){a.loadCpyDescRank();a.rankInterval("cpy",true);}a.loadDpmRank();
a.rankInterval("dpm");if(a.dpm.desc){a.loadDpmDescRank();a.rankInterval("dpm",true);}if(!a.hasInit){a.hasInit=true;}$(".jt-dpm-select").html("根部门");$(".screen-select-layer").hide();
$(".screen-data-configer").hide();},expandLayer:function(){var a=this;if(this.screenId){return false;}else{a.init();}},getLocalStore:function(){var a=this;
var b=window.localStorage.getItem("phbConfiger");if(b){b=JSON.parse(b);if(b[0]){a.cpy=b[0];}if(b[1]){a.dpm=b[1];}if(b[2]){a.skin=b[2];}}a.loadConfiger();
},saveLocalStore:function(){var a=this;var b=[a.cpy,a.dpm,a.skin];window.localStorage.setItem("phbConfiger",JSON.stringify(b));},loadConfiger:function(){var a=this;
$(".checked-cpy-desc").prop("checked",a.cpy.desc);$(".select-cpy-refresh").val(a.cpy.refresh);$(".checked-dpm-desc").prop("checked",a.dpm.desc);$(".select-dpm-refresh").val(a.dpm.refresh);
if(!a.cpy.desc){$(".cpy-rank-desc").hide();}if(!a.dpm.desc){$(".dpm-rank-desc").hide();}if(a.skin){$(".layer-skin-list").children("[data-skin='"+a.skin+"']").addClass("active");
}else{$(".layer-skin-list").children().eq(0).addClass("active");}},initScreen:function(){var a=this;a.getLocalStore();a.screener();a.screenLayer();if(!a.hasInit){a.bindEvent();
}},screener:function(){var a=this;var b=new StringBuffer();b.append("<div class='data-screen'>").append("<div class='cpy-rank-asc'></div>").append("<div class='cpy-rank-desc'></div>").append("<div class='dpm-rank-asc'></div>").append("<div class='dpm-rank-desc'></div>").append("</div>");
if($(".data-screen").length>0){}else{$("body").append(b.toString());}},screenLayer:function(){var f=this;var e=1400,c=740,b=$(window).width(),a=$(window).height();
var g=false;if(b>=1420){e+="px";}else{e=(b-50)+"px";if(b<=1024){e=(b-25)+"px";}g=true;}if(a>=840){c+="px";}else{c=(a-50)+"px";if(a<=740){c=(a-25)+"px";
}}var d=[e,c];f.screenId=layer.open({type:1,closeBtn:1,maxmin:true,title:f.title,shade:false,offset:"auto",area:d,skin:"data-screen-layer"+(f.skin?(" "+f.skin):""),content:$(".data-screen"),scrollbar:false,shade:[0.2,"#049af9"],resize:false,full:function(h,i){f.full=true;
if(!$(".data-screen-layer").is(".screen-layer-maxWin")){$(".data-screen-layer").addClass("screen-layer-maxWin");}layer.msg("双击任意位置退出全屏！");},min:function(h,i){f.min=true;
$(".data-screen-layer").removeClass("screen-layer-maxWin").addClass("screen-layer-minWin");$("#layui-layer-shade"+f.screenId).hide();},restore:function(h,i){f.full=false;
f.min=false;$(".data-screen-layer").removeClass("screen-layer-maxWin").removeClass("screen-layer-minWin");$("#layui-layer-shade"+f.screenId).show();f.calculateLayer();
},success:function(h,i){if(g){$(".data-screen-layer").addClass("screen-layer-lowPixel");}$(".data-screen-layer").append("<div class='screen-layer-configer'><i class='fa fa-cog' title='面板设置'></i></div>");
},cancel:function(i,h){f.screenId=null;f.destroyer();}});},destroyer:function(){var a=this;clearInterval(a.cpy.interval);a.cpy.interval=null;clearInterval(a.dpm.interval);
a.dpm.interval=null;if(a.cpy.descInterval){clearInterval(a.cpy.descInterval);a.cpy.descInterval=null;}if(a.dpm.descInterval){clearInterval(a.dpm.descInterval);
a.dpm.descInterval=null;}$(".rank-list-body").empty();$(".screen-select-layer").hide();$(".screen-data-configer").hide();},initLayer:function(){var a=this;
if(a.full){layer.full(a.screenId);if($(window).width()>=1400){$(".data-screen-layer").removeClass("screen-layer-lowPixel");}else{if(!$(".data-screen-layer").is(".screen-layer-lowPixel")){$(".data-screen-layer").addClass("screen-layer-lowPixel");
}}}else{if(a.min){}else{a.calculateLayer();}}},calculateLayer:function(){var e=this;var d=1400,c=740,b=$(window).width(),a=$(window).height(),g="10%",f="10%";
if(b>=1420){g=(b-d)/2+"px";d+="px";if($(".data-screen-layer").is(".screen-layer-lowPixel")){$(".data-screen-layer").removeClass("screen-layer-lowPixel");
}}else{d=(b-50)+"px";g="25px";if(b<=1024){d=(b-25)+"px";g="12.5px";}$(".data-screen-layer").addClass("screen-layer-lowPixel");}if(a>=840){f=(a-c)/2+"px";
c+="px";}else{c=(a-50)+"px";f="25px";if(a<=740){c=(a-25)+"px";f="12.5px";}}layer.style(e.screenId,{width:d,height:c,left:g,top:f});},changeState:function(){var a=this;
},rankLi:function(c,f){var a=this;var e=new StringBuffer();if(!c.aid){e.append('<div class="rank-list-li rank-list-unknow">').append('<div class="rank-li-container">').append('<div class="rank-list-order">').append(b(c.ranking,f)).append("</div>").append('<div class="rank-list-temp">').append('<div class="rank-list-user">').append("待定").append("</div>").append('<div class="rank-list-result">-</div>').append("</div>").append("</div>").append("</div>");
return e.toString();}var d=new Array();d=c.aid.split("：");function b(g,h){if(g<4){return'<i class="'+(h?"fa fa-sort-desc":"fa fa-star")+" fa-ranking-"+g+'"></i><div class="rank-num-'+g+'">'+g+"</div>";
}else{return'<i class="'+(h?"fa fa-sort-desc":"fa fa-star")+' fa-ranking"></i>'+g;}}e.append('<div class="rank-list-li">').append('<div class="rank-li-container">').append('<div class="rank-list-order">').append(b(c.ranking,f)).append("</div>").append('<div class="rank-list-temp">').append('<div class="rank-list-user">').append('<div class="rank-list-img">').append('<div class="rank-img-container"><img class="rank-profile" src="'+ctx+c.profile+'"></div>').append("</div>").append('<div class="rank-list-msg">').append('<div class="rank-msg-container"><p>工号：<span>'+d[0]+"</span></p><p>昵称：<span>"+d[1]+'</span></p><p class="rank-list-1024">业绩：<span>￥'+(c.sdTotal).toFixed(2)+"</span></p></div>").append("</div>").append("</div>").append('<div class="rank-list-result">￥'+(c.sdTotal).toFixed(2)+"</div>").append("</div>").append("</div>").append("</div>");
return e.toString();},rankInterval:function(a,c){var b=this;if(a=="cpy"){if(c){if(b.cpy.descInterval){clearInterval(b.cpy.descInterval);}b.cpy.descInterval=b.setRankInterval(function(){b.loadCpyDescRank();
},b.cpy.refresh);}else{if(b.cpy.interval){clearInterval(b.cpy.interval);}b.cpy.interval=b.setRankInterval(function(){b.loadCpyRank();},b.cpy.refresh);}}else{if(a=="dpm"){if(c){if(b.dpm.descInterval){clearInterval(b.dpm.descInterval);
}b.dpm.descInterval=b.setRankInterval(function(){b.loadDpmDescRank();},b.dpm.refresh);}else{if(b.dpm.interval){clearInterval(b.dpm.interval);}b.dpm.interval=b.setRankInterval(function(){b.loadDpmRank();
},b.dpm.refresh);}}}console.log(b.cpy);console.log(b.dpm);},setRankInterval:function(c,a){var b=this;var d=setInterval(function(){c();},a*60*1000);return d;
},loadRankingList:function(e,f){var c=this;$(f).empty();var g=($(f).closest(".rank-desc").length==0)?false:true;var a="";var b=0;$.each(e,function(h,j){a+=c.rankLi(this,g);
b++;});if(!g){if(b<c.counter.desc){for(var d=b;d<c.counter.desc;d++){a+=c.rankLi({ranking:d+1},g);}}}else{if(b<c.counter.asc){for(var d=b;d<c.counter.asc;
d++){a+=c.rankLi({ranking:d+1},g);}}}$(f).append(a);$(f).find(".rank-profile").each(function(h,j){$(this).load(function(){$(this).attr("style",c.imgStyle($(this)[0].naturalWidth,$(this)[0].naturalHeight,40));
});});},loadCpyRank:function(){var a=this;FormUtils.loadData(ctx+"/ec/salesorder/soEntity/loadRankingForToday.htm"+"?groupType="+"all",function(b){if(b){a.loadRankingList(b,$(".cpy-rank-asc").find(".rank-list-body"));
}else{console.log("内部错误！");}},null,true);},loadCpyDescRank:function(){var a=this;FormUtils.loadData(ctx+"/ec/salesorder/soEntity/loadRankingDxForToday.htm"+"?groupType="+"all",function(b){if(b){a.loadRankingList(b,$(".cpy-rank-desc").find(".rank-list-body"));
}else{console.log("内部错误！");}},null,true);},loadDpmRank:function(){var a=this;var b="?groupType=all";if(a.dpm.dpmId){b="?groupType=notAll&groupId="+a.dpm.dpmId;
}FormUtils.loadData(ctx+"/ec/salesorder/soEntity/loadRankingForToday.htm"+b,function(c){if(c){a.loadRankingList(c,$(".dpm-rank-asc").find(".rank-list-body"));
}else{console.log("内部错误！");}},null,true);},loadDpmDescRank:function(){var a=this;var b="?groupType=all";if(a.dpm.descDpmId){b="?groupType=notAll&groupId="+a.dpm.descDpmId;
}FormUtils.loadData(ctx+"/ec/salesorder/soEntity/loadRankingDxForToday.htm"+b,function(c){if(c){a.loadRankingList(c,$(".dpm-rank-desc").find(".rank-list-body"));
}else{console.log("内部错误！");}},null,true);},imgStyle:function(b,c,a){if(b>c){return"height:100% !important;left:-"+(a*(1-(c/b)))/2+"px;width:auto !important;";
}else{if(b==c){return null;}else{if(b<c){return"top:-"+(a*(1-(b/c)))/2+"px;";}}}},reCenter:function(){var b=this;var a="2%";if(!b.cpy.desc||!b.dpm.desc){a="13%";
}if(!b.cpy.desc&&!b.dpm.desc){a="26%";}$(".cpy-rank-asc").stop().animate({"margin-left":a},250);},loadDpmTree:function(c){var a=this;var b={treeId:c,cateTypeKey:"system",rootKey:"group",url:ctx+"/gl/ou/group/findAllEmployeeTree.htm",onClick:function(d){console.log(d);
if(this.treeId=="dpmTree"){a.selectDpm=d;}else{if(this.treeId=="dpmDescTree"){a.selectDpmDesc=d;}}}};ZtreeUtils.init(b);},searchNode:function(d,e){var a=$.fn.zTree.getZTreeObj(d);
a.setting.view.fontCss=function(g,f){return(!!f.highlight)?{color:"#ed5565","font-weight":"bold"}:{color:"","font-weight":"normal"};};var c=$.trim($("#"+e).val());
var b="name";if(this.lastValue&&this.lastValue===c){return;}this.lastValue=c;this.updateNodes(false,this.nodeList,d);if(c!=""){this.nodeList=a.getNodesByParamFuzzy(b,c);
this.updateNodes(true,this.nodeList,d);}else{this.nodeList=[];}},updateNodes:function(b,d,f){var c=$.fn.zTree.getZTreeObj(f);if(d){for(var e=0,a=d.length;
e<a;e++){d[e].highlight=b;if(b){c.expandNode(d[e].getParentNode(),true,false,false);}c.updateNode(d[e]);}}},bindEvent:function(){var a=this;$(document).on("dblclick",".screen-layer-maxWin",function(b){if($(b.target).is(".screen-layer-maxWin *")){$(".data-screen-layer").find(".layui-layer-max").trigger("click");
a.full=false;a.initLayer();$(this).removeClass("screen-layer-maxWin");}});$(document).on("click",".screen-layer-configer",function(b){b.stopPropagation();
if($(".screen-data-configer").is(":hidden")){$(".screen-data-configer").stop().slideDown("fast");$(".data-screen-layer").find(".phb-border").addClass("phb-border-shadow");
}else{$(".screen-data-configer").stop().slideUp("fast");$(".data-screen-layer").find(".phb-border").removeClass("phb-border-shadow");}});$(document).on("click",".screen-data-close",function(b){b.stopPropagation();
$(".data-screen-layer").find(".screen-layer-configer").trigger("click");a.saveLocalStore();$(".data-screen-layer").find(".phb-border").removeClass("phb-border-shadow");
});$(document).on("click",".jt-dpm-select",function(c){c.stopPropagation();var b=$(this).closest(".dpm-rank-layer").children(".screen-select-layer");if(b.is(":hidden")){b.stop().slideDown("fast");
a.loadDpmTree(b.find("ul").attr("id"));}else{b.stop().slideUp("fast");}});$(document).on("click",".jt-select-close",function(b){b.stopPropagation();$(this).parent().stop().slideUp("fast");
});$(document).on("click",".bottom-select-close",function(b){b.stopPropagation();$(this).parent().stop().slideUp("fast");if($(this).is(".dpm-desc")){a.dpm.descDpmId=a.selectDpmDesc.id;
a.dpm.descDpmName=a.selectDpmDesc.name;a.selectDpmDesc=null;$(this).closest(".dpm-rank-layer").find(".jt-dpm-select").empty().text(a.dpm.descDpmName);a.loadDpmDescRank();
}else{a.dpm.dpmId=a.selectDpm.id;a.dpm.dpmName=a.selectDpm.name;a.selectDpm=null;$(this).closest(".dpm-rank-layer").find(".jt-dpm-select").empty().text(a.dpm.dpmName);
a.loadDpmRank();}});$("#dpmTreeSearch").on("keyup",function(b){if(b.keyCode==13){a.searchNode("dpmTree","dpmTreeSearch");}});$("#dpmDescTreeSearch").on("keyup",function(b){if(b.keyCode==13){a.searchNode("dpmDescTree","dpmDescTreeSearch");
}});$(document).on("change",".checked-cpy-desc",function(b){if($(this).is(":checked")){a.cpy.desc=true;if($(".cpy-rank-desc").is(":hidden")){$(".cpy-rank-desc").stop().show("fast");
a.loadCpyDescRank();a.rankInterval("cpy",true);}}else{a.cpy.desc=false;if($(".cpy-rank-desc").is(":visible")){$(".cpy-rank-desc").stop().hide("fast");clearInterval(a.cpy.descInterval);
a.cpy.descInterval=null;$(".cpy-rank-desc").find(".rank-list-body").empty();}}a.reCenter();});$(document).on("change",".checked-dpm-desc",function(b){if($(this).is(":checked")){a.dpm.desc=true;
if($(".dpm-rank-desc").is(":hidden")){$(".dpm-rank-desc").stop().show("fast");a.loadDpmDescRank();a.rankInterval("dpm",true);}}else{a.dpm.desc=false;if($(".dpm-rank-desc").is(":visible")){$(".dpm-rank-desc").stop().hide("fast");
clearInterval(a.dpm.descInterval);a.dpm.descInterval=null;$(".dpm-rank-desc").find(".rank-list-body").empty();}}a.reCenter();});$(document).on("change",".select-cpy-refresh",function(b){a.cpy.refresh=$(this).val();
a.rankInterval("cpy",false);a.rankInterval("cpy",true);});$(document).on("change",".select-dpm-refresh",function(b){a.dpm.refresh=$(this).val();a.rankInterval("dpm",false);
a.rankInterval("dpm",true);});$(window).on("resize",function(){a.initLayer();});$(document).on("click",".layer-skin-list > div",function(c){if(!$(this).is(".active")){var b=$(this).parent().find(".active");
if(b.attr("data-skin")){$(".data-screen-layer").removeClass(b.attr("data-skin"));}b.removeClass("active");if($(this).attr("data-skin")){$(".data-screen-layer").addClass($(this).attr("data-skin"));
}$(this).addClass("active");a.skin=$(this).attr("data-skin");}});}};var rankScreen=null;function initDataScreen(){if(!rankScreen){rankScreen=new DataScreen();
rankScreen.init();}else{rankScreen.expandLayer();}}function Menu(){this.userMenus=[];this.windowWidth=$(window).width();}Menu._CONS_={GET_USER_MENU_DATA_URL:ctx+"/crm/ou/user/getUserMenuData.htm",};
Menu.prototype={init:function(){if(window.localStorage.getItem("userMenuStr")){$("#side-menu").append(window.localStorage.getItem("userMenuStr"));$("#side-menu").metisMenu();
}else{this._loadUserMenus();}$("body").addClass("mini-navbar");$(".short-name").show();$("#jt-name-span").empty().append(currentUserName);$("#jt-employee-img").attr("src",ctx+(currentUserProfile&&currentUserProfile!=""?currentUserProfile:"/img/jt/wx/images/head_default.jpg")+"??dm=_mm");
this._fixedMenuHeight();this._bindEventHandler();},_loadUserMenus:function(){var a=this;FormUtils.submit(Menu._CONS_.GET_USER_MENU_DATA_URL,{},function(b){if(!b||!b.length){DialogUtils.success(msgCode.SUCCESS,"该用户目前没有菜单数据");
}else{a.userMenus=b;a._renderMenu();}},function(){DialogUtils.error("错误","网络错误，请稍候重试");});},_renderMenu:function(){var a=this;var b=false;if(a.userMenus&&a.userMenus.length){var f=new StringBuffer();
for(var c=0;c<a.userMenus[0].subs.length;c++){f.append(e(a.userMenus[0].subs[c],a.userMenus[0].subs[c].depth));}var g=$("#side-menu").find("li")[0];$("#side-menu").html(g).append(f.toString());
a.userMenuStr=f.toString();window.localStorage.setItem("userMenuStr",f.toString());$("#side-menu").metisMenu();}function e(l,n){if(l.type=="button"||l.isShow=="n"){return"";
}var k=new StringBuffer();var m="";if(l.imgUrl){m=ctx+ztreeIconStyle+"/"+l.imgUrl+".png";}else{m=ctx+ztreeIconStyle+"/jt-145.png";}if((l.subs==null||l.subs.length==0)&&l.type=="url"){k.append("<li><a href='javascript:;' class='jt_menuItem' data-url='").append(ctx).append(l.content).append("'>");
if(m){k.append("<i><img style='width: 16px; height: 16px;' src='");k.append(m).append("'></i>");}k.append(l.name).append("</a></li>");}else{if(n==3||n>3){k.append("<li class='dropdown-submenu'><a href=''>");
if(m){k.append("<i><img style='width: 16px; height: 16px;' src='");k.append(m);k.append("'></i>");}k.append(l.name).append("<b class='arrow'></b></a>");
k.append("<ul class='dropdown-menu pull-left'>");}else{if(n==2){k.append("<li class='dropdown'><a href='#'>");if(m){k.append("<i><img style='width: 16px; height: 16px;' src='").append(m).append("'></i>");
}k.append("<b class='short-name' "+(b?"style='display:none;'":"")+">"+h(l.name)+"</b></a>").append("<ul class='dropdown-menu pull-left'>");}}for(var j=0;
j<l.subs.length;j++){if(l.subs[j].length==null||l.subs[j].length==0){k.append(e(l.subs[j],l.subs[j].depth));}}k.append("</ul>");}k.append("</li>");return k;
}function h(j){var i="";if(j&&j.length>2){i=j.substring(0,2);}else{i=j;}return i;}function d(l,n){if(l.type=="button"){return"";}var k=new StringBuffer();
var m="";if(l.imgUrl){m=ctx+ztreeIconStyle+"/"+l.imgUrl+".png";}if((l.subs==null||l.subs.length==0)&&l.type=="url"){k.append("<li><a href='javascript:;' class='J_menuItem' data-url='").append(ctx).append(l.content).append("'>");
if(m){k.append("<i><img style='width: 16px; height: 16px;' src='");k.append(m).append("'></i>");}k.append(l.name).append("</a></li>");}else{if(n==3){k.append("<li><a href=''>");
if(m){k.append("<i><img style='width: 16px; height: 16px;' src='");k.append(m);k.append("'></i>");}k.append(l.name).append("<span class='fa arrow'></span></a>");
k.append("<ul class='nav nav-third-level'>");}else{if(n==2){k.append("<li><a href='#'>");if(m){k.append("<i><img style='width: 16px; height: 16px;' src='").append(m).append("'></i>");
}k.append("<span class='nav-label'>").append(l.name).append("</span><span class='fa arrow'></span></a>").append("<ul class='nav nav-second-level'>");}}for(var j=0;
j<l.subs.length;j++){if(l.subs[j].length==null||l.subs[j].length==0){k.append(e(l.subs[j],l.subs[j].depth));}}k.append("</ul>");}k.append("</li>");return k;
}},_fixedMenuHeight:function(){$(".sidebar-collapse").slimScroll({height:"100%",railOpacity:0.9,alwaysVisible:false});},_bindEventHandler:function(){var a=this;
$(".sidebar-collapse").on("click",".J_menuItem",function(){var c=$(this).attr("data-url");var b=$.trim($(this).text());if(c==undefined||c.isEmpty()){return;
}$("#side-menu").find(".J_menuItem").removeClass("activeMenu");$(this).addClass("activeMenu");JTTabUtils.addOrRefreshTab(c,b);});$("body").on("click",".jt_menuItem",function(){var c=$(this).attr("data-url");
var b=$.trim($(this).text());if(c==undefined||c.isEmpty()){return;}$("#side-menu").find("ul").removeClass("in");var d=$(window).width();if(d<1025){$("body").addClass("mini-navbar");
$(".navbar-static-side").fadeIn();$(".short-name").show();}JTTabUtils.addOrRefreshTab(c,b);$("iframe.J_iframe").load(function(){$("body",$(this).contents()).on("click",function(f){if(!$("#telContainer").is(":hidden")){$(".telNumberBtn.btn-primary").removeClass("btn-primary").addClass("btn-default");
$("#telContainer").slideUp("fast");$(".openPhoneBtn").find("span").removeClass("up-caret");}});});});$("body").on("click",".dropdown",function(){$(this).removeClass("active");
var b=$(this);setTimeout(function(){b.find("ul").removeClass("in").css({"height":""});},500);});$("body").on("click",".side-menu .dropdown-submenu",function(){$(this).removeClass("active");
});$("body").on("mouseenter",".dropdown",function(){if($(this).find(".dropdown-menu").length>0){var d=$(window).height();var c=$(this).offset().top;var e=$(this).height();
var b=$(this).find(".dropdown-menu").eq(0).height();if(c+b>d-21){$(this).find(".dropdown-menu").eq(0).css({"top":d-c-b-21});}}});$(window).on("resize",function(){var b=$(window).width();
if(b<1024){$("body").addClass("mini-navbar");$(".short-name").show();}});$("body").on("mouseenter",".dropdown-submenu",function(){if($(this).find(".dropdown-menu").length>0){var d=$(window).height();
var c=$(this).offset().top;var e=$(this).height();var b=$(this).find(".dropdown-menu").eq(0).height();if(c+b>d){$(this).find(".dropdown-menu").eq(0).css({"top":d-c-b-21});
}}});$("body").on("click",".fullScreen",function(){var c=false;if(document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement){c=true;
}if(!c){var b=document.documentElement;if(b.requestFullscreen){b.requestFullscreen();}else{if(b.mozRequestFullScreen){b.mozRequestFullScreen();}else{if(b.webkitRequestFullScreen){b.webkitRequestFullScreen();
}else{if(elem.msRequestFullscreen){elem.msRequestFullscreen();}}}}}else{if(document.exitFullscreen){document.exitFullscreen();}else{if(document.mozCancelFullScreen){document.mozCancelFullScreen();
}else{if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();}else{if(document.msExitFullscreen){document.msExitFullscreen();}}}}}});$("body").on("click",".csDetailTab",function(){var c=$(".csDetailTab").attr("cs_name");
var b=$(this).attr("value");if(c.length>4){c="*"+c.substring(c.length-3,c.length);}JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/detail.htm?csId="+b,"客户["+c+"]明细");
});$("body").on("click",".soDetailTab",function(){var c=$(".csDetailTab").attr("cs_name");var b=$(this).attr("value");JTTabUtils.addOrRefreshTab(ctx+"/ec/salesorder/soEntity/detail.htm?soNo="+b,c+"的订单明细");
});$("body").on("click","#currentSaleStatus",function(){layer.open({type:1,title:["我的当日销售情况","font-size:18px;"],shadeClose:false,btn:["关闭"],area:["700px","600px"],scrollbar:false,content:$(".mySaleStatusLayer"),success:function(b,c){var e=currentAccount;
var d=currentUserId;a._loadMyTalkTime(e);a._initTable(e);}});});},_loadMyTalkTime:function(b){var a=this;FormUtils.loadData(ctx+"/gl/cti/tRKSheetRecord/loadMyTalkTime.htm?aid="+b,function(h){if(h){var g=h.totalTimeLength;
var f=h.validTimeLength;var e=h.validCount;var d=a._formatSeconds(g);var c=a._formatSeconds(f);$("#talkTime").text(d);$("#effectiveTalkTime").text(c);$("#effectiveTalkTimeNum").text(e+"次");
}});},_formatSeconds:function(d){var b=0;var c=0;if(d>60){b=parseInt(d/60);d=parseInt(d%60);if(b>60){c=parseInt(b/60);b=parseInt(b%60);}}var a=""+parseInt(d)+"秒";
if(b>0){a=""+parseInt(b)+"分"+a;}if(c>0){a=""+parseInt(c)+"小时"+a;}return a;},_initTable:function(c){var a=this;var d=new StringBuffer();d.append("<table class='table table-bordered table-stripped' id='saleOrderTable'>");
d.append("<thead><tr>");d.append("<th width='2%'>序号</th>");d.append("<th width='8%'>订单编号</th>");d.append("<th width='8%'>客户编号</th>");d.append("<th width='4%'>订单状态</th>");
d.append("<th width='6%'>订单金额</th>");d.append("</tr></thead>");d.append("<tfoot>");d.append("<tr style='color:red;'>");d.append("<td colspan='5'>");d.append("<span style='padding-left:0px;'>总金额(合计)：</span>");
d.append("<span id='totalAmountsum'></span>");d.append("</td></tr>");d.append("</tfoot>");d.append("</table>");$("#saleOrderDiv").empty().append(d.toString());
var b=ctx+"/ec/salesorder/soEntity/findByEmpIdAndTime.htm?aid="+c;$("#saleOrderTable").DataTable({ajax:{url:b},columns:[{data:"lineNum"},{data:"soNo",render:function(g,f,e){if(g!=null&&g!=""){return"<a href='#' class='soDetailTab' value='"+g+"' attr-id='"+e.id+"'>"+g+"</a>";
}return g;}},{data:"csNo",render:function(g,f,e){if(g!=null&&g!=""){return"<a href='#' class='csDetailTab' cs_name='"+e.csName+"' value='"+e.csId+"' attr-id='"+e.id+"'>"+g+" : "+e.csName+"</a>";
}return g;}},{data:"type",render:function(g,f,e){if(g=="awaiting_pay"){return"待支付";}if(g=="confirm"){return"已审核";}if(g=="shipping"){return"已发货";}if(g=="complete"){return"已签收";
}if(g=="close_reject"){return"已拒收";}if(g=="close_lost"){return"已丢失";}if(g=="close"){return"已关闭";}else{return g;}}},{data:"totalAmount"}],rowId:"id",lengthMenu:[[20],],fnRowCallback:function(h,g,f,e){if(f==0){total=0;
}total+=parseFloat(g["totalAmount"]);$("#totalAmountsum").html(total.toFixed(2)+"(元)");return h;},paging:false,pagingType:"simple",lengthChange:false,info:false,autoWidth:false,ordering:false,searching:false,order:[[1,"asc"]]});
},_smoothlyMenu:function(){if(!$("body").hasClass("mini-navbar")){$("#side-menu").hide();setTimeout(function(){$("#side-menu").fadeIn();},300);}else{if($("body").hasClass("fixed-sidebar")){$("#side-menu").hide();
setTimeout(function(){$("#side-menu").fadeIn();},300);}else{$("#side-menu").removeAttr("style");}}},_openNav:function(){$("body").removeClass("mini-navbar");
this._smoothlyMenu();}};function Msg(){this.menu=new Menu();this.websocket=null;this.loginWeiXin=null;this.isNotice=false;}Msg._CONS_={};Msg._LEVEL_={DANGER:5,ERROR:4,SUCCESS:3,WARNING:2,INFO:1,DEFAULT:0};
Msg.prototype={init:function(a){this._bindEventHanlder();this._initMsgWebsocket();this._initTaskMsg();this._initLostMsg();if(ResUtils.canShow("soEntityConfirm.button.repeatAudit")&&parseInt(repeatTipTime)>0){this._initRepeatComfirmMsg();
}this._showUnReadNoticeAndReminds();this._hideNotGrantBtn();this.loginWeiXin=a;},_hideNotGrantBtn:function(){if(!ResUtils.canShow("stickerEntity.url")){$(".open-stickers").parent().remove();
}else{var a=this;FormUtils.loadData(ctx+"/gl/task/stickerEntity/getActiveStickerCount.htm",function(b){if(b&&b.success){$("#stickerCount").text(b.msg);
}},null,true);}},_initLostMsg:function(){var a=this;if(window.localStorage.getItem("loginTime")){window.localStorage.removeItem("loginTime");if(!ctiType||ctiType=="ls"){if(currentUserAdn){if(currentUserAdn&&currentUserAdn.indexOf(",")!=-1){var d=currentUserAdn.split(",");
var c=d[0];var b=d[1];FormUtils.submit(ctx+"/gl/cti/ctiMissedcallRemind/getMissedCall.htm",{adn:c,checkWap:"y"},function(e){});FormUtils.submit(ctx+"/gl/msg/msgEntity/getMissedCall.htm",{adn:b},function(e){});
}else{FormUtils.submit(ctx+"/gl/cti/ctiMissedcallRemind/getMissedCall.htm",{adn:currentUserAdn,checkWap:"y"},function(e){});}}}}},_initTaskMsg:function(){var a=this;
FormUtils.loadData(ctx+"/gl/task/taskEntity/findUserTodayUnfinishTask.htm",function(l){if(l&&l.length>0){var h=0;for(var f=0;f<l.length;f++){var b=l[f];
var c=new Date(b.notifyTime);var e=DateUtils.format(c,DateUtils._CONS_.DEFAULT_HOU_MIN_PATTERN);var k=b.name.length<=15?b.name:b.name.substring(0,12)+"...";
var d=new Date();var g=null;if(c.getMonth()==d.getMonth()&&c.getDate()==d.getDate()){h=h+1;}}var j="截至当前日期,您有["+l.length+"]个任务未完成,其中今天有["+h+"]个.";DialogUtils.notice("待办",j,function(i){JTTabUtils.addOrRefreshTab(ctx+"/gl/task/taskEntity/list.htm","待办任务","待办任务");
});a._resetTaskCount(l.length);}});},_initRepeatComfirmMsg:function(){var a=this;var b=repeatTipTime*60*1000;FormUtils.loadData(ctx+"/ec/salesorder/soEntity/repeatComfirm.htm",function(c){if(c&&c.length>0){var e="截至当前日期,待复审订单有["+c.length+"]个.";
DialogUtils.notice("待复审",e,function(f){});a._resetTaskCount(c.length);var d=document.getElementById("repeat_audit_tip_audio");d.currentTime=0;d.play();
}});clock=setTimeout(function(){a._initRepeatComfirmMsg();},b);},_initUnreadWxMsg:function(){var a=this;FormUtils.loadData(ctx+"/crm/cs/weiXinRecord/noticeUnreadWxMsg.htm",function(b){});
},_deleteMsg:function(c,b){var a=this;DialogUtils.confirm(function(){FormUtils.submit(ctx+"/gl/msg/msgEntity/deleteMsgRead.htm",{msgId:c,recId:currentUserId},function(d){if(d.success){b.remove();
DialogUtils.success(msgCode.SUCCESS,"删除成功");}});});},_resetTaskCount:function(a){$("#taskCount").text(a);},_loadAndResetTaskCount:function(){var a=this;
FormUtils.loadData(ctx+"/gl/task/taskEntity/findUserTodayUnfinishTask.htm",function(b){if(b){a._resetTaskCount(b.length);}},null,true);},_bindEventHanlder:function(){var a=this;
$(".sidebar-container-msg").on("click","li a",function(){if($(this).attr("href")=="#tab-2"){$("#deleteAllNoticeBtn").show();}else{$("#deleteAllNoticeBtn").hide();
}});$("#deleteAllNoticeBtn").on("click",function(b){b.stopPropagation();DialogUtils.confirmWithOptions({title:"是否要删除全部通知",yesFunc:function(){FormUtils.submit(ctx+"/gl/msg/msgEntity/deleteAllMsgReminds.htm",{recId:currentUserId},function(c){if(c.success){DialogUtils.success(msgCode.SUCCESS,"删除成功");
a.websocket.send("isReady");}else{DialogUtils.success(msgCode.ERROR,"删除失败");}});}});});$("body").on("click",".msgRemind",function(){var b=$(this).attr("urlVal");
var c=$(this).attr("titleVal");if(b){if(c==="待办任务"){JTTabUtils.addOrRefreshTab(ctx+"/gl/task/taskEntity/list.htm","待办任务","待办任务");}else{JTTabUtils.addOrRefreshTab(ctx+b,c);
}}});$("#right-sidebar").on("click",".deleteMsgBth",function(){var b=$(this).attr("idVal");a._deleteMsg(b,$(this).parents(".panel.panel-default"));});$("body").on("click",".open-stickers",function(){JTTabUtils.addOrRefreshTab(ctx+"/gl/task/stickerEntity/list.htm","便签","便签");
});$("body").on("click",".open-tasks",function(){JTTabUtils.addOrRefreshTab(ctx+"/gl/task/taskEntity/list.htm","待办任务","待办任务");});$("#remindContainer").on("click",".closeRemindBtn",function(d){var b=$(this).parent();
var c=$(this).parent().attr("remindIdVal");a._deleteMsg(c,b);d.stopPropagation();});$(".right-sidebar-toggle,#closeMsgBtn").click(function(){JTTabUtils.addOrRefreshTab(ctx+"/gl/msg/msgNotice/list.htm","消息");
});$("body").on("click",".noticeTitle",function(){if($(this).find("i").hasClass("fa-angle-double-down")){$(this).find("i").removeClass("fa-angle-double-down").addClass("fa-angle-double-up");
$(this).siblings(".noticeContent").slideDown();}else{$(this).find("i").addClass("fa-angle-double-down").removeClass("fa-angle-double-up");$(this).siblings(".noticeContent").slideUp();
}});},_tipForWebsocketError:function(){var a=this;window.websocketErrorCount=window.websocketErrorCount?(window.websocketErrorCount+1):1;if(window.websocketErrorCount<2){a._initMsgWebsocket();
}else{$("#websocketErrorTip").text("导出配置错误(点击重试)").one("click",function(b){a._revertTipForWebsocketError();FormUtils.loadData(ctx+"/getAddr.htm",function(c){if(c.success){websocket_ip=c.data.websocket_ip;
websocket_type=c.data.websocket_type;}window.websocketErrorCount=0;$("#websocketErrorTip").text("");a._initMsgWebsocket();},null,true);});}},_revertTipForWebsocketError:function(){window.websocketErrorCount=0;
$("#websocketErrorTip").text("");},_initMsgWebsocket:function(){var b=this;if(websocket_type&&websocket_type.indexOf("node")>-1){var a=io("ws://"+websocket_ip+"/t9-websocket/gl/msg/msg?userId="+currentUserId+"&sessionId="+sessionId);
b.websocket={};b.websocket.close=function(){b.socket.close();};b.websocket.send=function(d){a.send("sendMessage",d);};a.on("connect",function(){if(b.websocket.onopen){b.websocket.onopen();
}});a.on("message",function(e){var d={};d.data=JSON.stringify(e);b.websocket.onmessage(d);});a.on("error",function(d){b.websocket.onerror(d);});b.socket=a;
}else{try{this.websocket=new WebSocket("ws://"+websocket_ip+"/t9-websocket/gl/msg/msg?userId="+currentUserId+"&sessionId="+sessionId);}catch(c){this.websocket=this.websocket||{};
b._tipForWebsocketError();}}if(b.heartBeatInterval){clearInterval(b.heartBeatInterval);}this.websocket.onopen=function(d){console.log("open websocket");
b.websocket.send("isReady");b.heartBeatInterval=setInterval(function(){if(b.websocket.readyState===1){b.websocket.send("ping");}else{b._initMsgWebsocket();
}},1000*2);b._revertTipForWebsocketError();};this.websocket.onclose=function(d){$.log("close web socket");};this.websocket.onerror=function(d){console.log("error happened");
b._tipForWebsocketError();};this.websocket.onmessage=function(u){var D=u.data;var j=JSON.parse(D);switch(j.type){case"unReadNotice":var d=new StringBuffer();
var z=j.content;if(!$("#noticeContainer").find("div[noticeIdVal='"+z.id+"']").length){var B=[];B.push(z);$("#noticeContainer").prepend(b._createNoticeStr(B));
var C=$("#msgCount");C.text(parseInt(C.text())+1);}DialogUtils.notice(z.title,z.content);break;case"assignedcs":var A=j.content;DialogUtils.notice("通知",A.content,function(){JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/list.htm","我的客户");
});b._createSingleRemindStr(A);break;case"taskentity":var A=j.content;DialogUtils.notice("通知",A.content,function(G){JTTabUtils.addOrRefreshTab(ctx+"/gl/task/taskEntity/list.htm","待办任务","待办任务");
});b._createSingleRemindStr(A);b._loadAndResetTaskCount();break;case"taskentity_turn_task":var A=j.content;DialogUtils.notice("通知",A.content,function(){JTTabUtils.addOrRefreshTab(ctx+"/gl/task/taskEntity/list.htm","待办任务","待办任务");
});b._loadAndResetTaskCount();break;case"missedcall":var A=j.content;var E=A.title;var m=E.trim().substring(0,11);var e=PhoneEncryptUtils.encryptPhone(m);
E="未接来电："+e;DialogUtils.notice("未接来电",e,function(){var G=ctx+"/crm/cs/csEntity/in.htm?phoneNum="+m+"&inType=missedcall&inNum="+currentUserAdn;JTTabUtils.addOrRefreshTab(G,E);
},{timeOut:-1});b._createSingleRemindStr(A);break;case"unReadRemind":var A=j.content;DialogUtils.notice("消息提醒",A.content);break;case"lockScreen":LockTimer.openLockScreenView();
break;case"forceLogout":LockTimer.openErrorTipView(j.content.tip);break;case"creditNotify":var s=j.content;DialogUtils.notice("预警提醒",s);case"downloadReport":closeTimming();
var F=j.content.name,l=j.content.downloadUrl;var r=document.createElement("iframe");r.src=ctx+"/crm/components/upload/download.htm?dname="+F+"&durl="+l;
r.style.display="none";document.body.appendChild(r);break;case"downloadReportFail":DialogUtils.error("导出失败","报表导出失败,请稍候重试或联系管理员");break;case"downloadExcel":DialogUtils.success("导出成功",j.content);
break;case"newMessage":var A=j.content;DialogUtils.notice("你收到一条新短信",A.content,function(){JTTabUtils.addOrRefreshTab(ctx+A.url,A.title);},{timeOut:-1});
b._createSingleRemindStr(A);break;case"newPointOrder":var A=j.content;DialogUtils.notice("新积分订单",A.content,function(){JTTabUtils.addOrRefreshTab(ctx+A.url,A.title);
},{timeOut:-1});b._createSingleRemindStr(A);break;case"szcti":console.log("深圳cti事件推送");console.log("content:"+j.content);console.log("eventType:"+j.content.content.eventType);
b._dealSzCtiEvent(j.content.content);break;case"sms_msg":var A=j.content;if(A&&A.title&&(A.title.indexOf("失败")>-1||A.title.indexOf("审核不通过")>-1)){DialogUtils.notice(A.title,A.content,function(){},{msgType:msgCode.ERROR});
}else{DialogUtils.notice(A.title,A.content,function(){},{timeOut:8000});}break;case"reload":window.localStorage.removeItem("userMenuStr");b.menu.init();
break;case"qrcodeStatus":var s=j.content;if("qrcodeFail"==j.content){s="扫描二维码验证失败";}else{if("qrcodeSuccess"==j.content){s="扫描成功，请在手机上点击确认登录";}}$("#scan-info-span").empty().append(s);
break;case"loginStatus":var s=j.content;var n="";if("logining"==s.status){n="正在登陆中...";}else{if("loginOutTime"==s.status){n="登录超时";}else{if("loginFail"==s.status){n="登录失败，请稍后重试";
}else{if("upLimitCount"==s.status){n="登录失败，超出每个员工微信号限制";}else{if("loginSuccess_init"==s.status){var f=window.localStorage.getItem("isWxLoadComplete");var o={};
if(f&&f!=""){o=JSON.parse(f);}o[s.empWx]="n";window.localStorage.setItem("isWxLoadComplete",JSON.stringify(o));n="登录成功";b._hideScanPane();b._removeMsgCount(s.empWx);
b._relaodWeixin();var h=$("a.J_menuTab[data-id='"+ctx+"/crm/cs/weiXinChat/list.htm']");if(!(h.length>0&&h.hasClass("active"))){JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/weiXinChat/list.htm","微信聊天","微信聊天",true);
}}else{if("loginSuccess_complete"==s.status){var f=window.localStorage.getItem("isWxLoadComplete");var o={};if(f&&f!=""){o=JSON.parse(f);}o[s.empWx]="y";
window.localStorage.setItem("isWxLoadComplete",JSON.stringify(o));b._relaodWeixin(s.empWx);}else{if("logout"==s.status){n="你在手机上登出了微信，再见";b._hideScanPane();
DialogUtils.error("微信退出通知","有微信号已退出！请留意");b._relaodWeixin();}else{if("syncFail"==s.status){DialogUtils.error("微信退出通知","有微信号通信不正常，已退出！需要重新扫码登录");b._relaodWeixin();
}}}}}}}}$("#scan-info-span").empty().append(n);break;case"delContact":break;case"wxMsg":var i=j.content;b._dealWxMsg(i);break;case"andoidWxMsg":var i=j.content;
b._dealAndoidWxMsg(i);break;case"reloadAndroid":var i=j.content;b._reloadAndroid(i);break;case"andoidWxStatus":var i=j.content;b._dealAndoidWxStatus(i);
break;case"applyFriends":var i=j.content;i.messageType="applyFriends";console.log(JSON.stringify(i));b._sendIframeMsg(i);break;case"androidDeleteContact":var i=j.content;
i.messageType="deleteContact";console.log(JSON.stringify(i));b._sendIframeMsg(i);break;case"revorkMsg":var i=j.content;i.messageType="revorkMsg";console.log(JSON.stringify(i));
b._sendIframeMsg(i);break;case"batchAddWxCsMind":var A=j.content;DialogUtils.success("微信添加客户通知",A);break;case"batchAddWxCs":var A=j.content;DialogUtils.success("微信添加客户通知",A);
b._relaodWeixin();break;case"remarkChange":DialogUtils.notice("微信好友备注修改提醒",j.content);break;case"weixinOverTimeRemind":DialogUtils.notice("微信消息超时提醒","微信号【"+j.content.employeeWeixin+"】收到【"+j.content.nickName+"】的消息已超时");
break;case"contactNotExist":DialogUtils.error("提醒","微信号【"+j.content+"】不存在，添加失败");break;case"wechatMsg":var i=j.content;b._dealWechatMsg(i);break;case"adnLimit_overmsg":b._remindAdnLimit(j.content);
break;case"adnLimit_resetmsg":b._resetAdnLimit(j.content);break;case"toWxChat":JTTabUtils.addOrRefreshTab(ctx+"/crm/android/newList.htm?isGZHChat=y&openCsChat="+j.content,"微信聊天");
break;case"synYouZanPoints":DialogUtils.success("有赞同步通知 :",j.content.content);break;case"dbCallBack":DialogUtils.success("德邦入库通知 :",j.content.content);
break;case"notLoginAdnRecordRemind":DialogUtils.success("员工未登录分机通知 :",j.content.content);break;case"forceLoginAdn":var w=j.content.content;CommonCtiUtils.logout(w,null,null);
console.log("强退分机");break;case"CCTVCallOut":var y=JSON.stringify(j.content.content);var q=JSON.parse(y);var t=q.csPhoneNum;if(q.isAdd){JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/add.htm?type=self&csType=0&csPhoneNum="+t,"新增客户");
}else{var p=q.csId;var g=q.type;var k=q.csName;JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/csEntity/toEdit.htm?type="+g+"&csId="+p,k);}var x=/^(((1[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1}))+\d{9})$/;
if(x.test(t)){window.top.jtCtiService.dialout("90"+t);}else{window.top.jtCtiService.dialout("9"+t);}break;case"translateMsg":var v=j.content;if(v.entity=="TRKSheetRecordPo"){$("iframe").each(function(H){var G=$(this);
var J=$(this.contentWindow.document).find("iframe");if(J.length){var I=$(J[0].contentWindow.document).find("#currentUniqueMark").size();if(I){var K=$(J[0].contentWindow.document).find("#currentUniqueMark").val();
if(K==v.uniqueMark&&v.success=="y"){$(J[0].contentWindow.document).find("#lastTranslateResult").show().css("color","blue").text("结果:成功;");$(J[0].contentWindow.document).find("#translateText").text(v.result);
}else{if(K==v.uniqueMark&&v.success=="n"){$(J[0].contentWindow.document).find("#lastTranslateResult").show().css("color","blue").text("结果:失败;");}}}}});
}else{if(v.entity=="WeiXinRecordPo"){if(v.success=="y"){$("iframe").each(function(H){var G=$(this);if($(this.contentWindow.document).find(".translateToWord[idVal='"+v.uniqueMark+"']").length){var I=$(this.contentWindow.document).find(".translateToWord[idVal='"+v.uniqueMark+"']");
I.attr("title",v.result);I.html("！");I.css("cursor","copy");}if($(this.contentWindow.document).find(".translateToWord4New[idVal='"+v.uniqueMark+"']").length){var I=$(this.contentWindow.document).find(".translateToWord4New[idVal='"+v.uniqueMark+"']");
I.attr("title",v.result);I.html("！");I.css("cursor","copy");}});}}}if("y"==v.success){DialogUtils.success(j.ERROR,"您提交的翻译任务成功:"+v.result);}else{DialogUtils.error(j.ERROR,"您提交的翻译任务失败:"+v.result);
}break;}};},_remindAdnLimit:function(b){DialogUtils.notice("线路提醒",b.msg,null,{showType:"warning"});var a=b.gidDesName;var c=new StringBuffer();c.append('<div class="col-sm-6"><label style="margin-top: 3px;" class="label-warning warning-isp" isp="'+a+'"  title="'+a+'">'+a+"</label></div>");
$("#line_warning_div").append(c.toString());},_resetAdnLimit:function(){$("#line_warning_div").empty();},_dealWxMsg:function(b){var a=this;var d=$("a.J_menuTab[data-id='"+ctx+"/crm/cs/weiXinChat/list.htm']");
if(b.type=="in"){if(!(d.length>0&&d.hasClass("active"))){if(!a.isNotice){var e={id:currentUserId,content:a._getWxContent(b),title:"收到微信消息"};DialogUtils.notice(e.title,e.content,function(){JTTabUtils.addOrRefreshTab(ctx+"/crm/cs/weiXinChat/list.htm","微信聊天","微信聊天",true);
},{"timeOut":3000});a.isNotice=true;}var c=$("#wxMsgCount").html();if(c.indexOf("+")==-1){c=parseInt(c)+1;if(c<=99){$("#wxMsgCount").empty().append(parseInt(c));
}else{$("#wxMsgCount").empty().append(99+"+");}}$("#wxMsgCount").addClass("blink");}}b.messageType="msg";a._sendIframeMsg(b);},_dealAndoidWxMsg:function(b){var a=this;
var d=$("a.J_menuTab[data-id='"+ctx+"/crm/android/newList.htm']");if(b.type=="in"){if(!(d.length>0&&d.hasClass("active"))){if(!a.isNotice){var e={id:currentUserId,content:a._getWxContent(b),title:"收到微信消息"};
DialogUtils.notice(e.title,e.content,function(){JTTabUtils.addOrRefreshTab(ctx+"/crm/android/newList.htm","微信聊天","微信聊天",true);},{"timeOut":3000});a.isNotice=true;
}var c=$("#wxMsgCount").html();if(c.indexOf("+")==-1){c=parseInt(c)+1;if(c<=99){$("#wxMsgCount").empty().append(parseInt(c));}else{$("#wxMsgCount").empty().append(99+"+");
}}$("#wxMsgCount").addClass("blink");}}a._sendIframeMsg(b);},_dealWechatMsg:function(b){var a=this;b.messageType="wechatMsg";a._sendIframeMsg(b);},_sendIframeMsg:function(b){var c=document.getElementsByName("iframe");
if(c.length>0){for(var a=0;a<c.length;a++){c[a].contentWindow.postMessage(JSON.stringify(b),"*");}}},_getWxContent:function(b){if(b.contentType==1||b.contentType=="1"){return"[图片]";
}else{if(b.contentType==2||b.contentType=="2"){return"[语音]";}else{if(b.contentType==4||b.contentType=="4"){return"[图片]";}else{if(b.contentType==8||b.contentType=="8"){return"[视频]";
}else{if(b.contentType==7||b.contentType=="7"){return"[文件]";}else{if(b.contentType==5||b.contentType=="5"){var a=b.content.split(";");var c=a[0]+"想要加你为朋友";
return c;}else{return b.content;}}}}}}},_hideScanPane:function(){var a=this;setTimeout(function(){layer.close(a.loginWeiXin.layerIndex);},500);},_removeMsgCount:function(c){var d=[];
var b=sessionStorage.getItem("jt-wexin-not-read");if(b&&b!=null&&b!=""){d=JSON.parse(b);for(var a=0;a<d.length;a++){if(c==d[a].employeeWeiXin){d[a].count=0;
}}}sessionStorage.setItem("jt-wexin-not-read",JSON.stringify(d));},_relaodWeixin:function(b){var a={empWx:b,messageType:"reload"};this._sendIframeMsg(a);
},_dealAndoidWxStatus:function(b){var c="微信号【"+b.alias+"】";if(b.status==0){c=c+"退出系统，请留意";DialogUtils.notice("提示",c,null,{msgType:msgCode.ERROR,"timeOut":10000});
}else{c=c+"登录系统";DialogUtils.notice("提示",c,null,{"timeOut":3000});}var a={messageType:"reloadAndroid",employeeAlias:b.employeeAlias,alias:b.alias,status:b.status};
this._sendIframeMsg(a);},_reloadAndroid:function(b){var a={messageType:"reloadAndroid",employeeAlias:b.employeeAlias,alias:b.alias,status:b.status};this._sendIframeMsg(a);
},_dealSzCtiEvent:function(a){switch(a.eventType){case"ReadyStateEvent":console.log("ReadyStateEvent");if(SzCtiUtils._evthandler.onReadyState){SzCtiUtils._evthandler.onReadyState(a.result);
}break;case"CallIncomeEvent":console.log("CallIncomeEvent");if(SzCtiUtils._evthandler.onCallincome){SzCtiUtils._evthandler.onCallincome(a.result.ano,a.result.bno);
}break;case"CallIncomeLinkEvent":console.log("CallIncomeLinkEvent");if(SzCtiUtils._evthandler.onTalked){SzCtiUtils._evthandler.onTalked(a.result.ano,a.result.bno);
}break;case"CallIncomeRingStopEvent":console.log("CallIncomeRingStopEvent");if(SzCtiUtils._evthandler.onRingStoped){SzCtiUtils._evthandler.onRingStoped(a.result);
}break;case"CallOutEvent":console.log("CallOutEvent");if(SzCtiUtils._evthandler.onCallOut){SzCtiUtils._evthandler.onCallOut(a.result.ano,a.result.bno);
}break;case"CallOutLinkEvent":console.log("CallOutLinkEvent");if(SzCtiUtils._evthandler.onTalked){SzCtiUtils._evthandler.onTalked(a.result.ano,a.result.bno);
}break;case"FenjiForceLogoutEvent":console.log("FenjiForceLogoutEvent");if(SzCtiUtils._evthandler.onAgentChanged){SzCtiUtils._evthandler.onAgentChanged("1",a.result);
}break;case"Line2BusyEvent":console.log("Line2BusyEvent");if(SzCtiUtils._evthandler.onAgentChanged){SzCtiUtils._evthandler.onAgentChanged("3",a.result);
}break;case"Line2FreeEvent":console.log("Line2FreeEvent");if(SzCtiUtils._evthandler.onAgentChanged){SzCtiUtils._evthandler.onAgentChanged("2",a.result);
}if(SzCtiUtils._evthandler.onHookChanged){SzCtiUtils._evthandler.onHookChanged("1");}break;case"OffHookEvent":console.log("OffHookEvent");if(SzCtiUtils._evthandler.onHookChanged){SzCtiUtils._evthandler.onHookChanged("2");
}break;}},_createNoticeStr:function(c){var d=new StringBuffer();if(c&&c.length){for(var a=0;a<c.length;a++){var b=c[a];d.append("<div noticeIdVal='"+b.id+"' class='panel panel-default'>");
d.append("<div class='panel-heading noticeTitle'>"+b.title+"<i class='fa fa-angle-double-down'></i></div>");d.append("<div class='panel-body noticeContent'>");
d.append(b.content);d.append("<div class='col-sm-12'>");d.append("<button idVal='"+b.id+"' title='删除' class='deleteMsgBth btn  btn-xs btn-outline btn-danger' type='button'><i class='fa fa-remove'></i></button>");
d.append("<span class='pull-right'>"+b.startTime+"</span>");d.append("</div>");d.append("</div>");d.append("</div>");d.append("</div>");}}return d.toString();
},_createRemindStr:function(a){var e=new StringBuffer();if(a&&a.length){for(var d=0;d<a.length;d++){var j=a[d];var b=j.url;var f=j.title?j.title:"";var c="";
if(f.indexOf("未接来电")!=-1){c=f.replace("未接来电","");if(c){c=PhoneEncryptUtils.encryptPhone(c);}else{c="";}}if(c){f=c+"未接来电";}if(!b){b="";}if(j.level==Msg._LEVEL_.DEFAULT){e.append("<div class='msgRemind alert alert-default alert-dismissable' titleVal='"+f+"' urlVal='"+b+"' remindIdVal='"+j.id+"'>");
}else{if(j.level==Msg._LEVEL_.INFO){e.append("<div class='msgRemind alert alert-info alert-dismissable' titleVal='"+f+"' urlVal='"+b+"' remindIdVal='"+j.id+"' >");
}else{if(j.level==Msg._LEVEL_.WARNING){e.append("<div class='msgRemind alert alert-warning alert-dismissable' titleVal='"+f+"' urlVal='"+b+"' remindIdVal='"+j.id+"' >");
}else{if(j.level==Msg._LEVEL_.DANGER){e.append("<div class='msgRemind alert alert-danger alert-dismissable' titleVal='"+f+"' urlVal='"+b+"' remindIdVal='"+j.id+"'>");
}else{if(j.level==Msg._LEVEL_.SUCCESS){e.append("<div class='msgRemind alert alert-danger alert-dismissable' titleVal='"+f+"' urlVal='"+b+"' remindIdVal='"+j.id+"' >");
}}}}}e.append("<button aria-hidden='true' data-dismiss='alert' class='close closeRemindBtn' type='button'>×</button>");if(c){if(!j.content||j.content.indexOf("未接来电")>-1){j.content="[时间未知]";
}var h=c+"&nbsp;&nbsp;约<span style='color:blue'>["+j.content+"]</span>&nbsp;&nbsp;未接来电";e.append(h);var g=DateUtils.mini2Time(j.createTime);e.append("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color:red'>"+g+"</span>");
}else{e.append(j.content);var g=DateUtils.mini2Time(j.createTime);e.append("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='color:red'>"+g+"</span>");
}e.append("</div>");}}return e.toString();},_createSingleRemindStr:function(c){if(!$("#remindContainer").find("div[remindIdVal='"+c.id+"']").length){var b=[];
b.push(c);$("#remindContainer").prepend(this._createRemindStr(b));var a=$("#msgCount");a.text(parseInt(a.text())+1);}},_showUnReadNoticeAndReminds:function(){var a=this;
FormUtils.loadData(ctx+"/gl/msg/msgEntity/findReadyResult.htm?recId="+currentUserId+"&type=",function(c){var b=c.rows;if(c&&c.records){$("#msgCount").empty().append(""+c.records);
}else{$("#msgCount").empty().append("0");}});}};function Tab(){this.onContextMenuTab=null;}Tab.prototype={init:function(){this._bindEventHanlder();var a=$(window).height()-$(".row.border-bottom").height()-30;
$(".sidebar-container").slimScroll({height:a,railOpacity:0.4,wheelStep:10});},_bindEventHanlder:function(){var a=this;$("#context-menu").on("mouseleave",function(){$(this).hide();
});$(".page-tabs-content").on("contextmenu",".J_menuTab",function(c){if(3==c.which){a.onContextMenuTab=$(this).attr("data-id");var b=c.clientX-$(".navbar-static-side").outerWidth(true)-15;
var d=c.clientY-$(".navbar-static-top").outerHeight(true);if($(this).nextAll(".J_menuTab").size()>0){$("#context-menu").find("li[data-action='tab-close-right']").removeClass("disabled");
}else{$("#context-menu").find("li[data-action='tab-close-right']").addClass("disabled");}if($(this).prevAll(".J_menuTab").size()>1){$("#context-menu").find("li[data-action='tab-close-left']").removeClass("disabled");
}else{$("#context-menu").find("li[data-action='tab-close-left']").addClass("disabled");}if($(".J_menuTab").size()>1){$("#context-menu").find("li[data-action='tab-close-all']").removeClass("disabled");
}else{$("#context-menu").find("li[data-action='tab-close-all']").addClass("disabled");}if($(".J_menuTab").size()>3){$("#context-menu").find("li[data-action='tab-close-other']").removeClass("disabled");
}else{$("#context-menu").find("li[data-action='tab-close-other']").addClass("disabled");}$("#context-menu").css({top:d-5+"px",left:b-5+"px",display:"block",});
return false;}});$(".page-tabs-content").on("click",".J_menuTab",function(b){$("#context-menu").hide();});$(".page-tabs-content").on("click",".J_menuTab",function(){JTTabUtils.showActiveTab($(this).attr("data-id"));
});$(".page-tabs-content").on("click",".fa-times-circle",function(b){JTTabUtils.closeTab($(this).parent().attr("data-id"));b.stopPropagation();});$(".content-tabs").on("click",".J_tabLeft",function(){JTTabUtils.scrollTabLeft();
});$(".content-tabs").on("click",".J_tabRight",function(){JTTabUtils.scrollTabRight();});$(".page-tabs-content").on("dblclick",".J_menuTab",function(){JTTabUtils.refreshTab($(this).attr("data-id"));
});$(".J_tabShowActive").on("click",function(){JTTabUtils.showActiveTab($(".page-tabs-content").find(".active").attr("data-id"));});$(".J_tabCloseAll").on("click",function(){JTTabUtils.closeAllTabs();
});$(".J_tabCloseOther").on("click",function(){JTTabUtils.closeOtherTabs();});$("#context-menu").on("click","li",function(){if($(this).hasClass("disabled")){return;
}var b=$(this).attr("data-action");switch(b){case"tab-refresh":JTTabUtils.refreshTab(a.onContextMenuTab);break;case"tab-close-right":JTTabUtils.closeRightTabs();
break;case"tab-close-left":JTTabUtils.closeLeftTabs();break;case"tab-close-other":JTTabUtils.closeOtherTabs();break;case"tab-close-all":JTTabUtils.closeAllTabs();
break;case"tab-close":JTTabUtils.closeTab(a.onContextMenuTab);break;}$("#context-menu").hide();});}};function KmHome(){this.cateId=null;this.kmFile=new KmFile();
this.versionTipPanel=new VersionTipPanel();this.seniorSearch=new SeniorSearch();}KmHome._CONS_={LIST_DATA_URL:ctx+"/gl/km/kmEntity/listData.htm",DETAILCONTENT_URL:ctx+"/gl/km/kmEntity/detailContent.htm",USEFUL_ADD_URL:ctx+"/gl/km/kmEntity/usefulAdd.htm",USELESS_EDIT_URL:ctx+"/gl/km/kmEntity/uselessEdit.htm",FAVORITE_URL:ctx+"/gl/km/kmEntity/favorite.htm",FAVORITE_CANCEL_URL:ctx+"/gl/km/kmEntity/favoriteCancel.htm",GRID:"#kmHomeGrid",PAGER:"#kmHomePager"};
KmHome.prototype={init:function(){this._bindEventHanlder();this._hideNotGrantBtn();this._loadKmCateTree();$("#detailForm").hide();this.seniorSearch.init();
var b=new Clipboard(".kmCopyPath");var a=new Solr({click:".right-sidebar-toggle-solr",width:"90%",edit:false,choice:false,save:false});a.init();},_hideNotGrantBtn:function(){if(!ResUtils.canShow("solr.button.top.entry")){$(".right-sidebar-toggle-solr").parent().prev().hide().next().hide();
}},_loadKmCateTree:function(){var a=this;var b={treeId:"kmEntityCateTree",cateTypeKey:"knowledge_type",rootKey:"knowledge",userId:"",dragAble:true,contextMenu:{},onClick:function(c){a.seniorSearch.initCrumbs(c,"kmEntityCateTree");
a.cateId=c.id;var d="key=knowledge";d+="&typeKey=knowledge_type";a._initKmHome(d);$("#kmHomeListForm").show();$("#detailForm").hide();$(".contentDetail").empty();
$(".favorite").hide();$(".favoriteCancel").hide();}};ZtreeUtils.init(b);},_dealStyle:function(){},loadKmLayer:function(){var a=this;if(a.kmLayer){layer.close(a.kmLayer);
a.kmLayer=null;}else{a.kmLayer=layer.open({type:1,skin:"min-km-layer",closeBtn:0,title:"",move:".move-km-layer",shade:false,area:["1000px","650px"],offset:"10%",content:$("#right-sidebar-km"),scrollbar:true,resizing:function(b){if($(b).width()<800){layer.style(a.kmLayer,{width:"800px"});
}if($(b).height()<600){layer.style(a.kmLayer,{height:"600px"});}},success:function(b,c){}});}},_bindEventHanlder:function(){var a=this;$(".right-sidebar-toggle-km,#closeKmBtn").on("click",function(b){a.loadKmLayer();
return false;$("#right-sidebar-km").toggleClass("sidebar-open");if($("#right-sidebar-km").attr("class")){}else{layer.close(a.kmLayer);}});$("#kmHomeSearchName").on("focus",function(){$("#kmHomeSearchForm").stop().animate({width:"400px"},250);
});$("#kmHomeSearchName").on("blur",function(){$("#kmHomeSearchForm").stop().animate({width:"250px"},250);});$("#kmHomeContent").on("click",".showMore",function(){JTTabUtils.addOrRefreshTab(ctx+"/gl/km/kmEntity/list.htm","知识库");
});$("#kmHomeContent").on("click",".caption",function(){var b=$(this).attr("idVal");a._detail(b);});$(".sidebar-container-km").on("click","li a",function(){if($(this).attr("href")=="#tab-my"){var b=$(this).closest("form").serialize();
b+="&key=knowledge",b+="&typeKey=knowledge_type",b+="&type=myFavorite",a._initKmHome(b);}else{var b=$(this).closest("form").serialize();b+="&key=knowledge",b+="&typeKey=knowledge_type",a._initKmHome(b);
}$("#kmHomeListForm").show();$("#detailForm").hide();$(".contentDetail").empty();$(".favorite").hide();$(".favoriteCancel").hide();});$("body").on("click",".kmHomeSearch",function(){var b=$(this).closest("form").serialize();
b+="&key=knowledge";b+="&typeKey=knowledge_type";if($("#myKmEntity").attr("class")=="active"){b+="&type=myFavorite";}a._initKmHome(b);});$("body").on("keypress",function(b){if(b.keyCode=="11"){$("#right-sidebar-km").toggleClass("sidebar-open");
if($("#right-sidebar-km").attr("class")){$("#closeKmBtn").show();$("#kmHomeSearchName").focus();$("#right-sidebar-km").show();}else{$("#closeKmBtn").hide();
$("#right-sidebar-km").hide();}}});$("#kmHomeSearchName").on("keypress",function(b){if(b.keyCode=="13"){$(".kmHomeSearch").trigger("click");}});$(document).on("click",".usefulAdd",function(){a._usefulAdd();
});$(document).on("click",".uselessEdit",function(){a._uselessEdit();});$(document).on("click",".favorite",function(){var b=$("input[name=id]").val();FormUtils.submit(KmHome._CONS_.FAVORITE_URL,{id:b},function(c){if(c.success){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);
$(".favoriteCancel").show();$(".favorite").hide();}else{DialogUtils.error(msgCode.ERROR,c.msg);}});});$(document).on("click",".favoriteCancel",function(){var b=$("input[name=id]").val();
FormUtils.submit(KmHome._CONS_.FAVORITE_CANCEL_URL,{id:b},function(c){if(c.success){DialogUtils.success(msgCode.INFO,msgCode.UPDATE_MSG);$(".favoriteCancel").hide();
$(".favorite").show();}else{DialogUtils.error(msgCode.ERROR,c.msg);}});});$(document).on("click",".kmCopyPath",function(c){var b=new Clipboard(this);if($(".isKmCopyClose").is(":checked")){$("#right-sidebar-km").toggleClass("sidebar-open");
$("#closeKmBtn").hide();$("#right-sidebar-km").hide();}});$(document).on("click",".previewFile",function(d){var c=this;var b=$(this).attr("data-clipboard-text");
var f=$(this).attr("fileName");if(b&&b.endsWith("pdf")||b&&b.endsWith("PDF")){window.open(ctx+"/common/readPdf.htm?fileUrl="+ctx+"/"+b);return;}else{DialogUtils.error("提示：","暂不支持预览非PDF文档！");
return;}});$(".historyVersion").on("click",function(){a.versionTipPanel.showHistoryVersion();});$(".highLight").on("click",function(){JTTabUtils.addOrRefreshTab(ctx+"/crm/Common/HighLight/list.htm","亮点汇聚","亮点汇聚");
});$(".km-back-to-list").on("click",function(){$("#kmHomeListForm").show();$("#detailForm").hide();});},_detail:function(a){$("#kmHomeListForm").hide();
$("#detailForm").show();this._loadDetail(a);$(".cateDiv").show();$(".useButtons").show();$(".kmFileAdd").attr("disabled","disabled");},_loadDetail:function(b){var a=this;
FormUtils.loadData(KmHome._CONS_.DETAILCONTENT_URL+"?id="+b,function(c){$("input[name=id]").val(c.id);$(".titleDetail").text(c.name);$(".timeDetail").text(c.createTime);
$(".keywordDetail").text(c.keyword);if(c.keyword){$(".keywordDetailText").show();}else{$(".keywordDetailText").hide();}$(".authorDetail").text(c.createBy);
var d=new StringBuffer();d.append(c.content);$(".contentDetail").empty().append(d.toString());$(".useful").text(c.useful);$(".useless").text(c.useless);
$("input[name=isGood]").val(c.isGood);$("input[name=useful]").val(c.useful);$("input[name=useless]").val(c.useless);if(c.kmFilePos==""){$(".filesDetail").hide();
}else{$(".filesDetail").show();$("#kmFileDetailDiv").empty();a.kmFile.createFilesDetailInHome(c.kmFilePos);$(".deleteFile").hide();}if(c.isFavorite=="y"){$(".favoriteCancel").show();
}else{$(".favorite").show();}if(!ResUtils.canShow("kmHome.button.copy")){$(kmFileDetailDiv).find(".kmCopyPath").remove();}if(!ResUtils.canShow("kmHome.button.preview")){$(kmFileDetailDiv).find(".previewFile").remove();
}});},_usefulAdd:function(){var a=this;$.ajax({type:"POST",url:KmHome._CONS_.USEFUL_ADD_URL+"?id="+$("#id").val(),contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(b){if(b.success){DialogUtils.success(msgCode.INFO,"评分成功！");
$("input[name=useful]").val(b.msg);$(".useful").text(b.msg);}else{DialogUtils.success(msgCode.INFO,b.msg);}},error:function(b){DialogUtils.error(msgCode.FAIL_MSG,b.msg);
}});},_uselessEdit:function(){var a=this;$.ajax({type:"POST",url:KmHome._CONS_.USELESS_EDIT_URL+"?id="+$("#id").val(),contentType:"application/x-www-form-urlencoded",dataType:"json",success:function(b){if(b.success){DialogUtils.success(msgCode.INFO,"评分成功！");
$("input[name=useless]").val(b.msg);$(".useless").text(b.msg);a.reloadJqgrid();}else{DialogUtils.success(msgCode.INFO,b.msg);}},error:function(b){}});},_initKmHome:function(c){var b=this;
c+="&Q__S__EQ__cate_id_="+this.cateId;var a=KmHome._CONS_.LIST_DATA_URL;FormUtils.submit(a,c,function(d){b._bulidData(d);},function(){DialogUtils.error(msgCode.ERROR,msgCode.ERROR_MSG);
});if(c==null||typeof c==undefined){c={};}},_removeHtml:function(a){a=a.replace(/<\/?[^>]*>/g,"").replaceAll("&nbsp;","").trim();return a;},_bulidData:function(c){var b=c.rows;
if(b&&b.length){var d=new StringBuffer();for(var a=0;a<b.length;a++){d.append("<div class='km-div'><div class='km-title-div'>").append("<a class='btn-link caption' idVal='"+b[a].id+"' href='javascript:void(0);'>").append("<i class='fa fa-file-text-o'></i>").append("<div class='km-items-title'>"+b[a].name+"</div>").append("</a>").append("<div class='km-items-msg'>").append("<span class='font-noraml'>发布人："+b[a].createBy+" </span> ").append("<span class='font-noraml'>发布于："+b[a].createTime+" </span>").append("</div>").append("</div>").append("</div>");
}$("#kmHomeContent").empty().append(d.toString());}else{$("#kmHomeContent").empty().append("<div class='km-empty-result'>未知领域，暂时没有可供参考的数据...</div>");}},};
$(function(){jtIndex=new JTIndex();jtIndex.init();console.log(jtIndex);});