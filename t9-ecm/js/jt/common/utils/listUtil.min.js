function ListUtil(a){if(!a){return false;}this.gridId=a.grid.attr("id");this.grid=a.grid;this.key=a.options.simplify.key?a.options.simplify.key:"configer";
if(typeof a.options.simplify!="object"){console.log("精简配置参数错误！");return false;}this.entry=a.options.simplify.entry?a.options.simplify.entry:null;this.base=a.options.simplify.base?a.options.simplify.base:null;
this.other=a.options.simplify.other?a.options.simplify.other:null;this.must=a.options.simplify.must?a.options.simplify.must:null;this.colModel=a.options.colModel;
this.colNames=a.options.colNames;this.current=null;}ListUtil._CONS_={GET_GRID_CONFIGER:ctx+"/gl/formText/findByKey.htm",SAVE_GRID_CONFIGER:ctx+"/gl/formText/updateByKey.htm",ADD_GRID_CONFIGER:ctx+"/gl/formText/saveAdd.htm"};
ListUtil.prototype={init:function(){this.loadBars();this._bindEventHandler();},loadBars:function(){var a=this;var b=a.grid.closest(".ui-jqgrid").find(".ui-jqgrid-titlebar");
if(b.find(".grid-lowpixel-bar").length==0){var c='<div class="grid-lowpixel-bar">精简&nbsp;<i class="fa fa-navicon"></i><div class="grid-extra-bar" data-id="#'+a.gridId+'">';
if(a.entry&&a.entry.length>0){$.each(a.entry,function(d,f){c+='<div><input type="checkbox" class="jt-middle-check '+this.sClass+'" '+(this.sCheck?"checked":"")+"/>"+this.sName+"</div>";
});}c+='<div><button type="button" class="jt-form-select '+a.gridId+'-grid-simplify"><i class="fa fa-cog"></i>&nbsp;编辑表头</button></div>';c+="</div>";b.append(c);
}if(b.is(":hidden")){b.show();}},getSysConfig:function(){var a=this;var c=null;$.ajax({type:"POST",url:ListUtil._CONS_.GET_GRID_CONFIGER+"?key="+(a.gridId+".grid."+a.key),async:false,dataType:"json",success:function(d){if(d.msg){c=d;
}}});if(c){var b=JSON.parse(c.msg);if(typeof b=="object"){a.current=b;a.configId=c.msgCode;}}},readConfig:function(){var a=this;var b=window.localStorage.getItem(a.gridId+".grid"+a.key);
if(b){a.current=b.split(",");}else{a.getSysConfig();}a.getCurrentParams();return a.current;},isHidden:function(b){var a=this;if(!a.current){return true;
}if($.inArray(b,a.current)!=-1){return false;}else{return true;}},getCurrentParams:function(){var c=this;var e=c.colModel;var g=c.colNames;var b=[];for(var f=0;
f<g.length;f++){if(e[f].hidden){continue;}var d=e[f].name,a=c.isHidden(d);b.push({"name":g[f],"key":d,"check":a});}c.vp=b;},getMutexParams:function(e,d){var a=this;
var f=[];for(var c=0;c<d.length;c++){for(var b=0;b<e.length;b++){if(e[b].key==d[c].key){break;}if(e.length==(b+1)){f.push(d[c]);}}}return f;},getHalfByName:function(a){var b=this;
var e=[];for(var d=0;d<a.length;d++){for(var c=0;c<b.vp.length;c++){if(b.vp[c].name==a[d]){e.push(b.vp[c]);break;}if(b.vp.length==(c+1)){console.log("无法识别的字段： "+a[d]);
}}}return e;},examConfig:function(){var b=this;var h=[];var a=[];var f=[];var g=[];var e={};if(b.must&&b.must.length>0){for(var c=0;c<b.vp.length;c++){if($.inArray(b.vp[c].name,b.must)==-1){h.push(b.vp[c]);
}else{a.push(b.vp[c]);}}e.must=a;}else{h=b.vp;}if(!b.base&&!b.other){e.all=h;}else{if(b.base&&b.other){if(b.base.length==0&&b.other.length==0){e.all=h;
}else{if(b.base.length>0&&b.other.length==0){e.base=b.getHalfByName(b.base);e.other=b.getMutexParams(e.base,h);}else{if(b.base.length==0&&b.other.length>0){e.other=b.getHalfByName(b.other);
e.base=b.getMutexParams(e.other,h);}else{if(b.base.length>0&&b.other.length>0){e.base=b.getHalfByName(b.base);if(b.must&&b.must.length>0){e.other=b.getMutexParams(e.base,h);
}else{e.other=b.getHalfByName(b.other);var d=b.getMutexParams(e.base,h);d=b.getMutexParams(e.other,d);if(d.length>0){e.must=d;}}}else{if(!b.base||!b.other){if(b.base&&!b.other){if(b.base.length==0){e.all=h;
}else{e.base=b.getHalfByName(b.base);e.other=b.getMutexParams(e.base,h);}}else{if(!b.base&&b.other){if(b.other.length==0){e.all=h;}else{e.other=b.getHalfByName(b.other);
e.base=b.getMutexParams(e.other,h);}}}}}}}}}}return e;},initContent:function(){var a=this;var c=a.examConfig();var b="<div class='grid-config-layer "+a.gridId+"-config-layer'>";
if(c.must){b+=a.getSortItems(c.must,"固有字段",true);}if(c.all){b+=a.getSortItems(c.all,"其他字段");}else{b+=a.getSortItems(c.base,"常用字段");b+=a.getSortItems(c.other,"其他字段");
}b+="</div>";return b;},getSortItems:function(a,h,d){var c=this;var f="";var g="";var e="";var b=true;if(h=="常用字段"){g="jt-gc-item jt-sort-base";}if(h=="其他字段"){g="jt-gc-item jt-sort-other";
}if(a.length>0){$.each(a,function(j,k){f+="<div class='col-sm-3'><input type='checkbox' "+(d?"disabled":"")+" class='jt-gc-check "+g+"' value='"+this.key+"' "+(this.check?"checked":"")+">"+this.name+"</div>";
if(!this.check&&b){b=false;}});}else{return"";}if(h=="常用字段"){e="<input type='checkbox' class='jt-gc-check jt-allcheck-base' "+(b?"checked":"")+">";}if(h=="其他字段"){e="<input type='checkbox' class='jt-gc-check jt-allcheck-other' "+(b?"checked":"")+">";
}if(h){f="<div class='col-sm-12 grid-config-title'>"+e+h+"</div>"+f;}return f;},_bindEventHandler:function(){var a=this;$(document).on("click","."+a.gridId+"-grid-simplify",function(b){if(!a.layerIndex){a.initLayer();
}});$(document).on("click",".jt-allcheck-base",function(b){if($(this).is(":checked")){$(this).closest(".grid-config-layer").find(".jt-sort-base").prop("checked",true);
}else{$(this).closest(".grid-config-layer").find(".jt-sort-base").removeAttr("checked");}});$(document).on("click",".jt-allcheck-other",function(b){if($(this).is(":checked")){$(this).closest(".grid-config-layer").find(".jt-sort-other").prop("checked",true);
}else{$(this).closest(".grid-config-layer").find(".jt-sort-other").removeAttr("checked");}});$(document).on("click",".jt-gc-item",function(d){if($(this).is(":checked")){if($(this).is(".jt-sort-base")){if($(".jt-sort-base:not(:checked)").length==0){$(this).closest(".grid-config-layer").find(".jt-allcheck-base").prop("checked",true);
}}else{if($(this).is(".jt-sort-other")){if($(".jt-sort-other:not(:checked)").length==0){$(this).closest(".grid-config-layer").find(".jt-allcheck-other").prop("checked",true);
}}}}else{if($(this).is(".jt-sort-base")){var c=$(this).closest(".grid-config-layer").find(".jt-allcheck-base");if(c.is(":checked")){c.removeAttr("checked");
}}else{if($(this).is(".jt-sort-other")){var b=$(this).closest(".grid-config-layer").find(".jt-allcheck-other");if(b.is(":checked")){b.removeAttr("checked");
}}}}});},getCurrentConfig:function(){var a=this;var b=[];$("."+a.gridId+"-config-layer").find(".jt-gc-item").each(function(c,d){if(!$(this).is(":checked")){b.push($(this).val());
}});return b;},saveLocalConfig:function(){var a=this;var b=a.getCurrentConfig();window.localStorage.setItem(a.gridId+".grid."+a.key,b);a.current=b;a.doCinfiger();
},saveSysConfig:function(){var a=this;var d=a.getCurrentConfig();var b=ListUtil._CONS_.ADD_GRID_CONFIGER;var c={key:(a.gridId+".grid."+a.key),content:JSON.stringify(d)};
if(a.configId){b=ListUtil._CONS_.SAVE_GRID_CONFIGER;c.id=a.configId;}FormUtils.submit(b,c,function(e){if(e.success){window.localStorage.removeItem(a.gridId+".grid."+a.key);
a.current=d;a.doCinfiger();if(!a.configId){a.configId=e.msgCode;}DialogUtils.success("提示","配置已保存！");}});},doCinfiger:function(){var b=this;var a=b.grid.closest(".ui-jqgrid ").width();
for(var c=0;c<b.vp.length;c++){if($.inArray(b.vp[c].key,b.current)!=-1){if(b.vp[c].check){b.grid.setGridParam().hideCol(b.vp[c].key);b.vp[c].check=false;
}}else{if(!b.vp[c].check){b.grid.setGridParam().showCol(b.vp[c].key);b.vp[c].check=true;}}}b.grid.setGridWidth(a);},initLayer:function(a){var b=this;b.layerIndex=layer.open({type:1,title:"编辑表头",shade:false,btn:["保存","取消","保存为全局"],offset:"10%",area:["700px","auto"],content:b.initContent(),scrollbar:false,skin:"jt-grid-configer",moveOut:true,success:function(c,d){b.layerIndex=null;
},yes:function(d,c){b.saveLocalConfig();layer.close(b.layerIndex);b.layerIndex=null;},btn2:function(d,c){b.layerIndex=null;},btn3:function(d,c){b.saveSysConfig();
b.layerIndex=null;},cancel:function(){b.layerIndex=null;}});},inits:function(){var a=this;$(document).on("click",".jt-grid-simplify",function(){var d=$(this).closest(".grid-extra-bar").attr("data-id");
var e=$(d).jqGrid("getGridParam","colModel");var i=$(d).jqGrid("getGridParam","colNames");var c=$(d).jqGrid("getGridParam","postData");var b=["关闭"];var h=false;
var g=false;if("#performanceForEmpReportGrid"==d||"#profitForGroupReportGrid"==d){h=true;}else{if("#csEntityGrid"==d){if(ResUtils.canShow("csEntity.editTblHead.button")){h=true;
if(ResUtils.canShow("csEntity.defaultTblHead.button")){g=true;}}else{if(ResUtils.canShow("csEntity.defaultTblHead.button")){g=true;}}}else{if(ResUtils.canShow("soEntity.button.editTblHead")){h=true;
if(ResUtils.canShow("soEntity.button.defaluTblHead")){g=true;}}else{if(ResUtils.canShow("soEntity.button.defaluTblHead")){g=true;}}}}if(h){var f="demo-class";
b=["确定","关闭"];if(g){b=["保存","取消","保存为全局"];a.layerIndex=layer.open({type:1,title:"编辑表头",shade:false,btn:b,area:["51%","53%"],content:$(".listTitleEditDiv"),scrollbar:false,skin:f,success:function(r,q){var m=window.localStorage.getItem(d+"defaultHideItems");
var p=new Array();if(m!=null){p=m.split(",");}var o="";var k="";$("#layListTitle").empty();for(var n=2;n<e.length;n++){if(p.indexOf(e[n].name)==-1){var t='<div class="col-sm-3">'+'<div class="checkbox checkbox-success checkbox-inline">'+'<input type="checkbox" class="columnCheckBox" name="listTitleCheck" value="'+e[n].name+'">'+'<label for="648c21b860f84870822946ac25f06f08">'+i[n]+"</label>"+"</div>"+"</div>";
if(e[n].isBase){k+=t;}else{o+=t;}}}if(k){o="<div class='basic-items-title'>常用字段</div>"+k+"<div  class='other-items-title'>其他字段</div>"+o;}$("#layListTitle").append(o);
var l=window.localStorage.getItem(d+"ShowItems");if(l!=null){var s=l.split(",");for(var n=0;n<s.length;n++){$("input[name='listTitleCheck'][value='"+s[n]+"']").prop("checked",true);
}}else{var j=ctx+"/ec/salesorder/soEntity/getDefaultTblHead.htm";if("#csEntityGrid"==d){j=ctx+"/crm/cs/csEntity/getDefaultTblHead.htm";}FormUtils.loadData(j+"?gridId="+d,function(v){if(v&&v.length>0){for(var u=0;
u<v.length;u++){$("input[name='listTitleCheck'][value='"+v[u]+"']").prop("checked",true);}}else{$("input[name='listTitleCheck']").prop("checked",true);
}});}},yes:function(l,k){var n=new Array();var j=new Array();window.localStorage.removeItem(d+"HideItems");window.localStorage.removeItem(d+"ShowItems");
$("input:checkbox[name=listTitleCheck]:not(:checked)").each(function(){n.push($(this).val());});$("input:checkbox[name=listTitleCheck]:checked").each(function(){j.push($(this).val());
});window.localStorage.setItem(d+"HideItems",n);window.localStorage.setItem(d+"ShowItems",j);layer.close(a.layerIndex);var m=$(d).closest(".ui-jqgrid ").width();
$(n).each(function(o){$(d).setGridParam().hideCol(n[o]);});$(j).each(function(o){$(d).setGridParam().showCol(j[o]);});$(d).setGridWidth(m);},btn3:function(m,k){var j=new Array();
var n=new Array();$("input:checkbox[name=listTitleCheck]:checked").each(function(){j.push($(this).val());});$("input:checkbox[name=listTitleCheck]:not(:checked)").each(function(){n.push($(this).val());
});var l=ctx+"/ec/salesorder/soEntity/defaultTblHead.htm";if("#csEntityGrid"==d){l=ctx+"/crm/cs/csEntity/defaultTblHead.htm";}FormUtils.submit(l,{showData:j,hideData:n,gridId:d},function(o){if(o.success){DialogUtils.success("提示","设置成功");
layer.close(a.layerIndex);}else{DialogUtils.errer("错误","后台异常");}});},cancel:function(){layer.close(a.layerIndex);},on:function(k,j){layer.close(a.layerIndex);
}});}else{a.layerIndex=layer.open({type:1,title:"编辑表头",shade:false,btn:b,area:["51%","53%"],content:$(".listTitleEditDiv"),scrollbar:false,success:function(p,o){var l=window.localStorage.getItem(d+"defaultHideItems");
var n=new Array();if(l!=null){n=l.split(",");}var r='<div class="col-sm-3"><div class="checkbox checkbox-success checkbox-inline"><input type="checkbox" class="columnCheckBox" name="allCheck" value="0"><label for="allCheck">全选</label></div></div>';
$("#layListTitle").empty();for(var m=2;m<e.length;m++){if(n.indexOf(e[m].name)==-1){r+='<div class="col-sm-3">'+'<div class="checkbox checkbox-success checkbox-inline">'+'<input type="checkbox" class="columnCheckBox" name="listTitleCheck" value="'+e[m].name+'">'+'<label for="648c21b860f84870822946ac25f06f08">'+i[m]+"</label>"+"</div>"+"</div>";
}}$("#layListTitle").append(r);var k=window.localStorage.getItem(d+"ShowItems");if(k!=null){var q=k.split(",");for(var m=0;m<q.length;m++){$("input[name='listTitleCheck'][value='"+q[m]+"']").prop("checked",true);
}}else{var j=ctx+"/ec/salesorder/soEntity/getDefaultTblHead.htm";if("#csEntityGrid"==d){j=ctx+"/crm/cs/csEntity/getDefaultTblHead.htm";}FormUtils.loadData(j+"?gridId="+d,function(t){if(t&&t.length>0){for(var s=0;
s<t.length;s++){$("input[name='listTitleCheck'][value='"+t[s]+"']").prop("checked",true);}}else{$("input[name='listTitleCheck']").prop("checked",true);
}});}},yes:function(l,k){var n=new Array();var j=new Array();window.localStorage.removeItem(d+"HideItems");window.localStorage.removeItem(d+"ShowItems");
$("input:checkbox[name=listTitleCheck]:not(:checked)").each(function(){n.push($(this).val());});$("input:checkbox[name=listTitleCheck]:checked").each(function(){j.push($(this).val());
});window.localStorage.setItem(d+"HideItems",n);window.localStorage.setItem(d+"ShowItems",j);layer.close(a.layerIndex);var m=$(d).closest(".ui-jqgrid ").width();
$(n).each(function(o){$(d).setGridParam().hideCol(n[o]);});$(j).each(function(o){$(d).setGridParam().showCol(j[o]);});$(d).setGridWidth(m);},on:function(k,j){layer.close(a.layerIndex);
},cancel:function(){layer.close(a.layerIndex);}});}}else{if(g){b=["设置为客户列表默认","关闭"];a.layerIndex=layer.open({type:1,title:"编辑表头",shade:false,btn:b,area:["51%","53%"],content:$(".listTitleEditDiv"),scrollbar:false,success:function(p,o){var l=window.localStorage.getItem(d+"defaultHideItems");
var n=new Array();if(l!=null){n=l.split(",");}var r='<div class="col-sm-3"><div class="checkbox checkbox-success checkbox-inline"><input type="checkbox" class="columnCheckBox" name="allCheck" value="0"><label for="allCheck">全选</label></div></div>';
$("#layListTitle").empty();for(var m=2;m<e.length;m++){if(n.indexOf(e[m].name)==-1){r+='<div class="col-sm-3">'+'<div class="checkbox checkbox-success checkbox-inline">'+'<input type="checkbox" class="columnCheckBox" name="listTitleCheck" value="'+e[m].name+'">'+'<label for="648c21b860f84870822946ac25f06f08">'+i[m]+"</label>"+"</div>"+"</div>";
}}$("#layListTitle").append(r);var k=window.localStorage.getItem(d+"ShowItems");if(k!=null){var q=k.split(",");for(var m=0;m<q.length;m++){$("input[name='listTitleCheck'][value='"+q[m]+"']").prop("checked",true);
}}else{var j=ctx+"/ec/salesorder/soEntity/getDefaultTblHead.htm";if("#csEntityGrid"==d){j=ctx+"/crm/cs/csEntity/getDefaultTblHead.htm";}FormUtils.loadData(j+"?gridId="+d,function(t){if(t&&t.length>0){for(var s=0;
s<t.length;s++){$("input[name='listTitleCheck'][value='"+t[s]+"']").prop("checked",true);}}else{$("input[name='listTitleCheck']").prop("checked",true);
}});}},yes:function(m,k){var j=new Array();var n=new Array();$("input:checkbox[name=listTitleCheck]:checked").each(function(){j.push($(this).val());});
$("input:checkbox[name=listTitleCheck]:not(:checked)").each(function(){n.push($(this).val());});var l=ctx+"/ec/salesorder/soEntity/defaultTblHead.htm";
if("#csEntityGrid"==d){l=ctx+"/crm/cs/csEntity/defaultTblHead.htm";}FormUtils.submit(l,{showData:j,hideData:n,gridId:d},function(o){if(o.success){DialogUtils.success("提示","设置成功");
layer.close(a.layerIndex);}else{DialogUtils.errer("错误","后台异常");}});},on:function(k,j){layer.close(a.layerIndex);},cancel:function(){layer.close(a.layerIndex);
}});}else{a.layerIndex=layer.open({type:1,title:"编辑表头",shade:false,btn:b,area:["51%","53%"],content:$(".listTitleEditDiv"),scrollbar:false,success:function(p,o){var l=window.localStorage.getItem(d+"defaultHideItems");
var n=new Array();if(l!=null){n=l.split(",");}var r='<div class="col-sm-3"><div class="checkbox checkbox-success checkbox-inline"><input type="checkbox" class="columnCheckBox" name="allCheck" value="0"><label for="allCheck">全选</label></div></div>';
$("#layListTitle").empty();for(var m=2;m<e.length;m++){if(n.indexOf(e[m].name)==-1){r+='<div class="col-sm-3">'+'<div class="checkbox checkbox-success checkbox-inline">'+'<input type="checkbox" class="columnCheckBox" name="listTitleCheck" value="'+e[m].name+'">'+'<label for="648c21b860f84870822946ac25f06f08">'+i[m]+"</label>"+"</div>"+"</div>";
}}$("#layListTitle").append(r);var k=window.localStorage.getItem(d+"ShowItems");if(k!=null){var q=k.split(",");for(var m=0;m<q.length;m++){$("input[name='listTitleCheck'][value='"+q[m]+"']").prop("checked",true);
}}else{var j=ctx+"/ec/salesorder/soEntity/getDefaultTblHead.htm";if("#csEntityGrid"==d){j=ctx+"/crm/cs/csEntity/getDefaultTblHead.htm";}FormUtils.loadData(j+"?gridId="+d,function(t){if(t&&t.length>0){for(var s=0;
s<t.length;s++){$("input[name='listTitleCheck'][value='"+t[s]+"']").prop("checked",true);}}else{$("input[name='listTitleCheck']").prop("checked",true);
}});}},on:function(k,j){layer.close(a.layerIndex);},cancel:function(){layer.close(a.layerIndex);}});}}});}};