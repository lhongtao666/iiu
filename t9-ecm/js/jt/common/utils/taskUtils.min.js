var TaskUtils={loadTypeOption:function(a){a.typeKey="com.jt.gl.task.constants.TaskType";return EnumUtils.getEnumOptions(a);},loadStatusOption:function(a){a.typeKey="com.jt.gl.task.constants.TaskStatus";
return EnumUtils.getEnumOptions(a);},dealTaskName:function(b){var a="";if(b.type=="jt_so_entity"){a=TaskUtils._dealSoEntity(b.name);}else{if(b.type=="jt_cs_follow"){a=TaskUtils._dealFollowEntity(b.name);
}else{if(b.type=="jt_so_follow"){a=TaskUtils._dealSoFollowEntity(b.name);}else{if(b.type=="jt_gl_sms"){a=TaskUtils._dealSmsEntity(b.name);}else{a=b.name;
}}}}return a;},_bindEventHandler:function(){var j=this;var a=ctx+"/ec/salesorder/soEntity/detail.htm";var d=ctx+"/crm/cs/csEntity/detail.htm";var h=ctx+"/crm/cs/csEntity/getCsByCode.htm";
var k=ctx+"/ec/salesorder/soEntity/getBySoNo.htm";var b=ctx+"/ec/salesorder/soEntity/place.htm";$(document).on("click",".openCsDetail",function(m){if(!ResUtils.canShow("csEntity.button.editTask")){return;
}var n=$(this).attr("csName");var l=$(this).attr("csCode");if(!l){DialogUtils.error("错误","客户编号为空,无法找到该客户");return;}FormUtils.submit(h,{csCode:l},function(o){if(!$.isEmptyObject(o)){var p=o.id;
JTTabUtils.addOrRefreshTab(d+"?csId="+p+"&type=task","客户["+n+"]明细");}else{DialogUtils.error("错误","没有找到客户,可能已被删除,请通过客户查询查找客户");}});m.preventDefault();m.stopPropagation();
});$(document).on("click",".openCsDetail2",function(m){if(!ResUtils.canShow("csEntity.button.editTask")){return;}var n=$(this).attr("csName");var l=$(this).attr("csCode");
if(!l){DialogUtils.error("错误","客户编号为空,无法找到该客户");return;}FormUtils.submit(h,{csCode:l},function(o){if(!$.isEmptyObject(o)){var p=o.id;JTTabUtils.addOrRefreshTab(d+"?csId="+p+"&type=task","客户["+n+"]明细");
}else{DialogUtils.error("错误","没有找到客户,可能已被删除,请通过客户查询查找客户");}});m.preventDefault();m.stopPropagation();});var f=ctx+"/ec/salesorder/soEntity/detail.htm";
var i=ctx+"/ec/salesorder/soEntity/place.htm";var g=ctx+"/ec/salesorder/soEntity/comfirm/comfirm.htm";var c=ctx+"/ec/salesorder/soEntity/toFollow.htm";
var e=ctx+"/ec/salesorder/soEntity/place.htm";$(document).on("click",".openSoDetail2",function(m){var l=$(this).attr("soNo");var n=l;if(l.length>4){n="*"+l.substring(l.length-3,l.length);
}if(enableTaskSoStatusFilter&&enableTaskSoStatusFilter=="y"){FormUtils.submit(k,{soNo:l},function(o){if(!$.isEmptyObject(o)){var r=o.id;var p=o.status;
var q=o.placerId;var s=o.soType;if("awaiting_post"==p){JTTabUtils.addOrRefreshTab(e+"?soId="+r+"&type=self","订单["+l+"]提交");}else{if("awaiting_comfirm"==p&&ResUtils.canShow("soEntityComfirm.url")){JTTabUtils.addOrRefreshTab(g+"?soId="+r+"&type=self","订单["+l+"审核");
}else{if("shipping"==p&&ResUtils.canShow("soEntity.url")){JTTabUtils.addOrRefreshTab(c+"?soId="+r+"&soNo="+l,"订单["+l+"]跟进");}else{JTTabUtils.addOrRefreshTab(a+"?soNo="+l,"订单["+n+"]明细");
}}}}else{DialogUtils.error("错误","没有找到订单,可能已被删除,请通过订单查询查找订单");}});}else{FormUtils.submit(k,{soNo:l},function(o){if(!$.isEmptyObject(o)){JTTabUtils.addOrRefreshTab(a+"?soNo="+l,"订单["+n+"]明细");
}else{DialogUtils.error("错误","没有找到订单,可能已被删除,请通过订单查询查找订单");}});}m.preventDefault();m.stopPropagation();});$(document).on("click",".openSoDetail",function(m){var l=$(this).attr("soNo");
var n=l;if(l.length>4){n="*"+l.substring(l.length-3,l.length);}FormUtils.submit(k,{soNo:l},function(o){if(!$.isEmptyObject(o)){JTTabUtils.addOrRefreshTab(a+"?soNo="+l,"订单["+n+"]明细");
}else{DialogUtils.error("错误","没有找到订单,可能已被删除,请通过订单查询查找订单");}});m.preventDefault();m.stopPropagation();});},_dealFollowEntity:function(b){var a="";a=b.replace(/\d{3,12}:/g,function(d){var c=d.substring(0,d.length-1);
var f=c;var e=new StringBuffer();e.append('<a href="javascript:void(0);" title="'+f+'" csCode="'+c+'" csName="'+f+'" class="openCsDetail2">');e.append(f);
e.append("</a>");e.append(":");return e.toString();});a="【客户跟进】"+a;return a;},_dealSoFollowEntity:function(b){var a="";a=b.replace(/\d{3,12}：\(/g,function(e){var d=e.substring(0,e.length-2);
var c=d;var f=new StringBuffer();f.append('<a  href="javascript:void(0);" title="'+c+'" soNo="'+d+'" soNoName="'+c+'" class="openSoDetail2">');f.append(c);
f.append("</a>");f.append("：(");return f.toString();});a="【订单跟进】"+a;return a;},_dealSmsEntity:function(b){var a="";a=b.replace(/\d{3,12}:/g,function(d){var c=d.substring(0,d.length-1);
var f=c;var e=new StringBuffer();e.append('<a  href="javascript:void(0);" title="'+f+'" csCode="'+c+'" csName="'+f+'" class="openCsDetail2">');e.append(f);
e.append("</a>");e.append(":");return e.toString();});a="【发送短信】"+a;return a;},_dealSoEntity:function(b){var a="";a=b.replace(/客户【.+】/,function(f){var c=f.substring(3,f.length-1);
var h=c.split("(")[0];var e=c.split("(")[1];var d=e.substring(0,e.length-1);var g=new StringBuffer();g.append(f.substring(0,3));g.append('<a  href="javascript:void(0);" title="'+h+'" csCode="'+d+'" csName="'+h+'" class="openCsDetail">');
g.append(h);g.append("</a>");g.append(f.substring(f.length-1,f.length));return g.toString();});a=a.replace(/订单【.{1,14}】/,function(d){var c=d.substring(3,d.length-1);
var e=new StringBuffer();e.append(d.substring(0,3));e.append('<a  href="javascript:void(0);" onclick="" title="'+c+'" soNo="'+c+'" class="openSoDetail">');
e.append(c);e.append("</a>");e.append(d.substring(d.length-1,d.length));return e.toString();});return a;}};