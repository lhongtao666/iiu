<!DOCTYPE html>
<html>

<head>
    <title>退换货</title>
    <#include "/common/common.html" />
    <style>
        .panel-bb {
            border-bottom: 8px solid #e7eaec;
            border-radius: 0;
            padding: 0 10px;
        }
        .panel-bl {
            border-left: 8px solid #e7eaec;
            border-radius: 0;
            padding: 0 10px;
        }
        .panel-bt {
            border-top: 8px solid #e7eaec;
            border-radius: 0;
            padding: 0 10px;
        }
        #csEntityDiv {margin-bottom: 0;}
        .panel .panel-body, .panel .panel-footer {
            padding: 8px 0;
        }
        #orderListDiv {display: none;}
        .orderMoreList {
            color: #999999;
            cursor: pointer;
            transition: all 0.25s linear;
            background-image: linear-gradient(to left,#fff 0%, #fff 80%, #e7eaec 100%);
            background-size: 0%;
            background-repeat: no-repeat;
        }
        .orderMoreList:hover {
            background-size: 100%;
        }
    </style>
    <script src="${ctx}/js/jt/ec/salesorder/backOrExchange/backOrExchange${deploy_min!""}.js?v=${jsVersion}"></script>
    <script id='userTmpl' type='text/x-jsrender'>
        <li idVal='{{:id}}' nameVal='{{:name}}' class='col-sm-2' style='padding-right:5px;padding-left:0px;'>
            <a href='javascript: void(0);' style='padding-left:0px;padding-right:0px;margin-right:0px;'>
                {{:aid}}:{{:name}}&nbsp;&nbsp;
                <button class='btn btn-danger btn-xs deleteEmployeeBtn' type='button'>
                    <i class='fa fa-remove'></i>
                </button>
            </a>
        </li>
    </script>
    <script type="text/x-jsrender" id="backSoInfoTmpl">
        <tr idVal="{{:id}}">
            <td>{{:#index+1}}</td>
            <td>
                <a href="javascript:void(0)" class="toLinkSo" linkType="退货" soNo="{{:backSoNo}}">{{:backSoNo}}</a>
            </td>
            <td>{{:stockInStatus}}</td>
            <td>{{:soItemDes}}</td>
            <td>{{:stockInTime}}</td>
            <td>{{:totalPrice}}</td>
            <td>
                <button type="button" backSoIdVal="{{:id}}" class="btn btn-sm btn-primary cancelBackSo" >取消退货</button>
            </td>

        </tr>
    </script>
    <script type="text/x-jsrender" id="exchangeSoInfoTmpl">
        <tr>
            <td> {{:#index+1}} </td>
            <td> <a href="javascript:void(0)" class="toLinkSo" linkType="退货" soNo="{{:backSoNo}}">{{:backSoNo}}</a> </td>
            <td>  <a href="javascript:void(0)" class="toLinkSo" linkType="换前退" soNo="{{:exchangeSoNo}}">{{:exchangeSoNo}}</a> </td>
            <td> {{:stockInStatus}} </td>
            <td> {{:orginSoItemDes}} </td>
            <td> {{:exchangeSoItemDes}} </td>
            <td> {{:stockInTime}} </td>
            <td> {{:totalPrice}} </td>
            <td>
                {{if stockInTime && !exchangeSoNo}}
                <button type="button" originSoIdVal="{{:originSoId}}" backSoIdVal="{{:id}}" class="btn btn-sm btn-primary generateChangeSo" >生成换货单</button>
                {{/if}}
                <button type="button" originSoIdVal="{{:originSoId}}" backSoIdVal="{{:id}}" class="btn btn-sm btn-primary cancelExchangeSo" >取消换货</button>
            </td>
        </tr>
    </script>
    <script type="text/x-jsrender" id="originSoItemInfoTmpl">
        <tr idVal="{{:id}}"   >
            <td></td>
            <td>
                {{if count>hasBackOrExchangeCount }}
                    <input canExchange="yes" actualPrice='{{:actualPrice}}' class="select-td-checkbox-can-choose" type='checkbox' />
                {{else}}
                    <input canExchange="no" actualPrice='{{:actualPrice}}' class="select-td-checkbox" disabled="true" type='checkbox' />
                {{/if}}
            </td>
            <td>{{:prodName}}</td>
            <td>{{:skuKey}}</td>
            <td>{{:salesPrice}}</td>
            <td>{{:actualPrice}}</td>
            <td>{{:count}}</td>
            <td>{{:hasBackOrExchangeCount}}</td>
            <td>
                <input class='backCount form-control' validateType="default" name='canBackCount' digits="true" min="0" max="{{:count-hasBackOrExchangeCount}}" value='{{:count-hasBackOrExchangeCount}}' type='number'>
            </td>
            <td>{{:salesPrice*count}}</td>
            <td>
                {{if count>hasBackOrExchangeCount }}
                    <button idVal='{{:id}}' actualPrice='{{:actualPrice}}' type="button" class="btn btn-sm   btn-primary backBtn">退货</button>
                    <button idVal='{{:id}}' actualPrice='{{:actualPrice}}'  type="button" class="btn btn-sm   btn-primary exchangeBtn">换货</button>
                {{/if}}
            </td>
        </tr>
    </script>
</head>

<body class='white-bg' style='padding: 0 5px;'>
    <div class="panel panel-default panel-bb">
        <div class="panel-heading jt-panel-heading">
            <h3 class="panel-title">订单信息</h3>
        </div>
        <div class="panel-body">
            <form id="soEntityForm" method="get" class="form-horizontal" novalidate="novalidate">
                <div class=" form-group">
                    <div class="col-sm-3">
                        <label class="col-sm-4 control-label">订单编号</label>
                        <div class="col-sm-8">
                            <input type="hidden" name="soId" value="${soInfoVo.id}">
                            <input type="text" class="form-control" name="soNo" readonly="true" value="${soInfoVo.soNo}">
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <label class="col-sm-4 control-label">客户编号</label>
                        <div class="col-sm-8">
                            <input type="text" name="csCode" readonly="readonly" value="${soInfoVo.csCode}" class="form-control csCode" csId="${soInVo.csId}" csName="${soInVo.csName}">
                            <input type="hidden" name="csName" readonly="readonly" value="${soInfoVo.csName}" class="form-control">
                            <input type="hidden" name="csId" readonly="readonly" value="${soInfoVo.csId}" class="form-control">
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <label class="col-sm-4 control-label">运费</label>
                        <div class="col-sm-8">
                            <input type="text" name="shippingAmount" readonly="readonly" value="${((soInfoVo.shippingAmount)!0.00)?string('0.00')}" class="form-control">
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <label class="col-sm-4 control-label">订单总价</label>
                        <div class="col-sm-8">
                            <input type="text" name="totalAmount" readonly="readonly" value="${((soInfoVo.totalAmount)!0.00)?string('0.00')}" class="form-control">
                        </div>
                    </div>
                </div>
                <div class=" form-group">
                    <div class="col-sm-3">
                        <label class="col-sm-4 control-label">支付方式</label>
                        <div class="col-sm-8">
                            <select name="payType" id="payType" class="form-control" disabled validateType="default">
                                <option value="cash" <#if soInfoVo.payType=='cash'>selected</#if>>现金支付</option>
                                <option value="alipay" <#if soInfoVo.payType=='alipay'>selected</#if>>支付宝</option>
                                <option value="weixin" <#if soInfoVo.payType=='weixin'>selected</#if>>微信支付</option>
                                <option value="bank" <#if soInfoVo.payType=='bank'>selected</#if>>银行转账</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <label class="col-sm-4 control-label">订单状态</label>
                        <div class="col-sm-8">
                            <input type="text" readonly="readonly" class="form-control" value="${soInfoVo.statusName}" />
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <label class="col-sm-4 control-label">下单时间</label>
                        <div class="col-sm-8">
                            <input type="text" name="placeTime" value="${soInfoVo.createTimeStr!''}" class="form-control" readonly="readonly">
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <label class="col-sm-4 control-label">签收时间</label>
                        <div class="col-sm-8"><input type="text" name="completeTime" value="${soInfoVo.completeTimeStr!''}" class="form-control" readonly="readonly">
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="panel panel-default panel-bb">
        <div class="panel-heading jt-panel-heading">
            <h3 class="panel-title">可退换商品</h3>
        </div>
        <div class="panel-body">
            <div class="row" style="padding-bottom: 10px;padding-top: 10px;">
                <div class="col-sm-12">
                    <button type="button" class="btn btn-sm   btn-primary backBtn">批量退货</button>
                    <button type="button" class="btn btn-sm   btn-primary exchangeBtn">批量换货</button>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12" id="csFollowDiv">
                    <div id="csFollowTable_wrapper" class="dataTables_wrapper form-inline" role="grid">
                        <div class="row">
                            <div class="col-sm-6"></div>
                            <div class="col-sm-6"></div>
                        </div>
                            <form id="tableForm" method="get" class="form-horizontal">
                        <table class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <th width="10px"></th>
                                        <th><input class="select-all-th-checkbox" type="checkbox"></th>
                                        <th>商品名称</th>
                                        <th>sku编码</th>
                                        <th>商品原价</th>
                                        <th>商品售出价</th>
                                        <th>数量</th>
                                        <th>已退换数量</th>
                                        <th>可退换数量</th>
                                        <th>小计</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="soItemVoTbody">
                                </tbody>
                        </table>
                            </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="panel panel-default panel-bb">
        <div class="panel-heading jt-panel-heading">
            <h3 class="panel-title">退货信息</h3>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-sm-12" id="csFollowDiv">
                    <div id="csFollowTable_wrapper" class="dataTables_wrapper form-inline" role="grid">
                        <div class="row">
                            <div class="col-sm-6"></div>
                            <div class="col-sm-6"></div>
                        </div>
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th>序号</th>
                                    <th>退货订单编号</th>
                                    <th>入库状态</th>
                                    <th>退货商品</th>
                                    <th>入库/退货时间</th>
                                    <th>退货总金额</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="backSoInfo">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="panel panel-default panel-bb">
        <div class="panel-heading jt-panel-heading">
            <h3 class="panel-title">换货信息</h3>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-sm-12" id="csFollowDiv">
                    <div id="csFollowTable_wrapper" class="dataTables_wrapper form-inline" role="grid">
                        <div class="row">
                            <div class="col-sm-6"></div>
                            <div class="col-sm-6"></div>
                        </div>
                        <table class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th>序号</th>
                                    <th>退货订单编号</th>
                                    <th>换货订单编号</th>
                                    <th>入库状态</th>
                                    <th>原商品</th>
                                    <th>换货商品</th>
                                    <th>入库/退货时间</th>
                                    <th>换货总金额</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="exchangeSoInfo">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <#include "/ec/salesorder/backOrExchange/backEditModal.html" />
</body>

</html>