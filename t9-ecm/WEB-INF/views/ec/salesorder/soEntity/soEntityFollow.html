<!DOCTYPE html>
<html>
<head>
	<title>销售订单跟进</title>
	<#include "/common/common.html">
	<#include "/common/webuploader.html">
	<#include "/ec/salesorder/soEntity/soEntityCommJs.html">
	<script type="text/javascript">
		var csId = "";
		<#if csId??>
			csId = "${csId}";
		</#if>
		var financeBillAttachPos = [];
		<#if financeBillAttachPos??>
			financeBillAttachPos = ${financeBillAttachPos};
		</#if>
		var isFollowPage = "";
		<#if isFollowPage??>
			isFollowPage = "${isFollowPage}";
		</#if>
	</script>
	<link href="${ctx}/css/jt/common/time-axis.css?v=${jsVersion}" rel="stylesheet">
	<#include "/ec/salesorder/soEntity/soEntityRenderTmpl.html">
	<style type="text/css">
		/*.playHistory{
			    margin-left: 10px;
			    border: 1px solid #1caf9a;
			    padding: 4px 6px;
			    cursor: pointer;
			    color: #1caf9a;
			    background-color: transparent;
		}
		.playHistory:hover{
			    background-color: #23c6c8;
                color: #fff;
		}
		.playHistory.playHistoryOn{
			    background-color: #1caf9a;
                color: #fff;
		}*/
	</style>
<script src='${ctx}/js/jt/ec/salesorder/soEntityFollow-site${deploy_min!""}.js?v=${jsVersion}' ></script>
</head>
<body>
	<div class="wrapper animated ">
		<div  class="row form_wrapper">
			<div class="col-sm-12">
				<div class="panel panel-default">
					<div class="panel-heading" style="position: fixed;z-index: 99999;width: 100%;top: 0px;">
						<div class='soShippedToolBtn'>
							<button type='button' class="jt-btn jt-dd-normal saveShippedBtn"  id="saveShippedBtn"><i class='fa fa-floppy-o'></i>&nbsp;保存发货结果</button>
							    <button type="button" class="jt-btn jt-dd-normal saveSoShippedBtn"><i class='fa fa-floppy-o'></i>&nbsp;保存</button>
							    <button type='button' class='jt-btn jt-btn-red deliverBack'>驳回</button>
		     					<button type="button" class="jt-btn jt-dd-normal addFollow" id="addFollowBtn"> <i class='fa fa-plus'></i>&nbsp;添加订单跟进</button>
		     					<button type='button' class="jt-btn jt-dd-normal preSoBtn" style="display:none;"><i class='fa fa-hand-o-left'></i>&nbsp;上一张</button>
		     					<button type='button' class="jt-btn jt-dd-normal nextSoBtn" style="display:none;"><i class='fa fa-hand-o-right'></i>&nbsp;下一张</button>
		     					<span class="jt-span"></span>
							<button type='button' class="jt-btn jt-btn-red prevBtn"><i class='fa fa-times'></i>&nbsp;关闭</button>
							<button type='button' class='jt-btn jt-dd-normal playHistory'>订单历史</button>
                            <#include "/ec/salesorder/common/soEntityBaseTypeFlag.html" />
						</div>
					</div>
					<div id="orderHistoryContent" class="col-sm-12" style="display:none;border-bottom:1px solid #1caf9a;margin-bottom: 3px;">
                        <table class="table table-striped table-bordered">
                        	<thead>
                        		<tr>
                        			<th style="width: 5%">序号</th>
                        			<th style="width: 15%">订单编号</th>
                        			<th style="width: 10%">产品名称</th>
                        			<th style="width: 10%">货款方式</th>
                        			<th style="width: 10%">订单金额</th>
                        			<th style="width: 15%">状态</th>
                        			<th style="width: 10%">下单人</th>
                        			<th style="width: 15%">下单时间</th>
                        		</tr>
                        	</thead>
                            <tbody id="orderHistory">
                            </tbody>
                        </table>
				    </div>
					<div class="panel-body" style="margin-top: 44px;">
						<form id="soEntityShippedForm" method="get" class="form-horizontal">
							<div class='form-group'>
								<div class='col-sm-4'>
									<label class='col-sm-4 control-label'>订单</label>
									<div class='col-sm-8 soNoDiv'>
										
									</div>
								</div>
								<div class='col-sm-4'>
									<div class='col-sm-2'></div>
									<div class='col-sm-6'>
										<select class='form-control' id="followQry" validateType="default"  >
										</select>
									</div>
									<div class="col-sm-4">
										<button type='button' class="btn btn-sm btn-primary jt-form-select saveFollowStatus">保存跟单状态</button>
									</div>
								</div>
								<div class='col-sm-4 updateTotalAmount' style='display:none;'>
									<label class='col-sm-4 control-label'>修改总金额为</label>
									<div class='col-sm-8'>
										<input type="number" class='form-control' name="updateTotalAmount" validateType="default" ></div>
								</div>
							</div>
							<div class='form-group'>
								<div class='col-sm-4'>
									<label class='col-sm-4 control-label'>发货结果</label>
									<div class='col-sm-8'>
										<select class='form-control '  id="shippedShipResult" name="newStatus" validateType="default"  >
											<option value="">请选择</option>
											<option value="complete" <#if soInfoVo.status == 'complete'>selected</#if>>已签收</option>
											<option value="close_reject" <#if soInfoVo.status == 'close_reject'>selected</#if>>拒收</option>
											<option value="close_lost" <#if soInfoVo.status == 'close_lost'>selected</#if>>丢失</option>
										</select>
									</div>
								</div>
								<div class='col-sm-4'>
									<label class="col-sm-4 control-label">快递单号</label>
									<div class="col-sm-8">
										<input type="text" name="scTrackingNoShow" value="${soInfoVo.soShipPo.scTrackingNo}" readonly="readonly" class="form-control">
									</div>
								</div>
								<div class='col-sm-4'>
									<label class='col-sm-4 control-label'>归属工号</label>
									<div class='col-sm-6'>
										<input type="text" id="employeeShow" class="form-control" readonly  value="${'${csEntityPo.employeeAid}:'}${csEntityPo.employeeName}" />
										<input type="hidden" id="originEmployee" value="${'${csEntityPo.employeeAid}:'}${csEntityPo.employeeName}" />
									</div>
									<div class="col-sm-2">
										<button type="button" style="display:none;" class='btn btn-sm btn-primary jt-form-select changeEmployee'>转</button>
									</div>
								</div>
							</div>
							<div class='form-group backStatusDiv' style="display:none;">
								<div class='col-sm-4'>
									<label class='col-sm-4 control-label'>是否退回</label>
									<div class='col-sm-8'>
										<select class='form-control '  name="backStatus" validateType="default"  >
											<option value="awaiting" <#if soInfoVo.backStatus == 'awaiting'>selected</#if>>是</option>
											<option value="none" <#if soInfoVo.backStatus == 'none'>selected</#if>>否</option>
										</select>
									</div>
								</div>
							</div>
							<div class="lostDiv" style="display:none;">
								<div class='form-group '>
									<div class='col-sm-4'>
										<label class='col-sm-4 control-label'>物流赔偿金额(元)</label>
										<div class='col-sm-8'>
											<input class='form-control'  id="backBreakAmount" name="soShipPo.breakAmount" validateType="default"  value="${soInfoVo.soShipPo.breakAmount}"></div>
									</div>
								</div>
							</div>
							<div class='rejectDiv' style="display:none;">
								<div class='form-group'>
									<div class='col-sm-4'>
										<label class='col-sm-4 control-label'>拒收原因</label>
										<div class='col-sm-8'>
											<select class='form-control' id="rejectTypeOne" name="rejectTypeOne" validateType="default" >
												<option value='ship'>物流原因</option>
												<option value='cs'>客户原因</option>
												<option value='emp'>客服原因</option>
												<option value='turn'>寄方要求退回</option>
											</select>
										</div>
									</div>
									<div class='col-sm-4'>
										<div class='col-sm-8'>
											<select class='form-control' id="rejectType" name="rejectType" validateType="default" >
												
											</select>
										</div>
									</div>
								</div>
								<div class='form-group'>
									<div class='col-sm-4'>
										<label class='col-sm-4 control-label'>拒收描述</label>
										<div class='col-sm-8'>
											<textarea class='form-control' name="rejectReason" validateType="default" col='4' >${soInfoVo.rejectReason}</textarea>
										</div>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
				<div class="panel panel-default">
					<div class="panel-body">
						<#include "/ec/salesorder/soEntity/soEntityForm.html">
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="soEntityDetailShipInfo" style="display: none;height:100%;"> 
		<#include "/ec/salesorder/soEntity/soEntityShipInfo.html">
	</div>
	<#include "/ec/salesorder/soEntity/soEntityIncludePane.html">
	<#include "/ec/salesorder/soEntity/soEntityItemDamage.html">
</body>
</html>
